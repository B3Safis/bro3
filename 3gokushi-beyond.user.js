// ==UserScript==
// @name		3gokushi-Beyond
// @namespace	3gokushi-hatt
// @description	ブラウザ三国志用便利機能色々ごった煮
// @include		http://*.3gokushi.jp/*
// @include		http://mixi.jp/run_appli.pl?id=6598
// @include		http://*.mixi-platform.com/*
// @author		原作者hatt,編集者romer,etc...(with RAPT)
// @version		3.0.74α+1 (2016/10/22)
// @connect		3gokushi.jp
// @grant		GM_addStyle
// @grant		GM_deleteValue
// @grant		GM_getValue
// @grant		GM_listValues
// @grant		GM_log
// @grant		GM_setValue
// @grant		GM_xmlhttpRequest
// @grant		GM_getResourceURL
// @require		http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js

// @resource old_village						http://w2.3gokushi.jp/20120525-01/extend_project/w760/img/common/village_bg.jpg
// @resource Spring_village 					http://w2.3gokushi.jp/20120525-01/extend_project/w760/img/common/village_bg_spring.jpg
// @resource Summer_village 					http://w2.3gokushi.jp/20120525-01/extend_project/w760/img/common/village_bg_summer.jpg
// @resource Autumn_village 					http://w2.3gokushi.jp/20120525-01/extend_project/w760/img/common/village_bg_autumn.jpg
// @resource Winter_village 					http://w2.3gokushi.jp/20120525-01/extend_project/w760/img/common/village_bg_winter.jpg

// @resource old_map							http://w2.3gokushi.jp/20120525-01/extend_project/w760/img/common/map_bg.gif
// @resource Spring_map 						http://w2.3gokushi.jp/20120525-01/extend_project/w760/img/common/map_bg_spring.gif
// @resource Summer_map 						http://w2.3gokushi.jp/20120525-01/extend_project/w760/img/common/map_bg_summer.gif
// @resource Autumn_map 						http://w2.3gokushi.jp/20120525-01/extend_project/w760/img/common/map_bg_autumn.gif
// @resource Winter_map 						http://w2.3gokushi.jp/20120525-01/extend_project/w760/img/common/map_bg_winter.gif

// ==/UserScript==
//
// ver3.00 2014.01.31 最適化開始 - 2014.03.08 各種ツールをマージ。多数のロジック修正及び、既存バグ、挙動不審な処理を修正。
//		   2014.03.08 コメントが処理速度に影響しているため、各スクリプト書き出しのコメントを整理
//		   2014.10.11 FireFox32+GreaseMonkey2.2対応
//		   2014.10.13 オート小麗、オート大鳳追加。その他微修正
// ver3.01 2014.10.13 兵士誤発注防止で入力枠が勝手に開く問題を修正
// ver3.02 2014.10.13 出兵時の兵器ダメージ計算が動かない問題を修正
// ver3.03 2014.10.13 新着があるときにロールオーバーが消える問題を修正
// ver3.04 2014.10.15 出兵時に拠点ダメージが正しく表示されない問題を修正
// ver3.05 2014.10.16 拠点ダメージ計算にスキル兵器突覇、攻城戦の極砕を追加
// ver3.06 2014.10.17 オートチュートリアルを廃止。拠点ダメージ計算で皇叔の号令、苦肉の計が正しく計算されていなかった不具合を修正(etcs不具合)。誤生産防止のスキルカラーを変更。
// ver3.07 2014.10.18 皇龍ダスが増えた関係でオート大鳳、オート小麗の枚数が正しくとれなくなった不具合を修正。領地管理画面で所要時間ポップアップが点滅する問題に一次対応。
// ver3.08 2014.10.18 マップ入力改善が機能しない問題修正
// ver3.09 2014.10.18 恋姫、光栄イラスト置き換え機能を使っている状態で、イラストが存在しないページを開くと真っ白なページに飛ぶ不具合を修正
// ver3.10 2014.10.18 光栄イラストで曹真の小サイズ画像がでない問題を修正。領地管理画面に「一括領地破棄」タブを追加。
// ver3.11 2014.10.19 拠点情報が取れない時（保存していない拠点でオートビルダーが動いた時）、オートビルダーがループする不具合を修正し、止まるようにした。
// ver3.12 2014.10.19 拠点化予約機能を追加。予約された土地確保後かつ必要名声が足りていれば最長5分で建設が開始されます。
// ver3.13 2014.10.20 拠点化予約時に動かないツールがある問題を修正。光栄リストを最新化。
// ver3.14 2014.10.21 騎兵の強攻の合成スキルがでない問題を修正。領地が21以上あるときに領地一括破棄ボタンがページ切り替えの中に出現する問題を修正。
// ver3.15 2014.10.22 右クリックの合成スキル表示が出ない問題を修正。JST表示のチェックが外れていてもJSTが消えない問題を修正。SR牛輔の合成スキルが表示されない問題を修正。
//					  歴史書モードでオートビルダーが止まらない問題修正。10/22メンテで領地リンクのアイコンが折り返す問題を修正。
// ver3.16 2014.10.25 自動ブショーダスの破棄対象からUC張梁、UC姜維、UC司馬懿を除外。10/22メンテ以降beyondのサイドバーで表示が崩れる問題を修正。
// ver3.19 2014.11.15 ログイン画面のサーバ名が４列表示になるように修正。ワールド表示位置を修正。光栄、恋姫カードのイラスト表示を回復。
// ver3.20 2014.11.15 atk_calcを最新化
// ver3.21 2014.11.16 一括破棄画面から保護解除、出品をできるようにした
// ver3.22 2014.11.17 一括破棄画面から保護をできるようにした
// ver3.23 2014.11.17 一括破棄画面拡張を高速化
// ver3.24 2014.11.20 合成画面で素材ページが「カード表示」以外のとき、「保護されています」画像をクリックすることで保護解除できる機能を追加。
// ver3.25 2014.11.21 素材カード追加画面でも保護解除できるようにした
// ver3.26 2014.11.22 一括破棄画面拡張に即時落札価格表示機能を追加。
// ver3.28 2014.11.26 UR/SRレアリティ背景設定時に兵科アイコンが化ける問題を修正。
// ver3.29 2014.11.28 メンテで機能しなくなった建設/破棄リストを復活
// ver3.31 2014.12.06 メンテで機能しなくなった領地画面からの領地リンク、拠点予約、領地名変更を復活。領地一覧からの破棄、破棄中止の確認メッセージを排除。
// ver3.32 2014.12.08 スタイル変更を外した際に画面が切れないように修正
// ver3.33 2014.12.10 Lカードの背景選択を追加
// ver3.34 2014.12.13 デッキセットを運営メンテ前の仕様に復元
// ver3.35 2014.12.13 トレード検索改善の機能回復、討伐ゲージ回復予測削除（運営実装）、書簡一覧ページのレイアウト崩れを修正
// ver3.36 2014.12.14 自動仁君、自動内政の機能回復
// ver3.37 2014.12.16 デッキ設定時に「すべて」タブに移動してしまう不具合を修正
// ver3.38 2014.12.17 カードリスト上でのトレードジャンプが正常に機能しなかった不具合を修正。
// ver3.39 2014.12.21 一括デッキセットを作り直し。小、大ともにセット可能にした。
// ver3.40 2014.12.22 自動仁君の内政官おろしの挙動がおかしい問題を修正。
// ver3.41 2014.12.22 favorite tradeの入札周りが動かない問題を修正。
// ver3.42 2014.12.23 favorite tradeのデッキからの待機武将を下ろす機能を一括デッキセットから分離。軍極セットのチェックに影響を受けないようにした。
// ver3.43 2014.12.24 出品画面、武将図鑑、ブショーダスの落札価格検索を全面書き直し。過去の遺物だったカードコレクション補助を削除。
// ver3.44 2014.12.25 bro3_miscでトレードの表示非表示維持指定時に、レアリティLと公開期限が保持されない不具合を修正。
//					  favorite tadeでのトレード画面の検索、落札機能を再構築、高速化。お気に入りページを削除し、トレード画面にボタン化。
// ver3.45 2014.12.25 メンテで機能しなくなった自動ブショーダスを動くように修正。
// ver3.46 2014.12.25 bro3_dasuで合成画面でスキルが二重表示される問題、デッキでスキルがずれて表示される問題を暫定修正。
// ver3.47 2014.12.26 bro3_dasuの内政スキル等の表示を修正。
// ver3.48 2014.12.26 bro3_dasuの合成スキル表示、パラメータ付与画面でのスキル表示を復活（小カードも対応）。
// ver3.49 2014.12.26 bro3_dasuのブショーダス破棄チェック、一括カード破棄チェックの機能復活。10連ブショーダスで合成スキルが見えるように修正。
//					  クエスト補助の小麗、大鳳画像が404になっている問題を修正。
// ver3.50 2014.12.27 １枚引きのブショーダスから出品できなくなった問題を修正（メンテ影響？）。
// ver3.51 2014.12.27 自動ブショーダスの結果が画面に表示されなくなったバグを修正。
// ver3.52 2014.12.31 favorite tradeのお気に入り検索にLカードを設定できるように修正
// ver3.53 2015.01.01 拠点予約リストが建設後に消えないことがある問題を修正
// ver3.54 2015.01.04 合成スキルなし、UR極攻劉備のときに枠がずれる問題を修正
// ver3.55 2015.01.05 一括デッキセットに低コスト順を追加
// ver3.56 2015.01.06 デッキ周り修正
// ver3.57 2015.01.06 出兵予約拡張がFireFox32+GM2.2で動かない問題を修正
// ver3.58 2015.01.06 出品中カードがない場合に領地リンクが崩れる問題を修正
// ver3.59 2015.01.07 武将図鑑検索結果にコスト表示を追加
// ver3.60 2015.01.10 合成時のスキル確率アップ素材のスキルを表示する
// ver3.61 2015.01.24 maptoolがFireFox35で動かなくなった問題修正
// ver3.62 2015.01.25 自動スキルアップを追加
// ver3.63 2015.01.25 自動スキルアップを大カードに対応。
// ver3.64 2015.01.26 自動スキルアップで上限レベルを指定できるように修正
// ver3.66 2015.01.30 イラスト置き換え機能を全削除
// ver3.67 2015.01.31 トレード検索まわりをメンテ対応
// ver3.68 2015.02.01 覇の出品のときに合成スキル枠がずれる問題を修正
// ver3.69 2015.03.21 資源充足タイマーアイコンを右に移動
// ver3.0.74α   2015.11.11 http://www45.atwiki.jp/hasekun/pages/19.html
// ver3.0.74α+1 2016.10.22 上記本家サイトからＤＬできないとのことで勝手に再配布開始。問題あればご連絡ください。
//							仁君君の城壁補強実装誤りを修正、セキュリティー警告対策
(function($) {

  $(".cardStatusDetail:contains('仁君LV')").each(function(){
	if($(this).find(".set_release").length){
	  if(!$(this).find("tr:contains('仁君LV')").hasClass("used")){
		$(this).find("td:contains('仁君LV')")
		  .css("color","blue")
		  .css("cursor","pointer")
		  .click(function(){
			if(confirm($(this).text()+"を使用しますか？")){
			  var cid = $(this).parents(".statusDetail").find(".thickbox").attr("href").match(/\d+/g)[2];
			  var vid = $(".attention_detail").find("option").eq($("li:has('.map-basing')").index($("li.on"))).val();
			  var sid = "sd000"+($(this).text().match(/\d+/)[0]-1);
			  $(this).addClass("jinDisp").text("拠点確認中");
			  $.get("/card/domestic_setting.php",function(a){
				if(a.replace(/rowspan="\d"/g,"").replace(/\s/g,"").match("<td>内政中</td>")){
				  alert("内政中の武将が居ます\n拠点を変更してください")
				}else{
				  var b = {mode:"set",target_card:cid,ssid:$("#ssid").val()};
				  b["selected_village["+cid+"]"] = vid;
				  $(".jinDisp").text("拠点セット中");
				  $.post("/card/deck.php",b,function(){
					  $(".jinDisp").text("内政セット中");
					  $.get("/card/domestic_setting.php?id="+cid+"&mode=domestic",function(){
						$(".jinDisp").text("発動中");
						$.get("/card/domestic_setting.php?mode=skill&id="+cid+"&sid="+sid,function(){
						  $(".jinDisp").text("内政解除中");
						  $.get("/card/domestic_setting.php?mode=u_domestic&id="+cid,function(){
							$(".jinDisp").text("拠点解除中");
							$.post("/card/deck.php",{mode:"unset",target_card:cid,ssid:$("#ssid").val()},function(){
							  $(".jinDisp").text("ページ更新中");
							  location.reload();
							});
						  });
						});
					  });
				  });
				}
			  });
			}
		});
	  }
	}
  });
  $(".cardStatusDetail:contains('神医の術式LV')").each(function(){
	if($(this).find(".set_release").length){
	  if(!$(this).find("tr:contains('神医の術式LV')").hasClass("used")){
		$(this).find("td:contains('神医の術式LV')")
		  .css("color","blue")
		  .css("cursor","pointer")
		  .click(function(){
			if(confirm($(this).text()+"を使用しますか？")){
			  var cid = $(this).parents(".statusDetail").find(".thickbox").attr("href").match(/\d+/g)[2];
			  var vid = $(".attention_detail").find("option").eq($("li:has('.map-basing')").index($("li.on"))).val();
			  var sid = "sd003"+($(this).text().match(/\d+/)[0]-1);
			  $(this).addClass("jinDisp").text("拠点確認中");
			  $.get("/card/domestic_setting.php",function(a){
				if(a.replace(/rowspan="\d"/g,"").replace(/\s/g,"").match("<td>内政中</td>")){
				  alert("内政中の武将が居ます\n拠点を変更してください")
				}else{
				  var b = {mode:"set",target_card:cid,ssid:$("#ssid").val()};
				  b["selected_village["+cid+"]"] = vid;
				  $(".jinDisp").text("拠点セット中");
				  $.post("/card/deck.php",b,function(){
					  $(".jinDisp").text("内政セット中");
					  $.get("/card/domestic_setting.php?id="+cid+"&mode=domestic",function(){
						$(".jinDisp").text("発動中");
						$.get("/card/domestic_setting.php?mode=skill&id="+cid+"&sid="+sid,function(){
						  $(".jinDisp").text("内政解除中");
						  $.get("/card/domestic_setting.php?mode=u_domestic&id="+cid,function(){
							$(".jinDisp").text("拠点解除中");
							$.post("/card/deck.php",{mode:"unset",target_card:cid,ssid:$("#ssid").val()},function(){
							  $(".jinDisp").text("ページ更新中");
							  location.reload();
							});
						  });
						});
					  });
				  });
				}
			  });
			}
		});
	  }
	}
  });
  $(".cardStatusDetail:contains('傾国LV')").each(function(){
	if($(this).find(".set_release").length){
	  if(!$(this).find("tr:contains('傾国LV')").hasClass("used")){
		$(this).find("td:contains('傾国LV')")
		  .css("color","blue")
		  .css("cursor","pointer")
		  .click(function(){
			if(confirm($(this).text()+"を使用しますか？")){
			  var cid = $(this).parents(".statusDetail").find(".thickbox").attr("href").match(/\d+/g)[2];
			  var vid = $(".attention_detail").find("option").eq($("li:has('.map-basing')").index($("li.on"))).val();
			  var sid = "sd004"+($(this).text().match(/\d+/)[0]-1);
			  $(this).addClass("jinDisp").text("拠点確認中");
			  $.get("/card/domestic_setting.php",function(a){
				if(a.replace(/rowspan="\d"/g,"").replace(/\s/g,"").match("<td>内政中</td>")){
				  alert("内政中の武将が居ます\n拠点を変更してください")
				}else{
				  var b = {mode:"set",target_card:cid,ssid:$("#ssid").val()};
				  b["selected_village["+cid+"]"] = vid;
				  $(".jinDisp").text("拠点セット中");
				  $.post("/card/deck.php",b,function(){
					  $(".jinDisp").text("内政セット中");
					  $.get("/card/domestic_setting.php?id="+cid+"&mode=domestic",function(){
						$(".jinDisp").text("発動中");
						$.get("/card/domestic_setting.php?mode=skill&id="+cid+"&sid="+sid,function(){
						  $(".jinDisp").text("内政解除中");
						  $.get("/card/domestic_setting.php?mode=u_domestic&id="+cid,function(){
							$(".jinDisp").text("拠点解除中");
							$.post("/card/deck.php",{mode:"unset",target_card:cid,ssid:$("#ssid").val()},function(){
							  $(".jinDisp").text("ページ更新中");
							  location.reload();
							});
						  });
						});
					  });
				  });
				}
			  });
			}
		});
	  }
	}
  });
  $(".cardStatusDetail:contains('弓腰姫の愛LV')").each(function(){
	if($(this).find(".set_release").length){
	  if(!$(this).find("tr:contains('弓腰姫の愛LV')").hasClass("used")){
		$(this).find("td:contains('弓腰姫の愛LV')")
		  .css("color","blue")
		  .css("cursor","pointer")
		  .click(function(){
			if(confirm($(this).text()+"を使用しますか？")){
			  var cid = $(this).parents(".statusDetail").find(".thickbox").attr("href").match(/\d+/g)[2];
			  var vid = $(".attention_detail").find("option").eq($("li:has('.map-basing')").index($("li.on"))).val();
			  var sid = "sd001"+($(this).text().match(/\d+/)[0]-1);
			  $(this).addClass("jinDisp").text("拠点確認中");
			  $.get("/card/domestic_setting.php",function(a){
				if(a.replace(/rowspan="\d"/g,"").replace(/\s/g,"").match("<td>内政中</td>")){
				  alert("内政中の武将が居ます\n拠点を変更してください")
				}else{
				  var b = {mode:"set",target_card:cid,ssid:$("#ssid").val()};
				  b["selected_village["+cid+"]"] = vid;
				  $(".jinDisp").text("拠点セット中");
				  $.post("/card/deck.php",b,function(){
					  $(".jinDisp").text("内政セット中");
					  $.get("/card/domestic_setting.php?id="+cid+"&mode=domestic",function(){
						$(".jinDisp").text("発動中");
						$.get("/card/domestic_setting.php?mode=skill&id="+cid+"&sid="+sid,function(){
						  $(".jinDisp").text("内政解除中");
						  $.get("/card/domestic_setting.php?mode=u_domestic&id="+cid,function(){
							$(".jinDisp").text("拠点解除中");
							$.post("/card/deck.php",{mode:"unset",target_card:cid,ssid:$("#ssid").val()},function(){
							  $(".jinDisp").text("ページ更新中");
							  location.reload();
							});
						  });
						});
					  });
				  });
				}
			  });
			}
		});
	  }
	}
  });
  $(".cardStatusDetail:contains('皇后の慈愛LV')").each(function(){
	if($(this).find(".set_release").length){
	  if(!$(this).find("tr:contains('皇后の慈愛LV')").hasClass("used")){
		$(this).find("td:contains('皇后の慈愛LV')")
		  .css("color","blue")
		  .css("cursor","pointer")
		  .click(function(){
			if(confirm($(this).text()+"を使用しますか？")){
			  var cid = $(this).parents(".statusDetail").find(".thickbox").attr("href").match(/\d+/g)[2];
			  var vid = $(".attention_detail").find("option").eq($("li:has('.map-basing')").index($("li.on"))).val();
			  var sid = "sd012"+($(this).text().match(/\d+/)[0]-1);
			  $(this).addClass("jinDisp").text("拠点確認中");
			  $.get("/card/domestic_setting.php",function(a){
				if(a.replace(/rowspan="\d"/g,"").replace(/\s/g,"").match("<td>内政中</td>")){
				  alert("内政中の武将が居ます\n拠点を変更してください")
				}else{
				  var b = {mode:"set",target_card:cid,ssid:$("#ssid").val()};
				  b["selected_village["+cid+"]"] = vid;
				  $(".jinDisp").text("拠点セット中");
				  $.post("/card/deck.php",b,function(){
					  $(".jinDisp").text("内政セット中");
					  $.get("/card/domestic_setting.php?id="+cid+"&mode=domestic",function(){
						$(".jinDisp").text("発動中");
						$.get("/card/domestic_setting.php?mode=skill&id="+cid+"&sid="+sid,function(){
						  $(".jinDisp").text("内政解除中");
						  $.get("/card/domestic_setting.php?mode=u_domestic&id="+cid,function(){
							$(".jinDisp").text("拠点解除中");
							$.post("/card/deck.php",{mode:"unset",target_card:cid,ssid:$("#ssid").val()},function(){
							  $(".jinDisp").text("ページ更新中");
							  location.reload();
							});
						  });
						});
					  });
				  });
				}
			  });
			}
		});
	  }
	}
  });
  $(".cardStatusDetail:contains('神医の施術LV')").each(function(){
	if($(this).find(".set_release").length){
	  if(!$(this).find("tr:contains('神医の施術LV')").hasClass("used")){
		$(this).find("td:contains('神医の施術LV')")
		  .css("color","blue")
		  .css("cursor","pointer")
		  .click(function(){
			if(confirm($(this).text()+"を使用しますか？")){
			  var cid = $(this).parents(".statusDetail").find(".thickbox").attr("href").match(/\d+/g)[2];
			  var vid = $(".attention_detail").find("option").eq($("li:has('.map-basing')").index($("li.on"))).val();
			  var sid = "sd013"+($(this).text().match(/\d+/)[0]-1);
			  $(this).addClass("jinDisp").text("拠点確認中");
			  $.get("/card/domestic_setting.php",function(a){
				if(a.replace(/rowspan="\d"/g,"").replace(/\s/g,"").match("<td>内政中</td>")){
				  alert("内政中の武将が居ます\n拠点を変更してください")
				}else{
				  var b = {mode:"set",target_card:cid,ssid:$("#ssid").val()};
				  b["selected_village["+cid+"]"] = vid;
				  $(".jinDisp").text("拠点セット中");
				  $.post("/card/deck.php",b,function(){
					  $(".jinDisp").text("内政セット中");
					  $.get("/card/domestic_setting.php?id="+cid+"&mode=domestic",function(){
						$(".jinDisp").text("発動中");
						$.get("/card/domestic_setting.php?mode=skill&id="+cid+"&sid="+sid,function(){
						  $(".jinDisp").text("内政解除中");
						  $.get("/card/domestic_setting.php?mode=u_domestic&id="+cid,function(){
							$(".jinDisp").text("拠点解除中");
							$.post("/card/deck.php",{mode:"unset",target_card:cid,ssid:$("#ssid").val()},function(){
							  $(".jinDisp").text("ページ更新中");
							  location.reload();
							});
						  });
						});
					  });
				  });
				}
			  });
			}
		});
	  }
	}
  });
  $(".cardStatusDetail:contains('桃色吐息LV')").each(function(){
	if($(this).find(".set_release").length){
	  if(!$(this).find("tr:contains('桃色吐息LV')").hasClass("used")){
		$(this).find("td:contains('桃色吐息LV')")
		  .css("color","blue")
		  .css("cursor","pointer")
		  .click(function(){
			if(confirm($(this).text()+"を使用しますか？")){
			  var cid = $(this).parents(".statusDetail").find(".thickbox").attr("href").match(/\d+/g)[2];
			  var vid = $(".attention_detail").find("option").eq($("li:has('.map-basing')").index($("li.on"))).val();
			  var sid = "sd017"+($(this).text().match(/\d+/)[0]-1);
			  $(this).addClass("jinDisp").text("拠点確認中");
			  $.get("/card/domestic_setting.php",function(a){
				if(a.replace(/rowspan="\d"/g,"").replace(/\s/g,"").match("<td>内政中</td>")){
				  alert("内政中の武将が居ます\n拠点を変更してください")
				}else{
				  var b = {mode:"set",target_card:cid,ssid:$("#ssid").val()};
				  b["selected_village["+cid+"]"] = vid;
				  $(".jinDisp").text("拠点セット中");
				  $.post("/card/deck.php",b,function(){
					  $(".jinDisp").text("内政セット中");
					  $.get("/card/domestic_setting.php?id="+cid+"&mode=domestic",function(){
						$(".jinDisp").text("発動中");
						$.get("/card/domestic_setting.php?mode=skill&id="+cid+"&sid="+sid,function(){
						  $(".jinDisp").text("内政解除中");
						  $.get("/card/domestic_setting.php?mode=u_domestic&id="+cid,function(){
							$(".jinDisp").text("拠点解除中");
							$.post("/card/deck.php",{mode:"unset",target_card:cid,ssid:$("#ssid").val()},function(){
							  $(".jinDisp").text("ページ更新中");
							  location.reload();
							});
						  });
						});
					  });
				  });
				}
			  });
			}
		});
	  }
	}
  });
  $(".cardStatusDetail:contains('城壁補強LV')").each(function(){
	if($(this).find(".set_release").length){
	  if(!$(this).find("tr:contains('城壁補強LV')").hasClass("used")){
		$(this).find("td:contains('城壁補強LV')")
		  .css("color","blue")
		  .css("cursor","pointer")
		  .click(function(){
			if(confirm($(this).text()+"を使用しますか？")){
			  var cid = $(this).parents(".statusDetail").find(".thickbox").attr("href").match(/\d+/g)[2];
			  var vid = $(".attention_detail").find("option").eq($("li:has('.map-basing')").index($("li.on"))).val();
			  var sid = "sd005"+($(this).text().match(/\d+/)[0]-1);
			  $(this).addClass("jinDisp").text("拠点確認中");
			  $.get("/card/domestic_setting.php",function(a){
				if(a.replace(/rowspan="\d"/g,"").replace(/\s/g,"").match("<td>内政中</td>")){
				  alert("内政中の武将が居ます\n拠点を変更してください")
				}else{
				  var b = {mode:"set",target_card:cid,ssid:$("#ssid").val()};
				  b["selected_village["+cid+"]"] = vid;
				  $(".jinDisp").text("拠点セット中");
				  $.post("/card/deck.php",b,function(){
					  $(".jinDisp").text("内政セット中");
					  $.get("/card/domestic_setting.php?id="+cid+"&mode=domestic",function(){
						$(".jinDisp").text("発動中");
						$.get("/card/domestic_setting.php?mode=skill&id="+cid+"&sid="+sid,function(){
						  $(".jinDisp").text("内政解除中");
						  $.get("/card/domestic_setting.php?mode=u_domestic&id="+cid,function(){
							$(".jinDisp").text("拠点解除中");
							$.post("/card/deck.php",{mode:"unset",target_card:cid,ssid:$("#ssid").val()},function(){
							  $(".jinDisp").text("ページ更新中");
							  location.reload();
							});
						  });
						});
					  });
				  });
				}
			  });
			}
		});
	  }
	}
  });
  $(".cardStatusDetail:contains('勇姫督励LV')").each(function(){
	if($(this).find(".set_release").length){
	  if(!$(this).find("tr:contains('勇姫督励LV')").hasClass("used")){
		$(this).find("td:contains('勇姫督励LV')")
		  .css("color","blue")
		  .css("cursor","pointer")
		  .click(function(){
			if(confirm($(this).text()+"を使用しますか？")){
			  var cid = $(this).parents(".statusDetail").find(".thickbox").attr("href").match(/\d+/g)[2];
			  var vid = $(".attention_detail").find("option").eq($("li:has('.map-basing')").index($("li.on"))).val();
			  var sid = "sd018"+($(this).text().match(/\d+/)[0]-1);
			  $(this).addClass("jinDisp").text("拠点確認中");
			  $.get("/card/domestic_setting.php",function(a){
				if(a.replace(/rowspan="\d"/g,"").replace(/\s/g,"").match("<td>内政中</td>")){
				  alert("内政中の武将が居ます\n拠点を変更してください")
				}else{
				  var b = {mode:"set",target_card:cid,ssid:$("#ssid").val()};
				  b["selected_village["+cid+"]"] = vid;
				  $(".jinDisp").text("拠点セット中");
				  $.post("/card/deck.php",b,function(){
					  $(".jinDisp").text("内政セット中");
					  $.get("/card/domestic_setting.php?id="+cid+"&mode=domestic",function(){
						$(".jinDisp").text("発動中");
						$.get("/card/domestic_setting.php?mode=skill&id="+cid+"&sid="+sid,function(){
						  $(".jinDisp").text("内政解除中");
						  $.get("/card/domestic_setting.php?mode=u_domestic&id="+cid,function(){
							$(".jinDisp").text("拠点解除中");
							$.post("/card/deck.php",{mode:"unset",target_card:cid,ssid:$("#ssid").val()},function(){
							  $(".jinDisp").text("ページ更新中");
							  location.reload();
							});
						  });
						});
					  });
				  });
				}
			  });
			}
		});
	  }
	}
  });
  $(".cardStatusDetail:contains('優雅な調べLV')").each(function(){
	if($(this).find(".set_release").length){
	  if(!$(this).find("tr:contains('優雅な調べLV')").hasClass("used")){
		$(this).find("td:contains('優雅な調べLV')")
		  .css("color","blue")
		  .css("cursor","pointer")
		  .click(function(){
			if(confirm($(this).text()+"を使用しますか？")){
			  var cid = $(this).parents(".statusDetail").find(".thickbox").attr("href").match(/\d+/g)[2];
			  var vid = $(".attention_detail").find("option").eq($("li:has('.map-basing')").index($("li.on"))).val();
			  var sid = "sd011"+($(this).text().match(/\d+/)[0]-1);
			  $(this).addClass("jinDisp").text("拠点確認中");
			  $.get("/card/domestic_setting.php",function(a){
				if(a.replace(/rowspan="\d"/g,"").replace(/\s/g,"").match("<td>内政中</td>")){
				  alert("内政中の武将が居ます\n拠点を変更してください")
				}else{
				  var b = {mode:"set",target_card:cid,ssid:$("#ssid").val()};
				  b["selected_village["+cid+"]"] = vid;
				  $(".jinDisp").text("拠点セット中");
				  $.post("/card/deck.php",b,function(){
					  $(".jinDisp").text("内政セット中");
					  $.get("/card/domestic_setting.php?id="+cid+"&mode=domestic",function(){
						$(".jinDisp").text("発動中");
						$.get("/card/domestic_setting.php?mode=skill&id="+cid+"&sid="+sid,function(){
						  $(".jinDisp").text("内政解除中");
						  $.get("/card/domestic_setting.php?mode=u_domestic&id="+cid,function(){
							$(".jinDisp").text("拠点解除中");
							$.post("/card/deck.php",{mode:"unset",target_card:cid,ssid:$("#ssid").val()},function(){
							  $(".jinDisp").text("ページ更新中");
							  location.reload();
							});
						  });
						});
					  });
				  });
				}
			  });
			}
		});
	  }
	}
  });
  $(".cardStatusDetail:contains('劉備の契りLV')").each(function(){
	if($(this).find(".set_release").length){
	  if(!$(this).find("tr:contains('劉備の契りLV')").hasClass("used")){
		$(this).find("td:contains('劉備の契りLV')")
		  .css("color","blue")
		  .css("cursor","pointer")
		  .click(function(){
			if(confirm($(this).text()+"を使用しますか？")){
			  var cid = $(this).parents(".statusDetail").find(".thickbox").attr("href").match(/\d+/g)[2];
			  var vid = $(".attention_detail").find("option").eq($("li:has('.map-basing')").index($("li.on"))).val();
			  var sid = "sd022"+($(this).text().match(/\d+/)[0]-1);
			  $(this).addClass("jinDisp").text("拠点確認中");
			  $.get("/card/domestic_setting.php",function(a){
				if(a.replace(/rowspan="\d"/g,"").replace(/\s/g,"").match("<td>内政中</td>")){
				  alert("内政中の武将が居ます\n拠点を変更してください")
				}else{
				  var b = {mode:"set",target_card:cid,ssid:$("#ssid").val()};
				  b["selected_village["+cid+"]"] = vid;
				  $(".jinDisp").text("拠点セット中");
				  $.post("/card/deck.php",b,function(){
					  $(".jinDisp").text("内政セット中");
					  $.get("/card/domestic_setting.php?id="+cid+"&mode=domestic",function(){
						$(".jinDisp").text("発動中");
						$.get("/card/domestic_setting.php?mode=skill&id="+cid+"&sid="+sid,function(){
						  $(".jinDisp").text("内政解除中");
						  $.get("/card/domestic_setting.php?mode=u_domestic&id="+cid,function(){
							$(".jinDisp").text("拠点解除中");
							$.post("/card/deck.php",{mode:"unset",target_card:cid,ssid:$("#ssid").val()},function(){
							  $(".jinDisp").text("ページ更新中");
							  location.reload();
							});
						  });
						});
					  });
				  });
				}
			  });
			}
		});
	  }
	}
  });
  $(".cardStatusDetail:contains('酔吟吐息LV')").each(function(){
	if($(this).find(".set_release").length){
	  if(!$(this).find("tr:contains('酔吟吐息LV')").hasClass("used")){
		$(this).find("td:contains('酔吟吐息LV')")
		  .css("color","blue")
		  .css("cursor","pointer")
		  .click(function(){
			if(confirm($(this).text()+"を使用しますか？")){
			  var cid = $(this).parents(".statusDetail").find(".thickbox").attr("href").match(/\d+/g)[2];
			  var vid = $(".attention_detail").find("option").eq($("li:has('.map-basing')").index($("li.on"))).val();
			  var sid = "sd026"+($(this).text().match(/\d+/)[0]-1);
			  $(this).addClass("jinDisp").text("拠点確認中");
			  $.get("/card/domestic_setting.php",function(a){
				if(a.replace(/rowspan="\d"/g,"").replace(/\s/g,"").match("<td>内政中</td>")){
				  alert("内政中の武将が居ます\n拠点を変更してください")
				}else{
				  var b = {mode:"set",target_card:cid,ssid:$("#ssid").val()};
				  b["selected_village["+cid+"]"] = vid;
				  $(".jinDisp").text("拠点セット中");
				  $.post("/card/deck.php",b,function(){
					  $(".jinDisp").text("内政セット中");
					  $.get("/card/domestic_setting.php?id="+cid+"&mode=domestic",function(){
						$(".jinDisp").text("発動中");
						$.get("/card/domestic_setting.php?mode=skill&id="+cid+"&sid="+sid,function(){
						  $(".jinDisp").text("内政解除中");
						  $.get("/card/domestic_setting.php?mode=u_domestic&id="+cid,function(){
							$(".jinDisp").text("拠点解除中");
							$.post("/card/deck.php",{mode:"unset",target_card:cid,ssid:$("#ssid").val()},function(){
							  $(".jinDisp").text("ページ更新中");
							  location.reload();
							});
						  });
						});
					  });
				  });
				}
			  });
			}
		});
	  }
	}
  });
})(jQuery);
//================================================
// 定数宣言一式
//================================================
var DEBUG_MESSAGE=0;//debug時のメッセージ出力用(1:on 0:OFF)

var OPT_TRADESTATUS = 0;	//34."トレードステータス表示"

// マップツール
var VERSION_1 = "2.39.d4ex3";
var LOCAL_STORAGE_1 = "bro3_map_tool";

var RADIUS = 25;			//半径（中域）
var RADIUS_L = 125;			//半径（広域）
var CELL_SIZE_M = 14;		//中域地図の1マスサイズ(px)
var CELL_SIZE_L = 3;		//広域地図の1マスサイズ(px)
var FONT_SIZE = "10px";		//中域地図のマス内文字サイズ
var HI_POWER = 4;			//高☆領地基準
var HI_POPUL = 600;			//高人口拠点基準
var MAX_XY = 700;			//座標絶対値最大
var DELIMIT_1 = "#$%";
var DELIMIT2_1 = "&?@";
var NPC_ALLY = "-";

var CHECK_TIME = 500;		//bro3_mixi_iframeheigt_resize
var IDX_VILLAGE_NAME = 0;	//地名
var IDX_USER_NAME = 1;		//君主名
var IDX_POPULATION = 2;		//人口
var IDX_ALLIANCER = 3;		//同盟名
var IDX_POWER = 4;			//戦力
var IDX_WOOD = 5;			//森
var IDX_STONE = 6;			//岩
var IDX_IRON = 7;			//鉄
var IDX_RICE = 8;			//穀
var IDX_NPC_FLG = 9;		//NPCフラグ
var IDX_TIME_BEFORE = 10;
var IDX_USER_BEFORE = 11;
var IDX_ALLY_BEFORE = 12;
var IDX_LAST_UPDATE = 13;
var IDX_CAPITAL_FLG = 14;	//本拠地フラグ

var IDX_ALLY_PARENT = 0;	//親同盟
var IDX_ALLY_CHILDREN = 1;	//子同盟リスト
var IDX_ALLY_MEMBERS = 2;	//同盟員リスト

var IDX_USER_VILLAGES = 0;	//拠点リスト
var IDX_USER_ALLY = 1;		//所属同盟

var MAP_MODE_S = "";		//狭域地図
var MAP_MODE_M = "1";		//中域地図
var MAP_MODE_L = "2";		//広域地図

var INPUT_MODE_NAME = "1";	//名称
var INPUT_MODE_COLOR = "2";	//色

var USER_COLORS_DEF = new Array(
	"#0000a0", "#a00000", "#00a000", "#808000", "#008080","#505050", "#505050", "#505050", "#505050", "#505050",
	"#0000a0", "#a00000", "#00a000", "#808000", "#008080","#505050", "#505050", "#505050", "#505050", "#505050",
	"#0000a0", "#a00000", "#00a000", "#808000", "#008080","#505050", "#505050", "#505050", "#505050", "#505050"
	);
var ALLY_COLORS_DEF = new Array(
	"#a0a0ff", "#ffa0a0", "#a0ffa0", "#ffff80", "#80ffff","#ff80ff", "#40c0ff", "#ffc040", "#c0ff40", "#b0b0b0",
	"#a0a0ff", "#ffa0a0", "#a0ffa0", "#ffff80", "#80ffff","#ff80ff", "#40c0ff", "#ffc040", "#c0ff40", "#b0b0b0",
	"#a0a0ff", "#ffa0a0", "#a0ffa0", "#ffff80", "#80ffff","#ff80ff", "#40c0ff", "#ffc040", "#c0ff40", "#b0b0b0"
	);
var NPC_COLOR = "purple";
var ETC_COLOR = "lightgrey";

// スキル合成表
var gousei_skill = {
 '英雄':['騎兵の強撃','騎兵堅守','奇計百出','覇道'],
 '迅雷招来':['飛速雷光','守護神','深慮遠謀','飛速迅雷'],
 '製鉄知識':['製鉄知識','騎兵行軍','弓兵訓練','製鉄技術'],
 '石切知識':['石切知識','弓兵行軍','兵舎訓練','石切技術'],
 '弓兵の進撃':['弓兵の進撃','弓兵防御','弓兵行軍','弓兵の強撃'],
 '火神の攻勢':['石切知識','蛮族の襲撃','練兵訓練','兵器の強撃'],
 '蛮族の襲撃':['蛮族の襲撃','兵器訓練','製鉄知識','蛮王の襲撃'],
 '兵器の進撃':['兵器訓練','兵器防御','兵器行軍','兵器の強撃'],
 '弓兵堅守':['弓兵防御','弓兵の進撃','弓兵強行','弓兵方陣'],
 '伐採技巧':['豊穣','伐採技術','富国','市場繁栄'],
 '昭烈帝':['槍兵突覇','王者の護り','軍神','神算鬼謀'],
 '臥龍覚醒':['市場繁栄','八卦の陣','神算鬼謀','神医の術式'],
 '槍兵増強':['市場知識','一騎当千','槍兵増強','強兵の檄文'],
 '騎兵増強':['加工技術','強襲突撃','騎兵増強','軍神'],
 '急速援護':['千里行','弓兵強行','剣兵強行','練兵修練'],
 '弓兵強行':['弓兵強行','弓兵防御','弓兵の進撃','八卦の陣'],
 '槍将の采配':['槍兵突覇','市場知識','奇計百出','麒麟児'],
 '勇将天戟':['槍兵の極撃','槍兵の聖域','兵舎修練','覇王の進撃'],
 '蜀軍の防衛':['急速援護','槍兵の聖域','守護神','迅速援護'],
 '護国芳心':['剣兵の極撃','剣兵方陣','剛将の畏怖','神算鬼謀'],
 '武神':['一騎当千','槍兵の聖域','兵舎修練','軍神'],
 '槍兵の勝鬨':['槍兵の極撃','槍兵の聖域','槍兵突覇','槍将の采配'],
 '醒龍出師':['太平要術','八卦の陣','神算鬼謀','弓兵の勝鬨'],
 '千里行':['兵器強行','騎兵方陣','食糧技術','神速'],
 '胡王の猛襲':['蛮王の襲撃','兵器強行','覇道','強襲突覇'],
 '蜀将の督戦':['槍兵の極撃','槍兵の聖域','石切技術','神算鬼謀'],
 '勇美鼓舞':['一騎当千','守護神','富国','傾国'],
 '老将統帥':['隣地猛攻','守護神','弓兵増強','勇将飛矢'],
 '麒麟慈心':['万夫不当','槍兵の聖域','富国','槍兵の大極撃'],
 '恵風':['騎兵の極撃','騎兵の聖域','英雄','市場知識'],
 '矛槍兵移送':['強襲突覇','槍兵の聖域','兵舎修練','槍兵の極撃'],
 '連環の計':['深慮遠謀','城壁補強','槍兵増強','兵器の極撃'],
 '猛虎進撃':['槍兵突覇','八卦の陣','急速援護','槍兵の極撃'],
 '迅速劫略':['槍兵突覇','神速援護','千里行','猛将の鹵獲'],
 '発憤興起':['強襲速撃','槍兵方陣','鉄壁','槍兵増強'],
 '賢女の策略':['兵器の極撃','王者の護り','槍将の采配','智将器撃'],
 '勇猛果敢':['強襲突覇','守護防陣','加工技術','護君'],
 '槍兵急配':['強襲突撃','槍兵方陣','兵舎訓練','槍兵の猛撃'],
 '製鉄技術':['製鉄知識','騎兵強行','弓兵訓練','弓兵修練'],
 '仁君':['槍兵の強撃','兵舎修練','覇道','八卦の陣'],
 '槍兵の大号令':['麒麟慈心','呉の治世','槍兵の勝鬨','智将器撃'],
 '勇姫督励':['万夫不当','守護神','城壁補強','護君'],
 '胡王奮迅':['天弓雨撃','火神の攻勢','弓兵の聖域','奇襲'],
 '燕神破軍':['槍兵の大極撃','守護神','兵舎修練','燕人武陣'],
 '槍兵速攻':['槍兵突撃','槍兵強行','兵舎訓練','槍兵突覇'],
 '劉備の契り':['仁君','守護神','神算鬼謀','呉の治世'],
 '賢妃施政':['飛将','兵器修練','呉の治世','傾国'],
 '兵器の猛撃':['兵器の強撃','英雄','製鉄技術','兵器の極撃'],
 '三顧の礼':['強襲突覇','守護神','神算鬼謀','深慮遠謀'],
 '強襲烈覇':['強襲突覇','守護神','王者の護り','強兵の檄文'],
 '槍兵の大聖域':['槍兵の聖域','槍兵増強','槍兵強行','王者の護り'],
 '厩舎訓練':['厩舎訓練','騎兵防御','騎兵の進撃','厩舎修練'],
 '厩舎修練':['豪傑','騎兵方陣','騎兵の強撃','加工技術'],
 '天里雷光':['万里行','強襲突覇','密偵精鋭','万里雷光'],
 '勇将飛矢':['弓兵の極撃','弓兵の聖域','弓兵修練','覇王の進撃'],
 '歴戦の弓将':['弓兵の大極撃','弓将の采配','伐採技術','弓兵の大号令'],
 '勇躍の舞':['守護方陣','強兵の檄文','恵風','剣将の采配'],
 '燕人武陣':['槍兵の極撃','槍兵の聖域','槍将の采配','軍神'],
 '劉備の大徳':['昭烈帝','槍兵の聖域','神医の術式','醒龍出師'],
 '桃賊の襲撃':['趁火打劫','呉の治世','恵風','桃色吐息'],
 '騎神降臨':['万夫不当','騎兵方陣','騎兵突覇','騎兵の強攻'],
 '市場来福':['槍兵速攻','弓兵速攻','騎兵速攻','迅速劫略'],
 '蜀軍の極撃':['槍兵の極撃','富国','王者の護り','神算鬼謀'],
 '戦女の行軍':['強襲突覇','恵風','神速','急襲'],
 '衝車急配':['強襲突撃','剣兵方陣','兵器訓練','兵器の猛撃'],
 '飛速雷光':['烈速','剣兵の聖域','神算鬼謀','烈速雷光'],
 '飛速':['強襲突覇','太平要術','豊穣','猛将突貫'],
 '烈速':['強襲突撃','覇道','加工知識','闘将突貫'],
 '槍兵の大天撃':['槍兵の大神撃','護君','強兵の檄文','蜀軍の極撃'],
 '槍兵の大神域':['槍兵の大聖域','槍将の采配','神速','忠節不落'],
 '龍神の極意':['遠地猛攻','金剛不壊','神速援護','鬼神の極意'],
 '騎兵の大極攻':['騎兵の猛攻','騎兵の大聖域','騎兵増強','騎兵の極攻'],
 '騎将の封聖域':['騎兵の大極撃','守護堅陣','恵風','騎兵の大聖域'],
 '天里迅雷':['万里行','強襲突覇','密偵精鋭','万里雷光'],
 '謀反の極攻':['暴虐外道','王者の護り','神速援護','謀反の猛攻'],
 '護国誠心':['剣兵の大極撃','剣兵の聖域','太平要術','混元一気'],
 '攻城戦の大神砕':['兵器の大極撃','兵器の大号令','豊潤祈祷','兵器の大神撃'],
 '兵器の大神撃':['兵器の大極撃','金剛不壊','攻城の檄文','智将器撃'],
 '弓兵の大天域':['弓兵の大神域','強兵の檄文','烈速','覇者の護り'],
 '神隠雷光':['強襲速撃','堅牢知略','魏王の号令','覇王の進撃'],
 '機略謀略':['(不明)','(不明)','(不明)','(不明)'],
 '猛暑の縮地収穫':['一騎当千','守護神','迅速劫略','千里行'],
 '槍兵烈攻':['槍兵の大極撃','烈速','槍兵増強','槍兵突攻'],
 '守衛招来':['(不明)','(不明)','(不明)','(不明)'],
 '槍兵の大神撃':['槍兵の大極撃','金剛不壊','槍兵増強','昭烈帝'],
 '槍兵増勢':['槍兵速攻','槍兵方陣','神速','槍兵突攻'],
 '魏王の号令':['騎兵突覇','騎兵の聖域','厩舎修練','富国'],
 '王佐の才':['兵器修練','兵器の猛撃','呉の治世','傾国'],
 '兵器の強撃':['蛮族の襲撃','兵器防御','火神の攻勢','兵器の猛撃'],
 '魏武王':['騎兵突覇','城壁補強','豊穣','飛将'],
 '剣兵急配':['強襲突撃','剣兵方陣','練兵訓練','剣兵の猛撃'],
 '騎兵堅守':['騎兵防御','騎兵の進撃','騎兵強行','騎兵方陣'],
 '迅速援護':['強襲速撃','兵器強行','英雄','加工技術'],
 '騎将の采配':['騎兵突覇','城壁補強','奇計百出','市場繁栄'],
 '剣兵突覇':['剣兵突撃','練兵修練','神速','一騎当千'],
 '兵器の極撃':['兵器の猛撃','覇道','加工知識','深慮遠謀'],
 '守将の進軍':['兵舎訓練','加工知識','騎兵の聖域','槍兵の極撃'],
 '魏軍の防衛':['迅速援護','城壁補強','王者の護り','守将の進軍'],
 '美玉歌舞':['奇計百出','仁君','厩舎修練','王佐の才'],
 '皇后の慈愛':['覇王の進撃','傾国','富国','神医の術式'],
 '神算鬼謀':['兵器の極撃','八卦の陣','覇道 ','神医の術式'],
 '地の利堅壁':['兵器の猛撃','槍兵方陣','剣兵の聖域','王者の護り'],
 '出撃見舞':['覇王の進撃','守護神','千里行','神速'],
 '魏王の覇軍':['騎兵突覇','王者の護り','覇王の進撃','魏武王'],
 '忠節不落':['覇道','鉄壁','千里行','八卦の陣'],
 '豊穣':['弓兵の極撃','弓兵の聖域','呉の治世','富国'],
 '槍兵の大極撃':['槍兵の極撃','守護神','槍将の采配','槍戟鬼神'],
 '奇略布陣':['強襲突覇','加工技術','兵器の極撃','市場繁栄'],
 '天弓雨撃':['弓兵の極撃','千里行','覇道','弓将の采配'],
 '騎兵の強撃':['火神の攻勢','騎兵防御','騎兵行軍','騎兵の猛撃'],
 '槍兵方陣':['槍兵堅守','槍兵の強撃','槍兵強行','槍兵の聖域'],
 '神医の施術':['仁君','騎兵の聖域','加工技術','神医の術式'],
 '騎兵の勝鬨':['騎兵の極撃','騎兵の聖域','騎兵突覇','騎将の采配'],
 '魏将の督戦':['騎兵の極撃','騎兵の聖域','製鉄技術','軍神'],
 '近衛騎兵移送':['迅速援護','騎兵の聖域','厩舎修練','騎兵の極撃'],
 '猛将突貫':['万夫不当','守護神','騎兵突覇','軍神'],
 '才媛献策':['深慮遠謀','神速援護','富国','傾国'],
 '急襲':['一騎当千','守護神','千里行','強襲突撃'],
 '騎兵の極攻':['騎兵の猛撃','騎兵の聖域','厩舎修練','騎兵の猛攻'],
 '隻眼将の軍略':['騎兵の猛撃','神速','加工技術','飛将'],
 '守将の出陣':['槍兵方陣','守護神','八卦の陣','槍兵の聖域'],
 '守神の進撃':['守将の進撃','守護神','槍将の采配','槍兵の大極撃'],
 '騎兵の大号令':['神算鬼謀','王佐の才','騎兵の勝鬨','奇略布陣'],
 '才女の瞳':['騎兵突覇','鉄壁','覇道','闘将の極意'],
 '聡明叡知':['奇計百出','八卦の陣','神速','飛将'],
 '擒賊擒王':['槍兵突撃','八卦の陣','城壁補強','王者の護り'],
 '帝妃都政':['奇計百出','厩舎修練','製鉄技術','王佐の才'],
 '混元一気':['騎兵の極撃','王者の護り','騎将の采配','臥龍覚醒'],
 '鬼神':['武神','守護神','兵舎修練','神飛将'],
 '遠地猛攻':['万夫不当','覇道','攻城の檄文','隣地猛攻'],
 '才媛眼識':['深慮遠謀','傾国','神速援護','富国'],
 '堅忍不抜':['強襲突覇','守護防陣','加工技術','護君'],
 '刹那の奇襲':['急襲','千里行','厩舎訓練','弓兵の猛攻'],
 '騎兵急配':['強襲突撃','騎兵方陣','厩舎訓練','騎兵の猛撃'],
 '騎兵の大神撃':['騎兵の大極撃','金剛不壊','騎兵増強','魏武王'],
 '城壁補強':['万夫不当','八卦の陣','豊潤祈祷','猛将の鹵獲'],
 '悲嘆の舞':['騎兵の強撃','強兵の檄文','智将器撃','混元一気'],
 '麗妃都政':['闘将の極意','八卦の陣','覇道','猛将の極意'],
 '麒麟児':['槍兵の極撃','一騎当千','兵器の極撃','神算鬼謀'],
 '覇王の強攻':['覇王の強撃','守護神','神速','覇王の強攻'],
 '神速雷光':['神速','剣兵方陣','深慮遠謀','烈速'],
 '隣地攻城':['兵器の強撃','城壁補強','攻城の檄文','兵器突覇'],
 '魏軍の極撃':['騎兵の極撃','豊穣','騎兵の聖域','軍神'],
 '神速劫略':['発憤興起','神速','趁火打劫','迅速劫略'],
 '隣地豪襲':['万夫不当','謀反の進攻','攻城の檄文','闘将の極意'],
 '師君強兵':['剣将の采配','守護堅陣','神速援護','守護聖陣'],
 '騎兵の大聖域':['騎兵の聖域','騎兵増強','騎兵強行','王者の護り'],
 '洛神の舞':['護君','強兵の檄文','富国','槍将の采配'],
 '神医の術式':['八卦の陣','守護神','王佐の才','神算鬼謀'],
 '兵器の極攻':['兵器の猛撃','王者の護り','兵器修練','兵器の猛攻'],
 '闘将突貫':['一騎当千','八卦の陣','神速','万夫不当'],
 '全軍の進攻令':['全軍の進攻令','八卦の陣','奇計百出','覇王の進撃'],
 '智将砕器':['神算鬼謀','王者の護り','智将器撃','混元一気'],
 '剣兵突攻':['剣兵突覇','神速','練兵修練','剣兵速攻'],
 '兵器突覇':['兵器突撃','兵器訓練','神速','一騎当千'],
 '剣兵増強':['農林技術','千里行','剣兵増強','覇王の進撃'],
 '騎兵の大天撃':['騎兵の大神撃','護君','強兵の檄文','魏軍の極撃'],
 '拠点統制':['神算鬼謀','防将戦法','王佐の才','富国論'],
 '騎兵の大神域':['騎兵の大聖域','騎将の采配','神速','忠節不落'],
 '弓兵の大極攻':['弓兵の猛攻','弓兵の大聖域','弓兵増強','弓兵の極攻'],
 '弓将の封聖域':['弓兵の大極撃','守護堅陣','恵風','弓兵の大聖域'],
 '隣地豪撃':['万夫不当','謀反の進攻','攻城の檄文','闘将の極意'],
 '全軍の烈速令':['全軍の神速令','金剛不壊','神速援護','烈速'],
 '騎兵の大天域':['騎兵の大神域','強兵の檄文','烈速','覇者の護り'],
 '攻城の義勇軍':['猛将の鹵獲','迅速援護','強兵の義勇軍','神医の術式'],
 '知略謀略':['石切技術','伐採技術','製鉄技術','兵器突覇'],
 '万里行':['兵器突撃','騎兵の聖域','伐採技術','迅速援護'],
 '騎兵烈攻':['騎兵の大極撃','烈速','騎兵増強','騎兵突攻'],
 '智将の大天撃':['飛速','智将の大神撃','覇者の護り','強襲烈覇'],
 '全軍の大極攻令':['全軍の猛攻令','護君','智将の大神撃','全軍の極攻令'],
 '弓腰姫の愛':['弓兵の猛撃','剣兵の極撃','弓兵修練','弓将の采配'],
 '深慮遠謀':['兵舎修練','王佐の才','農林知識','攻城の檄文'],
 '兵舎訓練':['兵舎訓練','槍兵防御','槍兵の進撃','兵舎修練'],
 '槍兵防御':['石切知識','槍兵の進撃','槍兵行軍','槍兵堅守'],
 '兵器行軍':['兵器行軍','食糧知識','兵器訓練','兵器強行'],
 '伐採知識':['伐採知識','槍兵行軍','練兵訓練','伐採技術'],
 '食糧知識':['食糧知識','剣兵行軍','厩舎訓練','食糧技術'],
 '槍兵の進撃':['槍兵の進撃','槍兵防御','槍兵行軍','槍兵の強撃'],
 '兵器修練':['兵器修練','豪傑','兵器の強撃','加工技術'],
 '守護神':['鉄壁','槍兵方陣','弓兵方陣','王者の護り'],
 '鉄壁':['槍兵堅守','豪傑','騎兵堅守','守護神'],
 '槍兵堅守':['石切知識','槍兵の進撃','槍兵強行','槍兵方陣'],
 '槍兵強行':['槍兵強行','槍兵防御','槍兵の進撃','槍兵の猛撃'],
 '大皇帝':['弓兵突覇','覇王の進撃','富国','神医の術式'],
 '弓兵の猛撃':['弓兵の強撃','弓兵堅守','伐採技術','弓兵の極撃'],
 '一騎当千':['槍兵突覇','鉄壁','加工知識','魏王の号令'],
 '覇王の進撃':['騎兵の猛撃','騎兵の聖域','覇道','飛将'],
 '緊急帰還':['槍将の采配','城壁補強','加工技術','槍兵の猛攻'],
 '喬姫の祈り':['覇王の進撃','強襲突撃','傾国','軍神'],
 '喬姫の激励':['弓兵の極撃','弓兵突覇','弓兵の聖域','弓将の采配'],
 '豪傑':['剣兵の強撃','蛮族の襲撃','槍兵強行','英雄'],
 '伐採技術':['伐採知識','槍兵強行','練兵訓練','農林知識'],
 '槍兵突撃':['槍兵強行','槍兵堅守','千里行','槍兵の猛撃'],
 '兵舎修練':['豪傑','槍兵方陣','槍兵の強撃','加工技術'],
 '槍兵の聖域':['槍兵方陣','兵舎修練','槍兵強行','八掛の陣'],
 '皇帝の勅令':['弓兵の強撃','兵器の極撃','神速','強襲突覇'],
 '苦肉の計':['兵器の極撃','兵器強行','兵器修練','飛将'],
 '槍兵突覇':['槍兵突撃','兵舎修練','神速','一騎当千'],
 '覇道':['豪傑','鉄壁','千里行','兵器の極撃'],
 '富国論':['兵器修練','攻城の檄文','豊穣','富国'],
 '迅速斥候':['兵器修練','八卦の陣','加工技術','豊穣'],
 '騎兵突覇':['騎兵突撃','厩舎修練','神速','一騎当千'],
 '神謀風如':['弓兵の極撃','王者の護り','弓兵修練','勇将飛矢'],
 '奇襲':['猛将の鹵獲','強襲突覇','騎将の采配','飛蹄進軍'],
 '弓将の采配':['弓兵突覇','王佐の才','奇計百出','飛将'],
 '槍兵の猛撃':['槍兵の強撃','槍兵堅守','石切技術','槍兵の極撃'],
 '弓兵の聖域':['弓兵方陣','弓兵修練','弓兵強行','八卦の陣'],
 '国士無双':['軍神','城壁補強','騎兵の勝鬨','武神'],
 '市場繁栄':['傾国','富国','豊穣','弓将の采配'],
 '呉将の督戦':['弓兵の極撃','弓兵の聖域','伐採技術','覇王の進撃'],
 '弓兵の勝鬨':['弓兵の極撃','弓兵の聖域','弓兵突覇','弓将の采配'],
 '呉軍の防衛':['迅速援護','呉の治世','八卦の陣','地の利堅壁'],
 '弓兵の強攻':['弓兵の強撃','弓兵防御','弓兵行軍','弓兵の強攻'],
 '拠点襲撃':['槍戟鬼神','槍兵の聖域','兵舎修練','槍兵の大極撃'],
 '弓兵の進攻':['弓兵の進攻','弓兵防御','弓兵強行','弓兵の強撃'],
 '防将戦略':['槍兵の聖域','弓兵の聖域','騎兵の聖域','守護堅陣'],
 '市場知識':['農林知識','千里行','豪傑','八卦の陣'],
 '弓兵方陣':['弓兵堅守','弓兵の強撃','弓兵強行','弓兵の聖域'],
 '老巧の政令':['麒麟児','地の利堅壁','富国論','市場繁栄'],
 '槍戟鬼神':['槍兵の極撃','覇道','千里行','槍将の采配'],
 '堅牢知略':['弓兵突撃','八卦の陣','兵器強行','攻城の檄文'],
 '弓兵増強':['城壁補強','神速援護','弓兵増強','攻城の檄文'],
 '弓兵の極攻':['弓兵の猛撃','弓兵の聖域','弓兵修練','弓兵の猛攻'],
 '小華の舞':['弓兵の強撃','強兵の檄文','恵風','豊穣'],
 '大華の舞':['覇王の進撃','攻城の檄文','豊穣','弓将の采配'],
 '石切技術':['石切知識','弓兵強行','兵舎訓練','加工知識'],
 '不撓不屈':['強襲突覇','加工技術','守護防陣','護君'],
 '弩兵移送':['強襲突覇','弓兵の聖域','弓兵修練','弓兵の極撃'],
 '弓兵の大号令':['勇将飛矢','呉の治世','弓兵の勝鬨','国士無双'],
 '優姫の敬愛':['弓兵の猛撃','弓兵の聖域','弓兵修練','護君'],
 '槍兵の進攻':['槍兵の進攻','槍兵防御','槍兵強行','槍兵の強撃'],
 '弓兵訓練':['弓兵訓練','弓兵防御','弓兵の進撃','弓兵修練'],
 '弓兵急配':['強襲突撃','弓兵方陣','弓兵訓練','弓兵の猛撃'],
 '石切技巧':['豊穣','石切技術','富国','市場繁栄'],
 '騎兵の猛攻':['騎兵の強攻','騎兵堅守','製鉄技術','騎兵の猛撃'],
 '製鉄技巧':['豊穣','製鉄技術','富国','市場繁栄'],
 '弓兵の猛攻':['弓兵の強攻','弓兵堅守','伐採技術','弓兵の猛撃'],
 '弓兵速攻':['弓兵突撃','弓兵強行','弓兵訓練','弓兵突覇'],
 '呉軍の極撃':['弓兵の極撃','加工技術','守護神','強兵の檄文'],
 '武将突貫':['豪傑','鉄壁','千里行','一騎当千'],
 '槍兵突攻':['槍兵突覇','神速','兵舎修練','槍兵速攻'],
 '謀反の強攻':['英雄','守護神','神速','謀反の強攻'],
 '兵器の進攻':['兵器の進攻','鉄壁','兵器強行','兵器の強撃'],
 '弓兵の大極撃':['弓兵の極撃','守護神','弓将の采配','天弓雨撃'],
 '苛政虎舞':['弓兵の強撃','兵器の極撃','神速','飛蹄進軍'],
 '孫家の恵み':['猛虎進撃','守護防陣','市場知識','守護堅陣'],
 '食糧技術':['食糧知識','剣兵強行','厩舎訓練','厩舎修練'],
 '加工技術':['加工知識','鉄壁','弓兵突覇','豊穣'],
 '剣兵堅守':['食糧知識','剣兵の進撃','剣兵強行','剣兵方陣'],
 '覇王の猛攻':['覇王の強攻','八卦の陣','食糧技術','覇王の猛撃'],
 '槍兵の猛攻':['槍兵の強攻','槍兵堅守','石切技術','槍兵の猛撃'],
 '呉の治世':['奇計百出','厩舎修練','製鉄技術','王佐の才'],
 '弓兵の大聖域':['弓兵の聖域','弓兵増強','弓兵強行','王者の護り'],
 '万華招来':['万夫不当','金剛不壊','神算鬼謀','神医の術式'],
 '弓兵修練':['豪傑','弓兵方陣','弓兵強撃','農林技術'],
 '孫呉の烈火':['大皇帝','地の利堅壁','弓将の采配','神医の施術'],
 '弓兵突攻':['弓兵突覇','神速','弓兵修練','弓兵速攻'],
 '徳義為政':['飛蹄進軍','攻城の檄文','王佐の才','神医の術式'],
 '全軍の強攻令':['覇王の強撃','王者の護り','深慮遠謀','全軍の強攻令'],
 '弓兵の大天撃':['弓兵の大神撃','護君','強兵の檄文','呉軍の極撃'],
 '弓兵の大神域':['弓兵の大聖域','弓将の采配','神速','忠節不落'],
 '剣将の采配':['剣兵突覇','富国','奇計百出','猛将突貫'],
 '凰里雷光':['万里雷光','強襲烈覇','市場知識','天里行'],
 '鳳速雷光':['烈速雷光','剣将の采配','混元一気','飛速'],
 '槍兵の大極攻':['槍兵の猛攻','槍兵の大聖域','槍兵増強','槍兵の極攻'],
 '槍将の封聖域':['槍兵の大極撃','守護堅陣','恵風','槍兵の大聖域'],
 '智将器撃':['兵器の極撃','兵器強行','製鉄技術','神算鬼謀'],
 '全軍の神速令':['神速','守護神','迅速援護','全軍の神速令'],
 '槍兵の大天域':['槍兵の大神域','強兵の檄文','烈速','覇者の護り'],
 '強兵の義勇軍':['猛将の鹵獲','迅速援護','攻城の義勇軍','神医の術式'],
 '弓兵烈攻':['弓兵の大極撃','烈速','弓兵増強','弓兵突攻'],
 '剣兵防御':['食糧知識','剣兵の進撃','剣兵行軍','剣兵堅守'],
 '弓兵突撃':['弓兵強行','弓兵堅守','千里行','弓兵の猛撃'],
 '騎兵突撃':['騎兵強行','騎兵堅守','千里行','騎兵の猛撃'],
 '練兵訓練':['練兵訓練','剣兵防御','剣兵の進撃','練兵修練'],
 '兵器訓練':['兵器訓練','兵器防御','兵器の進撃','兵器修練'],
 '弓兵行軍':['弓兵行軍','弓兵防御','弓兵の進撃','神速'],
 '弓兵防御':['伐採知識','弓兵の進撃','弓兵行軍','弓兵堅守'],
 '槍兵行軍':['槍兵行軍','槍兵防御','槍兵の進撃','神速'],
 '騎兵行軍':['騎兵行軍','騎兵防御','騎兵の進撃','神速'],
 '剣兵の進撃':['剣兵の進撃','剣兵防御','剣兵行軍','剣兵の強撃'],
 '騎兵の進撃':['騎兵の進撃','騎兵防御','騎兵行軍','騎兵の強撃'],
 '騎兵防御':['製鉄知識','騎兵の進撃','騎兵行軍','騎兵堅守'],
 '太平要術':['兵器の極撃','槍兵の聖域','農林技術','深慮遠謀'],
 '騎兵の聖域':['騎兵方陣','厩舎修練','騎兵強行','八卦の陣'],
 '剣兵の強撃':['剣兵の進撃','剣兵防御','剣兵強行','剣兵の猛撃'],
 '攻城の檄文':['兵器修練','英雄','強兵の檄文','神医の術式'],
 '蛮王の襲撃':['一騎当千','兵舎修練','兵器の猛撃','太平要術'],
 '強襲突覇':['神速','鉄壁','八卦の陣','攻城の檄文'],
 '弓兵の極撃':['弓兵突撃','弓兵方陣','弓兵修練','弓兵突覇'],
 '農林知識':['伐採技術','食糧技術','槍兵強行','農林技術'],
 '加工知識':['石切技術','製鉄技術','騎兵強行','加工技術'],
 '練兵修練':['練兵修練 ','剣兵方陣','剣兵の強撃','農林技術'],
 '速撃の舞':['精鋭の進撃','加工技術','守護神','市場繁栄'],
 '農林技術':['農林知識','英雄','槍兵突覇','富国'],
 '剣兵の極撃':['剣兵突撃','剣兵方陣','練兵修練','剣兵突覇'],
 '騎兵の極撃':['騎兵突撃','騎兵方陣','厩舎修練','騎兵突覇'],
 '騎兵強行':['騎兵強行','騎兵防御','騎兵の進撃','一騎当千'],
 '優雅な調べ':['攻城の檄文','八卦の陣','豊穣','強兵の檄文'],
 '軍神':['一騎当千','槍兵方陣','兵舎修練','飛将'],
 '暴虐外道':['覇王の進撃','守護神','攻城の檄文','猛将の鹵獲'],
 '八卦の陣':['兵器の猛撃','剣兵の聖域','槍兵方陣','王者の護り'],
 '神飛将':['騎兵の極撃','騎兵の聖域','神速','飛将'],
 '強兵の檄文':['兵舎修練','守護神','攻城の檄文','神医の術式'],
 '飛蹄進軍':['騎兵突覇','騎兵の聖域','神速','騎将の采配'],
 '槍兵の極撃':['槍兵突撃','槍兵方陣','兵舎修練','槍兵突覇'],
 '騎兵の猛撃':['騎兵の強撃','騎兵堅守','製鉄技術','騎兵の極撃'],
 '隣地猛攻':['一騎当千','覇道','強兵の檄文','強襲突覇'],
 '密偵召集':['一騎当千','鉄壁','呉の治世','王佐の才'],
 '群雄の防衛':['迅速援護','王者の護り','城壁補強','守将の進軍'],
 '憂姫護国':['覇道','兵器強行','農林知識','飛将'],
 '強襲突撃':['伐採技術','剣兵の聖域','槍兵方陣','強兵の檄文'],
 '弓兵の強撃':['火神の攻勢','弓兵防御','弓兵強行','弓兵の猛撃'],
 '兵器強行':['兵器強行','食糧技術','兵器修練','蛮王の襲撃'],
 '人選眼力':['伐採知識','石切知識','製鉄知識','食糧知識'],
 '月下羽衣':['傾国','富国','市場知識','覇王の進撃'],
 '万夫不当':['騎兵突覇','神速','製鉄技術','騎兵の極撃'],
 '槍兵の強撃':['火神の攻勢','槍兵防御','槍兵強行','槍兵の猛撃'],
 '虐帝の号令':['兵器の猛撃','守護神','覇道','蛮王の襲撃'],
 '蛮勇の一撃':['拠点襲撃','地の利堅壁','農林技術','槍兵の極撃'],
 '陥陣営の侵攻':['兵器の猛撃','兵器強行','恵風','攻城の檄文'],
 '剛将の畏怖':['一騎当千','鉄壁','騎兵強行','覇道'],
 '騎兵の進攻':['騎兵の進攻','騎兵防御','騎兵強行','騎兵の強撃'],
 '天子勅令':['趁火打劫','槍兵の勝鬨','王佐の才','富国論'],
 '槍兵の強攻':['槍兵の強撃','槍兵防御','槍兵行軍','槍兵の強攻'],
 '暴君の覇道':['猛将の鹵獲','八卦の陣','覇道','暴虐外道'],
 '才女の音律':['一騎当千','農林知識','神速','闘将の極意'],
 '守護防陣':['槍兵防御','弓兵防御','騎兵防御','火神の攻勢'],
 '弓神降臨':['万夫不当','弓兵方陣','弓兵突覇','弓兵の強攻'],
 '騎兵の強攻':['騎兵の強撃','騎兵防御','騎兵行軍','騎兵の強攻'],
 '豊潤祈祷':['剣兵の極撃','仁君','練兵修練','富国'],
 '趁火打劫':['豪傑','厩舎訓練','鉄壁','奇計百出'],
 '騎兵の大極撃':['騎兵の極撃','騎兵の聖域','騎将の采配','戦蹄轟撃'],
 '密偵精鋭':['兵器の猛撃','急速援護','食糧技術','万夫不当'],
 '桃色吐息':['一騎当千','仁君','王佐の才','趁火打劫'],
 '防将戦法':['槍兵方陣','弓兵方陣','騎兵方陣','守護防陣'],
 '白馬将':['騎兵増強','拠点襲撃','戦蹄轟撃','飛蹄進軍'],
 '群将の督戦':['兵器の極撃','王者の護り','食糧技術','虐帝の号令'],
 '兵器突撃':['兵器強行','剣兵堅守','千里行','剣兵の猛撃'],
 '剣兵の進攻':['剣兵の進攻','剣兵防御','剣兵強行','槍兵の強撃'],
 '剣兵の強攻':['剣兵の強撃','剣兵防御','剣兵行軍','剣兵の強攻'],
 '天里行':['兵器突覇','騎将の采配','市場繁栄','神速援護'],
 '剣兵の極攻':['剣兵の猛撃','剣兵の聖域','錬兵修練','剣兵の猛攻'],
 '剣神降臨':['万夫不当','剣兵方陣','剣兵突覇','剣兵の強攻'],
 '護国献心':['剣兵の猛撃','剣兵堅守','覇道','深慮遠謀'],
 '騎兵速攻':['騎兵突撃','騎兵強行','厩舎訓練','騎兵突覇'],
 '覇者の護り':['槍兵の聖域','弓兵の聖域','騎兵の聖域','忠節不落'],
 '剣兵の大聖域':['剣兵の聖域','剣兵増強','剣兵強行','王者の護り'],
 '素材知識':['騎兵の極撃','騎兵の聖域','英雄','市場知識'],
 '王者の護り':['槍兵方陣','弓兵方陣','騎兵方陣','王佐の才'],
 '弓兵突覇':['弓兵突撃','弓兵修練','神速','一騎当千'],
 '熊猫の猛襲':['豪傑','鉄壁','食糧知識','一騎当千'],
 '娘々武神':['一騎当千','槍兵の聖域','兵舎修練','軍神'],
 '千里雷光':['千里行','騎兵行軍','密偵召集','千里雷光'],
 '剣兵烈攻':['剣兵の大極撃','烈速','剣兵増強','剣兵突攻'],
 '神速':['一騎当千','英雄','農林知識','仁君'],
 '一騎湯戦':['槍兵突覇','鉄壁','加工知識','魏王の号令'],
 '湯将の極意':['一騎当千','八卦の陣','千里行','武将の極意'],
 '武将の極意':['豪傑','鉄壁','急速援護','一騎当千'],
 '守護聖陣':['弓将の采配','騎将の采配','槍将の采配','守護方陣'],
 '守護方陣':['槍兵の聖域','弓兵の聖域','騎兵の聖域','守護堅陣'],
 '鬼神の極意':['隣地猛攻','王者の護り','迅速援護','猛将の極意'],
 '兵器の大号令':['太平要術','王佐の才','呉の治世','忠節不落'],
 '暴姫の威令':['猛将の鹵獲','鉄壁','食糧知識','護君'],
 '猛将の極意':['万夫不当','守護神','神速','闘将の極意'],
 '奇計百出':['伐採技術','弓兵修練','剣兵突覇','守護神'],
 '護君':['防将戦略','守護堅陣','神速援護','忠節不落'],
 '兵器の強攻':['兵器の強撃','守護神','兵器行軍','兵器の強攻'],
 '騎兵方陣':['騎兵堅守','騎兵の強撃','騎兵強行','騎兵の聖域'],
 '若獅子の軍略':['騎兵突覇','神速','加工技術','鬼神の極意'],
 '謀反の進攻':['謀反の進攻','鉄壁','千里行','剣兵の強撃'],
 '水鏡の方術':['仁君','騎兵の聖域','加工技術','神医の術式'],
 '娘々強兵':['攻城の檄文','八卦の陣','豊穣','強兵の檄文'],
 '龍鱗猛攻':['万夫不当','覇道','攻城の檄文','隣地猛攻'],
 '酔吟吐息':['趁火打劫','呉の治世','恵風','桃色吐息'],
 '闘将の極意':['一騎当千','八卦の陣','千里行','武将の極意'],
 '傾国':['騎兵の極撃','弓兵の聖域','神医の術式','強兵の檄文'],
 '兵器の勝鬨':['兵器の極撃','剣兵の聖域','兵器突覇','攻城の檄文'],
 '娘々軍神':['一騎当千','槍兵方陣','兵舎修練','万夫不当'],
 '群雄の極撃':['太平要術','農林技術','八卦の陣','神医の術式'],
 '陳留王政':['神算鬼謀','強兵の檄文','富国','皇帝の勅令'],
 '金剛不壊':['防将戦法','槍兵の聖域','弓兵の聖域','防将戦略'],
 '戦神の極意':['隣地猛攻','王者の護り','迅速援護','猛将の極意'],
 '万夫必殺':['騎兵突覇','神速','製鉄技術','騎兵の極撃'],
 '一閃の極意':['一騎当千','八卦の陣','千里行','武将の極意'],
 '哀艶の舞':['槍兵突覇','千里行','農林技術','鬼神の極意'],
 '剣兵の大極撃':['剣兵の極撃','守護神','剣将の采配','暴君の覇道'],
 '槍神降臨':['万夫不当','槍兵方陣','槍兵突覇','槍兵の強攻'],
 '猛士の極意':['万夫不当','守護神','神速','闘将の極意'],
 '剣兵速攻':['剣兵突撃','剣兵強行','練兵訓練','剣兵突覇'],
 '月華の舞':['猛士の極意','攻城の檄文','食糧技術','騎将の采配'],
 '暴姫の命':['強襲突撃','強兵の檄文','神速','猛将の鹵獲'],
 '攻城戦の極砕':['兵器の極撃','兵器修練','豊穣','智将砕器'],
 '佳人薄命':['猛将の鹵獲','王者の護り','城壁補強','鬼神の鹵獲'],
 '文姫の慈愛':['覇王の進撃','傾国','富国','神医の術式'],
 '猛暑の極意':['万夫不当','守護神','神速','闘将の極意'],
 '鹵獲の猛攻':['鹵獲の強攻','八卦の陣','迅速援護','猛将の鹵獲'],
 '強襲奮迅':['蛮王の襲撃','王者の護り','豊潤祈祷','奇襲'],
 '鬼神の鹵獲':['万夫不当','金剛不壊','攻城の檄文','麒麟児'],
 '兵器の猛攻':['兵器の強攻','八卦の陣','食糧技術','兵器の猛撃'],
 '大剣兵移送':['強襲突覇','剣兵の聖域','錬兵修練','剣兵の極撃'],
 '剣兵の大天撃':['剣兵の大神撃','護君','強兵の檄文','群雄の極撃'],
 '富国強兵':['攻城の檄文','軍神','豊穣','市場繁栄'],
 '収奪の猛攻':['鹵獲の強攻','八卦の陣','迅速援護','猛将の鹵獲'],
 '領地統制':['深慮遠謀','堅牢知略','呉の治世','富国論'],
 '全軍の猛攻令':['全軍の強攻令','忠節不落','神算鬼謀','覇王の猛撃'],
 '無双':['万夫不当','金剛不壊','万里行','覇王の強撃'],
 '皇叔の号令':['昭烈帝','王者の護り','豊穣','神医の術式'],
 '剣兵の大神域':['剣兵の大聖域','剣将の采配','神速','忠節不落'],
 '王将の心意気':['軍神','城壁補強','騎兵の勝鬨','武神'],
 '食糧革命':['剣兵の極撃','剣兵の聖域','練兵修練','食糧技術'],
 '富国':['槍兵の極撃','槍兵の聖域','仁君','豊穣'],
 '飛将':['一騎当千','鉄壁','厩舎修練','覇王の進撃'],
 '守護大聖陣':['弓兵の大聖域','槍兵の大聖域','騎兵の大聖域','守護聖陣'],
 '剣兵の大極攻':['剣兵の猛攻','剣兵の大聖域','剣兵増強','剣兵の極攻'],
 '覇者の大神域':['弓将の采配','槍将の采配','騎将の采配','覇者の神域'],
 '護国望心':['剣兵の強撃','剣兵防御','英雄','奇計百出'],
 '謀反の突攻':['覇道','守護神','呉の治世','謀反の速攻'],
 '謀反の速攻':['英雄','鉄壁','王佐の才','覇道'],
 '剣将の封聖域':['剣兵の大極撃','守護堅陣','恵風','剣兵の大聖域'],
 '兵器の大極撃':['兵器の極撃','守護神','兵器修練','兵器突覇'],
 '守衛方陣':['弓兵の聖域','槍兵の聖域','騎兵の聖域','守護堅陣'],
 '剣兵の大天域':['剣兵の大神域','攻城の檄文','烈速','覇者の護り'],
 '鹵獲の進攻':['鹵獲の進攻','鉄壁','千里行','趁火打劫'],
 '鹵獲の強攻':['迅速劫略','八卦の陣','神速','鹵獲の強攻'],
 '飛隠雷光':['強襲突覇','防将戦法','暴虐外道','覇王の猛撃'],
 '烈隠雷光':['強襲突撃','地の利堅壁','太平要術','覇王の強撃'],
 '守護堅陣':['槍兵方陣','弓兵方陣','騎兵方陣','覇道'],
 '龍神の縮地劫略':['飛将','護君','天里行','鬼神の鹵獲'],
 '鬼神の縮地劫略':['万夫不当','金剛不壊','万里行','猛将の鹵獲'],
 '猛将の縮地劫略':['一騎当千','守護神','千里行','迅速劫掠'],
 '天衣無縫':['忠節不落','守護方陣','烈速','覇者の護り'],
 '飛速迅雷':['烈速','剣兵の聖域','神算鬼謀','烈速雷光'],
 '夏神の極意':['隣地猛攻','王者の護り','迅速援護','猛将の極意'],
 '千華招来':['一騎当千','守護神','深慮遠謀','桃色吐息'],
 '騎兵突攻':['騎兵突覇','神速','厩舎修練','騎兵速攻'],
 '隣地極攻':['万夫不当','剛将の畏怖','万里行','強襲烈覇'],
 '戦神招来':['鬼神の極意','守護神','深慮遠謀','戦神の極意'],
 '弓兵の大神撃':['弓兵の大極撃','金剛不壊','弓兵増強','大皇帝'],
 '槍兵の極攻':['槍兵の猛撃','槍兵の聖域','兵舎修練','槍兵の猛攻'],
 '剣兵増勢':['剣兵速攻','剣兵方陣','神速','剣兵突攻'],
 '食糧技巧':['豊穣','食糧技術','富国','市場繁栄'],
 '猛将の鹵獲':['一騎当千','守護神','厩舎修練','深慮遠謀'],
 '智将の大神撃':['智将の大極撃','忠節不落','烈速','強襲突覇'],
 '万里雷光':['千里雷光','騎兵強行','迅速斥候','万里行'],
 '戦蹄轟撃':['騎兵の極撃','覇道','千里行','騎将の采配'],
 '強襲速撃':['千里行','弓兵強行','剣兵強行','練兵修練'],
 '精鋭の進撃':['精鋭の進撃','兵器防御','神速','奇計百出'],
 '剣兵方陣':['剣兵堅守','剣兵の強撃','剣兵強行','剣兵の聖域'],
 '剣兵突撃':['剣兵強行','剣兵堅守','千里行','剣兵の猛撃'],
 '剣兵の大神撃':['剣兵の大極撃','金剛不壊','剣兵増強','臥龍覚醒'],
 '才略謀略':['槍兵の勝鬨','弓兵の勝鬨','騎兵の勝鬨','智将器撃'],
 '謀反の猛攻':['謀反の強攻','金剛不壊','迅速援護','太平要術'],
 '守衛聖陣':['弓将の采配','騎将の采配','槍将の采配','守護方陣'],
 '全軍の極攻令':['覇王の猛撃','覇者の護り','混元一気','全軍の猛攻令'],
 '皇帝の覇軍':['(不明)','(不明)','(不明)','(不明)'],
 '鹵獲の極攻':['猛将の鹵獲','王者の護り','神速援護','鹵獲の猛攻'],
 '鬼神突貫':['軍神','王者の護り','万里行','武神'],
 '全軍の飛速令':['烈速','護君','市場知識','全軍の烈速令'],
 '弓襲遠攻':['弓兵の極撃','千里雷光','弓兵訓練','勇将飛矢'],
 '烈速雷光':['神速雷光','剣兵方陣','深慮遠謀','烈速'],
 '兵器の縮地天撃':['兵器の大神撃', '覇者の護り', '智将砕器', '飛速'],
'':['', '', '', '']
};

// 兵力計算用のシーズンテーブル
var serverTable = [
	// サーバー情報初期設定

	["w1",16],
	["w2",16],
	["w3",16],
	["w4",14],
	["w5",16],
	["w6",10],
	["w7",8],
	["w8",8],
	["w9",],
	["w10",4],
	["w11",2],
	["w12",2],
	["w13",1],
	["",1],
	["",1],
	["",1],
	["",1],
	["",1],
	["",1],
	["",1]
];

// 配列要素と兵種のマッピング
var P_TYPE = 0;		// 領地タイプ
var P_NSWD = 1;		// 剣兵
var P_NSLD = 2;		// 盾兵
var P_NSPR = 3;		// 槍兵
var P_NARC = 4;		// 弓兵
var P_NKNT = 5;		// 騎兵
var P_HSWD = 6;		// 大剣兵
var P_HSLD = 7;		// 重盾兵
var P_HSPR = 8;		// 矛槍兵
var P_HARC = 9;		// 弩兵
var P_HKNT = 10;	// 近衛騎兵

// 鯖の期番号、敵兵出現パラメータ、マップツールの対応表
var season_list =
[
	{
		// point1ki
		"type":['a'],
		"seasons":[1],
		"100016":["☆1(1-0-0-0)",5,0,0,0,0,0,0,0,0,0],
		"010016":["☆1(0-1-0-0)",5,0,0,0,0,0,0,0,0,0],
		"001016":["☆1(0-0-1-0)",5,0,0,0,0,0,0,0,0,0],
		"000116":["☆1(0-0-0-1)",5,0,0,0,0,0,0,0,0,0],
		"300016":["☆2(3-0-0-0)",0,0,0.5,4,0.5,0,0,0,0,0],
		"030016":["☆2(0-3-0-0)",0,0,4,0.5,0.5,0,0,0,0,0],
		"003016":["☆2(0-0-3-0)",0,0,0.5,0.5,4,0,0,0,0,0],
		"000411":["☆3(0-0-0-4)",0,12,2,2,2,0,0,0,0,0],
		"111022":["☆3(1-1-1-0)",0,0,6,6,6,0,0,0,0,0],
		"222023":["☆4(2-2-2-0)",0,0,12.5,12.5,12.5,0,0,0,0,0],
		"222218":["☆4(2-2-2-2)",0,7.5,8.5,8.5,8.5,0,0,0,0,0],
		"000813":["☆4(0-0-0-8)",0,16.5,7,7,7,0,0,0,0,0],
		"600022":["☆5(6-0-0-0)",0,0,10,40,10,0,0,0,0,0],
		"060022":["☆5(0-6-0-0)",0,0,40,10,10,0,0,0,0,0],
		"006022":["☆5(0-0-6-0)",0,0,10,10,40,0,0,0,0,0],
		"1000014":["☆6(10-0-0-0)",0,0,15,75,15,0,0,0,0,0],
		"0100014":["☆6(0-10-0-0)",0,0,75,15,15,0,0,0,0,0],
		"0010014":["☆6(0-0-10-0)",0,0,15,15,75,0,0,0,0,0],
		"333025":["☆7(3-3-3-0)",0,0,0,0,0,0,0,50,50,50],
		"444433":["☆8(4-4-4-4)",0,0,0,0,0,0,82.5,72.5,72.5,72.5],
		"0001817":["☆9(0-0-0-18)",0,0,0,0,0,0,195,85,85,85],
		"000049":["NPC拠点<font color=red size=＋4><br><b>NPC拠点と推測されます。中身をうかがい知ることは出来ません。</b></font>"],
		"333337":["君主城：プレイヤー本拠地<font color=red size=＋4><br><b>誰かの本拠地と推測されます。中身をうかがい知ることは出来ません。</b></font>"]
	},
	{
		// point2ki
		"type":['b'],
		"seasons":[2],
		"000116":["☆1(0-0-0-1)",5,0,0,0,0,0,0,0,0,0],
		"100016":["☆1(1-0-0-0)",5,0,0,0,0,0,0,0,0,0],
		"010016":["☆1(0-1-0-0)",5,0,0,0,0,0,0,0,0,0],
		"001016":["☆1(0-0-1-0)",5,0,0,0,0,0,0,0,0,0],
		"300016":["☆2(3-0-0-0)",0,0,0.5,6,0.5,0,0,0,0,0],
		"030016":["☆2(0-3-0-0)",0,0,6,0.5,0.5,0,0,0,0,0],
		"003016":["☆2(0-0-3-0)",0,0,0.5,0.5,6,0,0,0,0,0],
		"111022":["☆3(1-1-1-0)",0,0,7.5,7.5,7.5,0,0,0,0,0],
		"000411":["☆3(0-0-0-4)",0,14,3,3,3,0,0,0,0,0],
		"000126":["☆3(0-0-0-1)",0,5,6,6,6,0,0,0,0,0],
		"222023":["☆4(2-2-2-0)",0,0,14,14,14,0,0,0,0,0],
		"222020":["☆4(2-2-2-0)",0,0,5,5,35,0,0,0,0,0],
		"000813":["☆4(0-0-0-8)",0,18,9,9,9,0,0,0,0,0],
		"600022":["☆5(6-0-0-0)",0,0,12.5,65,12.5,0,0,0,0,0],
		"060022":["☆5(0-6-0-0)",0,0,65,12.5,12.5,0,0,0,0,0],
		"006022":["☆5(0-0-6-0)",0,0,12.5,12.5,65,0,0,0,0,0],
		"000129":["☆5(0-0-0-1)",0,45,15,15,15,0,0,0,0,0],
		"222024":["☆6(2-2-2-0)",0,0,0,0,0,0,0,27.5,27.5,27.5],
		"1000020":["☆6(10-0-0-0)",0,0,0,0,0,0,0,12.5,60,12.5],
		"0100020":["☆6(0-10-0-0)",0,0,0,0,0,0,0,60,12.5,12.5],
		"0010020":["☆6(0-0-10-0)",0,0,0,0,0,0,0,12.5,12.5,60],
		"244025":["☆7(2-4-4-0)",0,0,0,0,0,0,0,65,22.5,65],
		"000133":["☆7(0-0-0-1)",0,0,0,0,0,0,17.5,45,45,45],
		"0001216":["☆7(0-0-0-12)",0,0,0,0,0,0,55,32.5,32.5,32.5],
		"412028":["☆8(4-1-2-0)",0,0,0,0,0,0,0,25,250,50],
		"241027":["☆8(2-4-1-0)",0,0,0,0,0,0,0,250,50,25],
		"124027":["☆8(1-2-4-0)",0,0,0,0,0,0,0,50,25,250],
		"444429":["☆9(4-4-4-4)",0,0,0,0,0,0,150,150,150,150],
		"111240":["☆9(1-1-1-2)",0,0,0,0,0,0,240,110,110,110],
		"0001815":["☆9(0-0-0-18)",0,0,0,0,0,0,52.5,157.5,157.5,157.5],
		"000049":["NPC拠点<font color=red size=＋4><br><b>NPC拠点と推測されます。中身をうかがい知ることは出来ません。</b></font>"],
		"333337":["君主城：プレイヤー本拠地<font color=red size=＋4><br><b>誰かの本拠地と推測されます。中身をうかがい知ることは出来ません。</b></font>"]
	},
	{
		//point3ki
		"type":['c'],
		"seasons":[3,4],
		"000116":["☆1(0-0-0-1)",5,0,0,0,0,0,0,0,0,0],
		"100016":["☆1(1-0-0-0)",5,0,0,0,0,0,0,0,0,0],
		"010016":["☆1(0-1-0-0)",5,0,0,0,0,0,0,0,0,0],
		"001016":["☆1(0-0-1-0)",5,0,0,0,0,0,0,0,0,0],
		"300016":["☆2(3-0-0-0)",0,0,0.5,10,0.5,0,0,0,0,0],
		"030016":["☆2(0-3-0-0)",0,0,10,0.5,0.5,0,0,0,0,0],
		"003016":["☆2(0-0-3-0)",0,0,0.5,0.5,10,0,0,0,0,0],
		"111022":["☆3(1-1-1-0)",0,0,9,9,9,0,0,0,0,0],
		"000411":["☆3(0-0-0-4)",0,12.5,6.5,6.5,6.5,0,0,0,0,0],
		"000126":["☆3(0-0-0-1)",0,15,7,7,7,0,0,0,0,0],
		"222023":["☆4(2-2-2-0)",0,0,16,16,16,0,0,0,0,0],
		"222020":["☆4(2-2-2-0)",0,0,7.5,7.5,35,0,0,0,0,0],
		"000813":["☆4(0-0-0-8)",0,22.5,11.5,11.5,11.5,0,0,0,0,0],
		"600022":["☆5(6-0-0-0)",0,0,12.5,75,12.5,0,0,0,0,0],
		"060022":["☆5(0-6-0-0)",0,0,75,12.5,12.5,0,0,0,0,0],
		"006022":["☆5(0-0-6-0)",0,0,12.5,12.5,75,0,0,0,0,0],
		"000129":["☆5(0-0-0-1)",0,30,22.5,22.5,22.5,0,0,0,0,0],
		"221025":["☆5(2-2-1-0)",0,0,35,35,35,0,0,0,0,0],
		"112025":["☆5(1-1-2-0)",0,0,37.5,37.5,37.5,0,0,0,0,0],
		"1000020":["☆6(10-0-0-0)",0,0,0,0,0,0,0,20,90,20],
		"0100020":["☆6(0-10-0-0)",0,0,0,0,0,0,0,90,20,20],
		"0010020":["☆6(0-0-10-0)",0,0,0,0,0,0,0,20,20,90],
		"222024":["☆6(2-2-2-0)",0,0,0,0,0,0,0,40,40,40],
		"244025":["☆7(2-4-4-0)",0,0,0,0,0,0,0,110,30,30],
		"000133":["☆7(0-0-0-1)",0,0,0,0,0,0,92.5,52.5,52.5,52.5],
		"0001216":["☆7(0-0-0-12)",0,0,0,0,0,0,68,34,34,34],
		"1400022":["☆8(14-0-0-0)",0,0,0,0,0,0,0,75,250,75],
		"0140022":["☆8(0-14-0-0)",0,0,0,0,0,0,0,250,75,75],
		"0014022":["☆8(0-0-14-0)",0,0,0,0,0,0,0,75,75,250],
		"412028":["☆8(4-1-2-0)",0,0,0,0,0,0,0,50,250,205],
		"241027":["☆8(2-4-1-0)",0,0,0,0,0,0,0,250,50,25],
		"124027":["☆8(1-2-4-0)",0,0,0,0,0,0,0,25,50,250],
		"10008":["☆9(1-0-0-0)",0,0,0,0,0,0,0,150,300,150],
		"01008":["☆9(0-1-0-0)",0,0,0,0,0,0,0,300,150,150],
		"00108":["☆9(0-0-1-0)",0,0,0,0,0,0,0,150,150,300],
		"444429":["☆9(4-4-4-4)",0,0,0,0,0,0,225,225,225,225],
		"111240":["☆9(1-1-1-2)",0,0,0,0,0,0,75,225,225,225],
		"0001815":["☆9(0-0-0-18)",0,0,0,0,0,0,300,100,100,100],
		"333317":["☆9(3-3-3-3)",0,0,0,0,0,0,468,469,469,469],
		"000049":["NPC拠点<font color=red size=＋4><br><b>NPC拠点と推測されます。中身をうかがい知ることは出来ません。</b></font>"],
		"333337":["君主城：プレイヤー本拠地<font color=red size=＋4><br><b>誰かの本拠地と推測されます。中身をうかがい知ることは出来ません。</b></font>"]
	},
	{
		//point5ki
		"type":['d'],
		"seasons":[5,6,7,8,9],
		"000116":["☆1(0-0-0-1)",5,0,0,0,0,0,0,0,0,0],
		"100016":["☆1(1-0-0-0)",5,0,0,0,0,0,0,0,0,0],
		"010016":["☆1(0-1-0-0)",5,0,0,0,0,0,0,0,0,0],
		"001016":["☆1(0-0-1-0)",5,0,0,0,0,0,0,0,0,0],
		"300016":["☆2(3-0-0-0)",0,0,1,12.5,1,0,0,0,0,0],
		"030016":["☆2(0-3-0-0)",0,0,12.5,1,1,0,0,0,0,0],
		"003016":["☆2(0-0-3-0)",0,0,1,1,12.5,0,0,0,0,0],
		"111022":["☆3(1-1-1-0)",0,0,15,15,15,0,0,0,0,0],
		"000411":["☆3(0-0-0-4)",0,29.5,6.5,6.5,6.5,0,0,0,0,0],
		"000126":["☆3(0-0-0-1)",0,30,7,7,7,0,0,0,0,0],
		"222023":["☆4(2-2-2-0)",0,0,33,33,33,0,0,0,0,0],
		"222020":["☆4(2-2-2-0)",0,0,30,30,45,0,0,0,0,0],
		"000813":["☆4(0-0-0-8)",0,55.5,17.5,17.5,17.5,0,0,0,0,0],
		"600022":["☆5(6-0-0-0)",0,0,33,111,33,0,0,0,0,0],
		"060022":["☆5(0-6-0-0)",0,0,111,33,33,0,0,0,0,0],
		"006022":["☆5(0-0-6-0)",0,0,33,33,111,0,0,0,0,0],
		"000129":["☆5(0-0-0-1)",0,87,26,26,26,0,0,0,0,0],
		"221025":["☆5(2-2-1-0)",0,0,60,60,60,0,0,0,0,0],
		"112025":["☆5(1-1-2-0)",0,0,70,70,70,0,0,0,0,0],
		"1000020":["☆6(10-0-0-0)",0,0,0,0,0,0,0,50,180,50],
		"0100020":["☆6(0-10-0-0)",0,0,0,0,0,0,0,180,50,50],
		"0010020":["☆6(0-0-10-0)",0,0,0,0,0,0,0,50,50,180],
		"222024":["☆6(2-2-2-0)",0,0,0,0,0,0,0,85,85,85],
		"244025":["☆7(2-4-4-0)",0,0,0,0,0,0,0,220,110,110],
		"000133":["☆7(0-0-0-1)",0,0,0,0,0,0,42.5,132.5,132.5,132.5],
		"0001216":["☆7(0-0-0-12)",0,0,0,0,0,0,224,72,72,72],
		"1400022":["☆8(14-0-0-0)",0,0,0,0,0,0,0,175,400,175],
		"0140022":["☆8(0-14-0-0)",0,0,0,0,0,0,0,400,175,175],
		"0014022":["☆8(0-0-14-0)",0,0,0,0,0,0,0,175,175,400],
		"412028":["☆8(4-1-2-0)",0,0,0,0,0,0,0,200,350,100],
		"241027":["☆8(2-4-1-0)",0,0,0,0,0,0,0,350,200,100],
		"124027":["☆8(1-2-4-0)",0,0,0,0,0,0,0,100,200,350],
		"10008":["☆9(1-0-0-0)",0,0,0,0,0,0,0,400,600,400],
		"01008":["☆9(0-1-0-0)",0,0,0,0,0,0,0,600,400,400],
		"00108":["☆9(0-0-1-0)",0,0,0,0,0,0,0,400,400,600],
		"444429":["☆9(4-4-4-4)",0,0,0,0,0,0,150,400,400,400],
		"111240":["☆9(1-1-1-2)",0,0,0,0,0,0,300,300,300,300],
		"0001815":["☆9(0-0-0-18)",0,0,0,0,0,0,150,300,300,300],
		"000049":["NPC拠点<font color=red size=＋4><br><b>NPC拠点と推測されます。中身をうかがい知ることは出来ません。</b></font>"],
		"333337":["君主城：プレイヤー本拠地<font color=red size=＋4><br><b>誰かの本拠地と推測されます。中身をうかがい知ることは出来ません。</b></font>"]
	},
	{
		//point10ki
		"type":['e'],
		"seasons":[10,11],
		"02009":["☆1(0-2-0-0)",6.5,0,0,0,0,0,0,0,0,0],
		"00209":["☆1(0-0-2-0)",6.5,0,0,0,0,0,0,0,0,0],
		"20009":["☆1(2-0-0-0)",6.5,0,0,0,0,0,0,0,0,0],
		"00029":["☆1(0-0-0-2)",6.5,0,0,0,0,0,0,0,0,0],
		"300014":["☆2(3-0-0-0)",0,0,1.5,15.5,1.5,0,0,0,0,0],
		"030014":["☆2(0-3-0-0)",0,0,15.5,1.5,1.5,0,0,0,0,0],
		"003014":["☆2(0-0-3-0)",0,0,1.5,1.5,15.5,0,0,0,0,0],
		"111121":["☆3(1-1-1-1)",0,12,16.5,16.5,16.5,0,0,0,0,0],
		"000126":["☆3(0-0-0-1)",0,36,6.5,6.5,6.5,0,0,0,0,0],
		"111016":["☆3(1-1-1-0)",0,0,19,19,19,0,0,0,0,0],
		"111127":["☆4(1-1-1-1)",0,55.5,25,25,25,0,0,0,0,0],
		"000813":["☆4(0-0-0-8)",0,70.5,18,18,18,0,0,0,0,0],
		"222218":["☆4(2-2-2-2)",0,30,31.5,31.5,31.5,0,0,0,0,0],
		"222019":["☆4(2-2-2-0)",0,0,40.5,40.5,40.5,0,0,0,0,0],
		"111120":["☆5(1-1-1-1)",0,57,56.5,56.5,56.5,0,0,0,0,0],
		"000129":["☆5(0-0-0-1)",0,129,32.5,32.5,32.5,0,0,0,0,0],
		"600020":["☆5(6-0-0-0)",0,0,41.5,139,41.5,0,0,0,0,0],
		"060020":["☆5(0-6-0-0)",0,0,139,41.5,41.5,0,0,0,0,0],
		"006020":["☆5(0-0-6-0)",0,0,41.5,41.5,139,0,0,0,0,0],
		"000028":["☆6(0-0-0-0)",0,0,0,0,0,0,0,106.5,106.5,106.5],
		"1000014":["☆6(10-0-0-0)",0,0,0,0,0,0,0,62.5,225,62.5],
		"0100014":["☆6(0-10-0-0)",0,0,0,0,0,0,0,225,62.5,62.5],
		"0010014":["☆6(0-0-10-0)",0,0,0,0,0,0,0,62.5,62.5,225],
		"0001216":["☆7(0-0-0-12)",0,0,0,0,0,0,279,90,90,90],
		"000029":["☆7(0-0-0-0)",0,0,0,0,0,0,0,183.5,183.5,183.5],
		"442023":["☆7(4-4-2-0)",0,0,0,0,0,0,0,220,220,110],
		"424023":["☆7(4-2-4-0)",0,0,0,0,0,0,0,110,220,220],
		"244023":["☆7(2-4-4-0)",0,0,0,0,0,0,0,220,110,220],
		"544222":["☆8(5-4-4-2)",0,0,0,0,0,0,90,205,316,205],
		"454222":["☆8(4-5-4-2)",0,0,0,0,0,0,90,316,205,205],
		"445222":["☆8(4-4-5-2)",0,0,0,0,0,0,90,205,205,316],
		"0001531":["☆8(0-0-0-15)",0,0,0,0,0,0,450,175,175,175],
		"000037":["☆8(0-0-0-0)",0,0,0,0,0,0,262.5,262.5,262.5,262.5],
		"111240":["☆9(1-1-1-2)",0,0,0,0,0,0,547.5,400,400,400],
		"808025":["☆9(8-0-8-0)",0,0,0,0,0,0,0,0,875,875],
		"880025":["☆9(8-8-0-0)",0,0,0,0,0,0,0,875,875,0],
		"088025":["☆9(0-8-8-0)",0,0,0,0,0,0,0,875,0,875],
		"333317":["☆9(3-3-3-3)",0,0,0,0,0,0,180,565,565,565],
		"000049":["NPC拠点<font color=red size=＋4><br><b>NPC拠点と推測されます。中身をうかがい知ることは出来ません。</b></font>"],
		"333337":["君主城：プレイヤー本拠地<font color=red size=＋4><br><b>誰かの本拠地と推測されます。中身をうかがい知ることは出来ません。</b></font>"]
	},
	{
		// point12ki
		"type":['f'],
		"seasons":[12,13],
		"20009":["☆1(2-0-0-0)",6.5,0,0,0,0,0,0,0,0,0],
		"02009":["☆1(0-2-0-0)",6.5,0,0,0,0,0,0,0,0,0],
		"00209":["☆1(0-0-2-0)",6.5,0,0,0,0,0,0,0,0,0],
		"00029":["☆1(0-0-0-2)",6.5,0,0,0,0,0,0,0,0,0],
		"300014":["☆2(3-0-0-0)",0,0,1.5,15.5,1.5,0,0,0,0,0],
		"030014":["☆2(0-3-0-0)",0,0,15.5,1.5,1.5,0,0,0,0,0],
		"003014":["☆2(0-0-3-0)",0,0,1.5,1.5,15.5,0,0,0,0,0],
		"111121":["☆3(1-1-1-1)",0,12,16.5,16.5,16.5,0,0,0,0,0],
		"000126":["☆3(0-0-0-1)",0,36,6.5,6.5,6.5,0,0,0,0,0],
		"111016":["☆3(1-1-1-0)",0,0,19,19,19,0,0,0,0,0],
		"111127":["☆4(1-1-1-1)",0,55.5,25,25,25,0,0,0,0,0],
		"000813":["☆4(0-0-0-8)",0,70.5,18,18,18,0,0,0,0,0],
		"222218":["☆4(2-2-2-2)",0,30,31.5,31.5,31.5,0,0,0,0,0],
		"222019":["☆4(2-2-2-0)",0,0,40.5,40.5,40.5,0,0,0,0,0],
		"111120":["☆5(1-1-1-1)",0,57,56.5,56.5,56.5,0,0,0,0,0],
		"000129":["☆5(0-0-0-1)",0,129,32.5,32.5,32.5,0,0,0,0,0],
		"600020":["☆5(6-0-0-0)",0,0,41.5,139,41.5,0,0,0,0,0],
		"060020":["☆5(0-6-0-0)",0,0,139,41.5,41.5,0,0,0,0,0],
		"006020":["☆5(0-0-6-0)",0,0,41.5,41.5,139,0,0,0,0,0],
		"1000014":["☆6(10-0-0-0)",0,0,0,0,0,0,0,62.5,225,62.5],
		"0100014":["☆6(0-10-0-0)",0,0,0,0,0,0,0,225,62.5,62.5],
		"0010014":["☆6(0-0-10-0)",0,0,0,0,0,0,0,62.5,62.5,225],
		"000028":["☆6(0-0-0-0)",0,0,0,0,0,0,0,106.5,106.5,106.5],
		"442023":["☆7(4-4-2-0)",0,0,0,0,0,0,0,220,220,110],
		"424023":["☆7(4-2-4-0)",0,0,0,0,0,0,0,110,220,220],
		"244023":["☆7(2-4-4-0)",0,0,0,0,0,0,0,220,110,220],
		"000029":["☆7(0-0-0-0)",0,0,0,0,0,0,0,183.5,183.5,183.5],
		"0001216":["☆7(0-0-0-12)",0,0,0,0,0,0,279,90,90,90],
		"544222":["☆8(5-4-4-2)",0,0,0,0,0,0,90,205,316,205],
		"454222":["☆8(4-5-4-2)",0,0,0,0,0,0,90,316,205,205],
		"445222":["☆8(4-4-5-2)",0,0,0,0,0,0,90,205,205,316],
		"0001531":["☆8(0-0-0-15)",0,0,0,0,0,0,450,175,175,175],
		"000037":["☆8(0-0-0-0)",0,0,0,0,0,0,262.5,262.5,262.5,262.5],
		"700438":["☆9(7-0-0-4)",0,0,0,0,0,0,600,125,900,125],
		"070438":["☆9(0-7-0-4)",0,0,0,0,0,0,600,900,125,125],
		"007438":["☆9(0-0-7-4)",0,0,0,0,0,0,600,125,125,900],
		"000041":["☆9(0-0-0-0)",0,0,0,0,0,0,195,600,600,600],
		"333317":["☆9(3-3-3-3)",0,0,0,0,0,0,468,469,469,469],
		"000049":["NPC拠点<font color=red size=＋4><br><b>NPC拠点と推測されます。中身をうかがい知ることは出来ません。</b></font>"],
		"333337":["君主城：プレイヤー本拠地<font color=red size=＋4><br><b>誰かの本拠地と推測されます。中身をうかがい知ることは出来ません。</b></font>"]
	}
,
	{
		// point14ki
		"type":['g'],
		"seasons":[14,15],
		"20009":["☆1(2-0-0-0)",8.5,0,0,0,0,0,0,0,0,0],
		"02009":["☆1(0-2-0-0)",8.5,0,0,0,0,0,0,0,0,0],
		"00209":["☆1(0-0-2-0)",8.5,0,0,0,0,0,0,0,0,0],
		"00029":["☆1(0-0-0-2)",8.5,0,0,0,0,0,0,0,0,0],
		"300014":["☆2(3-0-0-0)",0,0,2,20,2,0,0,0,0,0],
		"030014":["☆2(0-3-0-0)",0,0,20,2,2,0,0,0,0,0],
		"003014":["☆2(0-0-3-0)",0,0,2,2,20,0,0,0,0,0],
		"111121":["☆3(1-1-1-1)",0,15.5,21.5,21.5,21.5,0,0,0,0,0],
		"000126":["☆3(0-0-0-1)",0,47,8.5,8.5,8.5,0,0,0,0,0],
		"111016":["☆3(1-1-1-0)",0,0,24.5,24.5,24.5,0,0,0,0,0],
		"111127":["☆4(1-1-1-1)",0,72,32.5,32.5,32.5,0,0,0,0,0],
		"000813":["☆4(0-0-0-8)",0,91.5,23.5,23.5,23.5,0,0,0,0,0],
		"222218":["☆4(2-2-2-2)",0,39,41,41,41,0,0,0,0,0],
		"222019":["☆4(2-2-2-0)",0,0,52.5,52.5,52.5,0,0,0,0,0],
		"111120":["☆5(1-1-1-1)",0,74,73.5,73.5,73.5,0,0,0,0,0],
		"000129":["☆5(0-0-0-1)",0,167.5,42.5,42.5,42.5,0,0,0,0,0],
		"600020":["☆5(6-0-0-0)",0,0,54,180.5,54,0,0,0,0,0],
		"060020":["☆5(0-6-0-0)",0,0,180.5,54,54,0,0,0,0,0],
		"006020":["☆5(0-0-6-0)",0,0,54,54,180.5,0,0,0,0,0],
		"1000014":["☆6(10-0-0-0)",0,0,0,0,0,0,0,81.5,292.5,81.5],
		"0100014":["☆6(0-10-0-0)",0,0,0,0,0,0,0,292.5,81.5,81.5],
		"0010014":["☆6(0-0-10-0)",0,0,0,0,0,0,0,81.5,81.5,292.5],
		"000028":["☆6(0-0-0-0)",0,0,0,0,0,0,0,138.5,138.5,138.5],
		"442023":["☆7(4-4-2-0)",0,0,0,0,0,0,0,286,286,143],
		"424023":["☆7(4-2-4-0)",0,0,0,0,0,0,0,143,286,286],
		"244023":["☆7(2-4-4-0)",0,0,0,0,0,0,0,286,143,286],
		"000029":["☆7(0-0-0-0)",0,0,0,0,0,0,0,238.5,238.5,238.5],
		"0001216":["☆7(0-0-0-12)",0,0,0,0,0,0,362.5,117,117,117],
		"544222":["☆8(5-4-4-2)",0,0,0,0,0,0,117,266.5,411,266.5],
		"454222":["☆8(4-5-4-2)",0,0,0,0,0,0,117,411,266.5,266.5],
		"445222":["☆8(4-4-5-2)",0,0,0,0,0,0,117,266.5,266.5,411],
		"0001531":["☆8(0-0-0-15)",0,0,0,0,0,0,585,227.5,227.5,227.5],
		"000037":["☆8(0-0-0-0)",0,0,0,0,0,0,341.5,341.5,341.5,341.5],
		"700438":["☆9(7-0-0-4)",0,0,0,0,0,0,780,162.5,1170,162.5],
		"070438":["☆9(0-7-0-4)",0,0,0,0,0,0,780,1170,162.5,162.5],
		"007438":["☆9(0-0-7-4)",0,0,0,0,0,0,780,162.5,162.5,1170],
		"000041":["☆9(0-0-0-0)",0,0,0,0,0,0,253.5,780,780,780],
		"333317":["☆9(3-3-3-3)",0,0,0,0,0,0,608.5,609.5,609.5,609.5],
		"000049":["NPC拠点<font color=red size=＋4><br><b>NPC拠点と推測されます。中身をうかがい知ることは出来ません。</b></font>"],
		"333337":["君主城：プレイヤー本拠地<font color=red size=＋4><br><b>誰かの本拠地と推測されます。中身をうかがい知ることは出来ません。</b></font>"]
	}
,
	{
		// point16ki
		"type":['h'],
		"seasons":[16],
		"02009":["☆1(0-2-0-0)",11,0,0,0,0,0,0,0,0,0],
		"00209":["☆1(0-0-2-0)",11,0,0,0,0,0,0,0,0,0],
		"20009":["☆1(2-0-0-0)",11,0,0,0,0,0,0,0,0,0],
		"00029":["☆1(0-0-0-2)",11,0,0,0,0,0,0,0,0,0],
		"300014":["☆2(3-0-0-0)",0,0,2.5,26,2.5,0,0,0,0,0],
		"003014":["☆2(0-0-3-0)",0,0,2.5,2.5,26,0,0,0,0,0],
		"030014":["☆2(0-3-0-0)",0,0,26,2.5,2.5,0,0,0,0,0],
		"111121":["☆3(1-1-1-1)",0,20,28,28,28,0,0,0,0,0],
		"000126":["☆3(0-0-0-1)",0,61,11,11,11,0,0,0,0,0],
		"111016":["☆3(1-1-1-0)",0,0,32,32,32,0,0,0,0,0],
		"111127":["☆4(1-1-1-1)",0,94,42.5,42.5,42.5,0,0,0,0,0],
		"000813":["☆4(0-0-0-8)",0,119,30.5,30.5,30.5,0,0,0,0,0],
		"222218":["☆4(2-2-2-2)",0,50.5,53.5,53.5,53.5,0,0,0,0,0],
		"222019":["☆4(2-2-2-0)",0,0,68.5,68.5,68.5,0,0,0,0,0],
		"111120":["☆5(1-1-1-1)",0,96.5,95.5,95.5,95.5,0,0,0,0,0],
		"000129":["☆5(0-0-0-1)",0,218,55,55,55,0,0,0,0,0],
		"600020":["☆5(6-0-0-0)",0,0,70,235,70,0,0,0,0,0],
		"060020":["☆5(0-6-0-0)",0,0,235,70,70,0,0,0,0,0],
		"006020":["☆5(0-0-6-0)",0,0,70,70,235,0,0,0,0,0],
		"1000014":["☆6(10-0-0-0)",0,0,0,0,0,0,0,105.5,380.5,105.5],
		"0100014":["☆6(0-10-0-0)",0,0,0,0,0,0,0,380.5,105.5,105.5],
		"0010014":["☆6(0-0-10-0)",0,0,0,0,0,0,0,105.5,105.5,380.5],
		"000028":["☆6(0-0-0-0)",0,0,0,0,0,0,0,180,180,180],
		"442023":["☆7(4-4-2-0)",0,0,0,0,0,0,0,372,372,186],
		"424023":["☆7(4-2-4-0)",0,0,0,0,0,0,0,186,372,372],
		"244023":["☆7(2-4-4-0)",0,0,0,0,0,0,0,372,186,372],
		"000029":["☆7(0-0-0-0)",0,0,0,0,0,0,0,310,310,310],
		"0001216":["☆7(0-0-0-12)",0,0,0,0,0,0,471.5,152,152,152],
		"544222":["☆8(5-4-4-2)",0,0,0,0,0,0,152,346.5,534,346.5],
		"454222":["☆8(4-5-4-2)",0,0,0,0,0,0,152,534,346.5,346.5],
		"445222":["☆8(4-4-5-2)",0,0,0,0,0,0,152,346.5,346.5,534],
		"0001531":["☆8(0-0-0-15)",0,0,0,0,0,0,760.5,296,296,296],
		"000037":["☆8(0-0-0-0)",0,0,0,0,0,0,443.5,443.5,443.5,443.5],
		"700438":["☆9(7-0-0-4)",0,0,0,0,0,0,1014,211.5,1521,211.5],
		"070438":["☆9(0-7-0-4)",0,0,0,0,0,0,1014,1521,211.5,211.5],
		"007438":["☆9(0-0-7-4)",0,0,0,0,0,0,1014,211.5,211.5,1521],
		"000041":["☆9(0-0-0-0)",0,0,0,0,0,0,253.5,780,780,780],
		"333317":["☆9(3-3-3-3)",0,0,0,0,0,0,329.5,1014,1014,1014],
		"000049":["NPC拠点<font color=red size=＋4><br><b>NPC拠点と推測されます。中身をうかがい知ることは出来ません。</b></font>"],
		"333337":["君主城：プレイヤー本拠地<font color=red size=＋4><br><b>誰かの本拠地と推測されます。中身をうかがい知ることは出来ません。</b></font>"]
	}
];

// カードIDからレアリティ引く際に使うようにしているため、メンテ必須かつ移動禁止(2014/12/20)
var card_list =	{
	"1001":{n:"劉備",  r:"R", c:2.5, a:260, i:10, d1:330, bs:"仁君"},
	"1002":{n:"諸葛亮",  r:"SR", c:3.5, a:400, i:25, d1:495, bs:"神算鬼謀"},
	"1003":{n:"関羽",  r:"SR", c:4, a:475, i:13, d1:625, bs:"軍神"},
	"1004":{n:"張飛",  r:"SR", c:3, a:360, i:7, d1:295, bs:"槍兵の猛撃"},
	"1005":{n:"趙雲",  r:"R", c:3, a:335, i:10, d1:345, bs:"騎兵突撃"},
	"1006":{n:"馬超",  r:"SR", c:3, a:350, i:5, d1:322, bs:"騎兵の猛撃"},
	"1007":{n:"劉備",  r:"UC", c:2.5, a:245, i:10, d1:325, bs:"仁君"},
	"1008":{n:"諸葛亮",  r:"R", c:2.5, a:190, i:17, d1:275, bs:"食糧知識"},
	"1009":{n:"諸葛亮",  r:"UC", c:2.5, a:190, i:16, d1:260, bs:"奇計百出"},
	"1010":{n:"関羽",  r:"UC", c:2.5, a:270, i:7, d1:295, bs:"槍兵の進撃"},
	"1011":{n:"関羽",  r:"R", c:2.5, a:285, i:7, d1:300, bs:"槍兵の進撃"},
	"1012":{n:"張飛",  r:"UC", c:2.5, a:290, i:4, d1:230, bs:"豪傑"},
	"1013":{n:"張飛",  r:"C", c:2.5, a:275, i:4, d1:230, bs:"豪傑"},
	"1014":{n:"徐庶",  r:"UC", c:2, a:220, i:15, d1:300, bs:"奇計百出"},
	"1015":{n:"黄忠",  r:"UC", c:2, a:235, i:5, d1:255, bs:"弓兵突撃"},
	"1016":{n:"?統 ",  r:"R", c:2.5, a:240, i:23, d1:260, bs:"兵器の進撃"},
	"1017":{n:"廖化",  r:"UC", c:2, a:205, i:5, d1:235, bs:"槍兵防御"},
	"1018":{n:"廖化",  r:"C", c:2, a:200, i:5, d1:225, bs:"槍兵防御"},
	"1019":{n:"馬岱",  r:"UC", c:2.5, a:245, i:6, d1:245, bs:"騎兵の進撃"},
	"1020":{n:"馬岱",  r:"C", c:2.5, a:235, i:6, d1:245, bs:"騎兵の進撃"},
	"1021":{n:"周倉",  r:"UC", c:2, a:220, i:4, d1:125, bs:"豪傑"},
	"1022":{n:"関平",  r:"UC", c:2, a:195, i:7, d1:205, bs:"槍兵の進撃"},
	"1023":{n:"伊籍",  r:"UC", c:2, a:55, i:12, d1:85, bs:"伐採知識"},
	"1024":{n:"伊籍",  r:"C", c:2, a:55, i:12, d1:70, bs:"伐採知識"},
	"1025":{n:"沙摩柯",  r:"UC", c:1.5, a:155, i:1, d1:100, bs:"剣兵の進撃"},
	"1026":{n:"沙摩柯",  r:"C", c:1.5, a:145, i:1, d1:100, bs:"剣兵の進撃"},
	"1027":{n:"簡雍",  r:"UC", c:1.5, a:65, i:9, d1:55, bs:"食糧知識"},
	"1028":{n:"簡雍",  r:"C", c:1.5, a:65, i:9, d1:45, bs:"食糧知識"},
	"1029":{n:"雷銅",  r:"UC", c:2, a:195, i:5, d1:170, bs:"槍兵の進撃"},
	"1030":{n:"雷銅",  r:"C", c:2, a:185, i:5, d1:170, bs:"槍兵の進撃"},
	"1031":{n:"魏延",  r:"UC", c:2.5, a:265, i:7, d1:235, bs:"槍兵突撃"},
	"1032":{n:"魏延",  r:"C", c:2.5, a:250, i:7, d1:235, bs:"槍兵の進撃"},
	"1033":{n:"馬謖",  r:"UC", c:2, a:170, i:13, d1:200, bs:"製鉄知識"},
	"1034":{n:"馬謖",  r:"C", c:2, a:165, i:13, d1:190, bs:"剣兵の進撃"},
	"1035":{n:"劉備",  r:"SR", c:2.5, a:275, i:12, d1:355, bs:"昭烈帝"},
	"1036":{n:"徐庶",  r:"R", c:2, a:220, i:15, d1:320, bs:"八卦の陣"},
	"1037":{n:"趙雲",  r:"SR", c:3.5, a:425, i:17, d1:425, bs:"槍兵突覇"},
	"1038":{n:"黄忠",  r:"R", c:2.5, a:265, i:11, d1:300, bs:"弓兵の猛撃"},
	"1039":{n:"厳顔",  r:"UC", c:2, a:225, i:4, d1:255, bs:"弓兵方陣"},
	"1040":{n:"厳顔",  r:"C", c:2, a:205, i:4, d1:255, bs:"弓兵堅守"},
	"1041":{n:"姜維",  r:"SR", c:3.5, a:400, i:22, d1:435, bs:"麒麟児"},
	"1042":{n:"魏延",  r:"R", c:2.5, a:280, i:8, d1:240, bs:"槍兵の猛撃"},
	"1043":{n:"馬超",  r:"R", c:2.5, a:290, i:3, d1:225, bs:"騎兵突覇"},
	"1044":{n:"夏侯氏",  r:"SR", c:1, a:20, i:9, d1:100, bs:"伐採技巧"},
	"1045":{n:"法正",  r:"UC", c:2.5, a:185, i:16, d1:265, bs:"全軍の進攻令"},
	"1046":{n:"劉備",  r:"UR", c:3.5, a:420, i:20, d1:520, bs:"昭烈帝"},
	"1047":{n:"諸葛亮",  r:"UR", c:3.5, a:400, i:26, d1:495, bs:"臥龍覚醒"},
	"1048":{n:"関羽",  r:"UR", c:4, a:485, i:14, d1:625, bs:"軍神"},
	"1049":{n:"趙雲",  r:"UR", c:3.5, a:430, i:16, d1:530, bs:"強襲突覇"},
	"1050":{n:"張飛",  r:"UR", c:3.5, a:445, i:7, d1:500, bs:"槍兵の極撃"},
	"1051":{n:"馬超",  r:"UR", c:3.5, a:435, i:7, d1:500, bs:"騎兵突覇"},
	"1052":{n:"黄忠",  r:"SR", c:3, a:310, i:13, d1:395, bs:"弓兵突覇"},
	"1053":{n:"黄月英",  r:"SR", c:1, a:10, i:10, d1:90, bs:"槍兵増強"},
	"1054":{n:"甘夫人",  r:"SR", c:1, a:10, i:8, d1:70, bs:"騎兵増強"},
	"1055":{n:"沙摩柯",  r:"R", c:1.5, a:175, i:2, d1:110, bs:"強襲突撃"},
	"1056":{n:"張飛",  r:"R", c:3, a:335, i:5, d1:260, bs:"槍兵の強撃"},
	"1057":{n:"?統 ",  r:"SR", c:2, a:220, i:17, d1:250, bs:"市場繁栄"},
	"1058":{n:"関平",  r:"C", c:2, a:185, i:7, d1:205, bs:"急速援護"},
	"1059":{n:"黄忠",  r:"C", c:2, a:230, i:5, d1:255, bs:"弓兵強行"},
	"1060":{n:"馬岱",  r:"R", c:2.5, a:260, i:7, d1:290, bs:"騎兵の強撃"},
	"1061":{n:"姜維",  r:"UR", c:3.5, a:405, i:23, d1:440, bs:"槍将の采配"},
	"1062":{n:"劉備",  r:"UR", c:3.5, a:420, i:20, d1:520, bs:"蜀軍の極撃"},
	"1063":{n:"趙雲",  r:"UC", c:2.5, a:280, i:8, d1:230, bs:"騎兵の強撃"},
	"1064":{n:"王悦",  r:"SR", c:4, a:450, i:8, d1:440, bs:"勇将天戟"},
	"1065":{n:"孟達",  r:"R", c:3.5, a:405, i:6, d1:410, bs:"迅速劫略"},
	"1066":{n:"魏延",  r:"SR", c:3, a:345, i:8, d1:310, bs:"槍兵の極撃"},
	"1067":{n:"糜夫人",  r:"SR", c:1, a:10, i:9, d1:120, bs:"豊穣"},
	"1068":{n:"周倉",  r:"R", c:2, a:260, i:4, d1:250, bs:"一騎当千"},
	"1069":{n:"伊籍",  r:"R", c:2, a:55, i:16, d1:105, bs:"伐採技術"},
	"1070":{n:"?統 ",  r:"UC", c:2.5, a:180, i:17, d1:240, bs:"兵器の強撃"},
	"1071":{n:"劉禅",  r:"SR", c:1, a:20, i:5, d1:195, bs:"蜀軍の防衛"},
	"1072":{n:"厳顔",  r:"R", c:2, a:230, i:7, d1:265, bs:"弓兵修練"},
	"1073":{n:"黄忠",  r:"R", c:3, a:350, i:12, d1:305, bs:"一騎当千"},
	"1074":{n:"馬岱",  r:"SR", c:3, a:340, i:8, d1:355, bs:"騎兵の極撃"},
	"1075":{n:"黄忠",  r:"UR", c:3.5, a:440, i:13, d1:460, bs:"勇将飛矢"},
	"1076":{n:"姜維",  r:"R", c:3, a:330, i:17, d1:330, bs:"奇計百出"},
	"1077":{n:"敬哀皇后",  r:"SR", c:1, a:10, i:10, d1:145, bs:"護国芳心"},
	"1078":{n:"馬超",  r:"UC", c:2.5, a:270, i:3, d1:225, bs:"豪傑"},
	"1079":{n:"関羽",  r:"UR", c:4, a:500, i:15, d1:625, bs:"武神"},
	"1080":{n:"夏侯覇",  r:"SR", c:3, a:330, i:10, d1:450, bs:"槍兵突覇"},
	"1081":{n:"法正",  r:"SR", c:2.5, a:220, i:19, d1:260, bs:"槍兵の勝鬨"},
	"1082":{n:"馬謖",  r:"R", c:2, a:200, i:15, d1:240, bs:"厩舎修練"},
	"1083":{n:"諸葛亮",  r:"UR", c:3.5, a:400, i:27, d1:495, bs:"醒龍出師"},
	"1084":{n:"徐庶",  r:"SR", c:3, a:310, i:21, d1:400, bs:"智将器撃"},
	"1085":{n:"王平",  r:"R", c:2.5, a:280, i:10, d1:355, bs:"守護神"},
	"1086":{n:"張飛",  r:"UR", c:3.5, a:470, i:8, d1:480, bs:"燕人武陣"},
	"1087":{n:"関興",  r:"SR", c:3.5, a:430, i:10, d1:450, bs:"槍兵の猛撃"},
	"1088":{n:"関平",  r:"R", c:2.5, a:280, i:10, d1:300, bs:"千里行"},
	"1089":{n:"劉備",  r:"R", c:2.5, a:260, i:10, d1:330, bs:"八卦の陣"},
	"1090":{n:"関羽",  r:"UC", c:2.5, a:270, i:7, d1:295, bs:"槍兵突撃"},
	"1091":{n:"張飛",  r:"UC", c:2.5, a:290, i:4, d1:230, bs:"槍兵の強撃"},
	"1092":{n:"魏延",  r:"UR", c:3.5, a:450, i:12, d1:410, bs:"拠点襲撃"},
	"1093":{n:"沙摩柯",  r:"SR", c:2, a:280, i:2, d1:140, bs:"胡王の猛襲"},
	"1094":{n:"馬超",  r:"SR", c:3.5, a:430, i:5, d1:420, bs:"軍神"},
	"1095":{n:"趙雲",  r:"UR", c:4, a:500, i:20, d1:520, bs:"蜀将の督戦"},
	"1096":{n:"関索",  r:"SR", c:3.5, a:400, i:10, d1:470, bs:"勇美鼓舞"},
	"1097":{n:"劉封",  r:"R", c:2.5, a:250, i:8, d1:345, bs:"守護堅陣"},
	"1098":{n:"劉備",  r:"UR", c:3.5, a:460, i:21, d1:535, bs:"皇叔の号令"},
	"1099":{n:"黄忠",  r:"SR", c:3.5, a:430, i:13, d1:430, bs:"老将統帥"},
	"1100":{n:"糜夫人",  r:"R", c:1, a:10, i:10, d1:120, bs:"憂姫護国"},
	"1101":{n:"関羽",  r:"UC", c:3, a:350, i:9, d1:345, bs:"槍兵の強撃"},
	"1102":{n:"姜維",  r:"UR", c:3.5, a:430, i:23, d1:440, bs:"麒麟慈心"},
	"1103":{n:"関銀屏",  r:"SR", c:3, a:320, i:12, d1:320, bs:"槍兵の猛攻"},
	"1104":{n:"夏侯氏",  r:"R", c:1, a:10, i:8, d1:80, bs:"恵風"},
	"1105":{n:"馬謖",  r:"SR", c:2.5, a:230, i:18, d1:300, bs:"矛槍兵移送"},
	"1106":{n:"?統 ",  r:"UR", c:3.5, a:360, i:27, d1:480, bs:"連環の計"},
	"1107":{n:"張飛",  r:"R", c:3.5, a:400, i:5, d1:430, bs:"猛虎進撃"},
	"1108":{n:"王平",  r:"UC", c:2.5, a:260, i:9, d1:340, bs:"槍兵方陣"},
	"1109":{n:"夏侯覇",  r:"R", c:2.5, a:280, i:9, d1:380, bs:"趁火打劫"},
	"1110":{n:"劉備",  r:"UR", c:3.5, a:435, i:20, d1:505, bs:"槍兵の極攻"},
	"1111":{n:"周倉",  r:"SR", c:3, a:345, i:4, d1:335, bs:"迅速劫略"},
	"1112":{n:"関興",  r:"R", c:3, a:330, i:8, d1:355, bs:"発憤興起"},
	"1113":{n:"鮑三娘",  r:"SR", c:2, a:275, i:5, d1:130, bs:"戦女の行軍"},
	"1114":{n:"関索",  r:"R", c:1.5, a:230, i:7, d1:210, bs:"一騎当千"},
	"1115":{n:"黄月英",  r:"UR", c:1, a:20, i:12, d1:120, bs:"賢女の策略"},
	"1116":{n:"馬岱",  r:"R", c:2.5, a:290, i:7, d1:265, bs:"騎兵の強攻"},
	"1117":{n:"馬雲緑",  r:"SR", c:3.5, a:400, i:6, d1:310, bs:"騎神降臨"},
	"1118":{n:"張姫",  r:"SR", c:3.5, a:415, i:8, d1:350, bs:"槍神降臨"},
	"1119":{n:"厳顔",  r:"SR", c:3, a:340, i:9, d1:460, bs:"勇猛果敢"},
	"1120":{n:"雷銅",  r:"R", c:2.5, a:285, i:7, d1:275, bs:"槍兵速攻"},
	"1121":{n:"馬良",  r:"R", c:2, a:150, i:17, d1:260, bs:"槍兵急配"},
	"1122":{n:"蒋欽",  r:"R", c:1.5, a:110, i:13, d1:105, bs:"製鉄技術"},
	"1123":{n:"劉禅",  r:"UC", c:1.5, a:40, i:6, d1:120, bs:"仁君"},
	"1124":{n:"王桃",  r:"UR", c:2, a:265, i:4, d1:140, bs:"桃賊の襲撃"},
	"1125":{n:"劉備・諸葛",  r:"UR", c:4, a:510, i:24, d1:635, bs:"劉備の大徳"},
	"1126":{n:"姜維",  r:"SR", c:1.5, a:150, i:17, d1:255, bs:"槍兵の大号令"},
	"1127":{n:"孫尚香",  r:"R", c:1.5, a:225, i:9, d1:240, bs:"勇姫督励"},
	"1128":{n:"趙雲",  r:"R", c:3.5, a:400, i:17, d1:445, bs:"飛将"},
	"1129":{n:"黄忠",  r:"UC", c:3, a:350, i:12, d1:360, bs:"弓兵の進攻"},
	"1130":{n:"沙摩柯",  r:"UR", c:2, a:295, i:3, d1:185, bs:"胡王奮迅"},
	"1131":{n:"関興",  r:"UR", c:2, a:290, i:11, d1:290, bs:"神速劫略"},
	"1132":{n:"張飛",  r:"UR", c:4, a:525, i:8, d1:500, bs:"燕神破軍"},
	"1133":{n:"張姫",  r:"UC", c:3, a:295, i:7, d1:330, bs:"槍兵速攻"},
	"1134":{n:"孫尚香",  r:"SR", c:1.5, a:210, i:14, d1:265, bs:"劉備の契り"},
	"1135":{n:"趙雲",  r:"SR", c:3.5, a:410, i:10, d1:425, bs:"騎兵の猛攻"},
	"1136":{n:"関羽",  r:"R", c:3, a:320, i:9, d1:335, bs:"騎兵の極撃"},
	"1137":{n:"張飛",  r:"R", c:3, a:330, i:5, d1:330, bs:"槍兵の極撃"},
	"1138":{n:"黄忠",  r:"R", c:3, a:340, i:11, d1:345, bs:"弓兵の極撃"},
	"1139":{n:"穆皇后",  r:"SR", c:1.5, a:20, i:10, d1:200, bs:"賢妃施政"},
	"1140":{n:"姜維",  r:"UC", c:2.5, a:270, i:16, d1:325, bs:"兵器の猛撃"},
	"1141":{n:"諸葛亮",  r:"UR", c:3.5, a:350, i:22, d1:440, bs:"三顧の礼"},
	"1142":{n:"馬雲緑",  r:"R", c:3.5, a:395, i:6, d1:280, bs:"猛将の極意"},
	"1143":{n:"呉蘭",  r:"R", c:4, a:400, i:9, d1:445, bs:"闘将の極意"},
	"1144":{n:"夏侯覇",  r:"UC", c:3, a:330, i:8, d1:320, bs:"闘将突貫"},
	"1145":{n:"廖化",  r:"SR", c:4, a:480, i:7, d1:595, bs:"強襲烈覇"},
	"1146":{n:"関銀屏",  r:"R", c:3.5, a:415, i:10, d1:420, bs:"槍兵突攻"},
	"1147":{n:"王平",  r:"SR", c:4, a:380, i:13, d1:605, bs:"槍兵の大聖域"},
	"1148":{n:"黄月英",  r:"UC", c:3, a:140, i:19, d1:315, bs:"兵舎修練"},
	"1149":{n:"甘夫人",  r:"UC", c:3, a:130, i:17, d1:330, bs:"厩舎修練"},
	"1150":{n:"関銀屏・関羽",  r:"UR", c:4, a:530, i:15, d1:520, bs:"天里雷光"},
	"1151":{n:"沙摩柯",  r:"SR", c:4, a:460, i:3, d1:450, bs:"勇将飛矢"},
	"1152":{n:"黄忠・厳顔",  r:"UR", c:4, a:550, i:15, d1:495, bs:"歴戦の弓将"},
	"1153":{n:"孫尚香",  r:"SR", c:1.5, a:150, i:10, d1:165, bs:"勇躍の舞"},
	"1154":{n:"張姫",  r:"R", c:3.5, a:415, i:8, d1:420, bs:"飛将"},
	"1155":{n:"張苞",  r:"UR", c:4, a:515, i:14, d1:440, bs:"鹵獲の極攻"},
	"1156":{n:"姜維",  r:"SR", c:3.5, a:420, i:20, d1:430, bs:"槍兵の猛攻"},
	"1157":{n:"夏侯氏",  r:"R", c:3, a:360, i:11, d1:370, bs:"燕人武陣"},
	"1158":{n:"甘夫人",  r:"UR", c:2, a:265, i:14, d1:215, bs:"劉備の大徳"},
	"1159":{n:"徐庶",  r:"UR", c:4, a:430, i:26, d1:495, bs:"全軍の極攻令"},
	"1160":{n:"関銀屏",  r:"SR", c:4, a:450, i:12, d1:490, bs:"全軍の猛攻令"},
	"1162":{n:"王桃",  r:"SR", c:3.5, a:360, i:5, d1:450, bs:"桃賊の襲撃"},
	"1163":{n:"張苞",  r:"SR", c:4, a:465, i:12, d1:425, bs:"猛将の極意"},
	"1164":{n:"王悦",  r:"UR", c:2.5, a:290, i:9, d1:230, bs:"槍兵速攻"},
	"1165":{n:"孟達",  r:"UR", c:4, a:480, i:8, d1:470, bs:"謀反の極攻"},
	"1166":{n:"張苞・関興",  r:"UR", c:4, a:570, i:15, d1:450, bs:"槍兵の大神撃"},
	"1167":{n:"張翼",  r:"SR", c:4, a:485, i:10, d1:470, bs:"槍兵の大極撃"},
	"1168":{n:"馬良",  r:"SR", c:2, a:200, i:18, d1:300, bs:"領地統制"},
	"1169":{n:"鮑三娘",  r:"R", c:3.5, a:380, i:5, d1:395, bs:"騎神降臨"},
	"1170":{n:"敬哀皇后",  r:"R", c:2, a:30, i:10, d1:70, bs:"市場来福"},
	"1171":{n:"劉封",  r:"UC", c:1, a:90, i:7, d1:170, bs:"守護防陣"},
	"1172":{n:"王桃",  r:"UR", c:2, a:240, i:4, d1:210, bs:"蜀軍の極撃"},
	"1173":{n:"関銀屏",  r:"SR", c:3.5, a:405, i:13, d1:480, bs:"戦女の行軍"},
	"1174":{n:"黄月英",  r:"SR", c:1.5, a:100, i:17, d1:210, bs:"衝車急配"},
	"1175":{n:"関平",  r:"UR", c:4, a:490, i:12, d1:500, bs:"飛速雷光"},
	"1176":{n:"馬岱",  r:"SR", c:3.5, a:420, i:8, d1:355, bs:"飛速"},
	"1177":{n:"馬鉄",  r:"UC", c:2, a:200, i:6, d1:195, bs:"烈速"},
	"1178":{n:"姜維",  r:"L", c:4, a:640, i:25, d1:610, bs:"槍兵の大天撃"},
	"1179":{n:"馬謖",  r:"UR", c:4, a:370, i:21, d1:810, bs:"槍兵の大神域"},
	"1180":{n:"甘夫人",  r:"SR", c:3.5, a:410, i:16, d1:435, bs:"烈速雷光"},
	"1181":{n:"関羽",  r:"L", c:4, a:700, i:16, d1:620, bs:"龍神の極意"},
	"1182":{n:"趙雲",  r:"L", c:4, a:630, i:21, d1:585, bs:"騎兵の大極攻"},
	"1183":{n:"馬岱",  r:"UR", c:4, a:380, i:10, d1:725, bs:"騎将の封聖域"},
	"1184":{n:"関銀屏",  r:"UR", c:4, a:515, i:15, d1:425, bs:"天里迅雷"},
	"1185":{n:"王桃",  r:"SR", c:4, a:455, i:6, d1:440, bs:"謀反の極攻"},
	"1186":{n:"王桃",  r:"R", c:3, a:335, i:4, d1:320, bs:"猛将の鹵獲"},
	"1187":{n:"穆皇后",  r:"UR", c:1, a:30, i:11, d1:170, bs:"護国誠心"},
	"1188":{n:"?統",  r:"L", c:4, a:530, i:26, d1:560, bs:"攻城戦の大神砕"},
	"1189":{n:"馬良",  r:"UR", c:4, a:420, i:25, d1:595, bs:"兵器の大神撃"},
	"1190":{n:"厳顔",  r:"L", c:4, a:490, i:15, d1:865, bs:"弓兵の大天域"},
	"1191":{n:"関平",  r:"R", c:3, a:340, i:11, d1:335, bs:"神隠雷光"},
	"1192":{n:"張飛",  r:"L", c:4, a:700, i:10, d1:590, bs:"無双"},
	"1193":{n:"法正",  r:"UR", c:4, a:405, i:25, d1:495, bs:"機略謀略"},
	"1194":{n:"馬雲緑",  r:"SR", c:4, a:460, i:10, d1:460, bs:"全軍の烈速令"},
	"1195":{n:"穆皇后",  r:"SR", c:3.5, a:415, i:22, d1:380, bs:"猛暑の縮地収穫"},
	"1196":{n:"関興",  r:"UR", c:4, a:520, i:13, d1:485, bs:"槍兵烈攻"},
	"1197":{n:"諸葛亮・劉禅",  r:"L", c:4.5, a:650, i:23, d1:1155, bs:"天衣無縫"},
	"1198":{n:"糜夫人",  r:"UR", c:1, a:20, i:10, d1:120, bs:"守衛招来"},
	"1199":{n:"李厳",  r:"SR", c:4, a:515, i:20, d1:415, bs:"槍兵の大神撃"},
	"1200":{n:"呉懿",  r:"R", c:4, a:440, i:15, d1:495, bs:"剣兵の極攻"},
	"1201":{n:"夏侯氏",  r:"R", c:1, a:30, i:10, d1:120, bs:"槍兵増勢"},
	"1202":{n:"張翼",  r:"R", c:3.5, a:430, i:9, d1:445, bs:"神飛将"},
	"2001":{n:"曹操",  r:"SR", c:3.5, a:415, i:22, d1:520, bs:"魏王の号令"},
	"2002":{n:"司馬懿",  r:"SR", c:3.5, a:385, i:24, d1:535, bs:"深慮遠謀"},
	"2003":{n:"荀彧",  r:"R", c:2, a:25, i:15, d1:135, bs:"王佐の才"},
	"2004":{n:"夏侯惇",  r:"R", c:2.5, a:275, i:6, d1:310, bs:"騎兵の進撃"},
	"2005":{n:"張遼",  r:"SR", c:3, a:320, i:11, d1:390, bs:"覇王の進撃"},
	"2006":{n:"張? ",  r:"R", c:2.5, a:270, i:8, d1:315, bs:"騎兵突撃"},
	"2007":{n:"曹操",  r:"R", c:3, a:310, i:16, d1:370, bs:"英雄"},
	"2008":{n:"曹操",  r:"UC", c:3, a:300, i:15, d1:370, bs:"英雄"},
	"2009":{n:"夏侯惇",  r:"UC", c:2.5, a:260, i:6, d1:305, bs:"騎兵の進撃"},
	"2010":{n:"夏侯淵",  r:"UC", c:2.5, a:275, i:5, d1:270, bs:"弓兵の進撃"},
	"2011":{n:"夏侯淵",  r:"C", c:2.5, a:265, i:5, d1:270, bs:"弓兵の進撃"},
	"2012":{n:"許?",  r:"UC", c:3, a:230, i:3, d1:390, bs:"槍兵防御"},
	"2013":{n:"典韋",  r:"R", c:3, a:225, i:4, d1:395, bs:"鉄壁"},
	"2014":{n:"曹仁",  r:"UC", c:2.5, a:245, i:6, d1:320, bs:"騎兵の進撃"},
	"2015":{n:"曹仁",  r:"C", c:2.5, a:245, i:6, d1:305, bs:"騎兵の進撃"},
	"2016":{n:"徐晃",  r:"UC", c:2.5, a:275, i:9, d1:320, bs:"槍兵突撃"},
	"2017":{n:"于禁",  r:"UC", c:2, a:185, i:9, d1:245, bs:"騎兵防御"},
	"2018":{n:"于禁",  r:"C", c:2, a:185, i:8, d1:245, bs:"騎兵の進撃"},
	"2019":{n:"張? ",  r:"UC", c:2.5, a:255, i:8, d1:310, bs:"騎兵突撃"},
	"2020":{n:"蔡瑁",  r:"UC", c:2, a:180, i:9, d1:235, bs:"弓兵の進撃"},
	"2021":{n:"蔡瑁",  r:"C", c:2, a:175, i:9, d1:225, bs:"弓兵防御"},
	"2022":{n:"文聘",  r:"UC", c:2.5, a:225, i:8, d1:305, bs:"槍兵防御"},
	"2023":{n:"文聘",  r:"C", c:2.5, a:225, i:7, d1:305, bs:"槍兵防御"},
	"2024":{n:"張魯",  r:"UC", c:2, a:70, i:11, d1:170, bs:"食糧知識"},
	"2025":{n:"張魯",  r:"C", c:2, a:70, i:11, d1:150, bs:"食糧知識"},
	"2026":{n:"曹真",  r:"UC", c:2, a:225, i:9, d1:240, bs:"騎兵の進撃"},
	"2027":{n:"張允",  r:"UC", c:1.5, a:130, i:4, d1:165, bs:"弓兵行軍"},
	"2028":{n:"張允",  r:"C", c:1.5, a:135, i:4, d1:130, bs:"弓兵行軍"},
	"2029":{n:"華?",  r:"UC", c:2, a:85, i:13, d1:35, bs:"製鉄知識"},
	"2030":{n:"華?",  r:"C", c:2, a:85, i:12, d1:35, bs:"練兵訓練"},
	"2031":{n:"朱霊",  r:"UC", c:2, a:205, i:7, d1:200, bs:"厩舎訓練"},
	"2032":{n:"朱霊",  r:"C", c:2, a:190, i:7, d1:200, bs:"厩舎訓練"},
	"2033":{n:"曹昂",  r:"UC", c:1.5, a:125, i:6, d1:180, bs:"騎兵防御"},
	"2034":{n:"曹昂",  r:"C", c:1.5, a:125, i:6, d1:165, bs:"騎兵防御"},
	"2035":{n:"楽進",  r:"UC", c:2.5, a:280, i:4, d1:265, bs:"騎兵突撃"},
	"2036":{n:"楽進",  r:"C", c:2.5, a:265, i:4, d1:265, bs:"豪傑"},
	"2037":{n:"曹休",  r:"UC", c:2, a:215, i:7, d1:225, bs:"騎兵防御"},
	"2038":{n:"曹休",  r:"C", c:2, a:200, i:7, d1:225, bs:"騎兵防御"},
	"2039":{n:"曹操",  r:"R", c:2.5, a:270, i:15, d1:300, bs:"覇道"},
	"2040":{n:"賈?",  r:"R", c:2, a:235, i:15, d1:200, bs:"兵器の強撃"},
	"2041":{n:"賈?",  r:"UC", c:2, a:215, i:15, d1:200, bs:"兵器強行"},
	"2042":{n:"郭嘉",  r:"SR", c:2, a:250, i:17, d1:260, bs:"神算鬼謀"},
	"2043":{n:"夏侯惇",  r:"R", c:3, a:330, i:9, d1:345, bs:"騎兵の猛撃"},
	"2044":{n:"夏侯淵",  r:"R", c:3, a:315, i:11, d1:370, bs:"弓兵突撃"},
	"2045":{n:"曹洪",  r:"UC", c:2, a:215, i:5, d1:240, bs:"騎兵の強撃"},
	"2046":{n:"曹洪",  r:"C", c:2, a:210, i:5, d1:235, bs:"剣兵の強撃"},
	"2047":{n:"司馬懿",  r:"R", c:2.5, a:275, i:18, d1:345, bs:"神速"},
	"2048":{n:"甄姫",  r:"R", c:1, a:35, i:8, d1:155, bs:"強兵の檄文"},
	"2049":{n:"典韋",  r:"R", c:3, a:355, i:4, d1:275, bs:"一騎当千"},
	"2050":{n:"典韋",  r:"UC", c:3, a:325, i:4, d1:275, bs:"豪傑"},
	"2051":{n:"曹操",  r:"UR", c:3.5, a:420, i:22, d1:520, bs:"魏武王"},
	"2052":{n:"張遼",  r:"UR", c:3.5, a:490, i:13, d1:625, bs:"覇王の進撃"},
	"2053":{n:"程昱",  r:"R", c:2, a:150, i:17, d1:260, bs:"剣兵急配"},
	"2054":{n:"董昭",  r:"UR", c:4, a:450, i:26, d1:565, bs:"全軍の極攻令"},
	"2055":{n:"曹休",  r:"SR", c:2.5, a:295, i:10, d1:295, bs:"弓兵突攻"},
	"2056":{n:"曹真",  r:"C", c:2, a:220, i:9, d1:240, bs:"騎兵の進撃"},
	"2057":{n:"曹仁",  r:"R", c:2.5, a:260, i:6, d1:385, bs:"騎兵堅守"},
	"2058":{n:"夏侯惇",  r:"UR", c:3.5, a:430, i:13, d1:490, bs:"騎兵の極撃"},
	"2059":{n:"張? ",  r:"SR", c:2.5, a:285, i:8, d1:330, bs:"騎兵の猛撃"},
	"2060":{n:"許?",  r:"UR", c:3.5, a:370, i:8, d1:590, bs:"王者の護り"},
	"2061":{n:"徐晃",  r:"R", c:3, a:315, i:10, d1:345, bs:"槍兵突覇"},
	"2062":{n:"賈?",  r:"SR", c:2, a:235, i:17, d1:270, bs:"市場知識"},
	"2063":{n:"夏侯淵",  r:"UR", c:3.5, a:430, i:11, d1:510, bs:"軍神"},
	"2064":{n:"典韋",  r:"SR", c:3, a:305, i:7, d1:455, bs:"迅速援護"},
	"2065":{n:"司馬懿",  r:"UR", c:3.5, a:385, i:25, d1:535, bs:"騎将の采配"},
	"2066":{n:"曹操",  r:"UR", c:3.5, a:420, i:22, d1:520, bs:"魏軍の極撃"},
	"2067":{n:"張遼",  r:"R", c:3, a:320, i:8, d1:385, bs:"強襲突撃"},
	"2068":{n:"郭嘉",  r:"R", c:2, a:230, i:15, d1:210, bs:"剣兵突覇"},
	"2069":{n:"程昱",  r:"SR", c:2, a:240, i:17, d1:260, bs:"兵器の極撃"},
	"2070":{n:"荀彧",  r:"UC", c:2, a:25, i:15, d1:130, bs:"石切知識"},
	"2071":{n:"許?",  r:"UR", c:3.5, a:340, i:5, d1:640, bs:"守将の進軍"},
	"2072":{n:"甄姫",  r:"SR", c:1, a:35, i:9, d1:155, bs:"農林技術"},
	"2073":{n:"曹丕",  r:"UR", c:3.5, a:420, i:22, d1:540, bs:"魏軍の防衛"},
	"2074":{n:"于禁",  r:"R", c:2, a:200, i:9, d1:265, bs:"騎兵の強撃"},
	"2075":{n:"郭嘉",  r:"SR", c:4, a:400, i:23, d1:485, bs:"全軍の猛攻令"},
	"2076":{n:"郭嘉",  r:"UC", c:2, a:225, i:15, d1:180, bs:"加工知識"},
	"2077":{n:"張遼",  r:"UC", c:2.5, a:280, i:6, d1:265, bs:"騎兵の強撃"},
	"2078":{n:"李典",  r:"R", c:2, a:230, i:12, d1:295, bs:"槍兵の聖域"},
	"2079":{n:"鐘会",  r:"SR", c:3, a:320, i:15, d1:380, bs:"槍兵の極撃"},
	"2080":{n:"曹洪",  r:"R", c:2, a:245, i:5, d1:260, bs:"騎兵突覇"},
	"2081":{n:"曹休",  r:"R", c:2, a:240, i:10, d1:320, bs:"騎兵の聖域"},
	"2082":{n:"卞夫人",  r:"SR", c:1, a:10, i:9, d1:95, bs:"美玉歌舞"},
	"2083":{n:"甄姫",  r:"UR", c:1, a:35, i:10, d1:155, bs:"皇后の慈愛"},
	"2084":{n:"荀彧",  r:"SR", c:2.5, a:220, i:18, d1:200, bs:"神算鬼謀"},
	"2085":{n:"鄧艾",  r:"SR", c:3.5, a:390, i:22, d1:520, bs:"地の利堅壁"},
	"2086":{n:"楽進",  r:"SR", c:3.5, a:430, i:10, d1:435, bs:"猛将の鹵獲"},
	"2087":{n:"張春華",  r:"SR", c:1, a:20, i:9, d1:155, bs:"出撃見舞"},
	"2088":{n:"曹操",  r:"UR", c:3.5, a:480, i:23, d1:520, bs:"魏王の覇軍"},
	"2089":{n:"許?",  r:"SR", c:3.5, a:360, i:5, d1:600, bs:"忠節不落"},
	"2090":{n:"卞夫人",  r:"R", c:1, a:10, i:9, d1:85, bs:"豊穣"},
	"2091":{n:"夏侯惇",  r:"UC", c:3, a:330, i:8, d1:345, bs:"騎兵の強撃"},
	"2092":{n:"典韋",  r:"UR", c:4, a:500, i:8, d1:470, bs:"槍兵の大極撃"},
	"2093":{n:"夏侯淵",  r:"SR", c:3.5, a:410, i:11, d1:440, bs:"弓兵の極撃"},
	"2094":{n:"賈?",  r:"UR", c:3, a:310, i:22, d1:220, bs:"奇略布陣"},
	"2095":{n:"曹彰",  r:"SR", c:3.5, a:430, i:9, d1:420, bs:"天弓雨撃"},
	"2096":{n:"曹操",  r:"R", c:3, a:310, i:16, d1:370, bs:"奇計百出"},
	"2097":{n:"夏侯惇",  r:"UC", c:2.5, a:260, i:6, d1:305, bs:"騎兵の強撃"},
	"2098":{n:"許?",  r:"UC", c:3, a:230, i:3, d1:390, bs:"槍兵方陣"},
	"2099":{n:"華佗",  r:"SR", c:2, a:90, i:18, d1:190, bs:"神医の施術"},
	"2100":{n:"司馬懿",  r:"UR", c:3.5, a:320, i:27, d1:540, bs:"混元一気"},
	"2101":{n:"荀攸",  r:"SR", c:2.5, a:210, i:18, d1:200, bs:"騎兵の勝鬨"},
	"2102":{n:"夏侯惇",  r:"UR", c:3.5, a:435, i:14, d1:480, bs:"魏将の督戦"},
	"2103":{n:"曹植",  r:"SR", c:2, a:25, i:17, d1:80, bs:"強兵の檄文"},
	"2104":{n:"張遼",  r:"UR", c:3.5, a:495, i:13, d1:625, bs:"戦蹄轟撃"},
	"2105":{n:"曹操",  r:"R", c:3, a:300, i:16, d1:370, bs:"騎兵突撃"},
	"2106":{n:"曹仁",  r:"SR", c:3.5, a:400, i:8, d1:360, bs:"隣地猛攻"},
	"2107":{n:"司馬昭",  r:"SR", c:2.5, a:280, i:18, d1:260, bs:"近衛騎兵移送"},
	"2108":{n:"張? ",  r:"UR", c:3.5, a:440, i:16, d1:430, bs:"騎兵の大極撃"},
	"2109":{n:"徐晃",  r:"SR", c:3.5, a:420, i:15, d1:440, bs:"騎兵の猛攻"},
	"2110":{n:"?徳",  r:"SR", c:3.5, a:435, i:13, d1:450, bs:"猛将突貫"},
	"2111":{n:"楽進",  r:"R", c:3, a:325, i:9, d1:370, bs:"槍兵の猛撃"},
	"2112":{n:"辛憲英",  r:"SR", c:1, a:10, i:10, d1:110, bs:"才媛献策"},
	"2113":{n:"夏侯淵",  r:"R", c:3, a:295, i:9, d1:330, bs:"急襲"},
	"2114":{n:"曹操",  r:"UR", c:3.5, a:430, i:22, d1:515, bs:"騎兵の極攻"},
	"2115":{n:"夏侯惇",  r:"SR", c:3.5, a:425, i:11, d1:430, bs:"隻眼将の軍略"},
	"2116":{n:"許?",  r:"R", c:3, a:250, i:4, d1:435, bs:"守将の出陣"},
	"2117":{n:"曹彰",  r:"R", c:3, a:340, i:7, d1:345, bs:"弓兵の強攻"},
	"2118":{n:"司馬懿",  r:"UC", c:2.5, a:200, i:16, d1:240, bs:"覇道"},
	"2119":{n:"典韋・許?",	r:"UR", c:4, a:500, i:9, d1:640, bs:"守神の進撃"},
	"2120":{n:"賈?",  r:"SR", c:1.5, a:150, i:17, d1:220, bs:"騎兵の大号令"},
	"2121":{n:"張春華",  r:"R", c:1, a:15, i:9, d1:135, bs:"才女の瞳"},
	"2122":{n:"辛憲英",  r:"R", c:1, a:10, i:10, d1:100, bs:"聡明叡知"},
	"2123":{n:"張遼",  r:"UC", c:3, a:350, i:8, d1:335, bs:"騎兵の進攻"},
	"2124":{n:"郭嘉",  r:"UR", c:3, a:300, i:22, d1:230, bs:"才略謀略"},
	"2125":{n:"鄧艾",  r:"R", c:3, a:290, i:17, d1:395, bs:"擒賊擒王"},
	"2126":{n:"郭夫人",  r:"UR", c:1.5, a:30, i:10, d1:180, bs:"帝妃都政"},
	"2127":{n:"鐘会",  r:"R", c:2.5, a:200, i:17, d1:320, bs:"堅牢知略"},
	"2128":{n:"司馬炎",  r:"SR", c:2, a:240, i:17, d1:300, bs:"混元一気"},
	"2129":{n:"関羽",  r:"UR", c:4, a:515, i:15, d1:540, bs:"鬼神"},
	"2130":{n:"曹仁",  r:"UR", c:3.5, a:435, i:8, d1:370, bs:"遠地猛攻"},
	"2131":{n:"王元姫",  r:"SR", c:1.5, a:85, i:15, d1:110, bs:"才媛眼識"},
	"2132":{n:"?昭",  r:"SR", c:3, a:320, i:11, d1:460, bs:"堅忍不抜"},
	"2133":{n:"夏侯覇",  r:"R", c:3.5, a:410, i:11, d1:460, bs:"飛将"},
	"2134":{n:"?徳",  r:"R", c:3.5, a:435, i:13, d1:450, bs:"闘将の極意"},
	"2135":{n:"夏侯淵",  r:"UR", c:3.5, a:435, i:11, d1:460, bs:"刹那の奇襲"},
	"2136":{n:"荀攸",  r:"R", c:2, a:150, i:17, d1:260, bs:"騎兵急配"},
	"2137":{n:"于禁",  r:"UR", c:4, a:545, i:11, d1:490, bs:"戦神の極意"},
	"2138":{n:"文聘",  r:"R", c:3.5, a:380, i:9, d1:700, bs:"金剛不壊"},
	"2139":{n:"王異",  r:"UR", c:3.5, a:410, i:10, d1:620, bs:"守護聖陣"},
	"2140":{n:"司馬師・昭",  r:"UR", c:4, a:560, i:24, d1:400, bs:"騎兵の大神撃"},
	"2141":{n:"張允",  r:"R", c:2, a:200, i:8, d1:285, bs:"城壁補強"},
	"2142":{n:"楽進",  r:"SR", c:4, a:480, i:10, d1:460, bs:"騎兵の大極撃"},
	"2143":{n:"丁夫人",  r:"SR", c:1, a:10, i:10, d1:100, bs:"悲嘆の舞"},
	"2144":{n:"趙娥",  r:"R", c:3.5, a:390, i:10, d1:400, bs:"剣神降臨"},
	"2145":{n:"郭夫人",  r:"R", c:2, a:15, i:10, d1:80, bs:"麗妃都政"},
	"2146":{n:"鄧艾",  r:"UC", c:1, a:160, i:9, d1:120, bs:"万夫不当"},
	"2147":{n:"司馬昭",  r:"R", c:3, a:310, i:19, d1:160, bs:"麒麟児"},
	"2148":{n:"曹真",  r:"R", c:3, a:345, i:11, d1:280, bs:"闘将突貫"},
	"2149":{n:"卞夫人",  r:"R", c:1, a:20, i:9, d1:70, bs:"優雅な調べ"},
	"2150":{n:"司馬炎",  r:"R", c:3, a:355, i:16, d1:390, bs:"覇王の強攻"},
	"2151":{n:"朱霊",  r:"R", c:3.5, a:385, i:8, d1:400, bs:"神速雷光"},
	"2152":{n:"荀彧",  r:"SR", c:3, a:280, i:21, d1:450, bs:"隣地攻城"},
	"2153":{n:"曹憲",  r:"SR", c:2, a:260, i:12, d1:245, bs:"神速劫略"},
	"2154":{n:"曹節",  r:"UR", c:2, a:240, i:11, d1:180, bs:"魏軍の極撃"},
	"2155":{n:"曹華",  r:"R", c:3.5, a:390, i:9, d1:405, bs:"飛将"},
	"2156":{n:"夏侯惇",  r:"SR", c:4, a:500, i:12, d1:465, bs:"神飛将"},
	"2157":{n:"徐晃",  r:"UR", c:4, a:525, i:17, d1:520, bs:"隣地豪襲"},
	"2158":{n:"張魯",  r:"UR", c:1.5, a:140, i:14, d1:215, bs:"師君強兵"},
	"2159":{n:"曹丕",  r:"SR", c:4, a:370, i:20, d1:600, bs:"騎兵の大聖域"},
	"2160":{n:"趙娥",  r:"SR", c:4, a:455, i:12, d1:510, bs:"鹵獲の猛攻"},
	"2161":{n:"甄姫",  r:"R", c:1.5, a:35, i:8, d1:160, bs:"万華招来"},
	"2162":{n:"曹昂",  r:"SR", c:2, a:280, i:8, d1:395, bs:"万里行"},
	"2163":{n:"曹休・曹真",  r:"R", c:3.5, a:405, i:12, d1:430, bs:"千里雷光"},
	"2164":{n:"蔡瑁",  r:"R", c:3, a:370, i:10, d1:335, bs:"弓兵の猛攻"},
	"2165":{n:"甄姫",  r:"SR", c:1.5, a:35, i:9, d1:150, bs:"洛神の舞"},
	"2166":{n:"華佗",  r:"R", c:1, a:80, i:11, d1:160, bs:"神医の術式"},
	"2167":{n:"司馬師",  r:"UR", c:4, a:410, i:26, d1:555, bs:"兵器の極攻"},
	"2168":{n:"趙娥",  r:"UR", c:3.5, a:410, i:12, d1:580, bs:"守衛聖陣"},
	"2169":{n:"許?",  r:"UC", c:1.5, a:195, i:3, d1:270, bs:"守護防陣"},
	"2170":{n:"典韋",  r:"UC", c:1.5, a:230, i:4, d1:220, bs:"闘将突貫"},
	"2171":{n:"曹丕",  r:"R", c:3.5, a:315, i:18, d1:405, bs:"全軍の強攻令"},
	"2172":{n:"司馬炎",  r:"UC", c:2.5, a:265, i:15, d1:315, bs:"全軍の進攻令"},
	"2173":{n:"程昱・荀彧",  r:"UR", c:4.0, a:430, i:26, d1:550, bs:"智将砕器"},
	"2174":{n:"夏侯恩",  r:"R", c:3.5, a:415, i:11, d1:460, bs:"剣兵突攻"},
	"2175":{n:"鐘会",  r:"UC", c:2.5, a:190, i:13, d1:295, bs:"兵器突覇"},
	"2176":{n:"閻圃",  r:"UR", c:2.0, a:140, i:20, d1:315, bs:"食糧革命"},
	"2177":{n:"丁夫人",  r:"R", c:1.0, a:10, i:9, d1:90, bs:"剣兵増強"},
	"2178":{n:"夏侯惇",  r:"L", c:4, a:620, i:14, d1:600, bs:"騎兵の大天撃"},
	"2179":{n:"程昱",  r:"UR", c:2, a:250, i:19, d1:435, bs:"拠点統制"},
	"2180":{n:"司馬昭",  r:"UR", c:4, a:360, i:22, d1:765, bs:"騎兵の大神域"},
	"2181":{n:"曹節",  r:"SR", c:3.5, a:335, i:13, d1:640, bs:"守衛方陣"},
	"2182":{n:"郭夫人",  r:"SR", c:4, a:360, i:20, d1:685, bs:"護君"},
	"2183":{n:"許?",  r:"L", c:4.5, a:550, i:10, d1:810, bs:"覇者の大神域"},
	"2185":{n:"張?",  r:"SR", c:4, a:445, i:15, d1:415, bs:"鹵獲の猛攻"},
	"2186":{n:"夏侯淵",  r:"L", c:4, a:680, i:13, d1:595, bs:"弓兵の大極攻"},
	"2187":{n:"曹休",  r:"UR", c:4, a:400, i:13, d1:740, bs:"弓将の封聖域"},
	"2188":{n:"許?",  r:"UR", c:4, a:540, i:7, d1:410, bs:"隣地豪撃"},
	"2189":{n:"賈南風",  r:"R", c:3, a:300, i:13, d1:580, bs:"守護方陣"},
	"2190":{n:"満寵",  r:"SR", c:4, a:425, i:23, d1:555, bs:"全軍の烈速令"},
	"2191":{n:"曹仁",  r:"L", c:4, a:450, i:10, d1:815, bs:"騎兵の大天域"},
	"2192":{n:"陳羣",  r:"UR", c:4, a:435, i:24, d1:605, bs:"攻城の義勇軍"},
	"2193":{n:"笋昞",  r:"R", c:3, a:200, i:17, d1:300, bs:"知略謀略"},
	"2194":{n:"賈?",  r:"R", c:3, a:320, i:17, d1:330, bs:"全軍の神速令"},
	"2195":{n:"徐晃",  r:"R", c:3, a:350, i:10, d1:325, bs:"万里行"},
	"2196":{n:"曹華",  r:"UR", c:4, a:540, i:12, d1:455, bs:"鬼神突貫"},
	"2197":{n:"楽進",  r:"UR", c:4, a:510, i:11, d1:455, bs:"騎兵烈攻"},
	"2198":{n:"司馬懿",  r:"L", c:4.5, a:540, i:29, d1:525, bs:"智将の大天撃"},
	"2199":{n:"曹洪",  r:"UR", c:4, a:550, i:10, d1:445, bs:"鬼神突貫"},
	"2200":{n:"曹操",  r:"L", c:4, a:540, i:25, d1:555, bs:"全軍の大極攻令"},
	"3001":{n:"孫権",  r:"R", c:2.5, a:180, i:14, d1:295, bs:"呉の治世"},
	"3002":{n:"周瑜",  r:"SR", c:3.5, a:340, i:23, d1:570, bs:"弓将の采配"},
	"3003":{n:"陸遜",  r:"SR", c:3, a:305, i:19, d1:450, bs:"王者の護り"},
	"3004":{n:"孫策",  r:"SR", c:3, a:350, i:9, d1:385, bs:"覇王の進撃"},
	"3005":{n:"甘寧",  r:"R", c:3, a:345, i:6, d1:275, bs:"弓兵の猛撃"},
	"3006":{n:"孫尚香",  r:"SR", c:2, a:210, i:8, d1:255, bs:"弓腰姫の愛"},
	"3007":{n:"呂蒙",  r:"R", c:3, a:320, i:15, d1:370, bs:"深慮遠謀"},
	"3008":{n:"孫権",  r:"UC", c:2.5, a:180, i:12, d1:295, bs:"呉の治世"},
	"3009":{n:"周瑜",  r:"UC", c:2.5, a:200, i:14, d1:365, bs:"弓兵の進撃"},
	"3010":{n:"周瑜",  r:"R", c:2.5, a:200, i:15, d1:385, bs:"弓兵防御"},
	"3011":{n:"程普",  r:"UC", c:2.5, a:220, i:10, d1:295, bs:"兵舎訓練"},
	"3012":{n:"程普",  r:"C", c:2.5, a:220, i:10, d1:280, bs:"槍兵防御"},
	"3013":{n:"黄蓋",  r:"UC", c:2.5, a:250, i:7, d1:230, bs:"兵器行軍"},
	"3014":{n:"諸葛瑾",  r:"UC", c:2, a:135, i:11, d1:220, bs:"伐採知識"},
	"3015":{n:"朱治",  r:"UC", c:2, a:135, i:9, d1:230, bs:"弓兵防御"},
	"3016":{n:"朱治",  r:"C", c:2, a:135, i:9, d1:220, bs:"弓兵防御"},
	"3017":{n:"韓当",  r:"UC", c:2, a:220, i:5, d1:190, bs:"騎兵の進撃"},
	"3018":{n:"韓当",  r:"C", c:2, a:210, i:5, d1:185, bs:"騎兵行軍"},
	"3019":{n:"蘇飛",  r:"UC", c:2, a:160, i:8, d1:235, bs:"弓兵の進撃"},
	"3020":{n:"蘇飛",  r:"C", c:2, a:170, i:8, d1:225, bs:"剣兵の進撃"},
	"3021":{n:"?沢",  r:"UC", c:2, a:125, i:12, d1:105, bs:"石切知識"},
	"3022":{n:"?沢",  r:"C", c:2, a:115, i:12, d1:100, bs:"石切知識"},
	"3023":{n:"蒋欽",  r:"UC", c:2, a:195, i:6, d1:195, bs:"弓兵の進撃"},
	"3024":{n:"蒋欽",  r:"C", c:2, a:185, i:6, d1:190, bs:"弓兵の進撃"},
	"3025":{n:"孫翊",  r:"UC", c:1.5, a:150, i:2, d1:100, bs:"豪傑"},
	"3026":{n:"孫翊",  r:"C", c:1.5, a:140, i:2, d1:100, bs:"豪傑"},
	"3027":{n:"孫匡",  r:"UC", c:1.5, a:110, i:5, d1:160, bs:"弓兵訓練"},
	"3028":{n:"孫匡",  r:"C", c:1.5, a:110, i:5, d1:150, bs:"弓兵防御"},
	"3029":{n:"祖茂",  r:"UC", c:1.5, a:160, i:4, d1:160, bs:"豪傑"},
	"3030":{n:"祖茂",  r:"C", c:1.5, a:150, i:4, d1:160, bs:"槍兵の進撃"},
	"3031":{n:"大喬",  r:"R", c:1, a:20, i:8, d1:140, bs:"富国"},
	"3032":{n:"小喬",  r:"R", c:1, a:25, i:7, d1:170, bs:"強兵の檄文"},
	"3033":{n:"孫堅",  r:"R", c:3, a:320, i:11, d1:395, bs:"剣兵の極撃"},
	"3034":{n:"魯粛",  r:"R", c:2, a:230, i:14, d1:300, bs:"兵器修練"},
	"3035":{n:"魯粛",  r:"UC", c:2, a:230, i:13, d1:280, bs:"槍兵堅守"},
	"3036":{n:"太史慈",  r:"R", c:3.5, a:390, i:8, d1:480, bs:"守護神"},
	"3037":{n:"陸遜",  r:"R", c:2.5, a:260, i:18, d1:355, bs:"八卦の陣"},
	"3038":{n:"周泰",  r:"UC", c:2.5, a:210, i:5, d1:310, bs:"鉄壁"},
	"3039":{n:"周泰",  r:"C", c:2.5, a:210, i:5, d1:300, bs:"槍兵堅守"},
	"3040":{n:"孫権",  r:"SR", c:2.5, a:250, i:13, d1:365, bs:"大皇帝"},
	"3041":{n:"孫策",  r:"R", c:2.5, a:280, i:8, d1:330, bs:"騎兵突撃"},
	"3042":{n:"甘寧",  r:"R", c:2.5, a:290, i:3, d1:225, bs:"一騎当千"},
	"3043":{n:"甘寧",  r:"UC", c:2.5, a:280, i:3, d1:205, bs:"槍兵強行"},
	"3044":{n:"孫堅",  r:"UR", c:3.5, a:420, i:18, d1:520, bs:"大皇帝"},
	"3045":{n:"周瑜",  r:"UR", c:3.5, a:395, i:24, d1:510, bs:"弓兵の極撃"},
	"3046":{n:"孫尚香",  r:"UR", c:2.5, a:240, i:16, d1:320, bs:"市場繁栄"},
	"3047":{n:"孫策",  r:"UR", c:4, a:505, i:10, d1:600, bs:"飛将"},
	"3048":{n:"太史慈",  r:"SR", c:3.5, a:420, i:6, d1:445, bs:"弓兵の猛撃"},
	"3049":{n:"孫策",  r:"UC", c:2.5, a:290, i:6, d1:230, bs:"豪傑"},
	"3050":{n:"孫翊",  r:"R", c:1.5, a:170, i:4, d1:110, bs:"一騎当千"},
	"3051":{n:"黄蓋",  r:"R", c:2.5, a:275, i:9, d1:245, bs:"兵器強行"},
	"3052":{n:"陸遜",  r:"UC", c:2.5, a:210, i:13, d1:340, bs:"弓兵方陣"},
	"3053":{n:"呂蒙",  r:"UR", c:3, a:330, i:4, d1:380, bs:"覇王の進撃"},
	"3054":{n:"甘寧",  r:"SR", c:3, a:340, i:5, d1:310, bs:"強襲突覇"},
	"3055":{n:"魯粛",  r:"UR", c:2, a:150, i:19, d1:455, bs:"緊急帰還"},
	"3056":{n:"大喬",  r:"UR", c:1, a:30, i:9, d1:150, bs:"喬姫の祈り"},
	"3057":{n:"小喬",  r:"UR", c:1, a:35, i:8, d1:180, bs:"喬姫の激励"},
	"3058":{n:"陸遜",  r:"UR", c:3.5, a:395, i:24, d1:540, bs:"王者の護り"},
	"3059":{n:"太史慈",  r:"UC", c:3, a:310, i:8, d1:300, bs:"豪傑"},
	"3060":{n:"孫堅",  r:"UR", c:3.5, a:420, i:20, d1:520, bs:"呉軍の極撃"},
	"3061":{n:"諸葛瑾",  r:"R", c:2, a:180, i:15, d1:260, bs:"伐採技術"},
	"3062":{n:"呂蒙",  r:"UC", c:2.5, a:280, i:11, d1:260, bs:"槍兵突撃"},
	"3063":{n:"程普",  r:"R", c:2.5, a:235, i:11, d1:310, bs:"兵舎修練"},
	"3064":{n:"周泰",  r:"R", c:2.5, a:265, i:5, d1:385, bs:"槍兵の聖域"},
	"3065":{n:"甘寧",  r:"UR", c:3.5, a:440, i:7, d1:505, bs:"隣地猛攻"},
	"3066":{n:"孫権",  r:"UR", c:3.5, a:440, i:20, d1:505, bs:"皇帝の勅令"},
	"3067":{n:"黄蓋",  r:"UR", c:3, a:350, i:11, d1:345, bs:"苦肉の計"},
	"3068":{n:"太史慈",  r:"UR", c:3.5, a:450, i:7, d1:430, bs:"槍戟鬼神"},
	"3069":{n:"魯粛",  r:"SR", c:2.5, a:265, i:18, d1:285, bs:"弓兵の勝鬨"},
	"3070":{n:"孫堅",  r:"UC", c:2.5, a:250, i:13, d1:375, bs:"弓兵の強撃"},
	"3071":{n:"凌統",  r:"R", c:2.5, a:280, i:9, d1:270, bs:"槍兵突覇"},
	"3072":{n:"祖茂",  r:"R", c:1.5, a:180, i:4, d1:175, bs:"覇道"},
	"3073":{n:"徐盛",  r:"R", c:2.5, a:270, i:14, d1:310, bs:"弓兵突覇"},
	"3074":{n:"張昭",  r:"SR", c:2.5, a:170, i:19, d1:280, bs:"富国論"},
	"3075":{n:"丁奉",  r:"R", c:2.5, a:275, i:12, d1:310, bs:"弓兵の聖域"},
	"3076":{n:"張紘",  r:"SR", c:2.5, a:180, i:19, d1:210, bs:"迅速斥候"},
	"3077":{n:"呉夫人",  r:"SR", c:1, a:20, i:9, d1:85, bs:"弓兵増強"},
	"3078":{n:"孫策",  r:"R", c:2.5, a:280, i:8, d1:330, bs:"騎兵突覇"},
	"3079":{n:"周瑜",  r:"UC", c:2.5, a:200, i:14, d1:365, bs:"弓兵修練"},
	"3080":{n:"甘寧",  r:"UC", c:2.5, a:280, i:3, d1:205, bs:"弓兵突撃"},
	"3081":{n:"周瑜",  r:"UR", c:3.5, a:460, i:26, d1:510, bs:"神謀風如"},
	"3082":{n:"甘寧",  r:"SR", c:3.5, a:430, i:12, d1:505, bs:"奇襲"},
	"3083":{n:"孫尚香",  r:"R", c:2, a:240, i:10, d1:255, bs:"弓将の采配"},
	"3084":{n:"太史慈",  r:"UC", c:3, a:340, i:9, d1:300, bs:"弓兵の強撃"},
	"3085":{n:"程普",  r:"SR", c:3, a:330, i:16, d1:380, bs:"槍兵の猛撃"},
	"3086":{n:"諸葛恪",  r:"R", c:2.5, a:180, i:17, d1:265, bs:"弓兵の聖域"},
	"3087":{n:"孫策",  r:"UR", c:4, a:510, i:13, d1:600, bs:"国士無双"},
	"3088":{n:"呉国太",  r:"SR", c:2, a:10, i:9, d1:110, bs:"市場繁栄"},
	"3089":{n:"呂蒙",  r:"UR", c:3.5, a:420, i:23, d1:505, bs:"呉将の督戦"},
	"3090":{n:"孫尚香",  r:"SR", c:2, a:215, i:9, d1:265, bs:"弓兵の勝鬨"},
	"3091":{n:"陸遜",  r:"UR", c:3.5, a:390, i:24, d1:585, bs:"呉軍の防衛"},
	"3092":{n:"朱桓",  r:"UC", c:2.5, a:275, i:9, d1:265, bs:"槍兵の進攻"},
	"3093":{n:"張紘",  r:"R", c:2.5, a:160, i:18, d1:190, bs:"密偵精鋭"},
	"3094":{n:"蒋欽",  r:"R", c:2, a:270, i:7, d1:235, bs:"弓兵の強攻"},
	"3095":{n:"孫堅",  r:"SR", c:3.5, a:410, i:17, d1:505, bs:"拠点襲撃"},
	"3096":{n:"徐盛",  r:"UC", c:2.5, a:280, i:9, d1:275, bs:"弓兵の進攻"},
	"3097":{n:"黄蓋",  r:"SR", c:3.5, a:330, i:15, d1:460, bs:"防将戦略"},
	"3098":{n:"呉国太",  r:"R", c:1, a:10, i:7, d1:80, bs:"市場知識"},
	"3099":{n:"丁奉",  r:"UC", c:2.5, a:270, i:11, d1:345, bs:"弓兵方陣"},
	"3100":{n:"張昭",  r:"UR", c:3, a:230, i:21, d1:230, bs:"老巧の政令"},
	"3101":{n:"凌統",  r:"SR", c:3.5, a:400, i:11, d1:435, bs:"槍戟鬼神"},
	"3102":{n:"陸抗",  r:"R", c:2, a:145, i:17, d1:325, bs:"堅牢知略"},
	"3103":{n:"呉夫人",  r:"R", c:1, a:15, i:8, d1:75, bs:"弓兵増強"},
	"3104":{n:"孫権",  r:"UR", c:3.5, a:440, i:18, d1:460, bs:"弓兵の極攻"},
	"3105":{n:"小喬",  r:"SR", c:1, a:30, i:7, d1:175, bs:"小華の舞"},
	"3106":{n:"虎姉妹",  r:"UR", c:2.5, a:280, i:6, d1:230, bs:"弓兵の強撃"},
	"3107":{n:"大喬",  r:"SR", c:1, a:25, i:8, d1:145, bs:"大華の舞"},
	"3108":{n:"?沢",  r:"R", c:1.5, a:115, i:13, d1:95, bs:"石切技術"},
	"3109":{n:"凌操",  r:"SR", c:3.5, a:415, i:8, d1:425, bs:"弓兵の猛攻"},
	"3110":{n:"諸葛恪",  r:"UC", c:1.5, a:85, i:12, d1:100, bs:"加工知識"},
	"3111":{n:"太史慈",  r:"UR", c:4, a:500, i:8, d1:540, bs:"弓兵の大極撃"},
	"3112":{n:"周泰",  r:"SR", c:3.5, a:410, i:6, d1:505, bs:"不撓不屈"},
	"3113":{n:"虞翻",  r:"SR", c:2.5, a:250, i:18, d1:280, bs:"弩兵移送"},
	"3114":{n:"陸遜・呂蒙",  r:"UR", c:4, a:450, i:27, d1:600, bs:"孫呉の烈火"},
	"3115":{n:"周瑜",  r:"SR", c:1.5, a:150, i:17, d1:255, bs:"弓兵の大号令"},
	"3116":{n:"大喬",  r:"R", c:1, a:10, i:9, d1:110, bs:"優姫の敬愛"},
	"3117":{n:"甘寧",  r:"R", c:3.5, a:420, i:10, d1:400, bs:"飛将"},
	"3118":{n:"孫堅",  r:"UC", c:3, a:345, i:8, d1:325, bs:"槍兵の進攻"},
	"3119":{n:"張紘",  r:"UC", c:1.5, a:75, i:12, d1:110, bs:"弓兵訓練"},
	"3120":{n:"蘇飛",  r:"R", c:2.5, a:285, i:8, d1:275, bs:"弓兵速攻"},
	"3121":{n:"歩隲",  r:"R", c:2, a:150, i:17, d1:260, bs:"弓兵急配"},
	"3122":{n:"歩夫人",  r:"SR", c:1, a:15, i:9, d1:100, bs:"石切技巧"},
	"3123":{n:"孫翊",  r:"SR", c:3, a:340, i:4, d1:345, bs:"騎兵の猛攻"},
	"3124":{n:"韓当",  r:"SR", c:3.5, a:405, i:10, d1:575, bs:"槍兵の猛攻"},
	"3125":{n:"孫権",  r:"SR", c:3.5, a:435, i:15, d1:410, bs:"若獅子の軍略"},
	"3126":{n:"徐氏",  r:"SR", c:1, a:20, i:9, d1:100, bs:"製鉄技巧"},
	"3127":{n:"蒋欽",  r:"SR", c:3, a:340, i:8, d1:345, bs:"弓兵の猛攻"},
	"3128":{n:"孫尚香",  r:"UC", c:3, a:300, i:12, d1:330, bs:"弓兵速攻"},
	"3129":{n:"大虎",  r:"UR", c:2, a:240, i:10, d1:190, bs:"呉軍の極撃"},
	"3130":{n:"小虎",  r:"SR", c:3.5, a:335, i:11, d1:560, bs:"護君"},
	"3131":{n:"孫尚香",  r:"R", c:2.5, a:290, i:10, d1:335, bs:"飛蹄進軍"},
	"3132":{n:"凌操",  r:"UC", c:2.5, a:285, i:8, d1:300, bs:"武将突貫"},
	"3133":{n:"陸抗",  r:"UC", c:2, a:120, i:16, d1:240, bs:"呉の治世"},
	"3134":{n:"朱桓",  r:"SR", c:2.5, a:295, i:9, d1:300, bs:"槍兵突攻"},
	"3135":{n:"凌操",  r:"R", c:3, a:340, i:8, d1:390, bs:"謀反の強攻"},
	"3136":{n:"韓当",  r:"R", c:2.5, a:270, i:7, d1:310, bs:"兵器の進攻"},
	"3137":{n:"徐盛",  r:"SR", c:3.5, a:430, i:12, d1:380, bs:"猛将の鹵獲"},
	"3138":{n:"孫策・周瑜",  r:"UR", c:4, a:580, i:24, d1:500, bs:"弓兵の大神撃"},
	"3139":{n:"潘璋",  r:"SR", c:4, a:490, i:14, d1:480, bs:"弓兵の大極撃"},
	"3140":{n:"大虎",  r:"SR", c:1, a:100, i:9, d1:90, bs:"苛政虎舞"},
	"3141":{n:"孫氏",  r:"R", c:3.5, a:400, i:15, d1:390, bs:"弓神降臨"},
	"3142":{n:"小虎",  r:"R", c:2, a:50, i:10, d1:60, bs:"孫家の恵み"},
	"3143":{n:"虞翻",  r:"UC", c:3, a:230, i:19, d1:250, bs:"食糧技術"},
	"3144":{n:"潘璋",  r:"R", c:3.5, a:430, i:12, d1:405, bs:"猛士の極意"},
	"3145":{n:"張昭",  r:"R", c:3, a:150, i:20, d1:200, bs:"加工技術"},
	"3146":{n:"孫桓",  r:"UR", c:4, a:520, i:15, d1:520, bs:"鬼神の鹵獲"},
	"3147":{n:"歩隲",  r:"UC", c:2, a:130, i:16, d1:250, bs:"剣兵堅守"},
	"3148":{n:"呂蒙",  r:"SR", c:3.5, a:420, i:18, d1:440, bs:"覇王の猛攻"},
	"3149":{n:"周泰",  r:"R", c:3, a:370, i:5, d1:350, bs:"隣地猛攻"},
	"3150":{n:"孫堅",  r:"R", c:3, a:360, i:12, d1:365, bs:"槍兵の猛攻"},
	"3151":{n:"凌統",  r:"UC", c:3, a:340, i:7, d1:340, bs:"万夫不当"},
	"3152":{n:"張昭・張紘",  r:"UR", c:4, a:400, i:27, d1:520, bs:"呉の治世"},
	"3153":{n:"丁奉",  r:"SR", c:4, a:390, i:14, d1:615, bs:"弓兵の大聖域"},
	"3154":{n:"大喬・小喬",  r:"UR", c:4, a:360, i:21, d1:550, bs:"万華招来"},
	"3155":{n:"呉夫人",  r:"UC", c:3, a:150, i:18, d1:390, bs:"弓兵修練"},
	"3156":{n:"小虎",  r:"UR", c:3.5, a:480, i:12, d1:515, bs:"弓襲遠攻"},
	"3157":{n:"孫氏",  r:"SR", c:4, a:490, i:18, d1:465, bs:"孫呉の烈火"},
	"3158":{n:"朱治",  r:"R", c:3.5, a:420, i:10, d1:395, bs:"弓兵突攻"},
	"3159":{n:"太史慈",  r:"SR", c:4, a:510, i:7, d1:565, bs:"鬼神の極意"},
	"3160":{n:"孫策",  r:"R", c:3.5, a:405, i:9, d1:430, bs:"猛将の極意"},
	"3161":{n:"諸葛瑾",  r:"SR", c:1.5, a:200, i:16, d1:190, bs:"徳義為政"},
	"3162":{n:"虞翻",  r:"R", c:3.5, a:275, i:20, d1:420, bs:"全軍の強攻令"},
	"3163":{n:"周姫",  r:"UR", c:4, a:355, i:23, d1:660, bs:"守衛聖陣"},
	"3164":{n:"大喬",  r:"SR", c:3, a:100, i:16, d1:320, bs:"千華招来"},
	"3165":{n:"孫堅",  r:"L", c:4, a:670, i:22, d1:615, bs:"弓兵の大天撃"},
	"3166":{n:"孫尚香",  r:"L", c:3.5, a:530, i:18, d1:505, bs:"無双"},
	"3167":{n:"陸抗",  r:"UR", c:4, a:505, i:25, d1:465, bs:"全軍の極攻令"},
	"3168":{n:"陳武",  r:"SR", c:4, a:485, i:14, d1:400, bs:"全軍の猛攻令"},
	"3169":{n:"虞翻",  r:"UR", c:4, a:380, i:24, d1:800, bs:"弓兵の大神域"},
	"3170":{n:"大虎",  r:"R", c:3, a:310, i:10, d1:430, bs:"剣将の采配"},
	"3171":{n:"甘寧",  r:"L", c:4, a:610, i:14, d1:565, bs:"凰里雷光"},
	"3172":{n:"周姫",  r:"SR", c:4, a:330, i:27, d1:605, bs:"呉の治世"},
	"3173":{n:"孫策",  r:"L", c:4, a:615, i:14, d1:590, bs:"鳳速雷光"},
	"3174":{n:"呂蒙",  r:"L", c:4, a:650, i:24, d1:595, bs:"槍兵の大極攻"},
	"3177":{n:"魯粛",  r:"R", c:4, a:255, i:18, d1:660, bs:"守護防陣"},
	"3178":{n:"陳武",  r:"UR", c:4, a:390, i:15, d1:735, bs:"槍将の封聖域"},
	"3179":{n:"周瑜",  r:"SR", c:3.5, a:405, i:23, d1:480, bs:"全軍の極攻令"},
	"3180":{n:"周瑜",  r:"R", c:3, a:300, i:17, d1:355, bs:"智将器撃"},
	"3181":{n:"孫桓",  r:"R", c:3, a:340, i:11, d1:375, bs:"全軍の神速令"},
	"3182":{n:"程普",  r:"L", c:4, a:470, i:18, d1:850, bs:"槍兵の大天域"},
	"3183":{n:"張紘",  r:"UR", c:4, a:375, i:25, d1:500, bs:"強兵の義勇軍"},
	"3184":{n:"陸遜",  r:"SR", c:4, a:395, i:21, d1:620, bs:"覇者の護り"},
	"3185":{n:"丁奉",  r:"UR", c:4, a:490, i:15, d1:555, bs:"全軍の飛速令"},
	"3186":{n:"蒋欽",  r:"UR", c:4, a:530, i:10, d1:490, bs:"弓兵烈攻"},
	"3187":{n:"歩隲",  r:"C", c:2, a:125, i:13, d1:245, bs:"剣兵防御"},
	"3188":{n:"周瑜・黄蓋",  r:"L", c:4.5, a:700, i:21, d1:755, bs:"兵器の縮地天撃"},
	"3189":{n:"歩夫人",  r:"UR", c:1, a:20, i:10, d1:120, bs:"迅雷招来"},
	"3190":{n:"孫皎",  r:"SR", c:4, a:520, i:16, d1:510, bs:"剣兵の大神撃"},
	"3191":{n:"全琮",  r:"R", c:4, a:430, i:13, d1:415, bs:"騎兵の極攻"},
	"3192":{n:"徐氏",  r:"R", c:1, a:15, i:8, d1:90, bs:"弓兵増勢"},
	"3193":{n:"孫匡",  r:"R", c:3, a:375, i:8, d1:395, bs:"隣地豪襲"},
	"4001":{n:"呂布",  r:"SR", c:4, a:500, i:3, d1:545, bs:"飛将"},
	"4002":{n:"董卓",  r:"R", c:3, a:325, i:6, d1:300, bs:"剣兵の進撃"},
	"4003":{n:"袁紹",  r:"R", c:2.5, a:220, i:10, d1:350, bs:"弓兵突撃"},
	"4004":{n:"公孫?",	r:"R", c:3, a:315, i:8, d1:345, bs:"騎兵突撃"},
	"4005":{n:"袁術",  r:"R", c:2.5, a:235, i:8, d1:210, bs:"練兵訓練"},
	"4006":{n:"孟獲",  r:"UC", c:2.5, a:270, i:4, d1:240, bs:"蛮族の襲撃"},
	"4007":{n:"孟獲",  r:"C", c:2.5, a:255, i:4, d1:240, bs:"蛮族の襲撃"},
	"4008":{n:"劉焉",  r:"UC", c:2, a:110, i:13, d1:215, bs:"兵器訓練"},
	"4009":{n:"劉焉",  r:"C", c:2, a:110, i:13, d1:195, bs:"弓兵防御"},
	"4010":{n:"劉表",  r:"UC", c:2, a:95, i:14, d1:175, bs:"石切知識"},
	"4011":{n:"劉表",  r:"C", c:2, a:95, i:13, d1:175, bs:"石切知識"},
	"4012":{n:"孔融",  r:"UC", c:2, a:35, i:14, d1:95, bs:"製鉄知識"},
	"4013":{n:"孔融",  r:"C", c:2, a:35, i:13, d1:95, bs:"製鉄知識"},
	"4014":{n:"黄祖",  r:"UC", c:1.5, a:105, i:3, d1:155, bs:"弓兵行軍"},
	"4015":{n:"黄祖",  r:"C", c:1.5, a:105, i:3, d1:145, bs:"弓兵防御"},
	"4016":{n:"牛輔",  r:"UC", c:1.5, a:120, i:2, d1:80, bs:"槍兵行軍"},
	"4017":{n:"牛輔",  r:"C", c:1.5, a:110, i:2, d1:80, bs:"槍兵行軍"},
	"4018":{n:"郭汜",  r:"UC", c:2, a:215, i:1, d1:185, bs:"騎兵行軍"},
	"4019":{n:"郭汜",  r:"C", c:2, a:205, i:1, d1:180, bs:"剣兵の進撃"},
	"4020":{n:"祝融",  r:"UC", c:2.5, a:275, i:3, d1:155, bs:"火神の攻勢"},
	"4021":{n:"祝融",  r:"C", c:2.5, a:260, i:3, d1:155, bs:"火神の攻勢"},
	"4022":{n:"李?",  r:"UC", c:2, a:200, i:2, d1:205, bs:"騎兵の進撃"},
	"4023":{n:"李?",  r:"C", c:2, a:195, i:2, d1:195, bs:"騎兵防御"},
	"4024":{n:"貂蝉",  r:"SR", c:1, a:10, i:10, d1:100, bs:"傾国"},
	"4025":{n:"張角",  r:"SR", c:3.5, a:380, i:19, d1:135, bs:"太平要術"},
	"4026":{n:"袁紹",  r:"R", c:2.5, a:220, i:10, d1:350, bs:"騎兵の聖域"},
	"4027":{n:"袁紹",  r:"UC", c:2.5, a:205, i:9, d1:350, bs:"剣兵の強撃"},
	"4028":{n:"祝融",  r:"R", c:1.5, a:175, i:3, d1:110, bs:"弓兵突覇"},
	"4029":{n:"孟獲",  r:"R", c:3, a:335, i:5, d1:310, bs:"蛮王の襲撃"},
	"4030":{n:"蔡?",  r:"R", c:1, a:10, i:10, d1:125, bs:"攻城の檄文"},
	"4031":{n:"呂布",  r:"UR", c:4, a:510, i:5, d1:545, bs:"飛将"},
	"4032":{n:"公孫?",	r:"SR", c:3, a:340, i:10, d1:350, bs:"騎兵の猛撃"},
	"4033":{n:"孟獲",  r:"SR", c:3, a:365, i:2, d1:290, bs:"蛮王の襲撃"},
	"4034":{n:"董卓",  r:"SR", c:3, a:350, i:8, d1:305, bs:"強襲突覇"},
	"4035":{n:"祝融",  r:"SR", c:2.5, a:280, i:3, d1:190, bs:"弓兵の極撃"},
	"4036":{n:"劉焉",  r:"R", c:2, a:125, i:14, d1:230, bs:"農林知識"},
	"4037":{n:"劉表",  r:"R", c:2, a:110, i:14, d1:195, bs:"加工知識"},
	"4038":{n:"袁術",  r:"UC", c:2, a:185, i:6, d1:190, bs:"練兵修練"},
	"4039":{n:"張角",  r:"UR", c:3.5, a:380, i:22, d1:120, bs:"群雄の極撃"},
	"4040":{n:"貂蝉",  r:"UR", c:1, a:10, i:10, d1:110, bs:"速撃の舞"},
	"4041":{n:"?徳・馬超",	r:"UR", c:4, a:510, i:13, d1:575, bs:"鬼神の鹵獲"},
	"4042":{n:"于吉",  r:"SR", c:2, a:200, i:17, d1:270, bs:"農林技術"},
	"4043":{n:"王異",  r:"SR", c:2.5, a:290, i:9, d1:240, bs:"剣兵の極撃"},
	"4044":{n:"馬騰",  r:"SR", c:3.5, a:410, i:10, d1:425, bs:"騎兵の極撃"},
	"4045":{n:"献帝",  r:"UR", c:1, a:10, i:10, d1:130, bs:"富国強兵"},
	"4046":{n:"公孫?",	r:"UC", c:2.5, a:275, i:8, d1:265, bs:"騎兵強行"},
	"4047":{n:"顔良",  r:"SR", c:3.5, a:435, i:5, d1:350, bs:"飛将"},
	"4048":{n:"文醜",  r:"SR", c:3.5, a:425, i:5, d1:350, bs:"猛将の鹵獲"},
	"4049":{n:"蔡?",  r:"SR", c:1, a:10, i:10, d1:130, bs:"優雅な調べ"},
	"4050":{n:"袁紹",  r:"SR", c:3.5, a:410, i:18, d1:520, bs:"軍神"},
	"4051":{n:"董卓",  r:"UR", c:3.5, a:425, i:18, d1:520, bs:"暴虐外道"},
	"4052":{n:"張角",  r:"R", c:2.5, a:180, i:17, d1:310, bs:"八卦の陣"},
	"4053":{n:"呂布",  r:"UR", c:4, a:520, i:5, d1:545, bs:"神飛将"},
	"4054":{n:"劉表",  r:"SR", c:2.5, a:180, i:18, d1:325, bs:"強兵の檄文"},
	"4055":{n:"公孫?",	r:"UR", c:3.5, a:420, i:11, d1:460, bs:"飛蹄進軍"},
	"4056":{n:"華雄",  r:"SR", c:3.5, a:420, i:8, d1:390, bs:"槍兵の極撃"},
	"4057":{n:"紀霊",  r:"R", c:2.5, a:270, i:6, d1:300, bs:"騎兵の猛撃"},
	"4058":{n:"祝融",  r:"UR", c:3, a:360, i:4, d1:320, bs:"隣地猛攻"},
	"4059":{n:"陳宮",  r:"R", c:2, a:240, i:14, d1:230, bs:"密偵召集"},
	"4060":{n:"袁紹",  r:"UR", c:3.5, a:410, i:20, d1:630, bs:"群雄の防衛"},
	"4061":{n:"厳氏",  r:"SR", c:1, a:20, i:8, d1:120, bs:"憂姫護国"},
	"4062":{n:"郭汜",  r:"R", c:2.5, a:280, i:2, d1:270, bs:"強襲突撃"},
	"4063":{n:"張梁",  r:"R", c:2.5, a:270, i:12, d1:310, bs:"弓兵の強撃"},
	"4064":{n:"張宝",  r:"R", c:2.5, a:200, i:16, d1:230, bs:"兵器強行"},
	"4065":{n:"水鏡娘",  r:"UR", c:1, a:20, i:10, d1:150, bs:"人選眼力"},
	"4066":{n:"貂蝉",  r:"UR", c:1, a:10, i:10, d1:110, bs:"月下羽衣"},
	"4067":{n:"何皇后",  r:"SR", c:1, a:15, i:8, d1:90, bs:"傾国"},
	"4068":{n:"呂布",  r:"R", c:3.5, a:410, i:3, d1:445, bs:"万夫不当"},
	"4069":{n:"張任",  r:"UC", c:2.5, a:280, i:10, d1:300, bs:"槍兵の強撃"},
	"4070":{n:"袁術",  r:"SR", c:3, a:330, i:13, d1:350, bs:"虐帝の号令"},
	"4071":{n:"兀突骨",  r:"UC", c:3, a:300, i:1, d1:355, bs:"守護防陣"},
	"4072":{n:"孟獲",  r:"UR", c:3.5, a:450, i:5, d1:470, bs:"蛮勇の一撃"},
	"4073":{n:"何進",  r:"R", c:2.5, a:255, i:2, d1:265, bs:"槍兵の強攻"},
	"4074":{n:"張宝",  r:"UC", c:2.5, a:190, i:15, d1:220, bs:"趁火打劫"},
	"4075":{n:"高順",  r:"SR", c:3.5, a:410, i:10, d1:450, bs:"陥陣営の侵攻"},
	"4076":{n:"董白",  r:"SR", c:1.5, a:60, i:9, d1:60, bs:"暴姫の命"},
	"4077":{n:"顔良",  r:"R", c:3, a:350, i:5, d1:280, bs:"剛将の畏怖"},
	"4078":{n:"王異",  r:"R", c:2, a:150, i:7, d1:320, bs:"守護堅陣"},
	"4079":{n:"水鏡",  r:"UR", c:1, a:50, i:17, d1:90, bs:"水鏡鑑定"},
	"4080":{n:"水鏡",  r:"SR", c:1, a:30, i:15, d1:80, bs:"水鏡眼識"},
	"4081":{n:"水鏡",  r:"R", c:1, a:15, i:12, d1:70, bs:"水鏡評論"},
	"4082":{n:"水鏡",  r:"UC", c:1, a:10, i:10, d1:60, bs:"水鏡指南"},
	"4083":{n:"文醜",  r:"R", c:3, a:340, i:5, d1:290, bs:"趁火打劫"},
	"4084":{n:"紀霊",  r:"UC", c:2.5, a:270, i:5, d1:245, bs:"騎兵の進攻"},
	"4085":{n:"霊帝",  r:"SR", c:1, a:10, i:5, d1:110, bs:"天子勅令"},
	"4086":{n:"華雄",  r:"R", c:3, a:345, i:4, d1:330, bs:"槍兵の強攻"},
	"4087":{n:"呂布・貂蝉",  r:"UR", c:4, a:540, i:18, d1:490, bs:"鬼神の極意"},
	"4088":{n:"董卓",  r:"SR", c:3.5, a:380, i:21, d1:450, bs:"暴君の覇道V2"},
	"4089":{n:"蔡?",  r:"R", c:1, a:10, i:10, d1:110, bs:"才女の音律"},
	"4090":{n:"張角",  r:"UC", c:3, a:150, i:16, d1:250, bs:"守護防陣"},
	"4091":{n:"呂氏",  r:"SR", c:3.5, a:410, i:4, d1:345, bs:"弓神降臨"},
	"4092":{n:"馬騰",  r:"R", c:3, a:320, i:9, d1:295, bs:"騎兵の強攻"},
	"4093":{n:"陳宮",  r:"UC", c:2, a:230, i:13, d1:190, bs:"兵器突撃"},
	"4094":{n:"鄒氏",  r:"R", c:1, a:15, i:7, d1:75, bs:"桃色吐息"},
	"4095":{n:"水鏡娘",  r:"UR", c:1, a:50, i:17, d1:90, bs:"娘々祈祷0"},
	"4096":{n:"水鏡娘",  r:"SR", c:1, a:30, i:15, d1:80, bs:"娘々祈祷"},
	"4097":{n:"水鏡娘",  r:"R", c:1, a:15, i:12, d1:70, bs:"娘々祈祷"},
	"4098":{n:"水鏡娘",  r:"UC", c:1, a:10, i:10, d1:65, bs:"娘々祈祷"},
	"4099":{n:"水鏡娘",  r:"UR", c:1, a:50, i:17, d1:90, bs:"娘々訓練0"},
	"4100":{n:"水鏡娘",  r:"SR", c:1, a:30, i:15, d1:80, bs:"娘々訓練"},
	"4101":{n:"水鏡娘",  r:"R", c:1, a:15, i:12, d1:70, bs:"娘々訓練"},
	"4102":{n:"水鏡娘",  r:"UC", c:1, a:10, i:10, d1:65, bs:"娘々訓練"},
	"4103":{n:"于吉",  r:"R", c:1.5, a:130, i:13, d1:100, bs:"豊潤祈祷"},
	"4104":{n:"郭汜",  r:"UC", c:1.5, a:200, i:1, d1:175, bs:"趁火打劫"},
	"4105":{n:"馬超",  r:"UR", c:4, a:510, i:5, d1:440, bs:"騎兵の大極撃"},
	"4106":{n:"李?",  r:"R", c:2.5, a:280, i:3, d1:240, bs:"騎兵速攻"},
	"4107":{n:"黄祖",  r:"R", c:1.5, a:200, i:3, d1:195, bs:"密偵精鋭"},
	"4108":{n:"貂蝉",  r:"R", c:1.5, a:10, i:9, d1:90, bs:"桃色吐息"},
	"4109":{n:"張任",  r:"R", c:2.5, a:270, i:10, d1:390, bs:"防将戦法"},
	"4110":{n:"公孫?",	r:"SR", c:3, a:360, i:9, d1:430, bs:"白馬将"},
	"4111":{n:"袁紹",  r:"UR", c:3.5, a:425, i:20, d1:545, bs:"群将の督戦"},
	"4112":{n:"高順",  r:"R", c:3, a:330, i:10, d1:340, bs:"兵器突撃"},
	"4113":{n:"何進",  r:"UC", c:2.5, a:245, i:2, d1:200, bs:"剣兵の進攻"},
	"4114":{n:"祝融",  r:"R", c:3, a:330, i:3, d1:300, bs:"剣兵の強攻"},
	"4115":{n:"郭汜",  r:"SR", c:1, a:190, i:4, d1:125, bs:"天里行"},
	"4116":{n:"董卓",  r:"UR", c:3.5, a:435, i:19, d1:500, bs:"剣兵の極攻"},
	"4117":{n:"花鬘",  r:"SR", c:3.5, a:410, i:6, d1:450, bs:"剣神降臨"},
	"4118":{n:"何皇后",  r:"R", c:1, a:10, i:8, d1:110, bs:"護国献心"},
	"4119":{n:"呂氏",  r:"UC", c:3, a:290, i:3, d1:320, bs:"騎兵速攻"},
	"4120":{n:"兀突骨",  r:"UR", c:4, a:440, i:4, d1:680, bs:"覇者の護り"},
	"4121":{n:"田豊",  r:"SR", c:4, a:380, i:22, d1:710, bs:"剣兵の大聖域"},
	"4122":{n:"貂蝉",  r:"UR", c:1, a:10, i:8, d1:110, bs:"素材知識"},
	"4123":{n:"孟獲",  r:"R", c:3.5, a:395, i:4, d1:550, bs:"王者の護り"},
	"4124":{n:"パンダ(仮)",  r:"UR", c:1.5, a:85, i:13, d1:160, bs:"熊猫の麺匠"},
	"4125":{n:"張梁",  r:"UC", c:3, a:350, i:11, d1:310, bs:"弓兵突覇"},
	"4126":{n:"パンダ(仮)",  r:"R", c:1.5, a:100, i:10, d1:100, bs:"熊猫の猛襲"},
	"4127":{n:"左慈娘・鶴爺",  r:"SR", c:3.5, a:380, i:18, d1:400, bs:"娘々武神"},
	"4128":{n:"公孫?",	r:"R", c:3.5, a:390, i:9, d1:375, bs:"千里雷光"},
	"4129":{n:"孟優",  r:"UR", c:4, a:520, i:10, d1:550, bs:"剣兵烈攻"},
	"4130":{n:"文醜",  r:"UC", c:3, a:320, i:4, d1:315, bs:"神速"},
	"4131":{n:"韓遂",  r:"SR", c:2.5, a:280, i:11, d1:290, bs:"騎兵突攻"},
	"4132":{n:"孟優",  r:"UR", c:3, a:345, i:9, d1:285, bs:"剣兵速攻"},
	"4133":{n:"関羽",  r:"UR", c:3.5, a:285, i:8, d1:250, bs:"一騎湯戦"},
	"4134":{n:"呂布・貂蝉",  r:"UR", c:3.5, a:395, i:15, d1:360, bs:"湯将の極意"},
	"4135":{n:"呂布",  r:"R", c:3.5, a:410, i:3, d1:445, bs:"武将の極意"},
	"4136":{n:"水鏡娘",  r:"C", c:1, a:10, i:10, d1:50, bs:"娘々訓練"},
	"4137":{n:"劉璋",  r:"SR", c:2.5, a:260, i:14, d1:340, bs:"守護聖陣"},
	"4138":{n:"李?",  r:"SR", c:3.5, a:360, i:4, d1:575, bs:"守護方陣"},
	"4139":{n:"文醜・顔良",  r:"UR", c:4, a:570, i:7, d1:390, bs:"鬼神の極意"},
	"4140":{n:"水鏡娘",  r:"UR", c:3, a:335, i:13, d1:355, bs:"烈速雷光"},
	"4141":{n:"陳宮・高順",  r:"UR", c:4, a:420, i:26, d1:520, bs:"兵器の猛攻"},
	"4142":{n:"劉表",  r:"SR", c:1.5, a:100, i:17, d1:255, bs:"兵器の大号令"},
	"4143":{n:"董白",  r:"R", c:1, a:30, i:8, d1:60, bs:"暴姫の威令"},
	"4144":{n:"華雄",  r:"R", c:3.5, a:420, i:8, d1:390, bs:"猛将の極意"},
	"4145":{n:"花鬘",  r:"R", c:3.5, a:410, i:6, d1:430, bs:"飛将"},
	"4146":{n:"袁紹",  r:"UC", c:3, a:150, i:19, d1:350, bs:"奇計百出"},
	"4147":{n:"劉璋",  r:"UR", c:3.5, a:410, i:20, d1:600, bs:"護君"},
	"4148":{n:"牛輔",  r:"SR", c:3, a:330, i:10, d1:385, bs:"兵器の強攻"},
	"4149":{n:"馬騰",  r:"UC", c:2.5, a:250, i:8, d1:350, bs:"騎兵方陣"},
	"4150":{n:"馬超",  r:"SR", c:3.5, a:430, i:6, d1:420, bs:"若獅子の軍略"},
	"4151":{n:"韓遂",  r:"UC", c:2.5, a:270, i:10, d1:265, bs:"謀反の進攻"},
	"4152":{n:"水鏡娘",  r:"C", c:1, a:10, i:10, d1:50, bs:"娘々訓練"},
	"4153":{n:"水鏡家族",  r:"UR", c:2, a:90, i:18, d1:190, bs:"水鏡の方術"},
	"4154":{n:"水鏡娘",  r:"UR", c:1, a:20, i:10, d1:150, bs:"娘々強兵"},
	"4155":{n:"パンダ(仮)",  r:"SR", c:3.5, a:390, i:13, d1:380, bs:"龍鱗猛攻"},
	"4156":{n:"鄒氏",  r:"SR", c:1, a:15, i:8, d1:85, bs:"酔吟吐息"},
	"4157":{n:"貂蝉",  r:"R", c:1, a:10, i:9, d1:90, bs:"傾国"},
	"4158":{n:"呂氏",  r:"R", c:3.5, a:370, i:4, d1:350, bs:"闘将の極意"},
	"4159":{n:"お江",  r:"UR", c:1, a:10, i:10, d1:100, bs:"傾国"},
	"4160":{n:"劉焉",  r:"SR", c:2.5, a:230, i:19, d1:250, bs:"兵器の勝鬨"},
	"4161":{n:"水鏡娘",  r:"UR", c:3, a:325, i:10, d1:250, bs:"娘々軍神"},
	"4162":{n:"水鏡娘",  r:"UR", c:2, a:240, i:15, d1:200, bs:"群雄の極撃"},
	"4163":{n:"献帝",  r:"SR", c:3, a:100, i:23, d1:100, bs:"陳留王政"},
	"4164":{n:"祝融",  r:"R", c:3.5, a:200, i:4, d1:670, bs:"金剛不壊"},
	"4165":{n:"張遼",  r:"UR", c:4, a:530, i:15, d1:540, bs:"戦神の極意"},
	"4166":{n:"のぶニャが",  r:"UR", c:3, a:330, i:10, d1:300, bs:"万夫必殺"},
	"4167":{n:"織田信長夢",  r:"UR", c:3.5, a:425, i:6, d1:455, bs:"一閃の極意"},
	"4168":{n:"袁譚・袁尚",  r:"UR", c:4, a:570, i:21, d1:550, bs:"剣兵の大神撃"},
	"4169":{n:"鄒氏",  r:"SR", c:1.5, a:15, i:8, d1:80, bs:"哀艶の舞"},
	"4170":{n:"孟優",  r:"SR", c:4, a:470, i:9, d1:505, bs:"剣兵の大極撃"},
	"4171":{n:"王悦",  r:"R", c:3.5, a:395, i:6, d1:400, bs:"槍神降臨"},
	"4172":{n:"韓遂",  r:"R", c:3.5, a:410, i:10, d1:420, bs:"猛士の極意"},
	"4173":{n:"董白",  r:"UC", c:3, a:295, i:7, d1:360, bs:"剣兵速攻"},
	"4174":{n:"貂蝉",  r:"SR", c:1.5, a:10, i:13, d1:150, bs:"月華の舞"},
	"4175":{n:"呂氏",  r:"R", c:3, a:310, i:4, d1:340, bs:"暴姫の命"},
	"4176":{n:"沮授",  r:"UR", c:3.5, a:350, i:27, d1:495, bs:"攻城戦の極砕"},
	"4181":{n:"王美人",  r:"UR", c:1.5, a:50, i:15, d1:210, bs:"佳人薄命"},
	"4182":{n:"蔡?",  r:"SR", c:1, a:100, i:12, d1:120, bs:"文姫の慈愛"},
	"4183":{n:"鄒氏",  r:"R", c:3.5, a:425, i:10, d1:420, bs:"猛暑の極意"},
	"4184":{n:"水鏡娘",  r:"SR", c:3.5, a:405, i:20, d1:505, bs:"鹵獲の猛攻"},
	"4186":{n:"胡車児",  r:"UR", c:2.0, a:280, i:8, d1:205, bs:"強襲奮迅"},
	"4187":{n:"水鏡娘",  r:"SR", c:3.5, a:395, i:18, d1:395, bs:"猛将の鹵獲"},
	"4191":{n:"李?・郭汜",	r:"UR", c:4, a:515, i:6, d1:445, bs:"鬼神の鹵獲"},
	"4192":{n:"木鹿大王",  r:"UR", c:4, a:525, i:10, d1:510, bs:"飛将"},
	"4193":{n:"張宝",  r:"SR", c:3.5, a:405, i:22, d1:405, bs:"兵器の猛攻"},
	"4194":{n:"李儒",  r:"SR", c:2.5, a:220, i:18, d1:250, bs:"大剣兵移送"},
	"4202":{n:"祝融",  r:"L", c:4, a:650, i:6, d1:740, bs:"剣兵の大天撃"},
	"4203":{n:"霊帝",  r:"R", c:1, a:10, i:5, d1:100, bs:"富国強兵"},
	"4204":{n:"水鏡娘",  r:"L", c:4, a:580, i:22, d1:420, bs:"鹵獲の極攻"},
	"4205":{n:"董白",  r:"UR", c:4, a:510, i:11, d1:450, bs:"飛速迅雷"},
	"4206":{n:"劉璋",  r:"SR", c:1, a:80, i:10, d1:230, bs:"守衛聖陣"},
	"4207":{n:"董白",  r:"SR", c:3.5, a:420, i:10, d1:425, bs:"収奪の猛攻"},
	"4208":{n:"劉璋",  r:"R", c:1, a:50, i:9, d1:135, bs:"領地統制"},
	"4209":{n:"審配",  r:"SR", c:4, a:410, i:22, d1:465, bs:"全軍の猛攻令"},
	"4210":{n:"呂布",  r:"L", c:4, a:700, i:6, d1:640, bs:"無双"},
	"4211":{n:"劉焉",  r:"UR", c:1, a:130, i:11, d1:160, bs:"皇叔の号令"},
	"4212":{n:"皇甫嵩",  r:"UR", c:4, a:520, i:23, d1:505, bs:"全軍の極攻令"},
	"4213":{n:"李儒",  r:"UR", c:4, a:370, i:22, d1:720, bs:"剣兵の大神域"},
	"4214":{n:"王悦",  r:"UR", c:3.5, a:415, i:8, d1:460, bs:"王将の心意気"},
	"4215":{n:"盧氏",  r:"UR", c:4, a:385, i:25, d1:485, bs:"食糧革命"},
	"4216":{n:"王美人",  r:"SR", c:1, a:20, i:10, d1:150, bs:"食糧技巧"},
	"4218":{n:"献帝",  r:"R", c:2.5, a:80, i:17, d1:80, bs:"富国"},
	"4219":{n:"?徳",  r:"UR", c:4, a:515, i:15, d1:555, bs:"飛将"},
	"4220":{n:"張角",  r:"L", c:4, a:500, i:24, d1:520, bs:"守護大聖陣"},
	"4221":{n:"袁紹",  r:"L", c:4, a:660, i:22, d1:710, bs:"剣兵の大極攻"},
	"4233":{n:"左慈娘",  r:"L", c:4, a:490, i:22, d1:830, bs:"覇者の大神域"},
	"4234":{n:"袁姫",  r:"UC", c:2, a:20, i:11, d1:300, bs:"護国望心"},
	"4235":{n:"厳白虎",  r:"R", c:3, a:355, i:5, d1:335, bs:"謀反の猛攻"},
	"4236":{n:"馬鉄",  r:"SR", c:2.5, a:315, i:9, d1:315, bs:"謀反の突攻"},
	"4237":{n:"王異",  r:"R", c:2, a:270, i:7, d1:275, bs:"謀反の速攻"},
	"4238":{n:"張?・高覧",	r:"UR", c:4, a:550, i:16, d1:375, bs:"飛速迅雷"},
	"4239":{n:"盧植",  r:"UR", c:4, a:380, i:24, d1:715, bs:"剣将の封聖域"},
	"4241":{n:"王允",  r:"UR", c:4, a:400, i:26, d1:505, bs:"全軍の飛速令"},
	"4242":{n:"張松",  r:"SR", c:4, a:370, i:24, d1:555, bs:"兵器の大極撃"},
	"4243":{n:"劉曼",  r:"SR", c:4, a:350, i:19, d1:710, bs:"守衛方陣"},
	"4244":{n:"孟獲",  r:"L", c:4, a:470, i:6, d1:770, bs:"剣兵の大天域"},
	"4245":{n:"波才",  r:"UC", c:3, a:315, i:6, d1:305, bs:"鹵獲の進攻"},
	"4246":{n:"馬元義",  r:"R", c:3.5, a:425, i:14, d1:415, bs:"鹵獲の強攻"},
	"4247":{n:"張任",  r:"UR", c:4, a:495, i:15, d1:505, bs:"飛隠雷光"},
	"4248":{n:"張繍",  r:"SR", c:3.5, a:420, i:13, d1:385, bs:"烈隠雷光"},
	"4249":{n:"張角",  r:"UR", c:3.5, a:350, i:20, d1:320, bs:"守護堅陣"},
	"4253":{n:"董卓",  r:"L", c:4, a:590, i:23, d1:630, bs:"龍神の縮地劫略"},
	"4254":{n:"何進",  r:"UR", c:4, a:495, i:9, d1:530, bs:"鬼神の縮地劫略"},
	"4255":{n:"袁紹",  r:"SR", c:3.5, a:405, i:18, d1:365, bs:"猛将の縮地劫略"},
	"4257":{n:"于吉娘",  r:"L", c:4, a:495, i:22, d1:830, bs:"天衣無縫"},
	"4258":{n:"左慈娘",  r:"UR", c:4, a:515, i:21, d1:420, bs:"飛速迅雷"},
	"4259":{n:"花鬘",  r:"SR", c:4, a:505, i:7, d1:440, bs:"夏神の極意"},
	"4260":{n:"盧氏",  r:"R", c:3, a:255, i:18, d1:380, bs:"千華招来"},
	"4263":{n:"?徳",  r:"R", c:3.5, a:405, i:13, d1:400, bs:"騎兵突攻"},
	"4264":{n:"馬騰・馬超",  r:"L", c:4.5, a:800, i:15, d1:630, bs:"隣地極攻"},
	"4265":{n:"劉曼",  r:"UR", c:1, a:100, i:8, d1:175, bs:"戦神招来"},
	"4266":{n:"郭図",  r:"SR", c:4, a:530, i:23, d1:480, bs:"弓兵の大神撃"},
	"4267":{n:"徐栄",  r:"R", c:4, a:435, i:10, d1:440, bs:"槍兵の極攻"},
	"4268":{n:"厳氏",  r:"R", c:1, a:10, i:7, d1:110, bs:"剣兵増勢"},
	"4269":{n:"袁姫",  r:"R", c:1, a:30, i:7, d1:115, bs:"食糧技巧"},
	"4270":{n:"馬鉄",  r:"R", c:3.5, a:400, i:8, d1:395, bs:"猛将の鹵獲"},
	"4272":{n:"田豊",  r:"UR", c:4, a:410, i:24, d1:740, bs:"智将の大神撃"},
	"4273":{n:"李?",  r:"UR", c:4, a:505, i:6, d1:410, bs:"万里雷光"},
	"4274":{n:"郭汜",  r:"SR", c:3.5, a:420, i:5, d1:405, bs:"戦蹄轟撃"},
	"4275":{n:"牛輔",  r:"R", c:3, a:300, i:9, d1:300, bs:"強襲速撃"},
	"4276":{n:"華雄",  r:"UC", c:3, a:320, i:4, d1:315, bs:"精鋭の進撃"},
	"4277":{n:"李儒",  r:"UC", c:2.5, a:220, i:14, d1:370, bs:"剣兵方陣"},
	"4278":{n:"董卓",  r:"UC", c:2.5, a:275, i:5, d1:395, bs:"剣兵突撃"},
	"5001":{n:"呂布×董卓",  r:"UR", c:4, a:425, i:11, d1:420, bs:""},
	"5002":{n:"張角×何進",  r:"SR", c:3.5, a:310, i:19, d1:400, bs:""},
	"5003":{n:"孫堅×黄祖",  r:"R", c:3, a:270, i:9, d1:385, bs:""},
	"5004":{n:"水鏡娘×パンダ",  r:"R", c:3, a:250, i:13, d1:355, bs:""},
	"5005":{n:"王允×張譲",  r:"UR", c:4, a:365, i:25, d1:520, bs:""},
	"5006":{n:"張繍×典韋",  r:"SR", c:3.5, a:335, i:11, d1:505, bs:""},
	"5007":{n:"公孫?×袁紹",  r:"R", c:3, a:255, i:8, d1:340, bs:""},
	"5008":{n:"曹操×呂布",  r:"UR", c:4, a:480, i:13, d1:385, bs:""},
	"5009":{n:"姜維×鄧艾",  r:"SR", c:3.5, a:330, i:18, d1:500, bs:""},
	"5010":{n:"荀攸×陳宮",  r:"R", c:3, a:200, i:19, d1:430, bs:""},
	"5011":{n:"水鏡娘×パンダ",  r:"SR", c:3, a:270, i:13, d1:365, bs:""},
	"5012":{n:"孫策×太史慈",  r:"UR", c:4, a:500, i:9, d1:480, bs:""},
	"5013":{n:"関羽×顔良",  r:"SR", c:3.5, a:390, i:10, d1:425, bs:""},
	"5014":{n:"楽進×淳于瓊",  r:"R", c:3, a:310, i:7, d1:325, bs:""},
	"5015":{n:"水鏡娘×パンダ",  r:"UR", c:3.5, a:300, i:13, d1:420, bs:""},
	"5016":{n:"王異×馬超",  r:"UR", c:4, a:490, i:10, d1:455, bs:"剣兵の大神撃"},
	"5017":{n:"賈?×韓遂",	r:"SR", c:3.5, a:350, i:20, d1:390, bs:"才略謀略"},
	"5018":{n:"魏延×楊儀",  r:"R", c:3, a:300, i:16, d1:310, bs:"謀反の猛攻"},
	"5019":{n:"大虎×小虎",  r:"UR", c:4, a:440, i:10, d1:550, bs:""},
	"5020":{n:"貂蝉×董卓",  r:"UR", c:2, a:220, i:17, d1:335, bs:""},
	"5021":{n:"左慈娘×水鏡娘",  r:"UR", c:4, a:340, i:24, d1:605, bs:"守衛聖陣"},
	"5022":{n:"?統×張任",	r:"UR", c:4, a:405, i:24, d1:395, bs:""},
	"5023":{n:"呂蒙×関羽",  r:"SR", c:4, a:415, i:16, d1:415, bs:""},
	"5024":{n:"少帝×献帝",  r:"UR", c:4, a:485, i:21, d1:490, bs:""},
	"5025":{n:"諸葛恪×諸葛誕",  r:"UR", c:4, a:425, i:23, d1:555, bs:""},
	"5026":{n:"張飛×馬超",  r:"UR", c:4, a:490, i:9, d1:390, bs:""},
	"5027":{n:"諸葛亮×孟獲",  r:"R", c:3.5, a:325, i:19, d1:505, bs:""},
	"5028":{n:"王允×張譲",  r:"R", c:3, a:235, i:15, d1:385, bs:""},
	"5029":{n:"徐庶×曹仁",  r:"UR", c:4, a:480, i:23, d1:445, bs:""},
	"5030":{n:"凌操×甘寧",  r:"R", c:3.5, a:405, i:10, d1:405, bs:""},
	"5031":{n:"張?×馬謖",	r:"R", c:3, a:290, i:13, d1:320, bs:""},
};

var SPEC = [
	[ 15, 10, 10, 10, 15],	//剣兵
	[ 24,108,104,112,  5],	//盾兵
	[ 50, 40, 25, 55, 40],	//槍兵
	[ 52, 58, 42, 26, 42],	//弓兵
	[ 54, 28, 60, 44, 44],	//騎兵
	[ 85, 56, 56, 56, 85],	//大剣兵
	[ 60,270,260,280, 10],	//重盾兵
	[140,100, 63,137,100],	//矛槍兵
	[145,145,105, 65,105],	//弩兵
	[151, 70,150,110,110]	//近衛騎兵
];

var CSV_RADIUS_S = 25;		//半径S
var CSV_RADIUS_L = 100;		//半径L
var CSV_RADIUS_LL = 600;	//半径L

var USERS;					//君主名
var ALLYS;					//同盟名
var USER_COLORS;			//君主色
var ALLY_COLORS;			//同盟色
var CENTER_X;				//中心X座標
var CENTER_Y;				//中心Y座標
var MY_X = 0;				//自拠点X座標
var MY_Y = 0;				//自拠点Y座標
var BASE_TIME = "";			//基準時刻
var MAP_MODE = MAP_MODE_S;	//地図モード（狭域/中域/広域）
var INPUT_MODE = INPUT_MODE_NAME;	//入力モード（名称/色）
var DISP_NPC_YET = false;	//未攻略NPC表示フラグ
var DISP_NPC_FALLEN = false;	//攻略済NPC表示フラグ
var DISP_PERIOD1 = true;	//期数
var DISP_PERIOD2 = false;	//期数
var DISP_PERIOD3 = false;	//期数
var DISP_PERIOD4 = false;	//期数
var DISP_PERIOD5 = false;	//期数
var DISP_PERIOD6 = false;	//期数
var DISP_PERIOD7 = false;	//期数
var DISP_PERIOD8 = false;	//期数

var DISP_COMPROMISE = 100;	//妥協点
var DISP_MATERIAL = false;	//資源表示

var MAP_WIDE = false;		//プチワイド
var DISP_PICTURE = true;	//マップアイコン表示

var MATCH_FULL = false;		//完全一致フラグ
var MAP_SCALE;				//地図幅
var LOADED_MAPS = new Array();
var CELLS_CACHE = new Array();
var ALLYS_CACHE = new Array();
var USERS_CACHE = new Array();
var ALLYS_INDEX = new Array();
var USERS_INDEX = new Array();
var GET_MAP_LIST = new Array();
var GET_MAP_LIST_COUNTER;
var MAX_MAP_LIST;
var GET_MAP_SLEEP_TID;
var j$;
var ROUTE_ENABLE = false;
var CURSOR_ENABLE = false;

var MEMBER_ID_LIST = new Array();
var MEMBER_ID_LIST_COUNTER;
var MEMBER_ID_MAX_COUNTER;
var MEMBER_INFO_TEXT;
var MEMBER_SLEEP_TID;

//マウスドラッグ用
var MOUSE_DRAGGING_1 = false;
var MOUSE_DRAG_START_X;
var MOUSE_DRAG_START_Y;

var MAP_MATE_COLORS;
var MAP_MATE_COLORS_DEF = new Array(
	"#00a000",	//木のみ
	"#a0a0a0",	//石のみ
	"#a060a0",	//鉄のみ
	"#f0f080",	//糧のみ
	"#ffc040",	//複合
	"#404040"	//取得済
	);
var MAP_MATE_NAMES;
var MAP_MATE_NAMES_DEF = new Array(
	"木のみ",	//木のみ
	"石のみ",	//石のみ
	"鉄のみ",	//鉄のみ
	"糧のみ",	//糧のみ
	"複合",		//複合
	"取得済"	//取得済
	);
var MAP_COLOR_MODE;			//マップ色モード

var MAP_WOOD_COLOR	= 0;	//木
var MAP_STONE_COLOR	= 1;	//石
var MAP_IRON_COLOR	= 2;	//鉄
var MAP_RICE_COLOR	= 3;	//糧
var MAP_MIX_COLOR	= 4;	//複合
var MAP_OTHER_COLOR	= 5;	//他同盟

var map_hostname;	////location.hostnameが付いたﾃﾞｰﾀを削除する為、地図ﾂｰﾙのものは、"map_"+location.hostnameにして他に影響が出ないようにした。faraway111013

var mapAllId = 'mapAll';	//mapツール四季対応？20120524
if(document.getElementById("mapboxInner")) mapAllId = document.getElementById("mapboxInner").firstElementChild.id;

//faraway 2.タイマーのソース(bro3_timer.user.js) 変数部 開始
//faraway 2.タイマーのソース(bro3_timer.user.js) 変数部 終了
//faraway 3.同盟貢献チェッカーのソース(bro3_contrib_checker.user.js) 変数部 開始
var VERSION_3 = "1.04";
var LOCAL_STORAGE_3 = "bro3_contrib_checker";

var DELIMIT_3 = "#$%";

//インデックス
var IDX_RANK = 0; //ランク
var IDX_POINT = 1; //ポイント
var IDX_CONTRIB = 2; //寄付
var IDX_VILLAGE = 3; //拠点

//グローバル変数
var CURRENT_TIME = generateDateString_3(new Date());
var LAST_UPDATE = "";
var ALLY_NAME = "";
var SAVE_DATA = new Array();
var SAVE_USERS = new Array();
//faraway 3.同盟貢献チェッカーのソース(bro3_contrib_checker.user.js) 変数部 終了

//faraway 4.発展チェッカーのソース(bro3_growth_checker.user.js) 変数部 開始
var VERSION4 = "1.07";
var LOCAL_STORAGE4 = "bro3_growth_checker";

var DELIMIT_4 = "#$%";
//faraway 4.発展チェッカーのソース(bro3_growth_checker.user.js) 変数部 終了

//faraway 5.統計グラフ化ツールのソース(bro3_graph.user.js) 変数部 開始
var VERSION_5 = "1.06";
var LOCAL_STORAGE_5 = "bro3_graph";

var DELIMIT_5 = "#$%";
var DELIMIT2_5 = "&?@";
var GRAPH_WIDTH = 745;
var GRAPH_HEIGHT = 500;
var GRAPH_PADDING = 8;

//色定義
var ALLY_COLORS_5 = new Array("blue", "red", "green", "olive", "brown",
	"purple", "black", "indigo", "deeppink", "darkcyan",
	"dodgerblue", "lightcoral", "lawngreen", "yellow", "tomato",
	"plum", "darkgray", "mediumpurple", "pink", "cyan");

//保存データインデックス
var IDX_DATETIME = 0;	//日時
var IDX_POINT_5 = 1;	//ポイント
var IDX_RANK_5 = 2;	//ランク
var IDX_MEMBER = 3;	//メンバー

//グローバル変数
var TOOL_LOADED = false;
var ALLYS_5 = new Array(); //入力同盟名
var CURRENT_ALLYS_5 = new Array();
var ALLYS_INDEX_5 = new Array(); //同盟インデックス
//faraway 5.統計グラフ化ツールのソース(bro3_graph.user.js) 変数部 終了

//faraway 6.同盟ログツールのソース() 変数部 開始
var VERSION_6 = "1.07";
var LOCAL_STORAGE_6 = "bro3_log_tool";

var DELIMIT_6 = "#$%";
var DELIMIT2_6 = "&?@";
var DELIMIT3_6 = "{=]";

//データインデックス
var IDX_SUBJECT = 0; //件名
var IDX_DATE = 1; //ログ時刻
var IDX_ACTOR = 2; //攻撃者、防御者
var IDX_SOLDIER_COUNT = 3; //兵士数
//var IDX_INFORMATION = 4; //情報
var IDX2_ALLY_ID = 0; //同盟ID
var IDX2_ALLY_NAME = 1; //同盟名
var IDX2_USER_ID = 2; //ユーザID
var IDX2_USER_NAME = 3; //ユーザ名
var IDX2_VILLAGE_ID = 4; //拠点ID
var IDX2_VILLAGE_NAME = 5; //拠点名

//グローバル変数
var LOG_ID = getParameter_6("id");
var LOG_DATA = new Array();
//faraway 6.同盟ログツールのソース() 変数部 終了

//faraway 7.NPC砦、領土情報検索ツールのソース(bro3_npc_castle_info2.user.js) 変数部 開始
var DELIMIT1_7 = "#$%";
var DELIMIT2_7 = "&?@";
var OWNER_SPLITKEY = " ";
var VERSION_KEY = "vtX200";
var VERSION_7 = "2.49k2";

// データフラグ（初期値）
var FLAG1 = "1000000000";
var FLAG2 = "0000000  0  0  000000000000";
var FLAG3_1 = "010000情報を表示する１";
var FLAG3_2 = "010000情報を表示する２";
var FLAG3_3 = "010000情報を表示する３";
var FLAG4	= "";

// ブラウザ判別用
var browserType;

// 新鯖判定用
var add51_51mode = 0;

// スプレッドシート名
var spreadsheet = '';

// 共通関数
var d_7 = document;
var $d = function(id) { return d_7.getElementById(id); };
var $x_7 = function(xp,dc) { return d_7.evaluate(xp, dc||d_7, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
var $e_7 = function(key) { return d_7.evaluate(key, document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); };

// 検索オプション(種別)
var FLAG1_NPC = 0; // NPC砦
var FLAG1_LV1 = 1; // ☆1
var FLAG1_LV2 = 2; // ☆2
var FLAG1_LV3 = 3; // ☆3
var FLAG1_LV4 = 4; // ☆4
var FLAG1_LV5 = 5; // ☆5
var FLAG1_LV6 = 6; // ☆6
var FLAG1_LV7 = 7; // ☆7
var FLAG1_LV8 = 8; // ☆8
var FLAG1_LV9 = 9; // ☆9

// 検索オプション(特殊1)
var FLAG2_EMPTY = 0;			// 空き地検索
var FLAG2_LAND = 1;			 // 領土検索
var FLAG2_ANALYZE = 2;		  // 資源判別検索
var FLAG2_RADER = 3;			// レーダーの表示
var FLAG2_OWNER = 4;			// 本拠地一覧の表示
var FLAG2_EMPTY_DRAW = 5;	   // 空き地を着色
var FLAG2_EMPTY_DRAW_COLOR = 6; // 空き地の枠色
var FLAG2_STRONG_AREANO = 7;	// 強調表示領地リスト番号(3桁)
var FLAG2_STRONG_AREANO2 = 10;	// 強調表示領地リスト番号(3桁)
var FLAG2_STRONG_AREANO3 = 13;	// 強調表示領地リスト番号(3桁)
var FLAG2_MENU2 = 16;		   // メニュークローズドスイッチ2
var FLAG2_MENU4 = 17;		   // メニュークローズドスイッチ4
var FLAG2_HFUNC = 18;		   //
var FLAG2_SEARCH_LEVEL = 19;	// ルート探索：探索レベル
var FLAG2_SKIP_RES = 20;		// ルート探索：回避資源タイプ
var FLAG2_SKIP_USER = 21;	   // 個人領地を通過
var FLAG2_SKIP_GROUP = 22;	  // グループ領地を通過
var FLAG2_RANDOM_ROUTE = 23;	// 可変ルート
var FLAG2_DIRECTION = 24;	   // 方位表示
var FLAG2_NOEXEC51 = 26;		// 51x51モードでツールを動かさない

// 検索オプション(個人/同盟検索)
var FLAG3_ENABLE = 0;  // 有効/無効
var FLAG3_USER = 1;	// ユーザー検索
var FLAG3_GROUP = 2;   // 同盟検索
var FLAG3_MATCH = 3;   // 完全一致
var FLAG3_FILL = 4;	// 領土着色のみ
var FLAG3_COLOR = 5;   // カラー番号
var FLAG3_NAME = 6;	// 個人、同盟名称

// ルート自動構築用変数
var AUTO_ROUTE_NONE = 0;
var AUTO_ROUTE_EDIT_FIRST = 1;
var AUTO_ROUTE_EDIT_LAST = 2;
var AUTO_ROUTE_EDIT_END = 3;

var autoroute = AUTO_ROUTE_NONE;
var autoroute_f = [0,0,""];
var autoroute_l = [0,0,""];
var autoroute_f2 = [0,0];

var autoroute_path = new Array();
var autoroute_maxpaths = 0;

// 個人/同盟検索結果表示色
var cname = ["赤","紫","桃","橙","黄","緑","水","青","灰","白"];
var cname_en = ["red","purple","pink","orange","yellow","green","cyan","blue","gray","white"];

var season1 = [
		["なし",				   0, 0, 0, 0, 0, " "],		// 0
		["☆1( 1- 0- 0- 0) 1期～", 1, 0, 0, 0, 1, "A"],		// 1
		["☆1( 0- 1- 0- 0) 1期～", 0, 1, 0, 0, 1, "B"],		// 2
		["☆1( 0- 0- 1- 0) 1期～", 0, 0, 1, 0, 1, "C"],		// 3
		["☆1( 0- 0- 0- 1) 1期～", 0, 0, 0, 1, 1, "D"],		// 4
		["☆2( 3- 0- 0- 0) 1期～", 3, 0, 0, 0, 2, "E"],		// 5
		["☆2( 0- 3- 0- 0) 1期～", 0, 3, 0, 0, 2, "F"],		// 6
		["☆2( 0- 0- 3- 0) 1期～", 0, 0, 3, 0, 2, "G"],		// 7
		["☆3( 1- 1- 1- 0) 1期～", 1, 1, 1, 0, 3, "H"],		// 8
		["☆3( 0- 0- 0- 4) 1期～", 0, 0, 0, 4, 3, "I"],		// 9
		["☆3( 0- 0- 0- 1) 2期～", 0, 0, 0, 1, 3, "J"],		// 10
		["☆4( 2- 2- 2- 0) 1期～", 2, 2, 2, 0, 4, "K"],		// 11
		["☆4( 2- 2- 2- 2) 1期  ", 2, 2, 2, 2, 4, "L"],		// 12
		["☆4( 0- 0- 0- 8) 1期～", 0, 0, 0, 8, 4, "M"],		// 13
		["☆5( 6- 0- 0- 0) 1期～", 6, 0, 0, 0, 5, "N"],		// 14
		["☆5( 0- 6- 0- 0) 1期～", 0, 6, 0, 0, 5, "O"],		// 15
		["☆5( 0- 0- 6- 0) 1期～", 0, 0, 6, 0, 5, "P"],		// 16
		["☆5( 0- 0- 0- 1) 2期～", 0, 0, 0, 1, 5, "Q"],		// 17
		["☆5( 2- 2- 1- 0) 3期～", 2, 2, 1, 0, 5, "R"],		// 18
		["☆5( 1- 1- 2- 0) 3期～", 1, 1, 2, 0, 5, "S"],		// 19
		["☆6(10- 0- 0- 0) 1期～",10, 0, 0, 0, 6, "T"],		// 20
		["☆6( 0-10- 0- 0) 1期～", 0,10, 0, 0, 6, "U"],		// 21
		["☆6( 0- 0-10- 0) 1期～", 0, 0,10, 0, 6, "V"],		// 22
		["☆6( 2- 2- 2- 0) 2期～", 2, 2, 2, 0, 6, "W"],		// 23
		["☆7( 3- 3- 3- 0) 1期  ", 3, 3, 3, 0, 7, "X"],		// 24
		["☆7( 2- 4- 4- 0) 2期～", 2, 4, 4, 0, 7, "Y"],		// 25
		["☆7( 0- 0- 0- 1) 2期～", 0, 0, 0, 1, 7, "Z"],		// 26
		["☆7( 0- 0- 0-12) 2期～", 0, 0, 0,12, 7, "a"],		// 27
		["☆8( 4- 4- 4- 4) 1期  ", 4, 4, 4, 4, 8, "b"],		// 28
		["☆8( 4- 1- 2- 0) 2期～", 4, 1, 2, 0, 8, "c"],		// 29
		["☆8( 2- 4- 1- 0) 2期～", 2, 4, 1, 0, 8, "d"],		// 30
		["☆8( 1- 2- 4- 0) 2期～", 1, 2, 4, 0, 8, "e"],		// 31
		["☆8(14- 0- 0- 0) 3期～",14, 0, 0, 0, 8, "f"],		// 32
		["☆8( 0-14- 0- 0) 3期～", 0,14, 0, 0, 8, "g"],		// 33
		["☆8( 0- 0-14- 0) 3期～", 0, 0,14, 0, 8, "h"],		// 34
		["☆9( 0- 0- 0-18) 1期～", 0, 0, 0,18, 9, "i"],		// 35
		["☆9( 1- 1- 1- 2) 2期～", 1, 1, 1, 2, 9, "j"],		// 36
		["☆9( 4- 4- 4- 4) 2期～", 4, 4, 4, 4, 9, "k"],		// 37
		["☆9( 1- 0- 0- 0) 3期～", 1, 0, 0, 0, 9, "l"],		// 38
		["☆9( 0- 1- 0- 0) 3期～", 0, 1, 0, 0, 9, "m"],		// 39
		["☆9( 0- 0- 1- 0) 3期～", 0, 0, 1, 0, 9, "n"],		// 40
		["☆4( 2- 2- 2- 2) 10期～", 2, 2, 2, 2, 4, "o"],		// 41
		["☆4( 2- 2- 2- 0) 10期～", 2, 2, 2, 0, 4, "p"],		// 42
		["☆5( 1- 1- 1- 1) 10期～", 1, 1, 1, 1, 5, "q"],		// 43
		["☆6( 2- 2- 2- 0) 10期～", 2, 2, 2, 0, 6, "r"],		// 44
		["☆7( 4- 4- 2- 0) 10期～", 4, 4, 2, 0, 7, "s"],		// 45
		["☆7( 4- 2- 4- 0) 10期～", 4, 2, 4, 0, 7, "t"],		// 46
		["☆7( 0- 0- 0- 11) 10期～", 0, 0, 0, 11, 7, "u"],		// 46
		["☆8( 0- 0- 0- 1) 10期～", 0, 0, 0, 1, 8, "v"],		// 47
		["☆8( 1- 1- 1- 4) 10期～", 1, 1, 1, 4, 8, "w"],		// 48
		["☆8( 4- 3- 3- 0) 10期～", 4, 3, 3, 0, 8, "x"],		// 49
		["☆8( 3- 4- 3- 0) 10期～", 3, 4, 3, 0, 8, "y"],		// 50
		["☆8( 3- 3- 4- 0) 10期～", 3, 3, 4, 0, 8, "z"],		// 51
		["☆9( 0- 0- 0- 16) 10期～", 0, 0, 0, 16, 9, "α"],		// 52
		["☆9( 8- 0- 8- 0) 10期～", 8, 0, 8, 0, 9, "β"],		// 53
		["☆9( 0- 8- 8- 0) 10期～", 0, 8, 8, 0, 9, "γ"],		// 54
		["☆9( 8- 8- 0- 0) 10期～", 8, 8, 0, 0, 9, "δ"],		// 55
		["☆9( 1- 1- 1- 0) 10期～", 1, 1, 1, 0, 9, "ε"],		// 56
		["☆1( 2- 0- 0- 0) 11期～", 2, 0, 0, 0, 1, "ζ"],		// 57
		["☆1( 0- 2- 0- 0) 11期～", 0, 2, 0, 0, 1, "η"],		// 58
		["☆1( 0- 0- 2- 0) 11期～", 0, 0, 2, 0, 1, "θ"],		// 59
		["☆3( 1- 1- 1- 0) 11期～", 1, 1, 1, 0, 3, "ι"],		// 60
		["☆6( 0- 0- 0- 0) 11期～", 0, 0, 0, 0, 6, "κ"],		// 61
		["☆7( 0- 0- 0- 0) 11期～", 0, 0, 0, 0, 7, "λ"],		// 62
		["☆8( 4- 4- 5- 2) 11期～", 4, 4, 5, 2, 8, "μ"],		// 63
		["☆8( 4- 5- 4- 2) 11期～", 4, 5, 4, 2, 8, "ν"],		// 64
		["☆8( 5- 4- 4- 2) 11期～", 5, 4, 4, 2, 8, "ξ"],		// 65
		["☆8( 0- 0- 0- 15) 11期～", 0, 0, 0, 15, 8, "ο"],		// 66
		["☆8( 0- 0- 0- 0) 11期～", 0, 0, 0, 0, 8, "π"],		// 67
		["☆9( 3- 3- 3- 3) 11期～", 3, 3, 3, 3, 9, "ρ"]		// 68
];

// ルート探索条件
var croutename = ["☆1のみ","☆2以下","☆3以下","☆4以下","☆5以下","☆6以下","☆7以下","☆8以下","☆回避なし"];
var croutelim = ["なし","★2森","★2岩","★2鉄"];
var groupname = ["指定なし","No.1","No.2","No.3"];

// 探索パターン（距離１）
var chkptn = [ [1,0], [0,1], [-1,0], [0,-1], [1,1], [1,-1], [-1,1], [-1,-1] ];
var chkptn_r  = [
		[ 1, 0], [ 0, 1], [-1, 0], [ 0,-1],	// 01
		[ 1, 0], [ 0, 1], [ 0,-1], [-1, 0],	// 02
		[ 1, 0], [-1, 0], [ 0, 1], [ 0,-1],	// 03
		[ 1, 0], [-1, 0], [ 0,-1], [ 0, 1],	// 04
		[ 1, 0], [ 0,-1], [-1, 0], [ 0, 1],	// 05
		[ 1, 0], [ 0,-1], [ 0, 1], [-1, 0],	// 06
		[ 0, 1], [ 1, 0], [-1, 0], [ 0,-1],	// 07
		[ 0, 1], [ 1, 0], [ 0,-1], [-1, 0],	// 08
		[ 0, 1], [-1, 0], [ 1, 0], [ 0,-1],	// 09
		[ 0, 1], [-1, 0], [ 0,-1], [ 1, 0],	// 10
		[ 0, 1], [ 0,-1], [-1, 0], [ 1, 0],	// 11
		[ 0, 1], [ 0,-1], [ 1, 0], [-1, 0],	// 12
		[-1, 0], [ 1, 0], [ 0, 1], [ 0,-1],	// 13
		[-1, 0], [ 1, 0], [ 0,-1], [ 0, 1],	// 14
		[-1, 0], [ 0, 1], [ 1, 0], [ 0,-1],	// 15
		[-1, 0], [ 0, 1], [ 0,-1], [ 1, 0],	// 16
		[-1, 0], [ 0,-1], [ 0, 1], [ 1, 0],	// 17
		[-1, 0], [ 0,-1], [ 1, 0], [ 0, 1],	// 18
		[ 0,-1], [ 1, 0], [ 0, 1], [-1, 0],	// 19
		[ 0,-1], [ 1, 0], [-1, 0], [ 0, 1],	// 20
		[ 0,-1], [ 0, 1], [ 1, 0], [-1, 0],	// 21
		[ 0,-1], [ 0, 1], [-1, 0], [ 1, 0],	// 22
		[ 0,-1], [-1, 0], [ 0, 1], [ 1, 0],	// 23
		[ 0,-1], [-1, 0], [ 1, 0], [ 0, 1],	// 24
		[ 1, 1], [ 1,-1], [-1, 1], [-1,-1],	// 25
		[ 1, 1], [ 1,-1], [-1,-1], [-1, 1],	// 26
		[ 1, 1], [-1, 1], [ 1,-1], [-1,-1],	// 27
		[ 1, 1], [-1, 1], [-1,-1], [ 1,-1],	// 28
		[ 1, 1], [-1,-1], [-1, 1], [ 1,-1],	// 29
		[ 1, 1], [-1,-1], [ 1,-1], [-1, 1],	// 30
		[ 1,-1], [ 1, 1], [-1, 1], [-1,-1],	// 31
		[ 1,-1], [ 1, 1], [-1,-1], [-1, 1],	// 32
		[ 1,-1], [-1, 1], [ 1, 1], [-1,-1],	// 33
		[ 1,-1], [-1, 1], [-1,-1], [ 1, 1],	// 34
		[ 1,-1], [-1,-1], [-1, 1], [ 1, 1],	// 35
		[ 1,-1], [-1,-1], [ 1, 1], [-1, 1],	// 36
		[-1, 1], [ 1, 1], [ 1,-1], [-1,-1],	// 37
		[-1, 1], [ 1, 1], [-1,-1], [ 1,-1],	// 38
		[-1, 1], [ 1,-1], [ 1, 1], [-1,-1],	// 39
		[-1, 1], [ 1,-1], [-1,-1], [ 1, 1],	// 40
		[-1, 1], [-1,-1], [ 1,-1], [ 1, 1],	// 41
		[-1, 1], [-1,-1], [ 1, 1], [ 1,-1],	// 42
		[-1,-1], [ 1, 1], [ 1,-1], [-1, 1],	// 43
		[-1,-1], [ 1, 1], [-1, 1], [ 1,-1],	// 44
		[-1,-1], [ 1,-1], [ 1, 1], [-1, 1],	// 45
		[-1,-1], [ 1,-1], [-1, 1], [ 1, 1],	// 46
		[-1,-1], [-1, 1], [ 1,-1], [ 1, 1],	// 47
		[-1,-1], [-1, 1], [ 1, 1], [ 1,-1]	// 48
];

// ルート探索条件（資源回避）
var cchkres = [ 0, 5, 6, 7 ];

//--------------------------------//
// アイコン定義（パステルカラー） //
//--------------------------------//
var icon_c_7 = new Array();

// 通常モード（１１ｘ１１用）
icon_c_7[0] = new Array();
icon_c_7[0][0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAAk0lEQVR42u3VwQmAMAxA0WY'+
		'EwV0cwnkdwl0ER6heRKhnS/n5/5hLeIe0UWstmQrB8ATTE0xPMD3B9ATTE0xPMD3B9ATTE0xPMD3B9LqCI+Kz7N4faPC2v/vWJXK'+
		'Aj7OUeRIsWLBgwYIFC+4AfkoBbmdo8AgJpucN/w1O90r7D9PB7QwNHiHB9ATTE0xPMD3B9NKBL9LFOZj2H7EeAAAAAElFTkSuQmCC';
icon_c_7[0][1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAAtElEQVR42u3XOxKCMBgAYX6'+
		'OYMF4J8/AMb2UBUcwSkOR4CjMxOiyW+YB8yVVIqXUHakQDE8wPcH0BNMTTE8wPcH0BNMTTE8wPcH0BNMTTK8qOCLefvz5/0CB0+3'+
		'6en64QMH3qZzsT2Bw3nwAVHA+ttw4Ebx2AIIFCxYsWLBgwYIF7wTmYzm4mK98AE1fS8X6L9x4u/fw2vrzCAF/up5ww1v3/DX4FxN'+
		'MTzA9wfQE0xNM73DgBw8JYpiEhB6BAAAAAElFTkSuQmCC';
icon_c_7[0][2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAAr0lEQVR42u3VsRKDIBAAUa5'+
		'KnfxWvje/ZWorEgvrw4IZ2dut0fGBQPTeW6VCMDzB9ATTE0xPMD3B9ATTE0xPMD3B9ATTE0xPML2p4Ii4/PL/98TS4G//DI9/xps'+
		'B3tuWjn20FwecdUwIBpyNOf8ABHhkQgQLXghcbg+XPKVL3sPnCmbhwAcoCweeDRIs2D08D5yFOqWzUPfwaAjw1WeWBt8xwfQE0xN'+
		'MTzA9wfTKgX8OKmKYVBXGEwAAAABJRU5ErkJggg==';
icon_c_7[0][3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAAsElEQVR42u3VwQ2DMBAAQV8'+
		'HiGJoIvXSRIqJ0oEJD34ImwdSvLf7PhBjsIlaa8lUCIYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpCab3KDgibt/89zwxNPhd1+7'+
		'5JV4M8Ld8mrNTmTngVvuCYMCtmeMLQIB7FkSw4IHA6fZwylPa//BJqDfcmkHt4Z4FESx4IHC6PZzylPY/fBECfPeaocH/mGB6guk'+
		'JpieYnmB66cAbnXhimOdx8jMAAAAASUVORK5CYII=';
icon_c_7[0][4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAAqElEQVR42u3TMRKDIBQAUX5'+
		't53VyBM/rEbxOOmu0SQocgk0SXXY7+A7O0yFyzqmnQjA8wfQE0xNMTzA9wfQE0xNMTzA9wfQE0xNMTzC9r4Ij4nD4/r44O78leM7'+
		'Lez3F4wD+NL8t+JnWNKahCq7NBQsWLFjwr8FlaHAtJLgVCtwK9Ydbz6Du8JkPIliwYMGCrw5+1QW43EOD/5FgeoLpCaYnmJ5get2'+
		'BN8++qph3fIzUAAAAAElFTkSuQmCC';
icon_c_7[0][5] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAAsElEQVR42u3XMRKDIBBA0Wy'+
		'V2lzL8+ZasbYieoGsTAbRz/81Mr6CRaOU8hipEAxPMD3B9ATTE0xPMD3B9ATTE0xPMD3B9ATTE0yvKTgiqjff3iduDX4vx/efp2C'+
		'AP2u+9vWEgXdQFg68g7Jw4NYgwYI9w+3AWagpnYW6h7POPOPdv6XPHmpd/5Z6THHBgv8EZWtw4OGmtPfwjxDg2mduDb5igukJpie'+
		'YnmB6gukNB/4CHypimDIwJQkAAAAASUVORK5CYII=';
icon_c_7[0][6] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAAsklEQVR42u3VsQ2DMBBA0Vy'+
		'djnUYIfNmhKyTjtqENhI6kDCG7/9r2+IVd0Qp5dFTIRieYHqC6QmmJ5ieYHqC6QmmJ5ieYHqC6QmmJ5heVXBE7H789z1xa/Dnvf3'+
		'98RUM8PTNzz4HGHgBZeHACygLB64NEizYGa4HzkJt6ayu/sNnznjzGT57qTXd0i22uGDBB4P/Q4PXQoKzUOCtIcB779wafMUE0xN'+
		'MTzA9wfQE0+sOPAO9jouYRH9pQgAAAABJRU5ErkJggg==';
icon_c_7[0][7] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAAo0lEQVR42u3QQQ5AMBQAUX9'+
		'lzbWc17VYWxUJiTQRLERMZ3btb5q+RkqpKqkQDE8wPcH0BNMTTE8wPcH0BNMTTE8wPcH0BNMTTO9VcEQ8vnx5T/wanPrx/vmugYC'+
		'H6fpwW8PAC+i0bY4Dr6C8fI4DH0FXc8G/Ae/rEsD5Hhp850MECxYsWLBgwYIFvwre1yWA8z00+IsE0xNMTzA9wfQE0ysOPAMbFYa'+
		'YImwD1wAAAABJRU5ErkJggg==';
icon_c_7[0][8] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAAqklEQVR42u3UwQmAMBAAQa8'+
		'F27Je27KFqOBDAiH6EMze7vcu4iAmSilTpkIwPMH0BNMTTE8wPcH0BNMTTE8wPcH0BNMTTE8wvU/BEfH64cf7xNDgsq7P95cFAt6'+
		'2/vI8w8AHqNk1x4FPUF09x4HvoN5csOABwHVocDMkuBcOnO4LZ/yHU97SgungOjS4GRLcCwV+uk8Avz0zNPiPCaYnmJ5geoLpCaa'+
		'XDrwDAUW0mKahbVUAAAAASUVORK5CYII=';
icon_c_7[0][9] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAArUlEQVR42u3VQQ5AMBBAUXM'+
		'Ft3Qit3SFIrGQJgwLif7+v+0Qr1KilDL0VAiGJ5ieYHqC6QmmJ5ieYHqC6QmmJ5ieYHqC6Qmm9yk4Il7ffHueaBpcpun5/DxDwMu'+
		'SD48jDLyBLjvWceAdVFev48BnULYuWHAD4Do0+DIkOAsFziK94WwGdYafbIhgwQ2BuzvDXX6l/Q/fzRPAb69pGvzHBNMTTE8wPcH'+
		'0BNPrDrwCyACLmJpZR94AAAAASUVORK5CYII=';

// 通常モード（１５ｘ１５用）
icon_c_7[1] = new Array();
icon_c_7[1][0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMA/wD/AP83WBt9AAAAZklEQVR42u3TsQ2AMAxFQTw'+
		'VQzAvQzCVQaIJFVUUW7rXufm6IonM3DoVwMDAwMDAwJUCBgYGBv4ZjPgMPvtRHnxe7+axBzAwMDDwAvB4lwfPDrjdk2j56dqBx7s'+
		'8eHbAwMDAwGu7ARPd2ak7UfORAAAAAElFTkSuQmCC';
icon_c_7[1][1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMA/wD/AP83WBt9AAAAdUlEQVR42u3VywmAMBAFQLc'+
		'Jm7Jem7KJ6MWDXzwkMeK847I8hhDYSCl1X0oAAwMDAwMDtxRgYGBg4JOSiMuSpT+aBKdpPM77AbjIl1jxzYL3eGBgYGDguuC7w7G'+
		'ZZ8AXPc2bnUyv/V/wk71mwDUDDAwMDPxuZukM7anou6r5AAAAAElFTkSuQmCC';
icon_c_7[1][2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMA/wD/AP83WBt9AAAAfElEQVR42u3TsQ2AMAxEUW4'+
		'E5mJe5mIEAwUdjiIFwVn8a2M5z5KtiJgqRYABAwYMGDBgpwAGDBgw4JsmUleT4y/ZgLdYmzWzFsBD4OztGsQK3BoE8C9XouTRlQW'+
		'fsCy24CdggFvgLJYrkcX26MqAe+pswG8GMGDAgAF/mx0rnO2pIl/VqAAAAABJRU5ErkJggg==';
icon_c_7[1][3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMA/wD/AP83WBt9AAAAeElEQVR42u3TQQqAMAxEUed'+
		'SXqLn9RJeKrrpzoaCoBP6Z5uQvkCqiNgqRYABAwYMGDBgpwAGDBgw4Ich0tSQ+y3ZgM840p5dDfAr8KjWF7ECZ4sAXvIkSn66cuB'+
		'RzfIkskUAL3kSJT9dOfBMnw34ywAGDBgw4H9zASZ+7amio7DkAAAAAElFTkSuQmCC';
icon_c_7[1][4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMA/wD/AP83WBt9AAAAc0lEQVR42u3Syw2AIBAFQLc'+
		'uS7BeS7AuNJ4gQS/+1mTeCZbkZSBEKWX4UwIYGBgYGBg4U4CBgYGBOyURTcnWGWfzFOC5LPt6irEB9+bAwMA3g+ukBx8F+Cr46Cz'+
		'llzi7CDAw8Mvgep8e/MgjAAMDAwN/mhV9vBe4d0lEIAAAAABJRU5ErkJggg==';
icon_c_7[1][5] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMA/wD/AP83WBt9AAAAfklEQVR42u3VsRGAMAxDUTQ'+
		'CczEvczGCgR7nUiQgH19tcs4rrIsiYqkUAQYMGDBgwICdAhgwYMCAH4ZIXUOut2QD3o/2nG0V4CHgG5bFFjwCBrgFzmK5EllsS1c'+
		'GnJ2N3u2pX/OMMv4TXG4lSpauHLjnng34zQAGDBgw4G9zAiuc7ankdBvGAAAAAElFTkSuQmCC';
icon_c_7[1][6] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMA/wD/AP83WBt9AAAAfElEQVR42u3TwQ2AMAhGYf+'+
		'5HMF5HcG5UK9GmialCsl754Z+B5CZLZUSYMCAAQMGDDhTgAEDBgz4ZYjUNeT6S2nAx96es24CHAK+YV5pwREwwC2wV8qV8Ep7dOX'+
		'Az5WI3u2pRzfjGAGXWwkvwKPgnndpwF8GGDBgwID/7QRyWgG4ei4f7wAAAABJRU5ErkJggg==';
icon_c_7[1][7] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMA/wD/AP83WBt9AAAAcklEQVR42u3QwQmAMAwFUDO'+
		'CczmvczlC1YPQgxYRpRHevyWE5LVRShn+lAAGBgYGBgbOFGBgYGDgkyURt5ZstyINuMxLe2YagV8B77A6dT8t+IBd9YGfgOs6Pbj'+
		'1EGBgYGDgvuC6Tg/+5BOAgYGBgbtmBbpmAriV8cm1AAAAAElFTkSuQmCC';
icon_c_7[1][8] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMA/wD/AP83WBt9AAAAeUlEQVR42u3TQQrAIAxE0eZ'+
		'8ntfzpe2ikEVTBMVO4M8yDPEtjLn7USkGGDBgwIABA1YKYMCAAQN+WWI2tOR6y2TA3vt3pzXAS8A3LCbOZcEPLJsDngXHyIPTDuB'+
		'F4HJfouTRlQPHyIPTDuBJ8EhPBrwzgAEDBgz435zr1xW4O4eh7gAAAABJRU5ErkJggg==';
icon_c_7[1][9] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMA/wD/AP83WBt9AAAAeklEQVR42u3TQQqAMAxEUXP'+
		'cnqjHjboQsjClUNEJ/lmmIX2F1Nx9qxQDDBgwYMCAASsFMGDAgAHfDDGbGnLcZTJgb23c0zvgR8AnLCbWZcEXLKsDXgXHyIPTHsC'+
		'L4OxMciVGDwH8y5Uo+enKgWf6ZMBvBjBgwIABf5sd0goBuPzg7coAAAAASUVORK5CYII=';

// 通常モード（２０ｘ２０用）
icon_c_7[2] = new Array();
icon_c_7[2][0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMA/wD/AP83WBt9AAAAT0lEQVR42u3SsQkAIAxEUW8'+
		'qh3Beh3CqaKOdXeAU/q/SGB5BRURxJxAgQIAAAQKEAyHpPF57ZEP0EaVVgQDxFmLPNkRW/1+CP5EdCBAgbk0OjJy/yRhvJQAAAAB'+
		'JRU5ErkJggg==';
icon_c_7[2][1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMA/wD/AP83WBt9AAAAZklEQVR42u3UQQrAIAxE0c4'+
		'leqme10v1EqmrFKxuJCRd/NlFUB4DRmZ2VEcgQIAAAQIEiEyEpM+l/o7SEXa3dz6vGoQ30DEliLERECB+gZj9Dp83MCF7ws83Gwn'+
		'bmOlNRAcECBCrPPueqb9NtTxIAAAAAElFTkSuQmCC';
icon_c_7[2][2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMA/wD/AP83WBt9AAAAZklEQVR42u3TsQ2AMAxEUW4'+
		'E5mJe5mIEAwWNkRsUnRH8Ky0leTklioipOwIBAgQIECBAOBGSykXHfrIhtlhv81mLF5FnJ8qKqJr5XxOveRPXzXNaEE8O/V4TOe2'+
		'/w97E6IAAAaLKDpSiqb9xGAVvAAAAAElFTkSuQmCC';
icon_c_7[2][3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMA/wD/AP83WBt9AAAAYElEQVR42u3SsQnAMAxE0dx'+
		'SWSLzZoksJceFmxiRwiAZ9K8U2DyOk5kd2REIECBAgAABIhIhyX30/qcwxGP3dD91xSK+t44KRXjN1GuCTfw1U6+JbTcxkraJ1YA'+
		'AAcJLA7hvqb+ZTBceAAAAAElFTkSuQmCC';
icon_c_7[2][4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMA/wD/AP83WBt9AAAAX0lEQVR42u3QQQpAIQhF0d6'+
		'6WkLrbQl/XdakCKFRoH9w30gF4ajMrGRHIECAAAECBIhIhKS9NPfl+zBEt6801Y04exBpiJU0hE84ws/CP3H7DIjfIFadhng+AgQ'+
		'IEJcMJijFv15TAzAAAAAASUVORK5CYII=';
icon_c_7[2][5] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMA/wD/AP83WBt9AAAAaUlEQVR42mP8//8/w0ADxlF'+
		'HjDpi1BGjjhh1xKgjRh1BT0cwMjLi1AQ0j5Fujtj6HlOftyAj/R0BsnTAQ4Jcnw+/kEAHdE8T6GKURA9VyglK08jQDYlBmyZgYMD'+
		'SBKVg1BGjjhh1BC4AAJSiqb+NvhCCAAAAAElFTkSuQmCC';
icon_c_7[2][6] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMA/wD/AP83WBt9AAAAZUlEQVR42u3SwRGAIAxEUbc'+
		'uS6BeS7CuqFecXITZjMzfKxN4JFFEbNURCBAgQIAAAcKJkJQW3ffJhjiPd93e5Ec8j5Z34uvP1+tEn/KdGBnPlJ0Y3ZH/d6KPHZG'+
		'd2RCzAwIEiCwXx8e2v9yP3/EAAAAASUVORK5CYII=';
icon_c_7[2][7] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMA/wD/AP83WBt9AAAAZUlEQVR42u3QsQ3AIAxEUW4'+
		'E5sq8zJURHJAIRSIrBZKd4rvCSODnk5mV7BIIECBAgAABIhIhyX3U/1MYwtr5vj9qPGIMXQnMPgUxhj77MMRKIAvxlQwIEL9B3Oc'+
		'0xPYSIECAcOoCT+K3v5E4knUAAAAASUVORK5CYII=';
icon_c_7[2][8] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMA/wD/AP83WBt9AAAAbElEQVR42u3QsQ3AIAwEQH4'+
		'ECqZiXqZKwQgmkZIUsdxF74J3Z1vg08PMSnZBCCGEEEIIIYRgIgCEj87/QEPYGH7eOx9xHX0TuPsUxDFnabXmItKTcPNtk3iOfvv'+
		'9knBzNiLa0RB/lxBCCBHVArM9wr9FTulDAAAAAElFTkSuQmCC';
icon_c_7[2][9] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMA/wD/AP83WBt9AAAAb0lEQVR42u3SQQrAIBADQPM'+
		'ED32kL/KRPfiEbQvFQ2VPhaTQ5OaCOoRFRBR1YIQRRhhhhBFGMBEA0kvne6AhorV13jsfcX06G7jPEsQ+Rtlq1SLkTSxzNuI5oze'+
		'RNfO/Jj67E7MR1U68jRFGGJHlADoQtb8fdhutAAAAAElFTkSuQmCC';

//--------------------------//
// アイコン定義（資源表示） //
//--------------------------//
var icon_cs = new Array();

// 資源モード（１１ｘ１１用） 資源アイコン＝numx5+maxtype、0=平均,1=木,2=石,3=鉄,4=糧
icon_cs[0] = new Array();
icon_cs[0][1*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAlUlEQVR42u3XwQ2AIBAAQa8'+
		'zSqcz5WlQY9Sgsuw+CQbmeBk552mkQjA8wfQE0xNMTzA9wfQE0xNMTzA9wfQE0xNMTzC9puCU0ny2p5wfKHDp+PAIwYJ7A9'+
		'dr6wHgwHsDECxYsGDBggULFiz4JrBeq8F1rQfw6d/S5jIvvLhgwQ/BV7/pGvzHBNMTTE8wPcH0BNMbDrwA2HoUTHu/QmkAA'+
		'AAASUVORK5CYII=';
icon_cs[0][1*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAjUlEQVR42u3XQQqAIBBA0eZ'+
		'mHt2bVcuYoiiQ9Pv/UoTxzc6otS4zFYLhCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpNQWXUtanO/v8YIHvyCFY8Hjg3P'+
		'GEBr5cgGDBggULFixYsGDBH4G5BM61XsC/v6XTawQL7h/8sqHBPSaYnmB6gukJpieY3nTgDQ4o7j0786IyAAAAAElFTkSuQ'+
		'mCC';
icon_cs[0][1*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAkUlEQVR42u3XQQ6AIAwAQfs'+
		'zns7P0KOpRqOGKOvumYROORG11ulPhWB4gukJpieYnmB6gukJpieYnmB6gukJpieYnmB6XcGllHZ2Zrk/WOB2YI4QLHg4cG'+
		'69ABp4dwGCBQsWLFiwYMGCBd8E5hI413sB7/6WNtP0f3HBgp+CLzY0+IsJpieYnmB6gukJpvc78AxgUQFM5g3eGQAAAABJR'+
		'U5ErkJggg==';
icon_cs[0][1*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAnUlEQVR42u3Xyw2AIBAAUem'+
		'MAizEkizEAugMPRrUGDX4GWeOBANvORlSSs2fCoLhCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpVQXHGPPenun8gALnod'+
		's+vO0FC/4auFybDwAHXhuAYMGCBQsWLFiwYMEngeVaCS6rPYBH/5YWl7nhxQULvgg++s2nwW9MMD3B9ATTE0xPML3fgUeQA'+
		'xRM1lP3xgAAAABJRU5ErkJggg==';
icon_cs[0][1*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAl0lEQVR42u3XwQ2AIBTAUNm'+
		'M0RiNzdCjQY1Rg0ppjwQD73My5JynkQqC4QmmJ5ieYHqC6QmmJ5ieYHqC6QmmJ5ieYHqC6TUFxxjL2Z7l/IACl5KODw9JsO'+
		'DewPXaegA48N4ABAsWLFiwYMGCBQu+CazXanBd6wF8+re0ucwLLy5Y8EPw1W+6Bv8xwfQE0xNMTzA9wfSGA88f7hRMF9xrQ'+
		'AAAAABJRU5ErkJggg==';
icon_cs[0][2*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAlUlEQVR42u3Uuw3AIAwA0Xg'+
		'zRmezfLp0QIGEz3c1SH5IOHrvV6VCMDzB9ATTE0xPMD3B9ATTE0xPMD3B9ATTE0xPML2t4NbavXrnnSdSg9/mh4kQLPh08O'+
		'jM/0HSg2ceRLDgROByf7jklhZcCfyBRuHAu0GCBfuH94GHw9C2tGAiePVOavCJCaYnmJ5geoLpCaZXDvwAidoUTLsKuaAAA'+
		'AAASUVORK5CYII=';
icon_cs[0][2*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAjklEQVR42u3UsQ3AIAwAwXg'+
		'zRmezJCUdUCDh938Nkg/JRO/9qVQIhieYnmB6gukJpieYnmB6gukJpieYnmB6gukJpncU3Fp7d+/880Ru8A45BAu+HzxrPJ'+
		'EdvPQgggXnAZfb4Zq/tOBK4AUKDnwaJFiwO3wQPJ1GsOD7wZulBt+YYHqC6QmmJ5ieYHrlwB9gme49lH1iwQAAAABJRU5Er'+
		'kJggg==';
icon_cs[0][2*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAlklEQVR42u3UsQ3AIAwAwXg'+
		'zRmM0NiNJlw4okML7v7fEWTLRWrsyFYLhCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpbQWXUvrqzPOeOBpc+7y5RggW/H'+
		'fwEPlZyPHgmYUIFnwQON0Np/ylBWcCv6BROPBukGDB3vA+8CjcLy2YCF6dORr8xwTTE0xPMD3B9ATTSwe+AYnPFExJ/c4ZA'+
		'AAAAElFTkSuQmCC';
icon_cs[0][2*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAnUlEQVR42u3UwQ2AIBAAQem'+
		'MAizEkizEAugM9ecPeZDA3u4bkhsSLpVStkglwfAE0xNMTzA9wfQE0xNMTzA9wfQE0xNMTzA9wfSGgnPOtffOM09aGlyv4/'+
		'8w+ylY8Ozg1pnvgywP/vMgggUvBA73h0NuacGRwC+oFQ48GiRYsH94HLg5DG1LCyaCe+8sDZ4xwfQE0xNMTzA9wfTCgW/CN'+
		'BRMgcyHLgAAAABJRU5ErkJggg==';
icon_cs[0][2*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAmElEQVR42u3UsQ3AIAwAwXg'+
		'zRmM0NiNJlw4okML7vwbJh4SjtXZlKgTDE0xPMD3B9ATTE0xPMD3B9ATTE0xPMD3B9ATT2woupfTVO888cTS49zo/TFTBgv'+
		'8OHp35Psjx4JkHESz4IHC6P5xySwvOBH5Bo3Dg3SDBgv3D+8DDYWhbWjARvHrnaPAfE0xPMD3B9ATTE0wvHfgGic8UTHYe2'+
		'DgAAAAASUVORK5CYII=';
icon_cs[0][3*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAk0lEQVR42u3UsQ3AIAwAwXg'+
		'zRmezhJIOKCLh938NEmfJRO/9qVQIhieYnmB6gukJpieYnmB6gukJpieYnmB6gukJpvcruLX2nt4Z74nU4NH+YyIEC74dvD'+
		'ozDyQ9eGcgggUnApfb4ZK/tGA6eHUGtcM7AxEsOBG43A6X/KUF08Gnd1KDb0wwPcH0BNMTTE8wvXLgDymtFEw2w8zzAAAAA'+
		'ElFTkSuQmCC';
icon_cs[0][3*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAj0lEQVR42u3UsQ3AIAwAwXg'+
		'zRvdmScp0QBEJv/9rkDgkOzLz6lQIhieYnmB6gukJpieYnmB6gukJpieYnmB6gukJpvcreIxx79553xO1wTvkECz4fPCs74'+
		'nq4KUPESy4DrjdDPfc0oLp4FmkGV76EMGC64DbzXDPLS2YDt6sNPjEBNMTTE8wPcH0BNNrB34AQHvuPb+XPdMAAAAASUVOR'+
		'K5CYII=';
icon_cs[0][3*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAlUlEQVR42u3UsQ3AIAwAwXg'+
		'zRmM0NiMp0wFFpPj931viLJkYY1yVCsHwBNMTTE8wPcH0BNMTTE8wPcH0BNMTTE8wPcH0PgW31ubpzPOeSA3uc9/cIwQL/j'+
		't4iXwtJD14ZyGCBScCl7vhkr+0YDp4iSTd8M5CBAtOBC53wyV/acF08OlMavAfE0xPMD3B9ATTE0yvHPgGKaIUTJnXjs4AA'+
		'AAASUVORK5CYII=';
icon_cs[0][3*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAnElEQVR42u3UwQ2AIBAAQem'+
		'MAizEkizEAugMffoDHybc3u4bEuaSo7TWtkwVwfAE0xNMTzA9wfQE0xNMTzA9wfQE0xNMTzA9wfR+Bdda+9c7z3tKaHC/jv'+
		'nH7KdgwauDR2feAwkPnhmIYMGBwOl2OOUvLZgOHp1B7fDMQAQLDgROt8Mpf2nBdPDXO6HBKyaYnmB6gukJpieYXjrwDWIHF'+
		'Ez77vfEAAAAAElFTkSuQmCC';
icon_cs[0][3*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAlklEQVR42u3UsQ3AIAwAwXg'+
		'zRmM0NiMp0wFFpPj9X4PEWTIxxrgqFYLhCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpfQpurc3TO897IjV4zr7/mOiCBf'+
		'8dvDrzHkh68M5ABAtOBC63wyV/acF08OoMaod3BiJYcCJwuR0u+UsLpoNP76QG/zHB9ATTE0xPMD3B9MqBbymiFExqxYjtA'+
		'AAAAElFTkSuQmCC';
icon_cs[0][4*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAjUlEQVR42u3TQQqAIBBA0eZ'+
		'mHn1uVu4Cg3Qj2ff/5SjoE4zMPHYqBMMTTE8wPcH0BNMTTE8wPcH0BNMTTE8wPcH0BNObCi6lnO2snhej678E1+7DIh7gt3'+
		'XBggULFix4MrgNDe5eRrDg9cG9Pag/PPIgggULFixY8ELgdoYGf5FgeoLpCaYnmJ5getuBL0erTEz9e/DyAAAAAElFTkSuQ'+
		'mCC';
icon_cs[0][4*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAiklEQVR42u3TQQ6AIAwAQfs'+
		'znt6fqUeDRrgQcdk90kMZEiIzt5UKwfAE0xNMTzA9wfQE0xNMTzA9wfQE0xNMTzA9wfSGgkspe3127ove+T/BV1I8gF/mgg'+
		'ULFixY8GDwLTS4eRvBgucHtyL94a4HESxYsGDBgicCV6HBXySYnmB6gukJpieY3nLgA5z/FkyE00qIAAAAAElFTkSuQmCC';
icon_cs[0][4*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAj0lEQVR42u3TsQ3AIAwAwXg'+
		'zRmM0NiPpIhEp0KCE57+0C+uQiFLKsVMhGJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpCaYnmN5UcEqptrPrXozulwTneptyxA'+
		'P8thcsWLBgwYIng9vQ4F6CBS8A7iJJf3jkQQQLFixYsOAfgdsZGvxFgukJpieYnmB6gultBz4Bd0BMTAjR+bMAAAAASUVOR'+
		'K5CYII=';
icon_cs[0][4*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAlUlEQVR42u3T0QmAIBgA4dz'+
		'MARqkkRqkAdzMegsM0hfJzrvHX0E/wZBSWmYqCIYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpCabXFRxjzOXsOi+0rv8SnI'+
		'/tPmzdH+C3dcGCBQsWLLgzuAwNrl5GsODxwbU9qD/c8iCCBQsWLFjwQOByhgZ/kWB6gukJpieYnmB604FP1MVMTN7QRIwAA'+
		'AAASUVORK5CYII=';
icon_cs[0][4*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAkElEQVR42u3TQQqAIBQA0f7'+
		'NPJpH82bWLjBIN5KNM8uvoE8wSinHToVgeILpCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5gelPBKaXazq7zYnT9l+Ba831Y5A'+
		'f4bV2wYMGCBQueDG5Dg7uXESx4fXBvD+oPjzyIYMGCBQsWvBC4naHBXySYnmB6gukJpieY3nbgE3dATEzrDQwkAAAAAElFT'+
		'kSuQmCC';
icon_cs[0][5*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAl0lEQVR42u3X0Q2AIAwAUbs'+
		'Zo7OZ4gSVGESOu29I+j5oQtRaj50KwfAE0xNMTzA9wfQE0xNMTzA9wfQE0xNMTzA9wfSGgkspZ++dNk8sDW49HyZCsOCVwD'+
		'coCwceDRIs2Dc8DpwOQ9vSgong7MzXS23qb2nGFhcs+CUoO4MDb7elBdPBvXeWBv8xwfQE0xNMTzA9wfS2A1+J2hRM1ehdo'+
		'wAAAABJRU5ErkJggg==';
icon_cs[0][5*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAkUlEQVR42u3XwQ3AIAzAwGY'+
		'zRmezthsEVFHA2H+k3CORiFrrdVIhGJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpCaYnmN5QcCnl7n3zzhN7g3vIIVjwXuAGCg'+
		'48GiRYsDs8EJxOI1jw+uCsn4/a1N/SjCsuWPBXUBYOfNyVFkwHd7Y1eMUE0xNMTzA9wfQE0zsO/ABgme49CLjCJwAAAABJR'+
		'U5ErkJggg==';
icon_cs[0][5*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAmUlEQVR42u3XwQ2AIBAAQa8'+
		'zSqM0OkOtAIlBZNl9cwnz4BKilHLsVAiGJ5ieYHqC6QmmJ5ieYHqC6QmmJ5ieYHqC6QmmNxScUqq9M9d9Ymlwrs/NOUKw4J'+
		'XAN6gVDjwaJFiwb3gcuBVuSwsmgpvIj5fa1N/SjC0uWPBLUOsMDrzdlhZMB/fOLA3+Y4LpCaYnmJ5geoLpbQc+AYnPFEzE1'+
		'4m/AAAAAElFTkSuQmCC';
icon_cs[0][5*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAoElEQVR42u3XwQ2AIBAAQem'+
		'MAizEkizEAugMtQIkBpFl9w3JzYNLCCmlZaaCYHiC6QmmJ5ieYHqC6QmmJ5ieYHqC6QmmJ5ieYHpNwTHGXHvnmicMDc7H9n'+
		'yYdRcseCTwDSqFA7cGCRbsG24HLg5D29KCieDSma+XWtffUo8tLljwS1DpDA483ZYWTAfX3hka/McE0xNMTzA9wfQE05sOf'+
		'ALCNBRMX0ydFAAAAABJRU5ErkJggg==';
icon_cs[0][5*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAmklEQVR42u3XwQ2AIBAAQa8'+
		'zSqM0OkOtAIlBZNl9Q3Lz4BKilHLsVAiGJ5ieYHqC6QmmJ5ieYHqC6QmmJ5ieYHqC6QmmNxScUqq9d655Ymlwrfn5MJEFC1'+
		'4JfINa4cCjQYIF+4bHgZvD0La0YCK4debrpTb1tzRjiwsW/BLUOoMDb7elBdPBvXeWBv8xwfQE0xNMTzA9wfS2A5+JzxRME'+
		'AzzLgAAAABJRU5ErkJggg==';
icon_cs[0][6*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAmElEQVR42u3USwrAIAwA0eZ'+
		'mHt2b9bMtBSvUquPMPpC3SCLnvK1UCIYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpCabXFJxS2mtnzn1iavDZ+2UiBAueCX'+
		'yBSuHArUGCBXvD7cDFZWhfWjAd/HTDfz+1rl+6xxcXLPhj8D00uLiMYMHjg2tnpgaPmGB6gukJpieYnmB6y4EP4pIvTGm1u'+
		'xgAAAAASUVORK5CYII=';
icon_cs[0][6*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAkklEQVR42u3UwQ2AIBAFUbc'+
		'zSqcz9a4Jkoiw48ydZN+BH7XW7U+FYHiC6QmmJ5ieYHqC6QmmJ5ieYHqC6QmmJ5ieYHpDwaWUvffNeU/kBveQQ7DgXOAHFB'+
		'x4NEiwYP/wQHDzGsGCc4HvKB+P2tSVnrHiggW/DL6EBjevESx4fXBnqcErJpieYHqC6QmmJ5je78AHpYj/Pb/nAgQAAAAAS'+
		'UVORK5CYII=';
icon_cs[0][6*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAmElEQVR42u3UwQ2AIBAFUbc'+
		'zSrM0OkO9GhMkEZFx5k7CO+yPnPPyp0IwPMH0BNMTTE8wPcH0BNMTTE8wPcH0BNMTTE8wva7glFJpfbP/J6YGr+W+eY0QLH'+
		'gm8AGqhQP3BgkW7A33A9fCrbRgOvjqht8etaErPWLFBQt+GHwODa4lWPAE4NY3U4O/mGB6gukJpieYnmB6vwNvxMMvTPaPW'+
		'gkAAAAASUVORK5CYII=';
icon_cs[0][6*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAoUlEQVR42u3UwQ2AIBAAQem'+
		'MAizEkizEAugM9WtMkERU1t3/JTePu5BSGv5UEAxPMD3B9ATTE0xPMD3B9ATTE0xPMD3B9ATTE0yvKTjGmGtntn1C1+C8TN'+
		'eXGWfBgnsC76BSOHBrkGDB3nA7cHEZ2pcWTAef3fDTT+3VL/3GFxcs+GbwMTS4uIxgwd8H1850Df5igukJpieYnmB6gun9D'+
		'rwC5fQvTLXT0wUAAAAASUVORK5CYII=';
icon_cs[0][6*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAm0lEQVR42u3UwQ2AIBAAQem'+
		'M0iiNzlC/xgRNRGDZ/V9y87gLOedtpYJgeILpCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5gek3BMcbydubYJ0wNLiU9XyYkwY'+
		'JnAp+gWjhwa5Bgwd5wO3B1GdqXFkwH393w30+t65fu8cUFC/4YfA0Nri4jWPD44LczU4NHTDA9wfQE0xNMTzC95cA7xMMvT'+
		'AZFCVEAAAAASUVORK5CYII=';
icon_cs[0][7*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAi0lEQVR42u3QQQ6AIAwAQfs'+
		'zns7PFG+mFzHRIMvusQ1Jh6i1bisVguEJpieYnmB6gukJpieYnmB6gukJpieYnmB6gul9Ci6l7E/ftHtianCr/5gIwYJnAp'+
		'+gXN7jwFfQ3V6w4B+C8wwN7vkQwYIFCxYsWLBgwYJfAucZGjwiwfQE0xNMTzA9wfSWAx+C9zBMSwINdQAAAABJRU5ErkJgg'+
		'g==';
icon_cs[0][7*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAiElEQVR42u3QQQoCQQwAQed'+
		'n+/T5mXqUQdAFRbe3+hoCqYw55+VMDeB4wPWA6wHXA64HXA+4HnA94HrA9YDrAdcDrvdV8LZt170793vGscF7yAMY+FjgZ5'+
		'RlngM/gl7NgYH/EbyUBr/1EGBgYGBgYGBgYOAPgZfS4F8EXA+4HnA94HrA9U4HvgEAzwJMTQ8xdQAAAABJRU5ErkJggg==';
icon_cs[0][7*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAj0lEQVR42u3QwQ2AIBAAQa8'+
		'zSqM0OkP9GXyIiUZZdp93uYQhSinLTIVgeILpCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geq+CU0r17s32nhganGu/OUcIFj'+
		'wSeAedkM0eBz6CrvaCBf8Q3M7Q4J4PESxYsGDBggULFiz4IXA7Q4O/SDA9wfQE0xNMTzC96cArylwwTDdvw7kAAAAASUVOR'+
		'K5CYII=';
icon_cs[0][7*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAlElEQVR42u3QwQ2AIBAAQem'+
		'MAizEkizEAugM9WfuIyYaZd193oXkhlRKGf5UEgxPMD3B9ATTE0xPMD3B9ATTE0xPMD3B9ATTE0zvUXDOuV59s92TugbXZW'+
		'o/ZpwFC+4JvINicY8DH0Fne8GCPwiOMzS45UMECxYsWLBgwYIFC74JHGdo8BsJpieYnmB6gukJpvc78Ao6gDBMdmmtLQAAA'+
		'ABJRU5ErkJggg==';
icon_cs[0][7*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAj0lEQVR42u3QQQ6AIAwAQfs'+
		'znsbT+BnqzfSiJhpl2T22IekQrbVlpkIwPMH0BNMTTE8wPcH0BNMTTE8wPcH0BNMTTE8wvVfBpZR+9812TwwN7r1ePyaqYM'+
		'EjgXdQLu9x4CPobC9Y8A/BeYYGX/kQwYIFCxYsWLBgwYIfAucZGvxFgukJpieYnmB6gulNB14BylwwTGWlvYsAAAAASUVOR'+
		'K5CYII=';
icon_cs[0][8*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAlElEQVR42u3UMQ6AIAxAUXs'+
		'zjs7NFDfTBRlM7Of/tWnSN0D03o+dCsHwBNMTTE8wPcH0BNMTTE8wPcH0BNMTTE8wPcH0PgW31s7VnXFPlAaP3h8TIVhwJf'+
		'ANyuU5DvwEzeaCBRcA59Dg6TGCBdcCb/eGt/ylBdPBOTR4eoxgwf8Hr+6UBv8xwfQE0xNMTzA9wfS2A18/EUpM+T3ECwAAA'+
		'ABJRU5ErkJggg==';
icon_cs[0][8*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAkUlEQVR42u3UQQrAIAwAweZ'+
		'nPt2ftT2WWhAPBbPZvQYhc4jRez8qFYLhCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLp/QpurZ2rb+59Ijd4hRyCBecCf1'+
		'Fecxz4CZrNBQtOAB5Cg6fbCBacC1zuhiv+0oLp4CE0eLqNYMH7gxdLDd4xwfQE0xNMTzA9wfTKgS/Z2RBMhMulowAAAABJR'+
		'U5ErkJggg==';
icon_cs[0][8*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAlklEQVR42u3UMQ6AIAxAUXs'+
		'zjsbRuBnqZnBABxP7+X9tmvQNEK21baVCMDzB9ATTE0xPMD3B9ATTE0xPMD3B9ATTE0xPML1PwaWU/nbnuCdSg2t/bq4Rgg'+
		'VnAp+gG3KY48BX0GwuWHAC8BgaPEuw4GTg5d7wkr+0YDp4DA2eJVhwAvDbndTgPyaYnmB6gukJpieY3nLgHQN+Skx8H7aUA'+
		'AAAAElFTkSuQmCC';
icon_cs[0][8*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAnUlEQVR42u3UsQ2AIBBAUdm'+
		'MARzEkRzEAdgMtTM0SGHiff5vL5fcKyCVUpaZSoLhCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpfQrOOdfRneueFBpcj+'+
		'39MesuWHAk8A1qa+c48BPUmwsWHADchgZ3jxEsOBZ4ujc85S8tmA5uQ4O7xwgW/H/w6E5o8B8TTE8wPcH0BNMTTG868AkNe'+
		'0pMh0pxewAAAABJRU5ErkJggg==';
icon_cs[0][8*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAmElEQVR42u3UsQ3AIAwAwXg'+
		'zRmM0NiNJF9GQFJHw899alnwFRGvt2KkQDE8wPcH0BNMTTE8wPcH0BNMTTE8wPcH0BNMTTO9XcCmlf9257onU4N7r+2OiCh'+
		'acCXyDxsY5DvwEzeaCBScAj6HB02MEC84F3u4Nb/lLC6aDx9Dg6TGCBa8P/rqTGrxigukJpieYnmB6gultBz4BA35KTLWU9'+
		'PYAAAAASUVORK5CYII=';
icon_cs[0][9*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAl0lEQVR42u3UMQrAIBAAwdz'+
		'PfLo/S0wXbNQi4K27rQo3gkat9TqpEAxPMD3B9ATTE0xPMD3B9ATTE0xPMD3B9ATTE0zvV3Ap5V490+aJ1ODW/DARggVnAr'+
		'+gvn4dB/6CRuuCBScA96HBw2EEC94fPNqDesMzFyJYcCLwcW/4yF9aMB28eiY1eMcE0xNMTzA9wfQE0zsO/ADmSi9MIHSI4'+
		'QAAAABJRU5ErkJggg==';
icon_cs[0][9*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAk0lEQVR42u3UQQqAMAwAQfO'+
		'zPr0/U4+iQu1BaDa711DIFNrovW+VCsHwBNMTTE8wPcH0BNMTTE8wPcH0BNMTTE8wPcH0fgW31vbZM+c+kRs8Qw7BgnOB3y'+
		'i3OQ58BY3mggUnAD9Cg4fbCBa8PngU6Q1/uhDBgvOAy73hmr+0YDp4stTgFRNMTzA9wfQE0xNMrxz4AJTq/z0yW/JGAAAAA'+
		'ElFTkSuQmCC';
icon_cs[0][9*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAmUlEQVR42u3UwQ2AIBAAQa8'+
		'zSqM0OkP9GXygDxNv2f1eLmFIIFpr20qFYHiC6QmmJ5ieYHqC6QmmJ5ieYHqC6QmmJ5ieYHqfgksp/e3OcZ5IDa79ublGCB'+
		'acCXyCbshhjgNfQbO5YMEJwGNo8CzBghOAp0jSG35yIYIFJwIv94aX/KUF08Fvd1KD/5hgeoLpCaYnmJ5gesuBd8h7L0wW+'+
		'lIAAAAAAElFTkSuQmCC';
icon_cs[0][9*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAn0lEQVR42u3UsQ2AIBQAUdm'+
		'MARzEkRzEAdgMtTM0aGHCP+5aIPmPBFIpZZmpJBieYHqC6QmmJ5ieYHqC6QmmJ5ieYHqC6QmmJ5jer+Ccc/165ponhQbXY3'+
		's/zLoLFhwJfIPa2nUc+AnqrQsWHADchgZ3hxEseHxwbw/qDb+5EMGCA4Gne8NT/tKC6eCvZ0KDR0wwPcH0BNMTTE8wvenAJ'+
		'+msL0y6tO6WAAAAAElFTkSuQmCC';
icon_cs[0][9*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAAAmUlEQVR42u3UQQ7AEBQA0bq'+
		'Zozmam2m7a2ywaOKPmS2S/ySkWut1UkkwPMH0BNMTTE8wPcH0BNMTTE8wPcH0BNMTTE8wvV/BOee2euaZJ4UGt1bmh0lFsO'+
		'BI4BfU16/jwF/QaF2w4ADgPjR4OIxgwfuDR3tQb3jmQgQLDgQ+7g0f+UsLpoNXz4QG75hgeoLpCaYnmJ5geseBb8h7L0w+v'+
		'THoAAAAAElFTkSuQmCC';

// 資源モード（１５ｘ１５用） 資源アイコン＝numx5+maxtype、0=平均,1=木,2=石,3=鉄,4=糧
icon_cs[1] = new Array();
icon_cs[1][1*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAcElEQVR42u3VQQqAIBBA0eZ'+
		'mHt2bVZugkqKFmtH7W2V8iGDknKcvFcDAwMDAwMAjBQwMDAxcllKar9bW+TEkeK0cHgHc5Els+GHBZzwwMDAwcF/w3cexrwa+6dd'+
		'8OKjSbf8X/GTfMOCeAQMDAwO/2wIfHc0tF6Ao+gAAAABJRU5ErkJggg==';
icon_cs[1][1*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAbUlEQVR42u3VSwqAMAxAQXO'+
		'zHr03UzeC4gdBWyPM25VCOotCotY6/KkABgYGBgYGzhQwMDAw8L5Synh2N8+PnOAjcgA3+hLLKSt4hwcGBgYG7gq+Whzr3sC3Xc2'+
		'bl4Afgm+UBtwzYGBgYOBvmwBLN7EtlGYAfwAAAABJRU5ErkJggg==';
icon_cs[1][1*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAdElEQVR42u3VWwqAIBBG4f6'+
		'dzdJc2uzMegksKXzwMtE5r4p8ijBy9+1LCTBgwIABAwYcKcCAAQMGXGdm+WntOF8hwSnX5iQBHvIlTnxY8B0PGDBgwIDngt8GR1k'+
		'P/NDRfLlEp9f+L7hlXxjwzAADBgwY8Np2w8bNLSTtNCoAAAAASUVORK5CYII=';
icon_cs[1][1*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAeUlEQVR42u3VwQ2AIAxAUbt'+
		'ZB3AQRnIQB+hm6IVEJRAOgDX+f4WUF0KCmNnypQQwYMCAAQMG7CnAgAEDBpynqrG0ds4Xl+C4h3z4ugEe8iQS3i34iQcMGDBgwHP'+
		'BtY/jWg/80K/5dlCn2/4vuGWfG/DMAAMGDBjwux18ns0tIgW66QAAAABJRU5ErkJggg==';
icon_cs[1][1*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAdElEQVR42u3VwQnAIAxA0Wa'+
		'zjOZo2SztpdBWFA9qI/5/VeJDBMXMjpUSwIABAwYMGHCkAAMGDBhwnqp6ae2aLyHB7ikfLgnwkCdx48OCv3jAgAEDBjwXXPs4nvX'+
		'AD/2aXwd1uu19wS37woBnBhgwYMCA/+0Ew8bNLZ5CNl8AAAAASUVORK5CYII=';
icon_cs[1][2*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAeElEQVR42u3TQQqAMAwFUXO'+
		'zHD0307pwJQkFpf7gzLaFvEJjEbF1ygADBgwYMGDASgEGDBgw4Hvuvs/cG7NMBjyqB5kBfgTOzq6HSIGrhwD+5ZdouXRtwScsSxb'+
		'8BgxwBc6S/BLpINWlawOeuScDXhlgwIABA/62A+GmzS3ethXLAAAAAElFTkSuQmCC';
icon_cs[1][2*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAcklEQVR42u3TQQqAMAwFUXO'+
		'zHD03UzeuJLFQqT84s20hr5BaRGydMsCAAQMGDBiwUoABAwYM+J677yP3zlmmA34iG+BJcNZ1ogQuHwL4jyvR89O1BRckWfAbMMA'+
		'VOEtzJdJJgCfBA8mAVwYYMGDAgL/tAN5QsS3Hn0obAAAAAElFTkSuQmCC';
icon_cs[1][2*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAeUlEQVR42u3TQQqAMAwFUXO'+
		'zHq1Hy82qgjtJKFj0B2fWgb5Aau6+VcoAAwYMGDBgwEoBBgwYMOB7rbUxM3e8ZTLgPnJzNwP8CBxCr0WkwNkigH95EiU/XVnwCYu'+
		'SBa+AAc7AUZInESX76cqAZ+ZkwG8GGDBgwIC/bQdips0tH26T/AAAAABJRU5ErkJggg==';
icon_cs[1][2*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAgUlEQVR42u3TwQmAMAyFYbN'+
		'ZB3AQR3IQB8hmVQ+eJKVQ0Rf83zWBfIHE3H3KFAMMGDBgwIABKwUwYMCAAd9TSqk9fccskwHXbWkPmlfAQ+Codi0iBW4tAviXJ5H'+
		'y6dKCT1gUWfATMMAtcBTJkwgHqT5dGnBPnwz4zQAGDBgw4G+zA/+XzS0d0zlPAAAAAElFTkSuQmCC';
icon_cs[1][2*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAe0lEQVR42u3TQQqAQAiF4by'+
		'ZR5ujzc2sFq3CYaChnvS/rYKfoNZ73yrFAAMGDBgwYMBKAQwYMGDA97h7zPQds0wGHNHGg6wBfgTOatciUuDRIoB/eRIln64s+IR'+
		'lkQWvgAEegbNInkQ6SPXpyoBn+mTAbwYwYMCAAX+bHWKmzS1nKtu5AAAAAElFTkSuQmCC';
icon_cs[1][3*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAc0lEQVR42u3TQQrAMAhE0c7'+
		'NPLo3a7PpqkQChdYhf7YKPkGVmYdTBBgwYMCAAQPuFMCAAQMG/ExEnCt9Y5bagEfqQRLgV+BZ7V6kFbhaBPCWJ2H5dHbgWa3lSVS'+
		'LAN7yJCyfzg680tcG/GUAAwYMGPC/uQABl80tBU2T5gAAAABJRU5ErkJggg==';
icon_cs[1][3*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAb0lEQVR42u3TSwqAMAxFUbO'+
		'zLD07s04cST8g6Hv03mkLPYUkqupwKgADBgwYMGDASgEGDBgw4GeZea7cu94KHfCMHIBfgnvdJ0rg4UcA7zgSnktnB+6lOBLDjwD'+
		'ecSQ8l84OvJAM+MsAAwYMGPC/Nb5BsS3x8PePAAAAAElFTkSuQmCC';
icon_cs[1][3*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAdUlEQVR42u3TQQrAMAhE0c7'+
		'NPFqO5s3SLrorkUAgVfJnLfgGVO5+VYoAAwYMGDBgwJkCGDBgwIC/MbM+M/fsUhpw67G5SYCXwEPoWyQVOCoC+MiTKPl05cBDaMa'+
		'TiIoAPvIkSj5dOfDMXBrwzgAGDBgw4H9zA4KIzS3tcmqGAAAAAElFTkSuQmCC';
icon_cs[1][3*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAe0lEQVR42u3TwQ2AQAhEUem'+
		'MAizEkizEAuhs9eLJLNnERJnsnyskPBKwiFiUYoABAwYMGDDgSgEMGDBgwM+4exvpu2ZZGXA7tnzQugN+Be7V7kVKgbNFAE95EpJ'+
		'PJwfu1UqeRLYI4ClPQvLp5MAjfWXAXwYwYMCAAf+bEx+IzS1VU+imAAAAAElFTkSuQmCC';
icon_cs[1][3*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAdUlEQVR42u3TwQnAQAhE0di'+
		'ZpW1pdmZyySmsLAQSh/1zVfAJahFxKMUAAwYMGDBgwJ0CGDBgwICfcfdc6btmWRtw5qgH2QD8Cjyr3Yu0AleLAN7yJCSfTg48q7U'+
		'8iWoRwFuehOTTyYFX+tqAvwxgwIABA/43J4KIzS0CSt/VAAAAAElFTkSuQmCC';
icon_cs[1][4*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAbklEQVR42u3STQqAIBCA0eZ'+
		'mHt2bVdDGKN30N8H7dqOgTzBqrdOfCmBgYGBgYOBMAQMDAwMfK6XM7byeGaP1FOC17cCIHfhsHRgY+GZwW3pw9yLgi+DeXsovMXo'+
		'IMDDwy+B2Tg9+ImBgYGDgb1sA/ib3LQPIUJEAAAAASUVORK5CYII=';
icon_cs[1][4*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAa0lEQVR42u3SOw6AIBBAQfd'+
		'mHJ2bqY0JfrDxtybzOrZYhoSotQ5/KoCBgYGBgYEzBQwMDAy8r5Qytud5Z5zNc4AXWmzAB3NgYOCbwavSg7s3AV8E98r4JU4fAgw'+
		'M/DK4KT34iYCBgYGBv20Chk3PLe+CwM4AAAAASUVORK5CYII=';
icon_cs[1][4*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAb0lEQVR42u3Suw2AMAxAQbx'+
		'ZRsto2QyQaIL4NPyMdK+zC+siJVprw58KYGBgYGBg4EwBAwMDA28rpYz9PN+Ms30KcB0XW41Ygff2wMDAN4P70oOPAr4KPoRm/BJ'+
		'nDwEGBn4Z3M/pwU8EDAwMDPxtE5b29y0Pk3TFAAAAAElFTkSuQmCC';
icon_cs[1][4*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAeElEQVR42u3S2w2AMAiFYdm'+
		'MARzEkRzEAdismviCse2Lt2Pynzcgga9JLSKGP8UAAwYMGDBgwEoBDBgwYMDnuHvJ9bbTen0JcFmmfeE4H8C1PmDAgG8G58iDm4c'+
		'AXwS3ZpJfovcQwIABvwzOtTz4iQAGDBgw4G+zAkaG9y0dD7avAAAAAElFTkSuQmCC';
icon_cs[1][4*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAcklEQVR42u3SSw6AMAhFUdk'+
		'ZS+vS2BmaOMFoO6mfZ3LfDEjgNKlFxPKnGGDAgAEDBgxYKYABAwYM+Bx3z1pvO23UlwBntn2htQP4qg8YMOCbwTXy4O4hwJPg3kz'+
		'yS4weAhgw4JfBtZYHPxHAgAEDBvxtVpb29y2C4cBQAAAAAElFTkSuQmCC';
icon_cs[1][5*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAeklEQVR42u3VQQ6AMAgFUbk'+
		'ZR+dmWteGpguqnziztQlvAdEi4uiUAQYMGDBgwICVAgwYMGDAz9z9XHk3ZpkMeDQfZAa4BHzDsmTBFTDAM3CW5Eqkg1SPrg04+1a'+
		'921t/zTuO8Z/gdivR8ujagVfeyYDfDDBgwIABf9sF4abNLSYGVjoAAAAASUVORK5CYII=';
icon_cs[1][5*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAdElEQVR42u3VQQ6AMAgFUbk'+
		'ZR+dm6t5Qm0j1E2fWTXgLSC0itk4ZYMCAAQMGDFgpwIABAwZ8zd33mXfnLNMB35ENcBF4QJIFV8AAj8BZmiuRTgL8EJxVvNtLv+Y'+
		'Vx/hPcLuV6Hl07cATyYDfDDBgwIABf9sB3lCxLVLpt90AAAAASUVORK5CYII=';
icon_cs[1][5*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAe0lEQVR42u3VsQ2AMAwFUbx'+
		'ZRsto3ixAjRylcOBb3NWW8gpbMXc/KmWAAQMGDBgwYKUAAwYMGPCz1tpYmbveMhlwH3NzNwOcAr5hUbLgDBjgGThKciWiZI+uDDi'+
		'EJu/21q95xzH+E1xuJUoeXTnwypwM+M0AAwYMGPC3nWKmzS0E9l6yAAAAAElFTkSuQmCC';
icon_cs[1][5*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAg0lEQVR42u3VwQ2AMAiFYdm'+
		'MARzEkRzEAdis6tnQ9EAV4v+uJXnfAVIxs6VSBDBgwIABAwacKYABAwYM+BlVbSNzV5ekAbdj6xetO+AQ8A3zkhYcAQPcA3tJuRJ'+
		'uUdajKwP23qJ3e+rXPOMY/wkutxIlj64ceGQuDfjNAAYMGDDgb3MC/5fNLb8y6t8AAAAASUVORK5CYII=';
icon_cs[1][5*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAfUlEQVR42u3VsQ3AMAhE0bA'+
		'Zo3k0NiNJHWG5wAko/1oj3StAFjM7OkUAAwYMGDBgwJUCGDBgwICfUVVfmbu6pAzYfcyLZABOAd+wKGXBGTDAM3CUkisRFlU9ujb'+
		'g6C17t7d+zTuO8Z/gdivR8ujagVfmyoDfDGDAgAED/jYnYqbNLYkZqNwAAAAASUVORK5CYII=';
icon_cs[1][6*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAeUlEQVR42u3TQQqAMAxEUXO'+
		'zHD0307pVUgq2dQJ/1oF5i4lFxFEpBhgwYMCAAQNWCmDAgAEDfsfdz5G71mUy4JZ+kRngKeAblkUWPAMGuAfOIjmJtEj16cqBn5O'+
		'Yve2lT7fiGQGXm0RaBPgjeOROBrwzgAEDBgz431x6k+EtfzKUgQAAAABJRU5ErkJggg==';
icon_cs[1][6*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAc0lEQVR42u3TQQ6AMAgFUbk'+
		'ZR+dm6tqG2kRqf5OZNQlvARYRx04ZYMCAAQMGDFgpwIABAwbc5u7nyNy9y3TAb2QDXATukGTBFTDAPXCW5kmkmwAXgZ+k4tue+nQ'+
		'znhHwfieRbgL8ETyQDPjPAAMGDBjw2i6O670tWxpfNAAAAABJRU5ErkJggg==';
icon_cs[1][6*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAeklEQVR42u3TQQrAMAgF0Xo'+
		'zj5ajebM03bYYAjWtwsw6kLf4ipkdlRLAgAEDBgwYcKYAAwYMGPAzVe0r78Zfkgbc+tzcRACHgC+YV1pwBAzwDOyVchJeaY+uHPg'+
		'+iehtbz26HccIuNwkvAC/Ba+8SwP+MsCAAQMG/G8n66ThLbHfc4gAAAAASUVORK5CYII=';
icon_cs[1][6*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAgklEQVR42u3TsQ2AMAxEUbx'+
		'ZBmAQRmIQBvBmAVqQo0hxwJb+1ZbuFWdR1SVTBDBgwIABAwYcKYABAwYM+J1SSu25u7okDLgeW7to3QG7gG+YlbBgDxjgFthKyEm'+
		'YRVGfLh34OQnvbU99uhnPCDjdJMwiwIPgnrsw4C8DGDBgwID/zQl8ROEtn9QurAAAAABJRU5ErkJggg==';
icon_cs[1][6*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAfElEQVR42u3TQQ6AMAhEUbk'+
		'ZR+vRuBnWrYamia1C8mdNMm8xiJkdlSKAAQMGDBgw4EwBDBgwYMDPqKrP3PUuSQN2b+MiaYCXgC9YlLTgFTDAI3CUlJMIi7I+XTn'+
		'wfRKrt7316XY8I+BykwiLAL8Ez9ylAX8ZwIABAwb8b07rpOEtyB1X7gAAAABJRU5ErkJggg==';
icon_cs[1][7*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAbElEQVR42u3PQQqAMAwAQfO'+
		'zPr0/03oQCmIRURph9pZQyDRqrcufCmBgYGBgYOBMAQMDAwOfK6Wsd961W5EG3BofigB+BbzD+vp9WvABu9oDPwH3c3rw6CPAwMD'+
		'AwHPB/Zwe/EXAwMDAwHPbAOzQ4i1TWPn9AAAAAElFTkSuQmCC';
icon_cs[1][7*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAaElEQVR42u3PSwqAMAxAQXO'+
		'zHr03UzdCUfxQlEaYtwyBTKLWOv2pAAYGBgYGBs4UMDAwMPCxUsr8ZG+9FXnAd+QAfgm8JzXztOANdjYH7gI3pQdfPgIMDAwMPBb'+
		'clB78RcDAwMDAY1sAAg3ALcjMbwcAAAAASUVORK5CYII=';
icon_cs[1][7*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAb0lEQVR42u3PSwqAMAxAQXO'+
		'zHq1H6838LISKKCKKEebtEgKdRmtt+FMBDAwMDAwMnClgYGBg4H2llPHK3fxWpAHX8dxcI4AfAS+wDbTbpwWvsKM98B1wP6cHn30'+
		'EGBgYGPhbcD+nB78RMDAwMPC3TZGI4i3pDQcRAAAAAElFTkSuQmCC';
icon_cs[1][7*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAdUlEQVR42u3P0QmAMAxFUbN'+
		'ZBnAQR3IQB8hmVT+EgLQUUfqEe/8SCjm1iJj+lAEGDBgwYMCAlQIMGDBgwPfcvfS8O26ZDLhsS/vQvAJ+BXzCcnkvC75gtT3gJ+A'+
		'8y4NbHwEMGDBgwGPBeZYHfxFgwIABAx7bDkpg4i0pOh40AAAAAElFTkSuQmCC';
icon_cs[1][7*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAcElEQVR42u3PQQqAMAwFUXO'+
		'zHK1Hy82iLgqBYhFR+oWZXUIhrxYR258ywIABAwYMGLBSgAEDBgx4zN3zzrvjlsmAM9v8kDXAr4BPWK3uZcEddrUH/ARcZ3nw7CO'+
		'AAQMGDHgtuM7y4C8CDBgwYMBr2wGRiOItrdAIwQAAAABJRU5ErkJggg==';
icon_cs[1][8*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAeElEQVR42u3TQQrAIAwF0eZ'+
		'mObo3a+2iECgpgmJ/YGYZAnkLtdbaUSkDDBgwYMCAASsFGDBgwIDfufs5stdvmQy4933IDPAS8A2Lxbks+IFlc8Cz4Jg8OD0EeBG'+
		'43JMo+enKgWPy4PQQ4EnwyJ4MeGeAAQMGDPjfLjA/9S1MyTcCAAAAAElFTkSuQmCC';
icon_cs[1][8*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAdUlEQVR42u3TQQqAMAwFUXO'+
		'zHD03UzcFqwQLLfoDM8tQyFukFhFbpQwwYMCAAQMGrBRgwIABA37m7vvIu3OX6YDfyAZ4EfhOusxlwQ2WzQHPgrvkwekmwIvA5U6'+
		'i4qcrB+6SB6ebAE+CB5IBfxlgwIABA/63A+pWyS14ueRCAAAAAElFTkSuQmCC';
icon_cs[1][8*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAeklEQVR42u3TwQnAMAhA0bq'+
		'Zo2U0N0vbQ8FSLIGEVuH/owi+QyJmtlVKAAMGDBgwYMCZAgwYMGDAz1S1j+wdtyQNuPV3cxMBvAR8wm5QN08LvmDRHPAs2JceHAV'+
		'4Fbjckyj56cqBfenBUYBnwSN7acBfBhgwYMCA/20HkXD1LRQVSWwAAAAASUVORK5CYII=';
icon_cs[1][8*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAgElEQVR42u3TwQmAMAxAUbN'+
		'ZB3AQR3IQB8hmVQ9CQFIKLZrA/8cQyDu0oqpLpgQwYMCAAQMGHCnAgAEDBvyulFJ79q5bEgZcj619aN0BTwHfMJudhwU/MG8OeBR'+
		'sCw92DwGeBE73JFJ+unRgW3iwewjwILhnLwz4ywADBgwY8L+dFbD1LRqhjQUAAAAASUVORK5CYII=';
icon_cs[1][8*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAe0lEQVR42u3TwQnAMAhA0bp'+
		'ZRstobmbTQ0EolkBCq/D/UQTfIRFVPSolgAEDBgwYMOBMAQYMGDDgZ601m9kbtyQN2Ky/H5IOeAv4gvn8PC34hkVzwKtgX3pweAj'+
		'wJnC5J1Hy05UD+9KDw0OAF8Eze2nAXwYYMGDAgP/tBJFw9S1tw2xPAAAAAElFTkSuQmCC';
icon_cs[1][9*5+0] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAeUlEQVR42u3T0QqAIAxG4fZ'+
		'me/S9WdlFMIiJYNQvnXOpwj5BLSK2lTLAgAEDBgwYsFKAAQMGDPieu+8j59oskwG3+oPMAD8CPmG5vC4LvmDVOuBZcE4eXA4CPAm'+
		'u9iSfRO8igH/5JJb8dMuBR87JgN8MMGDAgAF/2wGXUuEtUV5r+QAAAABJRU5ErkJggg==';
icon_cs[1][9*5+1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAdUlEQVR42u3TSwqAMAxFUbO'+
		'zLD07UycFP0QLFX3Be4ehkFNoLSKmShlgwIABAwYMWCnAgAEDBnzO3eeec+su0wHfkQ3wQ+AjaTOXBTdYNgc8Ct4lD043AR4EZyk'+
		'+icuLAP7jk6j56cqBO5IBvxlgwIABA/62BTnKvS2FydqPAAAAAElFTkSuQmCC';
icon_cs[1][9*5+2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAe0lEQVR42u3TUQqAIAyA4Xa'+
		'zHc2j7WZmD4ERE8Gojf7/cQz8BBUz2zIlgAEDBgwYMOBIAQYMGDDge6paZ/baWRIGXOrYXEQAPwI+YBdoNw8LPmHeHPAquC882Av'+
		'wKtiFRnwSo4sA/uWTSPnp0oFn9sKA3wwwYMCAAX/bDghy4S0NHYLTAAAAAElFTkSuQmCC';
icon_cs[1][9*5+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAgklEQVR42u3T0QmAMAxFUbN'+
		'ZB3AQR3IQB8hmVT+EgKQUKprgfZ9pIKeQiKpOmSKAAQMGDBgw4EgBDBgwYMD3lFJqT98xS8KA67a0B80r4EfAJ8zG1sOCL5hXBzw'+
		'KtgkPdgcBHgR7byFXovURwL9ciZRHlw7c0xcG/GYAAwYMGPC32QGZA+EtmbdcHQAAAABJRU5ErkJggg==';
icon_cs[1][9*5+4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAwADAAMCNeLu6AAAAfElEQVR42u3TYQqAMAiG4bz'+
		'ZjrajeTOrH4EQjsGilN7vpxN8BiqqulWKAAYMGDBgwIAzBTBgwIAB39Nas5m+Y5akAZv18SDpgB8BnzAfX08LvmBRHfAq2Cc9OBw'+
		'EeBEcvaVcidFHAP9yJUoeXTnwTF8a8JsBDBgwYMDfZgcIcuEtoElkPAAAAABJRU5ErkJggg==';

// 資源モード（２０ｘ２０用） 資源アイコン＝numx5+maxtype、0=平均,1=木,2=石,3=鉄,4=糧
icon_cs[2] = new Array();
icon_cs[2][1*5+0] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAY0lEQVR42u3UQQrAIAxE0c7'+'NcvTczOrCCtJuJCRd/FkFF8MjYOTuV3UEAgQIECBAgMhEmFnb33qP0hE9q0SqQcx5YEoQ+0ZAgPgF4u13zJxgQu7EU3a4kbCLmb6'+'J6IAAAeIrN59NkWIunq91AAAAAElFTkSuQmCC';
icon_cs[2][1*5+1] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAW0lEQVR42u3UPQoAIAhA4by'+'ZR/dm1VJEP0uENrw3NshHoGJmKToBAQIECBAgQHgiVDXPb3WO+CNGhkQhWjkIsfwICBA/IHbb0brBvLkTfZo34pAb4nUgQIA4VQC'+'K6n9iLPGhRQAAAABJRU5ErkJggg==';
icon_cs[2][1*5+2] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZElEQVR42u3UsQnAMAxE0dx'+'mGs2jaTPHTRwwSWOE5OJfqUI8DiS5+1UdgQABAgQIECAyEWbW19nYo3RE66+jSTWICRiYEsTaCAgQRyC+ruPJDibkT0zQZiNhHzO'+'9ieiAAAHiLzeBiZFig1ditAAAAABJRU5ErkJggg==';
icon_cs[2][1*5+3] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAa0lEQVR42mM8cOAAw0ADxlF'+'HjDpi1BGjjhh1xKgjRh1BT0c4ODj8RxcDmsNId0f835KBMMRnxsA4AsYGOWZAHIEeIqOOGHXEoHAEttwBA+Q4hirlBNwwMkOEaiU'+'m3UOC2mDUEaOOGHUELgAAalWRYnBbnpoAAAAASUVORK5CYII=';
icon_cs[2][1*5+4] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZklEQVR42u3UMQrAMAiF4Xo'+'zj5ajeTObDkkgtEsQ7fC/STI8PoQoZnZVR0CAAAECBAgQmQhV9f2t90g6wr2tEmk1iDE/mBLEvhEQIH6BePsdIyeYkDsxyw43EnY'+'x0zcRHRAgQHzlBoGJkWLJBgLoAAAAAElFTkSuQmCC';
icon_cs[2][2*5+0] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAY0lEQVR42u3TQQ6AIAxEUed'+'mPXpvprhwA+nGmKnRP0tIymMCysytOwIBAgQIECBAOBERsVd7Y55siJF1mORFzGsnyoqomvlfE695E9fN57Qg7hz6vSaWYd2/w97'+'E0wEBAkSVA3S9kWKCsbfvAAAAAElFTkSuQmCC';
icon_cs[2][2*5+1] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAX0lEQVR42u3TMQ7AIAxDUXK'+'zHD03owxMtFmqyqnge0UKDytYRLTqGAgQIECAAAFCiXD3np2NeaZDPDFMjVjTxYi0meOa+M9OzJevKUG8uXTDJm7Tqn+HuomvAwI'+'EiCwXUIp/Ymb+9bEAAAAASUVORK5CYII=';
icon_cs[2][2*5+2] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZElEQVR42u3TsQ3AIAxE0Xg'+'zj8Zo3ozQ0IDcRNE5Cv9aJHg+GYuIqzoGAgQIECBAgFAi3L1nZ+M+kyFa3x3NTIvYAAMlRWTNnNfEZ3ZiTr6mBPHk0f81sab8d8i'+'beDsgQIDIcgNLEZFiCgyLIAAAAABJRU5ErkJggg==';
icon_cs[2][2*5+3] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAaklEQVR42mM8cOAAw0ADxlF'+'HjDpi1BGjjhh1xKgjRh1BT0c4ODj8xyUHNI+Rbo74vyUD0zCfGfR1BLoYyFF0dQSukBl5ITFo0gTM5+hgQBxBjqXDLyQwDBvo3EH'+'3kKA2GHXEqCNGHYELAAAqlZFi3saeqgAAAABJRU5ErkJggg==';
icon_cs[2][2*5+4] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZklEQVR42u3TQQ6AIAxEUXu'+'zHo2j9WZVF24g3RgzNfpnCUl5TMAiYuuOgQABAgQIECCUCHfPau+YZzJE5liH2dAi5rUTJUVUzfyvide8ievmc1oQdw79XhPLsO7'+'fIW/i6YAAAaLKDksRkWKG9Ya5AAAAAElFTkSuQmCC';
icon_cs[2][3*5+0] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAXElEQVR42u3SMQrAMAxD0ep'+'mPrpv1jpDlhbToWAX/DUmYB5CcvejOwIBAgQIECBAVCLM7Mz+4p7KEJHnMakWcX9bqFJE1sy8JtjEWzPzmvjtJnbaNvE1IECAyHI'+'BpK6RYl9LCAMAAAAASUVORK5CYII=';
icon_cs[2][3*5+1] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAVklEQVR42u3SQQoAIAhE0by'+'ZR/dm1qJVJC0CC/yzFeQxjJhZex0BAQIECBAgQGQiVNWj2/gneYgdQ7IRazwZETZTrgk2cWymXBP/bmLm2SZuAwIEiCgd4Ht/Yrv'+'KAqcAAAAASUVORK5CYII=';
icon_cs[2][3*5+2] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAW0lEQVR42u3SwQkAIAxDUbN'+'ZR3O0bqZePEnxIFTBn2uhPELk7uV2BAIECBAgQIDIRJhZi27jn9IQta2OKuUiFsBApSKiZv5rgk3smvmviWc3MXNtE6cBAQJElA5'+'7ApFiRFWLtwAAAABJRU5ErkJggg==';
icon_cs[2][3*5+3] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAYklEQVR42mM8cOAAw0ADxlF'+'HjDpi1BGjjhh1xKgjRh1BT0c4ODj8xyUHNI+Rbo74vyUD0zCfGfR1BLoYyFF0dQSukBl5ITGaJgiFzMgLiUGbJmBgwNIEpWDUEaO'+'OGHUELgAAWoaRYiCZ5rMAAAAASUVORK5CYII=';
icon_cs[2][3*5+4] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAXklEQVR42u3SwQkAIQxEUdN'+'ZSrO0dBbXgxcleBDign+OCuExjJhZuR0BAQIECBAgQGQiVNWjv++epCHc63pMai5ifuuoVETUzHtNsIldM+818dtNjFzbxGlAgAA'+'RpQF7ApFiMvaBuAAAAABJRU5ErkJggg==';
icon_cs[2][4*5+0] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAXElEQVR42u3QMQoAMQhE0cz'+'NPLo326RxWVxSBTTFn0oF5aHcfXRHIECAAAECBIhKhJk9Ua995b4MsTIkvYhvD6INEWlD/I5VI/Ks/BO7z4C4BhF1G+I0IECA2GU'+'C6EytYrGFo7AAAAAASUVORK5CYII=';
icon_cs[2][4*5+1] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAWUlEQVR42u3QuwkAIAwAUbN'+'ZRs9mfkBFFCshsbirTKE+ImaWohMQIECAAAEChCdCVfM41/uyz36I9q0siGUGEYaYhSGO17wRe96buG4GxDeIXhjiNRAgQNwqxFe'+'TYj3sYrkAAAAASUVORK5CYII=';
icon_cs[2][4*5+2] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAXUlEQVR42u3QsQ3AMAgFUf/'+'NGM2jsRlxQxQ5chUJUtxVUCA9IXcf3QkECBAgQIAAUYkws8h53WvfyxAzYkzpRjx3EG2IrA2xV454Aao/cfoMiN8gcm5DfA0ECBC'+'nLsaQrWJ9VW51AAAAAElFTkSuQmCC';
icon_cs[2][4*5+3] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZElEQVR42u3QwQnAMAiF4bi'+'ZA3SQjpRBMoCbpb1YQkJOBc3hfycVlA/FzEp2BAQIECBAgAARiVDV7vW7L3MfhujtLnLVDzH2INIQnjTEciwaMc/CP7H7DIhjEF6'+	'nIf4GBAgQuzysRK1i9wi3TwAAAABJRU5ErkJggg==';
icon_cs[2][4*5+4] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAX0lEQVR42u3QQQrAMAhE0cz'+'NPFqO5s1sNpaSklVBu/izUkF5KHcf3REIECBAgAABohJhZpH12tfelyEi5pDmjXj2INoQmTbE61g1Yp+Vf+L0GRC/QWTdhvgaECB'+'AnHIBxpCtYuyMGqIAAAAASUVORK5CYII=';
icon_cs[2][5*5+0] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZklEQVR42u3UQQ6AIAxEUed'+'mPXpvprBgI2FjTavkzxKS8igNcvejOgIBAgQIECBAZCLM7FzttXpKQ7TMxaR8RD+0vBNPb75fJ6Zi2TNxX4s8zyv/RHRG/tuJz87'+'ESNlMRAMCBIhVLnS9kWLX0mNCAAAAAElFTkSuQmCC';
icon_cs[2][5*5+1] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAYklEQVR42u3UMQ6AMAiFYbk'+'ZR+dm1qGTwiINWPO/tQl8oQQxs6M7AgIECBAgQICoRKjqGb1d9aQO4TGkA+G0a0G8afrDSTyqVSPuSXzPkjuR3ZF9J/HdnZhp24l'+'sQIAAEWUAUIp/YqQ2dZgAAAAASUVORK5CYII=';
icon_cs[2][5*5+2] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZ0lEQVR42u3UQQ6AIAxEUed'+'mPRpH681QF24kbCxp1fzZksCjTJC7b9URCBAgQIAAASITYWZ9tnbspzRE66OjSfmI89DySTy9+f8mcU96JwZA4HmW/BPRjnx3Eq/'+'txJWyTkQDAgSIWXZLEZFijFARfgAAAABJRU5ErkJggg==';
icon_cs[2][5*5+3] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAa0lEQVR42mM8cOAAw0ADxlF'+'HjDpi1BGjjhh1xKgjRh1BT0c4ODj8xyUHNI+Rbo74vyUD0zCfGfR3BMjSAQ8Jcn0+/EICwzB6pwl0MUqihyrlBKVpZOiGxKBNEzA'+'wYGmCUjDqiFFHjDoCFwAAKpWRYmXSg6cAAAAASUVORK5CYII=';
icon_cs[2][5*5+4] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAaUlEQVR42u3UwQ3AIAiF4bI'+'Zozkam9F66KXGSzFQm5+jJviJL4qZHdUlIECAAAECBIhMhKr6bO/qJ2kI9zY2k5aP6IeWT+Ltzf83iaFZdiaea5HnWfJPRDOy7yQ'+'+m4m7yjIRLRAgQMzqBEsRkWIkLNQMAAAAAElFTkSuQmCC';
icon_cs[2][6*5+0] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAYklEQVR42u3SQQ7AIAhE0c7'+'NODo3s3ZN2KiB2PzZmoxPRO7+dEcgQIAAAQIEiEqEmY3sbPapDDETy6R6xHdp+yRWX/6/SYSy7p3Y+Z4jO7G7I/dPIpRVI7KzMsT'+'pgAABIssLxLaeYonH1EMAAAAASUVORK5CYII=';
icon_cs[2][6*5+1] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAXUlEQVR42u3SQQoAIAhE0by'+'ZR/dm1b7cZCjIn22gDxsxs1EdAQECBAgQIEBkIlR1em97nuQhbgypQFzWlSBelja8xDGtuhOB7/nSiWhHGlzimJaNcJKG+B0QIEB'+'4WbCshmKHCHCHAAAAAElFTkSuQmCC';
icon_cs[2][6*5+2] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZElEQVR42u3SsQ3AIAxE0dx'+'mHo3RvBlJWpAbQLYS/WstweOw3P2qjkCAAAECBAgQmQgz69HsOU9piNZnR5PyEe+l5U2svvx/TYwp34md7zmyE7s78v0mxqQjolk'+'a4nRAgAAR5QaVFp5ijCfncwAAAABJRU5ErkJggg==';
icon_cs[2][6*5+3] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAaklEQVR42u3SwQ2AMAiFYdm'+'MATqIIzmIA7BZW8+Ei20gmp8ryetXQMzsqC4BAQIECBAgQGQiVLVHvZknaYh+nz6sXfmI59HySbz9+f8m4cKqb2JlPVtuYvVGvj8'+'JF5aNiHppiN0FAgSIqAZv9p5ioP+/PgAAAABJRU5ErkJggg==';
icon_cs[2][6*5+4] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZElEQVR42u3SwQ3AIAiF4bI'+'Zozkam9F6JlzUQGx+riTPT0DM7OkuAQECBAgQIEBUIlTVs96XJ2UI9xHDZNQj5qPtk1j9+f8mEcK6b2JnPUduYvdG7p9ECKtGZL0'+'yxOkCAQJEVi+VFp5iLKeXWwAAAABJRU5ErkJggg==';
icon_cs[2][7*5+0] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAXUlEQVR42u3QOwpAMQhE0cz'+'OXLo7y6eweSGkCOgr7lSKoAfl7q06AgECBAgQIEBkIsysn2Zzn9IQM/syKR+xjkaiL0Gso98+DRF1GeL2GRAgfoOIugzxGhAgQJw'+'yAPJWn2IjBc54AAAAAElFTkSuQmCC';
icon_cs[2][7*5+1] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAWUlEQVR42u3QQQrAMAgF0Xo'+'zj+7NTAtZhBDpouDvYmYXhPjQIuJSZyBAgAABAgSIToS7ZzW7/7M+xIlhCsS6LoWIZ+n+7kPMZIi3y4AA8R/ETIb4GggQIKoGHjG'+'JYo5H38oAAAAASUVORK5CYII=';
icon_cs[2][7*5+2] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAYUlEQVR42u3QQQrAMAhE0c7'+'NPJpH82ZpA0kWLaGLgnbxZ6UI+lARcVRHIECAAAECBIhMhJm13ezapzSEt6fDpXxEP7oAoy9B9KP3Pg0x6zLE22dAgPgNYtZliK8'+'BAQLELifUkp9ig73MeAAAAABJRU5ErkJggg==';
icon_cs[2][7*5+3] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZUlEQVR42u3QwQ3AIAiFYdm'+'MATqII3UQB2AzqwcuNaaHJuDhfycICXxBzKxkR0CAAAECBAgQkQhV7bvZ2CdhiN7quuy64xHzqMf7FMQ8+u7DEF6nIb4+AwLEMQi'+'v0xB/AwIEiF0evV6fYsSFq0UAAAAASUVORK5CYII=';
icon_cs[2][7*5+4] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAX0lEQVR42u3QsQ1AIQhF0c9'+'mjOZobMbXgkZjLEzA4r4KQgIniJl91REQIECAAAECRCZCVX036/skDeHe1mXS8hHjaCT6EsQ4OvdpiKjLEKfPgADxDCLqMsRtQIA'+'AscsP1JKfYis6xqsAAAAASUVORK5CYII=';
icon_cs[2][8*5+0] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAXElEQVR42u3SSwoAIAhF0d7'+'OXLo76zNoUjgLC7pvJoIeRLl7uR2BAAECBAgQIDIRZlajXp+nNETPPkzKR4ylM7O+ghhL1/q/S2zDvr0EP/HMT0S9NMTpgAABIko'+'DSkSrYnFTAAcAAAAASUVORK5CYII=';
icon_cs[2][8*5+1] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAV0lEQVR42u3SSwoAIAhF0dy'+'ZS3dnfWZROQsNum8mgh5EMbOSHQEBAgQIECBARCJUtXq9Pk/iECeGZCDmdTURMZau9YeX2KZ9ewl+4pmfcBKGuB0QIEB4aS2vjWJ'+'vZJCyAAAAAElFTkSuQmCC';
icon_cs[2][8*5+2] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAYElEQVR42u3SywkAMQhF0bz'+'OLC2l2Vk+MMwig7vBBHLfTgQ9iHL3sjsCAQIECBAgQGQizKxFvTFPaYjavo4q5SPm0hfw1FsQc+la33eJNfdegp845ieiXhri74A'+'AASJKBxSwq2IYDnFEAAAAAElFTkSuQmCC';
icon_cs[2][8*5+3] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZElEQVR42mM8cOAAw0ADxlF'+'HjDpi1BGjjhh1xKgjRh1BT0c4ODj8xyUHNI+Rbo74vyUD0zCfGfR3BMhSGIDxB8QRIEvR+SMvJDAMG7EhMZomBk2awCVHN0dQG4w'+'6YtQRo47ABQDq3atiDvm6UQAAAABJRU5ErkJggg==';
icon_cs[2][8*5+4] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAXklEQVR42u3SwQkAIAiF4dz'+'M0RrNzawOXQpvYUH/u4mgH6KYWbkdAQECBAgQIEBkIlTVo16fJ2kI97oPk5qPGEtnZn0FMZau9X+X2IZ9ewl+4pmfiHppiNMBAQJ'+'ElAYUsKtiWowuVgAAAABJRU5ErkJggg==';
icon_cs[2][9*5+0] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAY0lEQVR42u3SMQoAMQhE0Z2'+'beXRvtpsUNglWCxrIn84E9CHK3Z/uCAQIECBAgABRiTCzN/sb/VSGGNmbSfWIOTQSdQtiDl3r+zaxNatGrG/lm8g2c98mjr2JSNt'+'N/A0IECCyfPo8nmL6cykyAAAAAElFTkSuQmCC';
icon_cs[2][9*5+1] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAYElEQVR42u3SQQpAIQhF0dy'+'ZS3dn1YcGUTkK9EP3zSLQw0Mxs5IdAQECBAgQIEBEIlS1en99nsQhTgzJQMzraiLiW7q+H2ximxaNWBPdhNvMc0389yZG0m7iNiB'+'AgPDSAM1+hmI8ahF6AAAAAElFTkSuQmCC';
icon_cs[2][9*5+2] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZ0lEQVR42u3SQQrAIAxE0c7'+'NcjSPlpvZCm0XSlaFpOCfXRDMY4jc/aiOQIAAAQIECBCZCDPr0dv1n9IQra+OJuUjxtIXcM8liLF0nvdrYk46YgFkNxE1s18Tv72'+'JJ2U38TUgQICIcgLKnJ5is58jWwAAAABJRU5ErkJggg==';
icon_cs[2][9*5+3] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAbElEQVR42mM8cOAAw0ADxlF'+'HjDpi1BGjjhh1xKgjRh1BT0c4ODj8xyUHNI+Rbo74vyUD0zCfGfR3BMhSGIDxB8QRIEvR+SMvJDAMo7cj0MXoHhK4QmbkhcSgTRM'+'wMGBpglIw6ohRR4w6AhcAAKV8nmLgq80LAAAAAElFTkSuQmCC';
icon_cs[2][9*5+4] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAwADAAMCNeLu6AAAAZklEQVR42u3SsQkAMQiF4XM'+'zR8tobuZdCpsEqwMN5H+dCeiHKGb2dEdAgAABAgQIEJUIVfXs7+snZQj3sTeTUY+YQyNRtyDm0LW+bxNbs2rE+la+iWwz923i2Ju'+'ItN3E34AAASLLC8qcnmLjUKubAAAAAElFTkSuQmCC';

//------------------------//
// アイコン定義（領土枠） //
//------------------------//
var icon_2 = new Array();

// 赤
icon_2[1] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAADHElEQVR42u3Yy0sqURwH8J8LmUF'+'62M1eZlEUlQUS9C+0CSJoJ0URtGwXtQgqWkRFi3YtWgQ9KGpTBEGb9sGFGz2wh1EQiDY42ROxbtdzzwxMjGUzjo6mp/MFQRd65jP'+
		'n55zzOwaEEPykGCiY8FAw6aFg0kPBpIeCSQ8Fkx4KJj0UTHoomPRQMOmhYNJDwaSHgklPysAupxMxOTnAZmWJn0PPzxB8eADH+rq'+'BKLBvYAAx2dkQNhiAu7qChoUFEeju7UW/KivByLIQur8Hz/ExNG1tJR2fNDA/MoKY4mJ4ub2NgH6MBGfy8uDl5gauj46SCtcdzI+'+
		'NIaagQBWqCPf74frwEJo2N3WH6wbmBgeRqaJCM1QRfncHnv19aNzY0A2eMJgfGkKMzZYw9Cu4CVdLkOPA63Lp8oCLG8yPjyNxFnS'+'GfgWXZpw7OYGG1dW4x9IMThVUDe4/Pwf78rLmsWMGByYmkDE3N+VQJfjfpyfgcKlrgauCA1NTyIjX0e+GqsH5iwuomZ9XvbYvwek'+
		'KVYWfnUGNwrV+Anv6+1FuVVXaQ5XgD5eXYJuZiXrdEeCDlhZU1doqvs/u68sI6Mc8zc6KoMvtbWjc2flkiAD/aW9HNc3NGQ0Ozs2'+'hf29v4N7djbpTi17Swo4Jb+j9uDTsi4sZAXf19KCi0lIwlZdDAC9ZMZW0PIHhYcSWlYm7nHSGy6GevT3FB5YiWIgw2ya89rK460k'+
		'3uARl8vPBhzssNWhMYClu/OOWujqQlqnvhL9DzWZ4CQTAMjmp6To0bS1Pu7pQkd0OLL6rqZ5x+YwKfbNlejquceNqHlwdHajE4QA'+'Wr3nJhsv/o8JYltHRhMZJqD10dXejkvr6pMDl0BBuFnxCl7S09H3toTxHnZ3Iiktd6l0TgUfMqN8P3tNTcKyspM8BwCd4bS2YLBY'+
		'I8rwm+DsUv4TvevFaqic0KWApB04nsuFSjwX+/jCyWsUVwINLt3FtLXMO8eT53daGrNXVYCoshPDrawRcgkI4DCF8U7jHR2hKwRl'+'1yg/izTabCDcyDJkH8ekWCiY9FEx6KJj0/AeTN4OnIxo69wAAAABJRU5ErkJggg==';
// 紫
icon_2[2] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAC9klEQVR42u3YwWvTUBwH8F8PkS61'+'7dZ1ltKOrTKKMkTF/QHC8CAexIOCpY7pUHcWb6IH0YMePMpkoGPWCRMPHmSniSKCh4llo9uoY7WYWSOx2nVmSh3PJOONtmuTpk1r'+
		'+nzfU3p4ffnwey95+VkQQvA/xULBhIeCSQ8Fkx4KJj0UTHoomPRQMOmhYNJDwaSHgkkPBZMeCiY9FEx6GgYeD8VQi5MBtoVVfovr'+'ImQzIpybOGAhCjx1OYVaHIxyzS3zEB7rVYCTF+PI0+mCHVYG1iR4Yv4zXHh6qO74uoFfXBWQwydhvuYKoMXBcJubgdWVHCzNJ+sK'+
		'Nxz88rqAdu7ShqrB5bEf5pJw/onxcMPA8tLt6GF1Q9XgPwWp4rMcDE0at89rBk9fEZCzU39FK4U7PSz8SImwvMgZ8oCrGvzqhoDw'+'8jMSWg6OK56c52Fgovq5dIMbBdWEL0rwiP65Kwa/viUo79FGQ9Xg65kcJOb0wTXBZoFqwVPLaTh1L6h5b2XBZoVqwbmFNJweKw/f'+
		'Bn5+iUOeoN30UDU4H8/CsTv+kvddAB45GkV9xwPKdd+wsymgxZkZySigmWcJGJ7a/horAI+efIcO9vc0NTg6KqI/Gzl4P71U8qRW'+'ckm7u+zKfvi0xMOZ8eZY0pHBGPL6PNDezcKKtI8rWtL5kU9Q8mD5lGNmeD504Q2n+sBSBcuRq21rtUKr13xwDLW1M5CY5TWhFYFx'+
		'Hg/GkX+vC/Br6l/CMZRtY0D8noP+m25d96HraDkejqHAPg/YXY2veH5Fs19ycOS2PmhV4C14SILvbww8f4/Kcx2+Vh20JjDOw4EY'+'6u6tDzwfmk2L8DFmzH8b0gB4EI6i3Xv8W9+utcDzoRl+8zv4bMREDYBieCDoB4ebhVVBHxxD23ybYxNxY6F1AePcD21WvBI4huKu'+
		'iVGdjYaCce6eeIu6AhLcY4WN31AAx1A5WeEXfFvjYehRE7dpi4Mb8R1elwK32hgyG/FmCwWTHgomPRRMev4CvwB/p45NdckAAAAA'+'SUVORK5CYII=';
// 桃
icon_2[3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAC0ElEQVR42u3Yv4vTYBgH8KfDCzFS'+'q7FSjgbO01KVIhT6Jzg5iINbOeQWF0dxEx1EERwcXW455DgdFAcHJ0fhloMql7uzlDsK4WogVOphOMjw+iS9hKY/kqZNavr6fqcU'+
		'mjzvh+fNm+RNUUrhf0qKgxkPB7MeDmY9HMx6OJj1cDDr4WDWw8Gsh4NZDwezHg5mPRzMejiY9cwMrFQVStIExNOi/dv4Y4DRMaD8'+'rpxiCtx62KLkDLGPtX0NSmslG1i/V6fSogREIDb8cPsQKh8rseNjA+uPdUoWCJi66YH2x4VL+N+WCc3tZqzwyMH6U4Rmg6G+cDy3'+
		'+Q3hH6KHRwa2pq54SQwN9YW3TVBrKpTfR3efTw3WH2FH8+E7Oi5czIlgtAxQd9RIFriJwfozhErRQ0fBnY5rO1hrY/JaocGzggbC'+'97D2evjaY4P1FwjNzB7qC+/gWJRw8EBwUqBB8PZ+G4qrxcCxjQQnFRoI/4HwtdHwAbD6QKXpQjrxUD/4UeMI5Ffy0HF7wLWbNbp0'+
		'a8k+ztzPzAW0P53XHRt08OkAyp8HH2Me8NadLVq4UZhrsLFqUNM0ofGlMfRNbfiUXkx3V8AGTuk38zGllRWF5vI5EC+K0N5tjzel'+'e2O9QVknW285SYb3QtWvqu+C5Qu2YnVbOCuAuJA8uAMl5wlo37VA6FhgJ/UVXAGv4AroPKb+IdyFnsOx/DIh+zwbahyhXi2VZSxW'+
		'wumTnX3Heztq/kToy3DQicBu8SoWvz4beO89atXKPpkMOhXYHcxdHMy1eOAeqI7X3o3m2pFsANSWa1S+KrvfrtPAPVANv4P38Dt4'+'PUEbAAPwotztuB4O7kLz3XPVerTQWMAuvHrS8THg7mJ0smtid3Qjvq3bWLdpN29vUvmyDMIFAcAED9yBWjnWj0H7rUHl7Rxv0/bH'+
		'2YiX8pINJ6cImxvxSQsHsx4OZj0czHr+AkmHfqeuNr+eAAAAAElFTkSuQmCC';
// 橙
icon_2[4] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAADCklEQVR42u3YS2gTQRgH8K+Hhbhp'+'mppEtyGptjSEShADBY9ePIgn8SBCCVq86E0UFTQ04KOKFRRvilBEasFHD55E0IsgiCCUhlSNaSVla41sHyHpqsQyzi5myaZJNpvs'+
		'xmSc/2lz2Mz8Mo/MfG0IIfif0kbBhIeCSQ8Fkx4KJj0UTHoomPRQMOmhYNJDwaSHgkkPBZMeCiY9FEx6GgaOXRtEjNUObPsm+bOY'+'/QHiWhqC5yfaiAIvjp3B0A75OTU/B4Gz92Vg/PZx5PB0A8NYQMyk4evnGRi4OGk63jSwMDGMGKcHcqvfVdDiKHCbC3JLC5D8ZC7c'+
		'cLDw6BJiOrdqQivC8bvJeBQGhp8YDjcMLE1d1uPTDa0IzwjAz0xDMPLYMHjdYGE8jJgt3XVDy8HZTg7EpUXg5z4assHVDBaeXkH5'+'6WcktBw8P+IpvLkF6oDrBjcKqgnHIx44N6677arBwuR1xLTbGw6tCM+mITUb1QXXBDcLVAu+zM+B/+Rdzb6VBTcrVBM+/wH8p8r3'+
		'dQOYHzuNbB5/00MrwTMLcfAeu1my3yrwVHg/6t1zQH627zvREtDipF/ckUFfXj+D4MjzDQYV+P3lQ8i3e29Lg8WX91BufR0S716V'+'PKmVntJd2/HWj3fAZALvgA9aAh67MYQ4twfYrh55HVc1pQsjnaCkl6VTTjPDC6F89E3FDasiWIo02hZrJ7BOd9PB81Cmw4n/i6c1'+
		'oVWB84nfGkKObTtA+Zv6h3AFatuMl90KuEIjuvqh62gZGw0hrm8nsHZHw0e8cERzK9/AdXS0pnZrujxI5RrOv6sh8MI1KrXlOhyp'+'q526roex0SN4xAOmwFXQ9DJepzFDvtuQAsDU1RDy+vuVu2s9cBV0NQV8HN+DL+i/FZkKVsH7/MA6XCAuC7rgCpTzyO/ys3FDoaaA'+
		'FfjIIPL6+quCK5vR36oJn8AjGjavdGtqmfZt5CDy9vSCxc4B/P6lguehUn6m8Y+ymoWB8MPWLdMWJ1+Id3BuGc5YrGQW4pstFEx6'+'KJj0UDDp+QNsoH+nzzrb+wAAAABJRU5ErkJggg==';
// 黄
icon_2[5] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAAC0ElEQVR42u3Yv2sTYRgH8DfDwXkS'+'o+fJURKo1RCVIBT6Jzg5iINbKdLFxVHcRAdRBAdHly4iog6KQ4dOjkKXwileW4/QUjgaD14isRgKN7w+7zXn5dLeXe5Xenl9vxBI'+
		'IMn7fvK875v3fUuEEPQ/pcTBjIeDWQ8Hsx4OZj0czHo4mPVwMOvhYNbDwayHg1kPB7MeDmY9HMx6xgbW9XkiCGUkSSed173eH3h0'+'0ezs+xJT4Hb7PkBPOc8taws1m68coGHcIbI8jQRBdOC7u9/R3Nyn3PG5gTF+CNApZNvYBx2OB5fhvW20s5MvPHMwxo8BqkRCw+EY'+
		'4F8B/jFzeGZgOnQl6UJsaDi8g0xTg3n+ITN4ajDGD6Ci1dTQILgkqTDH2wBfz2SBSwzG+Alxh1+W0CC4W3HLWoe23iZuKzZ4XNBo'+'+Ca0/SZ22yODMX4G0MrYoeHwLvRFjwWPBBcFGgXvdLZQo7EU2bdAcFGh0fAfAA/u6yGwad4j5XK98NAw+N5eC9VqL47stw+sadfJ'+
		'zMwN53mlcncioMPpdl86oO3tZfgbWzlk8IHX1m6Rev3aRIN7vSVi2zZqtT4fuVMLGNLT/RWwBUP69UTAdX2RqGoVNirnYR5vjDak'+'B0N3UPTDdJdTZPgg1DS/hC5YoWAaWm1RPA1fNlU4uAsVhLPQr2+R0JHAbgxjEVbAS8j7mzo+uAc9A335hRTlaax+xNpa6voCNNaE'+
		'iitjr/hgRW37J0CfJ2o30eGBXteo6tWxwAfnKG1LUR6laifV8VDXb0NnruQC90PpNNrI5LszuQDQtAVSq13+d3ZNA/dDLVg4N2ED'+'Ef9UlCvYD2/0Kx5vcfOgVeezpmlkCs0F7MHn+xWPhnuL0cGtyUFFkx/wjwXsZnX1JsAvIlE8B69sH9yF0uzv0x/lN2wF303uNe1w'+
		'3It4Wa46cEE4weZFfNHCwayHg1kPB7Oev0iHfqc0GjUZAAAAAElFTkSuQmCC';
// 緑
icon_2[6] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAADHUlEQVR42u3YzUsiYRzA8Z8HmUEy'+'c9UytTCKSgMJ+he6BBF0k6IIOnaLOgQVHaKWDt06dAh6oahLEQRdugcLG2WMZWEQSDU4mb0g2rY9mwMTY6Xjy4zps8/Xix70mQ/P'+
		'ODPPo0IIwf+UioAxj4Bxj4Bxj4Bxj4Bxj4Bxj4Bxj4Bxj4Bxj4Bxj4Bxj4Bxj4BxL29gN+NGpVQplNAl/Oen6BPcR+5hw7Whwgo8'+'dD2EtJQWVK8quGAvYLFpkQf2n/Wjmh81QKtpCEfDcBw4hu2WbcXxioHHuDFkpsxwG7tNgH5MgOspPdzEbsBz6VEULjt4gptAJsok'+
		'CU0FD8aCcHR5BFstW7LDZQMPs8PIrrFnDE0Fv4vdwUHgADabN2WD5wwe4UaQjbLlDE0GN2lMwEZYYK4YWS5wWYMnuUkUnwW5ocng'+'wox7WS+sNa1lPVbG4HxBpeC+oA9WHCsZj502eCo0hXRqXd6hqeCPfx6BYZmM4JLgn6GfSKvWfjtUCn7OncNC/YLksSUFFypUCn7K'+
		'ncJiffJj/QQeDAyiWl1twUNTwf33fpi1zX553AngtsM21F7bzr8f0A4UBfRjc49zPGjHvwO7zbufDAngzt+dqLW+tajB85F59PL3'+'BfbO9r58UvvylLbr7BCOhcEf9MOSY6ko4H1MH7JWWKFaUw2+kC+9U1rcaGgUVdFV/FNOIcPF0P3AfsoLVkpwvPhs6zQ6MNPmgoML'+
		'UANlAM+1RxKaFvj9x8/6UKOxEYTb1HfCBWgZVQahWAimjdMZHUdGj5Y9Jz3IUeEAA23I+4yLZzS+bp4xzmQ1blaLhy6mC7kqXaCn'+'9YrDxf/R+FjjxvGcxslpedjL9CJnpVMRuBh6F31bJV17Yblp+fuWh+K6Pd3IYXG8r11zgYuhwUgQTq5OYNW1WjgbAB/hDZYGMGqM'+
		'wEW4jOAC1Kqx8t/1XflkhSoCFnIfupHT5kwLLkAtlIW/A3gDXlhvXi+eTTxxHb86UJ2lDso15fD8+pwAF6Cvby8uysED+wAbLcrv'+'Ued9I95WZuPhlJrCcyO+0CJg3CNg3CNg3PsHkzeDpwDP1hMAAAAASUVORK5CYII=';
// 水
icon_2[7] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAACw0lEQVR42u3YvWuTQRwH8MtQiJU0'+'Gh8JJYG2GqIShEL/BCcH6dCtFHFxcRQ30UEUwcHRpUuQUh0Uhw6dHIUuhViatobQUgiNgYdILIZChvN74bnwJKbPW54nefLzvhBI'+
		'SHJ3n9xrLsI5Z/9TIgpMPApMPQpMPQpMPQpMPQpMPQpMPQpMPQpMPQpMPQpMPQpMPQpMPUMDLxeLPDYxwS5OTrZf/2k2WQOPj/Pz'+'EVLgJ9UqnwJU5LBWY/lcrg18WCrxmUSCRfGegO+enLAvCwuB4wMDP9N1Pg2M3mp1QXsj4Ql8torP7h4fBwr3HfwCUM0B1Aouvvsd'+
		'8M8BwH0Di6F7DfPTLdQKXkdZhUqFffJxng8MfooeTXnoUafwJH7EKub4HuB+LHCewS8BTQQAPQ8ue3wPda0PUJdr8LCgdvAD1L3m'+'oW7H4NeAxkcAtYI30JaiS7gtOCxQO/hhvc5Ws1nbtp0LDivUDv4D8LwF/B/w40qFZ2Kx0EOt4OXTU/Y2ne7b7i7w3UKB35ubaz9/'+
		'FI+PBbQ37xqNNmjj6Iht9tnGusBL29v8TiYz1uDVZpO3MDq/lst9T2p9h/QMhrSYD2UM6fdjMqQf4N9YKplkszio7GMeOxrS5ogT'+'1Kxxygkz3Az9htNY3malttyWRG9fikbZdAjhEnoFi9SOWFwdbEm24E7hWAFvYAWU29Qo4RJ6GW35hba80jRX7XB1tFxBZTlUpo2g'+
		'x809+hPQNy6hnsAy4rrm9pDg5jkq6nruEToQWOY+GnMrILgZqqPsfZ/K9uUCYAUHlpvpdOe/6yBwM7SGsg6w8q6F6QKgF54FXDN6'+'xQ1cQlPGd0s+QwMByywbPe4E3oEaO4Do0fUAr24DvaZd3Nri1wG/ir28hddmuISK6Gdn7Dfe+zDO17S9kRfxKeznAn7BuI8mdxEf'+
		'tigw9Sgw9Sgw9fwFSod+p8kgrB8AAAAASUVORK5CYII=';
// 青
icon_2[8] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAADGElEQVR42u3YzUsiYRwH8J+HGJFM'+'27R11cIwKluIhf0XugQRdJOiCDp2izoEFR2iokO3Dh2CXijyUgRBl+7BwkYvaGkYBFINTloZom3rszPGs6tWjqPjS88+35Mexuf5'+
		'zPP4vPwUCCH4n6KgYMJDwaSHgkkPBZMeCiY9FEx6KJj0UDDpoWDSQ8Gkh4JJDwWTHgomPQUD2+1OVFHBQHm5Mv798TEC9/dhcDha'+'FESBh4aukVrNgEIRg4sLFpaWvsaB/f0eVFf3CZTKMri7i8DJiQ+2t7/nHZ838NgYhwwGBm5vo0nQ1GB4ZSUDNzdROD6+zCtcdvDE'+
		'BIf0enFoOrjfH4Wjo0vY2pIfLht4eJhFFotKMjQdPBiMwsGBDzY3v8kGzxk8MsIhs1n6iGYK1+tVwLJhcDqvZFngsgZPTnJIGAW5'+'oe/B8Yi7XCysr2fflmRwoaBicLfbD6urNsltZwyemgogjaas4NB08FDoFz/VWUlwUfDMTIDfR4sPFYOfn3OwuNgg2rd3waUKFYOf'+
		'nXF8X9+HvwIPDvqQ1aopeWg6uNd7D3Nz5jf7nQRuaztE7e3W+OeBAfWHgKZmfj4UB+3seGF39/X+nQTu7PyJWlsbPjR4YSGMnp9/'+'w96e582T2ptT2mLR8Af6KD81/LC8LH3pL0b6+pzIZPoMtbUqfssKZDalEzM6GkA1Ncr4KaeU4YnQ/X1f2gUrLViIMNoajQoMhtKD'+
		'Y2hVFcPfsK5FoRmB//24BzU16QBvU8WEY6hWy0AgEIXpaZ2kfkg6Wvb0nCKbTXirhR/xxBEV7s2zs9KgWYFxurqcqKXlC7/n5R+e'+'+B8V2hofzw6aExint9eJmpvzA0+EBoMR/pZ0DSsruR+CZCkAdHcf81Pd+Pfumgs8Eer3h+H09ArW1uQr9Mla4hHgjY1G0OlUwHHS'+
		'4BhqMr0863bLC80LGMduP+SnujkjOIYajS93bJfLBxsb8pV0CgLG6ej4gerrjVBdrYKnp1gSHENjMeBfSgQeHlhwOD5wmTY1uBBv'+'NmvjcIYpI7MQX2qhYNJDwaSHgknPH5M3g6dZBhoEAAAAAElFTkSuQmCC';
// 灰
icon_2[9] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMATgBOAE5iBS3kAAAC0UlEQVR42u3YzYtxURwH8GMzFsbL'+'mExmZDGG8j/YzF9gJWU1pjRS9jJNapDYK5mmhJpJ+SNsZm8hiWgaa3kpK+k8z+/Uma4ZXJd7PZznfDdYcM7H79zzpnK73eh/ioqD'+
		'GQ8Hsx4OZj0czHo4mPVwMOvhYNbDwayHg1kPB7MeDmY9HMx6OJj17A3s9/vx6ekp0mg05PN0OkWTyQSVSiUVU+BoNIop8uvrC728'+'vBBgKBTCVqsVqdVqAm+1WqhSqSiOVwz8/PyMz8/P0Wg0WoD+DIXrdDo0GAxQs9lUFC47OJFI4LOzM1HoOvhwOCTw9/d32eGygR8f'+
		'H/HV1ZVk6Do4DPVGo4He3t5kg+8MjsVi+OLiYmfoKjiMFhjq7XZblglua3AqlcJQBbmhq+C04p1OBxUKha3bkgzeF1QM3uv10Ovr'+'q+S2Nwan02myju4bug4OazlUXApcFJzJZMg6+q+hYvDPz0+Uy+VE+7YSfKhQMTgM9Xw+v7Kvv8CRSIT8wKFD18H7/T4UbGm/F8Ae'+
		'jwff3t6S9+Fw+CigP5PNZjG81mo1VK1WfxkWwD6fD7tcrqMG/32O8Xw+Rx8fH0t3akuHtMViIVP/MQ3ph4cHfHl5icxmM5nANhrS'+'wsDmH3ZQsMs5ZLgQWq/X105Ya8EQqLZWq0Vw6jk0OIUaDAZytBSDbgSmCQaD2GazoUNYpigUZuPxeIzi8bikfkjaWgYCAWy325Fe'+
		'r997xYUVhbaTyeRW7W51eLi/v8dOp/P70K4kXPiMQltPT087tbPT8RAq7nA4FIELofSUtM1hQVYwDVQc4PTsugtcCIWbj12Pg4qA'+'hfCbmxsCh85KgVMoLIXw3W63KytUETDN3d3dd8XF4BRqMpnICgAVLRaLx3OJJ4zX68XX19fIaDSi2Wy2AKdQjDGBwh9TLpeP95r2'+
		'Z+hFPDybAD85OWHzIv7QwsGsh4NZDweznj82FQczpHgBCQAAAABJRU5ErkJggg==';
// 白
icon_2[10] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAAAAAAP9DpOgcAAABjklEQVR42u3YwVKEMAwG4AQEWQ+i'+'XPD9n04OurIXkF2I68WxslAoLZSY/wbDTPsNkLZBAIL/FBQw8wiYewTMPQLmHgFzj4C5R8DcI2DuETD3CJh7BMw9AuYeAXPPamCq'+
		'aoIkUW9WFeDDAVmBidQBEAFv3YfjETB7do53Bh6C6p5zDbcOngrVwssS8Cm1DrcGNoVq4acTYPpoDb4YbAuqhVsqcMZgV1AtvGkA'+'72PjsWaD14Jq4W0LeBfOHnsyeCuobbgW7AtUC584t0Gwr9Cl8B54L1AdfGjeCpheC4I83xV0EF4UgC95z6CCP0qCNOUBHtipjX/S'+
		'1wsMcBdwo096j/C5NWd0WepVQI/gpsV10sbDJ/jSVWTW1pIuLUEYbgK3tVwaHR7osyGI41XgtvcFi46H1HYEQeAE3vuNug4wDLY7'+'HiqTa84EUWQF3oOez4Bx5E8DwBbcNdQJ+Gfyf1uyI/AetK4BD8l+mngK5u2dIMtuwl21cDYFK/jfb/2q/S63LBvxvkXA3CNg7hEw'+
		'93wB6xoXENO1jwwAAAAASUVORK5CYII=';

//--------------------------//
// アイコン定義（強調表示） //
//--------------------------//
var icon_3 = new Array();

// 強調１
// 20x20用
icon_3[0*3+1] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAAACAAACPkxwRAAAAdklEQVR42u3TSw6AMAgEUDhZuZl6'+
		'MzgZ/kLCwqiLisYMmyZddF4mlGmk14eBAAIIIIAAAgggvohQUW+tkZmRqHApIsK3h5do9/3+CtMV4YM7H0StGJ64BhFNRAtxljaR'+'28iIsxYeQeSlvLuc//2iQAABBBC9ZwYR9EOiDD/NxgAAAABJRU5ErkJggg==';
// 15x15用
icon_3[0*3+2] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAAACAAACPkxwRAAAAiklEQVR42u3SUQqAIBBF0ZmV6c6q'+
		'nenKpgwqiQqEkgnu/RL88PBQZZRfpYABAwYMGDBgTwEGDBgwYMCAXdUdnGKyEILknCWmqC7BG3J/dGGaHfct+C5gG8z0gVPwOqkf'+'8LbwFalg3S18h27FdgOfsesXqM6uFy4VYH12t/CbAQYMGDBgwIBdBfjrZqEuUy3an0BpAAAAAElFTkSuQmCC';
// 11x11用
icon_3[0*3+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAAACAAACPkxwRAAAAx0lEQVR42u3WQQ6CMBQAUXoyuJl6'+'s3Kyqo0kDQlKoMafcWbFgkVf+ktJw3X4q5JgeILpCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ5geoLpCaYnmJ7gSOUpl3Ec6/M8z8OU'+
		'p4QGl0sp6UUs5bHYW+KCl91twT12ORS4HeG6uBXtiV46ig8Fbkf447sHRzwUeD3G77CIHd6DPnuWBf+6Pef4zBUVGtx+letiO9zJ'+'4cBbf1e9/rrCgb+dYHqC6QmmJ5ieYHqC6QmmdwcvYXo94A2nDgAAAABJRU5ErkJggg==';
// 強調２
// 20x20用
icon_3[1*3+1] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAAACAAACPkxwRAAAAd0lEQVR42u3TUQqAIAwG4O1k7mbW'+
		'zbaTrbAMI6gebEX8e1EU3MfPZBro9WIggAACCCCAAAKILyJU1FNKZGYkKhyKqM2Xl0ciz2V7hemK8Oxemh8v5mOOQWxJ1BTWNTSJ'+'XRoN4iyFRxDtUN4dzv9+USCAAAKI3jUBGfRDouKLt9UAAAAASUVORK5CYII=';
// 15x15用
icon_3[1*3+2] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAAACAAACPkxwRAAAAjElEQVR42u3TWwqAIBCF4XFlujNr'+
		'Z7qy6UYmlA9CyQT/eRpR8OOgTib5VRxgwIABAwYM2FIAAwYMGDBgwKYyHJxCUu+95JwlpOBMgk/kdessorEse/BDwBpVd2T7wLrt'+'7IBLw0/oFWuu4Sa6EzsMfMNu77eabTcsxyerZ3MNvxnAgAEDBgwYsKkA/joLvS5TLdt3R4cAAAAASUVORK5CYII=';
// 11x11用
icon_3[1*3+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAAACAAACPkxwRAAAAx0lEQVR42u3WQQ6CMBQA0fZkcDPl'+'ZvRklUgwEKMSivFnnFlB0gUv/QVyuqa/KguGJ5ieYHqC6QmmJ5ieYHqC6QmmJ5ieYHqC6QmmJ5ieYHqC6QmO1NiPteu6+3UpJfVj'+
		'n9Hgeqk15WG5mS4zF/zY3RX4jF0OBV6P8Px0w3bBhF46ig8F3ozw58WHRjwU+GmM32ARO7wL3XiWBf+6Xee44RMVG7x6K89P2/5N'+'Dgd+9Xd11l9XOPC3E0xPMD3B9ATTE0xPMD3B9G5/YXo9rrEx/QAAAABJRU5ErkJggg==';
// 強調３
// 20x20用
icon_3[2*3+1] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACEAAAAhCAYAAABX5MJvAAAABnRSTlMAAACAAACPkxwRAAAAZUlEQVR42u3T0QmAMAyE4ctkzWbq'+
		'Zulk9UkQodWHWov8t0A+jotp1ecxECBAgAABAgSIGRHhUVJy5RzycBuKOI5fc4fpiiiLSvXQpjGIKZqotdFq4RXEeZRPx/nfFwUB'+'AgSI3tkBiLM1ovVcm2YAAAAASUVORK5CYII=';
// 15x15用
icon_3[2*3+2] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAYAAAAehFoBAAAABnRSTlMAAACAAACPkxwRAAAAh0lEQVR42u3TQQqAMAxE0eRk7c3U'+
		'm7UniwtRK+pC0DLCn1UChT4G4jbar+KAAQMGDBgwYKUABgwYMGDAgKXSHVxyiZSS1Votl+yS4BXZfmsW2/YE3wUcQ8SCvH1hPrkO'+'eG/4yhR6Dd+jn2G7gc/YOMziDS9H1s5yDb8ZwIABAwYMGLBUAH+dGT7ETS0BGxpnAAAAAElFTkSuQmCC';
// 11x11用
icon_3[2*3+3] = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAAACAAACPkxwRAAAAw0lEQVR42u3W0Q6CIBhAYXgyebPq'+'zeTJaLXKrLkc2vp3OucKpxd+AwY5HdNflQXDE0xPMD3B9ATTE0xPMD3B9ATTE0xPMD3B9ATTE0xPMD3B9ARHaixjG4bhOq61pjKW'+
		'jAa3Q2uXX7w9pXzKXPA0uxN4j1kOBX5ewvffm9ceo158KPB8CX/8umuJhwK/L+NlLGKG16G37WXBv27dPu4/ooKD28vb7WdyOPDS'+'7WqvW1c48LcTTE8wPcH0BNMTTE8wPcH0zgGkcD3U7OevAAAAAElFTkSuQmCC';

//--------------------------//
// ルート構築モードアイコン //
//--------------------------//
// 正常アイコン
var ricon = 'data:image/png;base64,'+
			'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAADOElEQVR42u3Yy2sTQRwH8F+U1XZD'+	'39EQE2krJbREsZCzB6mI9SIevJQi/g3iTfQgetCDd29Fag6KB73Ug8WDCF4KoZIHobSNpGlW10ht3baGMs4snbBNNtlHZiUd53va'+
			'3XYfn8zuPH4+hBD8T/EJMOcRYN4jwLxHgHmPAPMeAeY9Asx7BJj3CDDvEWDeI8C8R4B5jwDznn8Gnkq9Rz3SceiUZX1/W9NgQ9uG'+	'xPhlH1fgO+tJ1C11VPdP7m9/q+zAEUDQIR3D8C1IF4vwOj7pOd4z8D01jcKSrMNolpU1GAme0reXlCKcCYb1bQIPSJ2wVtEgnc97'+
			'CmcOfqBmEWnFWuhMbMJ3KzWPjGB6rBZOzv2SX4FXHsCZgcmrOyL3mkLpvhnY+LdauFrZhsXCKrwcZwdvGXxXTaHTkr8p1A64ETwo'+	'd8O6tgnZwlcmHZxr8EM1g+jrZwV1Am4Epy2exvdIxC65hjsGu4G6AVvBs0oJZmMXHcNtgx/jzqinQWdk92ZuwM3gG6RzU9YdwS3B'+
			'LKAswFbw5fJ3eBa9YHm9hmCWUJZgK3gGw2eawOvAtwsLKNo1UAdlFSOYVWrhuc0f8DQSN0UfAE8m59C14bED/0A6iMMQAjXmzUoG'+	'5kzG7wPgGwtzaGJkrO5i7Y42Yo9KEuxVKjC/lDGdqZm+0oNdffh7+FM9dlhe6V3YgyE828uUS/ZeaWPIDIqcTGY5Rng7dloU+qmw'+
			'3LTDagomIa3d2+GHkNzFBM56WCLQATySLJJr2RiSLMHVm+Q+orH+E9AuEw8C7cPP8hM/y6NAzNGP5mhqOZ36gM4FQ9DvssVbnVrS'+	'Fi3hTvRJ4Kyrz8HV4oGUa84HI47hbhcP9Bsl97ofGG1pxdTS8vAmfqgYfii7cKfLQwot42un8DWft9DJMQHTTCffodHIYHXt2ghu'+
			'twBAoYr2C6+D8zA7fqV9CgC18GhkCAKyH1Ttdx3cqsRDoGH8o5Fzc4VVplBPwDRTeoubw82KeARKqyZZDE14APUUTHP981s0HAlD'+	'EI/lu/vHjGVaAiVRd3ZgS1HgRfzq4S3T1oYW4kN4PF/CLe3X69EcFuLbLQLMewSY9wgw7/kLaIwBtgdcB2UAAAAASUVORK5CYII=';
// エラーアイコン
var ricon_e = 'data:image/png;base64,'+
			'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAADRUlEQVR42u3YT2jTUBwH8F+dgS12'+'znVlYa46N2pRq1jYXfAiePLgQRhDPHhRFGRuoIgiovhnOg8qOygiOobiyZPgRRAEDwpDF1drqXZUt4ysOqbVUcfzvbYpaZs2Tfo6'+
			'u+f7XrakS8pn7+Xl/X4OhBD8T3FwMOPhYNbDwayHg1kPB7MeDmY9HMx6OJj1cDDr4WDWw8Gsh4NZDwezniUDyz39SGhqBLFBTB0n'+'fiUgMfcdAqPXHUyBp/oHkbDamT0WWltSP5MzswArVoJQL2D4D/ganIDux7eqjq8aWD19AwntUhqWiRKZBMnblf49HAGpa336AwJ3'+
			'N0HyiwLRYLCqcOpg9dwwIqOYD/Xfu+iQD5xEenD2XD4cXxuVZeh+dJM6nBqYTF3R22EI1Y6NwDmf5cPVOYiNT0Dg4RA1eMVg9RSe'+'uuukktBywMXgouSCxNQMxIIhKgucbbB6/jbSpp8Z1Aq4GFwbceX9B/CPXrUNtwy2A7UDNoXjVd0/Yn2qlw1WL9/F71GnLWgl4JJw'+
			'/DpT3o1bgpuCaUBpgM3g8c+T4Bs+a3q/omCaUJpgU/jER/CVuG8BONY3iBp9ha8XWtGDqd0zDz4fioJnaMAQnQMe230Qde7ZlfMH'+'ZIFYDiFQfT49eQaBp3cK0DngN/uOIO/OHQU3q3W0HivU1UFycRHCz18Y7tSMp3RHG34e5rPnls2UXvgD4oa1+DmOlDel9SE7KHIx'+
			'2eXo4TW5aGWgsZevSy5YJcEkZLTr1zhBbGulAqf+WsJQoaUZlLeyKbQssJYQ/hLX5o1QMxsPAm1uhOS3eXBfOGrpn2Zpayn39iFp'+'21YQXU22RrzirWVmRJPTKrivHLP1ONgqHki7Rtq+xTLcdvGQeUbJd7nPHKqoYqqoPJT3n0CS31c23HJ5qEHjuFiQQ+C/f+nflYf6'+
			'jPUOIM8mX7Z2LQYvuwGgQZV4ug4eGaydBkAB3NcFohvD1XgB3LTFQ6DtralrY6EIVWhVwFl4z3E84l5DuGETjyxGma5JLBiGwOi1'+'5dPE0+fV3sPI09EJ9VILRi2kzuW0aTGU5Lc6C0riJ3Q/oD+iSwrWR2vEu/AmRglHQVjVwGYjvtbCwayHg1kPB7Oev9FP96eURC+L'+
			'AAAAAElFTkSuQmCC';
// 起点アイコン
var ricon_f = 'data:image/png;base64,'+
			'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAADo0lEQVR42u3Yy08TQRwH8F/VVWjD'+'u9JgawBDCKQaSTiTYjBGvBgPXggx+i8YbwYPRg968O5JYpCDxoNe8CCRhph4ISGYPkIIUFMeiysGwQJWMs5smGa7O93ubrumjvO9'+
			'bFu62/3wm52XByEE/1M8Asx5BJj3CDDvEWDeI8C8R4B5jwDzHgHmPQLMewSY9wgw7xFg3iPAvOevgYdi71GddAKqvV71/W4mA1uZ'+'XRjvueThCnxnbRbVSlW5982Hrzeye3AEEFRJxzF8B+Krq/C6d9B1vGvgESWOgpJXhdEsyivQETilvl6QV+FMIKi+JnC/VA0r2QzE'+
			'UylX4WUH31eSiFRRDx0ND3huxiaRFkw/08PJuZ9TS/DKBXjZwKTpdnjrDdBbyjFL5z/z/zZUXMnuwlx6GV72lA9eMviuEkOnJR+z'+'otFoVL14pL/f9BrRqSn1GIlEDBUPeGthLbMNyfSXsnRwjsEPlASizU8PVREWsSw0ObKaOql4HP/GePiiY7htcDFoDoDBeixF0bD+'+
			'TsE0heBJeR3Gwhdswy2DH+HOqK5AZ8T6vh5MsdPhZvXYF9swoFlgM/gW6dzkNVvwomC7UDMw6Zi0vTSrQysELgZf3PwKTzv7isIL'+'gp1CzcAktMJ0WLJWF+vwBIaPmsAN4NvpGdRZ02SA2g2pXrFnWBtSfafRw+e3v8GTUC8TnQcenJ1AV9u7875AOggnYT2jhaKvvpMQ'+
			'qDZvlhIwwRi/88DXZybQQEe34WKVjtZij0oSHGSzMLmQYM7UmE26taYBPw+/cp85adI0ZjMtVpN30rRpk96HA2jDs73E5rq1Jq0N'+'mUGRk8ksRwsvtaOhvbTdYYl1LT30Y3rRtMMyBZOQatdX+aDFW2MbTmda2rCGJbtgPbQJjyRzpMe3MCQVBed+ZH4adTeehEqZeBBo'+
			'A76X7/heHvrDtlqcranlcOwDOhdogUYLFXdjakkruo470cf+s44eLUeLB7Jdcz4QMoWXc/FAn1HyW/f8XSWtmEpaHt7ANxXGN1UI'+'XurykEI38bVj+JrPS+gwywKmGZ59h7pCrbm1qxbuZAOAQuXMD7wOTsFYz+XK2QDQwztDbeD3+kDJ/MyDW9niIdAg/qeRc+fTy2WF'+
			'ugKmGVIrzoazNvEIlO6aJDF03AWoq2Caa5/eovZQEAJ4LN8//Ey7TUugJMreHuzIMrzovfLvbtPqQzfiW/B4voAr7VP3oznciK+0'+'CDDvEWDeI8C85w/zOie2NTYv+QAAAABJRU5ErkJggg==';
// 終点アイコン
var ricon_l = 'data:image/png;base64,'+
			'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMA/wD/AP83WBt9AAADeklEQVR42u3YzUsUYRwH8N9WU7qL'+'75uL7YYWIsoWCZ5lDSOyS3ToIhL1L0S3qEPUoQ7dOyVhHooOdbFDkiJBF0GMfUFE3VhfxibDtFXb5On5DT7D7uy4OzM7I+vT8z3N'+
			'Djszz2eeZ543DyEE/qd4BJjzCDDvEWDeI8C8R4B5jwDzHgHmPQLMewSY9wgw7xFg3iPAvEeAec+BgfujH0mNdAIqvV7191Y6Devp'+'LRjuvOzhCnx3eYpUSxXa78a949XMNhwBAhXScQrfhNjSErzt6nMd7xr4vhIjQcmrwljm5EVoDZxSj2flJTgbCKrHCPdLlbCYSUMs'+
			'mXQV7jj4oZIgWIt66GC413MrOkqyweycHo7Xfk3OwxsX4I6Bsem2ems1aCQq27rPeDigwZXMFkynFuB1p3PwksH3lCg5LfnyavS2'+'cgwiPT3WsGNj8ML/N6epB7zVsJzegETqmyMdnG3wIyVOWPPLhmIzVQs/Pk7sgCORiHq9UVPHGo/RZwyHL9mGWwYXg2qF14ERYyYM'+
			'zLIfPCGvwFD4omW4afAT2hnV7NMZGf3fCIzNVd9pmS2oEXwdOzd52RK8KNgq1C1wMfjc2nd43tZd9H77gu1C3QYXg8cpfLAAPA98'+'JzVJ2qoa8qBWo++lzXzD+ELsRA+f2fgBz0JdhugccN/UCLl2piPnD9hB2El3dNXSsIQvZCLcaOtZGIRm5918HEYMxu8c8I3JEdLb'+
			'2pF3MzvogwRnY49KEuxmMjA6GzecqRk26eaqOvo9/NHOHZYmvQO70EJne/G1FXNNOjs4g8KLcZaTDS/HTotBP6fmCnZYBcEYrO3a'+'Ch80eassww9iWEJoAx1JpvFeJoakomDtITMTpKP+JJTLxAOhdbQsP2lZHvvDll6apanlQPQTOR9ognoTNe7G1JLV6ArtRJ/6z9n6'+
			'HGwtHnC75kIgVBDu5OKBfaP4rAf+9pJWTCUtD2/SQoVpoYzgTiwPGXSN3jtK7/myhE7OETDLwNQH0h5q1taumFI2ABhUTv+i6+Ak'+'DHVeKZ8NAD28LdQCfq8PlPRv7bzZLR6EBulLw2tnUguOQl0Bs/SrNW4MN9rEQyjbNUlQ6LALUFfBLNe/vCdnQkEI0LF8Z+9c9jYt'+
			'QjHK9jZsyjK86rp6eLdp9WEb8U10PJ+lNe1T96M53Igvtwgw7xFg3iPAvOcfcDIRtt/m9fAAAAAASUVORK5CYII=';

var atk_icon = 'data:image/png;base64,'+
			'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAABnRSTlMAwADAAMCNeLu6AAABIUlEQVR42u3Yaw6EIAwE4OVkXh1P'+'xsZNTBpSHiZthdmZn0giH2BFU875809JBIOHYPQQjB6C0UMweghGD8HoIRg9BKOHYPQQjB6C0UMwegj2zHEcRWs/zzPBgW9sqmil'+
			'xKJDwalButAEEwwM1oqb1YQsWbTk5BRBt0C7grWV0iDNwQme1bZ3A0tsMtiMW4C17dtb4XpF7zbLd3UIWOJ6bb2+yxetGXALeuHq'+'5395cI3WkBrUbTAR4Bv9u9HLUFdwq0JrRSsSaw7uQUftWx0tZ6D1NZlIuBm4B21NxBvPtfkKywFrBWs0GbKPB9r9aKlhW19GHmfn'+
			'EPAs9mnfpcGzgCd9twCPAK2PjG3BI0D0r1v3k5Y3YAnwyiEYPQSjh2D0fAED+WdMDlMwAwAAAABJRU5ErkJggg==';

//----------------------//
// レーダー描画アイコン //
//----------------------//
var icon_m = new Array();
// red
icon_m[0] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAABGdBTUEAALGPC/xhBQAAABhJREFUGFdj/M+ABP7/ZwDyEYgY'+'/n8UAAB2YibbE1hiFgAAAABJRU5ErkJggg==';
// green
icon_m[1] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAABGdBTUEAALGPC/xhBQAAAB1JREFUGFdjZGhggIP/9f8ZQHwY'+'+v+fMB+oBhkAAG1dIOdybdeqAAAAAElFTkSuQmCC';
// orange
icon_m[2] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAABGdBTUEAALGPC/xhBQAAABxJREFUGFdj/N/gwAAH9fsZgHwE'+'+v+fMP8/CgAA8fEv28S8Pq0AAAAASUVORK5CYII=';
// yellow
icon_m[3] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAABGdBTUEAALGPC/xhBQAAABhJREFUGFdj/P+fAQn8ZwDykRAx'+'/P/IAABygjLPOSZPYAAAAABJRU5ErkJggg==';
// black
icon_m[4] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAABGdBTUEAALGPC/xhBQAAABdJREFUGFdjYEAC////R+YyEMMH'+'qkEGAG3+GuaurV/rAAAAAElFTkSuQmCC';
// blank
icon_m[5] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAABGdBTUEAALGPC/xhBQAAAB9JREFUGFdjPHDgAAMM2NvbMwD5'+'cPD//3+CfKAaZAAA6go158lfhdYAAAAASUVORK5CYII=';
// purple
icon_m[6] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAABGdBTUEAALGPC/xhBQAAAB1JREFUGFdjbGD4zwAD9UAmkA9H'+'////J8gHqkEGAGOJLNsJpCpLAAAAAElFTkSuQmCC';
// blue
icon_m[7] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAABGdBTUEAALGPC/xhBQAAAB1JREFUGFdjZGD4zwAD/8FMIAFF'+'/8EC+PlANcgAAF56JttM3K+FAAAAAElFTkSuQmCC';
// aqua
icon_m[8] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAABGdBTUEAALGPC/xhBQAAABxJREFUGFdjZPj/nwEGwCwgH4b+'+'g+QI8IFqkAEAWpoyz55hZGAAAAAASUVORK5CYII=';
// wall
icon_m[9] = 'data:image/png;base64,'+'iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAABGdBTUEAALGPC/xhBQAAAB5JREFUGFdjbGhoYICB+vp6BiAf'+'Dv7//0+QD1SDDABreyznkufwCAAAAABJRU5ErkJggg==';

var root_icon = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAAAXNSR0IArs4c6QAAAAlwSFlz'+'AAALEwAACxMBAJqcGAAAAMFJREFUaN7t17ENg0AMQFGbDSgoWSTrkLFgnSxCSZERLkVQJCKR'+
		'QGKfbOm/igKJ+xR3ZxEAAAAAAAAAAAAAAJCf1vhIKeV2aDGql7TB75HLPD0f7tfti+0oIiJd'+'P1SJV8/Q3chP2nETbx2uHrHLPJ2L/BJuGa0hYx2jNWysU7SGjnWIbizW4xq7bnqvDfBPjWRh'+
		'9EPzBK/ndYjgrh/MFnTkbGaX5hzmplXxLn02PNNd+qdpaWdiSjMtRZ+HAQAAqnkAv9l3FuVV'+'5wsAAAAASUVORK5CYII=';

// 兵士構成
var solname = ["剣","槍","弓","騎","矛","弩","近","斥","斥騎","衝","投","武"];
//faraway 7.NPC砦、領土情報検索ツールのソース(bro3_npc_castle_info2.user.js) 変数部 終了

//faraway 11.書簡送信アシスタントのソース(bro3_Send_Mail_Supporter.user.js) 変数部 開始
//グローバル変数
var VERSION_11 = "0.4.1β";  //バージョン情報
var INTERVAL=1000;	//負荷対策 回線速度によっては正常動作しない時があります。その際は数値を増やしてください。1秒=1000
var HOST = location.hostname; //アクセスURLホスト
var PGNAME = "_MailSendSuppoter_"; //グリモン領域への保存時のPGの名前
var DELIMIT_11 = "#$%";
var DELIMIT2_11 = "&?@";

var SENDTFLG_NEW = 0;	//新規作成画面
var SENDTFLG_PRE = 1;	//確認画面
var SENDTFLG_END = 2;	//送信履歴画面
var SENDTFLG_CON = 3;	//新規作成画面連続送信中

var ADDRESSCNT = 36; //アドレス帳のカウント(ソース変更必須)


var d_11 = document;

//faraway 11.書簡送信アシスタントのソース(bro3_Send_Mail_Supporter.user.js) 変数部 終了

//faraway のソース() 変数部 開始
//faraway のソース() 変数部 終了

//faraway 12.書簡同報リンク変数のソース() 変数部 開始
var num_12 = 6;	// 設定する個数	faraway110606 num->num_12
//faraway 12.書簡同報リンク変数のソース() 変数部 終了

//faraway 13.書簡保存＆検索ツールのソース() 変数部 開始
////////////////////////////////////////////////////////
// 変数定義
////////////////////////////////////////////////////////
jQuery.noConflict();
var d_13 = document;
var $_13 = jQuery;
var $xp = function (xp, dc) { return d_13.evaluate(xp, dc, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); }
var $xp1 = function (xp, dc) { return d_13.evaluate(xp, dc, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; }
var location_inboxURL = "/message/inbox.php";
var location_outboxURL = "/message/outbox.php";
var uneiLimitTxt = "ブラウザ三国志運営チーム";
var pageUnit = 12;
var worldKey = location.hostname;
var hrefArray = []; // [[書簡ID, URL]]
// 以下、GM変数
var syokanIdArray = [];		// キャッシュ済みの書簡IDの配列
var soushinsyaArray = {};	// {ID: soushinsya}
var atesakiArray = {};		// {ID: atesaki}
var kenmeiArray = {};		// {ID: kenmei}
var nichijiArray = {};		// {ID: nichiji}
var opValues = {};			// {autoCash: true/false, uneiLimit: true/false}
//faraway 13.書簡保存＆検索ツールのソース() 変数部 終了

//faraway 14.トレード検索条件記憶のソース() 変数部 開始
//faraway 12.と重複の為
var num_14 = 200;	// 設定する個数 faraway110606復活	111012 num->num_14
//faraway 14.トレード検索条件記憶のソース() 変数部 終了

//faraway のソース(17.bro3_Auto_Bilder_nokin_custom) 変数部 開始

var credit = "nottisan with nokin + ceri + kiri";

var nxTime = 30000;
var tidMain;
var tidMain2;

//寄付用
var OPT_RISE_KIFU_MAX = 10000; //寄付を開始する糧の量
var OPT_RISE_KIFU = 1000; //寄付をする糧の量

//市場用
var OPT_RISE_MAX = 30000; //市場変換開始する糧の量
var OPT_TO_WOOD = 10000; //木に変換する糧
var OPT_TO_STONE = 10000; //石に変換する糧
var OPT_TO_IRON = 10000; //鉄に変換する糧
var WOOD = 101; //木の内部コード
var STONE = 102; //石の内部コード
var IRON = 103; //鉄の内部コード
var RICE = 104; //糧の内部コード
var OPT_TO_CODE = new Array();
OPT_TO_CODE["wood"] = 101;
OPT_TO_CODE["stone"] = 102;
OPT_TO_CODE["iron"] = 103;
//新規作成用
var OPT_KATEMURA = 0; //自動糧村化オプション
var OPT_TORIDE = 0; //自動砦化オプション
var OPT_SOUKO_MAX = 1; //倉庫の最大数

//内政用 by nottisan
var OPT_DOME = 1;

//グローバル変数
var VERSION_17 = "1.5.17β";  //バージョン情報
var INTERVAL_17=1000;  //負荷対策 回線速度によっては正常動作しない時があります。その際は数値を増やしてください。1秒=1000
var HOST_17 = location.hostname; //アクセスURLホスト
var PGNAME_17 = "Auto_Bilder"; //グリモン領域への保存時のPGの名前
var TIMEOUT_URL ="/false/login_sessionout.php"; //タイムアウト時のURLの一部
var g_MD_17="";

var SENDTFLG_TIMEOUT = 0;	//タイムアウト画面
var SENDTFLG_LOGIN_MENU = 1;	//ログイン画面
var SENDTFLG_LOGIN = 2;			//ログイン中
//faraway110523同じ宣言があるためｺﾒﾝﾄｱｳﾄ var d = document;

// 保存データデリミタ
var DELIMIT1_17 = "#$%";
var DELIMIT2_17 = "&?@";
var DELIMIT3_17 = "{=]";
var DELIMIT4_17 = "|-/";

//保存データインデックス（拠点）
var IDX_XY_17 = 0; //座標
var IDX_BASE_NAME_17 = 1; //拠点名
var IDX_URL_17 = 2; //拠点URL
var IDX_ACTIONS_17 = 3; //実行中作業
var IDX_BASE_ID = 11; //拠点名

//保存データインデックス（実行中作業）
var IDX2_STATUS_17 = 0; //ステータス
var IDX2_TIME_17 = 1; //完了時刻
var IDX2_TYPE_17 = 2; //種別 C:都市画面、D:内政スキル、Fxy:施設座標
var IDX2_ALERTED_17 = 3; //通知済フラグ

var OPT_CHKBOX_AVC = 1;
var OPT_CHKBOX_AVC11 = 1;

var OPT_CHKBOX_W = 0;
var OPT_CHKBOX_S = 0;
var OPT_CHKBOX_I = 0;
var OPT_CHKBOX_R = 0;

var OPT_CHKBOX = [0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];  //ac.42
var OPT_CHKBOXLV = [15,15,15,15,15,20,10,10,10,10,15,15,15,15,15,10,10,10,10,10,20,20,20,10];  //ac.42
var OPT_MAX_LV = "2";
var OPT_FUC_NAME = [	"拠点","伐採所","石切り場","製鉄所","畑","倉庫",
			"銅雀台","鍛冶場","防具工場","練兵所","兵舎","弓兵舎",
			"厩舎","宿舎","兵器工房","市場","訓練所","水車","工場",
			"研究所","大宿舎","遠征訓練所","見張り台","修行所"];

var OPT_FNID = new Array();
OPT_FNID["拠点"] =	0;
OPT_FNID["伐採所"] =	1;
OPT_FNID["石切り場"] =	2;
OPT_FNID["製鉄所"] =	3;
OPT_FNID["畑"] =	4;
OPT_FNID["倉庫"] =	5;
OPT_FNID["銅雀台"] =	6;
OPT_FNID["鍛冶場"] =	7;
OPT_FNID["防具工場"] =	8;
OPT_FNID["練兵所"] =	9;
OPT_FNID["兵舎"] =	10;
OPT_FNID["弓兵舎"] =	11;
OPT_FNID["厩舎"] =	12;
OPT_FNID["宿舎"] =	13;
OPT_FNID["兵器工房"] =	14;
OPT_FNID["市場"] =	15;
OPT_FNID["訓練所"] =	16;
OPT_FNID["水車"] =	17;
OPT_FNID["工場"] =	18;
OPT_FNID["研究所"] =	19;
OPT_FNID["大宿舎"] =	20;
OPT_FNID["遠征訓練所"]=	21;
OPT_FNID["見張り台"] =	22;
OPT_FNID["修行所"] =	23;

//市場変換処理用
var OPT_ICHIBA = 0;
var OPT_ICHIBA_PA = 0;
var OPT_ICHIBA_PATS = ["平均的に変換","一括変換","自動割当"];
//自動寄付用
var OPT_KIFU = 0;

var d_17 = document;
var $_17 = function(id) { return d_17.getElementById(id); };
var $x_17 = function(xp,dc) { return d_17.evaluate(xp, dc||d_17, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
var $a_17 = function(xp,dc) { var r = d_17.evaluate(xp, dc||d_17, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); var a=[]; for(var i=0; i<r.snapshotLength; i++){ a.push(r.snapshotItem(i)); } return a; };
var $e_17 = function(e,t,f) { if (!e) return; e.addEventListener(t, f, false); };

//LvUPリンク
var LVUPLINK = "http://SITE/facility/build.php?x=urlX&y=urlY&village_id=viID#ptop";
var URL_SITE = "SITE";
var URL_X = "urlX";
var URL_Y = "urlY";
var URL_viID = "viID";

//新規作成リンク

var CREATELINK = "http://SITE/facility/build.php?ssid=ssid_val&x=urlX&y=urlY&village_id=viID#ptop";//2012.4.24	VerUp対応 ひろひろひろ
var URL_SSID ="ssid_val";//SSID ;//2012.4.24  VerUp対応 ひろひろひろ
var URL_fID = "fID"; //建物のID
var HATAKE = 215;
var SOUKO = 233;
var SUZUME = 216;

var VillageData = new Array();
var OPT_VILLAGE_17 = new Array();

var isMixi_17 = true;

//faraway 17.bro3_Auto_Bilder_nokin_customのソース(bro3_Auto_Bilder_nokin_custom) 変数部 終了==========================================

//faraway 18.全体マップ移動距離カスタムツールのソース(bro3_change_move_size.user.js) 変数部 開始==========================================
var DELIMIT1_18 = "#$%";
var DELIMIT2_18 = "&?@";
var VERSION_KEY_18 = "vtA101";
var VERSION_18 = "1.10";

var BASE = "   0   0";

// 共通関数
var d_18 = document;
var $_18 = function(id) { return d_18.getElementById(id); };
var $x_18 = function(xp,dc) { return d_18.evaluate(xp, dc||d_18, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
var $e_18 = function(key) { return d_18.evaluate(key, document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); };

//faraway 18.全体マップ移動距離カスタムツールのソース(bro3_change_move_size.user.js) 変数部 終了==========================================
//faraway 19.都市画面内政武将表示ツール(βバージョン)のソース(bro3_display_adm_info.user.js) 変数部 開始==========================================
var DELIMIT1_19 = "#$%";
var DELIMIT2_19 = "&?@";
var VERSION_KEY_19 = "vtB100";

// 共通関数
var d_19 = document;
var $_19 = function(id) { return d_19.getElementById(id); };
var $x_19 = function(xp,dc) { return d_19.evaluate(xp, dc||d_19, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
var $e_19 = function(key) { return d_19.evaluate(key, document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); };

// ゲージアイコン
var gage_icon = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAAFUAAAAGCAYAAACy79IDAAAABnRSTlMA/gD8AP5/ebwCAAAGK0lEQVR42i2V6W9cZxWHn7vNvtgz'+'k/HEcbwkTt04i9NQUpxiXCelAtSkKoIIFCGEEEJIIL7xib+C70iUIESjEKqiBtGUtGRtCU7iOIkbN3HiLa6XsWe9M3fu3PtyZsJ8'+
		'u++cdznP+Z3f0fymT+s3cXtUpcwOdAMsBaoOWgNCEQhYGpqr4W4pTB06MzqmxNTlu1GU720aqU7Z6CjW5nwsiRnYY5IIQX5Fsfi5'+'x84dBvtHDCw0bnzYpCx73zxhkZN9qwsely669G43+PbxEEruvXGtwfJ8k7GvhemTs+obcPnDKpGAzuirUYygxvy0w+M7dQZ2BxkY'+
		'loc6Gnc/LuLZHgdHUxKjU15y+PKBTTIdIDsYA8mj8qSKs+6Q2BnHigfxKy7Fp0V8pdHZE0U3NQqrNTa2aqSSQVIJC+V6PFixcTwY'+'kbMMTXKtNJkuN+kWPnubZdTZf2stltoP755SV+qfcDx6DL0psIRNC5ze+teWgKaAjWpYhsS70NhUBOWQZFrDlJBaXlEXsJmsgE0b'+
		'uBXFymOPsCS/50WdiCS2Nu+z9Mhj77BBX6+BLufc/rSJLfvGxyx2ZnWeLSoufeTQv8PkmxMhfFdx47LL6pLLq0fD5Potams+n31i'+'Ew/rfOUVgShvWpxusDhbp39XiO6BkABVPL5VbRd4YL9ACxvYq3LOvTLJjADanZA8FKXZEkqAxHoTGBELr9KgsFhGE6CpXFQSV2yu'+
		'19ksOqQTATpjJs2Gz0NZ85RiOGlJ/j5rdZ87ZZce2Tc8+THOkXGRzWVU2owR0yIYUsVWwgEBGwgIXE/DKyp0TyfZqbXXVU1RE/VF'+'IjpdPQJbCrE57+GWoX+3QUZgV9cVC/cV6Q44cMgiKaqau9/k0ZTP2LjFviFdCqjx7u8bokrFL38WIR01mZp0uPC+w1dHgrx9Mkxl'+
		'S+PC+SrF1SYnTsbJ9VgsCMSr/7Dp7w8wOhZB8w3uXauwOFXnyLEO0rmW8nxuvrcpHaNx+PWMKEQnP2OTv1ci0x8TsEm8kkd5ehNN'+'4McGOjDkfnerzsoXBcLxANu6w+D5LCxVWRWwfZkQWQHrVD2urFQxNY3X0iIrX3Gv5DJZ9jgk7T1SLjyHKvwwpJ11absW1KDVanmx'+
		'AZG6tyVr4hAdaZ1gC6oosbqsiMc0tvdJOwucdVGhW4LBIYOsqK78TPFEAOYkn5GXpcphjYe3msxOerz+RoCR/Ua7Vd/5nSNQFL/5'+'VYRs3OL61Trvn3MYHw1x6u0w5TycPVOlvOFx6vtxuvsCPBbwl85XGBoKMTYRkwR0bl2sMH/bZuxbKTI9otaCx/W/bBAQ9bzyZlcb'+
		'6tqdChtTRXKDSVIvCNRCk8KtTQzHJzbUiSlqdfI2yzNbRDuCdO2QTvAUc09KrAjUwWyYroRJTazio4WqsNB4IyOQRLWThQb/kSKN'+'Sh0ORcXgvnf3u+rc+nlEeHKB3oYZkAKYkqxfEkWJkuKdOiF5IHWFLcCioecqDUhKpQWf6oaib5dJ93YdW+zhyX+bJGI6R0ZFpWId'+
		'c3d8Zm42mThuMbzXRJcWvXDOxRZf/fHpEC/2msxMeZz5Q5WX9wX5yY9iuLbP2T/VWJh1Of2DOAMHgmx94fG3P5bIiUK+czIpVdeY'+'+meVz2/aYgdRBvfHaBRg8gNRoMyElyZSBAVE4aHD0yubZPsjdL+UaVvD+rU11FaT9IFtGNLejQ2btQeb6GJb3Xs62gpcmi/xbM2m'+
		'Nxchlwzg2C7XBagvIL+eDRJUPo/EQv6Vdzggg+io5OP89tcilP8PKv2irhIBrV1dq7VQaU0inVhcERJf1EVZzqoMIRHZNhkowpXq'+'l+Kna0oAC+Tu57Dmp5tymc6+wyaZhNYeXDOfeQzuMhg/ZhGUQvz9TIONZZ+f/yLMrpzB4kOPP5+p84LA/elp8TNR/wfv1Zi96/LW'+
		'iSgHDweprvj89Z0yUXnjybeSWFGDmas1bl8qM3wwyqHRuLxX48q7eZyixzdEoYGoLoWo8/RGgXRXiN7DnQLUoHC/iC1w0kMCPRUV'+'i3PIT6/TlJSze5KYgdYcqLC8UqYrE6Y70xqeHp/OlSi7Pq9tD4sVCnRR6OV8g37T4+junajrT9uD6n8kQMHfz+X6+wAAAABJRU5E'+
		'rkJggg==';

// デッキアイコン
var icon_m_19 = 'data:image/png;base64,'+
		'iVBORw0KGgoAAAANSUhEUgAAAFUAAAAXCAIAAAD1B5RqAAAEdElEQVR42mNkYGDwN83KLorn5uNkGDHg66fvU/sWbjw9jdHHOL2y'+'KZsJCJgZSTWFkZFkLYMB/P///9/f///+/euon8a4fclxPkHuIeoTSgDQ/58/fGM8vOnifzCghR2nD1/xDLN58/zDQHsWC2CEgEMb'+
		'L/z+9YdsU54/fs3Byc7Jxf77N8gQdg42IPn183dRSUE7f4NF3dviSr1mNa1X0ZKj3MX8QjzGTur71pylVhCwsrEwHtxw/uf3X//+'+'kRn/7lHmeGTP7L3x+vn7d68/iogLUu5cBXVJdWO5bYuOMbMwU8X/nNzsjAfWn/vx7RfZ6f/FkzcSMiIQ9s8fv/78/gthA5OAmJQQ'+
		'VVwJBzpmyjKqoncvPb1y+i7EImAq+/blB9kGcvFwgPz//etPGuV/PACYKPQt1B7ffYlHDTAEgQkevzlfP/44tPk8Rf4HBuF/ctM/'+'Gd5++fytpp6SgoaUlpnC8om7+AV5IFL2/kbHtl9CLoy+f/tp72f06sl7aHDICIpI8b959vHo9ouQ+H/76oOMgjjZjgE2eRj3rz0L'+
		'9P/fv//I0O+baEOMss3zj8DZTkEmQHLfujPAgjOtLvDi4TuP7rwAity6+qC4JwaYtq+dvY/LnF8/fwdnON48++jWpUdUiQxQxQ/0'+'/+eP38hL/9IKYpw87HAuDz+nnDooNoBOZGFlhkQRsI599vA1XA0wSVt4aAPrBQFhXudgU25+jk3zDjOA2yT+yXbAyujD28+4rAMm'+
		'DaD/r516cOfKY+r4XwDmf2BjgComAv0AJDfOPYRfDdAPty8/unP9kYomtF7UMVVW1pMG1pTi0sJ4gtvEWQOY/g9uOgcMX2BdCwxE'+'YKJ4/+YTea4FZj1Q++/xvRdAUyj3PC8/N7C2f3Tz5ebF+Pyva6p6+fRtNMHsllAgObVmNVzk589fRd3RxNiLrIskAGyVgPx/7+Zj'+
		'qvg/Jt8bWD4B0/C5Y9dI0hgQ76SgJYGm8cvnbxk1oECBlH/sHKzsnGzA+g/IXjtjP1zZ4/vPyXawhp4S47bFx25ffQisuin0vKWT'+'gY2vHpDRXbiIJI3ekXbAigBYjU1rWIVfJTDB57VHkGEFLqBrosa4deHRaxfvUuJ/I0ste39DLl4OBnDM3Lh8jxhdMvIS6noKwLKQ'+
		'AVyHt+TO4uHlxq+FiYmxcnISkNGaPZcq/ge6nBFYOV05d+vHj5/kGRGW4gGMPQgbWOydP0lUynfytgD2DiBsYGWxfOY2Iq1rmJUB'+'ItNmUMX/ZjZ6jMDq58Kp6z++k+l/eSVpGw/DMwev3bxKVLRDgJCIALBf+PDW83PHr337+p14jallIWKyAtXJk7m4qDBaY+lgyAiM'+
		'tLPHr3z/Rn4regABpNpmYmIiQy+w72vjbALy/8XTN96+eT/QfqE34OXjNrPRZ5zXvglY+V2+cINaTaAhAZiZmbV0VTk42RmtVULL'+'q/Ie3X1+/y7JjeoPHz4OtEdI8DCczcvLo6gsJ6Mo3tk+CTTsZ6EUlJQQKyTKP9COHAAAAMC58cqqWOdsAAAAAElFTkSuQmCC';

// データ保持変数
var servertime;
var servertime_t;

var vname = new Array();
var fname = new Array();
var rare = new Array();
var gage = new Array();
var skill = new Array();
var limit = new Array();
//faraway 19.都市画面内政武将表示ツール(βバージョン)のソース(bro3_display_adm_info.user.js) 変数部 終了==========================================
// ブショーダス履歴用
var d_24 = document;
var $d_24 = function(id) { return d_24.getElementById(id); };
var $x_24 = function(xp,dc) { return d_24.evaluate(xp, dc||d_24, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
var $e_24 = function(key) { return d_24.evaluate(key, document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); };

var VERSION_KEY_24 = "vtn200";
var VERSION_24 = "1.20";
var urlpath;
var maxpage;
var putText_24 = "";
var card;
var t_rare_count = {}; // ランク別カード数
var g_rare_count = {}; // ランク別カード数
var s_rare_count = {}; // ランク別カード数
var l_rare_count = {}; // ランク別カード数
var sp_rare_count = {}; // ランク別カード数
var sho_rare_count = {}; // ランク別カード数
var tai_rare_count = {}; // ランク別カード数
var stp_rare_count = {}; // ランク別カード数
var itm_rare_count = {}; // ランク別カード数

var xg_rare_count = {}; // ランク別カード数
var xs_rare_count = {}; // ランク別カード数

var total_cards = 0; // 総カード数
var g_total_cards = 0; // 総カード数
var sp_total_cards = 0; // 総カード数
var s_total_cards = 0; // 総カード数
var l_total_cards = 0; // 総カード数
var sho_total_cards = 0; // 総カード数
var tai_total_cards = 0; // 総カード数
var stp_total_cards = 0; // 総カード数
var itm_total_cards = 0; // 総カード数

var g_ex_cards = 0;
var s_ex_cards = 0;

var srup_text = "";

//

//faraway 29.トレード収入計算のソース(bro3_calc_trade_income.user.js) 変数部 開始==========================================
//グローバル変数
var VERSION_29 = "0.01";			//バージョン情報
var HOST_29 = location.hostname;	//アクセスURLホスト

var d_29 = document;
var $d_29 = function(id) { return d_29.getElementById(id); };
var $x_29 = function(xp,dc) { return d_29.evaluate(xp, dc||d_29, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
var $a_29 = function(xp,dc) { var r = d_29.evaluate(xp, dc||d_29, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); var a=[]; for(var i=0; i<r.snapshotLength; i++){ a.push(r.snapshotItem(i)); } return a; };
var $e_29 = function(e,t,f) { if (!e) return; e.addEventListener(t, f, false); };
var $v_29 = function(key) { return d_29.evaluate(key, document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); };
//faraway 29.トレード収入計算のソース(bro3_calc_trade_income.user.js) 変数部 終了==========================================

//faraway 31.自動巡回のソース(bro3_auto_map_move.user.js) 変数部 開始==========================================
//グローバル変数
var VERSION_31 = "0.5β";  //バージョン情報
//faraway未使用のようなので削除var MAX_XY = 600; //座標絶対値最大
var CENTER_X_31; //中心X座標
var CENTER_Y_31; //中心Y座標
var MOVE_CNT=20;  //移動量
var MAPSIZE=3; //移動時の強制MAPサイズ変更 1=11x11 2=15x15 3=20x20
var INTERVAL_31=2000;  //負荷対策 回線速度によっては正常動作しない時があります。その際は数値を増やしてください。1秒=1000
//faraway 31.自動巡回のソース(bro3_auto_map_move.user.js) 変数部 終了==========================================

//faraway .のソース(.user.js) 変数部 開始==========================================
//faraway .のソース(.user.js) 変数部 終了==========================================

//faraway beyond本体開始 ========================================================================
( function(){
//20120625
if(location.hostname.match("mixi-platform.com")){
	//ブラ三以外は終了
	if(!location.pathname.match("/gadgets/ifr")) return;
	if(decodeURIComponent(location.search).match(/&app_id=[^&]+&/)!="&app_id=6598&") return;
}

//20120915 mixiホームリンク追加→20130418削除
if(location.href=="http://mixi.jp/run_appli.pl?id=6598") {
	GM_addStyle(".appliAdArea01 { display:none !important;}");
	//bro3_mixi_iframeheigt_resizeの組み込み１
	window.addEventListener("message",function( event ) {
		if(!event.origin.match(/http:\/\/m\d+\.3gokushi\.jp/)) return;
		var iframe = document.getElementById('app_content_6598');
		if(iframe == null) return;
		var data = JSON.parse(event.data);
		if(data.command != 'resize') return;
		iframe.style.height = data.height + 'px';
	},false);
}

//bro3_mixi_iframeheigt_resizeの組み込み２
if(location.href.match(/m\d+\.3gokushi\.jp/)){	// フレームチェック
	if(window.parent != window){		// フレームで無かったら何もしない
		var height = 0;
		setInterval(function() {
			var target = window.parent.postMessage ? window.parent : undefined;
			if(height == document.body.offsetHeight) return;
			height = document.body.offsetHeight;
			if(typeof target != 'undefined') {
				var send = {"command": "resize","height" : height,};
				target.postMessage(JSON.stringify(send),'http://mixi.jp');
			}
		},CHECK_TIME);
	}
}

if(document.getElementById("beyond_basepanel") ) return ;

var VERSION_NAME = "ブラウザ三国志Beyond Ver3.0 by hasekun" + " 統合版";
var IMG_DIR = "/20100510-01/img/";

if( location.pathname == "/map.php" ) {GM_addStyle("a.map-basing { display:none !important;}");}

cut_main();
cut_main1();

///////////////////////////////////////////////
//Chrome用GM_関数
// @copyright	  2009, James Campos
// @license		cc-by-3.0; http://creativecommons.org/licenses/by/3.0/
if ((typeof GM_getValue == 'undefined') || (GM_getValue('a', 'b') == undefined)) {
	GM_addStyle = function(css) {
	var style = document.createElement('style');style.textContent = css;document.getElementsByTagName('head')[0].appendChild(style);
	};
	GM_deleteValue = function(name) {
		localStorage.removeItem(name);
	};
	GM_getValue = function(name, defaultValue) {
		var value = localStorage.getItem(name);
		if (!value) return defaultValue;
		var type = value[0];
		value = value.substring(1);
		switch (type) {
			case 'b':
				return value == 'true';
			case 'n':
				return Number(value);
			default:
				return value;
		}
	};

	GM_log = function(message) {
		if (window.opera) {opera.postError(message);return;}
		console.log(message);
	};

	GM_setValue = function(name, value) {value = (typeof value)[0] + value;localStorage.setItem(name, value);};
}
///////////////////////////////////////////////


///////////////////////////////////////////////
//配列のindexOf対策
if (!Array.prototype.indexOf){
	Array.prototype.indexOf = function(elt /*, from*/){
		var len = this.length;
		var from = Number(arguments[1]) || 0;
			from = (from < 0) ? Math.ceil(from): Math.floor(from);
		if (from < 0)from += len;
		for (; from < len; from++){ if (from in this && this[from] === elt) return from;}
		return -1;
	};
}


var d = document;
var $ = function(id) { return d.getElementById(id); };
var $x = function(xp,dc) { return d.evaluate(xp, dc||d, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
var $a = function(xp,dc) { var r = d.evaluate(xp, dc||d, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); var a=[]; for(var i=0; i<r.snapshotLength; i++){ a.push(r.snapshotItem(i)); } return a; };
var $e = function(dc,e,f) { if (!dc) return; dc.addEventListener(e, f, false); };
var isNarrow = location.host.match(/^[m|y]\d+\./i) ? true : false;

var MAP_X_MIN = -800;
var MAP_X_MAX = 800;
var MAP_Y_MIN = -800;
var MAP_Y_MAX = 800;

var OPT_HISTANALYSIS  = 1;	//24."武将ダス履歴抽出分析 Ver1.09"
var OPT_QUESTASSIST = 1;	//25."クエスト補助"
var OPT_TRADEINCOME = 1;	//29."トレード収入計算"
var OPT_RESERVATION = 1;	//30."出兵予約"
var OPT_AUTOROUND = 1;		//31."自動巡回"
var OPT_REPORTLOG = 1;		//32."報告書・同盟ログCSV出力"
var OPT_URL_CHANGE = 1;		//URLリンク変更スクリプト(bro3_url_change)
var OPT_URL_CHANGE_REV_RES=1;	//URLリンク変更スクリプト(bro3_url_changeの掲示板逆順表示)
var OPT_ATK_CALC = 0;	//スキル込計算スクリプト(bro3_atk_calc)
var OPT_DISPJST =1;	//JST表示


var OPT_TIMER = 1;
var OPT_ALLIANCE = 1;
var OPT_DEVELOPMENT = 1;
var OPT_STATISTICS = 1;
var OPT_ALLIANCELOG = 1;
var OPT_NPCFORT = 1;
var OPT_RIGHTCLICK = 1;
var OPT_ALLIANCELEVEL = 1;
var OPT_MISTAKEPREVENTION = 1;
var OPT_LETTERTRANSMISSION = 1;
var OPT_LETTERBROADCAST = 1;
var OPT_LETTERPRESERVATION = 1;
var OPT_TRADINGRETRIEVAL = 1;
var OPT_TRADINGAFTER = 1;
var OPT_NAVIGATIONADDITION = 1;
var OPT_BRO3AUTO = 1;
var OPT_CHANGE_MOVE_SIZE = 1;
var OPT_DISPLAY_ADM_INFO = 1;
var OPT_MASS_SHOKAN_TOOL = 1;
var OPT_DECK_TOOL = 1;
var OPT_CALCN_1KI = 1;
var OPT_AFTER_DAY = 0;	//ダミー
//faraway 110407 end
var OPT_B3NEWS =0;
var OPT_VILLAGE = 1;
var OPT_BASELINK = 1;
var OPT_MAPLINK = 1;
var OPT_XYLINK = 1;
var OPT_XYLINK_NK = 1;
var OPT_LARGEICON = 0;
var OPT_TTBL = 1;
var OPT_MEMO = 1;

var OPT_DETAILS = 1;
var OPT_DETAILS_UP = 1;
var OPT_DECK = 1;

var OPT_CTIME_B = 1;
var OPT_CTIME_U = 1;

var OPT_ALLY = 1;
var OPT_ALLY_IS = 1;
var OPT_ALLY_XY = 1;
var OPT_ALLY_CSV = 1;

var OPT_RES_T = 1;
var OPT_RES_TIME = 1;
var OPT_REMOVELIST = 1;
var OPT_MAPLIST = 0;

var OPT_TTDISTANCE = 1;
var OPT_TTDISTANCE_ITEMS = new Array();

var OPT_TTALLYPRSN = 1;

var OPT_MEMO_FONT_SIZE = "9";
var OPT_MEMO_WIDTH = "21";
var OPT_MEMO_HEIGHT = "5";
var OPT_MEMO_COUNT = "1";

var OPT_MAPLINK_FONT_SIZE = "9";

var OPT_USER_STAR = 1;
var OPT_USER_LEVEL = 1;

var OPT_MAPCENTER = 1;
var OPT_DELMSG = 1;
var OPT_TSENDTIME = 1;
var OPT_SMALLBTN = 0;
var OPT_ATTACKMAP = 1;
var OPT_CARD_CMB = 1;

var OPT_PIKA_YOROZU = 0;
var OPT_PIKA_HPREST = 1;
var OPT_PIKA_MAPHELP = 1;
var OPT_PIKA_TRDHELP = 1;
var OPT_PIKA_BLINKBLD = 1;

var OPT_SUZAN_SEISAN = 1;

var OPT_CASTLE_AID = 1;
var OPT_NEXT_MEISEI = 1;

if (isNarrow) {
	var OPT_VILLAGE_LIST_BOX = 1;
}

var g_MD;
var g_MX;
var g_MY;

var BASE_X = -9999;
var BASE_Y = -9999;

var USER_ID = "";
var ALLY_ID = "";

var RES_NOW = [];
var RES_MAX = [];
var RES_GROW = [];
var RES_GROW_W = [];
var RES_GROW_B = [];

var PRE_LOAD_NODES = {};
var URL_PARAM = {};

var Pika_elementQueue = [];

var VILLAGES_INFO= {};

var SID = '';

var OPT_STYLE	= 0;
var OPT_FAMEPOS = 1;
var DISP_RANK = 1;

var OPT_UR_CHANGE = 0; // 見た目を全部URに置き換えるアホツール
var OPT_SR_CHANGE = 0; // 見た目を全部SRに置き換えるアホツール
var OPT_PR_CHANGE = 0; // 見た目を全部PRに置き換えるアホツール
var OPT_HR_CHANGE = 0; // 見た目を全部HRに置き換えるアホツール
var OPT_AR_CHANGE = 0; // 見た目を全部URに置き換えるアホツール
var OPT_BR_CHANGE = 0; // 見た目を全部SRに置き換えるアホツール
var OPT_ADD_SHOW_SKILL = 1; // 合成確率アップ素材のスキル表示
var OPT_AUTO_SKILLUP = 0;

loadOptions();////20120625

if( !initPanel() ) return;
initUrlParams();
initStyle();
initPreLoadNode();
initResources();
getMyInfo();
initImages();
disp_Options();
initVillages();
initCastleSend();

if (isNarrow) initNarrow();


if(isNarrow && OPT_VILLAGE_LIST_BOX) disp_villageListBox();

if(OPT_STYLE)	cut_main2();
if(OPT_FAMEPOS) move_pos_fame();	//スタイル変更設定で、名声表示位置変更 2014/08の運営表示変更対応


if( DISP_RANK )	GM_addStyle("#social {display:none !important;}");//ｽﾀｲﾙ変更にﾁｪｯｸが入っていなくても動作するようにここでｺｰﾙfaraway110525

if(DEBUG_MESSAGE) console.log('開始： disp_village()');	if( OPT_VILLAGE )	disp_village();
	if( OPT_BASELINK )	disp_baseLink();
	if( OPT_MAPLINK )	disp_mapLink();
	if( OPT_MEMO )	  disp_memo();
	if( OPT_ALLY )	  disp_AllianceInfo();//XYリンク加工前に呼ぶ
if(DEBUG_MESSAGE) console.log('開始：disp_XYLink()');if( OPT_XYLINK )	disp_XYLink();
if(DEBUG_MESSAGE) console.log('開始：disp_TTable()');if( OPT_TTBL )	  disp_TTable();
if(DEBUG_MESSAGE) console.log('開始：disp_navigationaddition()');if( OPT_NAVIGATIONADDITION ) disp_navigationaddition();	//faraway110530 disp_Details()があると報告書でリンク表示しないため、呼び出し位置変更
if(DEBUG_MESSAGE) console.log('開始：disp_Details()');if( OPT_DETAILS )   disp_Details();
	// デッキ選択先表示は自動化
	disp_Deck();
if(DEBUG_MESSAGE) console.log('開始：disp_CompleteTimeBuild()');if( OPT_CTIME_B )	disp_CompleteTimeBuild();
if(DEBUG_MESSAGE) console.log('開始：disp_CompleteTimeUnit()');if( OPT_CTIME_U )   disp_CompleteTimeUnit();
if(DEBUG_MESSAGE) console.log('開始：disp_ResourcesTotal()');if( OPT_RES_T )	 disp_ResourcesTotal();
if(DEBUG_MESSAGE) console.log('開始：disp_RemoveList()');if( OPT_REMOVELIST) disp_RemoveList();
	if( OPT_USER_STAR)	disp_UserStar();
	if( OPT_USER_LEVEL) disp_UserLevel();
	if( OPT_MAPCENTER)	disp_MapCenter();
if(DEBUG_MESSAGE) console.log('開始：disp_TSendTime()');if( OPT_TSENDTIME)	disp_TSendTime();
if(DEBUG_MESSAGE) console.log('開始：disp_SmallButton()');if( OPT_SMALLBTN)   disp_SmallButton();
if(DEBUG_MESSAGE) console.log('開始：disp_AttackMap();');if( OPT_ATTACKMAP)  disp_AttackMap();
if(DEBUG_MESSAGE) console.log('開始：disp_PikaYorozu();');if( OPT_PIKA_YOROZU ) disp_PikaYorozu();
if(DEBUG_MESSAGE) console.log('開始：disp_PikaHPRestTime();');if( OPT_PIKA_HPREST ) disp_PikaHPRestTime();
	if( OPT_PIKA_TRDHELP ) Pika_installTradeHelper();
	if( OPT_SUZAN_SEISAN ) disp_SuzanSeisan();
	if( OPT_RESERVE_VILLAGE ) {
		// 拠点予約を可能とする仕組みを追加
		disp_ReserveVillageList();
		disp_addReserveLink();
	}
	if ( OPT_CASTLE_AID ) disp_castleAidLink();
	if ( OPT_L_CHANGE ) disp_LChange(); // 見た目を全部Lに置き換えるアホツール
	if ( OPT_UR_CHANGE ) disp_URChange(); // 見た目を全部URに置き換えるアホツール
	if ( OPT_SR_CHANGE ) disp_SRChange(); // 見た目を全部SRに置き換えるアホツール
	if ( OPT_PR_CHANGE ) disp_PRChange(); // 見た目を全部PRに置き換えるアホツール
	if ( OPT_HR_CHANGE ) disp_HRChange(); // 見た目を全部HRに置き換えるアホツール
	if ( OPT_AR_CHANGE ) disp_ARChange(); // 見た目を全部URに置き換えるアホツール
	if ( OPT_BR_CHANGE ) disp_BRChange(); // 見た目を全部SRに置き換えるアホツール
if(DEBUG_MESSAGE) console.log('開始：bro3_url_change()');if( OPT_URL_CHANGE   )	bro3_url_change();	//URLリンク変更スクリプト
if(DEBUG_MESSAGE) console.log('開始：disp_ToolTipsAllyPerson()');if( OPT_TTALLYPRSN) disp_ToolTipsAllyPerson();
if(DEBUG_MESSAGE) console.log('開始：disp_ToolTipsDistance()');if( OPT_TTDISTANCE) disp_ToolTipsDistance();
if(DEBUG_MESSAGE) console.log('開始：disp_mistakeprevention()');if( OPT_MISTAKEPREVENTION ) disp_mistakeprevention();
if(DEBUG_MESSAGE) console.log('開始：disp_tradingretrieval()');if( OPT_TRADINGRETRIEVAL ) disp_tradingretrieval();
if(DEBUG_MESSAGE) console.log('開始：disp_tradingafter()');if( OPT_TRADINGAFTER ) disp_tradingafter();
if(DEBUG_MESSAGE) console.log('開始：disp_npcfort()');if( OPT_NPCFORT ) disp_npcfort();
	if( OPT_RIGHTCLICK ) disp_rightclick();//NPCを使用すると発生の為、位置を下にしたfaraway110528
	if( OPT_RES_TIME )	disp_ResourcesTime();//NPCを使用すると全体地図で資源時間の表示位置がずれて見えない為、位置を下にしたfaraway110620
	if ( OPT_NEXT_MEISEI ) disp_nextFameTimer();//faraway110620
	if( OPT_MAPLIST)	disp_MapList();//faraway110425
	if( OPT_CHANGE_MOVE_SIZE ) disp_change_move_size();
	if( OPT_DISPLAY_ADM_INFO ) disp_display_adm_info();
if(DEBUG_MESSAGE) console.log('開始：disp_alliance()');if( OPT_ALLIANCE ) disp_alliance();
	if( OPT_DEVELOPMENT ) disp_development();
	if( OPT_STATISTICS ) disp_statistics();
	if( OPT_ALLIANCELOG ) disp_alliancelog();
	if( OPT_MASS_SHOKAN_TOOL ) disp_mass_shokan_tool();
	if( OPT_LETTERTRANSMISSION ) disp_lettertransmission();
	if( OPT_LETTERBROADCAST ) disp_letterbroadcast();
if(DEBUG_MESSAGE) console.log('開始：disp_letterpreservation()');if( OPT_LETTERPRESERVATION ) disp_letterpreservation();
	if( OPT_BRO3AUTO ) disp_bro3auto();
	if( OPT_DECK_TOOL ) disp_deck_tool();
	if( OPT_ALLIANCELEVEL ) disp_alliancelevel();
	if( OPT_CALCN_1KI ) disp_calcn();
	if( OPT_BUSHODAS_LITE ) disp_bushodas_lite();
if(DEBUG_MESSAGE) console.log('開始：disp_quest_collect()');if( OPT_QUEST_COLLECT ) disp_quest_collect();
if(DEBUG_MESSAGE) console.log('開始：disp_item_collect()');if( OPT_ITEM_COLLECT ) disp_item_collect();
if(DEBUG_MESSAGE) console.log('開始：disp_territory_remove()');if( OPT_TERRITORY_REMOVE ) disp_territory_remove();
if(DEBUG_MESSAGE) console.log('開始：Pika_installMapXYHelper()');if( OPT_PIKA_MAPHELP ) Pika_installMapXYHelper();//NPCを使用すると座標移動しない為、位置を下にしたfaraway110530
if(DEBUG_MESSAGE) console.log('開始：disp_bro3_etcs()');if( OPT_BRO3_ETCS ) disp_bro3_etcs();
if(DEBUG_MESSAGE) console.log('開始：disp_territory_name_change()');if( OPT_TERRITORY_NAME_CHANGE ) disp_territory_name_change();
if(DEBUG_MESSAGE) console.log('開始：disp_showtime()');if( OPT_SHOWTIME ) disp_showtime();
if(DEBUG_MESSAGE) console.log('開始：disp_quest_all()');if( OPT_QUEST_ALL ) disp_quest_all();
if(DEBUG_MESSAGE) console.log('開始：disp_gousei_skill()');if( OPT_GOUSEI_SKILL ) disp_gousei_skill();
	if( OPT_FAVORITE_TRADE ) disp_favorite_trade();
	if( OPT_ROUTE_VIEW ) disp_route_view();
	if( OPT_51CENTER_OFF ) map51_guide_off();
if(DEBUG_MESSAGE) console.log('開始：disp_bro3_dasu()');if( OPT_BRO3_DASU ) disp_bro3_dasu();
if(DEBUG_MESSAGE) console.log('開始：bro3_atk_calc()');if( OPT_ATK_CALC	 ){
	//スキル込計算スクリプト
	bro3_atk_calc();
}
	if( OPT_BRO3_MISC ) disp_bro3_misc();
	if( OPT_CREATE_UNIT_MASK ) disp_create_unit_mask();
	if( OPT_ADD_TROOP_RESERVE ) disp_add_troop_reserve_time();
	if( OPT_HISTANALYSIS )	HistAnalysis();		//24."武将ダス履歴抽出分析 Ver1.09"
if(DEBUG_MESSAGE) console.log('開始：QuestAssist()');if( OPT_QUESTASSIST  )	QuestAssist();		//25."クエスト補助"
	if( OPT_TRADEINCOME  )	TradeIncome();		//29."トレード収入計算"
	if( OPT_RESERVATION  )	Reservation();		//30."出兵予約"
if(DEBUG_MESSAGE) console.log('開始：AutoRound();');if( OPT_AUTOROUND	)	AutoRound();		//31."自動巡回"
if(DEBUG_MESSAGE) console.log('開始：ReportLog()');if( OPT_REPORTLOG	)	ReportLog();		//32."報告書・同盟ログCSV出力"
if(DEBUG_MESSAGE) console.log('開始：TradeStatus()');if( OPT_TRADESTATUS  )	TradeStatus();		//34."トレードステータス表示"
if(DEBUG_MESSAGE) console.log('開始：bro3_url_change_reverse_res_view()');
	if( OPT_URL_CHANGE_REV_RES	 )	bro3_url_change_reverse_res_view();	//掲示板逆順表示
// 設定なしで無条件実行するメソッド群
if(DEBUG_MESSAGE) console.log('開始：label_colorise();');	 label_colorise();	//ラベル着色
if(DEBUG_MESSAGE) console.log('開始：csortSideBox();'); 	 csortSideBox();
if(DEBUG_MESSAGE) console.log('開始：crenumberSideBox();');  crenumberSideBox();
if(DEBUG_MESSAGE) console.log('開始：Pika_blinkElements();');Pika_blinkElements();
if(DEBUG_MESSAGE) console.log('開始：bro3HighLightName();');bro3HighLightName();
if(OPT_DISPJST) {
	if(DEBUG_MESSAGE) console.log('開始：disp_jsttime();');disp_jsttime();
}
if(DEBUG_MESSAGE) console.log('開始：bro3HighLightName();');bro3HighLightName();
copy_protection_unlock();			// 一括保護解除画面のボタンを上にコピー 2014/09/22
disp_multiple_drop_territory();		// 一括領地破棄を領地管理画面に追加(2014/10/18 常時実行)
if(OPT_DELETECUSTOM) {
	allCardDeleteCustom();	// 一括破棄画面でトレードとかをできるようにする
}
if( OPT_MAPLINK ) {
	// 領地リンクのアイコンが折り返す問題を修正(2014/10/22 メンテ影響)
	$("beyond_sidebox_xylink_inner").setAttribute("class", "sideBoxInner basename");
}
if( OPT_REMOVELIST ) {
	$("beyond_sidebox_removelist").lastChild.setAttribute("class", "sideBoxInner basename");
}
if( OPT_RESERVE_VILLAGE ) {
	// 予約された建設の実行
	$("beyond_sidebox_reserve_villagelist").lastChild.setAttribute("class", "sideBoxInner basename");
	exec_reserve();
}

// 合成レシピを表示
if (OPT_ADD_SHOW_SKILL) {
	showRecipeSkill();
}

// 自動スキルレベルアップ
if (OPT_AUTO_SKILLUP) {
	autoSkillUp();
}

//////////////////////
//イメージ初期化
//////////////////////
var img_mura, img_map, img_naisei, img_ken, img_hanma, img_user, img_mail;
function initImages(){
	if( !OPT_LARGEICON ) {
	img_mura = 'data:image/gif;base64,'+'R0lGODlhCgAKAKIAAAAAAP/M/7Jlf2YAAMaAoLpxjceAoQAAACH5BAQUAP8ALAAAAAAKAAoAAAMd'+'CBDcumE0CeOcI2vJMunYYICgZDalwEFcQSkooyQAOw==';


	img_map = 'data:image/gif;base64,'+'R0lGODlhCgAKAJEAAAAAAP//zAAAmSAgGiH5BAQUAP8ALAAAAAAKAAoAAAIaBIJplz0hRItISojx'+'tbXuDn3ZFDANMhhnCRQAOw==';


	img_naisei = 'data:image/gif;base64,'+'R0lGODlhCgAKALMAAAAAAMPS5HWOi5kAZktYU7yw0BogILmjyMz//8LP4r641MXb6QAAAAAAAAAA'+'AAAAACH5BAQUAP8ALAAAAAAKAAoAAAQnEBiEBkUGgGsvqUMockgxKBWnDMewdKA1UkNwJTBMU9vl'+
		'CxofDxABADs=';

	img_ken = 'data:image/gif;base64,'+'R0lGODlhCgAKALMAAAAAALS0tE48PP///42NjTMzM+Li4nx8fBgAACYPD5mZmQkJCUZGRru7u+jo'+'6AAAACH5BAQUAP8ALAAAAAAKAAoAAAQkECBAq5C1qrEyIMPQUAMZllRwhtlinB4De+ExBFniFKQ3'+
		'+YAIADs=';
	img_hanma = 'data:image/gif;base64,'+'R0lGODlhCgAKAOYAAP////7+/v39/fz8/Pv7+/r6+vn5+fj4+Pb29vX19fLy8vHx8fDw8O/v7+/u'+
		'7u3t7ezs7Obm5uLi4tra2tbW1tTU1NPT09LR0cjIyLq6ura0tLKysrCwsKmoqI+JiWxsbGdmZlVV'+'VUpKSkhFRUFBQUJBQT8/Py4uLiwsLCgoKCQkJCMjIyIhISoaGhsbGxkZGRkYGBYWFhoWFhkVFRMT'+
		'EyQODhQSEiILCw4ODgsLCwoKCgkJCQcGBgkGBgYGBhgAABYAAAQEBAMDAwEBAQAAAAEAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
		'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5'+
		'BAQUAP8ALAAAAAAKAAoAAAdcgEQ3HiAoDwILJjRAMh0XDAgBCRkqRTYpAwCaBxE+REGZmgAFQUND'+'oqI7OEM+C5oEsAsnLzkWChAYHxINFCQ8LBUcISIlGxMPNT46LisxMSMaDkQ/RERC1zMtPYEAOw==';
	img_mail = 'data:image/gif;base64,'+'R0lGODlhCgAKAMQAAP///5mZmSoaGhoWFhkVFRMTEyQODiILCwsLCwYGBgcGBgkGBhgAABYAAAMD'+
		'AwEBAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAQU'+'AP8ALAAAAAAKAAoAAAUvIHREZBkVzWCuQQC8QEsGkRvXz3PL7pO8tNorgoAZARHFERYxLIcRBmTq'+
		'iBAEixAAOw==';
	img_user = 'data:image/gif;base64,'+'R0lGODlhCgAKANUAADMAAPr3s+vhKdKwHr6DEal3EPPvPYJCA+XUI/HsLPbwUcejG9m+Mvn3M9m8'+
		'IP//tfj4NvXxMe/oK///M969IfLuMbR4EdzFL86wHv//O+XXKf//u//3tY5JBPj0Ue3iLvTwQu3l'+'L9fCIda3IKp4ENnDL+DHIv///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
		'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAUUACcALAAAAAAKAAoAAAZTwNMp'+'oEgkFAHhEASpVCCgZMAgEFVCDomBCBkBNBqACFJsaAqfD0nTSAhMkYaz7RAoLJhMJJIZEBQbJQcL'+
		'EhIjHRcbJw8XFgQEFgwPShseCAiAQkEAOw==';
	}else{
	img_mura = 'data:image/gif;base64,'+'R0lGODlhDgAOAOYAAAAAAP///+Hz/gid8Ame8gmg8gmb7wmc7wqe8gqg8gqb7wqc7wug8gud7wyh'+
		'8gyd7w2i8w2g8g2d7w2d7g6e8A6d7w6e7w6c7g6d7hCg8g+d7w+e7w+d7hWg7hag7huP0RyQ0h2Q'+'0h+V1iWq8yaq8yiq9Cis9AorPSms9QoqPCqs9Syu9QsrPS6v9S6t9C+t9DGv9TGw9TOw9Taw9EW3'+
		'9ke39ki49mbE+IXQ+YbQ+aLb+qPb+6Pc+8Ln/MTo/ODz/uL0/guh8g+j8xGj8iCa1yit9Cmt9Cuu'+'9C6v9DOx9TSz9Ue59ki59km69sLo/MTp/ODz/f///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
		'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5'+
		'BAEAAFEALAAAAAAOAA4AAAeXgCkfHBZDK0IQLQ4LFx8pIB4WQUw4Kig5NggKHSAcGBVHPDcoKDc7'+'JQYTHBwXD0hAP7GxJQcYGBwNCU0/Ab0BPzUIEhwPCUtOvr49NQQVB0Y8yck6JBUVDEy80sARGxgD'+
		'RdrJUCMUhAVL4r4/NBkbFSbI0r09LxoWJurJAi4bIElPgAgcKNDHjBAsiCiJwZAhjIcyRJwIBAA7';

	img_map = 'data:image/gif;base64,'+'R0lGODlhDgAOAMQAAKmLAeHXp76oQP38+My7arSaIe/pz9jKi8SvUeffuK6SEdTFf7mhMci0XPTw'+
		'39zPl+Tbr8OuTcq4ZN7SnOniv72mPf///8++ccm3YdTFgP///wAAAAAAAAAAAAAAAAAAACH5BAEA'+'ABoALAAAAAAOAA4AAAVCoAaMZDmKZqqu5EIRVUUqWEkJl6XvkL2POkCmNPkBgpdS8gi0AA6lnfOX'+
		'qDWlOoegN0IMKCRBgRGxsgwPAyuFWmtCADs=';
	img_naisei = 'data:image/gif;base64,'+'R0lGODlhDgAOAOYAAAAAAP///zEwMTAvMC8uLy4tLiwrLCsqKzw7PH9+fysrLImKiSkpKCgoJyYm'+
		'JTk5OE5OTdvb2dfX1Xp6eXd3dnV1dGZmZWJiYebm5eLi4d7e3dra2dfX1tTU09PT0tHR0M/Pzs7O'+	'zc3NzMTEw8PDwsDAv7e3tqOjopKSkff29eLh4NnY19PS0dHQz83My8rJyMfGxcPCwcLBwMC/vr++'+
		'vSkoKCYlJSUkJCsqKjQzM0xLS9DOzsnHx3t6enV0dHRzc1taWuTj4+Hg4N/e3t3c3Nva2tbV1dXU'+	'1NTT09LR0dHQ0NDPz8/OzsvKysnIyMjHx8HAwMC/v6Cfn9zc3MnJycXFxb+/v729vZ+fn5aWloWF'+
		'hXNzc3FxcWpqalxcXFpaWlZWVlBQUE5OTkdHR0BAQDo6Ojg4ODc3NzExMTAwMC8vLy4uLi0tLSws'+	'LCsrKygoKCcnJyYmJiUlJSQkJCMjIyIiIiAgIB8fHx4eHv///wAAAAAAAAAAAAAAAAAAAAAAACH5'+
		'BAEAAHkALAAAAAAOAA4AAAewgAKCA4SFhGkDggJuYAkUFT9cPhByBYpzCykYGRpFQhN4bIptZEVE'+	'RkkfPA9yBopqa1hEK0cfKDUNboppcBcvJCUzX3UMB4psZh8RIU1LVmhxxoJtZR4bHS0gUDkOOKNn'+
		'IFMsTEpXaTYKrzdeIUQcJF93b66CdBYnWls9WFJidziJCAApEkTEmC5JXEDRYSfRABMqkLCAUeVJ'+	'DCdZ7BAYgGCIBBY7QlAZIYNGlDBsAgEAOw==';

	img_ken = 'data:image/gif;base64,'+'R0lGODlhDgAOAMQAAP9MH/9lP/9AEP9ZMP9/X/+Zf/+yn/+lj//Zz//y7/9zUP+AYP+/r/+Lbv/P'+
		'w//q5f+fh//s5/9jPP+NcP/l3//Mv/////8zAP///wAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEA'+'ABgALAAAAAAOAA4AAAVCIHaNZDmKZqkYqVlZQEsORCBX1YLIhWVRstHB9wheDC8LApiC+HwES+og'+
		'uAAsCcNAcUMIfJVUVEoKpyjMUZWEMmJCADs=';

	img_hanma = 'data:image/gif;base64,'+'R0lGODlhDgAOALMAAAAAAP///8zMzL+/v5mZmWZmZjIyMiYmJgwMDP///wAAAAAAAAAAAAAAAAAA'+
		'AAAAACH5BAEAAAkALAAAAAAOAA4AAARF0Eg5yLxTEFE1lkIYCEGBEUMoBqyQqSQ7WlQ4mLFnDKPO'+'tyYeifYLEUc3AylkkrR6I+Qr2krRJISWqnlBFQId7kdgEhsiADs=';
	img_mail = 'data:image/gif;base64,'+'R0lGODlhDgAOANUAAP////n6+u3t7ezs7Ojo6Kurq6ampqWkpKCgoJ6enpaWloeHh4SEhHV1dWhn'+
		'Z2dmZioqKiodHR8eHh0cHBsaGiEUFBYTExMTExMSEh4NDRwKChsJCRoICAoKCgcHBwkGBhIDAwUF'+'BQUGBhMAAAYEBBIAAAMDAxEAAAICAgQCAgEBAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
		'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAQUAP8ALAAAAAAOAA4AAAZxwNVm'+'s1qxjkiW53I6FZ/Qoud0GACu2OvgUOQmrNhBYnU4Ah4URVZBcQBUKsBhglkIBAvM5PCOAwwTEwwM'+
		'EhIGVyohVwQIEEUQCARXLB1YAQUNDQUBWJRZn50ioKAsGaOfKxqnWSkpIyNQJiskFhEVH0EAOw==';
	img_user = 'data:image/gif;base64,'+'R0lGODlhDgAOAPcAAP7+v/3+vf39vf3+ofz6vvz9ofz5u/v8ofn2nv//O/3/Ofn3av76Nfn2af36'+
		'Nf75Nfj6Nvj5Nvj4N/n1U/fzaff4N/f4NPf4Lvfzavf1TPj0Tff3Lvb1NPX0NPb1LfXzNPXwTvXw'+'VPXwTfXyNPXyM/XuUPTyNPTyM/TxNPTwPPTwMvTwMfTvPfTvPPPxM/PwMPPwLvPvPfPvMvPwM/Pu'+
		'MvPuMPPuLfLtPfLuNfLuM/LuMvLuLvPtMfLtNfLtM/LtMfLtMPHtMvHsM/HsMfLsLfLsMPLsMfHp'+'LPDqKvHqLPDoLu7oLu/nLO3jK/HgNergK+rgKevfK+reKereKuvaM+bWJ+TRJOfOJOTOI+TJLN/K'+
		'IuHCIN3AK9/BH+G/IN6/K+C+H92+IN++INq9Ida1H9W0J9ayHNWxHM+xH8uqHc2kGs2jGs+iF8ug'+'GNGeGNCeGMmdF8WRE8SPFcSOFL+FFLt9ELp9EL59EKt0DKRyDKFwC6NpC4hdC4pVCoZQCpNFAJVE'+
		'AHtGCIVBB4A5AHk3BnozADQbAjQOADQOASkQAP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
		'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
		'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+
		'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAUUAIoALAAAAAAOAA4A'+'AAjGABUJJEABBxEiPSgQEMgQQYgUOiLqaBECQcMbMC5wGDLEgoUdNywaAAEDChgsLlyECbPEhggD'+
		'GFhsEJOIDwMGgQxd8RADAw4cEbYg8uPAQZ9DXSCgQHHwwxM3Z0iQMPNmygggQJJYiaKiq9euVbQc'+'EdKmjZIKJowYMSGhSRw4PhZ8GYQmQQcZeBWQAcRlgQANegilkVKjBpMxgvBkCKDogJM8he6sWTPn'+
		'zx4qBRgemJBFTp06dMqUGMBQIIAFOZAgCdIAAMOAADs=';
	}
}
//////////////////////
//スタイル初期化
//////////////////////
function initStyle()
{
		GM_addStyle("span.beyond_panel_ctlbox {width:35px; height:14px; display:block; position:absolute; right:-5px; top:-4px; }" +
					"span.beyond_panel_ctlbox img {width:8px;height:9px; float:right; }" +
					"div#beyond_basepanel img{vertical-align:middle; margin:1px 1px 1px 0px; padding-left:2px}" +
					 "#beyond_basepanel fieldset{border:groove 1px black; margin:1px; padding:1px;}"
					);
}

//////////////////////
//リソース変数初期化
//////////////////////
function initResources()
{
	var nowNodes = PRE_LOAD_NODES['nowResources'];
	var names = ['wood','stone','iron','rice'];
	for (var i=0; i <names.length;i++) {
		var name = names[i];
		RES_NOW[name] = parseInt( nowNodes[name].innerHTML, 10 );
		RES_MAX[name] = parseInt( $(name+'_max').innerHTML, 10 );
		RES_GROW[name] = parseInt( $('output_'+name).innerHTML, 10 );
	}

	var spns = $a('(id("sidebar") | id("status_left")//p[@class="status_bottom"])//span[@class="increase" or @class="resource"]');
	for(var i=0 ; i<spns.length ; i++) {
		var str = spns[i].previousSibling.nodeValue.match(/(木|石|鉄|糧)\s+(-?\d+)/);
		if( str ) {
			var name = "";
			switch( str[1] ) {
			case "木":
				name = 'wood';
				break;
			case "石":
				name = 'stone';
				break;
			case "鉄":
				name = 'iron';
				break;
			case "糧":
				name = 'rice';
				break;
			}
			RES_GROW_W[name] = parseInt(str[2], 10);
			RES_GROW_B[name] = parseInt(spns[i].innerHTML, 10);
		}
	}

	//名声
	RES_NOW["fame"] = 0;
	RES_MAX["fame"] = 0;
	//var fameText = $x('id("status_left")/img[contains(@src,"ico_fame.gif")]').nextSibling;
	var fameText = $x('id("status_resources")//li[5]/img[contains(@src, "ico_fame.gif")]').nextSibling;

	if( fameText ) {
		var tmp = fameText.nodeValue.match(/\s*(\d+)\s*\/\s*(\d+)/);
		RES_NOW["fame"] = parseInt(tmp[1],10);
		RES_MAX["fame"] = parseInt(tmp[2],10);
	}
}


//////////////////////
//ベースパネル初期化
//////////////////////
function initPanel()
{
	var panelBox = $("sidebar");
	if (isNarrow) {
		var panelBoxWrapper = $x('id("wrapper")');

		if (!panelBoxWrapper) return false;

		panelBox = d.createElement("div");
		panelBox.id = "sidebar";
		panelBox.style.width = "auto";
		panelBox.style.cssFloat = "left";
		panelBox.style.marginTop = "10px";

		panelBoxWrapper.appendChild(panelBox);
	}

	if( !panelBox ) return false;


	var basepanel = d.createElement("div");
	basepanel.id = "beyond_basepanel";

	var fixpanel = d.createElement("div");
	fixpanel.id = "beyond_fixpanel";
	var floatpanel = d.createElement("div");
	floatpanel.id = "beyond_floatpanel";
	var tmppanel = d.createElement("div");
	tmppanel.id = "beyond_tmp";
	tmppanel.style.display = "none";

	basepanel.appendChild(fixpanel);
	basepanel.appendChild(floatpanel);
	basepanel.appendChild(tmppanel);

	panelBox.appendChild(basepanel);

	return true;
}


//////////////////////
//オプション処理
//////////////////////
function disp_Options()
{
	if( !location.pathname.match(/^(\/user\/|\/bbs\/personal_)/) ) return;

	if( location.pathname.match(/ranking\.php/) ) return;
	var ul = $("statMenu");
	if( !ul ) return;

	var cl = d.createElement("a");
	cl.href = "javascript:void(0);";
	cl.innerHTML = "Beyond";	//faraway120119
	$e(cl, "click", function() {openOptions();});

	var li = d.createElement("li");
	li.appendChild(cl);
	li.className = "last";
	ul.appendChild(li);

	var lst = $x("//li[@class=\"last\"]");
	if( lst ) {
		lst.className = "";
	}


}

function loadOptions()
{
	OPT_REPORTLOG	 = cloadData( "OPT_REPORTLOG"	, 1 );	//"報告書・同盟ログCSV出力"
	OPT_AUTOROUND	 = cloadData( "OPT_AUTOROUND"	, 1 );	//"自動巡回"
	OPT_RESERVATION   = cloadData( "OPT_RESERVATION"  , 1 );	//"出兵予約"
	OPT_TRADESTATUS   = cloadData( "OPT_TRADESTATUS"  , 0 );	//"トレードステータス表示"
	OPT_TRADEINCOME   = cloadData( "OPT_TRADEINCOME"  , 1 );	//"トレード収入計算"
	OPT_HISTANALYSIS  = cloadData( "OPT_HISTANALYSIS" , 1 );	//"武将ダス履歴抽出分析 Ver1.09"
	OPT_QUESTASSIST   = cloadData( "OPT_QUESTASSIST"  , 1 );	//"クエスト補助"
	OPT_URL_CHANGE	= cloadData( "OPT_URL_CHANGE"	, 1 );	//URLリンク変更スクリプト
	OPT_URL_CHANGE_REV_RES	= cloadData( "OPT_URL_CHANGE_REV_RES"	, 1 );	//掲示板逆順表示
	OPT_ATK_CALC	  = cloadData( "OPT_ATK_CALC"	 , 0 );	//スキル込計算スクリプト
	OPT_DISPJST	= cloadData( "OPT_DISPJST"	 , 1 );	//掲示板逆順表示
	OPT_TIMER = cloadData( "OPT_TIMER", 0 );
	OPT_ALLIANCE = cloadData( "OPT_ALLIANCE", 1 );
	OPT_DEVELOPMENT = cloadData( "OPT_DEVELOPMENT", 1 );
	OPT_STATISTICS = cloadData( "OPT_STATISTICS", 1 );
	OPT_ALLIANCELOG = cloadData( "OPT_ALLIANCELOG", 1 );
	OPT_NPCFORT = cloadData( "OPT_NPCFORT", 1 );
	OPT_RIGHTCLICK = cloadData( "OPT_RIGHTCLICK", 1 );
	OPT_ALLIANCELEVEL = cloadData( "OPT_ALLIANCELEVEL", 0 );
	OPT_MISTAKEPREVENTION = cloadData( "OPT_MISTAKEPREVENTION", 1 );
	OPT_LETTERTRANSMISSION = cloadData( "OPT_LETTERTRANSMISSION", 1);
	OPT_LETTERBROADCAST = cloadData( "OPT_LETTERBROADCAST", 1 );
	OPT_LETTERPRESERVATION = cloadData( "OPT_LETTERPRESERVATION", 1 );
	OPT_TRADINGRETRIEVAL = cloadData( "OPT_TRADINGRETRIEVAL", 1 );
	OPT_TRADINGAFTER = cloadData( "OPT_TRADINGAFTER", 1 );
	OPT_NAVIGATIONADDITION = cloadData( "OPT_NAVIGATIONADDITION", 1 );
	OPT_BRO3AUTO = cloadData( "OPT_BRO3AUTO", 1 );
	OPT_CHANGE_MOVE_SIZE = cloadData( "OPT_CHANGE_MOVE_SIZE", 1 );
	OPT_DISPLAY_ADM_INFO = cloadData( "OPT_DISPLAY_ADM_INFO", 1 );
	OPT_MASS_SHOKAN_TOOL = cloadData( "OPT_MASS_SHOKAN_TOOL", 1 );
	OPT_DECK_TOOL = cloadData( "OPT_DECK_TOOL", 0 );
	OPT_CALCN_1KI = cloadData( "OPT_CALCN_1KI", 1 );
	OPT_BUSHODAS_LITE = cloadData( "OPT_BUSHODAS_LITE", 1 );
	OPT_QUEST_COLLECT = cloadData( "OPT_QUEST_COLLECT", 1 );
	OPT_ITEM_COLLECT = cloadData( "OPT_ITEM_COLLECT", 1 );
	OPT_TERRITORY_REMOVE = cloadData( "OPT_TERRITORY_REMOVE", 1 );
	OPT_B3NEWS = cloadData( "OPT_B3NEWS", 0 );
	OPT_VILLAGE = cloadData( "OPT_VILLAGE", 1 );
	OPT_BASELINK = cloadData( "OPT_BASELINK", 1 );
	OPT_MAPLINK = cloadData( "OPT_MAPLINK", 1 );
	OPT_XYLINK = cloadData( "OPT_XYLINK", 1 );
	OPT_XYLINK_NK = cloadData( "OPT_XYLINK_NK", 1 );
	OPT_LARGEICON = cloadData( "OPT_LARGEICON", 0 );
	OPT_TTBL = cloadData( "OPT_TTBL", 1 );
	OPT_MEMO = cloadData( "OPT_MEMO", 1 );
	OPT_MEMO_FONT_SIZE = cloadData( "OPT_MEMO_FONT_SIZE", "9" );
	OPT_MEMO_WIDTH = cloadData( "OPT_MEMO_WIDTH", "21" );
	OPT_MEMO_HEIGHT = cloadData( "OPT_MEMO_HEIGHT", "5" );
	OPT_MEMO_COUNT = cloadData( "OPT_MEMO_COUNT", "1" );
	OPT_MAPLINK_FONT_SIZE = cloadData( "OPT_MAPLINK_FONT_SIZE", "9" );
	OPT_DETAILS = cloadData( "OPT_DETAILS", 1 );
	OPT_DETAILS_UP = cloadData( "OPT_DETAILS_UP", 1 );
	OPT_CTIME_B = cloadData( "OPT_CTIME_B", 1 );
	OPT_CTIME_U = cloadData( "OPT_CTIME_U", 1 );
	OPT_ALLY = cloadData( "OPT_ALLY", 1 );
	OPT_ALLY_IS = cloadData( "OPT_ALLY_IS", 1 );
	OPT_ALLY_XY = cloadData( "OPT_ALLY_XY", 1 );
	OPT_ALLY_CSV = cloadData( "OPT_ALLY_CSV", 1 );
	OPT_RES_T = cloadData( "OPT_RES_T", 1 );
	OPT_RES_TIME = cloadData( "OPT_RES_TIME", 1 );
	OPT_REMOVELIST = cloadData( "OPT_REMOVELIST", 1 );
	OPT_MAPLIST = cloadData( "OPT_MAPLIST", 0 );
	OPT_TTDISTANCE = cloadData( "OPT_DISTANCE", 1 );
	OPT_TTDISTANCE_ITEMS = cloadData("OPT_DISTANCE_ITEMS", "[\"剣兵(6)\", \"盾兵(4)\", \"槍兵(7)\", \"弓兵(5)\", \"騎兵(12)\", \"斥候(9)\", \"衝車(3)\", \"大剣(8)\", \"重盾(7)\", \"矛槍(10)\", \"弩兵(9)\", \"近衛(15)\", \"投石(6)\", \"斥騎(20)\"]", true, true);
	OPT_TTALLYPRSN = cloadData( "OPT_TTALLYPRSN", 1 );
	OPT_USER_STAR = cloadData( "OPT_USER_STAR", 1 );
	OPT_USER_LEVEL = cloadData( "OPT_USER_LEVEL", 1 );
	OPT_MAPCENTER = cloadData( "OPT_MAPCENTER", 1 );
	OPT_TSENDTIME = cloadData( "OPT_TSENDTIME", 1 );
	OPT_SMALLBTN = cloadData( "OPT_SMALLBTN", 0 );
	OPT_ATTACKMAP = cloadData( "OPT_ATTACKMAP", 1 );
	OPT_PIKA_YOROZU = cloadData( "OPT_PIKA_YOROZU", 0 );
	OPT_PIKA_HPREST = cloadData( "OPT_PIKA_HPREST", 1 );
	OPT_PIKA_MAPHELP = cloadData( "OPT_PIKA_MAPHELP", 1 );
	OPT_PIKA_TRDHELP = cloadData( "OPT_PIKA_TRDHELP", 1 );
	OPT_PIKA_BLINKBLD = cloadData( "OPT_PIKA_BLINKBLD", 1 );
	OPT_SUZAN_SEISAN = cloadData( "OPT_SUZAN_SEISAN", 1 );
	OPT_RESERVE_VILLAGE = cloadData( "OPT_RESERVE_VILLAGE", 1 );
	OPT_CASTLE_AID = cloadData( "OPT_CASTLE_AID", 1 );
	OPT_NEXT_MEISEI = cloadData( "OPT_NEXT_MEISEI", 1 );
	if (isNarrow) {
		OPT_VILLAGE_LIST_BOX = cloadData( "OPT_VILLAGE_LIST_BOX", 0 );
	}
	OPT_BRO3_ETCS = cloadData( "OPT_BRO3_ETCS", 1 );
	OPT_BRO3_DASU = cloadData( "OPT_BRO3_DASU", 1);
	OPT_BRO3_MISC = cloadData( "OPT_BRO3_MISC", 1);
	OPT_CREATE_UNIT_MASK = cloadData( "OPT_CREATE_UNIT_MASK", 1);
	OPT_ADD_TROOP_RESERVE = cloadData( "OPT_ADD_TROOP_RESERVE", 1);
	OPT_TERRITORY_NAME_CHANGE = cloadData( "OPT_TERRITORY_NAME_CHANGE", 1 );
	OPT_SHOWTIME = cloadData( "OPT_SHOWTIME", 1 );
	OPT_QUEST_ALL = cloadData( "OPT_QUEST_ALL", 1 );
	OPT_FAVORITE_TRADE = cloadData( "OPT_FAVORITE_TRADE", 1 );
	OPT_ROUTE_VIEW = cloadData( "OPT_ROUTE_VIEW", 1 );
	OPT_51CENTER_OFF = cloadData( "OPT_51CENTER_OFF", 0 );
	OPT_GOUSEI_SKILL = cloadData( "OPT_GOUSEI_SKILL", 1 );
	OPT_STYLE = cloadData( "OPT_STYLE",0);
	OPT_FAMEPOS = cloadData( "OPT_FAMEPOS",1);
	DISP_RANK = cloadData( "DISP_RANK",1);
	OPT_DELETECUSTOM = cloadData( "OPT_DELETECUSTOM",1);
	OPT_L_CHANGE = cloadData( "OPT_L_CHANGE", 0 ); // 見た目を全部Lに置き換えるアホツール
	OPT_UR_CHANGE = cloadData( "OPT_UR_CHANGE", 0 ); // 見た目を全部URに置き換えるアホツール
	OPT_SR_CHANGE = cloadData( "OPT_SR_CHANGE", 1 ); // 見た目を全部SRに置き換えるアホツール //ac.42.a
	OPT_PR_CHANGE = cloadData( "OPT_PR_CHANGE", 0 ); // 見た目を全部PRに置き換えるアホツール
	OPT_HR_CHANGE = cloadData( "OPT_HR_CHANGE", 0 ); // 見た目を全部HRに置き換えるアホツール
	OPT_AR_CHANGE = cloadData( "OPT_AR_CHANGE", 0 ); // 見た目を全部URに置き換えるアホツール
	OPT_BR_CHANGE = cloadData( "OPT_BR_CHANGE", 0 ); // 見た目を全部SRに置き換えるアホツール
	OPT_ADD_SHOW_SKILL = cloadData( "OPT_ADD_SHOW_SKILL",1);   // 合成確率アップ素材のスキル表示
	OPT_AUTO_SKILLUP = cloadData( "OPT_AUTO_SKILLUP",0);	   // 自動連続スキルアップ
}
function saveOptions()
{
	OPT_REPORTLOG	 = cgetCheckBoxValue("OPT_REPORTLOG");		//"報告書・同盟ログCSV出力"
	OPT_AUTOROUND	 = cgetCheckBoxValue("OPT_AUTOROUND");		//"自動巡回"
	OPT_RESERVATION   = cgetCheckBoxValue("OPT_RESERVATION");	//"出兵予約"
	OPT_TRADESTATUS   = cgetCheckBoxValue("OPT_TRADESTATUS");	//"トレードステータス表示"
	OPT_TRADEINCOME   = cgetCheckBoxValue("OPT_TRADEINCOME");	//"トレード収入計算"
	OPT_HISTANALYSIS  = cgetCheckBoxValue("OPT_HISTANALYSIS");	//"武将ダス履歴抽出分析 Ver1.09"
	OPT_QUESTASSIST   = cgetCheckBoxValue("OPT_QUESTASSIST");	//"クエスト補助"
	OPT_URL_CHANGE	= cgetCheckBoxValue( "OPT_URL_CHANGE");	//URLリンク変更スクリプト
	OPT_URL_CHANGE_REV_RES	= cgetCheckBoxValue( "OPT_URL_CHANGE_REV_RES");	//URLリンク変更スクリプト
	OPT_ATK_CALC	  = cgetCheckBoxValue( "OPT_ATK_CALC"  );	//スキル込計算スクリプト
	OPT_DISPJST	= cgetCheckBoxValue( "OPT_DISPJST");	//URLリンク変更スクリプト
	OPT_DELETECUSTOM	= cgetCheckBoxValue( "OPT_DELETECUSTOM");	//一括破棄画面拡張

	OPT_TIMER = cgetCheckBoxValue("OPT_TIMER");
	OPT_ALLIANCE = cgetCheckBoxValue("OPT_ALLIANCE");
	OPT_DEVELOPMENT = cgetCheckBoxValue("OPT_DEVELOPMENT");
	OPT_STATISTICS = cgetCheckBoxValue("OPT_STATISTICS");
	OPT_ALLIANCELOG = cgetCheckBoxValue("OPT_ALLIANCELOG");
	OPT_NPCFORT = cgetCheckBoxValue("OPT_NPCFORT");
	OPT_RIGHTCLICK = cgetCheckBoxValue("OPT_RIGHTCLICK");
	OPT_ALLIANCELEVEL = cgetCheckBoxValue("OPT_ALLIANCELEVEL");
	OPT_MISTAKEPREVENTION = cgetCheckBoxValue("OPT_MISTAKEPREVENTION");
	OPT_LETTERTRANSMISSION = cgetCheckBoxValue("OPT_LETTERTRANSMISSION");
	OPT_LETTERBROADCAST = cgetCheckBoxValue("OPT_LETTERBROADCAST");
	OPT_LETTERPRESERVATION = cgetCheckBoxValue("OPT_LETTERPRESERVATION");
	OPT_TRADINGRETRIEVAL = cgetCheckBoxValue("OPT_TRADINGRETRIEVAL");
	OPT_TRADINGAFTER = cgetCheckBoxValue("OPT_TRADINGAFTER");
	OPT_NAVIGATIONADDITION = cgetCheckBoxValue("OPT_NAVIGATIONADDITION");
	OPT_BRO3AUTO = cgetCheckBoxValue("OPT_BRO3AUTO");
	OPT_CHANGE_MOVE_SIZE = cgetCheckBoxValue("OPT_CHANGE_MOVE_SIZE");
	OPT_DISPLAY_ADM_INFO = cgetCheckBoxValue("OPT_DISPLAY_ADM_INFO");
	OPT_MASS_SHOKAN_TOOL = cgetCheckBoxValue("OPT_MASS_SHOKAN_TOOL");
	OPT_DECK_TOOL = cgetCheckBoxValue("OPT_DECK_TOOL");
	OPT_CALCN_1KI = cgetCheckBoxValue("OPT_CALCN_1KI");
	OPT_BUSHODAS_LITE = cgetCheckBoxValue("OPT_BUSHODAS_LITE");
	OPT_QUEST_COLLECT = cgetCheckBoxValue("OPT_QUEST_COLLECT");
	OPT_ITEM_COLLECT = cgetCheckBoxValue("OPT_ITEM_COLLECT");
	OPT_TERRITORY_REMOVE = cgetCheckBoxValue("OPT_TERRITORY_REMOVE");
	OPT_B3NEWS = cgetCheckBoxValue("OPT_B3NEWS");
	OPT_VILLAGE = cgetCheckBoxValue("OPT_VILLAGE");
	OPT_BASELINK = cgetCheckBoxValue("OPT_BASELINK");
	OPT_MAPLINK = cgetCheckBoxValue("OPT_MAPLINK");
	OPT_XYLINK = cgetCheckBoxValue("OPT_XYLINK");
	OPT_XYLINK_NK = cgetCheckBoxValue("OPT_XYLINK_NK");
	OPT_LARGEICON = cgetCheckBoxValue("OPT_LARGEICON");
	OPT_TTBL = cgetCheckBoxValue("OPT_TTBL");
	OPT_MEMO = cgetCheckBoxValue("OPT_MEMO");
	OPT_MEMO_FONT_SIZE = cgetTextBoxValue("OPT_MEMO_FONT_SIZE");
	OPT_MEMO_WIDTH = cgetTextBoxValue("OPT_MEMO_WIDTH");
	OPT_MEMO_HEIGHT = cgetTextBoxValue("OPT_MEMO_HEIGHT");
	OPT_MEMO_COUNT = cgetTextBoxValue("OPT_MEMO_COUNT");
	OPT_MAPLINK_FONT_SIZE = cgetTextBoxValue("OPT_MAPLINK_FONT_SIZE");
	OPT_DETAILS = cgetCheckBoxValue("OPT_DETAILS");
	OPT_DETAILS_UP = cgetCheckBoxValue("OPT_DETAILS_UP");
	OPT_CTIME_B = cgetCheckBoxValue("OPT_CTIME_B");
	OPT_CTIME_U = cgetCheckBoxValue("OPT_CTIME_U");
	OPT_ALLY = cgetCheckBoxValue("OPT_ALLY");
	OPT_ALLY_IS = cgetCheckBoxValue("OPT_ALLY_IS");
	OPT_ALLY_XY = cgetCheckBoxValue("OPT_ALLY_XY");
	OPT_ALLY_CSV = cgetCheckBoxValue("OPT_ALLY_CSV");
	OPT_RES_T = cgetCheckBoxValue("OPT_RES_T");
	OPT_RES_TIME = cgetCheckBoxValue("OPT_RES_TIME");
	OPT_REMOVELIST = cgetCheckBoxValue("OPT_REMOVELIST");
	OPT_MAPLIST = cgetCheckBoxValue("OPT_MAPLIST");
	OPT_TTDISTANCE = cgetCheckBoxValue("OPT_DISTANCE");
	OPT_TTDISTANCE_ITEMS = getDistanceBox(14);
	OPT_TTALLYPRSN = cgetCheckBoxValue("OPT_TTALLYPRSN");
	OPT_USER_STAR = cgetCheckBoxValue("OPT_USER_STAR");
	OPT_USER_LEVEL = cgetCheckBoxValue("OPT_USER_LEVEL");
	OPT_MAPCENTER = cgetCheckBoxValue("OPT_MAPCENTER");
	OPT_TSENDTIME = cgetCheckBoxValue("OPT_TSENDTIME");
	OPT_SMALLBTN = cgetCheckBoxValue("OPT_SMALLBTN");
	OPT_ATTACKMAP = cgetCheckBoxValue("OPT_ATTACKMAP");
	OPT_PIKA_YOROZU = cgetCheckBoxValue("OPT_PIKA_YOROZU");
	OPT_PIKA_HPREST = cgetCheckBoxValue("OPT_PIKA_HPREST");
	OPT_PIKA_MAPHELP = cgetCheckBoxValue("OPT_PIKA_MAPHELP");
	OPT_PIKA_TRDHELP = cgetCheckBoxValue("OPT_PIKA_TRDHELP");
	OPT_PIKA_BLINKBLD = cgetCheckBoxValue("OPT_PIKA_BLINKBLD");
	OPT_SUZAN_SEISAN = cgetCheckBoxValue("OPT_SUZAN_SEISAN");
	OPT_RESERVE_VILLAGE = cgetCheckBoxValue("OPT_RESERVE_VILLAGE");

	OPT_CASTLE_AID = cgetCheckBoxValue("OPT_CASTLE_AID");
	OPT_NEXT_MEISEI = cgetCheckBoxValue("OPT_NEXT_MEISEI");
	if (isNarrow) {
		OPT_VILLAGE_LIST_BOX = cgetCheckBoxValue( "OPT_VILLAGE_LIST_BOX");
	}
	OPT_BRO3_ETCS = cgetCheckBoxValue("OPT_BRO3_ETCS");
	OPT_BRO3_DASU = cgetCheckBoxValue("OPT_BRO3_DASU");
	OPT_BRO3_MISC = cgetCheckBoxValue("OPT_BRO3_MISC");
	OPT_CREATE_UNIT_MASK = cgetCheckBoxValue("OPT_CREATE_UNIT_MASK");
	OPT_ADD_TROOP_RESERVE = cgetCheckBoxValue("OPT_ADD_TROOP_RESERVE");
	OPT_TERRITORY_NAME_CHANGE = cgetCheckBoxValue("OPT_TERRITORY_NAME_CHANGE");
	OPT_SHOWTIME = cgetCheckBoxValue("OPT_SHOWTIME");
	OPT_QUEST_ALL = cgetCheckBoxValue("OPT_QUEST_ALL");
	OPT_FAVORITE_TRADE = cgetCheckBoxValue("OPT_FAVORITE_TRADE");
	OPT_ROUTE_VIEW = cgetCheckBoxValue("OPT_ROUTE_VIEW");
	OPT_51CENTER_OFF = cgetCheckBoxValue("OPT_51CENTER_OFF");
	OPT_GOUSEI_SKILL = cgetCheckBoxValue("OPT_GOUSEI_SKILL");

	OPT_STYLE = cgetCheckBoxValue("OPT_STYLE");
	OPT_FAMEPOS = cgetCheckBoxValue("OPT_FAMEPOS");
	DISP_RANK = cgetCheckBoxValue("DISP_RANK");

	OPT_L_CHANGE = cgetCheckBoxValue("OPT_L_CHANGE"); // 見た目を全部Lに置き換えるアホツール
	OPT_UR_CHANGE = cgetCheckBoxValue("OPT_UR_CHANGE"); // 見た目を全部URに置き換えるアホツール
	OPT_SR_CHANGE = cgetCheckBoxValue("OPT_SR_CHANGE"); // 見た目を全部SRに置き換えるアホツール
	OPT_PR_CHANGE = cgetCheckBoxValue("OPT_PR_CHANGE"); // 見た目を全部PRに置き換えるアホツール
	OPT_HR_CHANGE = cgetCheckBoxValue("OPT_HR_CHANGE"); // 見た目を全部HRに置き換えるアホツール
	OPT_AR_CHANGE = cgetCheckBoxValue("OPT_AR_CHANGE"); // 見た目を全部URに置き換えるアホツール
	OPT_BR_CHANGE = cgetCheckBoxValue("OPT_BR_CHANGE"); // 見た目を全部SRに置き換えるアホツール
	OPT_ADD_SHOW_SKILL = cgetCheckBoxValue( "OPT_ADD_SHOW_SKILL");	 // 合成確率アップ素材のスキル表示
	OPT_AUTO_SKILLUP = cgetCheckBoxValue( "OPT_AUTO_SKILLUP");	 // 合成自動スキルアップ

	csaveData("OPT_REPORTLOG",	OPT_REPORTLOG	);	//"報告書・同盟ログCSV出力"
	csaveData("OPT_AUTOROUND",	OPT_AUTOROUND	);	//"自動巡回"
	csaveData("OPT_RESERVATION",  OPT_RESERVATION  );	//"出兵予約"
	csaveData("OPT_TRADESTATUS",  OPT_TRADESTATUS  );	//"トレードステータス表示"
	csaveData("OPT_TRADEINCOME",  OPT_TRADEINCOME  );	//"トレード収入計算"
	csaveData("OPT_HISTANALYSIS", OPT_HISTANALYSIS );	//"武将ダス履歴抽出分析 Ver1.09"
	csaveData("OPT_QUESTASSIST",  OPT_QUESTASSIST  );	//"クエスト補助"
	csaveData("OPT_URL_CHANGE",   OPT_URL_CHANGE);	//URLリンク変更スクリプト
	csaveData("OPT_URL_CHANGE_REV_RES",   OPT_URL_CHANGE_REV_RES);	//URLリンク変更スクリプト
	csaveData("OPT_ATK_CALC",	 OPT_ATK_CALC  );	//スキル込計算スクリプト
	csaveData("OPT_DISPJST",   OPT_DISPJST);	//JST表示
	csaveData("OPT_DELETECUSTOM",	OPT_DELETECUSTOM);	//一括破棄画面拡張

	csaveData( "OPT_TIMER", OPT_TIMER );
	csaveData( "OPT_ALLIANCE", OPT_ALLIANCE );
	csaveData( "OPT_DEVELOPMENT", OPT_DEVELOPMENT );
	csaveData( "OPT_STATISTICS", OPT_STATISTICS );
	csaveData( "OPT_ALLIANCELOG", OPT_ALLIANCELOG );
	csaveData( "OPT_NPCFORT", OPT_NPCFORT );
	csaveData( "OPT_RIGHTCLICK", OPT_RIGHTCLICK );
	csaveData( "OPT_ALLIANCELEVEL", OPT_ALLIANCELEVEL );
	csaveData( "OPT_MISTAKEPREVENTION", OPT_MISTAKEPREVENTION );
	csaveData( "OPT_LETTERTRANSMISSION", OPT_LETTERTRANSMISSION );
	csaveData( "OPT_LETTERBROADCAST", OPT_LETTERBROADCAST );
	csaveData( "OPT_LETTERPRESERVATION", OPT_LETTERPRESERVATION );
	csaveData( "OPT_TRADINGRETRIEVAL", OPT_TRADINGRETRIEVAL );
	csaveData( "OPT_TRADINGAFTER", OPT_TRADINGAFTER );
	csaveData( "OPT_NAVIGATIONADDITION", OPT_NAVIGATIONADDITION );
	csaveData( "OPT_BRO3AUTO", OPT_BRO3AUTO );
	csaveData( "OPT_CHANGE_MOVE_SIZE", OPT_CHANGE_MOVE_SIZE );
	csaveData( "OPT_DISPLAY_ADM_INFO", OPT_DISPLAY_ADM_INFO );
	csaveData( "OPT_MASS_SHOKAN_TOOL", OPT_MASS_SHOKAN_TOOL );
	csaveData( "OPT_DECK_TOOL", OPT_DECK_TOOL );
	csaveData( "OPT_CALCN_1KI", OPT_CALCN_1KI );
	csaveData( "OPT_BUSHODAS_LITE", OPT_BUSHODAS_LITE );
	csaveData( "OPT_QUEST_COLLECT", OPT_QUEST_COLLECT );
	csaveData( "OPT_ITEM_COLLECT", OPT_ITEM_COLLECT );
	csaveData( "OPT_TERRITORY_REMOVE", OPT_TERRITORY_REMOVE );
	csaveData( "OPT_B3NEWS", OPT_B3NEWS );
	csaveData( "OPT_VILLAGE", OPT_VILLAGE );
	csaveData( "OPT_BASELINK", OPT_BASELINK );
	csaveData( "OPT_MAPLINK", OPT_MAPLINK );
	csaveData( "OPT_XYLINK", OPT_XYLINK );
	csaveData( "OPT_XYLINK_NK", OPT_XYLINK_NK );
	csaveData( "OPT_LARGEICON", OPT_LARGEICON );
	csaveData( "OPT_TTBL", OPT_TTBL );
	csaveData( "OPT_MEMO", OPT_MEMO );
	csaveData( "OPT_MEMO_FONT_SIZE", OPT_MEMO_FONT_SIZE );
	csaveData( "OPT_MEMO_WIDTH", OPT_MEMO_WIDTH );
	csaveData( "OPT_MEMO_HEIGHT", OPT_MEMO_HEIGHT );
	csaveData( "OPT_MEMO_COUNT", OPT_MEMO_COUNT );
	csaveData( "OPT_MAPLINK_FONT_SIZE", OPT_MAPLINK_FONT_SIZE );
	csaveData( "OPT_DETAILS", OPT_DETAILS );
	csaveData( "OPT_DETAILS_UP", OPT_DETAILS_UP );
	csaveData( "OPT_CTIME_B", OPT_CTIME_B );
	csaveData( "OPT_CTIME_U", OPT_CTIME_U );
	csaveData( "OPT_ALLY", OPT_ALLY );
	csaveData( "OPT_ALLY_IS", OPT_ALLY_IS );
	csaveData( "OPT_ALLY_XY", OPT_ALLY_XY );
	csaveData( "OPT_ALLY_CSV", OPT_ALLY_CSV );
	csaveData( "OPT_RES_T", OPT_RES_T );
	csaveData( "OPT_RES_TIME", OPT_RES_TIME );
	csaveData( "OPT_REMOVELIST", OPT_REMOVELIST );
	csaveData( "OPT_MAPLIST", OPT_MAPLIST );
	csaveData( "OPT_DISTANCE", OPT_TTDISTANCE );
	csaveData( "OPT_DISTANCE_ITEMS", OPT_TTDISTANCE_ITEMS, true, true );
	csaveData( "OPT_TTALLYPRSN", OPT_TTALLYPRSN );
	csaveData( "OPT_USER_STAR", OPT_USER_STAR );
	csaveData( "OPT_USER_LEVEL", OPT_USER_LEVEL );
	csaveData( "OPT_MAPCENTER", OPT_MAPCENTER );
	csaveData( "OPT_TSENDTIME", OPT_TSENDTIME );
	csaveData( "OPT_SMALLBTN", OPT_SMALLBTN );
	csaveData( "OPT_ATTACKMAP", OPT_ATTACKMAP );
	csaveData( "OPT_PIKA_YOROZU", OPT_PIKA_YOROZU );
	csaveData( "OPT_PIKA_HPREST", OPT_PIKA_HPREST );
	csaveData( "OPT_PIKA_MAPHELP", OPT_PIKA_MAPHELP );
	csaveData( "OPT_PIKA_TRDHELP", OPT_PIKA_TRDHELP );
	csaveData( "OPT_PIKA_BLINKBLD", OPT_PIKA_BLINKBLD );
	csaveData( "OPT_SUZAN_SEISAN", OPT_SUZAN_SEISAN );
	csaveData( "OPT_RESERVE_VILLAGE", OPT_RESERVE_VILLAGE );

	csaveData( "OPT_CASTLE_AID", OPT_CASTLE_AID );
	csaveData( "OPT_NEXT_MEISEI", OPT_NEXT_MEISEI );
	if (isNarrow) {
		csaveData( "OPT_VILLAGE_LIST_BOX", OPT_VILLAGE_LIST_BOX );
	}
	csaveData( "OPT_BRO3_ETCS", OPT_BRO3_ETCS );
	csaveData( "OPT_BRO3_DASU", OPT_BRO3_DASU );
	csaveData( "OPT_BRO3_MISC", OPT_BRO3_MISC );
	csaveData( "OPT_CREATE_UNIT_MASK", OPT_CREATE_UNIT_MASK );
	csaveData( "OPT_ADD_TROOP_RESERVE", OPT_ADD_TROOP_RESERVE );
	csaveData( "OPT_TERRITORY_NAME_CHANGE", OPT_TERRITORY_NAME_CHANGE );
	csaveData( "OPT_SHOWTIME", OPT_SHOWTIME );
	csaveData( "OPT_QUEST_ALL", OPT_QUEST_ALL );
	csaveData( "OPT_FAVORITE_TRADE", OPT_FAVORITE_TRADE );
	csaveData( "OPT_ROUTE_VIEW", OPT_ROUTE_VIEW );
	csaveData( "OPT_51CENTER_OFF", OPT_51CENTER_OFF );
	csaveData( "OPT_GOUSEI_SKILL", OPT_GOUSEI_SKILL );
	csaveData( "OPT_STYLE", OPT_STYLE );
	csaveData( "OPT_FAMEPOS", OPT_FAMEPOS );
	csaveData( "DISP_RANK", DISP_RANK );

	csaveData( "OPT_L_CHANGE", OPT_L_CHANGE ); // 見た目を全部Lに置き換えるアホツール
	csaveData( "OPT_UR_CHANGE", OPT_UR_CHANGE ); // 見た目を全部URに置き換えるアホツール
	csaveData( "OPT_SR_CHANGE", OPT_SR_CHANGE ); // 見た目を全部SRに置き換えるアホツール
	csaveData( "OPT_PR_CHANGE", OPT_PR_CHANGE ); // 見た目を全部PRに置き換えるアホツール
	csaveData( "OPT_HR_CHANGE", OPT_HR_CHANGE ); // 見た目を全部HRに置き換えるアホツール
	csaveData( "OPT_AR_CHANGE", OPT_AR_CHANGE ); // 見た目を全部URに置き換えるアホツール
	csaveData( "OPT_BR_CHANGE", OPT_BR_CHANGE ); // 見た目を全部SRに置き換えるアホツール
	csaveData( "OPT_ADD_SHOW_SKILL", OPT_ADD_SHOW_SKILL );	  // 合成確率アップ素材のスキル表示
	csaveData( "OPT_AUTO_SKILLUP", OPT_AUTO_SKILLUP );	  // 自動スキルアップ

	alert("設定を保存しました");
	deleteOptionsHtml();
}
function getMyInfo()
{
	if( (location.pathname == "/user/" ) && !URL_PARAM.user_id ) {

		var uid=0, aid=0;
		var uidtd = $x("//table[@class=\"commonTables\"]//tr[2]//td[3]");
		if( uidtd ) {
			uid = uidtd.innerHTML.match(/\/bbs\/personal_topic_view\.php\?user_id\=(\d+)/);
		}
		var aidtd = $x("//table[@class=\"commonTables\"]//tr[4]//td[5]");
		if( aidtd ) {
			aid = d.body.innerHTML.match(/\/alliance\/info\.php\?id\=(\d+)/);
		}
		if( uid && aid ) {
			csaveData( "user_id", uid[1], true );
			csaveData( "ally_id", aid[1], true );
		}
	}
	USER_ID = cloadData( "user_id", "", true );
	ALLY_ID = cloadData( "ally_id", "", true );
}
function resetMapLink() {
	if( !confirm("登録済みリンクを全て削除します。\nよろしいですか？") ) return;

	var maplinks = cloadData( "links", 0, true );
	for(i=0 ; i<maplinks ; i++) {
		cdelData( "link" + i, true );
	}
	cdelData( "links", true);

	resetMapLinks();
}

function resetUserXY() {
	if( !confirm("同盟員一覧の座標情報を全て削除します。\nよろしいですか？") ) return;
	cresetUserXY();
}

function resetUserStar() {
	if( !confirm("君主の★情報と自領地のLevel情報を全て削除します。\nよろしいですか？") ) return;
	cresetUserStar();
	cdelData("MyLevelList",true);
}

function openOptions() {
	deleteOptionsHtml();
	addOptionsHtml();
}

function deleteOptionsHtml() {
	var elem = $("beyond_OptionsWindow");
	if (!elem ) return;
	$("beyond_floatpanel").removeChild(elem);
}

function addOptionsHtml() {

	var oc = d.createElement("div");
	oc.id = "beyond_OptionsWindow";
	oc.style.position = "absolute";
	oc.style.backgroundColor = "#999";
	oc.style.border = "outset 2px #ccc";
	oc.style.fontSize = "12px";
	oc.style.padding = "15px";
	oc.style.zIndex = 8000;

	var x = cloadData("config_window_x", 10);
	var y = cloadData("config_window_y", 80);
	if(x < 0) x = 0;
	if(y < 0) y = 0;
	x=x-25;
	oc.style.left = x + "px";
	oc.style.top = y + "px";

	$e(oc, "mousedown", function(event){
				if( event.target != $("beyond_OptionsWindow")) {return false;}
				g_MD="beyond_OptionsWindow";
				g_MX=event.pageX-parseInt(this.style.left,10);g_MY=event.pageY-parseInt(this.style.top,10);
				event.preventDefault();});
	$e(d, "mousemove", function(event){
				if(g_MD != "beyond_OptionsWindow") return true;
				var oc = $("beyond_OptionsWindow");
				if( !oc ) return true;
				var x = event.pageX - g_MX;var y = event.pageY - g_MY;
				oc.style.left = x + "px";oc.style.top = y + "px";
				csaveData("config_window_x", x);csaveData("config_window_y", y);
				});
	$e(d, "mouseup", function(event){g_MD="";});

	var tx = d.createElement("div");

	var ah = d.createElement("a");
	ah.href = "http://www1.ocn.ne.jp/~hatt/3gkb/";
	tx.title = ah.href;
	ah.target = "_blank";
	ah.appendChild(d.createTextNode(VERSION_NAME));
	tx.appendChild(ah);
	tx.style.padding = "4px";
	tx.style.fontSize = "10px";
	tx.style.color = "steelblue";
	oc.appendChild(tx);

	$("beyond_floatpanel").appendChild(oc);

	var tbl = d.createElement("table");	tbl.style.border ="0px";
	 var tr = d.createElement("tr");
	  var td1 = d.createElement("td");td1.style.padding = "15px";td1.style.verticalAlign = "top";
	  var td2 = d.createElement("td");td2.style.padding = "15px";td2.style.verticalAlign = "top";
	  var td3 = d.createElement("td");td3.style.padding = "15px";td3.style.verticalAlign = "top";
	  var td4 = d.createElement("td");td4.style.padding = "15px";td4.style.verticalAlign = "top";
	 tr.appendChild(td1);tr.appendChild(td2);tr.appendChild(td3);tr.appendChild(td4);
	tbl.appendChild(tr);
	oc.appendChild(tbl);


	//設定項目
	ccreateCheckBox(td1, "OPT_SMALLBTN", OPT_SMALLBTN, "小さいボタン","右上の4つのボタンを小さくします。状況も1行にします。",0);
	ccreateCheckBox(td1, "OPT_LARGEICON", OPT_LARGEICON, "大きめアイコン","拠点リンク・領地リンクなどのアイコンを14x14サイズにします（アイコン提供:ゆう＠てらおとめん様）",0);
	ccreateCheckBox(td1, "OPT_PIKA_BLINKBLD", OPT_PIKA_BLINKBLD, "都市画面改善","建設中を点滅させます",0);
	ccreateCheckBox(td1, "OPT_VILLAGE", OPT_VILLAGE, "建築表示機能","村の表示で資源不足で建築不可能な場合、LV表示を黄色にします",0);
	ccreateCheckBox(td1, "OPT_BASELINK", OPT_BASELINK, "拠点リンク機能","城や村のリンクにマップ・内政などのリンクを追加します",0);
	ccreateCheckBox(td1, "OPT_XYLINK", OPT_XYLINK, "座標リンク機能","掲示板などの(xx,yy)にリンク機能を追加します",0);
	ccreateCheckBox(td1, "OPT_XYLINK_NK", OPT_XYLINK_NK, "両端のカッコ無視","xx,yyだけでもリンクします。1,000などの数字もリンクになってしまいます",20);
	ccreateCheckBox(td1, "OPT_TTBL", OPT_TTBL, "兵力整形機能","掲示板に貼り付けた兵力一覧を整形します",0);
	ccreateCheckBox(td1, "OPT_DETAILS", OPT_DETAILS, "ログ合計表示機能","同盟ログの兵力＋援軍の合計を表示します",0);
	ccreateCheckBox(td1, "OPT_DETAILS_UP", OPT_DETAILS_UP, "合計を上に出す","合計表示を、下じゃなくて上に出します",20);
	ccreateCheckBox(td1, "OPT_CTIME_B", OPT_CTIME_B, "完了時刻の表示(建物)","建築作成時に完了予定日時を表示します。",0);
	ccreateCheckBox(td1, "OPT_CTIME_U", OPT_CTIME_U, "完了時刻の表示(ユニット)","ユニット作成時に完了予定日時を表示します。",0);
	ccreateCheckBox(td1, "OPT_RES_T", OPT_RES_T, "資源生産合計表示","資源生産量の合計を表示します",0);
	ccreateCheckBox(td1, "OPT_RES_TIME", OPT_RES_TIME, "資源時間の表示","資源の残り時間を表示します",0);
	ccreateCheckBox(td1, "OPT_REMOVELIST", OPT_REMOVELIST, "破棄中の領地表示","破棄中の領地一覧を表示し、マップにマークを付けます",0);
	ccreateCheckBox(td1, "OPT_SUZAN_SEISAN", OPT_SUZAN_SEISAN, "拠点生産量表示","拠点の生産量を表示します",0);
	ccreateCheckBox(td1, "OPT_RESERVE_VILLAGE", OPT_RESERVE_VILLAGE, "拠点の建設予約、破棄予約",0);
	ccreateCheckBox(td1, "OPT_TTALLYPRSN", OPT_TTALLYPRSN, "同盟/君主表示","全ての[拠点/領地]リンクのToolTipsを同盟/君主表示に変更します",0);
	ccreateCheckBox(td1, "OPT_ALLY", OPT_ALLY, "同盟表示改善","同盟員一覧の表示改善",0);
	ccreateCheckBox(td1, "OPT_ALLY_IS", OPT_ALLY_IS, "同盟表示のソート","同盟員一覧の並べ替えを追加します",15);
	ccreateCheckBox(td1, "OPT_ALLY_XY", OPT_ALLY_XY, "同盟員座標表示","同盟員一覧に本居城の座標を追加します",15);
	ccreateCheckBox(td1, "OPT_ALLY_CSV", OPT_ALLY_CSV, "同盟員情報CSV","同盟員一覧の詳細をCSV表示します。",15);
	ccreateCheckBox(td1, "OPT_ALLIANCE", OPT_ALLIANCE, "同盟貢献チェッカー","寄付の確認等動きがわかります",0);	//110929
	ccreateCheckBox(td1, "OPT_DEVELOPMENT", OPT_DEVELOPMENT, "発展チェッカー","放置者発見用",0);				//110929
	ccreateCheckBox(td1, "OPT_RIGHTCLICK", OPT_RIGHTCLICK, "右クリック拡張","全体地図＆都市画面で右クリック拡張されます",0);//faraway110929
	ccreateCheckBox(td1, "OPT_TERRITORY_REMOVE", OPT_TERRITORY_REMOVE, "領地一覧からの領地破棄",0);
	ccreateCheckBox(td1, "OPT_TERRITORY_NAME_CHANGE", OPT_TERRITORY_NAME_CHANGE, "領地画面から領地名変更",0);
	ccreateCheckBox(td1, "OPT_SHOWTIME", OPT_SHOWTIME, "援軍・敵襲・出撃・帰還時間を表示",0);
	ccreateCheckBox(td1, "OPT_CREATE_UNIT_MASK", OPT_CREATE_UNIT_MASK, "兵士誤発注回避",0);
	ccreateCheckBox(td1, "OPT_ADD_TROOP_RESERVE", OPT_ADD_TROOP_RESERVE, "出兵予約メニュー拡張",0);


	ccreateCheckBox(td2, "OPT_DISTANCE", OPT_TTDISTANCE, "移動時間表示","全ての[兵を送る]リンクのToolTipsを移動時間の目安表示に変更します",0);
//faraway 110504 strat	移動時間表示の文字化け対応
	var work_0 = OPT_TTDISTANCE_ITEMS;
	try {
		work_0 = work_0.replace("[", "", "g");
		work_0 = work_0.replace("]", "", "g");
		work_0 = work_0.replace(" ", "", "g");
		work_0 = work_0.replace("\\", "", "g");
		work_0 = work_0.replace("\"", "", "g");
		work_0 = work_0.split(",");
	}catch(e) {
	}
	createDistanceBox(td2, work_0, 14);
//faraway 110504 end

	ccreateCheckBox(td2, "OPT_MEMO", OPT_MEMO, "メモ機能","メモ機能",0);
	ccreateTextBox(td2, "OPT_MEMO_FONT_SIZE", OPT_MEMO_FONT_SIZE, "フォント","メモのフォントサイズを指定します。デフォルト=10",3,18,true);
	ccreateTextBox(td2, "OPT_MEMO_COUNT", OPT_MEMO_COUNT, "数(1～5)","メモ欄の数を指定します。デフォルト=1",3,20, true, true);
	ccreateTextBox(td2, "OPT_MEMO_WIDTH", OPT_MEMO_WIDTH, "幅","メモの幅を指定します。デフォルト=20",3,20, true);
	ccreateTextBox(td2, "OPT_MEMO_HEIGHT", OPT_MEMO_HEIGHT, "高","メモの高さを指定します。デフォルト=5",3,20, true, true);
	ccreateCheckBox(td2, "OPT_MAPLINK", OPT_MAPLINK, "領地リンク","領地や敵地・NPC砦等へのリンク",0, true);
	ccreateTextBox(td2, "OPT_MAPLINK_FONT_SIZE", OPT_MAPLINK_FONT_SIZE, "フォント","領地リンクのフォントサイズを指定します。デフォルト=10", 3, 20, true);
	ccreateCheckBox(td2, "OPT_STYLE", OPT_STYLE, "スタイル変更","スタイルを旧スタイルに近い形に変更します",0);
	ccreateCheckBox(td2, "OPT_FAMEPOS", OPT_FAMEPOS, "名声表示位置変更","名声を資源の右側に表示します。",0);
	ccreateCheckBox(td2, "DISP_RANK", DISP_RANK, "ランキングの非表示","チェックするとランキングが消える",0);
	ccreateCheckBox(td2, "OPT_ALLIANCELOG", OPT_ALLIANCELOG, "同盟ログ","新しい同盟ログに修正が入ります",0);//110929
	ccreateCheckBox(td2, "OPT_REPORTLOG", OPT_REPORTLOG, "報告書・同盟ログCSV出力","一時保管等",0);			//110929
	ccreateCheckBox(td2, "OPT_DISPJST", OPT_DISPJST, "JST表示", "時刻を表示します。",0);
	ccreateCheckBox(td2, "OPT_STATISTICS", OPT_STATISTICS, "統計グラフ化","統計グラフ化",0);							//faraway110929

	ccreateCheckBox(td3, "OPT_USER_STAR", OPT_USER_STAR, "君主★情報表示","プロフィール画面に領地の★表示を追加します",0);
	ccreateCheckBox(td3, "OPT_USER_LEVEL", OPT_USER_LEVEL, "領地レベル表示","プロフィール画面に領地のレベル表示を追加します",0);
	ccreateCheckBox(td3, "OPT_TSENDTIME", OPT_TSENDTIME, "出発時刻計算","出兵画面で、到着希望時間から出発時刻を計算します",0);
	ccreateCheckBox(td3, "OPT_ATTACKMAP", OPT_ATTACKMAP, "出兵表示機能","マップ上に、現在出兵中の目印を付けます",0);
	ccreateCheckBox(td3, "OPT_PIKA_YOROZU", OPT_PIKA_YOROZU, "ヨロズダス引き忘れ防止機能","ヨロズダスがリセットされたら通知してくれます",0);
	ccreateCheckBox(td3, "OPT_PIKA_HPREST", OPT_PIKA_HPREST, "武将の回復時間予測機能","武将のHPが100になる時間を表示します",0);
	ccreateCheckBox(td3, "OPT_CASTLE_AID", OPT_CASTLE_AID, "拠点援軍ボタン機能","城や村のリンクの横に援軍ボタンを表示します",0);
	ccreateCheckBox(td3, "OPT_NEXT_MEISEI", OPT_NEXT_MEISEI, "名声獲得タイマー機能","次の名声値獲得までの時間を表示します",0);
	if (isNarrow) {
	ccreateCheckBox(td3, "OPT_VILLAGE_LIST_BOX", OPT_VILLAGE_LIST_BOX, "都市リスト表示機能","都市のタブ以外でも都市のリストを表示できるようにします",0);
	}
	ccreateCheckBox(td3, "OPT_MAPLIST", OPT_MAPLIST, "マップの地形一覧","マップ上の拠点・領地リストを表示します",0);
	ccreateCheckBox(td3, "OPT_MAPCENTER", OPT_MAPCENTER, "マップ中央表示","マップ中央に目印を表示し、中央座標を表示します",0);
	ccreateCheckBox(td3, "OPT_PIKA_MAPHELP", OPT_PIKA_MAPHELP, "マップ画面検索改善","X座標のところに999,999等を入れてもジャンプしてくれます",0);
	ccreateCheckBox(td3, "OPT_NPCFORT", OPT_NPCFORT, "NPC砦、領土情報検索ver2.49","高機能地図です",0);
	ccreateCheckBox(td3, "OPT_CHANGE_MOVE_SIZE", OPT_CHANGE_MOVE_SIZE, "マップ移動距離カスタムver1.10","全体地図の移動距離が変わります",0);
	ccreateCheckBox(td3, "OPT_DISPLAY_ADM_INFO", OPT_DISPLAY_ADM_INFO, "内政武将表示ver1.09","内政武将が都市画面に出ます",0);
	ccreateCheckBox(td3, "OPT_AUTOROUND", OPT_AUTOROUND, "自動巡回","Auto_Map_Move Ver0.5β。やりすぎると重いです",0);	//faraway110929
	ccreateCheckBox(td3, "OPT_RESERVATION", OPT_RESERVATION, "出兵予約","単発予約です。ログアウト注意～",0);				//faraway110929
	ccreateCheckBox(td3, "OPT_MISTAKEPREVENTION", OPT_MISTAKEPREVENTION, "ミス防止補助","斥候騎兵誤生産対策＆単騎出兵対策",0);
	ccreateCheckBox(td3, "OPT_QUESTASSIST", OPT_QUESTASSIST, "クエスト補助","クエストの報酬説明",0);
	ccreateCheckBox(td3, "OPT_URL_CHANGE_REV_RES", OPT_URL_CHANGE_REV_RES, "掲示板逆順表示", "掲示板の最新書き込みを一番上に表示します",0);
	ccreateCheckBox(td3, "OPT_URL_CHANGE", OPT_URL_CHANGE, "URLリンク変更スクリプト", "URLリンク変更スクリプト  bro3_url_change",1);
////	ccreateCheckBox(td3, "OPT_ATK_CALC", OPT_ATK_CALC, "スキル込計算スクリプト","スキル込計算スクリプト bro3_atk_calc",0);
	ccreateCheckBox(td3, "OPT_ROUTE_VIEW", OPT_ROUTE_VIEW, "ルート表示",0);
	ccreateCheckBox(td3, "OPT_BRO3_ETCS", OPT_BRO3_ETCS, "いろいろスクリプト(etcsより抜粋)",0);
	ccreateCheckBox(td3, "OPT_FAVORITE_TRADE", OPT_FAVORITE_TRADE, "トレードサポート(favoritetrade)",1);
	ccreateCheckBox(td3, "OPT_BRO3_DASU", OPT_BRO3_DASU, "カード表示拡張と自動ブショーダス",0);
	ccreateCheckBox(td3, "OPT_BRO3_MISC", OPT_BRO3_MISC, "bro3_misc",0);

	ccreateCheckBox(td4, "OPT_MASS_SHOKAN_TOOL", OPT_MASS_SHOKAN_TOOL, "書簡を複数に送付（最大○○人）","受取側は個別書簡になります",0);
	ccreateCheckBox(td4, "OPT_LETTERTRANSMISSION", OPT_LETTERTRANSMISSION, "書簡送信アシスタント","書簡送信先が登録できます",0);
	ccreateCheckBox(td4, "OPT_LETTERBROADCAST", OPT_LETTERBROADCAST, "書簡同報リンク","書簡同報リンク",0);
	ccreateCheckBox(td4, "OPT_LETTERPRESERVATION", OPT_LETTERPRESERVATION, "書簡保存＆検索","保存＆検索できるようになります",0);
	ccreateCheckBox(td4, "OPT_PIKA_TRDHELP", OPT_PIKA_TRDHELP, "トレード画面入力改善","4桁数字を入力するとカードNoとして検索します",0);//faraway110929
	ccreateCheckBox(td4, "OPT_TRADINGRETRIEVAL", OPT_TRADINGRETRIEVAL, "トレード検索条件記憶","トレード検索条件記憶できます",0);
	ccreateCheckBox(td4, "OPT_TRADINGAFTER", OPT_TRADINGAFTER, "運営書簡開封/削除","運営書簡を選んだり、まとめて開封します",0);
	ccreateCheckBox(td4, "OPT_TRADESTATUS", OPT_TRADESTATUS, "トレードステータス表示","ステ振りが表示されます。",0);
	ccreateCheckBox(td4, "OPT_TRADEINCOME", OPT_TRADEINCOME, "トレード収入計算","収入の手取りを計算します",0);
	ccreateCheckBox(td4, "OPT_BRO3AUTO", OPT_BRO3AUTO, "Auto_Bilder","建築＆内政発動＆寄付＆糧変換をします",0);
	ccreateCheckBox(td4, "OPT_DECK_TOOL", OPT_DECK_TOOL, "武将カード分類ツール","デッキ画面で分類できます",0);
	ccreateCheckBox(td4, "OPT_HISTANALYSIS", OPT_HISTANALYSIS, "武将ダス履歴抽出分析 Ver1.09","自分の引き自慢にお使いくださいｗ",0);
	ccreateCheckBox(td4, "OPT_NAVIGATIONADDITION", OPT_NAVIGATIONADDITION, "ﾅﾋﾞｹﾞｰｼｮﾝにﾛｰﾙｵｰﾊﾞｰﾘﾝｸ追加","ﾅﾋﾞｹﾞｰｼｮﾝにﾛｰﾙｵｰﾊﾞｰﾘﾝｸ追",0);
	ccreateCheckBox(td4, "OPT_CALCN_1KI",		OPT_CALCN_1KI,			 "討伐・空き地 民兵出現 推定機","討伐・空き地 民兵出現 推定機",0);
	ccreateCheckBox(td4, "OPT_BUSHODAS_LITE", OPT_BUSHODAS_LITE, "ﾌﾞｼｮｰﾀﾞｽﾗｲﾄを引く画面一番上表示",0);
	ccreateCheckBox(td4, "OPT_QUEST_COLLECT", OPT_QUEST_COLLECT, "クエスト報酬自動取得",0);
	ccreateCheckBox(td4, "OPT_ITEM_COLLECT", OPT_ITEM_COLLECT, "アイテム自動取得",0);
	ccreateCheckBox(td4, "OPT_QUEST_ALL", OPT_QUEST_ALL, "クエストの項目を全部表示",0);
	ccreateCheckBox(td4, "OPT_GOUSEI_SKILL", OPT_GOUSEI_SKILL, "ﾄﾚｰﾄﾞ右ｸﾘｯｸで合成ｽｷﾙ表示",0);
	ccreateCheckBox(td4, "OPT_DELETECUSTOM", OPT_DELETECUSTOM, "一括破棄拡張", "一括破棄画面で保護解除、出品を可能にします。",1);
	ccreateCheckBox(td4, "OPT_ADD_SHOW_SKILL", OPT_ADD_SHOW_SKILL, "合成確率アップ素材のスキルを表示","スキルレベルアップ合成の素材のスキルを表示するようにします。",0);
	ccreateCheckBox(td4, "OPT_AUTO_SKILLUP", OPT_AUTO_SKILLUP, "合成画面での同一カードの自動スキルアップ。","同一IDカードを自動でスキルレベルアップします。", 0);

	var fs = d.createElement("fieldset");
	var lg = d.createElement("legend");
	lg.appendChild(d.createTextNode("　【 お 遊 び 】 ネタなツールたち　") );
	fs.appendChild(lg);
	td4.appendChild(fs);
	ccreateCheckBox(fs, "OPT_L_CHANGE", OPT_L_CHANGE, "見た目を全部Lに置き換え機能","CだろうがUCだろうがRだろうがSRだろうが、すべてのカードの見た目をLと同じ仕様にします。",0);
	ccreateCheckBox(fs, "OPT_UR_CHANGE", OPT_UR_CHANGE, "見た目を全部URに置き換え機能","CだろうがUCだろうがRだろうがSRだろうが、すべてのカードの見た目をURと同じ仕様にします。",0);
	ccreateCheckBox(fs, "OPT_SR_CHANGE", OPT_SR_CHANGE, "見た目を全部SRに置き換え機能","CだろうがUCだろうがRだろうが、すべてのカードの見た目をSRと同じ仕様にします。",0);
	ccreateCheckBox(fs, "OPT_PR_CHANGE", OPT_PR_CHANGE, "見た目を全部PR（MC☆あくしず）","CだろうがUCだろうがRだろうがSRだろうが、すべてのカードの見た目をMC☆あくしずのPRと同じ仕様にします。",0);
	ccreateCheckBox(fs, "OPT_HR_CHANGE", OPT_HR_CHANGE, "見た目を全部HR（MC☆あくしず）","CだろうがUCだろうがRだろうがSRだろうが、すべてのカードの見た目をMC☆あくしずのHRと同じ仕様にします。",0);
	ccreateCheckBox(fs, "OPT_AR_CHANGE", OPT_AR_CHANGE, "見た目を全部UR（MC☆あくしず）","CだろうがUCだろうがRだろうがSRだろうが、すべてのカードの見た目をMC☆あくしずのURと同じ仕様にします。",0);
	ccreateCheckBox(fs, "OPT_BR_CHANGE", OPT_BR_CHANGE, "見た目を全部SR（MC☆あくしず）","CだろうがUCだろうがRだろうがSRだろうが、すべてのカードの見た目をMC☆あくしずのSRと同じ仕様にします。",0);

	ccreateButton(oc, "保存", "設定内容を保存します", function() {saveOptions();});
	ccreateButton(oc, "閉じる", "設定内容を保存せず閉じます", function() {deleteOptionsHtml();});
	ccreateButton(oc, "領地リンクのクリア", "領地・君主リンクの内容を初期化します", function() {resetMapLink();});
	ccreateButton(oc, "同盟員座標のクリア", "同盟員座標を全て初期化します", function() {resetUserXY();});
	ccreateButton(oc, "★/Level情報のクリア", "君主の★情報と自領地のLevel情報を全て初期化します", function() {resetUserStar();});
	ccreateButton(oc, "領地リンクの直接編集", "領地リンクをテキストで自由に変更できます", function(event) {mapLinkList(event);});
}

function createDistanceBox(container, items, num)
{
	var sels = ["その他", "無し", "剣兵(6)",
				"盾兵(4)","槍兵(7)", "弓兵(5)", "騎兵(12)", "斥候(9)", "衝車(3)",
				,"大剣(8)","重盾(7)","矛槍(10)", "弩兵(9)", "近衛(15)", "斥騎(20)", "投石(6)"];
	var sp0 = "　";//表示1～表示10の位置合わせ by faraway
	for(var i=0 ; i<num ; i++ ) {
		var src = "";
		if( sels.indexOf(items[i]) != -1 ) src = items[i];
		if(i>8) sp0="";//表示1～表示10の位置合わせ by faraway
		var cb = ccreateComboBox(container, "OPT_DISTANCE_CB" + i , sels, src, (i+1) + sp0, (i+1) + "行目の表示", 20 );//表示1～表示10の位置合わせ by faraway
		var tb = d.createElement("input");
		tb.type = "text";
		tb.id = "OPT_DISTANCE_TX" + i;
		tb.title = "例) 「超早い馬(50)」など、半角カッコの中に速度を入れて下さい";
		if( src == "" ) {
			tb.value = items[i];
		}else{
			tb.disabled ="disabled";
		}
		tb.size = 12;

		cb.parentNode.appendChild(d.createTextNode(" "));
		cb.parentNode.appendChild(tb);
		(function(no) {
			$e(cb, "change", function() {
				var cb = $("OPT_DISTANCE_CB" + no);
				var tb = $("OPT_DISTANCE_TX" + no);
				if( !cb || !tb ) return;
				if( cb.value == sels[0] ) {
					tb.disabled ="";
				}else{
					tb.disabled ="disabled";
				}
			});
		})(i);
	}
}

function bro3_url_change(){
	/*=======================================================
	   初期処理
	=========================================================*/
	//現在表示URL
	NowUrl = URLGet();
	//現在表示ﾌｫﾙﾀﾞ
	NowFolder = FolderGet();


	/*=======================================================
	   URL文字変更処理
	=========================================================*/
	wk1 = document.getElementById("commentList");
	src1 = wk1.innerHTML;
	wk1.innerHTML = UrlToLink(src1);

	if (NowUrl == "detail.php" && NowFolder == "message") {
		//書簡ﾍﾟｰｼﾞの場合
		wk2 = document.getElementById("gray02Wrapper");
		src2 = wk2.innerHTML;
		r1 = document.getElementsByClassName("notice");
		r2 = src2.indexOf("出品したカードが落札されました");
		if (r1.length > 0 && r1[0].innerHTML == "ブラウザ三国志運営チーム" && r2 > -1) {
		} else {
			wk2.innerHTML = UrlToLink(src2);
		}
	} else if (NowUrl == "res_view.php" || NowUrl == "personal_res_view.php") {
		//掲示板関連
		if (CommentCHK() != "comment") {
			wk2 = document.getElementsByClassName("commonTables");
			src2 = wk2[0].innerHTML;
			wk2[0].innerHTML = UrlToLink(src2);
		}
	} else if (NowUrl == "chat_view.php") {
		wk2 = document.getElementsByClassName("hitokoto");
		wk3 = document.getElementsByClassName("hitokoto");
		for (cnt = 0; cnt <= wk2.length; cnt++) {
			src2 = wk2[cnt].innerHTML;
			wk3[cnt].innerHTML = UrlToLink(src2);
		}
	} else if (NowUrl == "info.php") {
		//同盟TOPﾍﾟｰｼﾞの場合
		wk2 = document.getElementsByClassName("commonTables");
		src2 = wk2[0].innerHTML;
		wk2[0].innerHTML = UrlToLink(src2);
	} else if (NowUrl == "") {
		//ﾌﾟﾛﾌｨｰﾙ画面
		wk2 = document.getElementsByClassName("show_comment_cell");
		if( wk2.length != 0 ){
			// 2014/01/26 getElementByClassNameが失敗した時にスクリプトがとまるバグ対応
			src2 = wk2[1].innerHTML;
			wk2[1].innerHTML = UrlToLink(src2);
			src2 = wk2[2].innerHTML;
			wk2[2].innerHTML = UrlToLink(src2);
		}
	}

	/*------------+---------------------------------------------------------+
	 * URL文字→ﾘﾝｸ文字に変更											   |
	 *------------+---------------------------------------------------------*/
	function UrlToLink(html) {
		var html1 = html;
		var re1 = /(http(s)?:\/\/[-_.!~*\'()a-zA-Z0-9;\/\?:\@\&=+\$,%#]+)/gi;
		var re2 = /(http(s?):\/\/gyazo.com\/[-_.!~*\'()a-zA-Z0-9;\/?:\@&\=+\$,%#]+)/gi;
		var re4 = /(http(s)?:\/\/[-_.!~*\'()a-zA-Z0-9;\/?:\@&=+\$,%#]+(jpg|jpeg|gif|png|bmp))/gi;
		var re5 = /(https:\/\/docs.google.com\/spreadsheet\/[-_.!~*\'()a-zA-Z0-9;\/?:\@&=+\$,%#]+)/gi;
		var text = html.match(re1);

		if (text) {
			text = unique(text);

			for (i = 0; i < text.length; i++) {
				var re3 = new RegExp(text[i].replace(/\&amp;/gi, '\\&amp;').replace(/\?/gi, '\\?'), "gi");

				if (text[i].match(re4)) {
					html1 = html1.replace(text[i], "<a href=\""+text[i]+"\" target=\"_blank\"><img src=\""+text[i]+"\" width=\"200px\" /></a>");
				} else if (text[i].match(re2)) {
					//Gyazoの場合
					html1 = html1.replace(re3, "<a href=\""+text[i]+"\" target=\"_blank\"><img src=\""+text[i]+".png\" width=\"200px\" /></a>");
				} else if (text[i].match(re5)) {
					html1 = html1.replace(text[i], "<a href=\""+text[i]+"\" target=\"_blank\">"+text[i]+"</a>");
				} else if (text[i].match(re1)) {
					//普通URLの場合(s無し)
					html1 = html1.replace(re3, "<a href=\""+text[i]+"\" target=\"_blank\">"+text[i]+"</a>");
				}
			}
		}

		return html1;
	}

	/*------------+---------------------------------------------------------+
	 * 現在ﾌｫﾙﾀﾞ名取得用													|
	 *------------+---------------------------------------------------------*/
	function FolderGet() {
		wkurl = location.href;
		var arr = wkurl.split("/");
		wkurl = arr[arr.length-2];

		return wkurl;
	}
	/*------------+---------------------------------------------------------+
	 * 現在ﾌｧｲﾙ名取得用													 |
	 *------------+---------------------------------------------------------*/
	function URLGet() {
		wkurl = location.href;
		var arr = wkurl.split("/");
		wkurl = arr[arr.length-1];
		arr = wkurl.split("#");
		wkurl = arr[0];
		arr = wkurl.split("?");
		wkurl = arr[0];

		return wkurl;
	}
	/*------------+---------------------------------------------------------+
	 * ｺﾒﾝﾄ入力時かどうかのﾁｪｯｸ											 |
	 *------------+---------------------------------------------------------*/
	function CommentCHK() {
		wkurl = location.href;
		var arr = wkurl.split("/");
		wkurl = arr[arr.length-1];
		arr = wkurl.split("#");
		wkurl = arr[1];

		return wkurl;
	}

	/*------------+---------------------------------------------------------+
	 * 配列の重複削除処理												   |
	 *------------+---------------------------------------------------------*/
	function unique(array) {
		var storage = {};
		var uniqueArray = [];
		var i,value;
		for ( i=0; i<array.length; i++) {
			value = array[i];
			if (!(value in storage)) {
				storage[value] = true;
				uniqueArray.push(value);
			}
		}
		return uniqueArray;
	}
}

function bro3_url_change_reverse_res_view(){
	NowUrl = URLGet();
	//-----------------------------------------------
	// 逆順表示（一言掲示板は対象外）
	//-----------------------------------------------
	if (NowUrl == "res_view.php" || NowUrl == "personal_res_view.php") {
		// それぞれの投稿部分
		var ttl2 = document.getElementsByClassName('ttl2');
		var ttl4 = document.getElementsByClassName('ttl4');

		var s = ttl2[0].parentNode; // 先頭の場所
		var max_idx = ttl2.length - 1; // ttl2とttl4の配列長さは同じ

		// 最後の場所へinsertする
		for(var i = 0; i < ttl2.length - 1; i++) { // 最後の一回はやらない
			s.parentNode.insertBefore(ttl2[max_idx].parentNode,s);
			s.parentNode.insertBefore(ttl4[max_idx].parentNode,s);
		}

		var tbl = document.getElementsByClassName("commonTables");
		var tr = tbl[0].getElementsByTagName("tr");
		var html1 = tbl[0].getElementsByTagName("tr")[tr.length - 3].innerHTML;
		var html2 = tbl[0].getElementsByTagName("tr")[tr.length - 2].innerHTML;
		var html3 = tbl[0].getElementsByTagName("tr")[tr.length - 1].innerHTML;
		tbl[0].deleteRow(tbl[0].rows.length - 3);
		tbl[0].deleteRow(tbl[0].rows.length - 2);
		tbl[0].deleteRow(tbl[0].rows.length - 1);

		var row1 = tbl[0].insertRow(4);
		var row2 = tbl[0].insertRow(5);
		var row3 = tbl[0].insertRow(6);
		row1.innerHTML = html1;
		row2.innerHTML = html2;
		row3.innerHTML = html3;
	}
	function URLGet() {
		wkurl = location.href;
		var arr = wkurl.split("/");
		wkurl = arr[arr.length-1];
		arr = wkurl.split("#");
		wkurl = arr[0];
		arr = wkurl.split("?");
		wkurl = arr[0];

		return wkurl;
	}
}

function getDistanceBox(num)
{
	var ret = new Array();
	for(var i=0 ; i<num ; i++ ) {
		var cb = $("OPT_DISTANCE_CB" + i);
		var tb = $("OPT_DISTANCE_TX" + i);
		if( !cb || !tb ) return null;
		if( cb.value == "その他" ) {
			ret.push( tb.value );
		}else if( cb.value == "無し" ) {
			ret.push("");
		}else {
			ret.push( cb.value );
		}
	}
	return ret;
}

//////////////////////
//建築表示処理
//////////////////////
function disp_village() {
	if( location.pathname != "/village.php" ) {
		return ;
	}

	var costs = getCostTables();
	var img_lv = new Array();

	img_lv[0] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWAMQAAKiTADs9BK+dAN7aALGjAMO2QernwPT038CzLOvmANfQgfn577OjDeLbnsjE'+'AOXkrrCtALurPsS7FvDtztXOau/qANXRAMf/If/6CLy4ACAgIL+sAGFyB7WdAP///////yH5BAEA'+
	'AB8ALAAAAAAXABYAAAW24PdxZGmepShyWOu+sMutcV3PXKXvSTL8v8Rux9FwLMikxSGhGAwUhxJZ'+'5GSu2Azk4el6FJBspropmwmIxUFS6DLMZTJ8Q5gcBPiGpzCXwxFfAhsCCh4IfUZzG20NAI4GBwSI'+
	'HIoMXRQRXAWScH5whV0LBYKTHaanHQARChQMAKinVbCnjo6zpkUjt7uxGhorKBy3Jb4qH77IvrDJ'+'xcbOIqgBAc/UxqfS1dkfptja1R3d3tXT2iEAOw==';
	img_lv[1] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWAMQAAEBCAP//IbKcAP7+6mZ5AMjEAPnnRKiTANXRAO3YALy4AP/6CP/zgb+sAO/q'+'ACAgIP/6Et7aAP7xV9C2AP///7WdANXRAPLVB6+sALqhAP/7JevmAK2YAP/mAd7aAP///yH5BAEA'+
	'AB8ALAAAAAAXABYAAAWh4PcRZGmepSgSQeu+sEusS23fOD4TTu/7keDm5yM8CJakMlnwaCCFpdJI'+'UFivCgxiQJFgsFdqY0xuCBKMrqBMFrPHgo763XC/OXIJh25n47t7b31lHAaAfEd0DRwSh4JHFZGS'+
	'kRwTFxkck5JUmpMHnwKdFUYjoqabDw8rKASiJakqH6mzqZq0sLG5IpMAALq/sZK9wMQfkcPFwBXI'+'ycC+xSEAOw==';
	img_lv[2] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWANUAAEBCAPz4Lr+vALKcAGZ5AP/5wP//Ie/qAKeSAP/zlenkAP////7xa7y4AP/n'+'F//6CP7+6t7aACAgIL+sAPXTBf/zgf/8TdXRAP7zq7WdAKyaAP381v3rQ+XHAMjEAOvmAMKtAPrn'+
	'Bf36VuzXAP/n5//8c/7yl////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACcALAAAAAAXABYAAAbDwNOJ'+
	'QCwaj0WhkGBoOp9QJ2H5qFqvWOyUcOh6u5Fw+PPtEiSEi3p98ShKGIzFw1afCY28viFa+P0BGnsN'+'dxOGhwMVDCMaDgscA4eGhZKGAxqYCRsgkZKUlRkaAhUQjBmVn5IaIQUFIwgIp55olRMaDAsQFXEY'+
	'Gqi0lRoFubwmnYd3GcrLGhQdsNADy8rJ08qY0tbTZ0Pa3tZnEktIBN5FEuJK6Ovo1uzoSvHy0wAA'+'8vf3y/X4/ErK+/36ZQAYsJ+9gEEAADs=';
	img_lv[3] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWANUAAEBCAPXZMcjEAKyaAP7+6mZ5AP//If32lu/qANfBAKeSALy4AP/5wP/8Tfnh'+'BP/6CLWdACAgIN7aAL+sAP/5rP3rQ/TXHP/////8Yf381uzXANXRALGjAL2rAPflWuvmAPzpLunk'+
	'AP7xa//WQvzkAv36Vv/0l//nF////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACgALAAAAAAXABYAAAbEQBSq'+
	'QCwaj0WhsGBoOp9QZ2H5qFqvWOy0gOh6u5Jw+PPtFiKFjXq9EYQaJgpGwFafC4u8nlO6+P0gHHp5'+'dxOGhxwmIhoDJxcVHIeGhZKGHBwJFRkUAwOVlJWdFH8MHZ9olRMcIA4dChp+DqcFlRwkFweuFRcE'+
	'ppJ3EMHCEAx/FxmMwxDAyhAKAR4eFgoKzczNnZ3NwWdD29/CZxFLSAXbRRHjSuns6crt6Ury88MA'+'APP4+ML2+f1Kwfz8+YMQUKC/ewKDAAA7';
	img_lv[4] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWANUAAEBCAP/8TbWdALqhAKiTAP381mZ5AP//If32gurlAO/qAL+vAP/6CLy4AP/5'+'wP///7+sAOHdANTBAP/7JSAgINXRAP74q7CtAP7xa/LVB7GjAP756sjEAP7xV6yaAOvmAMKtAP//'+
	'/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACEALAAAAAAXABYAAAa/wFDI'+
	'QCwaj0Wh0HBoOp9Qp2HJqFqvWOzUoOh6v4pI5ANWGCiGinq95nACEw5bfTY07vj7JVF4dC55d3UQ'+'hIUQGgkbGH4ahoSDjhogDg4ejI4QkIYeGBsSBH4eHgKGmoSIDxsOD6yXhaaHCw4WGAgPFh0Lja9o'+
	'Ar6/AqIeGX4EBMACdcjABAMZA8fIysu/xtHSFEPU279n2UNIBtRFFN9C5ejlyOnlSu7vwAAA7/T0'+'v/L1+Uq++Pr6Av386ZvnLwgAOw==';
	img_lv[5] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWANUAAEBCAPXZMbWdAL+pAKeSAP/5wGZ5AP//If/zgb+vAPz3AP/6CP///+/qAPfl'+'WrKcAP/5rL+sAN7aACAgIPXTBdXRALy4AKyaAP/7OP/8YdXRAP381v/6EMjEAP/sLOvmANK/APnn'+
	'RP7xa/vuWcKtAP/mAf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACYALAAAAAAXABYAAAbGQJPJ'+
	'QCwaj0Wh0HBoOp9Qp2G5qFqvWOzU0Oh6u5Kw+PNtGCaGinpd6Sg4HExG0WFXzgaLfm/RMP4MEBoX'+'fBZ4EYiJDx4MJRePFwKJiIeTEQ8iDB4IEAgkD5aVkxcQDAUjpRAXoWiWERcJHgSzf6uToomkGyAE'+
	'IYG2iXgCw8QCBYCmAw/FAsLMAgQBDg4Us8vFzs+QF9fMZ0PP4d4TE0tIBuFF5Eom5O7kzO/r7PRC'+'xQAA9frsxPj7/yaG+QO4T8BAgvvyAQwCADs=';
	img_lv[6] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWANUAAEBCAPzlQsjEAKypAP7+6mZ5AP//If/6CP/9iNfTAKeSANfBALy4AP/5rP7x'+'a/nhBLWdAL+sAP///yAgIP/5wN7aAO/qAOXHANK/APflWv/zgbKcANXRAP381r+vAPTXHPz3AP37'+
	'luvmAP/mA66eAP/n572fAP/WQv///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACgALAAAAAAXABYAAAa/QBSq'+
	'QCwaj0WhsGBoOp9QZ2F5qFqvWOy0YOl6vZWw6OstTAqctDotACESgrXaXGDY7wyShxAa4PF0EYKD'+'ESQhBAskioSCgYwbIxIaDg0aCxuMjoSGEhIUHRINJJlnjIWeDwoenaOEmoMkBAQYCgESIa2DdBC8'+
	'vRC2nZ4eJL4Qu8UQChcZGR8KChvFx8jPz9HIZkPI29ITE0tIBdtF3koo3ujexenl5u5CvgAA7/Tm'+'vfL1+Si8+Pr1EP381ZunLwgAOw==';
	img_lv[7] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWANUAAEBCAPvkLb2rALGjAP/+wGZ5AP//Ie/qAP/8daiTANC2AP///7y4AP7xV/LV'+'B+HdAP/5rP/6CL+sACAgINXRAP756vz3ALWdAK+sAP/6Ev3xlvrtRcjEAPrpbOvmAL2fAKyaAP/s'+
	'LP/mAf/dvda4AMKtAP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACYALAAAAAAXABYAAAbAQJOp'+
	'QCwaj0WhsGBoOp9QZ2EZqVqvWOy0cOh6D4+HxxP2fLuFSYHCbnMsCA4nk+G02+kCY8/HQBYEC4IQ'+'GHx7eRKJigN/DSIhCw0DiomIlBKMCyAgEBUlk5SWlAMhGwkikSAXl6KjAwMaCwqgoWqXiiACgKq3'+
	'rZQgAQsdILcSeRfIycgJCg4CCcrJx9HJCdbUyGlD2NzSExNLSAXYRd9KJt/p39Hq5ufvQsoAAPD1'+'58nz9vomyPn79hf8/bNHb18QADs=';
	img_lv[8] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWANUAAEBCAPXZMbWdANbSAKiTAP381mZ5AP32lv//IeznAL+vAPv4bf/////+wN7a'+'AP/6CLy4APflWtXRAL+sACAgIPnhBP/5rP3xgv/8Ta+dAP7+6u/qAPTXHLGjAP/7OsjEAL2fAOvm'+
	'AP/uV//dvcGuAP/n5//mAf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACcALAAAAAAXABYAAAbNwNPJ'+
	'QCwaj0Wh0IBoOp9Qp2H5qFqvWOzUsOl6u46wOPTdGCgGiXot+XgOlgNm8GFLzgaIft+5MBYRDQwa'+'CR17EHgTiosZDAwJJg0FIhmLiomWExkLjgwWJBmVlpiWGQkaGo4WCh2ZpIodChoNChUFDBeii6+a'+
	'FX8EBJwHupdoAsfIGYINggUJGcjHeNHIBAERERwKBNQC090CwOLgZ0Pg58hnFEtIBuREFOtK8fTx'+'1PXxSvr70QAA+wABIvMXsKCSYwQNGhSQUKHBfwqDAAA7';
	img_lv[9] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWANUAAEBCAPXZRbWdANXRAKiTAP7+6mZ5AP//If/5rNC2AL2oAP/6CP3xgv381vTX'+'HLy4AN7aAL+sAO/qAP///yAgINXRAK+sAPvuWezXALGjAP/8Tf3xlsjEAOvmAKyaAP/n597aAMGu'+
	'ANa4AP/8Yf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACQALAAAAAAXABYAAAbAQBLJ'+
	'QCwaj0Wh0HBoOp9Qp2G5qFqvWOzUIOl6u5CwuPOVGCiGinpd4YA0CMQIxGFXzoaHfm8ZNBoIBRMI'+'Fnt6eBGJihkIDR4eGBMTGYqJiJURGRMNIY+blJWXlYybgRMMoIqiiwoXCBuCA6mWaJiJjx4Opx62'+
	'eAK/wL8eCgUFCRnBv77JvwQJAQ4EzALL0wTX09QUQ9nd2ttDSAbTRRTgQubp5snq5krv8MEAAPD1'+'9cDz9vpKv/n7+wL8/dtH718QADs=';
	img_lv[10] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWANUAAEBCAP/7OsjEALCtAP7+6mZ5AO3YAP37lv//If/6CKiTAP77a7WdAN7aAP/5'+'wPLVB/flWr+sAO/qALGjANXRAP/6EiAgIP////z2rsKtANXRAP/8Tf/zgby4AL+vAP381vnnROvm'+
	'AK+dAP/mAfvjGd7aAPXZRdC2AP7xV//n572fANfBAP/7Jf///wAAAAAAAAAAAAAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAC0ALAAAAAAXABYAAAbhwFar'+
	'QCwaj0WhsIBoOp9QZ2GZqFqvWOy0IOlKGuCQOAQuh7wFS0HDFpRYFUG7tMFgAnJ2utDpDCgEFygD'+'fQMHF4gXC4QdexEREwYcghOQBgQfKyOIGY+OjxObKJUTDh8iqJMjnmqPkKKVBoIiESIoFwasBa6h'+
	'lBGbHArCGB+VEZ+1IL4eiCAPhyPGewzUtrOot4gEJCLUDNPUCicPHgrhDxAm5d7fauzC5t7w8d5p'+'Q+z4+fUWFktIBfqK8FPSgp9BfvgODiTIUAg7AAAaSiToDeLEiy2oWcQ4kcFGjhMjYgwCADs=';
	img_lv[11] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWAMQAAEBCAP/7JdXRALKcAP7+6mZ5AP//IdC2AKiTAO/qAP7xV7y4APLVB7qhAP/z'+'gf/6CCAgIPnnRL+sAP///97aANXRAO3YAK+sAP/6ErWdAMjEAOvmAK2YAP/mAd7aAP///yH5BAEA'+
	'AB8ALAAAAAAXABYAAAW54PcVZGmepSgWRuu+sFusT23fOD4XSd9TwI0vAaQIewVIQcAUaDwBjKb5'+'jE6ZycJie6kQJooL1wsWb7OS9MDiAA/UbHdagp4POnI1XvFO19McexxzgWCDfkpzEoUKh4uCc3+L'+
	'EYaElI2RiYQKlYCcmIgFGaMZHAcMDRykpqiqo1mkowizA7GzCLWvECOxvb6kSbsjKKK+JRDCIsjL'+'yL3MyCrR0rEAANLX16TV2Nwqo9vd3Rng4d3W4SEAOw==';
	img_lv[12] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWANUAAEBCAPz4Lr+vAK+sAP/5wGZ5AP//Ie/qAP/zgenkAKeSAP///7WdAP/nF/7z'+'q97aAP7xV7y4AP7+6vLVB9XRAP/6CCAgIL+sAP7xa7KcAP3rQ//zldXRAPrnBf381sjEAOvmAOXH'+
	'AN7aAPnnRL2fAP/n5//8TdC2AKyaAO3YAP/mAf/8c//7Jf7yl//6EsKtAP///wAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAADAALAAAAAAXABYAAAbfQBis'+
	'QCwaj0WhsGBoOp9QZ2FZqVqvWOy0cOgeHmCQGAQug7wFS4HC/ohYrk87sXI4THJ2uhCJDDgSCxAD'+'fhALh4cBhBF7FxcZKQiCGY8IGCkoDQsajheNjhkqk6AopRseL52fFygdgiiODCgCCBKYqmqdra+O'+
	'rQQEKQoKuAW6I7woGAsSCHYOxAzRKIYQKLIEy84tGdx70bInEwLWKBMhwujcGd7fpSjq6t/yaUPy'+'9vffaRZLSAX4RRb2KQlIMKC9ggGVKFwoDwCAhRAhfnMYsaKSaBQtWmSQUaPFhxqDAAA7';
	img_lv[13] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWANUAAEBCAPzpLsjEAK+sAP7+6mZ5AO3YAP7xa///If/6CKeSAP/5rN7aALWdAP/6'+'EvflWr+sANXRAP/5wO/qACAgILGjAP32lv////LVB/3rQ/XZMdXRANC2AP381r2rALy4AP/zgfTX'+
	'HP7xV//8TenkAOvmAP/7Jf/mAdfBAP/WQqyaAP/8Yb2fAP/0l97aAP/nF////wAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAADAALAAAAAAXABYAAAblQBis'+
	'QCwaj0WhsIBoOp9QZ2GZqFqvWOy0MOlOGOCSuAQul7wFSmHDFrhMDkGbNGotVnJ2uvD5DCIEFyID'+'fiIXh4cBhB97EBAVBiCCFY8tBwYqLxcZlBCNjhUnk6AVKBkdCyoqjp+PoiKdqguIEh6sao6ugqsV'+
	'ASceCgaHJ7cFuSoZuxCiFsDJBLaeag3UKoYiKtQSiBcdBtQNe+AqHBge2Q0KGg8PIQoK4OLjquAN'+'qvT1aUP1/P3xFBSWICngrwhAJTAAKgTIb+FBhBCF1AMAIKJFhOAoXtwIg5pGjhcbfAR5sSLHIAA7';
	img_lv[14] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWANUAAEBCAPnnRL+vALCtAP381mZ5AP//Ie/qAP7xa9C2AKiTAP74q7WdAN7aAP/7'+'JfLVB////7y4ANXRAP/6CCAgIL+sAOrlAP/zgf7xV7GjAP/5wNXRAP7+6v/6EsjEAKyaAOvmAL2f'+
	'AN7aAP/8Tf/mAf/n58KtAP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACcALAAAAAAXABYAAAbZwNOp'+
	'QCwaj0WhsGBoOp9QZ2E5qVqvWOy0cOgeGmCQ1xv2FigFidojcnQ86rVn5ICrz4VIZLDhQDADensW'+'BH+BengVFRkWF38ZiowcCI+KFYmRJJUZJhoaH5WKmIuaGB8VHwgcCQp/H6eXaJYZpacWEBwaELt/'+
	'orKKHwF/ChUCGgsIjgsYAr4FDNAfGK7Rrw/DCtB40AwKCQ8C2dwKAuDiDNvjCufq7GdD3PHy82cU'+'S0jP9EQU9kr8//zkAeSnpKDBeAAAGFy4kFtChhCVQHsYMSIDihUjKqwYBAA7';
	img_lv[15] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWANUAAEBCAPXZMb+vAK+sAP/5wGZ5AP//If7xa+vmANC2AKeSAP/6Ev///7WdAPfl'+'Wv/5rL2fAP/6CPLVB7y4AP/7JSAgIL+sAN7aAO3YAP381tXRANXRAPnnRLKcAPfyAP/zgcjEAP7x'+
	'V//sLP7+6v/mAayaAP/8Yd7aAP/7OPz3AMKtAP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACsALAAAAAAXABYAAAbowNWq'+
	'QCwaj0WhsGBoOp9QZ2EZqVqvWOy0gOgiLmDvF0z2FiqFjRp0oixA69RigTKl4JtzYTIZaEYMIQN9'+'GgyGDA8agxN6FhYdGB+BHY8iDCQlmSUNjo2OHSSTjwcMIh8PHyqUFp4WJaEhJa4PDAQhtA+yrGiO'+
	'rrCyJQIiCsSGuq0lHIHADxkJCsq5nWgN1SUhy9UEh7UCHd961Q0lCRICmw0KAQ4OEsTfHeHimvDf'+'xAod4g1nQ/r+/+LOVFiCpADAIhUGKknIMKG/hgmVSJyoDwCAiRgxirOYsaOSahw9emwQUqTHiyKD'+
	'AAA7';
	img_lv[16] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWANUAAEBCAPzlQsjEAKypAP7+6mZ5AP//IdfBAP/zgf/6CKeSAP/5rLWdAO/qAP/m'+'A7+sAN7aAP////LVB/flWrKcACAgINXRAP/5wNC2AOXHALy4AP37lr+vANXRAPTXHP7xa/381uvm'+
	'APz3AP/7Ja6eAP7xV72fAP/mAf/n5//9jN7aAP/WQv/6Eu3YAP///wAAAAAAAAAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAC4ALAAAAAAXABYAAAblQJer'+
	'QCwaj0WhsGBoOp9QZ2GZqFqvWOy00Og2IOCQ9xseFyoFi1qgGrEEaotAlFLB4+eCRkPqECIlA3sk'+'HAQbgnt7eQ8PFC0IgBSMJBsEBySYjA+LkyeRjQ4RCB8LCAeSm2iaJJ4lJA+UEREXIBELr6kFq62v'+
	'JLMnChyyuJywAYC9BAQYCscbxGgM0iQlyNLHsrMcJNJ50gwKGBIcCtIKGRMTHgoKFO7e3+zt7hTy'+'7d8MZ0P4/P3fZxWWICngr0iFgEoOKjzIb+FBJRAj4gMAIKJFi98oXtyoRJpGjhwZfATJsSLIIAA7';
	img_lv[17] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWANUAAEBCAPvkLb2rAK+sAP/+wP//IWZ5ANC2AP/zge/qAKiTALy4AP////7xV/LV'+'B97aALWdAP/7JdXRAP7+6v/5rP/6CCAgIL+sAPrpbO3YAP/6ErGjAPrtRdXRAMjEAOvmAKyaAN7a'+
	'AMKtAP3xlv/8df/mAb2fAP/sLNa4AP/dvf/n5/z3AP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACwALAAAAAAXABYAAAbeQBbL'+
	'QCwaj0Wh0FBoOp9Qp2FZqVqvWOzUkOgmHuCPOPwJew0Wg2TtCUU0HolnRfJ4NPC1BG1YLAYdEwwN'+'A38UDAQMihSFC3wXFxsZCIMbkYcNJSeVkI+QGyWcG4cgIBQTIpYXnpGhDZYbJxwKriCQq2m3oJyR'+
	'GxsjDB2quAa3IByDtpAgAojKnWkQ0iANydIQIAEMGCDXEHzXCgcOAgrh4+Xe4OEK5t7t7tdoQ971'+'9vIWFktIBvdF+UpY5BuYrx5BgAETCvEGAIDChwGvNYRIkYW0iRUhQsCYEaLDikEAADs=';
	img_lv[18] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWANUAAEBCAPnnRMjEAK+sAP381mZ5AOznAP32lv//If/6CKiTAPTXHLWdAN7aAPv4'+'bf/////+wL+sAO/qAPLVByAgILGjANXRAP/zgf/5rPXZMfflWv7+6tC2AL+vALy4ANXRAP/mAevm'+
	'AP/7Ov/7Jf7xV//8Tf/6Er2fAP/n58GuAK+dAP/dvd7aAP///wAAAAAAAAAAAAAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAC0ALAAAAAAXABYAAAbowFar'+
	'QCwaj0WhsIBoOp9QZ2GZqFqvWOy0IOlKGuCQOAQuN8YFSsHCFrBGJkFbdMAcSiy5JV3weAYfGw8k'+'A38XDw4kEA8bBoV8EREVBockFZIPDwYgEASWkZCRFSCDlxUOmQ8YKSqREaGSpJ+TG4KqHZevaq6j'+
	'pREdGxAdIAQPF7mwKgG+EYgKCqgHrboFDNYqJIMq24sQiwQGFdZ81gwKHBMdCtYKGRoaC+rl5OXP'+'6/X29+MUQ+X+/wDT8BuCpFpAIhQGCknIMOG/hgmVSJzoDwCAiRgxlrOYsaMSaxw9emQQUqTHiyKD'+
	'AAA7';
	img_lv[19] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWANUAAEBCAPnnRLqhAK+sAP381v//IWZ5AOvmAP/zgdXRAKiTAPTXHP///7WdAP/6'+'CO3YAP/5rPfyAN7aALy4AP/6EtXRAL+sACAgIP/8Tf7+6rGjANC2APLVB8jEAP7xV//7Jf3xlqya'+
	'AMGuAP/n597aAPXZRf/8Yda4AP/mAb2fAP///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAACoALAAAAAAXABYAAAbeQJXK'+
	'QCwaj0Wh0FBoOp9Qp2HpqFqvWOzUcOgeJGDvF0z2Gi6GirpD+lA6axIGAjGR4JWzYTIZJDIMHgN9'+'CQQEEIAQgxN6FhYaDwiBGo8QBCEhDwwMlBaNjhook48MBCKYpZ2fj6IelBoQpYgMCKpojqyjGiIe'+
	'ECCACbYGDcQhAYEhxZgLtMnEesQNIR7I0SECGRkbGtHQxAobHAIK0eAlC+TdaNENCu7s7e/sZ0Pw'+'9vdnF0tIw/ZFF/qUABwIEB5BgEoSKmQHAIDChw+jNYRIUQmxiRUrNsCYsaLDjEEAADs=';
	img_lv[20] = 'data:image/gif;base64,'+
	'R0lGODlhFwAWANUAAEBCAPXZRcjEAKypAP381mZ5AOXHAP37lv//If/6CKShAP/nF/77a////97a'+'ALWdAP/5wNXRAPXTBfz2ru/qACAgIP/zgb+sAPz4LrGjAP7+6vflWt7aALy4AL2rAP/8Tf/mAevm'+
	'AMGuANfBAP3rQ6yaAOnkAKeSAOzXAP/n5/vuWc/LAP7yl//8c/v2C72fAP/WQv/7OsaqAP///wAA'+'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAADMALAAAAAAXABYAAAb0wNms'+
	'QCwaj0WhsIBoOp9QZ2GZqFqvWOy0QOlSHGBwaBwWjwuVQmQtMLUmk49gJeB84DHBGl3odDIqDYKC'+'GAMDB4MNDAMdfBcXGRYMKCULDSQlKBoEIyCCIheOjxklpSwEIiUQBKUlFg0goWmPFw8lHhYaKCco'+
	'DSolFyWBKLIFtBkgEBC7J54WrROsxaMMDRoWcBMeggESiLHFD7YQ1tkswoMaCxkZD3ziJRIGJ/T0'+'7BIbAR4n4u5p/aX6CWxVQiCaIQITKuyHpsISJAUWFqngUAnFixQTYqSopKNHgQAAeBw5sl9IkiiV'+
	'iDuZMuUDli1TimwZBAA7';

	Pika_prepareForDisplayBuildStatus();//Lv0表示

	var xybld_a = new Array();
	var allbld = $a("//li/span[@class=\"buildStatus\" and contains(text(),\"建設\")]/a");
	for(var idx=0 ; idx<allbld.length ; idx++) {
		var tmp = allbld[idx].href.match(/x=([\-0-9]+).*y=([\-0-9]+)/);
		if( tmp != null ) {
			xybld_a.push(tmp);
		}
	}



	allbld = $a("//li[contains(text(), \"削除中\")]/span[@class=\"buildStatus\"]/a");
	var xybld_d = new Array();
	for(var idx=0 ; idx<allbld.length ; idx++) {
		var tmp = allbld[idx].href.match(/x=([\-0-9]+).*y=([\-0-9]+)/);
		if( tmp != null ) {
			xybld_d.push(tmp);
		}
	}


	var allarea = $a("//area");
	for(var idx=0 ; idx < allarea.length ; idx++) {
		var title = allarea[idx].getAttribute("title").match(/^(.*) LV\.([0-9]+)$/);
		if( !title ) {
			title = [allarea[idx].getAttribute("title"), allarea[idx].getAttribute("title"), 0];
		}
		if( costs[title[1]] ) {
			if(costs[title[1]][title[2]]) {
					var xy = allarea[idx].getAttribute("href").match(/^.*(?:\?|&)x=([\-0-9]+)&y=([\-0-9]+)+(?:&[^=]+=[^&]+)*.*$/);
				var level = parseInt(title[2],10);
				var blding = 0;
				var dlting = 0;

				//console.log(xy[1] +"#"+xy[2]);

			   for ( var xxx=0 ; xxx < xybld_a.length ; xxx++){
					if( xy[1] == xybld_a[xxx][1] && xy[2] == xybld_a[xxx][2] ) {
						level ++ ;
						blding += 2;
					}
				}
				for ( var xxx=0 ; xxx < xybld_d.length ; xxx++){
					if( xy[1] == xybld_d[xxx][1] && xy[2] == xybld_d[xxx][2] ) {
						dlting ++;
					}
				}
				try {
					if( costs[title[1]].length <= level || // maxinum level reached
						RES_NOW.wood < costs[title[1]][level][0] ||
						RES_NOW.stone< costs[title[1]][level][1] ||
						RES_NOW.iron < costs[title[1]][level][2] ||
						RES_NOW.rice < costs[title[1]][level][3] ) {
							//lvを黄色に
							var thisimg = getLevelImageHTML(xy[1], xy[2], "mapicon");
							if( thisimg  ) {
								thisimg.src = img_lv[parseInt(title[2],10)];
							}
					}
				}catch(e) {
					GM_log("catched");
				}
				if( (blding || dlting) && !OPT_PIKA_BLINKBLD ) {
					//建築中
					var thisimg = getLevelImageHTML(xy[1], xy[2], "mapicon");
					if( thisimg  ) {
						thisimg.style.outlineColor = (blding) ? "red" : "blue";
						thisimg.style.outlineStyle = "dotted";
						thisimg.style.outlineWidth = "2px";
					}
				}
			}
		}
	}
	if( OPT_PIKA_BLINKBLD) Pika_displayBuildStatus();

	function getLevelImageHTML(x, y, cls) {
		var xdom = "";
		var no = (101 + parseInt(x,10) * 7 + parseInt(y,10)).toString().substr(-2);
		xdom = "//img[@class=\"" + cls + no + "\"]";

		return $x(xdom, $("maps") );
	}
}


//////////////////////
//メモ処理
//////////////////////
function disp_memo()
{
	var icon_memo = 'data:image/gif;base64,'+
		'R0lGODlhEQAPAKIAAP///+np6dXV1VpaWlhYWEVFRURERDMzMyH5BAQUAP8ALAAAAAARAA8AAAM7'+
		'eLrcXGTIOYo7RITNAyEWMwRAaQIj0YynOaAr2aKwKLfvEM+0bvO53Sz4G9YWEMrEcCziLknlwHCp'+
		'NhIAOw==';

	var cnt = parseInt(OPT_MEMO_COUNT, 10);
	if( isNaN(""+cnt) || cnt < 1 ) cnt = 1;
	if( cnt > 5 ) cnt = 5;
	for(var i=0 ; i<cnt ; i++){ createMemoTab(i); }

	function createMemoTab(no)
	{
	if( !no ) no = "";

	var title = "メモ";
	if( no ) title += (no +1 );
	var elms = ccreateSideBox("beyond_sidebox_memo" + no, icon_memo, title);

	var ta = d.createElement("textarea");
	ta.id = "beyond_memobox" + no;
	ta.rows = OPT_MEMO_HEIGHT;
	ta.cols = OPT_MEMO_WIDTH;

	if (isNarrow) {
		ta.rows = OPT_MEMO_HEIGHT - 1;
		ta.cols = OPT_MEMO_WIDTH - 4;
	}

	ta.style.fontSize= OPT_MEMO_FONT_SIZE + "px";
	ta.value= cloadData( "memo" + no, "", true );

	elms.sideBoxInner.appendChild(ta);


	var sv = d.createElement("a");
	sv.href = "javascript:void(0);";
	sv.innerHTML = "保存";
	$e(sv, "click", function() {
		var memoBox = $("beyond_memobox" + no);
		if( memoBox ) {csaveData( "memo" + no, memoBox.value, true );alert("保存しました");}
	});
	var dv = d.createElement("div");
	dv.appendChild(sv);
	elms.sideBoxInner.appendChild(dv);
	}

}
//////////////////////
//拠点リンク機能
//////////////////////
function disp_baseLink()
{
	var elm = $x('id("lodgment")/div[@class="floatInner"] | //div[@class="sideBoxInner basename"] | //div[@class="floatInner clearfix"]');
	if( !elm ) return;

	var bases = $a("//li/child::*", elm);

	for( var idx=0 ; idx < bases.length ; idx++) {
		addBaseLink(bases[idx]);
	}

	function addBaseLink(elem) {

		var thistitle = elem.title;
		if( !thistitle ) return;

		var xy = thistitle.match(/^.*\(([\-0-9]+)\,([\-0-9]+)+\)$/);

		if( !xy ) return;

		var a_m, a_v, a_n;

		var a_m_img = d.createElement("img");
		a_m_img.style.paddingLeft = "3px";
		a_m_img.style.paddingTop = "3px";
		a_m_img.src = img_map;
		var a_v_img = d.createElement("img");
		a_v_img.style.paddingLeft = "3px";
		a_v_img.style.paddingTop = "3px";
		a_v_img.src = img_mura;
		var a_n_img = d.createElement("img");
		a_n_img.style.paddingLeft = "3px";
		a_n_img.style.paddingTop = "3px";
		a_n_img.src = img_naisei;

		a_m = d.createElement("a");
		a_m.href = caddSessionId("/map.php?x=" + xy[1] + "&y=" + xy[2]);
		a_m.title = "マップ(" + xy[1] + "," + xy[2] + ")" ;
		a_m.appendChild(a_m_img);

		a_v = d.createElement("a");
		a_v.title = "表示";
		a_v.appendChild(a_v_img);
		a_n = d.createElement("a");
		a_n.title = "内政";
		a_n.appendChild(a_n_img);

		if( elem.href ) {
			var id = elem.href.match(/^.*\?village_id=([0-9]+).*$/);
			if( id ) {
				a_v.href = caddSessionId("/village_change.php?village_id=" + id[1] + "&from=menu&page=/village.php#ptop");
				a_n.href = caddSessionId("/village_change.php?village_id=" + id[1] + "&from=menu&page=/card/domestic_setting.php#ptop");
			}
		} else {
			a_v.href = caddSessionId("/village.php#ptop");
			a_n.href = caddSessionId("/card/domestic_setting.php#ptop");
		}

		var spn = d.createElement("span");
		spn.style.noWrap = true;
		spn.appendChild(a_v);
		spn.appendChild(a_m);
		spn.appendChild(a_n);
		elem.parentNode.insertBefore(spn, elem.nextSibling);

	}
}

//////////////////////
//領地リンク機能
//////////////////////
function disp_mapLink()
{

	//暫定的にsplit("\n")で3なら領地リンク、4なら君主リンクに
	if( location.pathname == "/land.php" ) {
		jQuery.noConflict();
		j$ = jQuery;

		j$("#tMenu_btnif a").attr("style", "margin-bottom:0px !important;");
		j$("#tMenu_btnif ul").eq(0).before('<div id="add_landlink"><br><a class="easy" style="margin-bottom: 0px !important;">領地リンクの追加</a></div>');
		j$("#add_landlink").bind("click",
			function() {
				saveMapLink();
			}
		);
	}else if( location.pathname == "/user/" ) {

		var table = $x("//table[@class=\"commonTables\"]");
		if( table ) {
			var lnk = d.createElement("a");
			lnk.href = "javascript:void(0);";
			lnk.innerHTML = "君主リンクの追加";
			$e(lnk, "click", function() {saveMapLink();});
			table.parentNode.insertBefore(lnk, table.nextSibling);
		}
	}


	var icon_map = 'data:image/gif;base64,'+
				'R0lGODlhEQAPALMAANO3SayTQ3drPFxQsFNTUUA3uTMzMxoamBgYnxsNxg0G8ggC9AAA/wAAAAAA'+
				'AAAAACH5BAQUAP8ALAAAAAARAA8AAARL0MhJq50InVsT+wknIctnIhZZmmZYIWy8CAFATLGpADwQ'+
				'TCuGYljo9W4Gz2dnNP4MMNOgaQRKqT3BJJFACLC9C1bLqfWeIpqATIkAADs=';

	var elms = ccreateSideBox("beyond_sidebox_xylink", icon_map, "領地/君主ﾘﾝｸ");
	elms.sideBoxInner.id = "beyond_sidebox_xylink_inner";

	resetMapLinks();


}

function saveMapLink()
{
	if( location.pathname == "/land.php" ) {
	var allDivs, thisDiv;
	var v_name = "";

	var basename = $x("//span[@class=\"basename\"]");

	var xy = location.search.match(/^\?x=([\-0-9]+)\&y=([\-0-9]+)+$/);

	if( basename ) {
		v_name = basename.innerHTML;
		if( v_name =="空き地" ) {
			v_name += xy[1] + "," + xy[2];
		}
	}

	v_name = prompt("名前を入力してください", v_name);
	if( !v_name ) return;

	var maplinks = cloadData( "links", 0, true );
	var value = v_name + "\n" + xy[1] + "\n" + xy[2];
	csaveData( "link" + maplinks  , value, true );
	maplinks++;
	csaveData( "links"	, maplinks, true );

	resetMapLinks();

	}else if( location.pathname == "/user/" ) {
	var user_id = URL_PARAM.user_id;
	var tmp = d.body.innerHTML.match(/<td>君主<\/td>[^<]*?<td>(.+)<\/td>/);
	if( !tmp ) return;
	var user_name = tmp[1];

	var comment = "";

	disp_name = prompt("名前を入力してください", user_name);
	if( !disp_name ) return;

	comment = prompt("コメントを入力してください", comment);

	var maplinks = cloadData( "links", 0, true );
	var value = user_id + "\n" + user_name + "\n" + disp_name + "\n" + comment;
	csaveData( "link" + maplinks  , value, true );
	maplinks++;
	csaveData( "links"	, maplinks, true );

	resetMapLinks();

	}
}

function configMapLinkClose()
{
	var elem = $("beyond_mapLinkWindow");
	if( !elem ) return;
	$("beyond_floatpanel").removeChild(elem);
}

function configMapLink(n, evt)
{
	var tmp = cloadData( "link" + n , "", true );
	if( !tmp ) return ;

	configMapLinkClose();

	data = tmp.split("\n");

	var lw = d.createElement("div");
	lw.id = "beyond_mapLinkWindow";
	lw.style.position = "absolute";
	if( data.length == 3 ) {
		lw.style.backgroundColor = "thistle";
		lw.style.border = "outset 2px thistle";
	}else if( data.length == 4 ) {
		lw.style.backgroundColor = "lightgreen";
		lw.style.border = "outset 2px lightgreen";
	}
	lw.style.fontSize = "10px";
	lw.style.padding = "10px";
	lw.style.zIndex = 1000;
	lw.style.left = evt.pageX - 76 + "px";//faraway 20110420(176->76)
	lw.style.top = evt.pageY - 111 + "px";

	if( data.length == 3 ) {
		ccreateTextBox(lw, "LINK_TITLE", data[0], "名称","名称",20, 0);
		ccreateTextBox(lw, "LINK_X", data[1], "X座標","X座標",10, 0);
		ccreateTextBox(lw, "LINK_Y", data[2], "Y座標","Y座標",10, 0);
	}else if( data.length == 4 ) {
		var dv = d.createElement("div");
		dv.innerHTML = "id=" + data[0] + "　　" + data[1] + "<br>";
		lw.appendChild(dv);
		ccreateTextBox(lw, "LINK_TITLE", data[2], "表示名","表示名",20, 0);
		ccreateTextBox(lw, "LINK_COMMENT", data[3], "コメント","コメント",20, 0);
	}
	//設定ボタン
	ccreateButton(lw, "保存", "内容を保存します", function() {
		var v = "";
		if( data.length == 3 ) {
			v = cgetTextBoxValue("LINK_TITLE") + "\n"
				+ cgetTextBoxValue("LINK_X") + "\n"
				+ cgetTextBoxValue("LINK_Y");
		}else if( data.length == 4 ) {
			v = data[0] + "\n" + data[1] + "\n"
				+ cgetTextBoxValue("LINK_TITLE") + "\n"
				+ cgetTextBoxValue("LINK_COMMENT");
		}
		csaveData( "link" + n  , v, true );
		configMapLinkClose();
		resetMapLinks();
	});

	//削除
	ccreateButton(lw, "削除", "削除", function() {
		if(!confirm("削除してよろしいですか？") ) return false;

		var maplinks = cloadData( "links", 0, true );
		for(var i = n+1 ; i < maplinks ; i++) {
			var tmp = cloadData( "link" + i, "", true );
			csaveData( "link" + (i-1), tmp, true );
		}
		csaveData( 'links'	, maplinks-1, true );
		configMapLinkClose();
		resetMapLinks();
	});

	//上に移動
	if( n != 0 ) {
		ccreateButton(lw, "▲", "上に移動", function() {
			var tmp = cloadData( "link" + (n-1), "", true );
			csaveData( "link" + (n-1), cloadData( "link" + n, "", true ), true );
			csaveData( "link" + n, tmp, true );
			configMapLinkClose();
			resetMapLinks();
		});
	}
	//下に移動
	var maplinks = cloadData( "links", 0, true );
	if( n + 1 < maplinks ) {
		ccreateButton(lw, "▼", "下に移動", function() {
			var tmp = cloadData( "link" + (n+1), "", true );
			csaveData( "link" + (n+1), cloadData( "link" + n, "", true ), true );
			csaveData( "link" + n, tmp, true );
			configMapLinkClose();
			resetMapLinks();
		});
	}

	//閉じる
	ccreateButton(lw, "閉じる", "閉じる", function() {configMapLinkClose();});

	$("beyond_floatpanel").appendChild(lw);
}

function resetMapLinks()
{
	var ul = $("beyond_sidebox_xylink_ul");
	if( ul ) {
		ul.parentNode.removeChild(ul);
	}
	ul = d.createElement("ul");
	ul.id = "beyond_sidebox_xylink_ul";

	var maplinks = cloadData( "links", 0, true );
	for(var i=0 ; i<maplinks ; i++) {
		var tmp = cloadData( "link" + i , "", true );
		if( tmp != "" ) {
			var li = d.createElement("li");

			var data = tmp.split("\n");
			if( data.length == 3 ) {
				//領地リンク
				var link1 = d.createElement("a");
				link1.href = caddSessionId("/land.php?x=" + data[1] + "&y=" + data[2] + "#ptop");
				link1.title = "表示(" + data[1] + "," + data[2] + ")";
				link1.innerHTML = data[0];
				link1.style.fontSize = OPT_MAPLINK_FONT_SIZE + "px";

				var link2 = d.createElement("a");
				link2.href = caddSessionId("/map.php?x=" + data[1] + "&y=" + data[2] + "#ptop");
				link2.title="マップ(" + data[1] + "," + data[2] + ")";

				var a_m_img = d.createElement("img");
				a_m_img.src = img_map;
				link2.appendChild(a_m_img);

				var m = "";
				var dist = cgetDistanceFromBase(data[1], data[2]);
				if( dist != -1 ) {
					m ="　距離[" + dist.toFixed(2) + "]";
				}
				var link3 = d.createElement("a");
				link3.href = caddSessionId("/facility/castle_send_troop.php?x=" + data[1] + "&y=" + data[2] + "#ptop");
				link3.title = "兵を送る(" + data[1] + "," + data[2] + ")" + m;

				var a_s_img = d.createElement("img");
				a_s_img.src = img_ken;
				link3.appendChild(a_s_img);

				var link4 = d.createElement("a");
				link4.href="javascript:void(0)";
				link4.title="設定";

				var a_d_img = d.createElement("img");
				a_d_img.src = img_hanma;
				link4.appendChild(a_d_img);
				(function(n){
					$e(link4, "click", function(event){configMapLink(n,event);});
				})(i);

				li.appendChild(link1);
				li.appendChild(link2);
				li.appendChild(link3);
				li.appendChild(link4);
				ul.appendChild(li);
			}else if( data.length == 4 ) {
				//君主リンク
				var img = d.createElement("img");
				img.src = img_user;
				li.appendChild(img);

				var link1 = d.createElement("a");
				link1.href = caddSessionId("/user/?user_id=" + data[0] + "#ptop");
				link1.title = data[3];
				link1.innerHTML = data[2];
				link1.style.fontSize = OPT_MAPLINK_FONT_SIZE + "px";

				var link2 = d.createElement("a");
				link2.href=caddSessionId("/message/new.php?user_id=" + data[0] + "#ptop");
				link2.title="[" + data[1] + "]宛に書簡を送る";

				var a_m_img = d.createElement("img");
				a_m_img.src = img_mail;
				link2.appendChild(a_m_img);

				var link3 = d.createElement("a");
				link3.href="javascript:void(0)";
				link3.title="設定";

				var a_d_img = d.createElement("img");
				a_d_img.src = img_hanma;
				link3.appendChild(a_d_img);
				(function(n){
					$e(link3, "click", function(event){configMapLink(n,event);});
				})(i);

				li.appendChild(link1);
				li.appendChild(link2);
				li.appendChild(link3);
				ul.appendChild(li);
			}
		}
	}

	$("beyond_sidebox_xylink_inner").appendChild(ul);

}

//////////////////////
//領地リンクの読み込み・保存機能
//////////////////////
function mapLinkList(evt)
{
	if( $("beyond_SaveMapLinkWindow") ) return;

	var mc = d.createElement("div");
	mc.id = "beyond_SaveMapLinkWindow";
	mc.style.position = "absolute";
	mc.style.backgroundColor = "blueviolet";
	mc.style.border = "outset 2px blueviolet";
	mc.style.fontSize = "12px";
	mc.style.padding = "15px";
	mc.style.zIndex = 8100+1;
	mc.style.left = evt.pageX - 250 + "px";
	mc.style.top = evt.pageY - 220 + "px";
	var ta = d.createElement("textarea");
	ta.id = "beyond_SaveMapLinkWindow_text";
	ta.rows = 10;
	ta.cols = 40;
	var txt = "";
	var maplinks = cloadData( "links", 0, true );
	for(var i=0 ; i<maplinks ; i++) {
		var tmp = cloadData( "link" + i , "", true );
		if( tmp ) {
			txt += tmp.replace(/\n/g, "\t" ) + "\n";
		}
	}
	ta.value = txt;

	mc.appendChild(ta);
	$e(ta, "keydown", function(event) {
		//TAB入力
		var kC = event.keyCode ? event.keyCode : event.charCode ? event.charCode : event.which;
		if (kC == 9 && !event.shiftKey && !event.ctrlKey && !event.altKey)
		{
			var oS = this.scrollTop;
			var sS = this.selectionStart;
			var sE = this.selectionEnd;
			this.value = this.value.substring(0, sS) + "\t" + this.value.substr(sE);
			this.setSelectionRange(sS + 1, sS + 1);
			this.focus();
			this.scrollTop = oS;
			if (event.preventDefault)
			{
				event.preventDefault();
			}
			return false;
		}
		return true;
	} );

	var sv = d.createElement("a");
	sv.href = "javascript:void(0);";
	sv.innerHTML = "保存";
	$e(sv, "click", function() {
		if( confirm("上書き保存します。よろしいですか？") == false) return;
		var  ta = $("beyond_SaveMapLinkWindow_text");
		if( ta ) {
			var lines = ta.value.split("\n");
			var saveLines = new Array();
			for( var i=0 ; i<lines.length ; i++) {
				if( lines[i] == "" ) continue;
				var dat = lines[i].split("\t");
				if( dat.length != 3 && dat.length != 4 ) {
					alert("解析エラーです。処理を中断します。\n( " + lines[i] + " )" );
					return;
				}
				//チェック
				if( dat.length == 3 ) {
					if( !dat[1].match(/[\-0-9]+/g)	|| !dat[2].match(/[\-0-9]+/g) ) {
						alert("解析エラーです。処理を中断します。\n( " + lines[i] + " )" );
						return;
					}
				}else if ( dat.length == 4 ) {
					if( dat[3] == "" && dat[1].match(/[\-0-9]+/g) && dat[2].match(/[\-0-9]+/g) ) {
						dat.pop();
					}else  if( !dat[0].match(/[\-0-9]+/g) ) {
						alert("解析エラーです。処理を中断します。\n( " + lines[i] + " )" );
						return;
					}
				}else{
					alert("解析エラーです。処理を中断します。\n( " + lines[i] + " )" );
					return;
				}
				var linedata = "";
				for( var j=0 ; j<dat.length ; j++ ){
					dat[j] = dat[j].replace(/(^\s+)|(\s+$)/g, "");
					if( linedata != "" ) {
						linedata += "\n";
					}
					linedata += dat[j];
				}
				saveLines.push(linedata);
			}

			//削除
			var maplinks = cloadData( "links", 0, true );
			for(i=0 ; i<maplinks ; i++) {
				cdelData( "link" + i, true );
			}
			//追加
			for(var i=0 ; i<saveLines.length ; i++ ) {
				csaveData( "link" + i  , saveLines[i], true );
			}
			csaveData( "links"	, saveLines.length, true );


			alert("上書き保存しました");
			resetMapLinks();
		}
	});

	var cl = d.createElement("a");
	cl.href = "javascript:void(0);";
	cl.innerHTML = "閉じる";
	$e(cl, "click", function() {
		var mc = $("beyond_SaveMapLinkWindow");
		if( mc ) {
			mc.parentNode.removeChild(mc);
		}
	});
	var dv = d.createElement("div");
	dv.appendChild(sv);
	dv.appendChild(d.createTextNode(" ") );
	dv.appendChild(cl);


	mc.appendChild(dv);
	$("beyond_floatpanel").appendChild(mc);

}

//////////////////////
//座標リンク処理
//////////////////////
function disp_XYLink()
{
	var flg_profile_xy = false;
	var flg_include_a = false;

	//1行コメント
	var comment = $a("//*[@id=\"commentList\"]//tr/td[2]");

	for(var i=0 ; i< comment.length ; i++) {
		setXYLink( comment[i] );
	}

	//各エレメント
	var targetPath = new Array();

	if( location.pathname == "/alliance/chat_view.php" ) {
		targetPath.push('//div[@class="hitokotoList2"]/p[@class="hitokoto"]'); //ac.40
	}
	if( location.pathname == "/alliance/info.php" ) {
		targetPath.push( "//tr[th[contains(text(),\"コメント\")]]/td" );
	}
	if( location.pathname == "/message/detail.php" ) {
		targetPath.push( "//tr[th[contains(text(),\"件名\")]]/td" );
		targetPath.push( "//tr[th[contains(text(),\"本文\")]]/td" );
	}
	if( location.pathname == "/bbs/res_view.php" ||
		location.pathname == "/bbs/personal_res_view.php" ) {
		targetPath.push( "//th[@class=\"mainTtl\"]/div[@class=\"threadTtl\"]" );
		targetPath.push( "//td[@class=\"contents\"]" );
		targetPath.push( "//table[@class=\"commonTables\"]//tr[2]/td[1]" );
	}
	//プロフィール画面
	if( location.pathname == "/user/" ) {
			targetPath.push( "//table[@class=\"commonTables\"]//tr[position()>12]/td[2]" );
			flg_profile_xy = true;
	}
	//

	for(var i=0 ; i< targetPath.length ; i++) {
		var elms = $a(targetPath[i]);
		for(var j=0 ; j<elms.length ; j++) {
			setXYLink(elms[j]);
		}
	}

	function setXYLink(elm) {
		var tmpHTML = elm.innerHTML;

		var reg = /[\(|（|【]([\-0-9０-９]+)( *[,&、・，] *)([\-0-9０-９]+)[\)|）|】]/g;
		if(OPT_XYLINK_NK || flg_profile_xy ) {
			reg = /([\-0-9０-９]+)( *[\,&、・，] *)([\-0-9０-９]+)/g;
		}

		var elm_child_a = null;
		if( flg_include_a ) {
			elm_child_a = $x("descendant::a", elm);
		}

		tmpHTML = tmpHTML.replace(reg, XYLinkReg );

		elm.innerHTML = tmpHTML;

		function XYLinkReg() {

			var img_send = IMG_DIR + "report/icon_go.gif";
			var img_mp = IMG_DIR + "report/icon_scout.gif";
			var m = "";
			var dist = cgetDistanceFromBase(arguments[2], arguments[4]);
			if( dist != -1 ) {
				m = "　距離[" + dist.toFixed(2) + "]";
			}
			var x = toHankaku(arguments[1]);
			var y = toHankaku(arguments[3]);
			var disp = x + arguments[2] + y;
			if( !OPT_XYLINK_NK && !flg_profile_xy) disp = "(" + disp + ")";
			var txt = '<a href="'+caddSessionId('/land.php?x=' + x + '&y=' + y + '#ptop')+'" title="表示" style="display:inline;">' + disp + '</a>';
			txt += '<a href="'+caddSessionId('/map.php?x=' + x + '&y=' + y + '#ptop')+'" title="マップ' + x + ',' + y + '" style="display:inline;"><img src="' + img_mp + '" style="width:14px; height:14px; vertical-align:middle;"></a>';
			txt += '<a href="'+caddSessionId('/facility/castle_send_troop.php?x=' + x + '&y=' + y + '#ptop')+'" title="兵を送る' + x + ',' + y + m + '" style="display:inline;"><img src="' + img_send + '" style="width:14px; height:14px; vertical-align:middle;"></a>';

			//Aの入れ子は連結し直してみる
			if( elm_child_a ) {
				txt = '</a>' + txt + '<a href="' + elm_child_a.href +  '">';
			}

			return txt;

			function toHankaku(str) {
				return str.replace(/[０-９]/g, function(str){return String.fromCharCode(str.charCodeAt(0)-65248);});
			}
		}
	}

}

//////////////////////
//兵力整形
//////////////////////
function disp_TTable()
{
	if( location.pathname == "/message/inbox.php" ||
		location.pathname == "/message/outbox.php"	||
		location.pathname == "/message/new.php" ||
		location.pathname == "/bbs/topic_view.php"	||
		location.pathname == "/facility/unit_status.php" ||
		location.pathname == "/facility/castle_send_troop.php") {
		return ;
	}

	//■仮対処
	var ta = $a("//textarea");
	for(var i=0 ; i<ta.length ; i++) {
		if( ta[i].innerHTML != "" ) return;
	}

	var targetPath = [
		"//div[@id='commentList']",
		"//table[@class='commonTables']",
		"//p[@class='hitokoto']"
	];

	for(var i=0 ; i<targetPath.length ; i++) {
		var elms = $a(targetPath[i]);
		for(var j=0 ; j<elms.length ; j++) {
			setTTable(elms[j]);
		}
	}

	function setTTable(elm) {

		var tmpHTML = elm.innerHTML;
		var reg = /剣兵\s+盾兵\s+槍兵\s+弓兵\s+騎兵\s+衝車\s+斥候.*(\n兵士\s+|\n)(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+).*(\n死傷\s+|\n)(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+).*\n.*大剣兵\s+重盾兵\s+矛槍兵\s+弩兵\s+近衛騎兵\s+投石機\s+斥候騎兵\s+武将.*(\n兵士\s+|\n)(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+).*(\n死傷\s+|\n)(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)/g;
		tmpHTML = tmpHTML.replace(reg,
			function() {
				var txt = "<table class='tables'><tr><th class='solClass2'>　</th>" +
							"<th class='solClass2'>剣兵</th><th class='solClass2'>盾兵</th><th class='solClass2'>槍兵</th><th class='solClass2'>弓兵</th>" +
							"<th class='solClass2'>騎兵</th><th class='solClass2'>衝車</th><th class='solClass2'>斥候</th><th class='solClass2'>　</th>" +
							"</tr><tr><th class='solClass2'>兵士</th>";
				for(var i = 2 ; i<= 8 ; i++) {
					txt += "<td>" + arguments[i] + "</td>";
				}
				txt += "<td>　</td>";

				txt += "</tr><tr><th class='solClass2'>死傷</th>";
				for(var i = 10 ; i<= 16 ; i++) {
					txt += "<td>" + arguments[i] + "</td>";
				}
				txt += "<td>　</td>";
				txt += "</tr>";
				// txt += "</tr></table>";
				txt += "<tr><th class='solClass2'>　</th>" +
							"<th class='solClass2'>大剣兵</th><th class='solClass2'>重盾兵</th><th class='solClass2'>矛槍兵</th><th class='solClass2'>弩兵</th>" +
							"<th class='solClass2'>近衛騎兵</th><th class='solClass2'>投石機</th><th class='solClass2'>斥候騎兵</th><th class='solClass2'>武将</th>"+
							"</tr><tr><th class='solClass2'>兵士</th>";
				for(var i = 18 ; i<= 25 ; i++) {
					txt += "<td>" + arguments[i] + "</td>";
				}

				txt += "</tr><tr><th class='solClass2'>死傷</th>";
				for(var i = 27 ; i<= 34 ; i++) {
					txt += "<td>" + arguments[i] + "</td>";
				}
				txt += "</tr></table>";
				return txt;
			} );

		reg = /剣兵\s+盾兵\s+槍兵\s+弓兵\s+騎兵\s+衝車\s+斥候.*(\n兵士\s+|\n)(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+).*\n.*大剣兵\s+重盾兵\s+矛槍兵\s+弩兵\s+近衛騎兵\s+投石機\s+斥候騎兵\s+武将.*(\n兵士\s+|\n)(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)/g;
		tmpHTML = tmpHTML.replace(reg ,
			function() {
				var txt = "<table class='tables'><tr><th class='solClass2'>　</th>" +
							"<th class='solClass2'>剣兵</th><th class='solClass2'>盾兵</th><th class='solClass2'>槍兵</th><th class='solClass2'>弓兵</th>" +
							"<th class='solClass2'>騎兵</th><th class='solClass2'>衝車</th><th class='solClass2'>斥候</th><th class='solClass2'>　</th>" +
							"</tr><tr><th class='solClass2'>兵士</th>";
				for(var i = 2 ; i<= 8 ; i++) {
					txt += "<td>" + arguments[i] + "</td>";
				}
				txt += "<td>　</td>";
				txt += "</tr>";
				// txt += "</tr></table>";
				txt += "<tr><th class='solClass2'>　</th>" +
							"<th class='solClass2'>大剣兵</th><th class='solClass2'>重盾兵</th><th class='solClass2'>矛槍兵</th><th class='solClass2'>弩兵</th>" +
							"<th class='solClass2'>近衛騎兵</th><th class='solClass2'>投石機</th><th class='solClass2'>斥候騎兵</th><th class='solClass2'>武将</th>"+
							"</tr><tr><th class='solClass2'>兵士</th>";
				for(var i = 10 ; i<= 17 ; i++) {
					txt += "<td>" + arguments[i] + "</td>";
				}
				txt += "</tr></table>";

				return txt;
			} );

		elm.innerHTML = tmpHTML;
	}
}


//////////////////////
//兵力合計
//////////////////////
function disp_Details()
{
if( location.pathname != "/alliance/detail.php" && location.pathname != "/report/detail.php") return ;
	var val = $x('//div[@id="gray02Wrapper"]/table[@class="tables"]//tr[2]/td[1]', document);
	if( typeof val == 'undefined' ){
		return;
	}
	var match_list = [/ブショーデュエルで/,/【拠点消滅】/,/【砦占領】/,/へ援軍が到着しました/,/【同盟変更】/,/(盟主|軍師|外交官|大督)(に|を)(任命|解任)されました/,/【勢力情報】.*が.*の城を破壊しました/,/【本拠地破壊】.*が.*の城を破壊しました/];
	for(var i = 0; i < match_list.length; i++){
		if( val.innerHTML.match(match_list[i]) ){
			return;
		}
	}

	var troops = [[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
				[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]] ;
	var tbls = $a("//table[@class=\"tables\"][@summary=\"防御者\"]");

	for(var i=0 ; i<tbls.length ; i++) {
		var trs = $a("descendant::tr", tbls[i]);
		if( trs.length >=7 ) {
			for(var j=0; j < 2 ; j++) {
				var tds = $a("descendant::td", trs[j+2]);
				if(tds.length != 8) continue;
				for(var k=0; k<7 ; k++) {
					troops[j][k] += parseInt(tds[k].innerHTML,10);
				}
			}
			for(var j=0; j < 2 ; j++) {
				var tds = $a("descendant::td", trs[j+5]);
				if(tds.length != 8) continue;
				for(var k=0; k<8 ; k++) {
					troops[j][k+7] += parseInt(tds[k].innerHTML,10);
				}
			}
		}
	}

	var tbl = d.createElement("table");
	tbl.className = "tables";

	var tr = d.createElement("tr");
	var th = d.createElement("th");
	th.className = "attacker";
	th.appendChild(d.createTextNode("防御合計"));
	tr.appendChild(th);
	th = d.createElement("th");
	th.className = "attackerBase";
	th.setAttribute("colspan","8");
	tr.appendChild(th);
	tbl.appendChild(tr);

	var tr = d.createElement("tr");
	var thtxt = ["剣兵","盾兵","槍兵","弓兵","騎兵","衝車","斥候","大剣兵","重盾兵","矛槍兵","弩兵","近衛騎兵","投石機","斥候騎兵","武将" ];
	var th = d.createElement("th");
	th.className = "blank";
	tr.appendChild(th);
	for(var i=0; i<7 ; i++){
		th = d.createElement("th");
		th.className = "solClass2";
		th.appendChild(d.createTextNode(thtxt[i]));
		tr.appendChild(th);
	}
	th = d.createElement("th");
	th.className = "solClass2";
	th.appendChild(d.createTextNode("　"));
	tr.appendChild(th);
	tbl.appendChild(tr);

	var hd =["兵士","死傷"];
	for(var i=0 ; i<2 ; i++) {
		var tr = d.createElement("tr");
		var th = d.createElement("th");
		th.className = "blank";
		th.appendChild(d.createTextNode(hd[i]));
		tr.appendChild(th);
		for(var j=0; j<7 ; j++){
			var td = d.createElement("td");
			td.appendChild(d.createTextNode(troops[i][j]));
			tr.appendChild(td);
		}
		var td = d.createElement("td");
		td.appendChild(d.createTextNode("　"));
		tr.appendChild(td);
		tbl.appendChild(tr);
	}

	tr = d.createElement("tr");
	th = d.createElement("th");
	th.className = "blank";
	tr.appendChild(th);
	for(var i=7; i<15 ; i++){
		th = d.createElement("th");
		th.className = "solClass2";
		th.appendChild(d.createTextNode(thtxt[i]));
		tr.appendChild(th);
	}
	tbl.appendChild(tr);

	var hd =["兵士","死傷"];
	for(var i=0 ; i<2 ; i++) {
		var tr = d.createElement("tr");
		var th = d.createElement("th");
		th.className = "blank";
		th.appendChild(d.createTextNode(hd[i]));
		tr.appendChild(th);
		for(var j=7; j<15 ; j++){
			var td = d.createElement("td");
			td.appendChild(d.createTextNode(troops[i][j]));
			tr.appendChild(td);
		}
		tbl.appendChild(tr);
	}
	if( OPT_DETAILS_UP == 0 ) {
		tbls[tbls.length-1].parentNode.insertBefore(tbl, tbls[tbls.length-1].nextSibling);
	} else {
		tbls[0].parentNode.insertBefore(tbl, tbls[0]);
	}
}


//////////////////////
//デッキ
//////////////////////
function disp_Deck()
{
	if( location.pathname != "/card/deck.php" ) return ;

	// デッキ設定の復旧(2014/12/11)
	jQuery.noConflict();
	j$ = jQuery;

	// デッキ表示方式
	var deckType = j$("select[class=sortTotal] option[selected=selected]").eq(0).val();

	// 現在の拠点の取得
	var currentVillageName = j$("div[class=sideBoxInner basename] li[class=on] span").eq(0).text();

	var selectBox = j$("select[id=deck_add_selected_village]");
	if (selectBox.length == 0) {
		return;
	}
	var selectedValue = 0;
	j$("option", selectBox).each(function(){
		if(j$(this).text() == currentVillageName) {
			selectedValue = j$(this).val();
		}
	});
	var selectBoxHtml = j$("<div>").append(selectBox.clone()).html();

	// タブ番号取得
	var labels = j$("#tab-labels a[class*=cur]").attr("href").match(/l=(\d+)#/);
	var labelNo = -1;
	if (labels != null) {
		labelNo = RegExp.$1;
	}

	// 現在のページ番号を取得
	var pageNo = 1;
	var pages = j$("div[class=rotateInfo clearfix] ul[class=pager] li:not(:has(a))").each(
		function(){
			if(j$(this).text().match(/^(\d+)$/)) {
				pageNo = RegExp.$1;
			}
		}
	);

	var base;
	if (deckType == 101 || deckType == 102) {
		// 大表示
		base = j$("div[id=cardFileList] div[class=cardColmn]");
		j$("div[class=control]", base).each(function(){
			var aTag = j$("a", this).eq(0);
			var firstA = j$("<div>").append(aTag.clone()).html().match(/Cardset_master',(\d+)/);
			if( firstA == null ) {
				j$(this).before('<div id="village_list_' + cardNo + '" style="margin: 4px 0px 4px 0px;">セット先：' + selectBoxHtml + '</div>');
				return;
			}
			var cardNo = RegExp.$1;
			j$(this).before('<div id="village_list_' + cardNo + '" style="margin: 4px 0px 4px 0px;">セット先：' + selectBoxHtml + '</div>');

			// タグをAタグからdivに書き換えて、デッキセットのbindメソッドを呼ぶ
			var divTag = aTag.replaceWith('<div id="set_deck_' + cardNo + '">' + aTag.html() + '</div>');
			j$("#set_deck_" + cardNo, this).bind("click",
				function() {
					var vid = j$("#village_list_" + cardNo + " select[name=selected_village]").val();
					var vname = j$("#village_list_" + cardNo + " select[name=selected_village] option:selected").text();
					if (confirm(vname + "にカードをセットします。よろしいですか？")) {
						setDeck(labelNo, pageNo, vid, cardNo);
					}
				}
			);
		});
	} else {
		// 小表示
		base = j$("div[id=cardFileList] div[class=cardStatusDetail label-setting-mode]");
		j$("div[class=statusDetail clearfix]", base).each(function(){
			var aTag = j$("div[class=set] a", this).eq(0);
			var firstA = j$("<div>").append(aTag.clone()).html().match(/Cardset_master',(\d+)/);
			if( firstA == null ) {
				j$(this).after('<div id="village_list_' + cardNo + '" class="otherDetail clearfix">セット先：' + selectBoxHtml + '</div>');
				return;
			}
			var cardNo = RegExp.$1;
			j$(this).after('<div id="village_list_' + cardNo + '" class="otherDetail clearfix">セット先：' + selectBoxHtml + '</div>');

			// タグをAタグからdivに書き換えて、デッキセットのbindメソッドを呼ぶ
			j$("img", aTag).eq(0).removeAttr("onclick");
			var divTag = aTag.replaceWith('<div id="set_deck_' + cardNo + '">' + aTag.html() + '</div>');
			j$("#set_deck_" + cardNo, this).bind("click",
				function() {
					var vid = j$("#village_list_" + cardNo + " select[name=selected_village]").val();
					var vname = j$("#village_list_" + cardNo + " select[name=selected_village] option:selected").text();
					if (confirm(vname + " に武将カードをセットします。よろしいですか？")) {
						setDeck(labelNo, pageNo, vid, cardNo);
					}
				}
			);
		});
	}
	// 現在拠点を自動選択
	j$("div[id*=village_list] select", base).val(selectedValue);

	function setDeck(labelNo, pageNo, vid, cardNo) {
		var ssid = j$("input[name=ssid]").eq(0).attr("value");
		var data = "ssid=" + ssid + "&target_card=" + cardNo + "&mode=set&selected_village[" + cardNo + "]=" + vid + "&p=" + pageNo;
		if( labelNo > 0 ) {
			data = data + "&l=" + labelNo;
		}
		var xh = new XMLHttpRequest();
		xh.open("POST", "http://" + HOST + "/card/deck.php", true);
		xh.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;charset=UTF-8");
		xh.onreadystatechange = function() {
			if( xh.readyState == 4 && xh.status == 200 ){
				if( labelNo > 0 ) {
					location.href = "/card/deck.php?l=" + labelNo + "&p=" + pageNo;
				} else {
					location.href = "/card/deck.php?p=" + pageNo;
				}
			}
		}
		xh.send(data);
	}
}


//////////////////////
//完了時刻の表示（建物）
//////////////////////
function disp_CompleteTimeBuild()
{
	var lastTime = cgetNow();
	var villageId = cgetCurrentVillageId();

	if( location.pathname == "/village.php" ) {
		//最終建築時間の保存
		var spans = $a('id("actionLog")//li//span[@class="buildStatus" and (contains(text(),"建設中") or contains(text(),"建設準備中"))]/../span[@class="buildClock"]');
		if (!spans || spans.length == 0) {
			cdelData("lastBuildTime"+villageId,true);
			return;
		}

		var saveDate = new Date(caddDate(lastTime, spans[spans.length - 1].innerHTML.replace(/^[\s|　]*|[\s|　]*$/,"")).replace(/-/g,"/"));
		saveDate.setMinutes(saveDate.getMinutes() + 1);
		csaveData( "lastBuildTime"+villageId, saveDate.toString(), true);
		return;
	}


	var reg = /\/facility\/facility.php|\/facility\/select_facility.php|\/facility\/castle.php/;
	if(!location.pathname.match(reg) || d.referrer.match(reg)) {
		return;
	}

	var spans = new Array();
	var tds = $a('id("gray02Wrapper")//th[contains(text(),"所要時間")]//..//td[@class="contents"]');
	for(var i=0 ; i<tds.length ; i++){
		var td = tds[i];
		var th = $x('.//th[contains(text(),"建設に必要な食糧消費量") or contains(text(),"建設に必要な資材")]', td.parentNode.parentNode);
		if (th) {
			var span = d.createElement("span");
			td.appendChild(span);
			spans.push(span);
		}
	}

	if (!spans.length) return;

	lastTime = new Date(cloadData( "lastBuildTime"+villageId, lastTime.toString(), true));

	timerfunc();

	function timerfunc() {
		var now = cgetNow();
		if (lastTime < now) {
			lastTime = now;
		}

		for(var i = 0 ; i<spans.length ; i++){
			var span = spans[i];
			var ctime = caddDate(lastTime, span.parentNode.firstChild.nodeValue);
			if( ctime ) {
				span.innerHTML = "　(" + ctime + "完了)";
			}
		}

		setTimeout(timerfunc,1000);
	}
}

//////////////////////
//完了時刻の表示（ユニット）
//////////////////////
function disp_CompleteTimeUnit()
{
	if( location.pathname == "/facility/facility.php" ) {

		//ユニット作成の最終時刻の保存
		var lastTd = $x('id("gray02Wrapper")/table[@class="commonTables"][2]//tr[last()]/td');
		if( !lastTd ) {
			cdelData("lastUnitTime",true);
			return;
		}
		csaveData( "lastUnitTime", new Date(lastTd.innerHTML.replace(/^[\s|\n|\r|\t]*|[\s|\n|\r|\t]*$/,"").replace(/-/g,"/")).toString(), true);
		return;
	}

	if( location.pathname != "/facility/unit_confirm.php" ) {
		return;
	}
	var td = $x('//table[@class="commonTables" and @summary="object"]//th[contains(text(),"作成するまでに必要な時間")]/../td');
	if (!td) {alert("ret");return;}
	var span = d.createElement("span");
	td.appendChild(span);

	var lastTime = new Date(cloadData( "lastUnitTime", null, true ));

	timerfunc();

	function timerfunc() {
		var now = cgetNow();
		if (lastTime < now) {
			lastTime = now;
		}
		var ctime = caddDate(lastTime, span.parentNode.firstChild.nodeValue.replace(/^\s+|\s+$/g, ""));
		if( ctime ) {
			span.innerHTML = "　(" + ctime + "完了)";
		}
		setTimeout( timerfunc, 1000);
	}
}

//////////////////////
//同盟表示の改善
//////////////////////
function disp_AllianceInfo()
{
	if( OPT_ALLY_XY )	allianceXY();
	if( OPT_ALLY_IS )	allianceSort();
	if( OPT_ALLY_CSV )	allianceCSV();


	//同盟表示のソート
	function allianceSort()
	{
		if( location.pathname != "/alliance/info.php" ) return;

		var sort_kind, sort_order;

		var sort_list = ["num", "str", "num", "num", "num", "str", "str"];

		for(var i=0 ; i<8 ; i++) {
			var th = $x("//table[@summary=\"ランキング\"]//tr[2]//th[" + (i+1) + "]");
			if( th ) {

				sort_kind = sort_list[i];
				if( th.id == "beyond_ally_xy" ) sort_kind = "xy";

				th.appendChild(d.createElement("br"));

				var a = d.createElement("a");
				a.href = "javascript:void(0)";
				(function(n, k){
					$e(a, "click", function(){row_sort(n, k, "asc"); } );
				})(i+1, sort_kind);

				var img = d.createElement("img");
				img.src= IMG_DIR + "trade/icon_up.gif";
				img.alt = "昇順に並べ替え";
				img.title = img.alt;
				a.appendChild(img);

				th.appendChild(a);
				th.appendChild(d.createTextNode(" "));
				a = d.createElement("a");
				a.href = "javascript:void(0)";
				(function(n, k){
					$e(a, "click", function(){row_sort(n, k, "dsc"); } );
				})(i+1, sort_kind);

				img = d.createElement("img");
				img.src= IMG_DIR + "trade/icon_down.gif";
				img.alt = "降順に並べ替え";
				img.title = img.alt;
				a.appendChild(img);

				th.appendChild(a);

			}
		}

		function row_sort(col, kind, order) {
			var tbl = $x("//table[@summary=\"ランキング\"]");
			var trs = $a("descendant::tr[position()>2]", tbl);
			sort_kind = kind;
			sort_order = order;

			var strs = new Array();
			if( col == 2 || kind == "xy" ) {
				//名前 or座標はaの下
				for(var i=0; i<trs.length ; i++) {
					var td = $x("descendant::td[" + col + "]", trs[i]);
					var a = $x("descendant::a", td);
					if( a ) strs.push({"node":trs[i], "value":a.innerHTML});
					else strs.push({"node":trs[i], "value":""});
				}
			} else {
				for(var i=0; i<trs.length ; i++) {
					var td = $x("descendant::td[" + col + "]", trs[i]);
					strs.push({"node":trs[i], "value":td.innerHTML});
				}
			}

			strs.sort(row_cmp);

			for(var i=0 ; i<trs.length ; i++) {
				strs[i].node.parentNode.removeChild(strs[i].node);
				tbl.appendChild(strs[i].node);
			}
		}

		function row_cmp(a, b)
		{
			var ret = 0;
			if( sort_kind == "num" ){
				ret = parseInt(a.value, 10) - parseInt(b.value, 10);
			}else if (sort_kind == "xy") {
				//座標
				if( !a.value && !b.value ) ret =  0;
				else if( !a.value ) ret = 1;
				else if( !b.value ) ret = -1;
				else {
					var a_xy = a.value.split(",");
					var b_xy = b.value.split(",");
					ret = ( Math.pow(parseInt(a_xy[0], 10), 2) + Math.pow(parseInt(a_xy[1], 10), 2) ) -
						  ( Math.pow(parseInt(b_xy[0], 10), 2) + Math.pow(parseInt(b_xy[1], 10), 2) );
				}
			}else {
				if( a.value == b.value ) {
					ret = 0;
				} else if( a.value > b.value ) {
					ret = 1;
				}else {
					ret = -1;
				}
			}
			if( sort_order == "dsc") {
				ret = 0 - ret;
			}
			return ret;

		}
	}

	//同盟員座標表示
	function allianceXY()
	{
		//座標の収集
		if( location.pathname =="/user/" ) {
			if( USER_ID || URLPARAM.user_id ) {
				var uid, aid;
				if( URL_PARAM.user_id ) uid = URL_PARAM.user_id;
				else uid = USER_ID;
				var allytd = $x("//table[@class=\"commonTables\"]//tr[3]//td[4]");
				if( !allytd ) return;
				var aids = allytd.innerHTML.match(/\/alliance\/info\.php\?id\=(\d+)/);
				if( !aids ) return;
				aid = aids[1];
				var table = $x("//table[@class=\"commonTables\"]");
				if( table ) {
					var xy = getXYfromUserHTML(table.innerHTML);
					if( xy ) {
						csetUserXY(aid, uid, xy.x, xy.y);
					}
				}
			}
		}


		//表示
		if( location.pathname == "/alliance/info.php" ) {
			if( ALLY_ID || URL_PARAM.id ) {
				var aid;
				if( URL_PARAM.id ) aid = URL_PARAM.id;
				else aid = ALLY_ID;

				var head1 = $x("//table[@summary=\"ランキング\"]//tr[1]//th[@class=\"ttl\"]");
				if( head1 ) {
					head1.setAttribute("colspan", parseInt(head1.getAttribute("colspan"),10) + 1 + "");
				}
				var head2 = $x("//table[@summary=\"ランキング\"]//tr[2]");
				if( head2 ) {
					var th = d.createElement("th");
					th.className = "all";
					th.style.width = "110px";
					th.id = "beyond_ally_xy";
					th.innerHTML = "座標";
					var lnk = d.createElement("a");
					lnk.href = "javascript:void(0)";
					lnk.innerHTML ="(GET)";//faraway110518ここが同盟の場所
					lnk.style.fontSize = "9px";

					var running = false;

					$e(lnk, "click", function() {

						if( running ) return ;

						if( confirm("同盟員の情報を一気に取得するためサーバに負荷をかけます。\n何度も実行するとDOS攻撃と同じなので、実行には注意して下さい") == false ) return;
						running = true;
						var trs = $a("//table[@summary=\"ランキング\"]//tr[position()>2]");

						var now_num = 0;
						var all_num = trs.length;
						window.setTimeout(timerFunc, 0);

						function timerFunc()
						{
							var idtd = $x("descendant::td[2]",trs[now_num]);
							if( !idtd ) {
								alert("ページフォーマットが変わったみたい");
								return ;
							}
							var ids = idtd.innerHTML.match(/\/user\/\?user_id\=(\d+)/);
							if( !ids ) {
								alert("ページフォーマットが変わったみたい");
								return ;
							}

							var tmp = $("beyond_xylink_" + ids[1] );
							if( tmp.innerHTML != "　" ) {
								now_num ++;
								if( now_num < all_num ) {
									window.setTimeout(timerFunc, 0);
								}else{
									running = false;
									alert("全ての座標を取得しました");
								}
								return ;
							}

							cajaxRequest("/user/?user_id=" + ids[1], "GET", "", function(req) {
								var xytd = $("beyond_xylink_" + ids[1] );
								if(xytd) {
									var xy = getXYfromUserHTML(req.responseText);
									if( xy ) {
										csetUserXY(aid, ids[1], xy.x, xy.y);
										xytd.innerHTML = cgetXYHtml(xy.x, xy.y );
									}
								}
								now_num ++;
								if( now_num < all_num ) {
									window.setTimeout(timerFunc, 0);
								}else{
									running = false;
									alert("全ての座標を取得しました");
								}
							});
						}
					});

					th.appendChild(lnk);
					head2.appendChild(th);
				}

				var trs = $a("//table[@summary=\"ランキング\"]//tr[position()>2]");
				var xylists = cloadData( "allyXYList" + aid, "[]", true, true );

				//ハッシュに書き換え
				var xylist = new Array();
				for(var i=0 ; i<xylists.length ; i++) {
					xylist["id" + xylists[i].id ] = {"x":xylists[i].x, "y":xylists[i].y};
					if( xylist["id" + xylists[i].id].x == null )  xylist["id" + xylists[i].id].x = 0;
					if( xylist["id" + xylists[i].id].y == null )  xylist["id" + xylists[i].id].y = 0;
				}

				for(var i=0; i<trs.length ; i++) {
					var idtd = $x("descendant::td[2]",trs[i]);
					if( !idtd ) continue;
					var ids = idtd.innerHTML.match(/\/user\/\?user_id\=(\d+)/);
					if( !ids ) continue;

					var td = d.createElement("td");
					td.id = "beyond_xylink_" + ids[1];
					if( xylist["id" + ids[1] ] ) {
						td.innerHTML = cgetXYHtml(xylist["id" + ids[1] ].x, xylist["id" + ids[1] ].y);
					}else{
						td.innerHTML ="　";
					}
					trs[i].appendChild(td);

					var yaku = $x("descendant::td[7]",trs[i]);
					if( yaku.innerHTML.match(/盟主補佐/) ) {
						//盟主補佐がぎりぎり2行になるので後ろの空白カット
						yaku.innerHTML = yaku.innerHTML.replace(/[ 　\t\r\n]+$/g, "");

					}
				}
			}
		}
	}

	function getXYfromUserHTML(html)
	{
		var xy = html.match(/<\/a>\n\(本拠地\)\t+<\/td>[^<]*<td[^>]*>([\-0-9]+),([\-0-9]+)<\/td>/);

		if( xy ) {
			return {"x":parseInt(xy[1],10),"y":parseInt(xy[2],10)};
		}
		return null;
	}

	function getDatafromUserHTML(html)
	{
		var ret = [];
		var tmp = html.match(/<td[^>]*>ランク<\/td>[^<]*<td[^>]*>([0-9]+)<\/td>/);
		if( !tmp ) return null;
		ret["all_rank"] = parseInt(tmp[1] ,10);

		tmp = html.match(/<td[^>]*>総合<\/td>[^<]*<td[^>]*>([0-9]+)<\/td>/);
		if( !tmp ) return null;
		ret["all_point"] = parseInt(tmp[1] ,10);

		tmp = html.match(/<td[^>]*>総人口<\/td>[^<]*<td[^>]*>([0-9]+)<\/td>/);
		if( !tmp ) return null;
		ret["jinko"] = parseInt(tmp[1] ,10);

		tmp = html.match(/<td[^>]*>攻撃<\/td>[^<]*<td[^>]*>([0-9]+)<\/td>/);
		if( !tmp ) return null;
		ret["attack"] = parseInt(tmp[1] ,10);

		tmp = html.match(/<td[^>]*>防御<\/td>[^<]*<td[^>]*>([0-9]+)<\/td>/);
		if( !tmp ) return null;
		ret["defence"] = parseInt(tmp[1] ,10);

		tmp = html.match(/<td[^>]*>撃破スコア<\/td>[^<]*<td[^>]*>([0-9]+)<\/td>/);
		if( !tmp ) return null;
		ret["attack_score"] = parseInt(tmp[1] ,10);

		tmp = html.match(/<td[^>]*>防衛スコア<\/td>[^<]*<td[^>]*>([0-9]+)<\/td>/);
		if( !tmp ) return null;
		ret["defence_score"] = parseInt(tmp[1] ,10);

		tmp = html.match(/<\/a>\n\(本拠地\)\t+<\/td>[^<]*<td[^>]*>([\-0-9]+),([\-0-9]+)<\/td>/);
		if ( !tmp ) return null;
		ret["x"] = parseInt(tmp[1],10);
		ret["y"] = parseInt(tmp[2],10);

		return ret;
	}

	function getXYListfromUserHTML(html)
	{
		var ret = new Array();

		var tmp = html.match(/<td[^>]*>君主<\/td>[^<]*<td[^>]*>([^<]+)<img[^>]*>([^<]+)/);	//W12専用
		if (!tmp) {
			var tmp = html.match(/<td[^>]*>君主<\/td>[^<]*<td[^>]*>([^<]+)/);	//それ以外の鯖
			if( !tmp ) return null;
			var user_name = tmp[1].replace(/(^\s+|\s+$)/g, "");
		} else {
			var user_name = tmp[2].replace(/(^\s+|\s+$)/g, "");
		}

//		var tmp = html.match(/<td[^>]*>君主<\/td>[^<]*<td[^>]*>([^<\s]+)/);
//		var tmp = html.match(/<td[^>]*>君主<\/td>[^<]*<td[^>]*>([^<]+)/);
//		if( !tmp ) return null;
//		var user_name = tmp[1];
//		var user_name = tmp[1].replace(/(^\s+|\s+$)/g, "");

//		tmp = html.match(/<td[^>]*>同盟<\/td>[^<]*<td[^>]*><a href="[^"]*">([^<]+)<\/a><\/td>/);

		tmp = html.match(/<td[^>]*>同盟<\/td>[^<]*<td[^>]*>[^>]*><a href="[^"]*">([^<]+)<\/a>[^>]*<\/td>/);
		if (!tmp) {
			tmp = html.match(/<td[^>]*>同盟<\/td>[^<]*<td[^>]*>[^>]*<a href="[^"]*">([^<]+)<\/a>[^>]*<\/td>/);
			if( !tmp ) return;
		}

//		tmp = html.match(/<td[^>]*>同盟<\/td>[^<]*<td[^>]*>[^>]*<a href="[^"]*">([^<]+)<\/a>[^>]*<\/td>/);
		if( !tmp ) return;
		var ally_name = tmp[1];

		var pos;
		var reg = /<a href="\.\.\/(?:land|village_change)\.php[^"]*">\s*([^<\s]+)\s*<\/a>[^<]*<\/td>[^<]*<td[^>]*>([\-0-9]+),([\-0-9]+)<\/td>[^<]*<td[^>]*>([0-9]+|&nbsp;)<\/td>/;
		var honkyo = 1;
		while((pos = html.search(reg) ) != -1 ) {

			html = html.substr(pos);

			var dat = html.match(reg);
			if( !dat ) break;

			if( dat[4] == "&nbsp;" ) dat[4] = "";

			ret.push({"user_name":user_name, "ally_name":ally_name, "area_name":dat[1].replace(/(^\s+|\s+$)/g, ""), "x":dat[2], "y":dat[3], "jinko":dat[4], "honkyo":honkyo});
			honkyo="";
			html = html.substr(dat[0].length);

		}

		return ret;
	}

	function allianceCSV()
	{
		if( location.pathname != "/alliance/info.php" ) return;
		var aid;
		if( URL_PARAM.id ) aid = URL_PARAM.id;
		else aid = ALLY_ID;

		//CSV出力用
		var tbl = $x("//table[@summary=\"ランキング\"]");
		if( !tbl ) return;

		var lnk = d.createElement("a");
		lnk.href = "javascript:void(0)";
		lnk.innerHTML ="同盟員詳細情報csv";
		tbl.parentNode.insertBefore(lnk, tbl.nextSibling);
		$e(lnk, "click", function() {

			if( $("beyond_csvWindow") ) return;

			if( confirm("同盟員の情報を一気に取得するためサーバに負荷をかけます。\n何度も実行するとDOS攻撃と同じなので、実行には注意して下さい") == false ) return;

			//窓作成
			var elm_xy = cgetElementXY( this );
			var yy = elm_xy.y - 420;
			if( yy < 0 ) yy = 0;
			createCSVWindow(10, yy);

			var trs = $a("//table[@summary=\"ランキング\"]//tr[position()>2]");

			var elm_msg = $("beyond_csvWindow_message");
			if( !elm_msg ) return;
			var elm_csv = $("beyond_csvWindow_csv");
			if( !elm_csv ) return;

			var now_num = 0;
			var all_num = trs.length;

			if( all_num == 0 ) return;

			var csv_txt = "同盟内ランク\tuser_id\t名前\t同盟内point\t寄付\t拠点\t全体ランク\t全体point\t人口\t攻撃\t防御\t撃破スコア\t防御スコア\t本拠X座標\t本拠Y座標\n";

			window.setTimeout(timerFunc ,0 );

			function timerFunc()
			{
				if( !$("beyond_csvWindow") ) return;
				var tds = $a("descendant::td",trs[now_num]);
				if( tds.length < 5 ) {
					alert("ページフォーマットが変わったみたい");
					return ;
				}

				var ids = tds[1].innerHTML.match(/\/user\/\?user_id\=(\d+).*\">(.+)<\/a>/);
				if( !ids ) {
					alert("ページフォーマットが変わったみたい");
					return ;
				}

				var uid = parseInt(ids[1], 10);

				cajaxRequest("/user/?user_id=" + uid, "GET", "", function(req) {
					var dt = getDatafromUserHTML(req.responseText);
					if( dt ) {
						csv_txt += parseInt(tds[0].innerHTML, 10) + "\t";
						csv_txt += uid + "\t";
						csv_txt += ids[2]  + "\t";
						csv_txt += parseInt(tds[2].innerHTML, 10)  + "\t";
						csv_txt += parseInt(tds[3].innerHTML, 10)  + "\t";
						csv_txt += parseInt(tds[4].innerHTML, 10)  + "\t";
						csv_txt += dt.all_rank	+ "\t";
						csv_txt += dt.all_point  + "\t";
						csv_txt += dt.jinko  + "\t";
						csv_txt += dt.attack  + "\t";
						csv_txt += dt.defence  + "\t";
						csv_txt += dt.attack_score	+ "\t";
						csv_txt += dt.defence_score  + "\t";
						csv_txt += dt.x  + "\t";
						csv_txt += dt.y  + "\n";

						var xytd = $("beyond_xylink_" + uid );
						if(xytd) {
							csetUserXY(aid, uid, dt.x, dt.y);
							xytd.innerHTML = cgetXYHtml(dt.x, dt.y );
						}

						now_num ++;
						elm_msg.innerHTML = "取得中... ( " + now_num + " / " + all_num + " )";
						if( now_num < all_num ) {
							window.setTimeout(timerFunc, 0);
						}else{
							elm_msg.innerHTML += ".. 完了しました。CTRL + A → CTRL + Cでコピーし、Excelなどに貼りつけてください";
							elm_csv.value = csv_txt;
							elm_csv.focus();
						}
					} else {
						alert("user_id="+uid+"の取得に失敗しました" );
						now_num ++;
						elm_msg.innerHTML = "取得中... ( " + now_num + " / " + all_num + " )";
						if( now_num < all_num ) {
							window.setTimeout(timerFunc, 0);
						}else{
							elm_msg.innerHTML += ".. 完了しました。CTRL + A → CTRL + Cでコピーし、Excelなどに貼りつけてください";
							elm_csv.value = csv_txt;
							elm_csv.focus();
						}
					}

				}, function(req){
					alert("サーバからエラーが返りましたよ" );
				});
			}
		});


		var lnk2 = d.createElement("a");
		lnk2.href = "javascript:void(0)";
		lnk2.innerHTML ="同盟員全領地座標csv";
		tbl.parentNode.insertBefore(lnk2, lnk.nextSibling);
		tbl.parentNode.insertBefore(d.createTextNode("　　"), lnk2);
		$e(lnk2, "click", function() {

			if( $("beyond_csvWindow") ) return;

			if( confirm("同盟員の情報を一気に取得するためサーバに負荷をかけます。\n何度も実行するとDOS攻撃と同じなので、実行には注意して下さい") == false ) return;

			if( navigator.userAgent.toLowerCase().indexOf('chrome') == -1 ) {
				if( confirm("終盤の巨大同盟だと、CTRL+AやCTRL+Cの操作で10分くらい掛かります。\nChromeだとそんなに時間掛からないみたいです。続けますか？") == false ) return;
			}
			//窓作成
			var elm_xy = cgetElementXY( this );
			var yy = elm_xy.y - 420;
			if( yy < 0 ) yy = 0;
			createCSVWindow(10, yy);

			var trs = $a("//table[@summary=\"ランキング\"]//tr[position()>2]");

			var elm_msg = $("beyond_csvWindow_message");
			if( !elm_msg ) return;
			var elm_csv = $("beyond_csvWindow_csv");
			if( !elm_csv ) return;

			var now_num = 0;
			var all_num = trs.length;

			if( all_num == 0 ) return;

			var csv_txt = "同盟\t君主\t領地名\tX\tY\t人口\t本拠\n";

			window.setTimeout(timerFunc ,0 );

			function timerFunc()
			{
				if( !$("beyond_csvWindow") ) return;
				var tds = $a("descendant::td",trs[now_num]);
				if( tds.length < 5 ) {
					alert("ページフォーマットが変わったみたい");
					return ;
				}

				var ids = tds[1].innerHTML.match(/\/user\/\?user_id\=(\d+).*\">(.+)<\/a>/);
				if( !ids ) {
					alert("ページフォーマットが変わったみたい");
					return ;
				}

				var uid = parseInt(ids[1], 10);

				cajaxRequest("/user/?user_id=" + uid, "GET", "", function(req) {
					var dt = getXYListfromUserHTML(req.responseText);
					if( dt ) {
						for(var i=0 ; i<dt.length ; i++) {
							csv_txt += dt[i].ally_name	+ "\t";
							csv_txt += dt[i].user_name	+ "\t";
							csv_txt += dt[i].area_name	+ "\t";
							csv_txt += dt[i].x	+ "\t";
							csv_txt += dt[i].y	+ "\t";
							csv_txt += dt[i].jinko	+ "\t";
							csv_txt += dt[i].honkyo  + "\n";
						}

						now_num ++;
						elm_msg.innerHTML = "取得中... ( " + now_num + " / " + all_num + " )";
						if( now_num < all_num ) {
							window.setTimeout(timerFunc, 0);
						}else{
							elm_msg.innerHTML += ".. 完了しました。CTRL + A → CTRL + Cでコピーし、Excelなどに貼りつけてください";
							elm_csv.value = csv_txt;
							elm_csv.focus();
						}
					} else {
						alert("取得に失敗しました" );
					}
				}, function(req){
					alert("サーバからエラーが返りましたよ" );
				});
			}
		});

		function createCSVWindow(x, y)
		{
			var cc = $("beyond_csvWindow");
			if( cc ) cc.parentNode.removeChild(cc);
			cc = d.createElement("div");
			cc.id = "beyond_csvWindow";
			cc.style.left = x + "px";
			cc.style.top = y + "px";
			cc.style.position = "absolute";
			cc.style.backgroundColor = "lightgray";
			cc.style.border = "outset 2px lightgray";
			cc.style.fontSize = "12px";
			cc.style.padding = "15px";
			cc.style.zIndex = 1000;

			cc.style.padding = "10px";
			var dv = d.createElement("div");
			dv.id = "beyond_csvWindow_message";
			cc.appendChild(dv);
			var tx = d.createElement("textarea");
			tx.id = "beyond_csvWindow_csv";
			tx.rows = 25;
			tx.cols = 140;
			tx.style.overflow = "scroll";
			cc.appendChild(tx);

			cc.appendChild(d.createElement("br") );
			ccreateButton(cc, "閉じる", "", function(){
				var cc = $("beyond_csvWindow");
				if( cc ) cc.parentNode.removeChild(cc);
			});

			$("beyond_floatpanel").appendChild(cc);
		}

	}
}

//////////////////////
//資源の合計
//////////////////////
function disp_ResourcesTotal(){
	var white_all = RES_GROW_W.wood + RES_GROW_W.stone + RES_GROW_W.iron + RES_GROW_W.rice;
	var blue_all = RES_GROW_B.wood + RES_GROW_B.stone + RES_GROW_B.iron + RES_GROW_B.rice;
	var all_all = RES_GROW.wood + RES_GROW.stone + RES_GROW.iron + RES_GROW.rice;
	var box = $x('id("sidebar")//span[@class="increase" or @class="resource"]/../.. | id("status_left")//p[@class="status_bottom"]');
	if( !box ) return;

	var txt = d.createTextNode("合計 " + white_all);

	var sp = d.createElement("span");
		sp.className = "increase";
		sp.appendChild(d.createTextNode(" +" + blue_all) );

	var item = txt;
	var addSpDoc = box;
	if (!isNarrow) {
		item = d.createElement("li");
		item.appendChild(txt);
		item.title = "総合計 " + all_all;
		addSpDoc = item;
	}

	box.appendChild(item);
	addSpDoc.appendChild(sp);
}

//////////////////////
//建設/破棄一覧
//////////////////////
function disp_RemoveList(){
	var img_x = 'data:image/gif;base64,'+
		'R0lGODlhPAA8AIAAAP/MM////yH5BAUUAAEALAAAAAA8ADwAAAJ4jI+py+0Po5y02ouz3rz7D4bi'+'SJbmiabqyrbuC8fyTNf2jef6zvf+DQgGJwCV8PgQro7IRXPJLCqerGjCCmMaotIsVzv7KmtiHNd8'+
		'tpVp4nEsDX6lt+7W/EBNfRl1PZY/ZPTXEOjXR1iIcuiQ+OP4CBkpOUlZWVMAADs=';
	var img_m = 'data:image/gif;base64,'+
		'R0lGODlhPAA8AIAAAP/MM////yH5BAUUAAEALAAAAAA8ADwAAAKpjI+py+0Po5y02ouz3rz7D4bi'+'SJbmiabqyrbuC8fyTNf2jef6zvc5AAwKacJiMTZcJFnLRvP0dAZT0wOQcQ1UTVkrAPs1dElbcVjR'+
		'LYuuxmGbfV7D31q6+jM2582JvSdvhBZXRxYHR4gAOIh3luWIqFj4lWYYNnbHKJhoWckVqdToB/Kp'+'yQd1uVjHmSrnmNq24saqOlsSpVd7+nbbspvrAxwsPExcbBxQAAA7';
	var img_t = 'data:image/gif;base64,'+
		'R0lGODlhPAA8AIAAAP/MM////yH5BAUUAAEALAAAAAA8ADwAAAKnjI+py+0Po5y02ouz3rz7D4bi'+'SJbmiabqyrbuC8fyTNf2jef6zvc5AAwKacJiMTZcJFnLAxDRPA2fTkAiSgpWoVaFVto1JI1ccDhA'+
		'FR+rZ1Hamka3y9m3XBu/5j9x8j265/HW5EfnFhYIkcgxaOTYNydI9UjJVrL39bDYkfn3yBUJ0kh5'+'tikJh6qEaHraRYrKyof32qmCpRZbR0tU6eP7CxwsPEz8UAAAOw==';
	var img_lup = 'data:image/gif;base64,'+
		'R0lGODlhPAA8AIAAAP/MM////yH5BAUUAAEALAAAAAA8ADwAAAKfjI+py+0Po5y02ouz3rz7D4bi'+'SJbmiabqyrbuC8fyTNf2jef6zvc9APgBg7rhMGc03o7AwJH2bDqlsef0YH1Rr1iiaqsAJ8SfbNi7'+
		'MJfRafaZRK7EOVtw867kiups/DTq5mFlF+SHFyjoRXiVpDcCOFYo2YW4ZqAkyaRYuZZZ+Of3l5IH'+'QYpiyoA6qnbJ+pUEO7cS6+pje4ubq7vLi1AAADs=';

	if( location.pathname == "/land.php" && URL_PARAM.x && URL_PARAM.y ) {
		var rmtime = d.body.innerHTML.match(/(現在領地を破棄中です|現在村を建設中です|現在砦を建設中です)[^\d]*\n*(\d+-\d+-\d+ \d+:\d+:\d+)/ );
		if( rmtime ) {
			if( rmtime[1] == "現在領地を破棄中です" ) {
				addTerritoryList(rmtime[2], 0, URL_PARAM.x, URL_PARAM.y );
			}else if( rmtime[1] == "現在村を建設中です" ) {
				addTerritoryList(rmtime[2], 3, URL_PARAM.x, URL_PARAM.y );
			}else if( rmtime[1] == "現在砦を建設中です" ) {
				addTerritoryList(rmtime[2], 4, URL_PARAM.x, URL_PARAM.y );
			}
		}else{
			rmtime = d.body.innerHTML.match(/現在領地をレベルアップ中です[^\d]*\n*(\d+-\d+-\d+ \d+:\d+:\d+)に完了します。/ );
			if( rmtime ) {
				addTerritoryList(rmtime[1], 5, URL_PARAM.x, URL_PARAM.y );
			}else {
				delTerritoryList(0, URL_PARAM.x, URL_PARAM.y);
			}
		}
	}

	if( location.pathname == "/facility/castle.php" ) {
		var xy = cgetCurrentBaseXY();
		var rmtime = d.body.innerHTML.match(/(村を削除中です。|砦を削除中です。)[^\d]*(\d+-\d+-\d+ \d+:\d+:\d+)に完了します。/);
		if( rmtime ) {
			if( rmtime[1] == "村を削除中です。" ) {
				addTerritoryList(rmtime[2], 1, xy.x, xy.y );
			}else if( rmtime[1] == "砦を削除中です。" ) {
				addTerritoryList(rmtime[2], 2, xy.x, xy.y );
			}
		}else{
			delTerritoryList(1,xy.x, xy.y);
		}
	}

	if( location.pathname == "/map.php" ) {
		//地図に表示
		var type = 1;
		if(	  $x("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort15 now\"]") ) type=2;
		else if( $x("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort21 now\"]") ) type=5;
		else if( $x("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort51 now\"]") ) type=4;
		var lists = cloadData("RemoveList", "[]", true, true);
		lists = checkList(lists);	   //時間を過ぎたものを削除

		if( lists.length ) {
			var cx = parseInt(URL_PARAM.x,10);
			var cy = parseInt(URL_PARAM.y,10);
			if( cx > MAP_X_MAX ) cx = MAP_X_MAX;
			if( cx < MAP_X_MIN ) cx = MAP_X_MIN;
			if( cy > MAP_Y_MAX ) cy = MAP_Y_MAX;
			if( cy < MAP_Y_MIN ) cy = MAP_Y_MIN;

			var map = $x("//div[@id=\"mapsAll\"]");
			for(var i=0 ; i<lists.length ; i++) {
				var no = cgetMapNofromXY(lists[i].x, lists[i].y, cx, cy, type );
				if( !no ) continue;
				var img_src;
				if( lists[i].kind == 3) img_src = img_m;
				else if(lists[i].kind == 4 ) img_src = img_t;
				else if(lists[i].kind == 5 ) img_src = img_lup;
				else img_src = img_x;

				var img = document.createElement("img");
				img.className = "mapAll" + no;
				img.src = img_src;

				map.appendChild(img);
			}
		}
	}


	//パネルに表示
	var icon_rl = 'data:image/gif;base64,'+
		'R0lGODlhEQAPALMAAAD/ANO3SQbOKKyTQxqvSjKgYAivNwCZAHdrPBVwFVNTUS1NLTMzMwAAAAAA'+'AAAAACH5BAQUAP8ALAAAAAARAA8AAARKkMlJq50npzuXAKDALYsBnoBhHWgrVmyLIkOgSIl8Bnww'+
		'TDpCr3djfHbD4Y9hOhWSQ8kC9YTyEFKBwICw9i5WLKfWW3IYNISYEgEAOw==';
	var elms = ccreateSideBox("beyond_sidebox_removelist", icon_rl, "建設/破棄ﾘｽﾄ");

	var lists = cloadData("RemoveList", "[]", true, true);
	lists = checkList(lists);	   //時間を過ぎたものを削除

	if( lists.length == 0 ) return;

	var ul = d.createElement("ul");

	for(var i=0 ; i<lists.length ; i++) {
		var li = d.createElement("li");
		//アイコン
		var title = "";
		switch(lists[i].kind){
		case 0: title = "領地破棄"; break;
		case 1: title = "村破棄"; break;
		case 2: title = "砦破棄"; break;
		case 3: title = "村作成"; break;
		case 4: title = "砦作成"; break;
		case 5: title = "レベルアップ"; break;
		}
		var icon = "";
		if( lists[i].kind == 1 || lists[i].kind == 3 ) {		//村破棄or村作成
			icon = IMG_DIR + "panel/village_b_l.png";
		}else if( lists[i].kind == 2 || lists[i].kind == 4 ) {	//砦破棄or砦作成
			icon = IMG_DIR + "panel/fort_b_l.png";
		}else{
			icon = IMG_DIR + "panel/territory_b_s.png";
		}

		var addHtml = '<span><img src="' + icon + '" style="position:relative; top: -5px; width:20px; height:20px;" title="' + title + '">';

		var sizestyle = "";
		if( lists[i].kind == 0 || lists[i].kind == 1 || lists[i].kind == 2 ) {	  //領地破棄or村破棄or砦破棄
			addHtml += '<img src ="' + img_x + '" style="position:relative; top: -5px; left:-20px; width:20px; height:20px;" title="' + title + '">';
			sizestyle = ' style="position:relative; left:-20px;"';
		}
		if( lists[i].kind == 5 ) {							  //領地LvUp
			addHtml += '<img src ="' + img_lup + '" style="position:relative; top: -5px; left:-20px; width:20px; height:20px;" title="' + title + '">';
			sizestyle = ' style="position:relative; left:-20px;"';
		}
		addHtml += "</span></span>";
		addHtml += '<a href="'+caddSessionId('/land.php?x=' + lists[i].x + '&y=' + lists[i].y +'#ptop')+'" title="表示"'+ sizestyle + '>' + lists[i].time.substr(-8) + '</a>';
		addHtml += '<a href="'+caddSessionId('/map.php?x=' + lists[i].x + '&y=' + lists[i].y +'#ptop')+'" title="マップ(' + lists[i].x + ',' + lists[i].y + ')"' + sizestyle + '>';
		addHtml += '<img src="' +  img_map + '" style="padding-left:2px;"></a></span>';

		li.innerHTML = addHtml;

		ul.appendChild(li);
	}
	elms.sideBoxInner.appendChild(ul);

	function checkList(lists){
		var dt = new Date();
		var ntime = dt.getFullYear() + "-" +
			(dt.getMonth()+101).toString().substr(-2) + "-" +
			(dt.getDate()+100).toString().substr(-2) + " " +
			(dt.getHours()+100).toString().substr(-2)  + ":" +
			(dt.getMinutes()+100).toString().substr(-2)  + ":" +
			(dt.getSeconds()+100).toString().substr(-2);
		var str1 = "";
		var str2 = "";
		var str3 = "";
		var str4 = "";
		for(var i=0 ; i<lists.length ; i++) {
			if( lists[i].time < ntime ) {
				if ( lists[i].kind == 1 || lists[i].kind == 2 ) {
					str2 += "(" + lists[i].x + "," + lists[i].y + ")\n";
				}else if ( lists[i].kind == 3 || lists[i].kind == 4 ) {
					str3 += "(" + lists[i].x + "," + lists[i].y + ")\n";
				}else if ( lists[i].kind == 5 ) {
					//LevelUp完了
					str4 += "(" + lists[i].x + "," + lists[i].y + ")\n";
					csetMyLevel(lists[i].x, lists[i].y, -1);
				}else {
					str1 += "(" + lists[i].x + "," + lists[i].y + ")\n";
				}
				lists.splice(i,1);
				i--;
			}
		}
		if( str1 || str2 || str3 || str4 ) {
			var msg = "";
			if( str1) msg += "以下の領地が破棄されました\n" + str1;
			if( str2) msg += "以下の拠点が破棄されました\n" + str2;
			if( str3) msg += "以下の拠点が作成されました\n" + str3;
			if( str4) msg += "以下の拠点がレベルアップしました\n" + str4;
			csaveData( "RemoveList", lists, true, true );
			//			alert(msg);
		}
		return lists;
	}
}

function disp_ResourcesTime(){

	var flag_cost = false;
	if( location.pathname == "/facility/facility.php" ||
		location.pathname == "/facility/select_facility.php" ||
		location.pathname == "/facility/castle.php" ||
		location.pathname == "/facility/unit_confirm.php") {
		flag_cost = true;
	}

	var names = ["wood", "stone", "iron", "rice"];
	var resources = {
		wood  : { base : null,timer : null},
		stone : { base : null,timer : null},
		iron  : { base : null,timer : null},
		rice  : { base : null,timer : null},
		fame  : { base : null,timer : null}
	};

	//status_leftとstatus_rightの幅を変更
	var stat_left = $("status_left");
	var stat_right = $("status_right");
	if( stat_left && stat_right ) {
		stat_left.style.width = "725px";	//670 + 55
		stat_right.style.width = "200px";	//255 - 55
	}

	var status_resources = $("status_resources");
	status_resources.style.height = "48px";
	for(var i = 0; i < names.length;i++) {
		var name = names[i];
		var base = $(name);
		var dv = d.createElement("div");
		dv.id = "beyond_restime_" + name;
		dv.style.top = (base.offsetTop + 12) + "px";
		dv.style.left = base.offsetLeft + "px";
		dv.style.position = "absolute";
		base.parentNode.appendChild( dv );

		var dv2 = d.createElement("div");
		dv2.id = "beyond_resspeed_" + name;
		dv2.style.top = (base.offsetTop + 24) + "px";
		dv2.style.left = base.offsetLeft + "px";
		dv2.style.position = "absolute";
		base.parentNode.appendChild( dv2 );

		resources[name].base = base;
		resources[name].timer = dv;
		resources[name].resspeed = dv2;
	}

	var jusoku = $x('//div[@class="jusoku_wrap"]');
	if(jusoku){
		jusoku.style.cssFloat = "none";
	}

	//名声
	var villageCount = 0;
	for (var key in VILLAGES_INFO) {
		villageCount++;
	}


	var bldtbl = [17, 35, 54, 80, 112, 150, 195, 248, 310, 999];

	var addTop = 12;
	if (OPT_NEXT_MEISEI) {
		addTop = -12;
	}
	for( var i=0 ; i < bldtbl.length ; i++ ){
		if( RES_MAX.fame < bldtbl[i] ) {
			//var base = $x('id("status_left")/img[@title="名声"]');
			var base = $x('id("status_resources")//li[5]/img[@title="名声"]');
			if( base ) {
				var dv = d.createElement("div");
				var elm_xy = cgetElementXY("base"); //改良
				dv.id = "beyond_restime_meisei";
				dv.style.top = (base.offsetTop + addTop) + "px";
				dv.style.left = (base.offsetLeft + 10) + "px";
				if( location.pathname == "/map.php") dv.style.left = (base.offsetLeft - 64) + "px";	//faraway110620
				if( location.pathname == "/user/ranking.php"){						//faraway110620
					if(base.offsetLeft >= 552){							//faraway110620
						 dv.style.left = (base.offsetLeft - 64) + "px";				//faraway110620
					}										//faraway110620
				}
				dv.style.position = "absolute";
				dv.style.color="lightgreen";

				if( bldtbl[i] != 999 ) {
					dv.innerHTML = "次拠点:" +	bldtbl[i];
					if(OPT_NEXT_MEISEI){			//名声獲得タイマー機能使用時	faraway110620
						dv.style.top = "-7px";		//位置ずれるため固定	faraway110620
					}else{
						dv.style.top = "17px";		//位置ずれるため固定	faraway110620
					}
				}

				if( villageCount < i + 1 ) {
					dv.innerHTML += "(+" + (i + 1 - villageCount ) + ")";
				}

				base.parentNode.appendChild( dv );
				resources.fame.base = base;
				resources.fame.timer = dv;
			}
			break;
		}
	}

	if( flag_cost ) {
		var facilityResources = new Array();
		var tds = $a('//td[@class="cost"]');
		for(var i=0 ; i<tds.length ; i++) {
			var td = tds[i];
			var spn = $a('./span[contains(concat(" ", normalize-space(@class), " "), " normal ") or contains(concat(" ", normalize-space(@class), " "), " max90 ")]', td);
			if( spn.length != 4 ) continue;

			var addObj = new Object();

			for(var j=0 ; j < names.length ; j++ ) {
				var name = names[j];
				var base = spn[j];
				var dv = d.createElement("div");
				dv.id = "beyond_restime_" + i + "_" + name;
				var elem_xy = cgetElementXY(base);
				dv.style.top = (elem_xy.y + 9) + "px";
				dv.style.left = (elem_xy.x - 18 )+ "px";
				dv.style.fontSize = "9px";
				dv.style.position = "absolute";
				td.appendChild( dv );
				addObj[name] = {base : base , timer : dv};
			}
			facilityResources.push(addObj);
		}
	}

	function ResourcesTimer(){
		var posleft =new Array("28px","150px","272px","398px");//位置ずれるため固値を設定faraway110601 //faraway110616
		cupdateCurrentResources();
		var res = new Array();
		var html = $x('//div[@id="wrapper"]//div[@class="sideBox"][3]').innerHTML;
		var target = 3;
		if (html.match(/同盟拠点/)) {
			target = 4;
		}
		for( var i = 0; i < 4; i++ ){
			res[i] = $x('//div[@id="wrapper"]//div[@class="sideBox"][' + target + ']//li[' + (i+1) + ']').innerHTML;
		}
		//各資源
		for(var i=0 ; i<names.length ; i++) {
			var name = names[i];
			var base = resources[name].base;
			var dv = resources[name].timer;
			var dv2 = resources[name].resspeed;

			if( dv && base ){
				var tim;
				if( RES_GROW[ name ] == 0 ) {
					tim = "XX:XX:XX";
				}else if( RES_GROW[ name ] > 0 ){
					tim = getTime(RES_MAX[ name ] - RES_NOW[ name ], RES_GROW[ name ]);
				}else{
					tim = "-" + getTime(RES_NOW[ name ], 0 - RES_GROW[ name ]);
				}
				if( tim == "00:00:00" || tim.substr(0,1) == "-" ) dv.style.color="red";
				else if( parseInt(tim.substr(0,2), 10) < 1 ) dv.style.color="orange";
				else dv.style.color="lightgreen";

				dv.innerHTML = "(" + tim + ")";
				dv.style.top = (base.offsetTop + 12) + "px";
				dv.style.left = base.offsetLeft + "px";

				dv2.innerHTML = res[i];
			}
		}
		//名声
		var base = resources.fame.base;
		var dv = resources.fame.timer;
		if( base && dv) {
			dv.style.top = (base.offsetTop + addTop) + "px";
			dv.style.left = (base.offsetLeft + 10) + "px";
		}
		if( flag_cost ) {
			for(var i=0 ; i < facilityResources.length ; i++) {
			var facilityObj = facilityResources[i];
			for(var j=0 ; j<names.length ; j++ ) {
				var name = names[j];
				var base = facilityObj[name].base;
				var dv = facilityObj[name].timer;
				var needed = parseInt(base.innerHTML,10);
				if( needed > RES_MAX[ name ] ) {
				dv.style.color="red";
				dv.innerHTML = "倉庫不足";
				}else if( needed > RES_NOW[ name ] ) {
				var tim = getTime(needed - RES_NOW[ name ], RES_GROW[ name ]);
				dv.style.color="orange";
				dv.innerHTML = "(" + tim + ")";
				}else{
				dv.style.color="lightgreen";
				dv.innerHTML = "残" + (RES_NOW[ name ] - needed);
				}
				var elem_xy = cgetElementXY(base);
				dv.style.top = (elem_xy.y + 9) + "px";
				dv.style.left = (elem_xy.x - 18 )+ "px";
			}
			}
		}


		window.setTimeout( ResourcesTimer, 1000);
	}

	ResourcesTimer();

	function getTime(res, grow ){
		var tmp = res * 3600 / grow;
		var h = Math.floor(tmp / 3600);
		var m = Math.floor((tmp - h*3600 ) / 60 );
		var s = Math.floor(tmp - h*3600 - m*60 );
		var tim = h + ":" +
			(m+100).toString().substr(-2)  + ":" +
			(s+100).toString().substr(-2);
		return tim;
	}

}

//////////////////////
//拠点建設/破棄予約
//////////////////////
function disp_ReserveVillageList(){
	//パネルに表示
	var icon_rl = 'data:image/gif;base64,'+
		'R0lGODlhEQAPALMAAAD/ANO3SQbOKKyTQxqvSjKgYAivNwCZAHdrPBVwFVNTUS1NLTMzMwAAAAAA'+'AAAAACH5BAQUAP8ALAAAAAARAA8AAARKkMlJq50npzuXAKDALYsBnoBhHWgrVmyLIkOgSIl8Bnww'+
		'TDpCr3djfHbD4Y9hOhWSQ8kC9YTyEFKBwICw9i5WLKfWW3IYNISYEgEAOw==';
	var elms = ccreateSideBox("beyond_sidebox_reserve_villagelist", icon_rl, "拠点予約ﾘｽﾄ");

	var lists = cloadData("ReserveList", "[]", true, true);
	if( lists.length == 0 ) return;

	var ul = d.createElement("ul");

	for(var i=0 ; i<lists.length ; i++) {
		var li = d.createElement("li");
		//アイコン
		var title = "";
		switch(lists[i].kind){
			case 0: title = "村予約"; break;
			case 1: title = "砦予約"; break;
			case 2: title = "破棄予約"; break;
		}
		var icon = "";
		if( lists[i].kind == 0 ) {			// 村予約
			icon = IMG_DIR + "panel/village_b_l.png";
		} else if( lists[i].kind == 1 ) {	// 砦予約
			icon = IMG_DIR + "panel/fort_b_l.png";
		} else {	// 破棄予約
			icon = IMG_DIR + "panel/resource_barren_2.png";
		}

		var addHtml = '<span><img src="' + icon + '" style="position:relative; top:-3px; width:20px; height:20px;" title="' + title + '">';
		addHtml += '<font color="#00ff00">(' + lists[i].x + ',' + lists[i].y + ')</font></span>';
		addHtml += '<span><a href="'+caddSessionId('/map.php?x=' + lists[i].x + '&y=' + lists[i].y +'#ptop')+'" title="マップ(' + lists[i].x + ',' + lists[i].y + ')">';
		addHtml += '<img src="' +  img_map + '" style="position:relative; top:3px; padding-left:2px;"></a></span>';

		li.innerHTML = addHtml;

		ul.appendChild(li);
	}
	elms.sideBoxInner.appendChild(ul);
}

//////////////////////
//地形一覧
//////////////////////
function disp_MapList(){
	if( location.pathname != "/map.php" ) return;


	var map_type = 1;
	//地図51×51対応
	if( $x("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort15 now\"]") ) map_type=2;
	else if( $x("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort21 now\"]") ) map_type=5;
	else if( $x("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort51 now\"]") ) map_type=4;

	var base = $("mapbox");

	var div =d.createElement("div");
	div.id = "beyond_maplist";
	div.align = "center";
	div.appendChild(d.createElement("br"));

	var tmp_t = d.createElement("table");
	var tmp_r = d.createElement("tr");
	var tmp_d1 = d.createElement("td");
	ccreateCheckBox(tmp_d1, "beyond_maplist_kyoten",  "1", "拠点","拠点を含めます"	,0);	var tmp_d2 = d.createElement("td");
	ccreateCheckBox(tmp_d2, "beyond_maplist_ryouchi", "1", "領地","領地を含めます"	,0);	var tmp_d3 = d.createElement("td");
	ccreateCheckBox(tmp_d3, "beyond_maplist_akichi",  "1", "空き地","空き地を含めます",0);	var tmp_d4 = d.createElement("td");

	var a = d.createElement("a");a.href = "javascript:void(0)";a.style.color = "black";a.appendChild(d.createTextNode("<地形一覧表示>"));
	tmp_d4.appendChild(a);

	tmp_r.appendChild(tmp_d1);tmp_r.appendChild(tmp_d2);tmp_r.appendChild(tmp_d3);tmp_r.appendChild(tmp_d4);tmp_t.appendChild(tmp_r);
	div.appendChild(tmp_t);base.appendChild(div);

	var sheet = d.styleSheets[d.styleSheets.length-1];
	sheet.insertRule("table#beyond_maplist_table {border:2px solid black; border-collapse:collapse;}", sheet.cssRules.length);
	sheet.insertRule("table#beyond_maplist_table th {background:lightgray; padding: 5px; text-align:center; border:1px solid black;}", sheet.cssRules.length);
	sheet.insertRule("table#beyond_maplist_table td {padding: 2px; border:1px solid black;}", sheet.cssRules.length);

	$e(a, "click", function() {

		var flag_akichi = cgetCheckBoxValue("beyond_maplist_akichi");
		var flag_ryouchi = cgetCheckBoxValue("beyond_maplist_ryouchi");
		var flag_kyoten = cgetCheckBoxValue("beyond_maplist_kyoten");

		var area = $a("//map[@id=\"mapOverlayMap\"]//area");
		var lists = new Array();
		for(var i=0; i<area.length ; i++) {
			var dat = area[i].getAttribute("onmouseover");
			dat = dat.replace(/^.*rewrite/, "getTRData");
			dat = dat.replace(/\); .*$/, ");");
			var trdata;
			eval("trdata = " + dat);
			if( trdata ) {
				lists.push(trdata);
			}
		}

		lists.sort( function(a,b){
			if(a.ally == "" && b.ally != "") return 1;
			else if(a.ally != "" && b.ally == "") return -1;

			if(a.ally > b.ally) return 1;
			else if(a.ally < b.ally) return -1;
			else{
				if( a.user_name > b.user_name) return 1;
				else if(a.user_name < b.user_name) return -1;
				else{
					if( a.kyoten_kind > b.kyoten_kind ) return -1;
					else if( a.kyoten_kind < b.kyoten_kind ) return 1;
					else {
						if( parseInt(a.jinko,10) > parseInt(b.jinko,10) ) return -1;
						else if( parseInt(a.jinko,10) < parseInt(b.jinko,10) ) return 1;
						else {
							if( parseFloat(a.kyori) > parseFloat(b.kyori) ) return 1;
							else if( parseFloat(a.kyori) < parseFloat(b.kyori) ) return -1;
							else {
								if( a.name > b.name ) return 1;
								else if( a.name < b.name ) return -1;
								else return 0;
							}
						}
					}
				}
			}
			return 0;
			});

		var tbl = initTable();

		for(var i=0 ; i<lists.length ; i++) {
			var tr = d.createElement("tr");
			var td;
			td = d.createElement("td");
			td.innerHTML = lists[i].ally;
			tr.appendChild(td);
			td = d.createElement("td");
			td.innerHTML = lists[i].user_name;
			tr.appendChild(td);
			td = d.createElement("td");
			if( lists[i].kyoten_img ) td.innerHTML = "<img src=\"" + lists[i].kyoten_img +	"\" style=\"width:30px; height:30px;\" />";
			tr.appendChild(td);
			td = d.createElement("td");
			td.style.display = "none";
			td.innerHTML = lists[i].kyoten_kind;
			tr.appendChild(td);
			td = d.createElement("td");
			td.innerHTML = lists[i].jinko;
			tr.appendChild(td);
			td = d.createElement("td");
			td.innerHTML = lists[i].name;
			tr.appendChild(td);

			td = d.createElement("td");
			var xy = lists[i].xy.match(/\(([\-0-9]+),([\-0-9]+)\)/);
			if( xy ) td.innerHTML = cgetXYHtml(xy[1], xy[2]);
			else td.innerHTML = lists[i].xy;
			tr.appendChild(td);
			td = d.createElement("td");
			td.innerHTML = lists[i].kyori;
			tr.appendChild(td);
			td = d.createElement("td");
			if( lists[i].npc ) td.style.color = "red";
			td.innerHTML = lists[i].star;
			tr.appendChild(td);

			tbl.appendChild(tr);
		}

		if( OPT_TTDISTANCE) disp_ToolTipsDistance();//試し

		function getTRData(name, user_name, jinko, xy, ally, star, kyori, wood, stone, iron, rice, npc)
		{
			if( !flag_akichi && ally == "" ) return null;

			if( jinko == "-") jinko = "";
			var kyoten_img = "";
			var kyoten_kind = 0;
			if( jinko || npc) {
				var tmp = xy.match(/\(([\-0-9]+),([\-0-9]+)\)/);
				if( tmp ) {
					var cx = parseInt(URL_PARAM.x,10);
					var cy = parseInt(URL_PARAM.y,10);
					if( cx > MAP_X_MAX ) cx = MAP_X_MAX;
					if( cx < MAP_X_MIN ) cx = MAP_X_MIN;
					if( cy > MAP_Y_MAX ) cy = MAP_Y_MAX;
					if( cy < MAP_Y_MIN ) cy = MAP_Y_MIN;
					var no = cgetMapNofromXY(parseInt(tmp[1], 10), parseInt(tmp[2], 10), cx, cy, map_type);
					if( no ) {
						var img = $x("//div[@id=\"mapsAll\"]//img[@class=\"mapAll" + no + "\"]");
						if( img ) {
							kyoten_img = img.getAttribute("src");
							if( npc ) kyoten_kind = 4;
							else if( kyoten_img.match(/village/) ) kyoten_kind = 1;
							else if( kyoten_img.match(/fort/) ) kyoten_kind = 2;
							else if( kyoten_img.match(/capital/) ) kyoten_kind = 3;

						}
					}
				}
			}

			if( !flag_ryouchi && ally != "" && kyoten_kind == 0 ) return null;
			if( !flag_kyoten && ally != "" && kyoten_kind != 0 ) return null;

			return {"kyoten_kind":kyoten_kind, "kyoten_img":kyoten_img,
					"jinko":jinko , "ally":ally, "user_name":user_name,
					"name":name, "xy":xy, "kyori":kyori, "star":star, "npc":npc};
		}

		var sort_kind, sort_order;

		function row_sort(col, kind, order) {
			var tbl = $("beyond_maplist_table");
			var trs = $a("descendant::tr[position()>1]",tbl);
			sort_kind = kind;
			sort_order = order;

			var strs = new Array();
			if( kind == "xy" ) {
				//座標はaの下
				for(var i=0; i<trs.length ; i++) {
					var td = $x("descendant::td[" + col + "]", trs[i]);
					var a = $x("descendant::a", td);
					if( a ) strs.push({"node":trs[i], "value":a.innerHTML});
					else strs.push({"node":trs[i], "value":""});
				}
			} else {
				for(var i=0; i<trs.length ; i++) {
					var td = $x("descendant::td[" + col + "]", trs[i]);
					if(td.style.color=="red") {
						strs.push({"node":trs[i], "value":"★★★★★★★★★★" + td.innerHTML});//NPC砦だけ特別に
					}else{
						strs.push({"node":trs[i], "value":td.innerHTML});
					}
				}
			}

			strs.sort( function(a,b) {
				var ret = 0;
				if( sort_kind == "num" ){
					if( a.value == "" && b.value == "" ) return 0;
					else if( a.value == "" ) return 1;
					else if( b.value == "" ) return -1;
					else ret = parseInt(a.value, 10) - parseInt(b.value, 10);
				}else if( sort_kind == "kyo" ){
					if( parseInt(a.value, 10) == 0 && parseInt(b.value, 10) == 0) return 0;
					else if( parseInt(a.value, 10) == 0 ) return 1;
					else if( parseInt(b.value, 10) == 0 ) return -1;
					else ret = parseInt(a.value, 10) - parseInt(b.value, 10);
				}else if( sort_kind == "float" ){
					ret = parseFloat(a.value, 10) - parseFloat(b.value, 10);
				}else if (sort_kind == "xy") {
					//座標
					if( !a.value && !b.value ) ret =  0;
					else if( !a.value ) ret = 1;
					else if( !b.value ) ret = -1;
					else {
						var a_xy = a.value.split(",");
						var b_xy = b.value.split(",");
						ret = ( Math.pow(parseInt(a_xy[0], 10), 2) + Math.pow(parseInt(a_xy[1], 10), 2) ) -
							  ( Math.pow(parseInt(b_xy[0], 10), 2) + Math.pow(parseInt(b_xy[1], 10), 2) );
					}
				}else {
					if( a.value == b.value ) {
						ret = 0;
					}else if( a.value == "" ) {
						return 1;
					}else if( b.value == "" ) {
						return -1;
					}else if( a.value > b.value ) {
						ret = 1;
					}else {
						ret = -1;
					}
				}
				if( sort_order == "dsc") {
					ret = 0 - ret;
				}
				return ret;
			});

			tbl = initTable();

			for(var i=0 ; i<trs.length ; i++) {
				tbl.appendChild(strs[i].node);
			}
		}

		function appendSortButton(col, sortcol, kind )
		{
			var tbl = $("beyond_maplist_table");
			var th = $x("descendant::tr[1]//th[" + col + "]", tbl);
			if( !th ) return;
			th.appendChild(d.createElement("br"));

			var a = d.createElement("a");
			a.href = "javascript:void(0);";
			var img = d.createElement("img");
			img.src= IMG_DIR + "trade/icon_up.gif";
			img.alt = "昇順に並べ替え";
			img.title = img.alt;
			a.appendChild(img);
			th.appendChild(a);

			(function(n, k){
				$e(a, "click", function(){row_sort(n, k, "asc"); } );
			})(sortcol, kind);


			th.appendChild(d.createTextNode(" "));

			a = d.createElement("a");
			a.href = "javascript:void(0)";
			img = d.createElement("img");
			img.src= IMG_DIR + "trade/icon_down.gif";
			img.alt = "降順に並べ替え";
			img.title = img.alt;

			a.appendChild(img);
			th.appendChild(a);

			(function(n, k){
				$e(a, "click", function(){row_sort(n, k, "dsc"); } );
			})(sortcol, kind);

		}

		function initTable(){
			var dv = $("beyond_maplist");

			var tbl = $("beyond_maplist_table");
			if( tbl ) {
				tbl.parentNode.removeChild(tbl);
			}else{
				var a = d.createElement("a");
				a.href = "#ptop";
				a.style.color="black";
				a.appendChild(d.createTextNode("▲トップに戻る"));
				a.id = "beyond_maplist_table_gotop";
				dv.appendChild(a);
			}

			tbl = d.createElement("table");
			tbl.id = "beyond_maplist_table";

			tbl.innerHTML = "<tr>" +
				"<th>同盟</th><th>君主</th><th>拠点</th><th style=\"display:none;\">拠点Kind</th>" +
				"<th>人口</th><th>領地名</th><th>座標</th><th>距離</th><th>戦力</th>" +
				"</tr>";

			dv.insertBefore(tbl, $("beyond_maplist_table_gotop"));

			appendSortButton(1, 1, "str" );
			appendSortButton(2, 2, "str" );
			appendSortButton(3, 4, "kyo" );
			appendSortButton(5, 5, "num" );
			appendSortButton(7, 7, "xy" );
			appendSortButton(8, 8, "float" );
			appendSortButton(9, 9, "str" );

			return tbl;
		}
	});
}

//////////////////////
//距離/時間表示（ToolTips）
//////////////////////
function disp_ToolTipsDistance()
{
	if( location.pathname == "/village.php" ) {
		saveTrainingLevel();
	}

	var links = $a('//a[(contains(@href,"castle_send_troop.php")) and not(contains(@href,"TB_inline"))]');
	if (!links.length) {
		return;
	}

	var TL = 0;
	var ETL = 0;
	var vid = cgetCurrentVillageId();
	var lists = cloadData("TrainingLevels", "[]", true, true);

	for (var i = 0;i < lists.length;i++) {
		if (lists[i].id == vid) {
			TL = parseInt(lists[i].level,10);
			ETL = parseInt(lists[i].elevel,10);
			break;
		}
	}

	if (isNaN(""+TL)) {
		TL = 0;
	}
	if (isNaN(""+ETL)) {
		ETL = 0;
	}

	var reg = /x=(-?\d+)&y=(-?\d+)/;
	for(var i=0 ; i<links.length ; i++) {
		if(!reg.test(links[i].href)) continue;
		links[i].alt = "";
		links[i].title = "";
		links[i].removeAttribute("style");
		$e(links[i], "mouseover", function (event) {
			var xy = this.href.match(reg);
			var distance = cgetDistanceFromBase(xy[1], xy[2] );
			showToolTips(event, distance, TL, ETL);
		});
		$e(links[i], "mouseout", function () {hideToolTips(); } );
	}

	function showToolTips( evt, distance, trainingLevel , eTrainingLevel){
		hideToolTips();
		var sp = 0.05 * trainingLevel + 1+ (eTrainingLevel*0.001*distance);

		var tw = d.createElement("div");
		tw.id = "beyond_ToolTipsWindow";
		tw.style.position = "absolute";
		tw.style.backgroundColor = "lightyellow";
		tw.style.border = "outset 2px lightyellow";
		tw.style.fontSize = "10px";
		tw.style.padding = "10px";
		tw.style.zIndex = 1000001;
		var xxx = evt.pageX + 5;
		if( xxx > 700 ) xxx -=250;
		tw.style.left = xxx + "px";
		if( location.pathname.match(/land.php/)){
			tw.style.top = (evt.pageY +5) + "px";
		} else {
			tw.style.top = (evt.pageY +5-200) + "px";
		}

		var dv = d.createElement("div");
		dv.innerHTML = "時間の目安　　遠征訓練所Lv."+eTrainingLevel+" (+"+(eTrainingLevel*0.1*distance).toFixed(3)+"%)<br>距離 [" + distance.toFixed(2) + "]　訓練所Lv." + trainingLevel + " (+" + (TL*5) + "%)" ;
		tw.appendChild(dv);

		var tbl = d.createElement("table");
		tbl.style.border = "2px solid black";
		tbl.style.borderCollapse = "collapse";
		tbl.style.width = "100%";

		var now = cgetNow();

		for(var i=0 ; i<OPT_TTDISTANCE_ITEMS.length ; i++){

			var tmp = OPT_TTDISTANCE_ITEMS[i].match(/.*\((-?[0-9]+([\.]{1}[0-9]+)?)\)/);
			if( !tmp ) continue;
			var speed = parseFloat(tmp[1]);
			if( speed < 0 ) continue;

			var tr = d.createElement("tr");
			var td = d.createElement("td");
			td.style.border = "1px solid black";
			td.style.textAlign = "left";
			td.appendChild(d.createTextNode( OPT_TTDISTANCE_ITEMS[i] ));
			tr.appendChild(td);

			var timeText = getTime(speed * sp, distance);

			td = d.createElement("td");
			td.style.border = "1px solid black";
			td.style.textAlign = "right";
			td.appendChild(d.createTextNode(timeText));
			tr.appendChild(td);

			var dayText = caddDate(now, timeText);
			dayText = dayText.substring(5, dayText.length - 3).replace("-", "/");


			td = d.createElement("td");
			td.style.border = "1px solid black";
			td.style.textAlign = "right";
			td.appendChild(d.createTextNode(dayText));
			tr.appendChild(td);

			tbl.appendChild(tr);
		}

		tw.appendChild(tbl);
		$("beyond_floatpanel").appendChild(tw);

		function getTime(speed, dist){
			var tmp = dist * 3600 / speed;
			var h = Math.floor(tmp / 3600);
			var m = Math.floor((tmp - h*3600 ) / 60 );
			var s = Math.floor(tmp - h*3600 - m*60 );
			var tim = h + ":" +
				(m+100).toString().substr(-2)  + ":" +
				(s+100).toString().substr(-2);
			return tim;
		}

	}
	function hideToolTips(){
		var tw = $("beyond_ToolTipsWindow");
		if( tw ){
			tw.parentNode.removeChild(tw);
		}
	}


	function saveTrainingLevel(){
		var vil_id = cgetCurrentVillageId();
		if( !vil_id ) return;
		var basename = cgetCurrentBaseName();
		if( !basename ) return;

		var level = 0;
		var elevel = 0;
		var map = $a('//area[contains(@alt, "訓練所 LV")]');
		if(0 < map.length) {
			for (var i = 0;i < map.length;i++) {
				var lv = map[i].alt.match(/((?:遠征)?訓練所) LV.([0-9]+)/);
				if(lv[1] == "訓練所") {
					level = parseInt(lv[2],10);
				}
				else if (lv[1] == "遠征訓練所") {
					elevel = parseInt(lv[2],10);
				}
			}
		}


		var lists = cloadData("TrainingLevels", "[]", true, true);
		var newLists = new Array();
		var isNewItem = true;
		for (var i = 0;i < lists.length;i++) {
			if (chasVillageId(lists[i].id)) {
				var data = lists[i];
				if (data.id == vil_id) {
					data.basename = basename;
					data.level = level;
					data.elevel = elevel;
					isNewItem = false;
				}
				newLists.push({id:data.id,basename:data.basename,level:data.level,elevel:data.elevel});
			}
			if (newLists.length == 10) {
				break;
			}
		}

		if (isNewItem) {
			newLists.push({id:vil_id,basename:basename,level:level,elevel:elevel});
		}

		csaveData( "TrainingLevels", newLists, true, true );
	}


}

//////////////////////
//同盟/君主表示（ToolTips）
//////////////////////
function disp_ToolTipsAllyPerson(){
	var links = $a('//a[(contains(@href,"village_change.php") or contains(@href,"land.php")) and not(contains(@href,"TB_inline") or contains(@href,"from"))]');
	if (links.length == 0) return;

	var selfVillages =cgetVillageIds();

	for(var i=0 ; i<links.length ; i++) {
		if(links[i].href.match(/village_change\.php/)) {
			var tmp = links[i].href.match(/village_id=([0-9]+)/);
			if( tmp && selfVillages[tmp[1]]) {
				continue;
			}
		}
		links[i].alt = "";
		links[i].title = "";
		$e(links[i], "mouseover", function(event){ showToolTips(event, this.href); } );
		$e(links[i], "mouseout", function(){ hideToolTips(); } );
	}


	function showToolTips( evt, url )
	{
		hideToolTips();
		var tw = d.createElement("div");
		tw.id = "beyond_ToolTipsWindow";
		tw.style.position = "absolute";
		tw.style.backgroundColor = "lightyellow";
		tw.style.border = "outset 2px lightyellow";
		tw.style.fontSize = "10px";
		tw.style.padding = "10px";
		tw.style.zIndex = 1000001;
		var xxx = evt.pageX + 5;
		if( xxx > 700 ) xxx -=50;
		tw.style.left = xxx + "px";
		tw.style.top = (evt.pageY +5) + "px";
		var dv = d.createElement("div");
		dv.id = "beyond_ToolTipsWindow_base";
		dv.appendChild(d.createTextNode("領地 : ..."));
		tw.appendChild( dv );

		dv = d.createElement("div");
		dv.id = "beyond_ToolTipsWindow_ally";
		dv.appendChild(d.createTextNode("同盟 : ..."));
		tw.appendChild( dv );

		dv = d.createElement("div");
		dv.id = "beyond_ToolTipsWindow_user";
		dv.appendChild(d.createTextNode("君主 : ..."));
		tw.appendChild( dv );
		$("beyond_floatpanel").appendChild(tw);


		cajaxRequest(url, "GET", "", function(req){
			var tw = $("beyond_ToolTipsWindow");
			if( !tw ) return ;

		var dom = d.createElement("html");
		dom.innerHTML = req.responseText;
		if (navigator.userAgent.toLowerCase().indexOf('chrome') != -1) {
			$("beyond_tmp").appendChild(dom);
		}
		var dt = getDatafromLandElm(dom);
		if (navigator.userAgent.toLowerCase().indexOf('chrome') != -1) {
			$("beyond_tmp").removeChild(dom);
		}
		if( !dt ) return ;

		if( $("beyond_ToolTipsWindow_base") ) {
			$("beyond_ToolTipsWindow_base").innerHTML = "領地 : " + dt.base + "(" + dt.x + "," + dt.y + ")";
			$("beyond_ToolTipsWindow_ally").innerHTML = "同盟 : " + dt.ally;
			$("beyond_ToolTipsWindow_user").innerHTML = "君主 : " + dt.user;
		}
	}, function(req){
		//alert("サーバからエラーが返りましたよ" );
	});

	}
	function hideToolTips()
	{
		var tw = $("beyond_ToolTipsWindow");
		if( tw ){
			tw.parentNode.removeChild(tw);
		}
	}
	function getDatafromLandElm(dom){
		var ret = new Array();

		var nam = $x('.//span[@class="basename"]', dom);

		if( !nam ) return null;
		ret["base"] = nam.innerHTML;

		var xy = $x('.//span[@class="xy"]', dom);
		if( !xy ) return null;
		xy = xy.innerHTML.match(/([\-0-9]+),([\-0-9]+)/);
		if( !xy ) return null;
		ret["x"] = parseInt(xy[1], 10);
		ret["y"] = parseInt(xy[2], 10);

		var a = $a('.//div[@class="status"]//a', dom);
		if( a.length < 2 ) {
			ret["user"] = "";
			ret["ally"] = "";
		}else{
			ret["user"] = a[0].innerHTML;
			ret["ally"] = a[1].innerHTML;
		}
		return ret;
	}

}


//////////////////////
//プロフィール画面星表示
//////////////////////
function disp_UserStar(){
	if( location.pathname == "/user/" ) {
		showProfile();
	}

	function showProfile(){
		//君主名取得
		var uname_td = $x("//table[@class=\"commonTables\"]//tr[2]/td[2]");
		if( !uname_td ) return;
		var uname = uname_td.textContent.replace(/\s+/g, "");
		var uid = USER_ID;
		if( URL_PARAM.user_id ) uid = URL_PARAM.user_id;

		//table★欄追加
		cappendColumnForProfile("★", "beyond_star" );

		//内容初期設定
		lists = cloadData( "UserStarList" + uid, "[]", true, true );

		for( var i=0 ; i<lists.length ; i++){
			var td = $("beyond_star_" + lists[i].x + "_" + lists[i].y);
			if( td && td.innerHTML == "" ) {
				if( lists[i].npc ) {
					td.innerHTML = "★" + lists[i].star;
					td.style.color = "red";
				}else{
					td.innerHTML = "★" + lists[i].star + " (" + lists[i].wood + "," + lists[i].stone + "," + lists[i].iron + "," + lists[i].rice + ")";
				}
				td.style.opacity = lists[i].star * 0.05 + 0.5;
			}
		}
		//タイトルにGETを追加
		var th = $("beyond_star_title");
		if( th ) {
			var lnk = d.createElement("a");
			lnk.href = "javascript:void(0)";
			lnk.innerHTML ="(GET)";
			lnk.style.fontSize = "9px";

			var running = false;
			$e(lnk, "click", function() {

				if( running ) return ;

				if( confirm("☆情報を一気に取得するためサーバに負荷をかけます。\n何度も実行するとDOS攻撃と同じなので、実行には注意して下さい") == false ) return;
				running = true;

				window.setTimeout(timerFunc, 0);

				function timerFunc(){
					var tds = $a("//td[contains(@id, \"beyond_star_\")]");
					var targettd = "";
					var targetid = "";
					for( var i=0 ; i< tds.length ; i++) {
						if( tds[i].innerHTML == "" ) {
							targettd = tds[i];
							targetid = tds[i].id;
							break;
						}
					}
					if( !targetid ) {
						alert("全ての☆情報を取得しました");
						running = false;
						return;
					}

					var xy = targetid.match(/beyond_star_([\-0-9]+)_([\-0-9]+)/);
					if( !xy ) {
						GM_log("err");
						return ;
					}

					cajaxRequest("/map.php?x=" + xy[1] + "&y=" + xy[2], "GET", "", function(req) {
						var dom = d.createElement("html");
						dom.innerHTML = req.responseText;
						if (navigator.userAgent.toLowerCase().indexOf('chrome') != -1) {
							$("beyond_tmp").appendChild(dom);
						}

						var area = $a("//map[@id=\"mapOverlayMap\"]//area", dom);
						for(var i=0 ; i<area.length ; i++){
							var dat = area[i].getAttribute("onmouseover");
							dat = dat.replace(/^.*rewrite/, "setStar");
							dat = dat.replace(/\); .*$/, ");");
							//evalの中ではGM_set/getValueが出来ないので、変数を一旦外に出す形に
							eval("dat = " + dat);
							if( !dat ) continue;

							var td = $("beyond_star_" + dat.x + "_" + dat.y);
							if( !td ) { GM_log("td null err?:" + dat.x + "," + dat.y); return;};
							if( td.innerHTML) continue;

							csetUserStar( uid, dat.x, dat.y, dat.star.length, dat.wood, dat.stone, dat.iron, dat.rice, dat.npc );
							if( dat.npc ) {
								td.innerHTML = "★" + dat.star.length;
								td.style.color = "red";
							}else{
								td.innerHTML = "★" + dat.star.length + " (" + dat.wood + "," + dat.stone + "," + dat.iron + "," + dat.rice + ")";
							}
							td.style.opacity = dat.star.length * 0.05 + 0.5;
						}

						if (navigator.userAgent.toLowerCase().indexOf('chrome') != -1) {
							$("beyond_tmp").removeChild(dom);
						}

						window.setTimeout(timerFunc, 0);

					});
				}
			});

			th.appendChild(lnk);
		}
		function setStar(name, user_name, jinko, xy, ally, star, kyori, wood, stone, iron, rice, npc){
			if( uname == user_name) {
				var tmp = xy.match(/\(([\-0-9]+),([\-0-9]+)\)/);
				if( tmp ) {
					var x = tmp[1];
					var y = tmp[2];
					return {"user_name":user_name, "x":x, "y":y, "star":star, "wood":wood, "stone":stone, "iron":iron, "rice":rice, "npc":npc};
				}
			}
			return null;
		}
	}
}

//////////////////////
//プロフィール画面Level表示
//////////////////////
function disp_UserLevel(){

	if( location.pathname == "/user/" ) {
		if( !URL_PARAM.user_id || USER_ID == URL_PARAM.user_id ) {
			showProfile();
		}
	}
	if( location.pathname == "/land.php" || location.pathname == "/village.php" ) {
		//保存
		var spnxy = $x("//span[@class=\"xy\"]");
		if( !spnxy ){
			return;
		}
		var xy = spnxy.innerHTML.match(/\(([\-0-9]+),([\-0-9]+)\)/);
		if( !xy ) {
			return;
		}
		var tmp = spnxy.innerHTML.match(/レベル(\d+)/);
		if( tmp ) {
			//		GM_log("add:" + xy[1] + "," + xy[2]);
			csetMyLevel(xy[1], xy[2], tmp[1] );
		}else {
			//	   GM_log("del:" + xy[1] + "," + xy[2]);
			cdelMyLevel(xy[1], xy[2]);
		}
	}


	function showProfile(){
		//tableLevel欄追加
		cappendColumnForProfile("Level", "beyond_level" );

		//内容初期設定
		lists = cloadData( "MyLevelList", "[]", true, true );
		for( var i=0 ; i<lists.length ; i++){
			var td = $("beyond_level_" + lists[i].x + "_" + lists[i].y);
			if( td ) {
				td.innerHTML = lists[i].level;
			}
		}
		updateLevelUp();
		updateLevelUpLink();

		//タイトルにGETを追加
		var th = $("beyond_level_title");
		if( th ) {
			var lnk = d.createElement("a");
			lnk.href = "javascript:void(0)";
			lnk.innerHTML ="(GET)";
			lnk.style.fontSize = "9px";

		var running = false;
		$e(lnk, "click", function() {
			if( running ) return ;

			if( confirm("Level情報を一気に取得するためサーバに負荷をかけます。\n何度も実行するとDOS攻撃と同じなので、実行には注意して下さい") == false ) return;
			running = true;
			window.setTimeout(timerFunc, 0);

			function timerFunc(){
				var tds = $a("//td[contains(@id, \"beyond_level_\")]");
				var targettd = "";
				var targetid = "";
				for( var i=0 ; i< tds.length ; i++) {
					if( tds[i].innerHTML == "" ) {
						targettd = tds[i];
						targetid = tds[i].id;
						break;
					}
				}
				if( !targetid ) {
					updateLevelUp();
					updateLevelUpLink();
					running = false;
					alert("全てのレベル情報を取得しました");
					return;
				}

				var xy = targetid.match(/beyond_level_([\-0-9]+)_([\-0-9]+)/);
				if( !xy ) {
					GM_log("err");
					return ;
				}

				cajaxRequest("/land.php?x=" + xy[1] + "&y=" + xy[2], "GET", "", function(req) {
					var dom = d.createElement("html");
					dom.innerHTML = req.responseText;
					if (navigator.userAgent.toLowerCase().indexOf('chrome') != -1) {
						$("beyond_tmp").appendChild(dom);
					}
					var spnxy = $x("//span[@class=\"xy\"]", dom);
					if( !spnxy ){
						GM_log("span class=xy err");
						return;
					}
					var xy = spnxy.innerHTML.match(/\(([\-0-9]+),([\-0-9]+)\)/);
					if( !xy ) {
						GM_log("xy match err");
						return;
					}
					var level = 0;
					var tmp = spnxy.innerHTML.match(/レベル(\d+)/);
					if( tmp ) {
						level = tmp[1];
					}
					var td = $("beyond_level_" + xy[1] + "_" + xy[2]);
					if( !td ) { GM_log("td null err?:" + xy[1] + "," + xy[2]); return;};
					if( !td.innerHTML ) {
						csetMyLevel(xy[1], xy[2], level);
						td.innerHTML = level;
					}
					if (navigator.userAgent.toLowerCase().indexOf('chrome') != -1) {
						$("beyond_tmp").removeChild(dom);
					}

					window.setTimeout(timerFunc, 0);

				});
			}
		});
		th.appendChild(lnk);
	}

	function updateLevelUp(){
		//建設/破棄リストから
		var lists = cloadData("RemoveList", "[]", true, true);
		for(var i=0 ; i<lists.length ; i++) {
			if( lists[i].kind != 5 ) continue;
			var td = $("beyond_level_" + lists[i].x + "_" + lists[i].y);
			if( !td ) continue;
			//GM_log("td:" + td.innerHTML);
			var level = parseInt(td.innerHTML,10);
			if( isNaN( ""+level ) ) continue;
			td.innerHTML =	level + " (+)";
		}
	}
	function updateLevelUpLink(){
		var img_lvup = 'data:image/gif;base64,'+
			'R0lGODlhFQAVAJEAAIaT6////////wAAACH5BAUUAAIALAAAAAAVABUAAAJDlICpi3YM14u0WhVY'+
			'Rjn4zWlJx4HgiJrooqohm67A+c727GLpp8MhXZORRD4b8NYzQj4k5pDF2/CQl6pVclU4sgBDAQA7';
		var tds = $a("//td[contains(@id, \"beyond_level_\")]");
		for( var i=0 ; i<tds.length ; i++){
			if( "" + parseInt(tds[i].innerHTML,10) == tds[i].innerHTML ) {
				var lv = parseInt(tds[i].innerHTML,10);
				if( lv < 1 || lv > 4 ) continue;
				var mtbl = [2, 2, 2, 4];
				var meisei = mtbl[lv - 1];
				if( RES_NOW.fame >= meisei ) {
					var xy = tds[i].id.match(/beyond_level_([\-0-9]+)_([\-0-9]+)/);
					if( xy ) {
						var lnk =  '<a href="'+caddSessionId('/territory_proc.php?x=' + xy[1] + '&y=' + xy[2] + '&mode=lvup')+'" title="レベルアップ" onclick="';
							lnk += "return confirm('名声" + meisei + "を消費し、領地をレベルアップしますか？');";
							lnk += '"><img src="' + img_lvup + '" style="width:14px; height:14px; vertical-align:middle;"></a>';
						tds[i].innerHTML += lnk;
					}
				}
			}
		}
	}
}
}

//////////////////////
//マップ中央表示
//////////////////////
function disp_MapCenter()
{
	if(location.pathname != "/map.php" && location.pathname != "/big_map.php"){
		return;
	}
	var cx = parseInt(URL_PARAM.x, 10);
	var cy = parseInt(URL_PARAM.y, 10);

	if(isNaN(""+cx)){
		cx = 0;
	}
	if(isNaN(""+cy)){
		cy = 0;
	}
	if(cx > MAP_X_MAX){
		cx = MAP_X_MAX;
	}
	if(cx < MAP_X_MIN){
		cx = MAP_X_MIN;
	}
	if(cy > MAP_Y_MAX){
		cy = MAP_Y_MAX;
	}
	if(cy < MAP_Y_MIN){
		cy = MAP_Y_MIN;
	}
	var dv = d.createElement("div");
	dv.style.fontSize= "10px";
	dv.appendChild(d.createTextNode("中央:( " + cx + " , " + cy + " )"));
	$("map-xy-search").appendChild(dv);
}

//////////////////////
//出発時刻計算
//////////////////////
function disp_TSendTime()
{
	if( location.pathname != "/facility/castle_send_troop.php" ) return;

	var td = $x('//table[@class="fighting_about"]//tr[1]/td[1]');
	if( !td ) return ;

	var tim = td.textContent.match(/到着まで[:|：][\s|　]*(\d+):(\d+):(\d+)[\s|　]*到達時間/);
	if( !tim ) return;

	var area_up_timer = $("area_up_timer0");
	if( !area_up_timer ) return;
	var day = area_up_timer.textContent.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/);
	if( !day ) return;

	//ベース作成
	var div = d.createElement("div");
	div.style.margin = "5px";
	div.appendChild(d.createTextNode("到着時刻："));
	createText(div, "beyond_send_y", day[1]);
	div.appendChild(d.createTextNode("-"));
	createText(div, "beyond_send_m", day[2]);
	div.appendChild(d.createTextNode("-"));
	createText(div, "beyond_send_d", day[3]);
	div.appendChild(d.createTextNode("　"));
	createText(div, "beyond_send_h", "");
	div.appendChild(d.createTextNode(":"));
	createText(div, "beyond_send_mi", "");
	div.appendChild(d.createTextNode(":"));
	createText(div, "beyond_send_s", "");
	div.appendChild(d.createTextNode("　"));
	var btn = d.createElement("input");
	btn.type = "button";
	btn.id = "beyond_send_button";
	btn.value = "出発時刻計算";
	div.appendChild(btn);

	div.appendChild(d.createElement("br"));
	div.appendChild(d.createTextNode("出発時刻："));

	var spn = d.createElement("span");
	spn.id = "beyond_send_time";
	div.appendChild(spn);

	td.appendChild(div);

	$e(btn, "click", function() {
		if( $("beyond_send_y").value == "" ) $("beyond_send_y").value = "0";
		if( $("beyond_send_m").value == "" ) $("beyond_send_m").value = "0";
		if( $("beyond_send_d").value == "" ) $("beyond_send_d").value = "0";
		if( $("beyond_send_h").value == "" ) $("beyond_send_h").value = "0";
		if( $("beyond_send_mi").value == "" ) $("beyond_send_mi").value = "0";
		if( $("beyond_send_s").value == "" ) $("beyond_send_s").value = "0";
		var y = $("beyond_send_y").value;
		var m = $("beyond_send_m").value;
		var d = $("beyond_send_d").value;
		var h = $("beyond_send_h").value;
		var mi =$("beyond_send_mi").value;
		var s = $("beyond_send_s").value;
		y = parseInt(y, 10);
		m = parseInt(m, 10);
		d = parseInt(d, 10);
		h = parseInt(h, 10);
		mi =parseInt(mi, 10);
		s = parseInt(s, 10);
		if( isNaN(""+y) || isNaN(""+m) || isNaN(""+d) || isNaN(""+h) || isNaN(""+mi) || isNaN(""+s) ) {
			alert("数字で入力して下さい");
			return;
		}

		var dt = new Date(y, m - 1, d, h - parseInt(tim[1],10) , mi - parseInt(tim[2],10), s - parseInt(tim[3],10) );


		$("beyond_send_time").innerHTML =
			dt.getFullYear() + "-" + (dt.getMonth()+1) + "-" + dt.getDate() + " " +
			(dt.getHours()+100).toString().substr(-2)  + ":" +
			(dt.getMinutes()+100).toString().substr(-2)  + ":" +
			(dt.getSeconds()+100).toString().substr(-2);

	} );

	function createText(container, id, def)
	{
		var tb = d.createElement("input");
		tb.type = "text";
		tb.value = def;
		tb.id = id;
		tb.size = 3;
		container.appendChild(tb);
	}

}

//////////////////////
//小さいボタン
//////////////////////
function disp_SmallButton()
{

	//ボタンの表示部分の設定
	var btnConfs = {
		hbtn_event : {width : 20,start : -4},		//開催中イベント
		btn_buycp : {width : 23,start : -7},		//CP購入
		btn_getbusho : {width : 21,start : -2},		//ブショーダス
		hbtn_reward_vendor : {width : 24,start : -2},	//ヨロズダス
		btn_itemshop : {width : 21,start : -5},		//アイテムショップ
		btn_bushoduel : {width : 27,start : -1},	//デュエル
		btn_invitefriend : {width : 27,start : -9},	//？？
		btn_busyobook : {width : 20,start : -6}		//武将図鑑
	};

	var btnImages = $a('(id("sidebar")/ul/li | id("btn_area_box"))//img');
	for (var i =0; i < btnImages.length;i++) {
		var btnImage = btnImages[i];
		for (var key in btnConfs) {
			if (btnImage.src.indexOf(key) < 0) {
			   continue;
			}
			var btnConf = btnConfs[key];
			var btn = btnImage.parentNode;
			var btnHeight = 22;
			if (isNarrow) btnHeight = 25;
			btnImage.style.display = "none";

			btn.style.width = btnConf.width+"px";
			btn.style.height = btnHeight+"px";
			btn.style.marginLeft = "2px";
			btn.style.marginBottom = "2px";
			btn.style.background = 'url("'+btnImage.src+'") no-repeat '+btnConf.start+'px 0px';
			btn.style.display = "block";

			var floatNode = btn;
			if (!isNarrow) floatNode = btn.parentNode;

			floatNode.style.cssFloat = "left";

			if (i == 0) {
				btn.style.marginLeft = "0px";
			}
		}
	}

	if (!isNarrow) cgetElementSibling(floatNode.parentNode,0).style.clear = "both";



	//状況の縮小
	var tr = $x('//table[@class="situationTable"]//tr[1]');
	var tds = $a('//table[@class="situationTable"]//tr[2]//img[not(contains(@src,"sit_blank"))]/ancestor::td');
	if( tr && tds ) {
		for( var i=0; i< tds.length ; i++) {
			tr.appendChild(tds[i]);
		}

		cgetElementSibling(tr,0).style.display = "none";

		var imgs = $a(".//img", tr);
		for( var i=0; i< imgs.length ; i++) {
			imgs[i].style.width = "20px";
			imgs[i].style.height = "20px";
			if( !imgs[i].src.match(/(_no\.gif)$/) ) {
				Pika_elementQueue.push(imgs[i]);
			}
		}
	}

	//拠点・生産・簡易出兵先の伸縮
	var targetNames = ["base","production","easydeploy"];
	var targets = {
			base : {
				img : '(id("lodgment") | id("sidebar"))//img[contains(@src,"icon_base")]',
				inner : 'ancestor::div[contains(@class,"Head")]/following-sibling::div[contains(@class,"Inner")]'
			},
			production : {
				img : 'id("sidebar")//img[contains(@src,"icon_production")]',
				inner : 'ancestor::div[contains(@class,"Head")]/following-sibling::div[contains(@class,"Inner")]'
			},
			easydeploy : {
				img : '(//div[@class="footer_box"] | id("sidebar"))//img[contains(@src,"icon_easydeploy")]',
				inner : 'ancestor::div[contains(@class,"Head")]/following-sibling::div[contains(@class,"Inner")] | id("map_bookmark")'
			}
	};
	for(var i = 0;i < targetNames.length;i++) {
		if (isNarrow && targetNames[i] == 'base' && location.pathname.search(/^\/(village|map|land)\.php/) < 0) {
			continue;
		}

		var target = targets[targetNames[i]];

		var base_img = $x(target.img);
		if( !base_img ) continue;

		var base_inner = $x(target.inner, base_img);
		if( !base_inner ) continue;

		var oc = cloadData( "sidebox_oc" + i , "", true);
		if( oc ) {
			base_inner.style.display = "none";
			base_img.style.opacity = 0.3;
		}
		(function(inner, no) {
			$e(base_img, "click", function(e) {
				var ocs = "";
				if( inner.style.display == "none" ){
					inner.style.display = "";
					this.style.opacity = 1;
				}else{
					inner.style.display = "none";
					this.style.opacity = 0.3;
					ocs = "1";
				}
				csaveData( "sidebox_oc" + no , ocs, true);
			});
		})(base_inner, i);
	}

}

//////////////////////
//出兵マップ表示
//////////////////////
function disp_AttackMap()
{
	var img_atk = 'data:image/gif;base64,'+
			'R0lGODlhPAA8AIAAAP/M/////yH5BAUUAAEALAAAAAA8ADwAAAJ7jI+py+0Po5y02ouz3rz7D4bi'+
			'SJbmiabqyrbuC8fyTNf2jef6zvc8AATsgsEckYg7Fm9KoPE4XCakMCeDqmpCoSxt0yBsWQNj6bgb'+
			'dmJl6jUN+RSe3+V59ayMYZdwevjQd/c3ZbfiRlaYlXiYcsglFugjOUlZaXmJWVEAADs=';
	var img_mov = 'data:image/gif;base64,'+
			'R0lGODlhPAA8AIAAADP//////yH5BAUUAAEALAAAAAA8ADwAAAJ7jI+py+0Po5y02ouz3rz7D4bi'+
			'SJbmiabqyrbuC8fyTNf2jef6zvc8AATsgsEckYg7Fm9KoPE4XCakMCeDqmpCoSxt0yBsWQNj6bgb'+
			'dmJl6jUN+RSe3+V59ayMYZdwevjQd/c3ZbfiRlaYlXiYcsglFugjOUlZaXmJWVEAADs=';
	if( location.pathname == "/facility/unit_status.php" ) {
		var tds = $a("//table[@summary=\"出撃中の兵士\" or @summary=\"移動中の兵士\"]/tbody/tr[position()>1]/td[1]");

		for(var i=0; i<tds.length ; i+=3) {
			//0：場所　1：時間　２：兵種
			var xy = tds[i+0].innerHTML.match(/[\(|（](-?\d+),(-?\d+)[）|\)]$/);
			if( !xy ) continue;
			var tim = tds[i+1].innerHTML.match(/(\d+\-\d+\-\d+ \d+:\d+:\d+)/);
			if( !tim ) continue;
			var kind = 0;
			if( tds[i].parentNode.parentNode.parentNode.getAttribute("summary") == "移動中の兵士" )
				kind = 1;
			addList(tim[1], parseInt(xy[1],10), parseInt(xy[2],10), kind );

			var a = $x("descendant::div/a[contains(text(), \"キャンセルする\")]", tds[i+1]);
			if( a ) {
				(function(tim, x, y) {
					$e(a, "click", function(){
						var lists = cloadData("AttackList", "[]", true, true);
						for(var i=0 ; i<lists.length ; i++) {
							if( lists[i].x == x && lists[i].y == y && lists[i].time == tim ) {
								lists.splice(i,1);
								csaveData( "AttackList", lists, true, true );
								break;
							}
						}
					} );
				})(tim[1], parseInt(xy[1],10), parseInt(xy[2],10));
			}
		}
		return;
	}

	var lists = cloadData("AttackList", "[]", true, true);
	lists = checkList(lists);	   //時間を過ぎたものを削除

	var cx = parseInt(URL_PARAM.x,10);
	var cy = parseInt(URL_PARAM.y,10);
	if( cx > MAP_X_MAX ) cx = MAP_X_MAX;
	if( cx < MAP_X_MIN ) cx = MAP_X_MIN;
	if( cy > MAP_Y_MAX ) cy = MAP_Y_MAX;
	if( cy < MAP_Y_MIN ) cy = MAP_Y_MIN;

	//地図に表示
	if( lists.length ) {
		if( location.pathname == "/map.php" ) {
			var type = 1;
			if( $x("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort15 now\"]") ) type=2;
			else if( $x("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort21 now\"]") ) type=5;
			var map = $x("//div[@id=\"mapsAll\"]");
			for(var i=0 ; i<lists.length ; i++) {
				var no = cgetMapNofromXY(lists[i].x, lists[i].y, cx, cy, type );
				if( !no ) continue;
				var img = document.createElement("img");
				img.className = "mapAll" + no;
				if( lists[i].kind == 1 ) {
					img.src = img_mov;
				}else{
					img.src = img_atk;
				}
				img.title = lists[i].time;

				map.appendChild(img);

				var area = $x("//map[@id=\"mapOverlayMap\"]/area[contains(@href, \"?x=" + lists[i].x + "&y=" + lists[i].y + "\")]");
				if( area ){
					area.title += "　到着予定:" + lists[i].time;
					area.alt += "　到着予定:" + lists[i].time;
				}

			}
		} else if( location.pathname == "/big_map.php" ){
			for(var i=0 ; i<lists.length ; i++) {
				var mapAreaContents = $x("//div[@id=\"map51-content\"]//li/div/a[contains(@href, \"?x=" + lists[i].x + "&y=" + lists[i].y + "#\")]");
				var setMapAreaContents = null;
				if (mapAreaContents.length <= 0) {
					continue;
				}
				else{
					setMapAreaContents = mapAreaContents.cloneNode(true);
				}
				var dat = setMapAreaContents.getAttribute('onMouseOver');
				dat = dat.replace(/ class="bottom-popup-[lr]"/g, "");
				dat = dat.replace(/<[\/]dl/, "<dt class=\"bottom-popup-l\">到着予定</dt><dd class=\"bottom-popup-r\">"+ lists[i].time + "</dd></dl");
				setMapAreaContents.setAttribute('onMouseOver', dat)

				if( lists[i].kind == 1 ) {
					setMapAreaContents.innerHTML = '援';
				}
				else {
					setMapAreaContents.innerHTML = '出';
				}

				mapAreaContents.style.display = 'none';
				mapAreaContents.parentNode.appendChild(setMapAreaContents);

				var match = null;
				if ((match = mapAreaContents.parentNode.parentNode.className.match(/bg_[^\s]*/g)) && match.length == 1) {
					setMapAreaContents.style.color = 'red';
				}
				else {
					setMapAreaContents.style.color = 'moccasin';
				}
			}
		}
	}

	function addList(tim, x, y, kind)
	{
		var lists = cloadData("AttackList", "[]", true, true);

		var i;
		for(i=0 ; i<lists.length ; i++) {
			if(lists[i].x == x && lists[i].y == y ) {
				if( lists[i].time < tim ) {
					lists[i].time = tim;
					lists[i].kind = kind;
					break;
				}else{
					return;
				}
			}
		}
		if( i == lists.length ) {
			lists.push({"x":x, "y":y, "time":tim, "kind":kind } );
		}
		csaveData( "AttackList", lists, true, true );
	}

	function checkList(lists)
	{
		var dt = new Date();
		var ntime = dt.getFullYear() + "-" +
					(dt.getMonth()+101).toString().substr(-2) + "-" +
					(dt.getDate()+100).toString().substr(-2) + " " +
					(dt.getHours()+100).toString().substr(-2)  + ":" +
					(dt.getMinutes()+100).toString().substr(-2)  + ":" +
					(dt.getSeconds()+100).toString().substr(-2);
		var deleted = false;
		for(var i=0 ; i<lists.length ; i++) {
			if( lists[i].time < ntime ) {
				lists.splice(i,1);
				i--;
				deleted = true;
			}
		}
		if( deleted ) {
			if( lists.length ) {
				csaveData( "AttackList", lists, true, true );
			} else {
				cdelData("AttackList", true );
			}
		}
		return lists;
	}
}

//////////////////////
//同一カード合成ボタン
//////////////////////
function disp_CardCombine()
{
	if( location.pathname != "/union/result_lv.php" &&
		location.pathname != "/union/result_learn.php" &&
		location.pathname != "/union/result_remove.php") {
		return;
	}

	var ins = $a("//div[@class=\"back\"]")[1];
	var skill2 = $x("//div[@class=\"skill2\"]");
	var skill3 = $x("//div[@class=\"skill3\"]");

	var div1 = d.createElement("div");
	div1.className = "cardColmn";
	div1.align = "center";
	var div2 = d.createElement("div");
	div2.className = "control";
	div1.appendChild(div2);

	var a = d.createElement("a");
	a.href = caddSessionId("lvup.php?cid=" + URL_PARAM.cid);
	a.title = "スキルLvを上げる";
	a.className = "skillLvUp";
	a.appendChild(d.createTextNode("スキルLvを上げる"));
	div2.appendChild(a);

	if( !skill3 ) {
		a = d.createElement("a");
		a.href = caddSessionId("learn.php?cid=" + URL_PARAM.cid);
		a.title = "新しいスキルを習得する";
		a.className = "skillLearn";
		a.appendChild(d.createTextNode("新しいスキルを習得する"));
		div2.appendChild(a);
	}
	if( skill2 ) {
		a = d.createElement("a");
		a.href = caddSessionId("remove.php?cid=" + URL_PARAM.cid);
		a.title = "スキルを削除する";
		a.className = "skillDelete";
		a.appendChild(d.createTextNode("スキルを削除する"));
		div2.appendChild(a);
	}

	ins.parentNode.insertBefore(div1, ins.nextSibling);
}

//////////////////////
//ヨロズダス表示
//////////////////////
function disp_PikaYorozu()
{

	//ヨロズダス画面から残回数確認？
	if( location.pathname == "/reward_vendor/reward_vendor.php" ) {
		Pika_updateYorozudasState();
	}
	//ヨロズダス結果画面から残回数確認？
	if( location.pathname == "/reward_vendor/reward_vendor_result.php") {
		Pika_updateYorozudasState2();
	}

	Pika_displayYorozudasState();
}

//////////////////////
//HP回復時間表示
//////////////////////
function disp_PikaHPRestTime()
{
	if(location.pathname != "/card/deck.php") return ;
	Pika_displayRecoveryEstimates();

}

//////////////////////
//拠点生産量表示
//////////////////////
function disp_SuzanSeisan()
{
	var icon = IMG_DIR	+ "common/sidebar/icon_production.gif";
	var elms = ccreateSideBox("beyond_sidebox_suzanseisan", icon, "拠点生産");

	if(location.pathname == "/village.php") {
		Suzan_Seisan(elms.sideBoxInner);
	}

}


/////////////////////////////////////////////////////////////////////////////
//common functions
/////////////////////////////////////////////////////////////////////////////
function cgetCurrentBaseName()
{
	var xy = cgetCurrentBaseXY();
	return VILLAGES_INFO[(xy.x+"_"+xy.y).replace(/-/g,"m")].basename;
}

function cgetCurrentBaseXY()
{
	var nowLoc = $x('id("gnavi")//a[contains(@href,"map.php")]');
	if (!nowLoc) nowLoc = $x('id("gNav")//a[contains(@href,"map.php")]');
	if (!nowLoc) return null;


	var xy = nowLoc.href.match(/x=([\-0-9]+)&y=([\-0-9]+)/i);
	if( xy ) {
		return {'x':parseInt(xy[1], 10), 'y':parseInt(xy[2], 10)};
	}
}

function cgetDistanceFromBase(x, y)
{
	if( BASE_X == -9999 ) {
		var xy = cgetCurrentBaseXY();
		if( xy ) {
			BASE_X = xy.x;
			BASE_Y = xy.y;
		}
	}
	if( BASE_X != -9999 ) {
		var a = parseInt(x, 10);
		var b = parseInt(y, 10);
		return Math.sqrt(Math.pow(BASE_X - a, 2) + Math.pow(BASE_Y - b, 2));
	}
	return -1;
}

function cupdateCurrentResources()
{
	var nowNodes = PRE_LOAD_NODES['nowResources'];
	RES_NOW["wood"] = parseInt( nowNodes["wood"].innerHTML, 10 );
	RES_NOW["stone"] = parseInt( nowNodes["stone"].innerHTML, 10 );
	RES_NOW["iron"] = parseInt( nowNodes["iron"].innerHTML, 10 );
	RES_NOW["rice"] = parseInt( nowNodes["rice"].innerHTML, 10 );
}

function cgetNow()
{
	var stimeText = PRE_LOAD_NODES['serverTime'].innerHTML;
	var now = new Date();
	var nowTimeAry = stimeText.replace(/^\s*|\s*$/,'').split(":");
	now.setHours(parseInt(nowTimeAry[0],10),parseInt(nowTimeAry[1],10),parseInt(nowTimeAry[2],10));
	return now;
}

function caddDate(baseDate, timetxt)
{
	var tim = timetxt.match(/^(\d+):(\d+):(\d+)/);
	if( !tim ) return "";

	var dt = new Date(baseDate.getFullYear(),
					  baseDate.getMonth(),
					  baseDate.getDate(),
					  baseDate.getHours() + parseInt(tim[1],10),
					  baseDate.getMinutes() + parseInt(tim[2],10),
					  baseDate.getSeconds() + parseInt(tim[3],10) );

	return dt.getFullYear() + "-" + (dt.getMonth()+1) + "-" + dt.getDate() + " " +
			(dt.getHours()+100).toString().substr(-2)  + ":" +
			(dt.getMinutes()+100).toString().substr(-2)  + ":" +
			(dt.getSeconds()+100).toString().substr(-2);
}

//状態保存用のクッキー
function csetCookie(key, data)
{
	sday = new Date();
	sday.setTime(sday.getTime() + (120 * 1000 * 60 * 60 * 24));
	d.cookie = key + "=" + escape(data) + ";expires=" + sday.toGMTString() + "; path=/";
}

function cgetCookie(key)
{
	var data = "";
	var start = d.cookie.indexOf(key + "=");
	if (start != -1){
		var end = d.cookie.indexOf(";", start);
		data = unescape(d.cookie.substring(start + key.length + 1, end));
	}
	return data;
}
function cdelCookie(key)
{
	d.cookie = key + "=;expires=Thu,01-Jan-70 00:00:01 GMT; path=/";
}

function csetUserXY(aid, uid, x, y)
{
	var allylists = cloadData( "allyXYAllyList", "[]", true, true );

	if( allylists.indexOf(aid) == -1 ) {
		allylists.push(aid);
		csaveData( "allyXYAllyList", allylists, true, true );
	}

	var lists = cloadData( "allyXYList" + aid, "[]", true, true );

	for(var i=0 ; i<lists.length ; i++) {
		if( lists[i].id == uid ) {
			return;
		}
	}
	lists.push({"id":uid, "x":x, "y":y});
	csaveData( "allyXYList" + aid, lists, true, true );
}

function cdeleteUserXY(aid)
{
	var allylists = cloadData( "allyXYAllyList", "[]", true, true );

	var idx = allylists.indexOf(aid);
	if( idx != -1 ) {
		allylists.splice(idx,1);
		csaveData( "allyXYAllyList", allylists, true, true );
	}
	cdelData( "allyXYList" + aid, true );


}

function cresetUserXY()
{
	var allylists = cloadData( "allyXYAllyList", "[]", true, true );

	for(var i=0 ; i<allylists.length ; i++) {
		cdelData( "allyXYList" + allylists[i], true );
	}
	cdelData( "allyXYAllyList", true );
}

function cgetXYHtml(x,y)
{
	var img_send = IMG_DIR + "report/icon_go.gif";
	var img_mp = IMG_DIR + "report/icon_scout.gif";
	var m = "";
	var dist = cgetDistanceFromBase(x, y);
	if( dist != -1 ) {
		m = "　距離[" + dist.toFixed(2) + "]";
	}
	var txt = '';
	txt += '<a href="'+caddSessionId('/land.php?x=' + x + '&y=' + y + '#ptop')+'" title="表示" style="color:#0099cc; text-decoration: none;" onmouseover="';
	txt += "this.style.textDecoration='underline';"+'" onmouseout="'+"this.style.textDecoration='none';"+'">' + x + ',' + y + '</a>';
	txt += '<a href="'+caddSessionId('/map.php?x=' + x + '&y=' + y + '#ptop')+'" title="マップ' + x + ',' + y + '"><img src="' + img_mp + '" style="width:12px; height:12px; vertical-align:middle;"></a>';
	txt += '<a href="'+caddSessionId('/facility/castle_send_troop.php?x=' + x + '&y=' + y + '#ptop')+'" title="兵を送る' + x + ',' + y + m + '">';
	txt += '<img src="' + img_send + '" style="width:12px; height:12px; vertical-align:middle;"></a>';

	return txt;
}

function cajaxRequest(url, method, param, func_success, func_fail){
	var req = new XMLHttpRequest();
	req.onreadystatechange = function() {
		if (req.readyState == 4 && req.status == 200){
			func_success(req);
		}
		else if (req.readyState == 4 && req.status != 200){
			func_fail(req);
		}
	};

	if (SID) {
		var sdata = method.toLowerCase() == 'get' ? url : param;
		if (sdata.search(/(\?|&)SSID=[^&]+&?/i) < 0) {
		   if (method.toLowerCase() == 'get') {
			   url += (0 <= url.indexOf('?')) ? '&' : '?';
			   url += SID;
		   }
		   else {
			   if (typeof param != 'string') param = '';
			   if (0 < param.length) param += '&';
			   param += SID;
		   }
		}
	}

	req.open(method, url, true);
	if (method == 'POST'){
		req.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
	}
	req.send(param);
}
function str2csvstr(str) {
	var csvstr;

	csvstr =  str.replace(/^[\s　]+|[\s　]+$/g, "");
	csvstr = csvstr.replace(/\"/g, "\"\"");

	if (csvstr.indexOf(",") != -1) {
		csvstr = "\"" + csvstr + "\"";
	}

	return csvstr;
}

function cgetElementXY(elm) {
	if( !elm ) return null;

	var xx = 0;
	var yy = 0;
	while(elm){
		xx += elm.offsetLeft;
		yy += elm.offsetTop;
		elm = elm.offsetParent;
	}
	return {"x":xx, "y":yy};
}

// 2014/02/21 21x21マップ対応
function cgetMapNofromXY(x, y, base_x, base_y, type)
{
	if( isNaN(""+base_x) ) base_x = 0;
	if( isNaN(""+base_y) ) base_y = 0;

	var sc = 11;
	var hosei = 0;
	if( type == 2 ) {
		sc = 15;
	} else if( type == 5 ) {
		sc = 21;
		hosei = 1;
	}
	var hw = Math.floor( (sc - 1) / 2 );
	var no = "";
	if( x >= base_x - hw && x <= base_x - hw + sc - 1 &&
		y >= base_y - hw - hosei && y <= base_y - hw + sc - 1 - hosei  ) {
		no = (x - base_x + hw) * sc + (base_y + hw - y ) + 1;
		if( no < 10 ) no = "0" + no;
		else no = "" + no;
	}
	return no;
}

function ccreateCheckBox(container, id, def, text, title, left, span )
{
	var dv;
	left += 2;
	if (span == true) {
		dv = d.createElement("span");
	}else{
		dv = d.createElement("div");
	}
	dv.style.padding = "2px";
	dv.style.paddingLeft= left + "px";
	dv.title = title;
	var cb = d.createElement("input");
	cb.type = "checkbox";
	cb.id = id;
	cb.value = 1;
	if( def ) cb.checked = true;

	var lb = d.createElement("label");
	lb.htmlFor = id;

	var tx = d.createTextNode(text);
	lb.appendChild( tx );

	dv.appendChild(cb);
	dv.appendChild(lb);
	container.appendChild(dv);
	return cb;
}
function ccreateTextBox(container, id, def, text, title, size, left, span, wrap)
{
	var dv;
	left += 2;
	if (span == true) {
		dv = d.createElement("span");
	}else{
		dv = d.createElement("div");
	}
	dv.style.padding = "2px";
	dv.style.paddingLeft= left + "px";
	dv.title = title;
	var tb = d.createElement("input");
	tb.type = "text";
	tb.id = id;
	tb.value = def;
	tb.size = size;

	var tx = d.createTextNode(text);
	tx.title = title;

	dv.appendChild(tx);
	dv.appendChild(tb);
	container.appendChild(dv);

	if( wrap == true ){
		dv = d.createElement("div");
		dv.style.padding = "2px";
		container.appendChild(dv);
	}
	return tb;
}

function ccreateComboBox(container, id, sels, def, text, title, left )
{
	left += 2;
	var dv = d.createElement("div");
	dv.style.padding = "2px";
	dv.style.paddingLeft= left + "px";
	dv.title = title;
	var sel = d.createElement("select");
	sel.id = id;
	for(var i=0; i<sels.length; i++){
		var opt = d.createElement("option");
		opt.value = sels[i];
		opt.appendChild(d.createTextNode(sels[i]));
		sel.appendChild(opt);
	}
	if( def ) sel.value = def;

	var tx = d.createTextNode(text);
	tx.title = title;

	dv.appendChild(tx);
	dv.appendChild(sel);
	container.appendChild(dv);
	return sel;
}

function ccreateButton(container, text, title, func)
{
	var btn = d.createElement("input");
	btn.style.padding = "1px";
	btn.type = "button";
	btn.value = text;
	btn.title = title;
	container.appendChild(d.createTextNode(" "));
	container.appendChild(btn);
	container.appendChild(d.createTextNode(" "));
	$e(btn, "click", func);
	return btn;
}

function cgetCheckBoxValue(id)
{
	var c = $(id);
	if( !c ) return 0;
	if( !c.checked ) return 0;
	return 1;
}

function cgetTextBoxValue(id)
{
	var c = $(id);
	if( !c ) return "";
	return c.value;
}

function ccreateSideBox(id, img, title)	//faraway110523　メモ機能や領地リンクが1つだとＣＰを購入する辺り（右上）に重なって表示される
{
	var icon_box = 'data:image/gif;base64,'+
		'R0lGODlhCwALAJEAAP///zMzM////wAAACH5BAUUAAIALAAAAAALAAsAAAIVjI8Gy6z5AoAyplkh'+
		'xteiTW1NQyUFADs=';

	var conf = cloadData( id + "conf" , '{"float":false, "open":true, "x":"", "y":"", "pos":99 }', true, true );
	var elm_box = d.createElement("div");
	elm_box.id = id;
	elm_box.className = "sideBox";
	var elm_boxHead = d.createElement("div");
	elm_boxHead.className = "sideBoxHead";
	elm_box.appendChild(elm_boxHead);

	if (isNarrow) {
		elm_box.style.cssFloat = "left";
		elm_box.style.marginLeft = "10px";
	}

	var elm_h3 = d.createElement("h3");

	var elm_strong = d.createElement("strong");

	var elm_img = d.createElement("img");
	elm_img.src = img;
	elm_strong.appendChild(elm_img);
	elm_strong.appendChild(d.createTextNode(title));

	var elm_span=d.createElement("span");
	elm_span.className = "beyond_panel_ctlbox";
	var elm_img_up = d.createElement("img");
	elm_img_up.src= IMG_DIR + "trade/icon_up.gif";
	elm_img_up.title = "パネルを上に";
	elm_img_up.id = id + "up";
	var elm_img_down = d.createElement("img");
	elm_img_down.src= IMG_DIR + "trade/icon_down.gif";
	elm_img_down.title = "パネルを下に";
	elm_img_down.id = id + "down";
	var elm_img_box = d.createElement("img");
	elm_img_box.src= icon_box;
	elm_img_box.title = "フローティング/ドッキングの切り替え";
	elm_span.appendChild(elm_img_up);
	elm_span.appendChild(elm_img_box);
	elm_span.appendChild(elm_img_down);

	elm_strong.appendChild(elm_span);
	elm_h3.appendChild(elm_strong);
	elm_boxHead.appendChild(elm_h3);

	var elm_boxInner = d.createElement("div");
	elm_boxInner.className = "sideBoxInner";
	if( !conf.open ) {
		elm_boxInner.style.display = "none";
		elm_img.style.opacity = 0.3;
	}
	elm_box.appendChild(elm_boxInner);

	$e(elm_img, "click", function(){
		var sidebox = $(id);
		var op = false;
		if( !sidebox ) return;
		var inner = $x('.//div[contains(@class,"sideBoxInner")]', sidebox);
		if( !inner ) return;
		if( inner.style.display == "none" ){
			inner.style.display = "";
			this.style.opacity = 1;
			op = true;
		}else{
			inner.style.display = "none";
			this.style.opacity = 0.3;
		}

		var conf = cloadData( id + "conf" , '{"float":false, "open":true, "x":"", "y":"", "pos":99 }', true, true );
		conf.open = op;
		csaveData( id + "conf", conf, true, true );
	} );

	$e(elm_img_up, "click", function(){
		var sidebox = $(id);
		if( sidebox.parentNode.id != "beyond_fixpanel" ) return;
		var target = sidebox.previousSibling;
		if( !target ) return;
		sidebox.parentNode.removeChild(sidebox);
		target.parentNode.insertBefore(sidebox, target);
		crenumberSideBox();
	});

	$e(elm_img_down, "click", function(){
		var sidebox = $(id);
		if( sidebox.parentNode.id != "beyond_fixpanel" ) return;
		var target = sidebox.nextSibling;
		if( !target ) return;
		sidebox.parentNode.removeChild(sidebox);
		target.parentNode.insertBefore(sidebox, target.nextSibling);
		crenumberSideBox();
	});

	$e(elm_img_box, "click", function(){
		var sidebox = $(id);
		if( !sidebox ) return;

		var conf = cloadData( id + "conf" , '{"float":false, "open":true, "x":"", "y":"", "pos":99 }', true, true );

		if( sidebox.parentNode.id == "beyond_fixpanel" ) {
			if( isNaN(""+conf.x) || conf.x == "" || isNaN(""+conf.y) || conf.y == "" ) {
				var xy = cgetElementXY(sidebox);
				conf.x = xy.x;
				conf.y = xy.y;

			}

			var cx = d.body.clientWidth;
			var cy = d.body.clientHeight;
			var eW = elm_box.clientWidth;
			var eH = elm_box.clientHeight;

			elm_box.style.left = conf.x + "px";
			elm_box.style.top = conf.y + "px";

			if ((conf.x + eW) <= 0) {
				elm_box.style.left = "0px";
			}
			else if (cx <= conf.x ) {
				elm_box.style.left = (cx - eW) + "px";
			}
			if ((conf.y + eH) <= 0) {
				elm_box.style.top = "0px";
			}
			else if (cy <= conf.y) {
				elm_box.style.top = (cy - eH) + "px";
			}

			sidebox.parentNode.removeChild(sidebox);
			$("beyond_floatpanel").appendChild(sidebox);
			sidebox.style.position = "absolute";
			sidebox.style.top = conf.y + "px";
			sidebox.style.left = conf.x + "px";
			sidebox.style.zIndex = 1000;
			conf.float = true;
			$(id + "up").style.display = "none";
			$(id + "down").style.display = "none";
		}else {
			sidebox.parentNode.removeChild(sidebox);
			$("beyond_fixpanel").appendChild(sidebox);
			sidebox.style.position = "";
			sidebox.style.top = "";
			sidebox.style.left = "";
			sidebox.style.backgroundColor = "";
			sidebox.style.border = "";
			sidebox.style.zIndex = "";
			conf.float = false;
			$(id + "up").style.display = "";
			$(id + "down").style.display = "";
			csortSideBox();
		}
		csaveData( id + "conf", conf, true, true );
		SetPositionBox(id, title, elm_box, 1);	//faraway110526
  } );


	var movedNode = null;
	var currentZIndex = 0;

	$e(elm_boxHead, "mousedown", function(event){
		movedNode = $(id);
		if( movedNode.parentNode.id != "beyond_floatpanel" ) return true;

		g_MD = id;
		g_MX = event.pageX-parseInt(movedNode.style.left,10);
		g_MY = event.pageY-parseInt(movedNode.style.top,10);
		currentZIndex = document.defaultView.getComputedStyle(movedNode, '').zIndex;
		movedNode.style.zIndex = 9999;
		if (navigator.userAgent.toLowerCase().indexOf('chrome') == -1) {
			event.preventDefault();
		}

		conf = cloadData( id + "conf" , '{"float":false, "open":true, "x":"", "y":"", "pos":99 }', true, true );
	});
	$e(d, "mousemove", function(event){
		if(g_MD != id) return true;
		if( movedNode.parentNode.id != "beyond_floatpanel" ) return true;

		var x = event.pageX - g_MX;
		var y = event.pageY - g_MY;
		movedNode.style.left = x + "px";
		movedNode.style.top = y + "px";

		conf.x = x;
		conf.y = y;

	});
	$e(d, "mouseup", function(event){
		if(g_MD != id) return true;

		g_MD = "";
		movedNode.style.zIndex = currentZIndex;
		movedNode = null;

		csaveData( id + "conf", conf, true, true );
	});


	if( conf.float && !(isNaN(""+conf.x) || isNaN(""+conf.y))) {
		elm_box.style.position = "absolute";
		elm_box.style.zIndex = 1000;
		elm_img_up.style.display = "none";
		elm_img_down.style.display = "none";
		$("beyond_floatpanel").appendChild(elm_box);

		var cx = d.body.clientWidth;
		var cy = d.body.clientHeight;
		var eW = elm_box.clientWidth;
		var eH = elm_box.clientHeight;

		elm_box.style.left = conf.x + "px";
		elm_box.style.top = conf.y + "px";

		if ((conf.x + eW) <= 0) {
			elm_box.style.left = "0px";
		}
		else if (cx <= conf.x ) {
			elm_box.style.left = (cx - eW) + "px";
		}
		if ((conf.y + eH) <= 0) {
			elm_box.style.top = "0px";
		}
		else if (cy <= conf.y) {
			elm_box.style.top = (cy - eH) + "px";
		}

	} else {
		SetPositionBox(id, title, elm_box, 0);	//faraway110525
		$("beyond_fixpanel").appendChild(elm_box);
	}

	return {"sideBox":elm_box, "sideBoxHead":elm_boxHead, "sideBoxInner":elm_boxInner };

}



function move_pos_fame(){
	//ひろひろひろ
	//誰か綺麗に書き替えてくださいｗ
	//スマートなやり方わからないから超力業。
	//「li.fame」以外にもスタイル指定しているので、それを残しつつ。li.fameだけ消してます。
	//名声表示位置変更
	var ssno;var rlno;
	var sSheets=document.styleSheets;
	for(var i=0; i< sSheets.length;i++){
		for(var j=0; j<sSheets[i].cssRules.length;j++){
			if(sSheets[i].cssRules[j]["selectorText"]){
				if(tmpSelector=sSheets[i].cssRules[j]["selectorText"].match('li.fame')){ssno=i;rlno=j;break;}
			}
		}
		if(ssno){break;}
	}

	if(ssno){
		var nstyle=sSheets[ssno].cssRules[rlno].cssText.replace('li.fame','');
		sSheets[ssno].deleteRule(rlno);
		sSheets[ssno].insertRule(nstyle,1);
	}
	GM_addStyle("div#status div#status_point {margin-top:4px !important;}");


}

function SetPositionBox(id, title, elm_box, dat)	//faraway110525
{
	var ccnt = 0 - dat;

	if(OPT_MEMO	== 1){				//メモ機能
		ccnt = OPT_MEMO_COUNT;
		if(OPT_MEMO_COUNT == 1){	//メモ数(1～5)"
		}
	}

	if(OPT_MAPLINK == 1){			//領地リンク機能
		ccnt++;
	}

	if(OPT_REMOVELIST == 1){		//破棄中の領地表示（領地レベル表示）
		ccnt++;
	}

	if( OPT_RESERVE_VILLAGE == 1){		//拠点建設破棄予約リスト
		ccnt++;
	}

	if( OPT_SUZAN_SEISAN == 1){		//拠点生産量表示
		ccnt++;
	}

	if( ccnt <= 1){
		if(id == "beyond_sidebox_villageListBox"){//拠点
		elm_box.style.position = "absolute";
		elm_box.style.top = "311px";
		elm_box.style.left = "761px";
		elm_box.style.zIndex = 1000;
		}
	}

	if( ccnt <= 1){

		if(OPT_MEMO	== 1){				//メモ機能"
			if(id.match("beyond_sidebox_memo")){		//メモ
				SetPositionBoxSub(elm_box);
			}
		}

		if(OPT_MAPLINK == 1){			//領地リンク機能"
			if(id == "beyond_sidebox_xylink"){		//領地/君主ﾘﾝｸ
				SetPositionBoxSub(elm_box);
			}
		}

		if(OPT_REMOVELIST ==1){//破棄中の領地表示（領地レベル表示）
			if(id == "beyond_sidebox_removelist"){	//建設/破棄ﾘｽﾄ
				SetPositionBoxSub(elm_box);
			}
		}

		if( OPT_RESERVE_VILLAGE == 1){		//拠点建設破棄予約リスト
			if(id == "beyond_sidebox_reserve_villagelist"){	//拠点建設予約
				SetPositionBoxSub(elm_box);
			}
		}

		if( OPT_SUZAN_SEISAN == 1){		//拠点生産量表示
			if(id == "beyond_sidebox_suzanseisan"){	//拠点生産
				SetPositionBoxSub(elm_box);
			}
		}
	}
}
function SetPositionBoxSub(elm_box){	//faraway110525
	elm_box.style.position = "absolute";
	elm_box.style.top = "411px";
	elm_box.style.left = "761px";
	elm_box.style.zIndex = 1000;
}

function csortSideBox()
{
	var sideboxes = $a("//div[@id=\"beyond_fixpanel\"]/div[@class=\"sideBox\"]");
	var srt = new Array();
	for(var i=0 ; i<sideboxes.length ; i++) {
		var pos = 0;

		var conf = cloadData( sideboxes[i].id + "conf" , '{"float":false, "open":true, "x":"", "y":"", "pos":99 }', true, true );
		pos = conf.pos;
		srt.push({"node":sideboxes[i], "pos":pos});
	}

	srt.sort( function(a,b) {return a.pos - b.pos;});

	for(var i=0 ; i<srt.length ; i++){
		srt[i].node.parentNode.removeChild(srt[i].node);
	}
	var fixpanel = $("beyond_fixpanel");
	for(var i=0 ; i<srt.length ; i++){
		fixpanel.appendChild(srt[i].node);
	}
}

function crenumberSideBox()
{
	var sideboxes = $a("//div[@id=\"beyond_fixpanel\"]/div[@class=\"sideBox\"]");

	for(var i=0 ; i<sideboxes.length ; i++) {
		var conf = cloadData( sideboxes[i].id + "conf" , '{"float":false, "open":true, "x":"", "y":"", "pos":99 }', true, true );
		conf.pos = i;
		csaveData( sideboxes[i].id + "conf", conf, true, true );

	}
}

function cappendColumnForProfile(title, id)
{
	var tds = $a('//table[@class="commonTables"]//th[contains(text(),"座標")]/../preceding-sibling::tr/*[contains("tdTDthTH",name())][last()]');
	for(var i=0 ; i<tds.length ; i++) {
		tds[i].colSpan++;
	}

	var tr = $x('//table[@class="commonTables"]//th[contains(text(),"座標")]/..');
	var th = d.createElement("th");
	th.className = "ttl4";
	th.id = id + "_title";
	th.appendChild( d.createTextNode( title ) );
	tr.appendChild( th );

	var trs = $a('//table[@class="commonTables"]//th[contains(text(),"座標")]/../following-sibling::tr');
	for(var i=0 ; i<trs.length ; i++) {
		var xytd = trs[i].childNodes[3];
		if( !xytd ) continue;
		var xy = xytd.innerHTML.match(/([\-0-9]+),([\-0-9]+)/);
		if( !xy ) continue;

		var td = d.createElement("td");
		td.id = id + "_" + xy[1] + "_" + xy[2];
		trs[i].appendChild(td);

		var pstd = trs[i].childNodes[5];
		if( !pstd ) continue;
		if( pstd.innerHTML != "&nbsp;" ) {
			td.textContent = "-";
		}
	}
}

function csetUserStar(uid, x, y, star, wood, stone, iron, rice, npc)
{
	var userlists = cloadData( "UserStarUserList", "[]", true, true );
	if( userlists.indexOf(uid) == -1 ) {
		userlists.push(uid);
		csaveData( "UserStarUserList", userlists, true, true );
	}

	var lists = cloadData( "UserStarList" + uid, "[]", true, true );

	for(var i=0 ; i<lists.length ; i++) {
		if( lists[i].x == x && lists[i].y == y ) {
			return;
		}
	}
	lists.push({"star":star, "x":x, "y":y, "wood":wood, "stone":stone, "iron":iron, "rice":rice, "npc":npc });
	csaveData( "UserStarList" + uid, lists, true, true );
}

function cresetUserStar()
{
	var userlists = cloadData( "UserStarUserList", "[]", true, true );

	for(var i=0 ; i<userlists.length ; i++) {
		cdelData( "UserStarList" + userlists[i], true );
	}
	cdelData( "UserStarUserList", true );
}

function csetMyLevel(x, y, level)
{
	var lists = cloadData( "MyLevelList", "[]", true, true );

	var ins = true;
	for(var i=0 ; i<lists.length ; i++) {
		if( lists[i].x == x && lists[i].y == y ) {
			if( level == -1 ) {
				lists[i].level++;
			}else{
				lists[i].level = level;
			}
			ins = false;
			break;
		}
	}
	if( ins && level != -1) {
		lists.push({"x":x, "y":y, "level":level});
	}
	csaveData( "MyLevelList", lists, true, true );
}
function cdelMyLevel(x, y)
{
	var lists = cloadData( "MyLevelList", "[]", true, true );

	for(var i=0 ; i<lists.length ; i++) {
		if( lists[i].x == x && lists[i].y == y ) {
			lists.splice(i,1);
			csaveData( "MyLevelList", lists, true, true );
			break;
		}
	}
}

function cdelData(key, local )
{
	if( local ) key = location.hostname + key;
	GM_deleteValue( key );
}

//////////////////////////////////////////////////////////////////
//プレゼンツbｙピカチュウ関数群
//http://shigematsu.org/
//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓
//////////////////////////////////////////////////////////////////
function Pika_blinkElements()
{
	// Drift-free blinking routine
	var opacity = Math.round((new Date() % 1000) / 1000);
	for (var i = 0; i < Pika_elementQueue.length; ++i) {
		Pika_elementQueue[i].style.opacity = opacity;
	}
	window.setTimeout(function() { Pika_blinkElements(); }, 500);
}

function Pika_updateYorozudasState() {
	var x = $a('//div[@class="sysMes"]/strong');
	if( x.length < 3 ) return;
	var nextUpdate = new Date(x[2].textContent.replace(/-/g, '/')).getTime();
	var info = {
		current:	+x[0].textContent,
		nextUpdate: nextUpdate,
		confirm:	nextUpdate - (24 * 60 * 60)
	};
	csaveData('yorozudas_state', info, true, true);
	Pika_displayYorozudasState();
}
function Pika_updateYorozudasState2() { //result用を追加
	var x = $a('//div[@class="sysMes2"]/strong');
   if( x.length < 1 ) return;
	var nextUpdate = new Date(x[1].textContent.replace(/-/g, '/')).getTime();
	var info = {
		current:	+x[0].textContent,
		nextUpdate: nextUpdate,
		confirm:	nextUpdate - (24 * 60 * 60)
	};
	csaveData('yorozudas_state', info, true, true);
	Pika_displayYorozudasState();
}
function Pika_displayYorozudasState() {
	var xpath = '(id("sidebar")/ul/li | id("btn_area_box"))/a[contains(@href, "/reward_vendor/reward_vendor.php")]/img';//20121011 ひろひろひろ
	if (OPT_SMALLBTN) {
		xpath += '/..';
	}
	var img_yorozu = $x(xpath);

		var info = cloadData('yorozudas_state', '{}', true, true);
		var now = new Date().getTime();
		if (info.nextUpdate < now) {
			Pika_elementQueue.push(img_yorozu);
		} else {
			if (info.current <= 0) {
				img_yorozu.style.opacity = 0.5;
			} else {
				if (info.confirm > 0
				 && info.confirm < now) {
					if (confirm('ヨロズダスが引けますが、まだ引いていません。\n後でまた通知しますか?')) {
						var delta = (info.nextUpdate - now) / 3600;
						if (delta < 4) {
							info.confirm += 1 * 60 * 60; // 1 hour later
						} else if (delta < 8) {
							info.confirm += 2 * 60 * 60; // 2 hours later
						} else {
							info.confirm += 4 * 60 * 60;
						}
					} else {
						info.confirm = 0;
					}
					csaveData('yorozudas_state', info, true, true);
				}
			}
		}
}

function Pika_displayRecoveryEstimates() {
	var candidates = $a('//*[@id="deck_file"]//*[div[@class="setPlace false"]]');//デッキへセットできないカード
	for (var i = 0; i < candidates.length; ++i) {
		//var level = + $x('*//*[starts-with(@class,"level_")]', candidates[i]).innerHTML;
		//var hp	= + candidates[i].getElementsByClassName('status_hp')
		//				[0].textContent.toString().split(/[\/]/)[0];
		var level = + $x('*//div[@class="level"]/span', candidates[i]).innerHTML;
		var hp	= + $x('*//div[@class="status_hp"]/span[@class="value"]', candidates[i]).innerHTML.toString().split(/[\/]/)[0];
		if (hp >= 100) continue;
		var hours = (level <= 5) ? Math.pow(2, level - 2) * (100 - hp) / 100 :
						(level <= 10) ? 4 * (level - 3) * (100 - hp) / 100 :
							(level <= 200) ? (level + 20) * (100 - hp) / 100:
				220 * (100 - hp) / 100;
		var msg  = Pika_formatEstimate(hours, false) + 'にHP全回復';
		candidates[i].getElementsByClassName('setPlace false')[0].innerHTML = msg;
	}

	candidates = $a('//*[@id="deck_file"]//*[div[@class="control"]/dl/dd[contains(text(),"治療中")]]');
	//カード表示
	 for (var i = 0; i < candidates.length; ++i) {
//		var level = + $x('*//*[starts-with(@class,"level_")]', candidates[i]).innerHTML;
//		var hp	= + candidates[i].getElementsByClassName('status_hp')
//						[0].textContent.toString().split(/[\/]/)[0];
		var level =+ $x('*//div[@class="level"]/span', candidates[i]).innerHTML;
		var hp	= + $x('*//div[@class="status_hp"]/span[@class="value"]', candidates[i]).innerHTML.toString().split(/[\/]/)[0];
		if (hp >= 100) continue;
		var hours = (level <= 5) ? Math.pow(2, level - 2) * (100 - hp) / 100 :
						(level <= 10) ? 4 * (level - 3) * (100 - hp) / 100 :
							(level <= 200) ? (level + 20) * (100 - hp) / 100:
				220 * (100 - hp) / 100;
		var msg  = Pika_formatEstimate(hours, false) + '<br>にHP全回復';
		candidates[i].getElementsByTagName('dd')[2].innerHTML = msg;
		candidates[i].getElementsByTagName('dd')[2].style.fontSize = "10px";
		candidates[i].getElementsByTagName('dd')[2].style.margin = "0px";
	}

	window.setTimeout(function() { Pika_displayRecoveryEstimates(); }, 60*1000);
}
function Pika_formatEstimate(hours, displaySecs) {
	var msg   = '';
	var now   = new Date();
	var xday  = new Date(now.getTime() + hours * 60 * 60 * 1000);
	var days  = Math.floor(hours / 24);

	var delta = Math.floor(
		(
		new Date(xday.getYear(), xday.getMonth(), xday.getDate()) -
		new Date(now .getYear(), now .getMonth(), now .getDate())
		)
		/ (24 * 60 * 60 * 1000));

	if (delta == 0) msg = '';
	else if (delta == 1) msg = '明日';
	else if (delta == 2) msg = '明後日';
	else msg = delta + '日後';

	msg += xday.getHours() + '時';
	msg += xday.getMinutes() + '分 ';

	if (days == 0) {
		var seconds = Math.floor((hours * 3600) % 60);
		var minutes = Math.floor((hours *	60) % 60);
		hours = Math.floor(hours);

		if (hours == 0) {
			if (displaySecs) {
				msg += '(' + minutes + '分' + seconds + '秒後) ';
			}
			else {
				msg += '(' + minutes + '分後) ';
			}
		}
		else {
			msg += '(' + hours+ '時間' + minutes +'分後) ';
		}
	}
	return msg;
}

//-------------------------------------------------
// マップ画面検索改善
//-------------------------------------------------
function Pika_installMapXYHelper() {
	if( location.pathname != '/map.php' && location.pathname != '/big_map.php'){
		return;
	}

	jQuery.noConflict();
	j$ = jQuery;
	j$("#map-xy-search").each(
		function(){
			j$('input[type="text"]',this).attr("value","");
		}
	);

	var btn = $x('//div[@id="map-xy-search"]//input[@type="text"]');
	if( !btn ){
		return;
	}
	btn.removeAttribute("onblur");
	btn.addEventListener('blur',
		function() {
			var xpath = '//div[@id="map-xy-search"]//input[@type="text"]';
			var xy = $a(xpath);
			var x  = xy[0].value.toString();

			if (x.match(/(-?\d+)[ .,&、](?:y=)?(-?\d+)/)) {
				xy[0].value = RegExp.$1;
				xy[1].value = RegExp.$2;
			}
		}, false);
}

// bro3-HighLightName
function bro3HighLightName(){
	if(location.pathname !='/alliance/info.php') return;
	// ==UserScript==
	// @name bro3-HighLightName
	// @namespace http://ameblo.jp/putei1724
	// @include http://*.3gokushi.jp/alliance/info.php*
	// @version 1
	// @grant none
	// ==/UserScript==

	var d = document;			//document
	var host = location.hostname;		//ﾎｽﾄ名

	var $ = function(id) { return d.getElementById(id); };
	var $x = function(xp,dc) { return d.evaluate(xp, dc||d, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
	var $a = function(xp,dc) { var r = d.evaluate(xp, dc||d, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); var a=[]; for(var i=0; i<r.snapshotLength; i++){ a.push(r.snapshotItem(i)); } return a; };
	var $e = function(e,t,f) { if (!e) return; e.addEventListener(t, f, false); };

	var myName = "";

	cajaxRequest("http://" + host + "/user/", "GET", "", function(req) {
		var dom = d.createElement("div");
		dom.innerHTML = req.responseText;
		//var tds=$a("//td",dom);
		var tbl = dom.getElementsByClassName("commonTables")[0];
		var tr = tbl.getElementsByTagName("tr");
		myName = tr[1].getElementsByTagName("td")[1].innerHTML.replace(/\s+/g, "");

		if (myName) {
			var gray02Wrapper = document.getElementById("gray02Wrapper")
			var tables = gray02Wrapper.getElementsByClassName("tables")[0]
			var tr = tables.getElementsByTagName("tr")
			var len = tr.length

			for (var i=0;i<len;i++){
				var target = tr[i].getElementsByTagName("a")[0]

				if (target == undefined){
					continue;
				}

				var userName = target.textContent

				if (myName==userName){
					tr[i].style.backgroundColor = "yellow";
					break;
				}
			}
		}
	},function(req) {
		if(debug) console.log("取得エラー");
	});
}



//-------------------------------------------------
// 51x51マップ中央ガイド削除
//-------------------------------------------------
function map51_guide_off() {
	if(location.pathname != '/big_map.php'){
		return;
	}
	jQuery.noConflict();
	j$ = jQuery;
	j$("#map51-content a[class*=guide]").remove();
}

//-------------------------------------------------
// トレード画面入力改善
//-------------------------------------------------
function Pika_installTradeHelper() {

	if( location.pathname != '/card/trade.php' ){
		return;
	}

	jQuery.noConflict();
	j$ = jQuery;

	j$("#button").bind("click",
		function(){
			var t = j$("#t").val();
			if (t == "name" || t == "skill"  || t == "no_skill") {
				var inputval = j$("#k").val();
				if ( inputval.match(/^\d+$/) ) {
					j$("#t").val("no");
				}
			}
		}
	);
}


function Pika_prepareForDisplayBuildStatus()
{
	var maps = $('maps');
	var xpath = 'img[contains(@src, "/img_lv0.gif")]/@class';
	var nodes = $a(xpath, maps);
	for (var i = 0; i < nodes.length; ++i) {
		var index = nodes[i].value.toString().substr(-2);
		var xpath = 'img[@class="map' + index +'" and contains(@src, "/facility_10")]';
		var isResourceProducingLot = $a(xpath, maps).length;
		if (!isResourceProducingLot) {
			$x('//img[@class="mapicon'+index+'"]').src =
				'data:image/gif;base64,'+
				'R0lGODlhFwAWAMQfADp1MxYsFzp7NEGdQTp7Nm2bac7dzebu5l6TWkWmRZ69nPL2'+
				'8kWAQLXNszuNO7/UvzV7NWqVZU6PTNrm2Y20i0apRj+WP1LOc0y7TDmDOSAgID+G'+
				'OShRLz9+N////////yH5BAEAAB8ALAAAAAAXABYAAAW74PdxZGmepShyV+u+sMut'+
				'WG3fOD5zVe8niYFQmPD5OBqOZcm0OCQUg4HiaC6RnIx2m4E8PGCPAsLNYDfoNAGx'+
				'OEgKYEYafZ5vCJODYN/wFOx1cwhiAhsCCh4IgEl2G3ANAJEGBwSLWWUMYBQRXwUE'+
				'XARYHaOkh2ELBQKkpKKrowARChQMAK6jrbaRkba3GiO8wKwaviMoHLwlwyofw83D'+
				'rs7Ky9MiqwEB1NnLpNfa3h+j3d/aHeLj2tjfIQA7';
		}
	}
}

function Pika_displayBuildStatus() {

	var xpath = 'id("actionLog")//li/span[@class="buildStatus" and contains(.,"建設")]/a';
	var nodes = $a(xpath);
	var facilities = {};
	for (var i = 0; i < nodes.length; ++i) {
		nodes[i].href.match(/x=(\d+)&y=(\d+)/);
		var x = parseInt(RegExp.$1,10);
		var y = parseInt(RegExp.$2,10);
		var index = (101 + x * 7 + y).toString().substr(-2);
		facilities[index] = index;
	}

	for (var index in facilities) {
		Pika_elementQueue.push(document.getElementsByClassName('map'+index)[0]);
		Pika_elementQueue.push(document.getElementsByClassName('mapicon'+index)[0]);
	}

	var deleting = $x('//*[@id="actionLog"]/ul/li[contains(text(), "削除中")]/span[@class="buildStatus"]/a');
	if (deleting && deleting.href.match(/x=(\d+)&y=(\d+)/)) {
		var x = +RegExp.$1;
		var y = +RegExp.$2;
		var index = (101 + x * 7 + y).toString().substr(-2);
		document.getElementsByClassName('map'+index)[0]
			.style.opacity = 0.5;
		document.getElementsByClassName('mapicon'+index)[0]
			.style.opacity = 0.5;
	}
}
//////////////////////////////////////////////////////////////////
//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑
//プレゼンツbｙピカチュウ関数群
//////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////
//プレゼンツbｙsu-zan関数群
//http://shigematsu.org/
//↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓↓
//////////////////////////////////////////////////////////////////
function Suzan_Seisan(inner)
{

	var yieldList = {
			other : [0,6,14,25,50,80,117,162,214,272,335,404,476,550,626,702],
			rice : [0,6,18,36,72,114,167,231,305,388,479,577,680,786,894,1003]
		};


	var yieldExtends = [
		{
			name : '水車',
			facility : {
				match : '畑',
				data : [0,0.03,0.06,0.09,0.12,0.15,0.18,0.21,0.24,0.27,0.3]
			},
			resource : {
				match : '穀物',
				data : [0,40,60,80,110,140,180,220,270,350,450]
			}
		},
		{
			name : '工場',
			facility : {
				match : '伐採所石切り場製鉄所',
				data : [0,0.03,0.05,0.08,0.1,0.13,0.15,0.18,0.2,0.23,0.25]
			},
			resource : {
				match : '森林岩山鉄鉱山',
				data : [0,55,65,75,95,115,145,185,235,300,380]
			}
		}
	];

	var seisan = { w:0, s:0, i:0, r:0 };


	for (var i = 0; i < 2;i++) {
		var yieldExtend = yieldExtends[i];
		var yieldExtendArea = $x('//area[starts-with(@alt,"'+yieldExtend.name+'")]');
		if (!yieldExtendArea) {
			continue;
		}
		var yieldExtendAreaInfo = cgetFacilityInfoFromArea(yieldExtendArea);
		var yieldExtendResource = yieldExtend.resource.data[yieldExtendAreaInfo.lv];
		var yieldExtendFacility = yieldExtend.facility.data[yieldExtendAreaInfo.lv];

		var squreaAreas = cgetSquareElementFromArea(yieldExtendArea);
		for (var key in squreaAreas) {
			if (!squreaAreas[key]) {
				continue;
			}
			var squreaArea = squreaAreas[key];
			var squreaAreaInfo = cgetFacilityInfoFromArea(squreaArea);
			var dataKey = nameToDataKey(squreaAreaInfo.name);
			if (0 <= yieldExtend.resource.match.indexOf(squreaAreaInfo.name)) {
				seisan[dataKey] += yieldExtendResource;
			}
			else if (0 <= yieldExtend.facility.match.indexOf(squreaAreaInfo.name)) {
				seisan[dataKey] += Math.ceil(yieldExtendFacility * yieldList[getYieldKeyFromDataKey(dataKey)][squreaAreaInfo.lv]);
			}
		}
	}


	var areas = $a('//area[contains(@alt,"畑") or contains(@alt,"穀") or contains(@alt,"伐") or contains(@alt,"森") or contains(@alt,"石") or contains(@alt,"岩") or contains(@alt,"製") or contains(@alt,"鉱")]');
	for(var i=0; i<areas.length; i++){
		var areaInfo = cgetFacilityInfoFromArea(areas[i]);
		var dataKey = nameToDataKey(areaInfo.name);
		switch(areaInfo.name){
			case '森林':
			case '岩山':
			case '鉄鉱山':
			case '穀物':
				seisan[dataKey] += 10;
				break;
			case '伐採所':
			case '石切り場':
			case '製鉄所':
			case '畑':
				var yieldKey = getYieldKeyFromDataKey(dataKey);
				seisan[dataKey] += yieldList[yieldKey][areaInfo.lv];
				break;
		}
	}

	var text = '<ul>';
	text += '<li><img align="middle" alt="木" src="' + IMG_DIR + 'common/ico_wood2.gif"> 木  ' + seisan.w + '</li>';
	text += '<li><img align="middle" alt="石" src="' + IMG_DIR + 'common/ico_stone2.gif"> 石  ' + seisan.s + '</li>';
	text += '<li><img align="middle" alt="鉄" src="' + IMG_DIR + 'common/ico_iron2.gif"> 鉄  ' + seisan.i + '</li>';
	text += '<li><img align="middle" alt="糧" src="' + IMG_DIR + 'common/ico_lice2.gif"> 糧  ' + seisan.r + '</li>';
	text += '<li>　合計 ' + (seisan.w+seisan.s+seisan.i+seisan.r) +'</li></ul>';
	inner.innerHTML = text;

	function getYieldKeyFromDataKey(dataKey) {
		var ret = 'other';
		if (dataKey == 'r') {
			ret = 'rice';
		}
		return ret;
	}

	function nameToDataKey(name) {
		switch(name){
			case '森林':
			case '伐採所':
				return "w";
			case '岩山':
			case '石切り場':
				return "s";
			case '鉄鉱山':
			case '製鉄所':
				return "i";
			case '穀物':
			case '畑':
				return "r";
		}
	}
}
//////////////////////////////////////////////////////////////////
//↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑↑
//プレゼンツbｙsu-zan関数群
//////////////////////////////////////////////////////////////////

function disp_castleAidLink()
{
	var bases = $a('(id("lodgment")/div[@class="floatInner"] | //div[@class="floatInner clearfix"] | //div[@class="sideBoxInner basename"])//li/*[@title]');
	if( !bases ) return;

	for( var i=0 ; i < bases.length ; i++) {
		var elem = bases[i];
		var thistitle = elem.title;
		if( !thistitle ) continue;
		var xy = thistitle.match(/\((-?\d+),(-?\d+)\)$/);
		if( !xy ) continue;

		var a_k_img = d.createElement("img");
		a_k_img.style.paddingLeft = "3px";
		a_k_img.style.paddingTop = "3px";
		a_k_img.src = img_ken;

		var a_k = d.createElement("a");
		a_k.title = "援軍";
		a_k.appendChild(a_k_img);

		if( elem.href ) {
			a_k.href = caddSessionId("/facility/castle_send_troop.php?x="+xy[1]+"&y="+xy[2]+"&radio_move_type=301");
			a_k.style.visibility = 'visible';
		} else {
			a_k.style.visibility = 'hidden';
		}

		var spn = cgetElementSibling(elem,0);
		if (!spn) {
			spn = d.createElement("span");
			elem.parentNode.appendChild(spn);
		}

		spn.appendChild(a_k);
	}
}

function disp_nextFameTimer() {
	var nextDate = new Date(cloadData("NextFameTime",null,true,true));
	var preCheckTime = new Date(cloadData("NextFamePreCheckTime",null,true,true));
	nextDate = loadNextDate();
	var seps = $a('id("status_left")/span[@class="sep"]');
	for (var i = 0; i < seps.length;i++) {
		seps[i].innerHTML = seps[i].innerHTML.replace(/^([\s|\u3000]*)|([\s|\u3000]*)$/g,"");
	}

	//var img = $x('id("status_left")/img[@title="名声"]');
	var img = $x('//li[@class="fame"]/img[@title="名声"]');

	var fameTimer = document.createElement('DIV');
	fameTimer.setAttribute("id","Beyond_nextFameTimer");
	fameTimer.appendChild(createTimerText(getTimeDiffNow(nextDate)));
	fameTimer.style.color = 'lightgreen';
	fameTimer.style.position = 'absolute';
	fameTimer.style.top = (img.offsetTop + 12) + "px";
	fameTimer.style.left = (img.offsetLeft + 10) + "px";

	img.parentNode.appendChild(fameTimer);

	var timerId = setInterval(function(){
		fameTimer.style.top = (img.offsetTop + 12) + "px";
		fameTimer.style.left = (img.offsetLeft + 10) + "px";
		fameTimer.replaceChild(createTimerText(getTimeDiffNow(loadNextDate())), fameTimer.firstChild);
	},1000);

	function createTimerText(date) {
		return document.createTextNode("("+date.toLocaleTimeString().replace(/^0?/,"")+")");
	}
	function getTimeDiffNow(date) {
		var now = cgetNow();
		var oldDate = now, newDate = date;
		if (date.getTime() < now.getTime()) {
			return new Date(1970,1,1,0,0,0);
		}
		return new Date(1970,1,1,0,0,0,newDate.getTime() - oldDate.getTime());
	}

	var nextFameDateCheckErrorCount = 0;
	var nextFameRefreshCount = 0;
	function loadNextDate() {

		var nowDate = new Date();
		var isNextFameDateOver = false;
		if (nextDate.getTime() < nowDate.getTime()) {
			isNextFameDateOver = true;
		}

		var isPreCheckDateOver = false;
		if (preCheckTime.getTime() < (nowDate.getTime() - 1800000)) {
			isPreCheckDateOver = true;
		}

		if (5 < nextFameDateCheckErrorCount) {
			if (isNextFameDateOver) {
				clearInterval(timerId);
			}
			return nextDate;
		}

		if ((isPreCheckDateOver || isNextFameDateOver) && nextFameRefreshCount === 0) {
			nextFameTimeRefresher();
		}

		return nextDate;

		function nextFameTimeRefresher() {
			cajaxRequest("/facility/castle.php" , "GET", "", function(req) {
				var dom = d.createElement("html");
				dom.innerHTML = req.responseText;
				var nextFameNode = $x('.//div[@id="gray02Wrapper"]/table[contains(concat(" ",normalize-space(@class)," ")," commonTables ") and @summary="object"]//td[contains(concat(" ",normalize-space(@class)," ")," center ") and not(@colspan)]/div[not(@class)]',dom);
				if (!nextFameNode) {
					nextFameDateCheckErrorCount++;
					return;
				}

				var matches = null;
				if (!(matches = nextFameNode.innerHTML.match(/\d+-\d+-\d+\s\d+:\d+/))) {
					nextFameDateCheckErrorCount++;
					return;
				}

				var tmpDate = new Date(matches[0].replace(/-/g,"/")+":00");
				if (isPreCheckDateOver == false && nextDate.getTime() == tmpDate.getTime()) {
					if (12 <= nextFameRefreshCount) {
						clearInterval(timerId);
					}
					else {
						nextFameRefreshCount++;
						setTimeout(nextFameRefresher,5000);
					}
					return;
				}
				else if (!(nextDate.getTime() == tmpDate.getTime())) {
					nextDate = tmpDate;
					if (cloadData("NextFameTime",null,true,true)) {
						//var fameText = $x('id("status_left")//img[@title="名声"]').nextSibling;
						var fameText = $x('//li[@class="fame"]/img[@title="名声"]').nextSibling;

						matches = fameText.nodeValue.match(/(\d+)[^\d]*(\d+)/);
						fameText.nodeValue = fameText.nodeValue.replace(/\d+[^\d]*\d+/,(parseInt(matches[1],10)+1) + " / " + (parseInt(matches[2],10)+1));
					}

					csaveData("NextFameTime",nextDate.toString(),true,true);
				}

				nextFameRefreshCount = 0;
				preCheckTime = new Date();
				csaveData("NextFamePreCheckTime",preCheckTime.toString(),true,true);
			},
			function() {
				nextFameDateCheckErrorCount++;
			});
		}
	}
}

function disp_villageListBox() {
	if (0 <= location.pathname.search(/^\/(village|map|land)\.php/)) {
		return;
	}

	var isOpen = cloadData('sidebox_oc0', false,true) ? false : true;
	var sidBoxId = 'beyond_sidebox_villageListBox';
	var conf = cloadData( sidBoxId+'conf' , "null", true, true );

	if (!OPT_SMALLBTN) {
		isOpen = (conf == null) ? true : conf.open;
	}

	if (conf != null && typeof conf == 'object') {
		conf.open = isOpen;
		csaveData(sidBoxId+'conf',conf,true,true);
	}

	var box = ccreateSideBox(sidBoxId,IMG_DIR+'common/sidebar/icon_base.gif',"拠点");
	box.sideBoxInner.className += " basename";
	var ul = d.createElement("ul");
	box.sideBoxInner.appendChild(ul);

	var boxImage = $x('.//img[contains(@src,"icon_base")]', box.sideBoxHead);
	$e(boxImage,'click',function(){
		var saveData = isOpen ? "1" : "";
		isOpen = !isOpen;
		csaveData('sidebox_oc0', saveData,true);
	});

	var cvid = cgetCurrentVillageId();
	for (var key in VILLAGES_INFO) {
		var village = VILLAGES_INFO[key];
		var li = d.createElement("li");
		li.style.paddingBottom = "0px";
		ul.appendChild(li);

		var item;
		if (village.vid == cvid) {
			li.className = "on";
			item = d.createElement("span");

		}
		else {
			item = d.createElement("a");
			item.href = caddSessionId('/village_change.php?village_id='+village.vid+'&from=menu&page=' + encodeURIComponent(location.pathname + location.search));
		}

		li.appendChild(item);
		item.title = village.basename + " ("+village.x+","+village.y+")";
		item.appendChild(d.createTextNode(village.basename));
	}
}

// 初期化拡張
function initVillages() {
// ---- mixi鯖 51×51 に対応 ----
	if (0 <= location.pathname.search(/^\/(village|land)\.php/))
		{_villageInit(); return; }

	else if (location.pathname == "/user/" && $("statMenu")) {
		_profileInit();
		return;
	}

	VILLAGES_INFO = cloadData("villagesInfo","{}",true,true);

	function _villageInit() {
		var villages = $a('(id("lodgment")/div[@class="floatInner"] | //div[@class="sideBoxInner basename"])//li/*[@title]');
		var compList = new Object();

		var reg = new RegExp(/^([^ ]+) \((-?\d+),(-?\d+)\)$/);
		var matches = null;
		var noVids = new Array();
		for (var i=0;i < villages.length;i++) {
			var village = villages[i];//console.log(i+":"+village);
			var addObj = new Object();
			if ((matches = village.title.match(reg))) {
				addObj.basename = matches[1];
				addObj.x = parseInt(matches[2],10);
				addObj.y = parseInt(matches[3],10);
			}
			if (typeof village.href == 'string' && (matches = village.href.match(/village_id=(\d+)/))) {
				addObj.vid = parseInt(matches[1],10);

			}
			else {
				var viDoc = $x('//input[@name="village_id"]');
				if (viDoc) {
					addObj.vid = parseInt(viDoc.value,10);
				}
				else {
					if(addObj.x){
						noVids.push(addObj);
					}
				}
			}
			if(addObj.x){
				compList[(addObj.x+"_"+addObj.y).replace(/-/g,"m")] = addObj;
			}
		}
		_compData(compList);


		if (0 < noVids.length) {
			cajaxRequest("/user/" , "GET", "", function(req) {
				var dom = d.createElement("html");
				dom.innerHTML = req.responseText;
				for (var i = 0;i < noVids.length;i++) {
					var td = $x('.//td[text()="'+noVids[i].x+","+noVids[i].y+'"]',dom);
					var linkTd = cgetElementSibling(td,1);
					var link = $x('.//a',linkTd);
					if ((matches = link.href.match(/village_id=(\d+)/))) {
						VILLAGES_INFO[(noVids[i].x+"_"+noVids[i].y).replace(/-/g,"m")].vid = parseInt(matches[1],10);
					}
				}
				csaveData("villagesInfo",VILLAGES_INFO,true,true);
			});
		}
	}

	function _profileInit() {
		var compList = new Object();
		var matches = null;
		var villageLinks = $a('//table[contains(concat(" ", normalize-space(@class), " "), " commonTables ")]//th[contains(text(), "座標")]/../following-sibling::tr[position() <= 10]/td[position()=3 and 1 <= normalize-space(text())]/..//a');
		for (var i = 0;i < villageLinks.length;i++) {
			var villageLink = villageLinks[i];

			var addObj = new Object();
			var loc = cgetElementSibling(villageLink.parentNode,0);
			if ((matches = loc.innerHTML.match(/(-?\d+),(-?\d+)/))) {
				addObj.x = parseInt(matches[1],10);
				addObj.y = parseInt(matches[2],10);
			}

			if ((matches = villageLink.href.match(/village_id=(\d+)/))) {
				addObj.vid = parseInt(matches[1],10);
			}
			addObj.basename = villageLink.innerHTML.replace(/^\s*|\s*$/g,"");
			compList[(addObj.x+"_"+addObj.y).replace(/-/g,"m")] = addObj;
		}

		_compData(compList);
	}

	function _compData(compList) {
		var nowVillageList = cloadData("villagesInfo","{}",true,true);
		for (var key in compList) {
			VILLAGES_INFO[key] = compList[key];
			if (typeof nowVillageList[key] == 'object') {
				VILLAGES_INFO[key] = nowVillageList[key];
				if (typeof VILLAGES_INFO[key].vid != 'number' && typeof compList[key].vid == 'number') {
					VILLAGES_INFO[key].vid = compList[key].vid;
				}
				VILLAGES_INFO[key].basename = compList[key].basename;
			}
		}

		csaveData("villagesInfo",VILLAGES_INFO,true,true);
	}
}

function initCastleSend() {
	if( location.pathname != '/facility/castle_send_troop.php' || location.search.indexOf("radio_move_type") < 0) return;

	var radioMoveType = location.search.match(/radio_move_type=(\d+)/)[1];
	var ary = $a('//input[@name="radio_move_type"]');
	var elem;
	for (var i = 0; i < ary.length;i++) {
		elem = ary[i];
		if (elem.value == radioMoveType) {
			elem.checked = "checked";
		}
		else {
			elem.checked = "";
		}
	}
}

function initNarrow() {

	if (0 <= location.pathname.search(/^\/(village|map|land)\.php/)) {
		//$x('id("lodgment")/div[@class="floatHead"]//a').href = 'javascript:void(0);';
		$x('//div[@class="sideBoxInner basename"]/ul/li[@class="on"]/a[1]').href = 'javascript:void(0);';
	}
	GM_addStyle(".footer_box { height:auto !important;}");
}

function initPreLoadNode() {
	PRE_LOAD_NODES['nowResources'] = {wood:$('wood'),stone:$('stone'),iron:$('iron'),rice:$('rice')};
	PRE_LOAD_NODES['serverTime'] = $('server_time_disp');
}

function initUrlParams() {
	var matches = location.search.match(/(?:\?|&)?([^=]+)(?:=([^&]+))?/g);

	if (matches) {
		var param;
		var key;
		var data;
		for(var i = 0 ; i < matches.length ; i++) {
			param = matches[i].match(/(?:\?|&)?([^=]+)(?:=([^&]+))?/);
			key = param[1];
			data = param[2];
			URL_PARAM[key] = '';
			if( param.length == 3 && typeof data == 'string') {
				URL_PARAM[key] = decodeURIComponent(data);

				// session id
				if (key.toLowerCase() == 'ssid') {
					SID = key + '=' +data;
				}
			}
		}
	}
}

// 同盟レベルの表示を改善 START *********************************************************************************
if( location.pathname == "/alliance/level.php" ) {
	cl=document.getElementsByClassName('contents');
	np=parseInt(cl[4].innerHTML)-parseInt(cl[2].innerHTML);
	once = Math.round(np/parseInt(cl[1].innerHTML));
	function kugiri(np,once) {
		var num = new String(np,once).replace(/,/g, "");
		while(num != (num = num.replace(/^(-?\d+)(\d{3})/, "$1.$2")));
		return num;
	}
	cl[1].innerHTML+=' <span style="color:red; white-space:nowrap;">(空き枠:'+(parseInt(cl[3].innerHTML)-parseInt(cl[1].innerHTML))+')</span>';
	cl[2].innerHTML+=' <br><span style=" font-size:12px; color:red; white-space:nowrap;">(次まで:'+(kugiri(np))+'／1人あたり:'+(kugiri(once))+')</span>';
	cl[3].innerHTML+=' <span style="color:red; white-space:nowrap;">(次で+'+(parseInt(cl[5].innerHTML)-parseInt(cl[3].innerHTML))+')</span>';
}else if( location.pathname == "/alliance/info.php" ) {
	cl=document.getElementsByClassName('contents');
	np1 = parseInt(cl[8].innerHTML.match(/[^\/]+$/));
	np2 = parseInt(cl[8].innerHTML.match(/^[^\/]+/));
	nl1 = parseInt(cl[7].innerHTML.match(/[^\/]+$/));
	nl2 = parseInt(cl[7].innerHTML.match(/^[^\/]+/));
	nd	= parseInt(cl[9].innerHTML);

	cl[7].innerHTML+=	'<span style="color:black;"> (空き:</span>'+
				'<span style="color:red;">'+(nl1-nl2)+'</span>'+
				'<span style="color:black;">)</span>'

	cl[8].innerHTML+=	'<br /><span style="color:black;">次まで:</span>' +
				'<span style="color:red;">'+(np1-np2)+'</span><br />' +
				'<span style="color:black;">1人あたり:</span>' +
				'<span style="color:red;">'+(parseInt((np1-np2)/nl2))+'</span>';

	cl[9].innerHTML+=	'<span style="color:black;"> (</span>'+
				'<span style="color:red;">+'+(nd-nl1)+'</span>'+
				'<span style="color:black;">)</span>';

	cl[9].innerHTML+=	'<br /><span style="color:black;"> 次LV空き枠合計:</span></td>'+
				'<span style="color:red;">'+(nd-nl1+nl1-nl2)+'</span>';
}

// 同盟レベルの表示を改善 END ************************************************************************************************************

// カードのレアリティを見た目だけ変更するアホツール
// ブラ三
function disp_LChange() {
	var css = "\
		div.card {\
			background: transparent url(/20141210-01/extend_project/w945/img/card/common_4sk/bg_card_l.gif) no-repeat scroll left top !important;\
		}\
		span.soltype {\
			overflow: hidden;\
			width: 21px;\
		}\
		span.soltype img[title='歩兵'] {\
			background-image: url(/20141210-01/extend_project/w945/img/card/type_4sk/type_501.png) no-repeat !important;\
		}\
		span.soltype img[title='槍兵'] {\
			background-image: url(/20141210-01/extend_project/w945/img/card/type_4sk/type_502.png) no-repeat !important;\
		}\
		span.soltype img[title='騎兵'] {\
			background-image: url(/20141210-01/extend_project/w945/img/card/type_4sk/type_503.png) no-repeat !important;\
		}\
		span.soltype img[title='弓兵'] {\
			background-image: url(/20141210-01/extend_project/w945/img/card/type_4sk/type_504.png) no-repeat !important;\
		}";
	disp_BGChange(css);

	jQuery.noConflict();
	j$ = jQuery;
	j$("div[class=cardColmn] div[class*=_effect]").attr("class", "rarerity_l_effect");
}

function disp_URChange() {
	var css = "\
		div.card {\
			background: transparent url(/20120802-01/extend_project/w760/img/card/common/bg_card_ur.png) no-repeat scroll left top !important;\
		}\
		span.soltype {\
			overflow: hidden;\
			width: 21px;\
		}\
		span.soltype img[title='歩兵'] {\
			background-image: url(/20120802-01/extend_project/w760/img/card/type/type_501_ur.gif) no-repeat !important;\
		}\
		span.soltype img[title='槍兵'] {\
			background-image: url(/20120802-01/extend_project/w760/img/card/type/type_502_ur.gif) no-repeat !important;\
		}\
		span.soltype img[title='騎兵'] {\
			background-image: url(/20120802-01/extend_project/w760/img/card/type/type_503_ur.gif) no-repeat !important;\
		}\
		span.soltype img[title='弓兵'] {\
			background-image: url(/20120802-01/extend_project/w760/img/card/type/type_504_ur.gif) no-repeat !important;\
		}";
	disp_BGChange(css);
}
function disp_SRChange() {
	var css = "\
		div.card {\
			background: transparent url(/20120802-01/extend_project/w760/img/card/common/bg_card_sr.png) no-repeat scroll left top !important;\
		}\
		span.soltype {\
			overflow: hidden;\
			width: 21px;\
		}\
		span.soltype img[title='歩兵'] {\
			background-image: url(/20120802-01/extend_project/w760/img/card/type/type_501_sr.gif) no-repeat !important;\
		}\
		span.soltype img[title='槍兵'] {\
			background-image: url(/20120802-01/extend_project/w760/img/card/type/type_502_sr.gif) no-repeat !important;\
		}\
		span.soltype img[title='騎兵'] {\
			background-image: url(/20120802-01/extend_project/w760/img/card/type/type_503_sr.gif) no-repeat !important;\
		}\
		span.soltype img[title='弓兵'] {\
			background-image: url(/20120802-01/extend_project/w760/img/card/type/type_504_sr.gif) no-repeat !important;\
		}";
	disp_BGChange(css);
}

// MCAXIS
// PR,HR,UR,SR
function disp_PRChange() { var css = "div.card {\n	background: transparent url(http://mg-cdn.bmcaxis.jp/20121220-01/extend_project/mcaxis/img/card/common/bg_card_pr.png) no-repeat scroll left top !important;\n  }";disp_BGChange(css);}
function disp_HRChange() { var css = "div.card {\n	background: transparent url(http://mg-cdn.bmcaxis.jp/20121220-01/extend_project/mcaxis/img/card/common/bg_card_hr.png) no-repeat scroll left top !important;\n  }";disp_BGChange(css);}
function disp_ARChange() { var css = "div.card {\n	background: transparent url(http://mg-cdn.bmcaxis.jp/20121220-01/extend_project/mcaxis/img/card/common/bg_card_ur.png) no-repeat scroll left top !important;\n  }";disp_BGChange(css);}
function disp_BRChange() { var css = "div.card {\n	background: transparent url(http://mg-cdn.bmcaxis.jp/20121220-01/extend_project/mcaxis/img/card/common/bg_card_sr.png) no-repeat scroll left top !important;\n  }";disp_BGChange(css);}

function disp_BGChange(css){
	if (typeof GM_addStyle != "undefined") {
		GM_addStyle(css);
	} else if (typeof PRO_addStyle != "undefined") {
		PRO_addStyle(css);
	} else if (typeof addStyle != "undefined") {
		addStyle(css);
	} else {
		var heads = document.getElementsByTagName("head");
		if (heads.length > 0) {
			var node = document.createElement("style");
			node.type = "text/css";
			node.appendChild(document.createTextNode(css));
			heads[0].appendChild(node);
		}
	}
}
 // レアリティを見た目だけ変更するアホツール END

//////////////////////
//スタイル変更
//////////////////////

//必ず実行する。
function cut_main(){
	if(location.pathname != "/run_appli.pl"){
		return;
	}
	GM_addStyle(
		".appliMainbox01,.gadgetStage, .gadgetStage iframe {width:980px !important;}" +
		".appliSidebox01 {display:none !important;}" +
		".mixiPointDisplay {display:none !important;}" +
		".serviceNavigation {display:none !important;}" +
		".headerLogo {display:none !important;}" +
		".adBanner {display:none !important;}" +
		".globalNavigation {display:none !important;}" +
		".displayMain {display:none !important;}" +
		"#bodyArea {width:auto !important; position:absolute !important;}"
	);
}

//必ず実行する。
function cut_main1(){
	if(location.pathname == "/world/select_server_mixi_new.php"){
		return;
	}
	GM_addStyle(
		"#server_wrapper, #canvas_view #container {width:auto !important;}" +
		".serverNews, #serverLatest, #serverList, .serverBrowser {margin:0 auto 10px !important;}" +
		".serverItem1 {margin:5px !important;}" +
		"#serverLatest {width:280px !important;}" +
		".serverItemSpace {display:none !important;}" +
		"#gadget-friend-selector{display:none !important;}" +
		"#adsHeader {display:none !important;}" +
		"#mapbox div.alliance-base-box-top{left: 260px ! important; top:0px ! important;}" +//同盟拠点
		"div#action{left: 415px ! important; top:10px ! important;}" +
		"#mixi_ad_head, #mixi_ad_groups {display:none !important;}"
	);
}
//スタイル変更時に実行
function cut_main2(){
	GM_addStyle(
		"#ADDSPACE, .appliSidebox01 {display:none !important;}" +
//黒い枠を左よせ
		"#container {width:auto !important;padding: 15px 0px 10px !important;}" +
		"#container #header, #container #tabArea, #container #box {width:auto !important;}" +
		"#header_bottom {background:none !important; height:5px !important;}" +
		"#supportNavi {position:absolute; top:8px; left:680px;}" +
		"#adsHeader {visibility: hidden;}" +
		"#btn_area {position:absolute; top:170px; left:758px; width:auto !important; height: auto !important;}" +
		"#btn_area_box {width:180px !important; height: auto !important; padding:0 !important;}" +
		"#btn_area_box a {display:block !important; height:25px; margin-bottom:3px !important;}" +
		"#worldtime {position:absolute; top:75px; left:775px; width:100px !important; height:auto !important; margin:auto !important;}" +
		"#worldtime dl {width:140px !important; height:40px !important;}" +
		"#worldtime * {float:none !important; height:auto !important; margin:auto !important; padding:3px !important; background-image:none !important; background-color:#000;}" +
		"#worldtime dd {border:1px #fd0 solid;}" +
		"#server_time_disp { padding:0 !important;}" +
		"#bptpcp_area {position:absolute; top:137px; left:770px; background:none !important;}" +
		"#statusIcon {top:22px !important; left:710px !important; white-space:nowrap !important;}" +
		"#lodgment {top:183px !important; left:774px !important; background-image:none !important;}" +
		"#lodgment * {background-image:none !important; background-color:#333 !important;}" +
		"#lodgment ul li {padding:2px 0 !important;}" +
		"#lodgment .on {background:#000 !important; padding-left:3px !important; width:120px !important;}" +
		"#lodgment .on span {background:#000 !important;}" +
		".footer_box {float:none !important;position:absolute; top:642px; left:764px; }" +	//ac.42.a
		"#whiteWrapper {min-height:550px;}" +
		".message_textarea_width {min-height:320px;}" +
		"#social {display:none !important;}"
	);

	GM_addStyle("#comment {margin-left:-20px !important;}");	//一言掲示板表示位置を左に。
	GM_addStyle("#navi01{margin-top:-5px !important;}");		//プロフィール、ヘルプ、ワールド、時刻の位置を上に。
	GM_addStyle(".navi01_03 {margin-left:-10px !important;}");	//「プロフィール表示位置」を左に。
	GM_addStyle(".world {margin-left:-10px !important;margin-top:-5px !important;}");		//「ワールド表示位置」を左に、上に。

	if (OPT_SMALLBTN == 1) {
		//小さいボタンON時に拠点と簡易出兵先を移動
		GM_addStyle(
			"#lodgment {top:40px !important; left:774px !important; background-image:none !important;}" +
			".footer_box {float:none !important;position:absolute; top:522px; left:760px; }"
		);
	}

	if(DISP_RANK == 1){
		GM_addStyle("#social {display:none !important;}");
	}

	GM_addStyle(".world {margin-top: 5px !important;}");
}

// common関数拡張
function cinsertSideBox(insPos,insNode) {
	var sideboxes = $a(".//div[@id=\"beyond_fixpanel\"]/div[@class=\"sideBox\"]");
	var srt = new Array();
	var pos = 0;
	var insNodeId = insNode.sideBox.id;
	for(var i=0 ; i<sideboxes.length ; i++) {
		var conf = cloadData( sideboxes[i].id + "conf" , '{"float":false, "open":true, "x":"", "y":"", "pos":99 }', true, true );
		pos = conf.pos;
		if (insPos <= conf.pos && insNodeId != sideboxes[i].id) {
			pos++;
		}
		else if (insNodeId == sideboxes[i].id) {
			pos = insPos;
		}
		srt.push({"node":sideboxes[i], "pos":pos});
	}

	srt.sort( function(a,b) {return a.pos - b.pos;});

	for(var i=0 ; i<srt.length ; i++){
		srt[i].node.parentNode.removeChild(srt[i].node);
	}
	var fixpanel = $("beyond_fixpanel");
	for(var i=0 ; i<srt.length ; i++){
		fixpanel.appendChild(srt[i].node);
	}
}

function cgetCurrentVillageId() {
	var xy = cgetCurrentBaseXY();
	return VILLAGES_INFO[(xy.x+"_"+xy.y).replace(/-/g,"m")].vid;
}

function chasVillageId(vid) {
	vid = parseInt(vid,10);
	var vids = cgetVillageIds();
	return vids[vid] ? true : false;
}

function cgetVillageIds() {
	var ret = new Object();
	for (var key in VILLAGES_INFO) {
		if (isNaN(""+VILLAGES_INFO[key].vid)) {
			continue;
		}
		ret[VILLAGES_INFO[key].vid] = VILLAGES_INFO[key].vid;
	}
	return ret;
}

function cgetElementSibling(element,direction,skipCount) {
	var hasElementSibling = (typeof element.nextElementSibling == 'object' || typeof element.previousElementSibling == 'object') ? true : false;
	if (!skipCount) skipCount = 1;
	for (var i = 0;i < skipCount;) {
		if (hasElementSibling) {
			i++;
			if (direction == 1) {
				element = element.previousElementSibling;
			}
			else {
				element = element.nextElementSibling;
			}
		}
		else {
			if (direction == 1) {
				element = element.previousSibling;
			}
			else {
				element = element.nextSibling;
			}
			if (element.nodeType == 1) {
				i++;
			}
		}

		if (element == null) {
			break;
		}
	}
	return element;
}

// areaから四方のareaを取得
function cgetSquareElementFromArea(area) {
	var coords = area.getAttribute('coords');
	var matches = null;
	if (!coords || !(matches = coords.match(/^(\d+),(\d+)/))) return false;
	var base = new Object();
	base.x = parseInt(matches[1],10);
	base.y = parseInt(matches[2],10);

	var $x = function(xp,dc) { return d.evaluate(xp, dc||d, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };

	var add = new Object();
	add.x = 50;
	add.y = 25;

	var isMap = false;

	if (0 <= location.pathname.indexOf("map.php")) {
		isMap = true;
		//地図51×51対応
		var size = parseInt($x('id("change-map-scale")//li[contains(concat(" ",normalize-space(@class)," ")," now ")]').className.match(/sort(\d+) /)[1],10);
		switch (size) {
		case 20:
			add.x = 16;
			add.y = 8;
			break;
		case 15:
			add.x = 22;
			add.y = 11;
			break;
		default:
			add.x = 30;
			add.y = 15;
			break;
		}

		base.y += add.y * 2;
	}

	var xpaths = {ne:calc(base,add,0),nw:calc(base,add,1),se:calc(base,add,2),sw:calc(base,add,3)};

	var ret = new Object();
	for (var key in xpaths) {
		ret[key] = $x('//area[@coords="' + xpaths[key] + '"]');
	}
	return ret;

	// direction ne:0 nw:1 se:2 sw:3
	function calc(base,add,direction) {
		var addX = (direction % 2) == 0 ? add.x : - add.x;
		var addY = direction < 2 ? - add.y : add.y;

		var retBaseX = base.x + addX;
		var retBaseY = base.y + addY;

		var top = [retBaseX, retBaseY - (add.y * 2)];
		var left = [retBaseX - add.x, retBaseY - add.y];
		var bottom = [retBaseX, retBaseY];
		var right = [retBaseX + add.x, retBaseY - add.y];
		var ret = isMap ? top.concat(left,bottom,right) : bottom.concat(left,top,right);
		return ret.join(",");
	}
}

// areaからx,y,name,lvを返す
function cgetFacilityInfoFromArea(area) {
	var retObj = {name:"",lv:0,x:-1,y:-1};
	var matches = null;
	if (area.alt) {
		if ((matches = area.alt.match(/^([^ ]+)[^\d]+(\d+)/))) {
			retObj.name = matches[1];
			retObj.lv = parseInt(matches[2],10);
		}
		else {
			retObj.name = area.alt;
		}
	}

	if (area.href && (matches = area.href.match(/(?:x=(\d+)&y=(\d+))/))) {
		retObj.x = parseInt(matches[1],10);
		retObj.y = parseInt(matches[2],10);
	}

	return retObj;
}

function caddSessionId(url) {
	if (0 < SID.length && url.search(/(\?|&)SSID=[^&]+&?/i) < 0) {
		var anchor = '';
		var matches;
		if ((matches = url.match(/#[^#]+$/))) {
			url = url.substring(0,url.lastIndexOf('#'));
			anchor = matches[0];
		}
		url += 0 <= url.indexOf('?') ? '&' : '?';
		url += SID;
		url += anchor;
	}
	return url;
}
}) ();
//faraway beyond本体終了 ========================================================================
// html to new document
// Autopagerize(http://userscripts.org/scripts/review/8551)
// by どらごら
function createNewDocument(req) {

	return createHTMLDocumentByString(req);

	function createHTMLDocumentByString(str) {
	if (document.documentElement.nodeName != 'HTML') {
		return new DOMParser().parseFromString(str, 'application/xhtml+xml')
	}
	var html = strip_html_tag(str)
	var htmlDoc
	try {
		// We have to handle exceptions since Opera 9.6 throws
		// a NOT_SUPPORTED_ERR exception for |document.cloneNode(false)|
		// against the DOM 3 Core spec.
		htmlDoc = document.cloneNode(false)
		htmlDoc.appendChild(htmlDoc.importNode(document.documentElement, false))
	}
	catch(e) {
		htmlDoc = document.implementation.createDocument(null, 'html', null)
	}
	var fragment = createDocumentFragmentByString(html)
	try {
		fragment = htmlDoc.adoptNode(fragment)
	}
	catch(e) {
		fragment = htmlDoc.importNode(fragment, true)
	}
	htmlDoc.documentElement.appendChild(fragment)
	return htmlDoc
	}
	function strip_html_tag(str) {
	var chunks = str.split(/(<html(?:[ \t\r\n][^>]*)?>)/)
	if (chunks.length >= 3) {
		chunks.splice(0, 2)
	}
	str = chunks.join('')
	chunks = str.split(/(<\/html[ \t\r\n]*>)/)
	if (chunks.length >= 3) {
		chunks.splice(chunks.length - 2)
	}
	return chunks.join('')
	}
	function createDocumentFragmentByString(str) {
	var range = document.createRange()
	range.setStartAfter(document.body)
	return range.createContextualFragment(str)
	}
}

// ajaxラッパー by どらごら
function cajaxRequest_1(url, method, param, func_success, func_fail){
	var req = new XMLHttpRequest();
	req.onreadystatechange = function() {
		if (req.readyState == 4 && req.status == 200){
			func_success(req);
		}
		else if (req.readyState == 4 && req.status != 200){
			func_fail(req);
		}
	}

	req.open(method, url, true);
	if (method == 'POST'){
		req.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
	}
	req.send(param);
}

// jQuery append by どらごら
//
function jQueryAppend() {

	jQuery.noConflict();
	j$ = jQuery;

  j$(document.body).append(
		"<div id='route_contextmenu'>" +
			"<ul id='route_command' style='text-align:left'></ul>" +
		"</div>");
	j$("#route_contextmenu")
		.hide()
		.css({
			position: "absolute",
			backgroundColor: "white",
			border: "outset 2px gray",
			color: "black",
			padding: "3px",
			zIndex: 999
		});


}

// スクリプトタグを追加 by どらごら
function addRouteScriptHtml() {

	if(ROUTE_ENABLE == false) return;

	var funcHTML = onMapMouseOver+onMapMouseOut+onMapClick+menuMapChk+createArgClass+
									onMapContextMenu+menuMapChk+menuChkDel;
	var scriptElem = document.createElement("script");
	scriptElem.type = "text/javascript";
	scriptElem.innerHTML = funcHTML;
	document.getElementsByTagName("head")[0].appendChild(scriptElem);
}

function createArgClass(x, y, pw, center_flg, bg_color) {
	this.x = x;
	this.y = y;
	this.pw = pw;
	this.center_flg = center_flg;
	this.bg_color = bg_color;
}

// マウス移動 by どらごら
function onMapMouseOver(e, x,y,p,c,b) {
	j$("#route_td_" + x + "_" + y).css("border", "solid 2px lime");
}

// マウス外れ by どらごら
function onMapMouseOut(e, x,y,p,c,b) {
	//中心マスに目印
	var borderColor = "white";
	var borderPic = "0px";
	var bold = "solid";
	if (c) {
		borderColor = "black";
		borderPic = "2px";
	}
	j$("#route_td_" + x + "_" + y).css("border", bold+" "+borderPic+" "+borderColor);

}

// マップ左クリック by どらごら
function onMapClick(e, x,y,p,c,b) {
	if(document.getElementById("route_chk_enable").checked == true) {
		menuMapChk(e, x,y,p,c,b);
	} else {
		location.href = "/map.php?x=" + x + "&y=" + y;
	}
}

// マップ右クリック by どらごら
function onMapContextMenu(e, x,y,p,c,b) {

	// メニュー追加
	j$("#route_command")
		.text("")
		.append("<li id='chkLink' class='route_item' style='padding:0px 10px'>チェック</li>")
		.append("<li id='delLink' class='route_item' style='padding:0px 10px'>取り消し</li>")
		.append("<li id='moveLink' class='route_item' style='padding:0px 10px'>画面遷移</li>")
		.append("<li id='detailLink' class='route_item' style='padding:0px 10px'>詳細</li>")
		.append("<li id='sortieLink' class='route_item' style='padding:0px 10px'>出撃</li>");

	j$(".route_item")
		.mouseover(function() {
			j$(this).css("backgroundColor", "grey")
		})
		.mouseout(function() {
			j$(this).css("backgroundColor", "white")
		});

	j$("#chkLink")
		.addClass("subMenuItem")
		.unbind("click")
		.one("click",
			function (x,y,p,c,b) {
				return function () {
					menuMapChk(e, x,y,p,c,b);
				};
			}(x,y,p,c,b));

	j$("#delLink")
		.addClass("subMenuItem")
		.unbind("click")
		.one("click",
			function (x,y,p,c,b) {
				return function () {
					menuChkDel(e, x,y,p,c,b);
				};
			}(x,y,p,c,b));

	j$("#moveLink")
		.addClass("subMenuItem")
		.unbind("click")
		.one("click",
			function (x,y,p,c,b) {
				return function () {
					location.href = "map.php?x=" + x + "&y=" + y;
				};
			}(x,y,p,c,b));

	j$("#detailLink")
		.addClass("subMenuItem")
		.unbind("click")
		.one("click",
			function (x,y,p,c,b) {
				return function () {
					location.href = "land.php?x=" + x + "&y=" + y;
				};
			}(x,y,p,c,b));


	j$("#sortieLink")
		.addClass("subMenuItem")
		.unbind("click")
		.one("click",
			function (x,y,p,c,b) {
				return function () {
					location.href = "facility/castle_send_troop.php?x=" + x + "&y=" + y + "#ptop";
				};
			}(x,y,p,c,b));



	// メニュー表示
	j$("#route_contextmenu")
		.css({
			left: e.pageX + "px",
			top: e.pageY + "px"
		})
		.show();

	j$(document)
		.unbind("click")
		.one("click",
			function () {
				j$("#route_contextmenu").hide();
			});

	// デフォルトのメニューは非表示
	e.preventDefault();
}

// ルートの検証 by どらごら
function onValidation() {

	var txtbox = document.getElementById("route_output");
	var line = txtbox.value.split("\n");
	var x = null;
	var y = null;
	var lineNum;

	for(var i=0;i<line.length;i++) {

		regObj = new RegExp(/[^-^\d]*([^,]*),([^\)]*)\)[\s\u3000\u2605\u2606\d]*(.*)/);
		if (line[i].match(regObj)) {

			var tdElem = document.getElementById("route_td_" + RegExp.$1 + "_" + RegExp.$2);
			if (tdElem == null) {
				continue;
			}

			if ((x == null) && (y == null)) {
				x = RegExp.$1;
				y = RegExp.$2;
				lineNum = i;
				continue;
			}

			if ((Math.abs(x - RegExp.$1) > 1 ) || (Math.abs(y - RegExp.$2) > 1 )) {
				// not chain
				var msg = (lineNum + 1) + "行目の(" + x + "," + y + ")と\n" +
						  (i + 1) + "行目の(" + RegExp.$1 + "," + RegExp.$2 + ")が離れています";
				alert(msg);
			}
			x = RegExp.$1;
			y = RegExp.$2;
			lineNum = i;
		}

	}

	alert("チェック終了！");
}

// マップをチェック by どらごら
function menuMapChk(e, x,y,p,c,b) {
	j$("#route_output").val(j$("#route_output").val() + "(" + x + "," + y + ") ★" + p.length + " \n");
	j$("#route_td_" + x + "_" + y).css("backgroundColor", "#FF00FF");
}

// チェックを削除 by どらごら
function menuChkDel(e, x,y,p,c,b) {

	var txtbox = document.getElementById("route_output");
	var line = txtbox.value.split("\n");
	var newText = "";

	for(var i=0;i<line.length;i++) {

		regObj = new RegExp(/[^-^\d]*([^,]*),([^\)]*)\)[\s\u3000\u2605\u2606\d]*(.*)/);
		if (line[i].match(regObj)) {

			if((x == RegExp.$1) && (y == RegExp.$2)) {

				var tdElem = document.getElementById("route_td_" + RegExp.$1 + "_" + RegExp.$2);
				if(tdElem != null) {
					tdElem.style.backgroundColor = b;
				}

			} else {
				newText += line[i] + "\n";
			}

		} else {
			// 一致しなくても、行は有効
			newText += line[i] + "\n";
		}

	}
	txtbox.value = newText;

}

// マップに反映 by どらごら
function onReWrite() {
	var txtbox = document.getElementById("route_output");
	var line = txtbox.value.split("\n");

	for(var i=0;i<line.length;i++) {

		regObj = new RegExp(/[^-^\d]*([^,]*),([^\)]*)\)[\s\u3000\u2605\u2606\d]*(.*)/);
		if (line[i].match(regObj)) {

			var tdElem = document.getElementById("route_td_" + RegExp.$1 + "_" + RegExp.$2);
			if(tdElem == null) {
				continue;
			}

			if(RegExp.$3.trim() == "") {
				tdElem.style.backgroundColor = "#FF00FF";
			} else {
				tdElem.style.backgroundColor = "#00FF00";
			}
		}

	}
}

// 出兵画面に簡易出兵先情報表示準備 by どらごら
function sendTroop() {

	//自拠点座標取得
	var xy = getMyXY_1();
	if (xy == "") {
		MY_X = 0;
		MY_Y = 0;
	} else {
		MY_X = parseInt(xy.split(",")[0]);
		MY_Y = parseInt(xy.split(",")[1]);
	}

	j$("input[name=village_x_value]").attr("id", "village_x_value");
	j$("input[name=village_y_value]").attr("id", "village_y_value");
	document.getElementById("village_x_value").addEventListener("change",
		function() {
			sendTroopInfo();
		},
		true);
	document.getElementById("village_y_value").addEventListener("change",
		function() {
			sendTroopInfo();
		},
		true);

	j$(".notice:eq(3)").append(
		"<div id='sendTroopInfo'>" +
			"<table id='sendTroopInfoTable' class='commonTables'>" +
			"<tr>" +
				"<th class='mainTtl'>森</th>" +
				"<th class='mainTtl'>岩</th>" +
				"<th class='mainTtl'>鉄</th>" +
				"<th class='mainTtl'>糧</th>" +
				"<th class='mainTtl'>強さ</th>" +
				"<th class='mainTtl'>距離</th>" +
			"</tr>" +
			"<tr>" +
				"<td id='sendTroop_wood'></th>" +
				"<td id='sendTroop_stone'></th>" +
				"<td id='sendTroop_iron'></th>" +
				"<td id='sendTroop_rice'></th>" +
				"<td id='sendTroop_power'></th>" +
				"<td id='sendTroop_distance'></th>" +
			"</tr>" +
			"</table>" +
			"<div id='locationErrMsg' style='display:none'>"+
				"<font color='red'>未取得の座標です</font>"+
			"</div>"+
		"</div>"
	);

	// 情報表示
	sendTroopInfo();
}

// 出兵画面に簡易出兵先情報表示 by どらごら
function sendTroopInfo() {

	//保存データ取得
	var x = parseInt(j$("input[name=village_x_value]").val());
	var y = parseInt(j$("input[name=village_y_value]").val());
	var data = loadCellData(generateCellKey(x, y));
	if (data.length == 0) {
		j$("#sendTroopInfoTable td:first")
			.text("")
			.next().text("")
			.next().text("")
			.next().text("")
			.next().text("")
			.next().text("")
			;
		j$("#locationErrMsg").show();

	} else {
		var clsData = new genPopupText(data, x, y);	// by どらごら

		j$("#sendTroopInfoTable td:first")
			.text(clsData.data[IDX_WOOD])
			.next().text(clsData.data[IDX_STONE])
			.next().text(clsData.data[IDX_IRON])
			.next().text(clsData.data[IDX_RICE])
			.next().text("☆" + (clsData.power).length)
			.next().text(clsData.distance)
			;
		j$("#locationErrMsg").hide();
	}
}

function allianceCSV_1(){
	//CSV出力用
	if (j$("#csvMake").size() == 0){
		j$("table.tables")
			.after("<iframe style=\"width: 100%; height: 0px; visibility:hidden\" id=\"memberCsvFrame\"></iframe>")
			.after("<p id=\"csvMake\">同盟員全領地情報取得</p>");

		j$("#csvMake").css("background","black").css("width", "180px").css("color", "white").css("text-align", "center");
	}
	j$("#csvMake").click(function() {
		if (j$("#csvMake").text() != "同盟員全領地情報取得"){return;}
		if( confirm("同盟員の情報を一気に取得するためサーバに負荷がかかります。\n何度も実行するとDOS攻撃と同じなので、実行には注意して下さい") == false ) return;

		MEMBER_ID_LIST = new Array();
		j$("table.tables td a").each(function(){
			var url = j$(this).attr("href");
			var uid = url.match(/user_id=[0-9]+/);
			if (uid != null){
				MEMBER_ID_LIST.push({"URL":"/user/?" + uid});
			}
		});

		MEMBER_INFO_TEXT = "Ｘ座標,Ｙ座標,君主,領地,人口,本拠地,戦力,森,岩,鉄,糧,備考\n";
		setWaitCursor();
		MEMBER_ID_LIST_COUNTER = MEMBER_ID_LIST.length;
		MEMBER_ID_MAX_COUNTER = MEMBER_ID_LIST_COUNTER;
		window.setTimeout(GetMember, 0);
	});
}

function GetMember() {

	j$("#csvMake").text("情報取得中" +	(MEMBER_ID_MAX_COUNTER - MEMBER_ID_LIST_COUNTER) + "/" + MEMBER_ID_MAX_COUNTER);
	if(MEMBER_ID_LIST.length == 0) {
		if (MEMBER_ID_LIST_COUNTER > 0){
			window.setTimeout(GetMember, 1000);
		} else {
			var frameDoc = document.getElementById("memberCsvFrame").contentDocument;
			var addElem = frameDoc.createElement("pre");
			addElem.id = "memberCsv";
			addElem.style.fontSize = "12px";
			frameDoc.body.appendChild(addElem);

			addElem.innerHTML = MEMBER_INFO_TEXT;
			j$("#memberCsvFrame").css("height", "300px").css("visibility","visible");
			j$("#csvMake").text("同盟員全領地情報取得(済)");
			resetCursor();
			alert("同盟情報　取得完了!");
			return;
		}
	}

	var member = MEMBER_ID_LIST.pop();
	cajaxRequest_1(member.URL, "GET", "", function(req) {
		var dt = getXYListfromUserHTML(req.responseText);
		if( dt ) {
			for(var i=0 ; i<dt.length ; i++) {
				MEMBER_INFO_TEXT += dt[i].x + ",";
				MEMBER_INFO_TEXT += dt[i].y + ",";
				MEMBER_INFO_TEXT += convCsvString(dt[i].user_name) + ",";
				MEMBER_INFO_TEXT += convCsvString(dt[i].area_name) + ",";
				MEMBER_INFO_TEXT += dt[i].jinko + ",";
				MEMBER_INFO_TEXT += dt[i].honkyo + ",";
				var data = getCellDataCache(generateCellKey(dt[i].x, dt[i].y));
				if (data.length == 0) {
					MEMBER_INFO_TEXT += ",,,,,情報未取得\n";
				} else {
					if (dt[i].jinko != ""){
						MEMBER_INFO_TEXT += ",,,,,\n";	//拠点の場合、資源情報は無しとする。
					} else {
						MEMBER_INFO_TEXT += data[IDX_POWER] + ",";
						MEMBER_INFO_TEXT += data[IDX_WOOD] + ",";
						MEMBER_INFO_TEXT += data[IDX_STONE] + ",";
						MEMBER_INFO_TEXT += data[IDX_IRON] + ",";
						MEMBER_INFO_TEXT += data[IDX_RICE] + ",\n";
					}
				}
			}
		}

		MEMBER_ID_LIST_COUNTER = MEMBER_ID_LIST_COUNTER - 1;
	});
	window.setTimeout(GetMember, 0);

	function getXYListfromUserHTML(html){
		var ret = new Array();
//		var tmp = html.match(/<td>君主<\/td>[^<]*<td>([^<]*)<\/td>/);
//		if( !tmp ) return null;
//		var user_name = tmp[1].replace(/[\r\n\t ]/g, "");

		var tmp = html.match(/<td[^>]*>君主<\/td>[^<]*<td[^>]*>([^<]+)<img[^>]*>([^<]+)/);	//W12専用
		if (!tmp) {
			var tmp = html.match(/<td[^>]*>君主<\/td>[^<]*<td[^>]*>([^<]+)/);	//それ以外の鯖
			if( !tmp ) return null;
			var user_name = tmp[1].replace(/(^\s+|\s+$)/g, "");
		} else {
			var user_name = tmp[2].replace(/(^\s+|\s+$)/g, "");
		}

		var pos;
		var reg = /<a href="\.\.\/(?:land|village_change)\.php[^"]*">\s*([^<\s]+)\s*<\/a>[^<]*<\/td>[^<]*<td[^>]*>([\-0-9]+),([\-0-9]+)<\/td>[^<]*<td[^>]*>([0-9]+|&nbsp;)<\/td>/;
		var honkyo = 1;
		while((pos = html.search(reg) ) != -1 ) {
			html = html.substr(pos);

			var dat = html.match(reg);
			if( !dat ) break;

			if( dat[4] == "&nbsp;" ) dat[4] = "";

			ret.push({"user_name":user_name, "area_name":dat[1].replace(/(^\s+|\s+$)/g, ""), "x":dat[2], "y":dat[3], "jinko":dat[4], "honkyo":honkyo});
			honkyo="";
			html = html.substr(dat[0].length);
		}

		return ret;
	}
}

function ChangePicture() {
	if (DISP_PICTURE){return;}
	j$("div #mapsAll img").each(function(){
		var src = j$(this).attr("src");
		if (src.indexOf("resource") >= 0){
			j$(this).remove();	//資源画像がヒットされたらタグそのものを削除。
		}
	});
}

function ConfigOpen() {
	j$('#CONFIG_AREA').show();
	GM_log("#open");
}

function ConfigClose() {
	j$('#CONFIG_AREA').hide();
	GM_log("#close");
}
//faraway 1.地図ツールのソース(bro3_map_tool.user.js) 終了

//---------------------------------------------
// 同盟貢献チェッカー
//---------------------------------------------
function disp_alliance() {
	if(location.pathname != "/alliance/info.php") return;
	//mixi鯖障害回避用: 広告iframe内で呼び出されたら無視
	var container = document.evaluate('//*[@id="container"]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	if (container.snapshotLength == 0) return;

	initGMWrapper_3();

	//「略称」欄取得
	var myAllyElem = document.evaluate(
		'//*[@id="gray02Wrapper"]//table/tbody/tr[3]/td',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	if (myAllyElem.snapshotLength == 0) return;
	ALLY_NAME = trim_3(myAllyElem.snapshotItem(0).innerHTML);

	//前回更新日時取得
	LAST_UPDATE = GM_getValue(generateAllyKey_3(ALLY_NAME), "");

	//同盟ランキングTableタイトル部取得
	var tableTitle = document.evaluate(
		'//*[@id="gray02Wrapper"]//table[@class="tables"]/tbody/tr/th',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);

	//チェック実行リンク追加
	var checkExecLink = document.createElement("a");
	checkExecLink.id = "checkContribLink";
	checkExecLink.href = "javascript:void(0)";
	checkExecLink.innerHTML = "貢献チェック実行";
	if (LAST_UPDATE != "") {
		checkExecLink.innerHTML += "(前回:" + convDateStrShort(LAST_UPDATE) + ")";
	}
	checkExecLink.style.margin = "0px 5px";
	tableTitle.snapshotItem(0).appendChild(checkExecLink);
	checkExecLink.addEventListener("click", chackContrib, true);

	//基準時刻更新リンク追加
	var checkSaveLink = document.createElement("a");
	checkSaveLink.id = "saveContribLink";
	checkSaveLink.href = "javascript:void(0)";
	checkSaveLink.innerHTML = "貢献チェック基準時刻更新";
	checkSaveLink.innerHTML += "(";
	if (LAST_UPDATE != "") {
		checkSaveLink.innerHTML += convDateStrShort(LAST_UPDATE);
	}
	checkSaveLink.innerHTML += " → " + convDateStrShort(CURRENT_TIME);
	checkSaveLink.innerHTML += ")";
	checkSaveLink.style.display = "none";
	checkSaveLink.style.margin = "0px 5px";
	tableTitle.snapshotItem(0).appendChild(checkSaveLink);
	checkSaveLink.addEventListener("click", saveContrib, true);

	//データ更新済メッセージ追加
	var messageSaveEnd = document.createElement("span");
	messageSaveEnd.id = "descContribEnd";
	messageSaveEnd.innerHTML = "貢献チェック基準時刻更新済";
	messageSaveEnd.innerHTML += "(";
	if (LAST_UPDATE != "") {
		messageSaveEnd.innerHTML += convDateStrShort(LAST_UPDATE);
	}
	messageSaveEnd.innerHTML += " → " + convDateStrShort(CURRENT_TIME);
	messageSaveEnd.innerHTML += ")";
	messageSaveEnd.style.display = "none";
	messageSaveEnd.style.margin = "0px 5px";
	messageSaveEnd.style.fontSize = "10px";
	tableTitle.snapshotItem(0).appendChild(messageSaveEnd);
}

//貢献チェック実行
function chackContrib() {

	//「同盟内ランキング」Table各行の取得
	var userElems = document.evaluate(
		'//*[@id="gray02Wrapper"]//table[@class="tables"]/tbody/tr',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	for (var i = 0; i < userElems.snapshotLength; i++) {
		var newModified = "";
		var oldModified = "";

		var rowFields = document.evaluate('./td', userElems.snapshotItem(i),
			null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		if (rowFields.snapshotLength == 0) continue;

		//「君主」欄
		var userField = rowFields.snapshotItem(1);
		var userLink = document.evaluate('./a', userField,
			null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		var user = trim_3(userLink.snapshotItem(0).innerHTML);

		//前回値取得
		var userData = new Array();
		var dataStr = GM_getValue(generateUserKey_3(user), "");
		if (dataStr != "") {
			userData = dataStr.split(DELIMIT_3);
		}

		//「ランク」欄
		{
			var rankField = rowFields.snapshotItem(0);
			var newRank = trim_3(rankField.innerHTML);

			var rankItem = new Array("", "");
			if (userData[IDX_RANK] != undefined && userData[IDX_RANK] != "") {
				rankItem = userData[IDX_RANK].split(",");
			}
			var oldRank = rankItem[0];
			if (newRank != oldRank) {
				if (oldRank != "") {
					var diff = diffNum(oldRank, newRank);
					if (parseInt(diff) > 0) rankField.style.color = "red";
					else rankField.style.color = "blue";
					rankField.innerHTML = newRank + "<font size='-2'>(" + diff + ")</font>";
				}

				rankItem[0] = newRank;
				rankItem[1] = CURRENT_TIME;
				userData[IDX_RANK] = rankItem;
			}
		}

		//貢献チェック対象データ
		var fieldId = new Array(
			new Array(IDX_POINT, 2), //ポイント
			new Array(IDX_CONTRIB, 3), //寄付
			new Array(IDX_VILLAGE, 4) //拠点
		);
		for (var j = 0; j < fieldId.length; j++) {
			var targetElem = rowFields.snapshotItem(fieldId[j][1]);
			var targetData = userData[fieldId[j][0]];
			var newValue = trim_3(targetElem.innerHTML);

			var dataItem = new Array("", "");
			if (targetData != undefined && targetData != "") {
				dataItem = targetData.split(",");
			}
			var oldValue = dataItem[0];

			if (dataItem[1] > oldModified) {
				oldModified = dataItem[1];
			}

			if (newValue != oldValue) {

				//増減表示
				if (oldValue != "") {
					var diff = diffNum(newValue, oldValue);
					if (parseInt(diff) > 0) targetElem.style.color = "red";
					else targetElem.style.color = "blue";

					targetElem.innerHTML = newValue +
						"<font size='-2'>(" + diff + ")</font>";
				}

				dataItem[0] = newValue;
				dataItem[1] = CURRENT_TIME;
				userData[fieldId[j][0]] = genDelimitString_3(dataItem, ",");
				newModified = CURRENT_TIME;

			} else if (oldModified > newModified) {
				newModified = oldModified;
			}
		}

		//前回変化からの時間数を表示
		var newText = trim_3(userField.innerHTML);
		newText += "<font size='-2'> (";
		if (oldModified != "" && oldModified != newModified) {
			newText += diffTime(CURRENT_TIME, oldModified) + "→";
		}
 		newText += diffTime(CURRENT_TIME, newModified);
 		newText += ")</font>";
 		userField.innerHTML = newText;

		if (oldModified != newModified) {
			userField.style.color = "red";
		}

		//データを保存
		if (newModified == CURRENT_TIME || rankItem[1] == CURRENT_TIME) {
			SAVE_DATA[user] = userData;
			SAVE_USERS.push(user);
		}
	}

	//操作リンク更新
	document.getElementById("checkContribLink").style.display = "none";
	if (LAST_UPDATE == "") {
		//初回なら即保存
		saveContrib();
		document.getElementById("descContribEnd").style.display = "inline";
	} else {
		document.getElementById("saveContribLink").style.display = "inline";
	}
}

//貢献チェック基準更新
function saveContrib() {

	//Greasemonkey領域へ値を保存
	for (var i = 0; i < SAVE_USERS.length; i++) {
		var dataStr = genDelimitString_3(SAVE_DATA[SAVE_USERS[i]], DELIMIT_3);
		GM_setValue(generateUserKey_3(SAVE_USERS[i]), dataStr);
	}

	//Greasemonkey領域へ最終更新時刻を保存
	GM_setValue(generateAllyKey_3(ALLY_NAME), CURRENT_TIME);

	//操作リンク更新
	document.getElementById("saveContribLink").style.display = "none";
	document.getElementById("descContribEnd").style.display = "inline";
}

//同盟データキー生成
function generateAllyKey_3(allyName) {
	return location.hostname + "_ally2_" + escape(allyName);//faraway110602 同盟内ランキング貢献チェック実行(前回:05/12 14:02)文字化け回避保存のキー文字をユニークなものにした)
}
//君主データキー生成
function generateUserKey_3(userName) {
	return location.hostname + "_user_3_" + escape(userName);	//faraway110616 他のｽｸﾘﾌﾟﾄと競合する為
}

//数値増減計算（文字列）
function diffNum(strNum1, strNum2) {
	var intNum1 = parseInt(strNum1);
	if (isNaN(intNum1)) intNum1 = 0;
	var intNum2 = parseInt(strNum2);
	if (isNaN(intNum2)) intNum2 = 0;

	var diffInt = intNum1 - intNum2;
	var diffStr = "" + diffInt;
	if (diffInt > 0) diffStr = "+" + diffStr;

	return diffStr;
}

//時刻差分計算（文字列）
function diffTime(strTime1, strTime2) {
	var date1 = new Date(strTime1);
	var date2 = new Date(strTime2);
	var diffSec = Math.ceil((date1.getTime() - date2.getTime()) / 1000);

	var result = "";
	result += Math.floor(diffSec / (60*60));
	result += ":";
	result += padZero_3(Math.floor((diffSec % (60*60)) / 60));
	result += ":";
	result += padZero_3(diffSec % 60);

	return result;
}

//日時文字列編集（yyyy/mm/dd hh:mm:ss）
function generateDateString_3(date) {
	var res = "" + date.getFullYear() + "/" + padZero_3(date.getMonth() + 1) +
		"/" + padZero_3(date.getDate()) + " " + padZero_3(date.getHours()) + ":" +
		padZero_3(date.getMinutes()) + ":" + padZero_3(date.getSeconds());
	return res;
}

//日付文字列を短縮型に変換
function convDateStrShort(str) {
	var result = str;
	result = result.replace(/^[0-9]{4}\//, "");
	result = result.replace(/:[0-9]{2}$/, "");
	return result;
}

//先頭ゼロ付加
function padZero_3(num) {
	var result;
	if (num < 10) {
		result = "0" + num;
	} else {
		result = "" + num;
	}
	return result;
}

//空白除去
function trim_3(str) {
	return str.replace(/^[ 　\t\r\n]+|[ 　\t\r\n]+$/g, "");
}

//デリミタ区切り文字列生成
function genDelimitString_3(dataArray, delimiter) {
	var ret = "";
	for (var i=0; i < dataArray.length; i++) {
		if (dataArray[i] != undefined) ret += dataArray[i];
		if (i < dataArray.length-1) ret += delimiter;
	}
	return ret;
}

//Google Chrome用GM_*系ラッパー関数
function initGMWrapper_3() {

	// @copyright	  2009, James Campos
	// @license		cc-by-3.0; http://creativecommons.org/licenses/by/3.0/
	if ((typeof GM_getValue == 'undefined') || (GM_getValue('a', 'b') == undefined)) {
		GM_addStyle = function(css) {
			var style = document.createElement('style');
			style.textContent = css;
			document.getElementsByTagName('head')[0].appendChild(style);
		}

		GM_deleteValue = function(name) {
			localStorage.removeItem(LOCAL_STORAGE_3 + "." + name);
		}

		GM_getValue = function(name, defaultValue) {
			var value = localStorage.getItem(LOCAL_STORAGE_3 + "." + name);
			if (!value)
				return defaultValue;
			var type = value[0];
			value = value.substring(1);
			switch (type) {
				case 'b':
					return value == 'true';
				case 'n':
					return Number(value);
				default:
					return value;
			}
		}

		GM_log = function(message) {
			console.log(message);
		}

		GM_setValue = function(name, value) {
			value = (typeof value)[0] + value;
			localStorage.setItem(LOCAL_STORAGE_3 + "." + name, value);
		}
	}
}

//faraway 3.同盟貢献チェッカーのソース(bro3_contrib_checker.user.js)終了

//--------------------------------------
// 発展チェッカー
//--------------------------------------
// 公開ページ: http://blog.livedoor.jp/froo/archives/51383261.html
// 使い方: 君主プロフィールページを表示

function disp_development() {	//4.発展チェッカー faraway
	//mixi鯖障害回避用: 広告iframe内で呼び出されたら無視
	var container = document.evaluate('//*[@id="container"]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	if (container.snapshotLength == 0) return;

	//プロフィールページ以外なら処理しない
	if (location.pathname != "/user/" && location.pathname != "/user/index.php") {
		return;
	}

	initGMWrapper_4();

	//「君主」欄取得
	var user = "";
	var userElem = document.evaluate(
		'//*[@id="gray02Wrapper"]//table/tbody/tr[2]/td[2]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	user = userElem.snapshotItem(0).innerHTML;

	//前回値取得
	var data = new Array();
	var dataStr = GM_getValue(generateUserKey_4(user));	//faraway _4を追加
	if (dataStr != undefined) {
		data = dataStr.split(DELIMIT_4);
	}

	//各値欄取得
	var fieldPaths = new Array(
		'//*[@id="gray02Wrapper"]//table/tbody/tr[4]/td[3]', //ランク
		'//*[@id="gray02Wrapper"]//table/tbody/tr[5]/td[2]', //総合
		'//*[@id="gray02Wrapper"]//table/tbody/tr[6]/td[2]', //総人口
		'//*[@id="gray02Wrapper"]//table/tbody/tr[6]/td[4]', //拠点
		'//*[@id="gray02Wrapper"]//table/tbody/tr[7]/td[2]', //攻撃
		'//*[@id="gray02Wrapper"]//table/tbody/tr[7]/td[4]', //防御
		'//*[@id="gray02Wrapper"]//table/tbody/tr[8]/td[2]', //撃破スコア
		'//*[@id="gray02Wrapper"]//table/tbody/tr[8]/td[4]', //防衛スコア
		'//*[@id="gray02Wrapper"]//table/tbody/tr[4]/td[5]', //同盟
		'//*[@id="gray02Wrapper"]//table/tbody/tr[5]/td[4]'  //役職
	);
	for (var i=0; i<fieldPaths.length; i++) {
		var targetElem = document.evaluate(fieldPaths[i],
			document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
		var value = targetElem.snapshotItem(0).innerHTML;

		var dataItem = new Array();
		if (data[i] != undefined) {
			dataItem = data[i].split(",");
		}

		//値変化を表示
		var lastUpdate = getCurrentTime_4();

		//日時表示編集
		var dateText = dataItem[1];
		if (dateText == undefined) dateText = lastUpdate;
		dateText = dateText.replace(/^[0-9]{4}-/, "");
		dateText = dateText.replace(/:[0-9]{2}$/, "");
		if (dataItem[0] != undefined && value != dataItem[0]) {
			targetElem.snapshotItem(0).style.color = "red";
			targetElem.snapshotItem(0).innerHTML =
				value + " ← " + dataItem[0] +
				" (" + dateText + " ～)";
		} else {
			targetElem.snapshotItem(0).innerHTML =
				value + " (" + dateText + " ～)";
		}

		//値に変更があったら更新
		if (value != dataItem[0]) {
			dataItem[0] = value;
			dataItem[1] = lastUpdate;
			data[i] = dataItem;
		}
	}

	//値を保存
	GM_setValue(generateUserKey_4(user), genDelimitString_4(data, DELIMIT_4));
}

//君主データキー生成
function generateUserKey_4(userName) {
	//faraway110616 return location.hostname + "_user_" + escape(userName);
	return location.hostname + "_user_4_" + escape(userName);	//faraway110616 他のｽｸﾘﾌﾟﾄと競合する為
}

//現在時刻取得（yyyy-mm-dd hh:mm:ss）
function getCurrentTime_4() {
	var date = new Date();
	var res = "" + date.getFullYear() + "-" + padZero_4(date.getMonth() + 1) +
		"-" + padZero_4(date.getDate()) + " " + padZero_4(date.getHours()) + ":" +
		padZero_4(date.getMinutes()) + ":" + padZero_4(date.getSeconds());
	return res;
}

//先頭ゼロ付加
function padZero_4(num) {
	var result;
	if (num < 10) {
		result = "0" + num;
	} else {
		result = "" + num;
	}
	return result;
}

//デリミタ区切り文字列生成
function genDelimitString_4(dataArray, delimiter) {
	var ret = "";
	for (var i=0; i < dataArray.length; i++) {
		if (dataArray[i] != undefined) ret += dataArray[i];
		if (i < dataArray.length-1) ret += delimiter;
	}
	return ret;
}

//Google Chrome用GM_*系ラッパー関数
function initGMWrapper_4() {

	// @copyright	  2009, James Campos
	// @license		cc-by-3.0; http://creativecommons.org/licenses/by/3.0/
	if ((typeof GM_getValue == 'undefined') || (GM_getValue('a', 'b') == undefined)) {
		GM_addStyle = function(css) {
			var style = document.createElement('style');
			style.textContent = css;
			document.getElementsByTagName('head')[0].appendChild(style);
		}

		GM_deleteValue = function(name) {
			localStorage.removeItem(LOCAL_STORAGE4 + "." + name);
		}

		GM_getValue = function(name, defaultValue) {
			var value = localStorage.getItem(LOCAL_STORAGE4 + "." + name);
			if (!value)
				return defaultValue;
			var type = value[0];
			value = value.substring(1);
			switch (type) {
				case 'b':
					return value == 'true';
				case 'n':
					return Number(value);
				default:
					return value;
			}
		}

		GM_log = function(message) {
			console.log(message);
		}

		GM_setValue = function(name, value) {
			value = (typeof value)[0] + value;
			localStorage.setItem(LOCAL_STORAGE4 + "." + name, value);
		}
	}
}

//faraway 4.発展チェッカーのソース(bro3_growth_checker.user.js)終了

//================================================================================
//5.統計グラフ化ツール
//================================================================================
//
// 公開ページ: http://blog.livedoor.jp/froo/archives/51416669.html
// 使い方: 「統計」-「同盟」ページ検索欄横の各リンクをクリック

function disp_statistics() {	//faraway
	if(location.pathname != "/alliance/list.php") return;

	//mixi鯖障害回避用: 広告iframe内で呼び出されたら無視
	var container = document.evaluate('//*[@id="container"]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	if (container.snapshotLength == 0) return;

	initGMWrapper_5();
	var allysIndexTmp = GM_getValue(location.hostname + "_allys_index", "");
	if (allysIndexTmp != "") ALLYS_INDEX_5 = allysIndexTmp.split(DELIMIT_5);
	getAllyData_5();
	addLinkHtml_5();

}

//同盟ランキングデータ取得
function getAllyData_5() {
	var tableElems = document.evaluate(
		'//*[@id="grayWrapper"]//table/tbody/tr',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);

	//ランキング時刻を取得
	var time = getChildElement_5(
		getChildElement_5(tableElems.snapshotItem(0), 2), 0).innerHTML;
	time = time.replace(/^([0-9]{2}:[0-9]{2}).+$/, "$1");
	var now = new Date();
	var nowTime = padZero_5(now.getHours()) + ":" + padZero_5(now.getMinutes());

	//前日分かチェック
	var tmpDate = now;
	if (nowTime < time) {
		tmpDate.setDate(now.getDate() - 1);
	}

	//日時に編集
	var datetime = tmpDate.getFullYear() + "/" + padZero_5(tmpDate.getMonth() + 1) +
		"/" + padZero_5(tmpDate.getDate()) + " " + time;

	//各同盟データ取得
	CURRENT_ALLYS_5 = new Array();
	for (var i = 2; i<tableElems.snapshotLength; i++) {
		var item = tableElems.snapshotItem(i);
		var appendData = new Array();
		appendData[IDX_DATETIME] = datetime;

		//更新データ取得
		var name = getChildElement_5(getChildElement_5(item, 1), 0).innerHTML; //同盟略称
		appendData[IDX_POINT_5] = getChildElement_5(item, 2).innerHTML; //ポイント
		appendData[IDX_RANK_5] = getChildElement_5(item, 0).innerHTML.replace(/→\s/, ""); //ランク
		appendData[IDX_MEMBER] = getChildElement_5(item, 3).innerHTML; //メンバー
		CURRENT_ALLYS_5.push(name);

		//既存データを取得
		var data = loadAllyData_5(name);

		//データ更新
		var upIdx = data.length;
		if (data.length >= 1) {
			var lastDatetime = data[data.length-1][0];
			if (datetime == lastDatetime) {
				upIdx--;
			}
		}
		data[upIdx] = appendData;

		//Greasemonkey領域へ永続保存
		saveAllyData_5(name, data);

		//検索用索引更新
		if (searchArrayItem_5(ALLYS_INDEX_5, name) < 0) {
			ALLYS_INDEX_5.push(name);
		}
	}

	//検索用索引をGreasemonkey領域へ永続保存
	saveAllysIndex_5();
}

//ツールOpenリンク追加
function addLinkHtml_5() {
	var containerElem = document.getElementById("rankSearch");
	var addElem = document.createElement("span");
	containerElem.appendChild(addElem);
	addElem.id = "toolLink";

	//aタグ（グラフ）
	var linkGraph =  document.createElement("a");
	linkGraph.id = "toolOpen";
	linkGraph.href = "javascript:void(0);";
	linkGraph.innerHTML = "グラフ表示";
	linkGraph.style.color = "white";
	linkGraph.style.backgroundColor = "black";
	linkGraph.style.padding = "3px 5px";
	linkGraph.style.margin = "2px 4px";
	linkGraph.addEventListener("click", function() {openTool();}, true);
	addElem.appendChild(linkGraph);

	//aタグ（CSV）
	var linkCsv =  document.createElement("a");
	linkCsv.id = "toolCsv";
	linkCsv.href = "javascript:void(0);";
	linkCsv.innerHTML = "CSV表示";
	linkCsv.style.color = "white";
	linkCsv.style.backgroundColor = "black";
	linkCsv.style.padding = "3px 5px";
	linkCsv.style.margin = "2px 4px";
	linkCsv.addEventListener("click", function() {outputCsv();}, true);
	addElem.appendChild(linkCsv);
}

//ツールOpen
function openTool() {

	//既存オブジェクト消去
	document.getElementById("grayWrapper").style.display = "none";

	//グラフオブジェクト表示
	if (TOOL_LOADED) {
		document.getElementById("graphtool").style.display = "block";
	} else {
		addToolHtml(document.getElementById("whiteWrapper"));
		TOOL_LOADED = true;
	}
}

//ツールHTML追加
function addToolHtml(parentElem) {

	//グラフオブジェクト追加
	var toolElem = document.createElement("div");
	parentElem.appendChild(toolElem);
	toolElem.id = "graphtool";
	toolElem.style.margin = "8px 8px";

	//グラフ化対象同盟取得
	loadTargetAllys();

	//HTML追加
	addGraphHtml(toolElem);
	addCtrlHtml(toolElem);
	if (navigator.userAgent.toLowerCase().indexOf('chrome') < 0) {
		initPopup_5(toolElem);
	}
}

//グラフ部HTML追加
function addGraphHtml(parentElem) {
	var graphElem = document.createElement("div");
	parentElem.insertBefore(graphElem, document.getElementById("graphCtrl"));
	graphElem.id = "graphMain";
	graphElem.style.position = "relative";

	var canvasHtml = "<canvas id='graphCanvas' " +
		"width='" + (GRAPH_WIDTH + GRAPH_PADDING * 2) +
		"' height='" + (GRAPH_HEIGHT + GRAPH_PADDING * 2) + "'></canvas>";
	graphElem.innerHTML = canvasHtml;
	var canvas = document.getElementById("graphCanvas");
	canvas.style.backgroundColor = "gainsboro";
	var ctx = canvas.getContext("2d");

	//時間がかかるので別スレッド化（一旦描画して砂時計を表示させる）
	setWaitCursor_5();
	window.setTimeout(function() {

		//同盟データ取得
		var allysData = new Array();
		var maxDatetime = new Date("2000/1/1 00:00:00");
		var minDatetime = new Date("2099/12/31 23:59:59");
		var maxPoint = 0;
		var minPoint = 0;
		for (var i = 0; i < ALLYS_5.length; i++) {
			if (ALLYS_5[i] == "") continue;
			var srcData = loadAllyData_5(ALLYS_5[i]);
			if (srcData.length == 0) continue;

			allysData[i] = new Array();
			for (var j = 0; j < srcData.length; j++) {
				allysData[i][j] = new Array();
				var datetime = new Date(srcData[j][IDX_DATETIME]);
				var point = parseInt(srcData[j][IDX_POINT_5]);
				if (isNaN(point)) point = 0;

				//最大/最小値チェック
				if (datetime.getTime() > maxDatetime.getTime()) maxDatetime = datetime;
				if (datetime.getTime() < minDatetime.getTime()) minDatetime = datetime;
				if (point > maxPoint) maxPoint = point;

				allysData[i][j][IDX_DATETIME] = datetime;
				allysData[i][j][IDX_POINT_5] = point;
			}
		}

		//グラフ表示
		for (var i = allysData.length - 1; i >= 0; i--) {
			if (allysData[i] == undefined) continue;
			ctx.strokeStyle = ALLY_COLORS_5[i];
			ctx.beginPath();

			var isFirst = true;
			for (var j = 0; j < allysData[i].length; j++) {
				if (allysData[i][j] == undefined) continue;
				var datetime = allysData[i][j][IDX_DATETIME];
				var point = allysData[i][j][IDX_POINT_5];

				var xRatio = 0;
				if (maxDatetime.getTime() > minDatetime.getTime()) {
					 xRatio = (datetime.getTime() - minDatetime.getTime())
						/ (maxDatetime.getTime() - minDatetime.getTime());
				}

				var yRatio = 0;
				if (maxPoint > minPoint) {
					yRatio = (point - minPoint) / (maxPoint - minPoint);
				}

				var xPos = Math.floor(GRAPH_WIDTH * xRatio) + GRAPH_PADDING;
				var yPos = GRAPH_HEIGHT - Math.floor(GRAPH_HEIGHT * yRatio) + GRAPH_PADDING;

				if (isFirst) ctx.moveTo(xPos, yPos);
				else ctx.lineTo(xPos, yPos);
				isFirst = false;

				var mark = document.createElement("div");
				graphElem.appendChild(mark);
				mark.style.position = "absolute";
				mark.style.border = "outset 1px " + ALLY_COLORS_5[i];
				mark.style.backgroundColor = ALLY_COLORS_5[i];
				mark.style.width = "6px";
				mark.style.height = "6px";
				mark.style.left = (xPos - 4) + "px";
				mark.style.top = (yPos - 4) + "px";

				//ポップアップ設定
				var popupText = ALLYS_5[i] + "<br/>" + generateDateString_5(datetime) +
					"<br/> " + point + "ポイント";
				if (navigator.userAgent.toLowerCase().indexOf('chrome') >= 0) {
					mark.title = popupText.replace(/<br\/>/g, "\n");
				} else {
					mark.addEventListener("mouseover", createOnPopup(popupText), true);
					mark.addEventListener("mouseout", function() {offPopup_5();}, true);
				}
			}

			ctx.stroke();
		}

		resetCursor_5();
	}, 0);
}

//操作部HTML追加
function addCtrlHtml(parentElem) {
	var addElem = document.createElement("div");
	parentElem.appendChild(addElem);
	addElem.id = "graphCtrl";
	addElem.style.margin = "2px 2px";

	addElem.innerHTML =
		"<table style='font-size:11px'>"+
		"<tr>"+
			"<td style='background-color:black; padding:5px 4px; text-align:center;'>"+
				"<a id='graphtoolClose' href='javascript:void(0);'>ランキング</a>"+
			"</td>"+
			"<td style='width:5px'></td>"+
			"<td id='fld_ally1' style='padding:2px 4px;'>"+
				"<input id='ally1' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally2' style='padding:2px 4px;'>"+
				"<input id='ally2' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally3' style='padding:2px 4px;'>"+
				"<input id='ally3' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally4' style='padding:2px 4px;'>"+
				"<input id='ally4' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally5' style='padding:2px 4px;'>"+
				"<input id='ally5' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally6' style='padding:2px 4px;'>"+
				"<input id='ally6' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally7' style='padding:2px 4px;'>"+
				"<input id='ally7' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally8' style='padding:2px 4px;'>"+
				"<input id='ally8' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally9' style='padding:2px 4px;'>"+
				"<input id='ally9' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally10' style='padding:2px 4px;'>"+
				"<input id='ally10' type='text' style='width:52px' />"+
			"</td>"+
			"<td style='background-color:black; padding:0px 4px; text-align:center;'>"+
				"<input id='graphtoolSave' type='button' value='保存' />"+
			"</td>"+
		"</tr>"+
		"<tr>"+
			"<td id='version' "+
				"style='font-size:9px; padding:2px 2px; text-align:center;'></td>"+
			"<td></td>"+
			"<td id='fld_ally11' style='padding:2px 4px;'>"+
				"<input id='ally11' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally12' style='padding:2px 4px;'>"+
				"<input id='ally12' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally13' style='padding:2px 4px;'>"+
				"<input id='ally13' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally14' style='padding:2px 4px;'>"+
				"<input id='ally14' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally15' style='padding:2px 4px;'>"+
				"<input id='ally15' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally16' style='padding:2px 4px;'>"+
				"<input id='ally16' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally17' style='padding:2px 4px;'>"+
				"<input id='ally17' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally18' style='padding:2px 4px;'>"+
				"<input id='ally18' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally19' style='padding:2px 4px;'>"+
				"<input id='ally19' type='text' style='width:52px' />"+
			"</td>"+
			"<td id='fld_ally20' style='padding:2px 4px;'>"+
				"<input id='ally20' type='text' style='width:52px' />"+
			"</td>"+
			"<td style='background-color:black; padding:0px 4px; text-align:center;'>"+
				"<input id='graphtoolClear' type='button' value='消去' />"+
			"</td>"+
		"</tr>"+
		"</table>";

	//バージョン
	document.getElementById("version").innerHTML = "Ver." + VERSION_5;

	//着色
	for (var i = 0; i < ALLY_COLORS_5.length; i++) {document.getElementById("fld_ally" + (i+1)).style.backgroundColor = ALLY_COLORS_5[i];}
	//同盟を表示
	for (var i = 0; i < ALLYS_5.length; i++) {document.getElementById("ally" + (i+1)).value = ALLYS_5[i];}
	//イベントリスナー登録（保存ボタン）
	document.getElementById('graphtoolSave').addEventListener("click",
		function() {

			//入力同盟名をGreasemonkey領域に保存
			for (var i = 0; i < ALLY_COLORS_5.length; i++) {ALLYS_5[i] = trim_5(document.getElementById("ally" + (i+1)).value);}
			GM_setValue(location.hostname + "_allys", genDelimitString_5(ALLYS_5, DELIMIT_5));
			//グラフ再描画
			var toolElem = document.getElementById("graphtool");
			toolElem.removeChild(document.getElementById("graphMain"));
			addGraphHtml(toolElem);
		},
	true);
	//イベントリスナー登録（消去ボタン）
	document.getElementById('graphtoolClear').addEventListener("click",function() {clearAllys();}, true);
	//イベントリスナー登録（閉じるリンク）
	document.getElementById('graphtoolClose').addEventListener("click",function() {closeTool();}, true);
}

//説明ポップアップ初期化
function initPopup_5(parentElem) {

	//CSS
	addGlobalStyle_5(
		".popup{"+
			"position:absolute; left:0px; top:0px; visibility:hidden; "+
			"font-size:9pt; color:#0099FF; "+
			"background-color:#FFFFFF; layer-background-color:#FFFFFF; "+
			"border:1px solid #0099FF; padding:5; z-index:255;"+
		"}"
	);

	//HTMLタグ追加
	var popupElem = document.createElement('span');popupElem.id = "popup";popupElem.className =  "popup";parentElem.appendChild(popupElem);

	//イベントリスナー登録
	popupElem.addEventListener("mouseover",	function() { this.style.visibility = "hidden" }, true);
}

//ポップアップOn関数作成
function createOnPopup(text) {return function(e) {onPopup_5(text, e.pageX, e.pageY);}}

//ポップアップOn/Off
function onPopup_5(text, nX, nY) {
	var sX = -10, sY = 24;
	var msgElem = document.getElementById("popup");
	msgElem.innerHTML = text;
	msgElem.style.visibility = "visible";
	msgElem.style.left = (nX + sX) + "px";
	msgElem.style.top = (nY + sY) + "px";
}
function offPopup_5() {document.getElementById("popup").style.visibility = "hidden";}

//同盟入力消去
function clearAllys() {for (var i = 0; i < ALLY_COLORS_5.length; i++) {document.getElementById("ally" + (i+1)).value = "";}}

//ツールを閉じる
function closeTool() {document.getElementById("grayWrapper").style.display = "block";document.getElementById("graphtool").style.display = "none";}

//同盟データ保存
function saveAllyData_5(name, data) {
	var saveData = new Array();
	for (var i = 0; i < data.length; i++) {saveData[i] = genDelimitString_5(data[i], DELIMIT2_5);}
	GM_setValue(generateAllyKey_5(name), genDelimitString_5(saveData, DELIMIT_5));
}

//同盟データ読み込み
function loadAllyData_5(ally) {
	var ret = new Array();
	var src = GM_getValue(generateAllyKey_5(ally), "");

	var array1 = src.split(DELIMIT_5);
	for (var i = 0; i < array1.length; i++) {if (array1[i] != "") {ret[i] = array1[i].split(DELIMIT2_5);}}
	return ret;
}

//グラフ表示対象同盟を読み込み
function loadTargetAllys() {
	ALLYS_5 = GM_getValue(location.hostname + "_allys", "").split(DELIMIT_5);
	//指定同盟なしなら現ランキング表示の同盟をデフォルト設定
	for (var i = 0; i < ALLYS_5.length; i++) {if (ALLYS_5[i] != "") return;}
	for (var i = 0; i < CURRENT_ALLYS_5.length; i++) {ALLYS_5[i] = CURRENT_ALLYS_5[i];}
}

//CSV出力
function outputCsv() {
	document.getElementById("grayWrapper").style.display = "none";

	var frameElem = document.createElement("iframe");
	frameElem.id = "toolCsvFrame";
	frameElem.style.width = "100%";
	frameElem.style.height = "540px";

	var container = document.getElementById("whiteWrapper");
	container.appendChild(frameElem);

	//時間がかかるので別スレッド化（一旦描画して砂時計を表示させる）
	setWaitCursor_5();
	window.setTimeout(function() {
		var frameDoc = document.getElementById("toolCsvFrame").contentDocument;
		var addElem = frameDoc.createElement("pre");
		addElem.id = "toolCsv";
		addElem.style.fontSize = "12px";
		frameDoc.body.appendChild(addElem);

		//タイトル行
		var csvText = "";
		csvText += "ALLIANCER,DATETIME,RANK,POINT,MEMBER\n";

		//データ行
		for (var i = 0; i < ALLYS_INDEX_5.length; i++) {

			//保存データ取得
			var srcData = loadAllyData_5(ALLYS_INDEX_5[i]);
			if (srcData.length == 0) continue;

			for (var j = 0; j < srcData.length; j++) {
				csvText += convCsvString_5(ALLYS_INDEX_5[i]);
				csvText += ",";
				csvText += srcData[j][IDX_DATETIME];
				csvText += ",";
				csvText += srcData[j][IDX_RANK_5];
				csvText += ",";
				csvText += srcData[j][IDX_POINT_5];
				csvText += ",";
				csvText += srcData[j][IDX_MEMBER];
				csvText += "\n";
			}
		}

		addElem.innerHTML = csvText;
		resetCursor_5();
	}, 0);
}

//同盟データキー生成
function generateAllyKey_5(allyName) {
	return location.hostname + "_ally5_" + escape(allyName);//faraway110602	保存名をユニークにする
}

//検索用索引保存
function saveAllysIndex_5() {GM_setValue(location.hostname + "_allys_index", genDelimitString_5(ALLYS_INDEX_5, DELIMIT_5));}

//子Element取得
function getChildElement_5(parentNode, position) {
	var current = 0;
	for (var i = 0; i < parentNode.childNodes.length; i++){
		var childNode = parentNode.childNodes[i];
		if (childNode.nodeType == 1) {
			if (current == position) {return childNode;}
			current++;
		}
	}
	return undefined;
}

//カーソル変更
function setWaitCursor_5() {document.getElementsByTagName("body")[0].style.cursor = "wait";}
function resetCursor_5() {document.getElementsByTagName("body")[0].style.cursor = "auto";}

//CSS追加
function addGlobalStyle_5(css) {
	var head, style;
	head = document.getElementsByTagName("head")[0];
	if (!head) { return; } style = document.createElement("style");
	style.type = "text/css";
	style.innerHTML = css;
	head.appendChild(style);
}

//日時文字列編集（mm/dd hh:mm）
function generateDateString_5(date) {
	var res = "" + padZero_5(date.getMonth() + 1) + "/" + padZero_5(date.getDate()) +
		" " + padZero_5(date.getHours()) + ":" + padZero_5(date.getMinutes());
	return res;
}

//先頭ゼロ付加
function padZero_5(num) {
	var result;
	if (num < 10) {
		result = "0" + num;
	} else {
		result = "" + num;
	}
	return result;
}

//空白除去
function trim_5(str) {	return str.replace(/^[ 　\t\r\n]+|[ 　\t\r\n]+$/g, "");}

//CSV用文字列変換
function convCsvString_5(str) {
	var result;

	//「"」を「""」に変換
	result = str.replace(/\"/g, "\"\"");

	//「,」を含む場合は全体を「"」で囲む
	if (result.indexOf(",") >= 0) {	result = "\"" + result + "\"";}
	return result;
}

//デリミタ区切り文字列生成
function genDelimitString_5(dataArray, delimiter) {
	var ret = "";
	for (var i=0; i < dataArray.length; i++) {
		if (dataArray[i] != undefined) ret += dataArray[i];
		if (i < dataArray.length-1) ret += delimiter;
	}
	return ret;
}

//配列検索
function searchArrayItem_5(array, key) {
	for (var i=0; i<array.length; i++) {if (array[i] == key) {return i;}}
	return -1;
}

//Google Chrome用GM_*系ラッパー関数
function initGMWrapper_5() {

	// @copyright	  2009, James Campos
	// @license		cc-by-3.0; http://creativecommons.org/licenses/by/3.0/
	if ((typeof GM_getValue == 'undefined') || (GM_getValue('a', 'b') == undefined)) {
		GM_addStyle = function(css) {
			var style = document.createElement('style');
			style.textContent = css;
			document.getElementsByTagName('head')[0].appendChild(style);
		}

		GM_deleteValue = function(name) {localStorage.removeItem(LOCAL_STORAGE_5 + "." + name);}
		GM_getValue = function(name, defaultValue) {
			var value = localStorage.getItem(LOCAL_STORAGE_5 + "." + name);
			if (!value) return defaultValue;
			var type = value[0];
			value = value.substring(1);
			switch (type) {
				case 'b':
					return value == 'true';
				case 'n':
					return Number(value);
				default:
					return value;
			}
		}

		GM_log = function(message) {console.log(message);}

		GM_setValue = function(name, value) {value = (typeof value)[0] + value;localStorage.setItem(LOCAL_STORAGE_5 + "." + name, value);}
	}
}
//faraway 5.統計グラフ化ツールのソース(bro3_graph.user.js)終了

//-------------------------------------------
// 同盟ログツール
//-------------------------------------------
//
// 公開ページ: http://blog.livedoor.jp/froo/archives/51450661.html
// 使い方: 同盟ログ詳細(/alliance/detail.php)下部にツールリンク
// 　　　　同盟ログ一覧(/alliance/alliance_log.php)に未読マーク
// 　　　　報告書詳細(/report/detail.php)下部に戦力計算表示
// 　　　　拠点詳細(/village.php)・領地詳細(/land.php)に関連最新ログリンク

function disp_alliancelog() {
	//mixi鯖障害回避用: 広告iframe内で呼び出されたら無視
	var container = document.evaluate('//*[@id="container"]',document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	if (container.snapshotLength == 0) return;

	initGMWrapper_6();

	if (location.pathname == "/alliance/detail.php") {
		//ログデータ取得
		LOG_DATA[IDX_SUBJECT] = getSubject();
		LOG_DATA[IDX_DATE] = getLogDate();
		LOG_DATA[IDX_ACTOR] = getActor();
		LOG_DATA[IDX_SOLDIER_COUNT] = getSoldier();

		//HTML追加
		if (LOG_DATA[IDX_ACTOR].length > 0) {appendHeaderHtml();appendLinksHtml();}
		//保存
		saveLogData(LOG_ID, LOG_DATA);

	} else if (location.pathname == "/report/detail.php") {
		$tmp=$x_7('//div[@id="gray02Wrapper"]/table[@class="tables"]//tr[2]/td[1]').innerHTML;
		if(($tmp.indexOf("ブショーデュエルで"))>0) return;	//デュエルの結果ならおしまい。
		if(($tmp.indexOf("【拠点消滅】"))>0) return;	//拠点消滅ならおしまい。
		if(($tmp.indexOf("【砦占領】"))>0) return;	//砦占領ならおしまい。
		if(($tmp.indexOf("へ援軍が到着しました"))>0) return;	//援軍ならおしまい。
		if(($tmp.indexOf("盟主に任命されました"))>0) return;
		if(($tmp.indexOf("盟主補佐に任命されました"))>0) return;
		if(($tmp.indexOf("軍師に任命されました"))>0) return;
		if(($tmp.indexOf("大督に任命されました"))>0) return;
		if(($tmp.indexOf("盟主に解任されました"))>0) return;
		if(($tmp.indexOf("盟主補佐を解任されました"))>0) return;
		if(($tmp.indexOf("盟主軍師を解任されました"))>0) return;
		if(($tmp.indexOf("外交官を解任されました"))>0) return;
		if(($tmp.indexOf("大督を解任されました"))>0) return;
		if($tmp.match(/【勢力情報】.*が.*の城を破壊しました/)) return;

		appendHeaderHtml();
		appendSoldierCountHtml(getSoldier());
	}
}

//件名取得
function getSubject() {
	var elem = document.evaluate('//*[@id="gray02Wrapper"]/table[1]/tbody/tr[2]/td',document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	return trim_6(elem.snapshotItem(0).innerHTML);
}

//ログ時刻取得
function getLogDate() {
	var elem = document.evaluate('//*[@id="gray02Wrapper"]/table[@class="tables"]/tbody/tr/td[@class="sendingDate"]',document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	return trim_6(elem.snapshotItem(0).innerHTML);
}

//攻撃者・防御者の取得
function getActor() {
	var result = new Array();
	var links = new Array();
	var tables = document.evaluate('//*[@id="gray02Wrapper"]/table[@class="tables"]',document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	for (var i = 0; i < tables.snapshotLength; i++) {
		var itemTable = tables.snapshotItem(i);
		if (links[0] == undefined && itemTable.summary == "攻撃者") {
			links[0] = document.evaluate('./tbody/tr/th[@class="attackerBase"]/a',itemTable, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
		} else if (links[1] == undefined && itemTable.summary == "防御者") {
			links[1] = document.evaluate('./tbody/tr/th[@class="defenserBase"]/a',itemTable, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
		}
	}

	for (var i = 0; i < 2; i++) {
		result[i] = new Array();
		result[i][IDX2_ALLY_ID] = "";
		result[i][IDX2_ALLY_NAME] = "";
		result[i][IDX2_USER_ID] = "";
		result[i][IDX2_USER_NAME] = "";
		result[i][IDX2_VILLAGE_ID] = "";
		result[i][IDX2_VILLAGE_NAME] = "";

		if (links[i] == undefined) {
			//何もしない
		} else if (links[i].snapshotLength == 1) {
			result[i][IDX2_VILLAGE_ID] = getParameter2_6(links[i].snapshotItem(0).href, "village_id");
			result[i][IDX2_VILLAGE_NAME] = trim_6(links[i].snapshotItem(0).innerHTML);

		} else if (links[i].snapshotLength >= 3) {
			result[i][IDX2_ALLY_ID] = getParameter2_6(links[i].snapshotItem(0).href, "id");
			result[i][IDX2_ALLY_NAME] = trim_6(links[i].snapshotItem(0).innerHTML);
			result[i][IDX2_USER_ID] = getParameter2_6(links[i].snapshotItem(1).href, "user_id");
			result[i][IDX2_USER_NAME] = trim_6(links[i].snapshotItem(1).innerHTML);
			result[i][IDX2_VILLAGE_ID] = getParameter2_6(links[i].snapshotItem(2).href, "village_id");
			result[i][IDX2_VILLAGE_NAME] = trim_6(links[i].snapshotItem(2).innerHTML);
		}

		//防御者情報がない場合は件名欄から取得
		if (i == 1 && result[i][IDX2_VILLAGE_ID] == "") {
			var subject = getSubject();
			if (subject.match(/【不可侵条約】/)) continue;
			if (subject.match(/【同盟変更】/)) continue;
			if (subject.match(/【脱退】/)) continue;
			if (subject.match(/【同盟追放】/)) continue;

			var titleElem = document.evaluate(
				'//*[@id="gray02Wrapper"]/table[1]/tbody/tr[2]/td/a',
				document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);

			if (titleElem.snapshotLength >= 2) {
				var allyIdx;
				var villageIdx;
				var attacker = getParameter2_6(titleElem.snapshotItem(1).href, "village_id");
				var swap = (i == 0) ? 1 : 0;
				if (result[swap][IDX2_VILLAGE_ID] == attacker) {
					if (titleElem.snapshotLength == 3) {
						villageIdx = 2;
					} else {
						allyIdx = 2;
						villageIdx = 3;
					}
				} else {
					allyIdx = 0;
					villageIdx = 1;
				}

				if (allyIdx == undefined) {
					result[i][IDX2_ALLY_ID] = "";
					result[i][IDX2_ALLY_NAME] = "";
				} else {
					result[i][IDX2_ALLY_ID] =
						getParameter2_6(titleElem.snapshotItem(allyIdx).href, "id");
					result[i][IDX2_ALLY_NAME] =
						trim_6(titleElem.snapshotItem(allyIdx).innerHTML);
				}
				result[i][IDX2_USER_ID] = "";
				result[i][IDX2_USER_NAME] = "";
				result[i][IDX2_VILLAGE_ID] =
					getParameter2_6(titleElem.snapshotItem(villageIdx).href, "village_id");
				result[i][IDX2_VILLAGE_NAME] =
					trim_6(titleElem.snapshotItem(villageIdx).innerHTML);
			}
		}
	}

	return result;
}

//兵士取得
function getSoldier() {
	var result = new Array();
	var attackerData = new Array();
	var defenderData = new Array();

	var tables = document.evaluate('//*[@id="gray02Wrapper"]/table[@class="tables"]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	for (var i = 0; i < tables.snapshotLength; i++) {
		var itemTable = tables.snapshotItem(i);

		if (itemTable.summary == "攻撃者") {
			attackerData = addSoldierCount(attackerData, getSoldierCount(itemTable));
		} else if (itemTable.summary == "防御者") {
			defenderData = addSoldierCount(defenderData, getSoldierCount(itemTable));
		}
	}

	if (attackerData.length > 0 || defenderData.length > 0) {
		result.push(attackerData);
		result.push(defenderData);
	}

	return result;
}

//ツールHTML初期化
function resetToolHtml() {
	//本体部div
	var toolBody = document.getElementById("toolBody");
	if (toolBody) {
		var container = document.evaluate('//*[@id="gray02Wrapper"]',document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0);
		container.removeChild(toolBody);
	}
	//リンク背景色
	var linkIds = new Array("calcLink", "attackerLink", "defenderLink");
	for (var i = 0; i < linkIds.length; i++) {
		var elem = document.getElementById(linkIds[i]);
		elem.style.backgroundColor = "white";
	}
}

//ツール名＆バージョン表示HTML追加
function appendHeaderHtml() {
	var container = document.evaluate('//*[@id="gray02Wrapper"]',document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0);
	var titleElem = document.createElement("div");
	container.appendChild(titleElem);
	titleElem.innerHTML = "<br/>ログツール " + "<font size='-2'>Ver." + VERSION_6 + "<font>";
}

//リンク部HTML追加
function appendLinksHtml() {
	var container = document.evaluate('//*[@id="gray02Wrapper"]',document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0);
	var linkContainer = document.createElement("div");
	container.appendChild(linkContainer);
	var calcLink = document.createElement("a");
	var attackerLink = document.createElement("a");
	var defenderLink = document.createElement("a");
	linkContainer.appendChild(calcLink);
	linkContainer.appendChild(attackerLink);
	linkContainer.appendChild(defenderLink);

	calcLink.id = "calcLink";
	calcLink.innerHTML = "戦力計算";
	calcLink.style.margin = "4px";
	calcLink.style.padding = "2px";
	calcLink.href = "javascript:void(0)";
	calcLink.addEventListener("click", function() {dispSoldierCount()}, true);

	attackerLink.id = "attackerLink";
	attackerLink.innerHTML = "攻撃者関連ログ";
	attackerLink.style.margin = "4px";
	attackerLink.style.padding = "2px";
	attackerLink.href = "javascript:void(0)";
	attackerLink.addEventListener("click", function() {dispHistory(0)}, true);

	defenderLink.id = "defenderLink";
	defenderLink.innerHTML = "防御者関連ログ";
	defenderLink.style.margin = "4px";
	defenderLink.style.padding = "2px";
	defenderLink.href = "javascript:void(0)";
	defenderLink.addEventListener("click", function() {dispHistory(1)}, true);
}

//戦力計算表示
function dispSoldierCount() {
	resetToolHtml();
	var calkLink = document.getElementById("calcLink");
	calkLink.style.backgroundColor = "yellow";
	appendSoldierCountHtml(LOG_DATA[IDX_SOLDIER_COUNT]);
}

//関連ログ表示
//actorIdx: 0=攻撃者 1=防御者
function dispHistory(actorIdx) {
	resetToolHtml();
	var linkIds = new Array("attackerLink", "defenderLink");
	var link = document.getElementById(linkIds[actorIdx]);
	link.style.backgroundColor = "yellow";
	appendHistoryHtml(actorIdx);
}

//兵士数表示HTML追加
function appendSoldierCountHtml(soldierCount) {
	var container = document.evaluate('//*[@id="gray02Wrapper"]',document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0);
	var toolBody = document.createElement("div");
	toolBody.id = "toolBody";
	container.appendChild(toolBody);
	//table追加
	appendRestTable(toolBody, soldierCount[0], soldierCount[1]);
	appendLossTable(toolBody, soldierCount[0], soldierCount[1]);
}

//関連ログ表示HTML追加
function appendHistoryHtml(actorIdx) {
	var container = document.evaluate('//*[@id="gray02Wrapper"]',document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0);
	var toolBody = document.createElement("div");
	toolBody.id = "toolBody";
	container.appendChild(toolBody);
	//table追加
	var table = document.createElement("table");
	toolBody.appendChild(table);
	table.style.fontSize = "11px";
	table.style.margin = "3px";

	//タイトル行
	var titleRow = document.createElement("tr");
	titleRow.style.backgroundColor = "lawngreen";
	table.appendChild(titleRow);
	var titleTexts = new Array("件名", "時刻", "攻撃戦力", "防御戦力");
	for (var i = 0; i < titleTexts.length; i++) {
		var titleField = document.createElement("th");
		titleRow.appendChild(titleField);
		titleField.style.border = "solid 1px black";
		titleField.style.padding = "3px";
		titleField.innerHTML = titleTexts[i];
	}

	var logs = new Array();
	if (LOG_DATA[IDX_ACTOR][actorIdx] != undefined) {
		var villageId = LOG_DATA[IDX_ACTOR][actorIdx][IDX2_VILLAGE_ID];
		logs = loadLogIndex(villageId);
		logs.sort().reverse();
	}

	//データ行
	for (var i = 0; i < logs.length; i++) {
		var dataRow = document.createElement("tr");
		table.appendChild(dataRow);
		if (logs[i] == LOG_ID) {dataRow.style.backgroundColor = "yellow";}
		var logData = loadLogData(logs[i]);
		if (logData.length == 0) continue;

		//件名
		var subject = "<a href='/alliance/detail.php?id=" + logs[i] +
			"&p=" + getParameter_6("p") + "'>" +
			logData[IDX_SUBJECT].replace(/<[^>]+>/g, "") + "</a>";

		//戦力
		var soldierTotal = new Array();
		for (var j = 0; j < 2; j++) {
			if (logData[IDX_SOLDIER_COUNT][j] == undefined) {
				soldierTotal[j] = "-";
			} else {
				soldierTotal[j] = convDispNum(totalSoldiers(logData[IDX_SOLDIER_COUNT][j][0]));
				var lossSoldier = totalSoldiers(logData[IDX_SOLDIER_COUNT][j][1]);
				if (lossSoldier != 0 && !isNaN(lossSoldier)) {soldierTotal[j] += "(" + convDispNum(-lossSoldier) + ")";}
			}
			if (villageId == logData[IDX_ACTOR][j][IDX2_VILLAGE_ID]) {soldierTotal[j] = "<font color='red'><b>" + soldierTotal[j] + "</b></font>";}
		}
		var dataTexts = new Array(subject, logData[IDX_DATE], soldierTotal[0], soldierTotal[1]);
		for (var j = 0; j < dataTexts.length; j++) {
			var field = document.createElement("td");
			field.style.border = "solid 1px black";
			field.style.padding = "3px";
			dataRow.appendChild(field);
			field.innerHTML = dataTexts[j];
		}
	}
}

//兵士数加算
function addSoldierCount(total, add) {
	if (total == undefined) total = new Array();
	for (var i = 0; i < 2; i++) {
		if (total[i] == undefined) {total[i] = new Array(0,0,0,0,0,0,0,0,0,0,0);}
		for (var j = 0; j < 11; j++) {total[i][j] += add[i][j];}
	}
	return total;
}

//兵士数取得
function getSoldierCount(table) {
	var result = new Array();

	var rows = document.evaluate('./tbody/tr',
		table, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	for (var i = 0; i < rows.snapshotLength; i++) {
		var row = rows.snapshotItem(i);

		var fields = document.evaluate('./td',row, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
		if (fields.snapshotLength != 12) continue;
		var temp = new Array();
		for (var j = 0; j < fields.snapshotLength; j++) {
			var field = fields.snapshotItem(j);
			temp[j] = parseInt(trim_6(field.innerHTML));
		}

		result.push(temp);
	}

	return result;
}

//残兵士table追加
function appendRestTable(container, atData, dfData) {
	var table = document.createElement("table");
	container.appendChild(table);
	table.id = "restSoldier";
	table.className = "tables";

	table.innerHTML =
		'<tr>'+
			'<th class="attacker" style="background-color:lawngreen;">残兵士合計</th>'+
			'<th class="attackerBase" style="background-color:lawngreen;" colspan="13"></th>'+
		'</tr>'+
		'<tr>'+
			'<th class="blank"> </th>'+
			'<th class="solClass">剣兵</th>'+
			'<th class="solClass">槍兵</th>'+
			'<th class="solClass">弓兵</th>'+
			'<th class="solClass">騎兵</th>'+
			'<th class="solClass">矛槍兵</th>'+
			'<th class="solClass">弩兵</th>'+
			'<th class="solClass">近衛騎兵</th>'+
			'<th class="solClass">斥候</th>'+
			'<th class="solClass">斥候騎兵</th>'+
			'<th class="solClass">衝車</th>'+
			'<th class="solClass">投石機</th>'+
			'<th class="solClass">合計</th>'+
		'</tr>'+
		'<tr>'+
			'<th class="blank">攻撃者</th>'+
			'<td id="restAttacker0"></td>'+
			'<td id="restAttacker1"></td>'+
			'<td id="restAttacker2"></td>'+
			'<td id="restAttacker3"></td>'+
			'<td id="restAttacker4"></td>'+
			'<td id="restAttacker5"></td>'+
			'<td id="restAttacker6"></td>'+
			'<td id="restAttacker7"></td>'+
			'<td id="restAttacker8"></td>'+
			'<td id="restAttacker9"></td>'+
			'<td id="restAttacker10"></td>'+
			'<td id="restAttackerTotal"></td>'+
		'</tr>'+
		'<tr>'+
			'<th class="blank">防御者</th>'+
			'<td id="restDefender0"></td>'+
			'<td id="restDefender1"></td>'+
			'<td id="restDefender2"></td>'+
			'<td id="restDefender3"></td>'+
			'<td id="restDefender4"></td>'+
			'<td id="restDefender5"></td>'+
			'<td id="restDefender6"></td>'+
			'<td id="restDefender7"></td>'+
			'<td id="restDefender8"></td>'+
			'<td id="restDefender9"></td>'+
			'<td id="restDefender10"></td>'+
			'<td id="restDefenderTotal"></td>'+
		'</tr>';

	//各項目設定
	var rowKey = new Array("restAttacker", "restDefender");
	var allData = new Array(atData, dfData);
	for (var i = 0; i < rowKey.length; i++) {
		if (allData[i] == undefined) break;
		var restArray = new Array();

		for (var col = 0; col < 11; col++) {
			if (allData[i][0] == undefined || allData[i][1] == undefined) {
				restArray[col] = NaN;
			} else {
				restArray[col] = allData[i][0][col] - allData[i][1][col];
			}
			var field = document.getElementById(rowKey[i] + col);
			field.innerHTML = convDispNum(restArray[col]);
		}

		var totalField = document.getElementById(rowKey[i] + "Total");
		totalField.innerHTML = convDispNum(totalSoldiers(restArray));
	}
}

//死傷者table追加
function appendLossTable(container, atData, dfData) {
	var table = document.createElement("table");
	container.appendChild(table);
	table.id = "lossSoldier";
	table.className = "tables";

	table.innerHTML =
		'<tr>'+
			'<th class="attacker" style="background-color:lawngreen;">死傷者合計</th>'+
			'<th class="attackerBase" style="background-color:lawngreen;" colspan="13"></th>'+
		'</tr>'+
		'<tr>'+
			'<th class="blank"> </th>'+
			'<th class="solClass">剣兵</th>'+
			'<th class="solClass">槍兵</th>'+
			'<th class="solClass">弓兵</th>'+
			'<th class="solClass">騎兵</th>'+
			'<th class="solClass">矛槍兵</th>'+
			'<th class="solClass">弩兵</th>'+
			'<th class="solClass">近衛騎兵</th>'+
			'<th class="solClass">斥候</th>'+
			'<th class="solClass">斥候騎兵</th>'+
			'<th class="solClass">衝車</th>'+
			'<th class="solClass">投石機</th>'+
			'<th class="solClass">合計</th>'+
		'</tr>'+
		'<tr>'+
			'<th class="blank">攻撃者</th>'+
			'<td id="lossAttacker0"></td>'+
			'<td id="lossAttacker1"></td>'+
			'<td id="lossAttacker2"></td>'+
			'<td id="lossAttacker3"></td>'+
			'<td id="lossAttacker4"></td>'+
			'<td id="lossAttacker5"></td>'+
			'<td id="lossAttacker6"></td>'+
			'<td id="lossAttacker7"></td>'+
			'<td id="lossAttacker8"></td>'+
			'<td id="lossAttacker9"></td>'+
			'<td id="lossAttacker10"></td>'+
			'<td id="lossAttackerTotal"></td>'+
		'</tr>'+
		'<tr>'+
			'<th class="blank">防御者</th>'+
			'<td id="lossDefender0"></td>'+
			'<td id="lossDefender1"></td>'+
			'<td id="lossDefender2"></td>'+
			'<td id="lossDefender3"></td>'+
			'<td id="lossDefender4"></td>'+
			'<td id="lossDefender5"></td>'+
			'<td id="lossDefender6"></td>'+
			'<td id="lossDefender7"></td>'+
			'<td id="lossDefender8"></td>'+
			'<td id="lossDefender9"></td>'+
			'<td id="lossDefender10"></td>'+
			'<td id="lossDefenderTotal"></td>'+
		'</tr>';

	//各項目設定
	var rowKey = new Array("lossAttacker", "lossDefender");
	var allData = new Array(atData, dfData);
	for (var i = 0; i < rowKey.length; i++) {
		if (allData[i] == undefined) break;

		var lossArray;
		if (allData[i][1] == undefined) {
			lossArray = new Array();
		} else {
			lossArray = allData[i][1];
		}

		for (var col = 0; col < 11; col++) {
			var field = document.getElementById(rowKey[i] + col);
			field.innerHTML = convDispNum(lossArray[col]);
		}

		var totalField = document.getElementById(rowKey[i] + "Total");
		totalField.innerHTML = convDispNum(totalSoldiers(lossArray));
	}
}

//兵士合計（ポイント換算）
function totalSoldiers(soldiers) {
	if (soldiers == undefined || soldiers.length == 0) return NaN;
	var result = 0;

	//剣兵
	result += soldiers[0];

	//下級兵
	for (var i = 1; i <= 3; i++) {result += soldiers[i] * 2;}

	//上級兵
	for (var i = 4; i <= 6; i++) {result += soldiers[i] * 4;}

	//斥候
	result += soldiers[7];
	result += soldiers[8] * 2;

	//攻城兵器
	result += soldiers[9] * 2;
	result += soldiers[10] * 4;

	return result;
}

//ログデータ永続保存
function saveLogData(logId, logData) {
	var logDataStr = new Array();
	logDataStr[IDX_SUBJECT] = logData[IDX_SUBJECT]; //件名
	logDataStr[IDX_DATE] = logData[IDX_DATE]; //ログ時刻

	//攻撃者・防御者
	logDataStr[IDX_ACTOR] = new Array();
	if (logData[IDX_ACTOR].length > 0) {
		logDataStr[IDX_ACTOR][0] =
			genDelimitString_6(logData[IDX_ACTOR][0], DELIMIT3_6); //攻撃者
		logDataStr[IDX_ACTOR][1] =
			genDelimitString_6(logData[IDX_ACTOR][1], DELIMIT3_6); //防御者
	}
	logDataStr[IDX_ACTOR] =
		genDelimitString_6(logDataStr[IDX_ACTOR], DELIMIT2_6);

	//兵士数
	logDataStr[IDX_SOLDIER_COUNT] = new Array();
	for (var i = 0; i < logData[IDX_SOLDIER_COUNT].length; i++) {
		logDataStr[IDX_SOLDIER_COUNT][i] = new Array();
		if (logData[IDX_SOLDIER_COUNT][i] == undefined) continue;
		for (var j = 0; j < logData[IDX_SOLDIER_COUNT][i].length; j++) {
			logDataStr[IDX_SOLDIER_COUNT][i][j] = new Array();
			for (var k = 0; k < logData[IDX_SOLDIER_COUNT][i][j].length ; k++) {
				logDataStr[IDX_SOLDIER_COUNT][i][j][k] =
					convDispNum(logData[IDX_SOLDIER_COUNT][i][j][k]);
			}
		}
		logDataStr[IDX_SOLDIER_COUNT][i] =
			genDelimitString_6(logDataStr[IDX_SOLDIER_COUNT][i], DELIMIT3_6);
	}
	logDataStr[IDX_SOLDIER_COUNT] =
		genDelimitString_6(logDataStr[IDX_SOLDIER_COUNT], DELIMIT2_6);

	//ログデータ本体をGreasemonkey領域へ永続保存
	GM_setValue(generateLogKey(logId), genDelimitString_6(logDataStr, DELIMIT_6))

	//ログインデックスに追加
	addIndex(location.hostname + "_log_index", logId, ",");

	//拠点インデックスに追加
	if (logData[IDX_ACTOR].length > 0) {
		var nameUpdate = false;
		var names = splitDelimited_6(
			GM_getValue(location.hostname + "_village_name", ""), DELIMIT_6);

		for (var i = 0; i < logData[IDX_ACTOR].length; i++) {
			var actorId = logData[IDX_ACTOR][i][IDX2_VILLAGE_ID];
			var actorName = logData[IDX_ACTOR][i][IDX2_VILLAGE_NAME];

			//拠点ID-ログIDインデックスに追加
			addIndex(generateVillageKey(actorId), logId, ",");

			//拠点ID-拠点名インデックスに追加
			if (actorName != "") {
				var nameExists = false;
				for (var j = 0; j < names.length; j++) {
					var item = splitDelimited_6(names[j], DELIMIT2_6);
					if (item[0] == actorId) {
						if (item[1] == actorName) {
							nameExists = true;
						}
						break;
					}
				}
				if (!nameExists) {
					nameUpdate = true;
					names[j] = actorId + DELIMIT2_6 + actorName;
				}
			}
		}

		//拠点名-拠点IDインデックスをGreasemonkey領域へ永続保存
		if (nameUpdate) {
			GM_setValue(location.hostname + "_village_name", genDelimitString_6(names, DELIMIT_6));
		}
	}
}

//インデックス追加
function addIndex(key, value, delimiter) {
	var items = splitDelimited_6(GM_getValue(key, ""), delimiter);

	if (items.indexOf(value) == -1) {
		items.push(value);

		//Greasemonkey領域へ永続保存
		GM_setValue(key, genDelimitString_6(items, delimiter));
	}
}

//ログデータ読み出し
function loadLogData(logId) {
	var result = splitDelimited_6(GM_getValue(generateLogKey(logId), ""), DELIMIT_6);
	if (result.length == 0) return result;

	//攻撃者・防御者
	result[IDX_ACTOR] = splitDelimited_6(result[IDX_ACTOR], DELIMIT2_6);
	for (var i = 0; i < result[IDX_ACTOR].length; i++) {
		result[IDX_ACTOR][i] = splitDelimited_6(result[IDX_ACTOR][i], DELIMIT3_6);
	}

	//兵士数
	result[IDX_SOLDIER_COUNT] = splitDelimited_6(result[IDX_SOLDIER_COUNT], DELIMIT2_6);
	for (var i = 0; i < result[IDX_SOLDIER_COUNT].length; i++) {
		result[IDX_SOLDIER_COUNT][i] =
			splitDelimited_6(result[IDX_SOLDIER_COUNT][i], DELIMIT3_6);
		for (var j = 0; j < result[IDX_SOLDIER_COUNT][i].length; j++) {
			result[IDX_SOLDIER_COUNT][i][j] =
				splitDelimited_6(result[IDX_SOLDIER_COUNT][i][j], ",");
			for (var k = 0; k < result[IDX_SOLDIER_COUNT][i][j].length; k++) {
				result[IDX_SOLDIER_COUNT][i][j][k] =
					parseInt(result[IDX_SOLDIER_COUNT][i][j][k]);
			}
		}
	}

	return result;
}

//未読チェック
function checkAlreadyRead() {
	var logs = splitDelimited_6(GM_getValue(location.hostname + "_log_index", ""), ",");

	var rowElems = document.evaluate(
		'//*[@id="gray02Wrapper"]/div/div/table/tbody/tr/td[1]',
		document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	for (var i = 0; i < rowElems.snapshotLength; i++) {
		var field = rowElems.snapshotItem(i);
		var link = document.evaluate('./a', field, null,
			XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0);
		var id = getParameter2_6(link.href, "id");
		if (logs.indexOf(id) == -1) {
			field.innerHTML += " [未]";
		}
	}
}

//拠点に関係する最新ログへのリンクを追加
function appendNewestLogLink() {

	//拠点名を取得
	var baseNameElem = document.evaluate(
		'//*[@id="basepoint"]/span[@class="basename"]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	var baseName = trim_6(baseNameElem.snapshotItem(0).innerHTML);

	//拠点ID取得
	var villageId = "";
	var names = splitDelimited_6(
		GM_getValue(location.hostname + "_village_name", ""), DELIMIT_6);
	for (var j = 0; j < names.length; j++) {
		var item = splitDelimited_6(names[j], DELIMIT2_6);
		if (item[1] == baseName) {
			villageId = item[0];
			break;
		}
	}

	//最新ログのID取得
	var logId = "";
	var names = new Array();
	if (villageId != "") {
		var logs = loadLogIndex(villageId);
		if (logs.length > 0) {
			logs.sort().reverse();
			logId = "" + logs[0];
		}
	}

	//リンクHTML追加
	if (logId != "") {
		var statusElem = document.evaluate('//*[@id="basepoint"]/div[@class="status"]',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0);

		if(!statusElem){var statusElem = document.evaluate('//*[@id="basepoint"]/div[@class="status village-bottom"]',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0);
		}

		var sepElem = document.createElement("span");
		statusElem.appendChild(sepElem);
		sepElem.className = "sep";
		sepElem.style.margin = "4px";
		sepElem.innerHTML = "|";

		var linkElem = document.createElement("a");
		statusElem.appendChild(linkElem);
		linkElem.href = "/alliance/detail.php?id=" + logId;
		linkElem.style.margin = "4px";
		linkElem.innerHTML = "最新ログ";
	}
}

//ログインデックス取得
function loadLogIndex(villageId) {
	var logs = splitDelimited_6(GM_getValue(generateVillageKey(villageId), ""), ",");
	for (var i = 0; i < logs.length; i++) logs[i] = parseInt(logs[i]);
	return logs;
}


//ログデータキー生成
function generateLogKey(logId) {
	return location.hostname + "_log_" + logId;
}
//拠点データキー生成
function generateVillageKey(villageId) {
	return location.hostname + "_village_" + villageId;
}

//数値を表示用に変換
function convDispNum(value) {
	if (isNaN(value)) {
		return "?";
	} else {
		return "" + value;
	}
}

//URLパラメータ取得
function getParameter_6(key) {
	return getParameter2_6(location.search, key);
}

//URLパラメータ取得
function getParameter2_6(url, key) {
	var str = url.replace(/#.*$/, "").split("?");
	if (str.length < 2) {
		return "";
	}

	var params = str[1].split("&");
	for (var i = 0; i < params.length; i++) {
		var keyVal = params[i].split("=");
		if (keyVal[0] == key && keyVal.length == 2) {
			return decodeURIComponent(keyVal[1]);
		}
	}
	return "";
}

//デリミタ区切り文字列生成
function genDelimitString_6(dataArray, delimiter) {
	var ret = "";
	if (dataArray == undefined) return ret;

	for (var i=0; i < dataArray.length; i++) {
		if (dataArray[i] != undefined) ret += dataArray[i];
		if (i < dataArray.length-1) ret += delimiter;
	}
	return ret;
}

//デリミタ区切り文字列を配列に変換
function splitDelimited_6(str, delimiter) {
	if (str == undefined || str == "") {
		return new Array();
	} else {
		return str.split(delimiter);
	}
}

//空白除去
function trim_6(str) {
	return str.replace(/^[ 　\t\r\n]+|[ 　\t\r\n]+$/g, "");
}

//Google Chrome用GM_*系ラッパー関数
function initGMWrapper_6() {

	// @copyright	  2009, James Campos
	// @license		cc-by-3.0; http://creativecommons.org/licenses/by/3.0/
	if ((typeof GM_getValue == 'undefined') || (GM_getValue('a', 'b') == undefined)) {
		GM_addStyle = function(css) {
			var style = document.createElement('style');
			style.textContent = css;
			document.getElementsByTagName('head')[0].appendChild(style);
		}

		GM_deleteValue = function(name) {
			localStorage.removeItem(LOCAL_STORAGE_6 + "." + name);
		}

		GM_getValue = function(name, defaultValue) {
			var value = localStorage.getItem(LOCAL_STORAGE_6 + "." + name);
			if (!value)
				return defaultValue;
			var type = value[0];
			value = value.substring(1);
			switch (type) {
				case 'b':
					return value == 'true';
				case 'n':
					return Number(value);
				default:
					return value;
			}
		}

		GM_log = function(message) {
			console.log(message);
		}

		GM_setValue = function(name, value) {
			value = (typeof value)[0] + value;
			try {
				localStorage.setItem(LOCAL_STORAGE_6 + "." + name, value);
			} catch (e) {
				alert("localStorageへの保存に失敗 (" + e + ")");
				throw e;
			}
		}
	}
}
//faraway 6.同盟ログツールのソース(bro3_log_tool.user.js)終了

function bro3_atk_calc(){
	d = document;
	//j$ = unsafeWindow.jQuery;
	jQuery.noConflict();
	j$ = jQuery;
	HOST = location.hostname;
	server = HOST.split(".")[0];	//ｻｰﾊﾞ名
	PATHNAME = location.pathname;	//ﾌｧｲﾙﾊﾟｽ名

	//現在表示URL
	NowUrl = URLGet();

	//同盟ｽｷﾙﾌﾗｸﾞ
	var AlliSkilFlg = GM_getValue(server + "_alliskilflg", 0);
	//全軍ｽｷﾙﾌﾗｸﾞ
	var AFFlg = GM_getValue(server + "_afflg", 0);
	var AFNum = parseFloat(GM_getValue(server + "_afnum", 0));


	//ﾃﾞｯｷｾｯﾄ済みClass取得
	if (NowUrl == "busyobook_card.php") {
		var deckSet_ctl = j$(".busyo-card");
	} else if(NowUrl == "deck.php"){
		var deckSet_ctl = j$(".cardColmn");

		//設定ﾘﾝｸ追加
		j$("#statMenu").find("li").eq(9).removeClass("last");
		var a1 = j$("<a/>");
		a1.attr("id", "initlink");
		a1.attr("href", "javascript:void(0);");
		a1.append("スキル込計算設定");
		var li1 = j$("<li/>");
		li1.attr("class", "last");
		li1.append(a1);
		j$("#statMenu").append(li1);

		j$("#initlink").live("click", function(){
			ac_Init_Proc();
		});

	} else{
		return;
	}


	//○枚目ｶｳﾝﾄ用
	var cardcnt = 0;
	//ﾃﾞｯｷｾｯﾄ済ｶｳﾝﾄ用
	var deckcnt = 0;

	var skil1 = new Array();	//ｽｷﾙ1効果
	var skil2 = new Array();	//ｽｷﾙ2効果
	var skil3 = new Array();	//ｽｷﾙ3効果
	var skil4 = new Array();	//ｽｷﾙ4効果
	var skilcnt1 = 0;
	var skilcnt2 = 0;
	var skilcnt3 = 0;
	var skilcnt4 = 0;

	var card_type = new Array();	//兵科

	/*=====================================
	 * 変更前ｽﾃｰﾀｽ
	 *====================================*/
	var card_att = new Array();		//攻撃力
	var card_int = new Array();		//知力
	var card_wdef = new Array();	//歩防御
	var card_sdef = new Array();	//槍防御
	var card_bdef = new Array();	//弓防御
	var card_rdef = new Array();	//馬防御
	var card_speed = new Array();	//移動速度


	//ｶｰﾄﾞ裏情報取得用
	var deck_CBack = j$(".card_back_extra");

	//同盟ｽｷﾙ上昇率
	var alliance1 = 0;
	var alliance2 = 0;
	var alliurl = "/alliance/alliance_skill.php";
	if (AlliSkilFlg == 1) {
		j$.ajax({
			url: alliurl,
			cache: false,
			async: false,
			success: function(r){
				var re1 = /\d+(?:\.\d+)?[%%%]?/;	//ｽｷﾙ効果(小数点含む)
				var wk = j$(r).find(".ttl4" + ".center");

				if (wk.length > 0) {
					wk1 = String(wk.eq(1).html().match(re1));
					if (wk1 != "null") {
						alliance2 = parseFloat(wk1.substring(0, (wk1.length - 1))) / 100;
					} else {
						alliance2 = 0;
					}
					wk2 = String(wk.eq(2).html().match(re1));
					if (wk2 != "null") {
						alliance1 = parseFloat(wk2.substring(0, (wk2.length - 1))) / 100;
					} else {
						alliance1 = 0;
					}
				}
			}
		});
	}


	/*=======================================================
	   表示関連 初期処理
	=========================================================*/
	//ﾃﾞｯｷｾｯﾄ済＆ｶｰﾄﾞ表示用
	for (i = 0; i < deckSet_ctl.length; i++) {
		html = SkilSet(i);

		deckSet_ctl.eq(i).prepend(html);

		//ｽｷﾙ選択ｺﾝﾎﾞﾎﾞｯｸｽ 処理追加
		j$("#deckSkil" + i).live("change", function(){
			SkilSelect(this.className);
		});
		//ﾊﾟｯｼﾌﾞ用ﾁｪｯｸﾎﾞｯｸｽ 処理追加
		j$("#p_chk" + i).live("click", function(){
			SkilSelect(this.className);
		});
		//攻撃課金用ﾁｪｯｸﾎﾞｯｸｽ 処理追加
		j$("#kakinAtt" + i).live("click", function(){
			SkilSelect(this.className);
		});
		//防御課金用ﾁｪｯｸﾎﾞｯｸｽ 処理追加
		j$("#kakinDef" + i).live("click", function(){
			SkilSelect(this.className);
		});

		cardcnt = cardcnt + 1;
		deckcnt = i;
	}

	//ｶｰﾄﾞ表示以外の場合
	var sortflg = j$(".sortTotal");
	if (sortflg.eq(0).val() != 1) {
		var othercard = j$(".statusDetail");
		var stscard = j$(".statusDetail");
		var wk = j$(".cardStatusDetail");

		if (cardcnt == 0) {
			deckcnt = -1;
		}

		for (i = 0; i < othercard.length; i++) {
			wk.eq(i).css("margin-bottom", "45px");
			html = SkilSet(i + deckcnt + 1);

			othercard.eq(i).prepend(html);

			//ｽｷﾙ選択ｺﾝﾎﾞﾎﾞｯｸｽ 処理追加
			j$("#deckSkil" + (i + deckcnt + 1)).live("change", function(){
				SkilSelect(this.className);
			});
			//ﾊﾟｯｼﾌﾞ用ﾁｪｯｸﾎﾞｯｸｽ 処理追加
			j$("#p_chk" + (i + deckcnt + 1)).live("click", function(){
				SkilSelect(this.className);
			});
			//攻撃課金用ﾁｪｯｸﾎﾞｯｸｽ 処理追加
			j$("#kakinAtt" + (i + deckcnt + 1)).live("click", function(){
				SkilSelect(this.className);
			});
			//防御課金用ﾁｪｯｸﾎﾞｯｸｽ 処理追加
			j$("#kakinDef" + (i + deckcnt + 1)).live("click", function(){
				SkilSelect(this.className);
			});

			cardcnt = cardcnt + 1;
		}
	}


	/*------------+---------------------------------------------------------+
	 * ｽｷﾙ取得＆ｺﾝﾎﾞﾎﾞｯｸｽ作成処理											|
	 *------------+---------------------------------------------------------+
	 * cnt		  | ｶｰﾄﾞ取得用ｶｳﾝﾄ											|
	 *------------+---------------------------------------------------------+
	 * 戻り値	  | 														|
	 *------------+---------------------------------------------------------*/
	function SkilSet(cnt) {
		var passiveFlg1 = 0;	//ﾊﾟｯｼﾌﾞ有無ﾌﾗｸﾞ
		var passiveFlg2 = 0;	//ﾊﾟｯｼﾌﾞ有無ﾌﾗｸﾞ
		var passiveFlg3 = 0;	//ﾊﾟｯｼﾌﾞ有無ﾌﾗｸﾞ
		var passiveFlg4 = 0;	//ﾊﾟｯｼﾌﾞ有無ﾌﾗｸﾞ

		//ｽｷﾙ名(Lv込)取得
		var skilname1 = j$(".skillName1" + ".skill_name").eq(cnt).html();
		var wkskil1 = j$(".skill1").eq(cnt).html();
		if (deck_CBack.eq(cnt).html().indexOf("skillName1 skill_name red") != -1 && skilname1 != "") {
			//ﾊﾟｯｼﾌﾞの場合
			passiveFlg1 = 1;
			skil1[cardcnt] = wkskil1;
			skilcnt1 = skilcnt1 + 1;
		} else if (deck_CBack.eq(cnt).html().indexOf("skillName1 skill_name") != -1 && skilname1 != "") {
			//通常ｽｷﾙの場合
			skil1[cardcnt] = wkskil1;
			skilcnt1 = skilcnt1 + 1;
		} else {
			//ｽｷﾙ無しの場合
			skil1[cardcnt] = "";
			skilcnt1 = skilcnt1 + 1;
		}

		var skilname2 = j$(".skillName2" + ".skill_name").eq(cnt).html();
		var wkskil2 = j$(".skill2").eq(cnt).html();
		if (deck_CBack.eq(cnt).html().indexOf("skillName2 skill_name red") != -1 && skilname2 != "") {
			//ﾊﾟｯｼﾌﾞの場合
			passiveFlg2 = 1;
			skil2[cardcnt] = wkskil2;
			skilcnt2 = skilcnt2 + 1;
		} else if (deck_CBack.eq(cnt).html().indexOf("skillName2 skill_name") != -1 && skilname2 != "") {
			//通常ｽｷﾙの場合
			skil2[cardcnt] = wkskil2;
			skilcnt2 = skilcnt2 + 1;
		} else {
			//ｽｷﾙ無しの場合
			skil2[cardcnt] = "";
			skilcnt2 = skilcnt2 + 1;
		}

		var skilname3 = j$(".skillName3" + ".skill_name").eq(cnt).html();
		var wkskil3 = j$(".skill3").eq(cnt).html();
		if (deck_CBack.eq(cnt).html().indexOf("skillName3 skill_name red") != -1 && skilname3 != "") {
			//ﾊﾟｯｼﾌﾞの場合
			passiveFlg3 = 1;
			skil3[cardcnt] = wkskil3;
			skilcnt3 = skilcnt3 + 1;
		} else if (deck_CBack.eq(cnt).html().indexOf("skillName3 skill_name") != -1 && skilname3 != "") {
			//通常ｽｷﾙの場合
			skil3[cardcnt] = wkskil3;
			skilcnt3 = skilcnt3 + 1;
		} else {
			//ｽｷﾙ無しの場合
			skil3[cardcnt] = "";
			skilcnt3 = skilcnt3 + 1;
		}

		if (deck_CBack.eq(cnt).html().indexOf("skillName4 skill_name red") != -1) {
			//ﾊﾟｯｼﾌﾞの場合
			var skilname4 = j$(".skillName4" + ".skill_name").eq(skilcnt4).html();
			var wkskil4 = j$(".skill4").eq(skilcnt4).html();
			passiveFlg4 = 1;
			skil4[cardcnt] = wkskil4;
			skilcnt4 = skilcnt4 + 1;
		} else if (deck_CBack.eq(cnt).html().indexOf("skillName4 skill_name") != -1) {
			//通常ｽｷﾙの場合
			var skilname4 = j$(".skillName4" + ".skill_name").eq(skilcnt4).html();
			var wkskil4 = j$(".skill4").eq(skilcnt4).html();
			skil4[cardcnt] = wkskil4;
			skilcnt4 = skilcnt4 + 1;
		} else {
			//ｽｷﾙ無しの場合
			var skilname4 = "";
			skil4[cardcnt] = "";
		}

		//兵科取得
		str = j$("span[class=soltype]").eq(cardcnt).find("img").attr("alt");
		if (str == "剣兵") {
			card_type[cardcnt] = "歩兵";
		} else {
			card_type[cardcnt] = str;
		}

		/*=====================================
		 * 変更前ｽﾃｰﾀｽ取得
		 *====================================*/
		card_att[cardcnt] = j$(".status_att").eq(cardcnt).html();		//攻撃力
		card_int[cardcnt] = j$(".status_int").eq(cardcnt).html();		//知力
		card_wdef[cardcnt] = j$(".status_wdef").eq(cardcnt).html();		//歩防御
		card_sdef[cardcnt] = j$(".status_sdef").eq(cardcnt).html();		//槍防御
		card_bdef[cardcnt] = j$(".status_bdef").eq(cardcnt).html();		//弓防御
		card_rdef[cardcnt] = j$(".status_rdef").eq(cardcnt).html();		//馬防御
		card_speed[cardcnt] = j$(".status_speed").eq(cardcnt).html();		//移動速度

		//ｺﾝﾎﾞﾎﾞｯｸｽ作成
		var div1 = j$("<div/>");
		div1.attr("style", "height:30px;width:220px;display:table;display:table-cell;vertical-align:middle;margin:auto;");

		var select1 = j$('<select/>');
		select1.attr("name", "deckSkil" + cnt);
		select1.attr("style", "width:200px;");
		select1.attr("id", "deckSkil" + cnt);
		select1.attr("class", cnt);

		var opt0 = j$('<option value="0">指定無し</option>');
		select1.append(opt0);
		if (alliance1 != "" || alliance2 != "") {
			opt0 = j$('<option value="10">指定無し(同盟ｽｷﾙ込)</option>');
			select1.append(opt0);
		}
		if (AFFlg == 1) {
			opt0 = j$('<option value="100">指定無し(全軍ｽｷﾙ込)</option>');
			select1.append(opt0);
		}
		if ((alliance1 != "" || alliance2 != "") && AFFlg == 1) {
			opt0 = j$('<option value="110">指定無し(同盟ｽｷﾙ&全軍ｽｷﾙ込)</option>');
			select1.append(opt0);
		}

		if (skilname1.replace(/\s+/g, "") != "" && passiveFlg1 == 0) {
			var opt1 = j$('<option value="1">' + skilname1.substring(2) + '</option>');
			select1.append(opt1);
			if (alliance1 != "" || alliance2 != "") {
				opt1 = j$('<option value="11">' + skilname1.substring(2) + '(同盟ｽｷﾙ込)</option>');
				select1.append(opt1);
			}
			if (AFFlg == 1) {
				opt1 = j$('<option value="101">' + skilname1.substring(2) + '(全軍ｽｷﾙ込)</option>');
				select1.append(opt1);
			}
			if ((alliance1 != "" || alliance2 != "") && AFFlg == 1) {
				opt1 = j$('<option value="111">' + skilname1.substring(2) + '(同盟ｽｷﾙ&全軍ｽｷﾙ込)</option>');
				select1.append(opt1);
			}
		}
		if (skilname2.replace(/\s+/g, "") != "" && passiveFlg2 == 0) {
			var opt2 = j$('<option value="2">' + skilname2.substring(2) + '</option>');
			select1.append(opt2);
			if (alliance1 != "" || alliance2 != "") {
				opt2 = j$('<option value="12">' + skilname2.substring(2) + '(同盟ｽｷﾙ込)</option>');
				select1.append(opt2);
			}
			if (AFFlg == 1) {
				opt2 = j$('<option value="102">' + skilname2.substring(2) + '(全軍ｽｷﾙ込)</option>');
				select1.append(opt2);
			}
			if ((alliance1 != "" || alliance2 != "") && AFFlg == 1) {
				opt2 = j$('<option value="112">' + skilname2.substring(2) + '(同盟ｽｷﾙ&全軍ｽｷﾙ込)</option>');
				select1.append(opt2);
			}
		}
		if (skilname3.replace(/\s+/g, "") != "" && passiveFlg3 == 0) {
			var opt3 = j$('<option value="3">' + skilname3.substring(2) + '</option>');
			select1.append(opt3);
			if (alliance1 != "" || alliance2 != "") {
				opt3 = j$('<option value="13">' + skilname3.substring(2) + '(同盟ｽｷﾙ込)</option>');
				select1.append(opt3);
			}
			if (AFFlg == 1) {
				opt3 = j$('<option value="103">' + skilname3.substring(2) + '(全軍ｽｷﾙ込)</option>');
				select1.append(opt3);
			}
			if ((alliance1 != "" || alliance2 != "") && AFFlg == 1) {
				opt3 = j$('<option value="113">' + skilname3.substring(2) + '(同盟ｽｷﾙ&全軍ｽｷﾙ込)</option>');
				select1.append(opt3);
			}
		}
		if (skilname4.replace(/\s+/g, "") != "" && passiveFlg4 == 0) {
			var opt4 = j$('<option value="4">' + skilname4.substring(2) + '</option>');
			select1.append(opt4);
			if (alliance1 != "" || alliance2 != "") {
				opt4 = j$('<option value="14">' + skilname4.substring(2) + '(同盟ｽｷﾙ込)</option>');
				select1.append(opt4);
			}
			if (AFFlg == 1) {
				opt4 = j$('<option value="104">' + skilname4.substring(2) + '(全軍ｽｷﾙ込)</option>');
				select1.append(opt4);
			}
			if ((alliance1 != "" || alliance2 != "") && AFFlg == 1) {
				opt4 = j$('<option value="114">' + skilname4.substring(2) + '(同盟ｽｷﾙ&全軍ｽｷﾙ込)</option>');
				select1.append(opt4);
			}
		}

		var chk1 = j$('<input type="checkbox"/>');
		chk1.attr("id", "p_chk" + cnt);
		chk1.attr("class", cnt);
		if (passiveFlg1 == 0 && passiveFlg2 == 0 && passiveFlg3 == 0 && passiveFlg4 == 0) {
			chk1.attr("disabled", "disabled");
		}
		var str1 = j$("<span/>");
		str1.text("パッシブ　");

		var chk2 = j$('<input type="checkbox"/>');
		chk2.attr("id", "kakinAtt" + cnt);
		chk2.attr("class", cnt);
		var str2 = j$("<span/>");
		str2.text("攻撃課金　");

		var chk3 = j$('<input type="checkbox"/>');
		chk3.attr("id", "kakinDef" + cnt);
		chk3.attr("class", cnt);
		var str3 = j$("<span/>");
		str3.text("防御課金");

		div1.append(select1).append("<br />").append(chk1).append(str1).append(chk2).append(str2).append(chk3).append(str3);

		return div1;
	}

	/*------------+---------------------------------------------------------+
	 * ｽｷﾙ選択後処理														|
	 *------------+---------------------------------------------------------+
	 * l		  | 選択ｺﾝﾎﾞﾎﾞｯｸｽ番号										|
	 *------------+---------------------------------------------------------+
	 * 戻り値	  | 														|
	 *------------+---------------------------------------------------------*/
	function SkilSelect(l) {
		var val = j$("#deckSkil" + l).val();
		var passiveFlg = j$("#p_chk" + l).attr("checked");
		var kakinFlg = j$("#kakinAtt" + l).attr("checked");
		var kakinFlg2 = j$("#kakinDef" + l).attr("checked");
		var alliFlg = 0;
		var AFSkilFlg = 0;

		var skil_res = "";

		if (val >= 100) {
			//全軍S使用
			val = val - 100;
			AFSkilFlg = 1;
		}
		if (val >= 10) {
			//同盟S使用
			val = val - 10;
			alliFlg = 1;
		}

		if (val == 1) {
			skil_res = skil1[l];
		} else if (val == 2) {
			skil_res = skil2[l];
		} else if (val == 3) {
			skil_res = skil3[l];
		} else if (val == 4) {
			skil_res = skil4[l];
		}

		//ﾌﾗｸﾞが無ければｽﾃｰﾀｽALLｸﾘｱし抜ける
		if (skil_res == "" && passiveFlg == false && kakinFlg == false && kakinFlg2 == false && alliFlg == 0 && AFSkilFlg == 0) {
			j$(".status_att").eq(l).html(card_att[l]);		//攻撃力
			j$(".status_int").eq(l).html(card_int[l]);		//知力
			j$(".status_wdef").eq(l).html(card_wdef[l]);		//歩防御
			j$(".status_sdef").eq(l).html(card_sdef[l]);		//槍防御
			j$(".status_bdef").eq(l).html(card_bdef[l]);		//弓防御
			j$(".status_rdef").eq(l).html(card_rdef[l]);		//馬防御
			j$(".status_speed").eq(l).html(card_speed[l]);		//移動速度

			//ｶｰﾄﾞ表示以外の場合
			if (deckcnt < l) {
				var sts_atk1 = j$(".statusParameter1");
				var sts_atk2 = sts_atk1.eq(l - deckcnt - 1).find("td");
				sts_atk2.eq(1).html(card_att[l]);
				sts_atk2.eq(3).html(card_int[l]);
				sts_atk2.eq(5).html(card_wdef[l]);
				sts_atk2.eq(7).html(card_sdef[l]);
				sts_atk2.eq(9).html(card_bdef[l]);
				sts_atk2.eq(11).html(card_rdef[l]);
				sts_atk2.eq(13).html(card_speed[l]);
			}

			return;
		}


		/*=====================================
		 * 正規表現用ｾｯﾄ
		 *====================================*/
		var re1 = /\d+(?:\.\d+)?[%%%]?/;	//ｽｷﾙ効果(小数点含む)
		var re2 = /\d+(?:\.\d+)?[％]?/;	//ｽｷﾙ効果(小数点含む)
		var re3 = /\d+(?:\.\d+)?/;	//ｽｷﾙ効果(小数点含む)

		/*=====================================
		 * 各上昇率用ｾｯﾄ
		 *====================================*/
		var wk_att_skil = 0;
		var wk_def_skil = 0;
		var wk_spe_skil = 0;

		var att_skilnum = 0;
		var def_skilnum = 0;
		var spd_skilnum = 0;

		var atk_kakinFlg = 0;
		var def_kakinFlg = 0;

		var housan_Flg = 0;

		if (passiveFlg == true) {
			//ﾊﾟｯｼﾌﾞ取得
			var p_skil = new Array();

			p_skil[0] = skil1[l];
			p_skil[1] = skil2[l];
			p_skil[2] = skil3[l];
			p_skil[3] = skil4[l];

			for (i = 0; i < 4; i++) {
				var wkskil_res = p_skil[i];

				wk_att_skil = 0;
				wk_def_skil = 0;
				wk_spe_skil = 0;

				wkcnt0 = wkskil_res.indexOf("自動");
				if (wkskil_res != "" && wkcnt0 > -1) {
					//攻撃力用
					wkcnt0 = wkskil_res.indexOf(")の武将1枚につき");
					if (wkcnt0 > -1) {
						wk_skil = wkskil_res.substring(wkcnt0 + 5);
						wk_att_skil = String(wk_skil.match(re2));
						wk_att_skil = parseFloat(wk_att_skil.substring(0, (wk_att_skil.length - 1))) / 100;
					} else {
						wkcnt0 = wkskil_res.indexOf("攻撃力");
						if (wkcnt0 > -1) {
							wkcnt1 = wkskil_res.indexOf("武将の攻撃力");
							if (wkcnt1 > -1) {
								wkcnt2 = wkskil_res.indexOf("兵科");
								if (wkcnt2 > -1) {
									wkcnt3 = wkskil_res.indexOf(card_type[l]);
									if (wkcnt3 > -1) {
										wk_skil = wkskil_res.substring(wkcnt3);
										wk_att_skil = String(wk_skil.match(re1));
										wk_att_skil = parseFloat(wk_att_skil.substring(0, (wk_att_skil.length - 1))) / 100;
									} else {
									}
								} else {
									wk_skil = wkskil_res.substring(wkcnt1);
									wk_att_skil = String(wk_skil.match(re1));
									wk_att_skil = parseFloat(wk_att_skil.substring(0, (wk_att_skil.length - 1))) / 100;
								}
							} else {
								wkcnt2 = wkskil_res.indexOf("兵科");
								if (wkcnt2 > -1) {
								} else {
									wk_skil = wkskil_res.substring(wkcnt0);
									wk_att_skil = String(wk_skil.match(re1));
									wk_att_skil = parseFloat(wk_att_skil.substring(0, (wk_att_skil.length - 1))) / 100;
								}
							}
						}
					}

					//防御力用
					wkcnt1 = wkskil_res.indexOf("武将の防御力");
					if (wkcnt1 > -1) {
						wkcnt2 = wkskil_res.indexOf("兵科");
						if (wkcnt2 > -1) {
							wkcnt3 = wkskil_res.indexOf(card_type[l]);
							if (wkcnt3 > -1) {
								wk_skil = wkskil_res.substring(wkcnt3);
								wk_def_skil = String(wk_skil.match(re1));
								wk_def_skil = parseFloat(wk_def_skil.substring(0, (wk_def_skil.length - 1))) / 100;
							}
						} else {
							wk_skil = wkskil_res.substring(wkcnt1);
							wk_def_skil = String(wk_skil.match(re1));
							wk_def_skil = parseFloat(wk_def_skil.substring(0, (wk_def_skil.length - 1))) / 100;
						}
					}

					//移速用
					wkcnt1 = wkskil_res.indexOf("移動速度");
					if (wkcnt1 > -1) {
						wkcnt2 = wkskil_res.indexOf("兵科");
						if (wkcnt2 > -1) {
							wkcnt3 = wkskil_res.indexOf(card_type[l]);
							if (wkcnt3 > -1) {
								wk_skil = wkskil_res.substring(wkcnt1);
								wk_spe_skil = String(wk_skil.match(re1));
								wk_spe_skil = parseFloat(wk_spe_skil.substring(0, (wk_spe_skil.length - 1))) / 100;
							}
						} else {
							wkcnt3 = wkskil_res.indexOf("移動速度が半分");
							if (wkcnt3 > -1) {
								wk_spe_skil = 99999;
							} else {
								wkcnt3 = wkskil_res.indexOf("移動速度が半減");
								if (wkcnt3 > -1) {
									wk_spe_skil = 99999;
								} else {
									wk_skil = wkskil_res.substring(wkcnt1);
									wk_spe_skil = String(wk_skil.match(re1));
									wk_spe_skil = parseFloat(wk_spe_skil.substring(0, (wk_spe_skil.length - 1))) / 100;
								}
							}
						}
					} else {
						wkcnt1 = wkskil_res.indexOf("移速");
						if (wkcnt1 > -1) {
							wkcnt2 = wkskil_res.indexOf("兵科");
							if (wkcnt2 > -1) {
								wkcnt3 = wkskil_res.indexOf(card_type[l]);
								if (wkcnt3 > -1) {
									wk_skil = wkskil_res.substring(wkcnt3);
									wk_spe_skil = String(wk_skil.match(re1));
									wk_spe_skil = parseFloat(wk_spe_skil.substring(0, (wk_spe_skil.length - 1))) / 100;
								}
							}
						}
					}
				}

				att_skilnum = att_skilnum + wk_att_skil;
				def_skilnum = def_skilnum + wk_def_skil;
				spd_skilnum = spd_skilnum + wk_spe_skil;
			}
		}
		if (kakinFlg == true) {
			atk_kakinFlg = 1;
		}
		if (kakinFlg2 == true) {
			def_kakinFlg = 1;
		}
		if (skil_res != "") {
			var wk_skil = "";
			var wkcnt0 = 0;
			var wkcnt1 = 0;
			var wkcnt2 = 0;
			var wkcnt3 = 0;

			wk_att_skil = 0;
			wk_def_skil = 0;
			wk_spe_skil = 0;

			//攻撃力用
			wkcnt0 = skil_res.indexOf(")の武将1枚につき");
			if (wkcnt0 > -1) {
				wkcnt1 = skil_res.indexOf("攻撃力");
				if (wkcnt1 > -1) {
					wk_skil = skil_res.substring(wkcnt0 + 5);
					wk_att_skil = String(wk_skil.match(re1));
					wk_att_skil = parseFloat(wk_att_skil.substring(0, (wk_att_skil.length - 1))) / 100;
				}
			} else {
				wkcnt0 = skil_res.indexOf("兵器の城・砦・村への攻撃");
				if (wkcnt0 > -1) {
					wkcnt2 = skil_res.indexOf("兵科");
					if (wkcnt2 > -1) {
						wkcnt3 = skil_res.indexOf(card_type[l]);
						if (wkcnt3 > -1) {
							wk_skil = skil_res.substring(wkcnt3);
							wk_att_skil = String(wk_skil.match(re1));
							wk_att_skil = parseFloat(wk_att_skil.substring(0, (wk_att_skil.length - 1))) / 100;
						}
					}
				} else {
					wkcnt0 = skil_res.indexOf("兵器を含む部隊の");
					if (wkcnt0 > -1) {
					} else {
						wkcnt0 = skil_res.indexOf("武将および全兵科の攻撃力");
						if (wkcnt0 > -1) {
							wk_skil = skil_res.substring(wkcnt0);
							wk_att_skil = String(wk_skil.match(re1));
							wk_att_skil = parseFloat(wk_att_skil.substring(0, (wk_att_skil.length - 1))) / 100;
						} else {
							wkcnt0 = skil_res.indexOf("近衛騎兵、矛槍兵、弩兵、投石機");
							if (wkcnt0 > -1) {
							} else {
								wkcnt0 = skil_res.indexOf("全ての兵、");
								if (wkcnt0 > -1) {
									wkcnt1 = skil_res.indexOf("武将の攻撃力");
									if (wkcnt1 > -1) {
										wk_skil = skil_res.substring(wkcnt1);
										wk_att_skil = String(wk_skil.match(re1));
										wk_att_skil = parseFloat(wk_att_skil.substring(0, (wk_att_skil.length - 1))) / 100;
									}
								} else {
									wkcnt0 = skil_res.indexOf("全兵科の兵士");
									if (wkcnt0 > -1) {
										wkcnt1 = skil_res.indexOf("武将の攻撃力");
										if (wkcnt1 > -1) {
											wk_skil = skil_res.substring(wkcnt1);
											wk_att_skil = String(wk_skil.match(re1));
											wk_att_skil = parseFloat(wk_att_skil.substring(0, (wk_att_skil.length - 1))) / 100;
										}
									} else {
										wkcnt0 = skil_res.indexOf("全ての兵士の攻撃力");
										if (wkcnt0 > -1) {
											wkcnt1 = skil_res.indexOf("武将の攻撃力");
											if (wkcnt1 > -1) {
												wk_skil = skil_res.substring(wkcnt1);
												wk_att_skil = String(wk_skil.match(re1));
												wk_att_skil = parseFloat(wk_att_skil.substring(0, (wk_att_skil.length - 1))) / 100;
											}
										} else {
											wkcnt0 = skil_res.indexOf("兵の攻撃力");
											if (wkcnt0 > -1) {
												wkcnt1 = skil_res.indexOf("武将の攻撃力");
												if (wkcnt1 > -1) {
													wk_skil = skil_res.substring(wkcnt1);
													wk_att_skil = String(wk_skil.match(re1));
													wk_att_skil = parseFloat(wk_att_skil.substring(0, (wk_att_skil.length - 1))) / 100;
												}
											} else {
												wkcnt0 = skil_res.indexOf("攻撃力");
												if (wkcnt0 > -1) {
													wkcnt1 = skil_res.indexOf("武将の攻撃力");
													if (wkcnt1 > -1) {
														wkcnt2 = skil_res.indexOf("兵科");
														if (wkcnt2 > -1) {
															wkcnt3 = skil_res.indexOf(card_type[l]);
															if (wkcnt3 > -1) {
																wk_skil = skil_res.substring(wkcnt3);
																wk_att_skil = String(wk_skil.match(re1));
																wk_att_skil = parseFloat(wk_att_skil.substring(0, (wk_att_skil.length - 1))) / 100;
															}
														} else {
															wk_skil = skil_res.substring(wkcnt1);
															wk_att_skil = String(wk_skil.match(re1));
															wk_att_skil = parseFloat(wk_att_skil.substring(0, (wk_att_skil.length - 1))) / 100;
														}
													} else {
														wkcnt2 = skil_res.indexOf("兵科");
														if (wkcnt2 > -1) {
															wk_skil = skil_res.substring(wkcnt2);
															wk_att_skil = String(wk_skil.match(re1));
															wk_att_skil = parseFloat(wk_att_skil.substring(0, (wk_att_skil.length - 1))) / 100;
														} else {
															wk_skil = skil_res.substring(wkcnt0);
															wk_att_skil = String(wk_skil.match(re1));
															wk_att_skil = parseFloat(wk_att_skil.substring(0, (wk_att_skil.length - 1))) / 100;
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}

			//防御力用
			wkcnt0 = skil_res.indexOf(")の武将1枚につき");
			if (wkcnt0 > -1) {
				wkcnt1 = skil_res.indexOf("防御力");
				if (wkcnt1 > -1) {
					wk_skil = skil_res.substring(wkcnt0 + 5);
					wk_def_skil = String(wk_skil.match(re1));
					wk_def_skil = parseFloat(wk_def_skil.substring(0, (wk_def_skil.length - 1))) / 100;
				}
			} else {
				wkcnt1 = skil_res.indexOf("武将の防御力");
				if (wkcnt1 > -1) {
					wkcnt2 = skil_res.indexOf("兵科");
					if (wkcnt2 > -1) {
						wkcnt3 = skil_res.indexOf(card_type[l]);
						if (wkcnt3 > -1) {
							wk_skil = skil_res.substring(wkcnt3);
							wk_def_skil = String(wk_skil.match(re1));
							wk_def_skil = parseFloat(wk_def_skil.substring(0, (wk_def_skil.length - 1))) / 100;
						}
					} else {
						wk_skil = skil_res.substring(wkcnt1);
						wk_def_skil = String(wk_skil.match(re1));
						wk_def_skil = parseFloat(wk_def_skil.substring(0, (wk_def_skil.length - 1))) / 100;
					}
				}
			}

			//移速用
			wkcnt0 = skil_res.indexOf("自拠点へ援軍出兵時");
			if (wkcnt0 > -1) {
			} else {
				wkcnt0 = skil_res.indexOf("全上級兵の攻撃力");
				if (wkcnt0 > -1) {
				} else {
					wkcnt0 = skil_res.indexOf("兵器の城・砦・村への攻撃");
					if (wkcnt0 > -1) {
						wkcnt2 = skil_res.indexOf(card_type[l]);
						if (wkcnt2 > -1) {
							wkcnt1 = skil_res.indexOf("移動速度");
							if (wkcnt1 > -1) {
								wk_skil = skil_res.substring(wkcnt1);
								wk_spe_skil = String(wk_skil.match(re1));
								wk_spe_skil = parseFloat(wk_spe_skil.substring(0, (wk_spe_skil.length - 1))) / 100;
							}
						}
					} else {
						wkcnt0 = skil_res.indexOf("近衛騎兵、矛槍兵、弩兵、投石機");
						if (wkcnt0 > -1) {
						} else {
							wkcnt0 = skil_res.indexOf("兵器を含む部隊の");
							if (wkcnt0 > -1) {
							} else {
								wkcnt0 = skil_res.indexOf("出兵時、兵器を除く全兵・武将の移動速度が");
								if (wkcnt0 > -1) {
									wk_skil = skil_res.substring(wkcnt0);
									wk_spe_skil = String(wk_skil.match(re3));
									housan_Flg = wk_spe_skil;
								} else {
									wkcnt1 = skil_res.indexOf("移動速度");
									if (wkcnt1 > -1) {
										wkcnt0 = skil_res.indexOf("武将の移動速度");
										if (wkcnt0 > -1) {
											wkcnt2 = skil_res.indexOf("兵科");
											if (wkcnt2 > -1) {
												wkcnt3 = skil_res.indexOf(card_type[l]);
												if (wkcnt3 > -1) {
													wk_skil = skil_res.substring(wkcnt3);
													wk_spe_skil = String(wk_skil.match(re1));
													wk_spe_skil = parseFloat(wk_spe_skil.substring(0, (wk_spe_skil.length - 1))) / 100;
												} else {
													wkcnt0 = skil_res.indexOf("武将および全兵科の攻撃力");
													if (wkcnt0 > -1) {
														wk_skil = skil_res.substring(wkcnt1);
														wk_spe_skil = String(wk_skil.match(re1));
														wk_spe_skil = parseFloat(wk_spe_skil.substring(0, (wk_spe_skil.length - 1))) / 100;
													} else {
														wk_skil = skil_res.substring(wkcnt1);
														wk_spe_skil = String(wk_skil.match(re1));
														wk_spe_skil = parseFloat(wk_spe_skil.substring(0, (wk_spe_skil.length - 1))) / 100;
													}
												}
											} else {
												wkcnt3 = skil_res.indexOf("移動速度が半分");
												if (wkcnt3 > -1) {
													wk_spe_skil = 99999;
												} else {
													wkcnt3 = skil_res.indexOf("移動速度が半減");
													if (wkcnt3 > -1) {
														wk_spe_skil = 99999;
													} else {
														wk_skil = skil_res.substring(wkcnt1);
														wk_spe_skil = String(wk_skil.match(re1));
														wk_spe_skil = parseFloat(wk_spe_skil.substring(0, (wk_spe_skil.length - 1))) / 100;
													}
												}
											}
										} else {
											wkcnt2 = skil_res.indexOf("兵科");
											if (wkcnt2 > -1) {
												wkcnt3 = skil_res.indexOf(card_type[l]);
												if (wkcnt3 > -1) {
													wk_skil = skil_res.substring(wkcnt3);
													wk_spe_skil = String(wk_skil.match(re1));
													wk_spe_skil = parseFloat(wk_spe_skil.substring(0, (wk_spe_skil.length - 1))) / 100;
												}
											} else {
												wkcnt3 = skil_res.indexOf("2分の1");
												if (wkcnt3 > -1) {
													wk_spe_skil = 99999;
												} else {
													wk_skil = skil_res.substring(wkcnt1);
													wk_spe_skil = String(wk_skil.match(re1));
													wk_spe_skil = parseFloat(wk_spe_skil.substring(0, (wk_spe_skil.length - 1))) / 100;
												}
											}
										}
									} else {
										wkcnt2 = skil_res.indexOf("武将単騎時は移速");
										if (wkcnt2 > -1) {
											wk_skil = skil_res.substring(wkcnt2);
											wk_spe_skil = String(wk_skil.match(re1));
											wk_spe_skil = parseFloat(wk_spe_skil.substring(0, (wk_spe_skil.length - 1))) / 100;
										} else {
											wkcnt3 = skil_res.indexOf("移速");
											if (wkcnt3 > -1) {
												wk_skil = skil_res.substring(wkcnt3);
												wk_spe_skil = String(wk_skil.match(re1));
												wk_spe_skil = parseFloat(wk_spe_skil.substring(0, (wk_spe_skil.length - 1))) / 100;
											} else {
												/*wk_skil = skil_res.substring(wkcnt1);
												wk_spe_skil = String(wk_skil.match(re1));
												wk_spe_skil = parseFloat(wk_spe_skil.substring(0, (wk_spe_skil.length - 1))) / 100;*/
											}
										}
									}
								}
							}
						}
					}
				}
			}

			att_skilnum = att_skilnum + wk_att_skil;
			def_skilnum = def_skilnum + wk_def_skil;
			if (housan_Flg != 0) {
				spd_skilnum = housan_Flg;
			} else {
				if (wk_spe_skil != 99999) {
					spd_skilnum = spd_skilnum + wk_spe_skil;
				}
			}
		}

		//攻撃用
		if (alliFlg == 1 && alliance1 != 0 && val > 0 && att_skilnum != 0) {
			att_skilnum = att_skilnum + alliance1;
		} else if (alliFlg == 1 && alliance1 != 0 && val == 0) {
			att_skilnum = att_skilnum + alliance1;
		}
		if (AFSkilFlg == 1 && AFNum != "") {
			att_skilnum = att_skilnum + (AFNum / 100);
		}
		if (att_skilnum != 0 || atk_kakinFlg == 1) {
			var wkcalc1 = 0;

			if (atk_kakinFlg == 0) {
				wkcalc1 = Math.ceil((parseFloat(card_att[l]) * att_skilnum) + parseFloat(card_att[l]));
			} else if (atk_kakinFlg == 1 && att_skilnum != 0) {
				wkcalc1 = Math.ceil((parseFloat(card_att[l]) * att_skilnum) + parseFloat(card_att[l]));
				wkcalc1 = Math.ceil((wkcalc1 * 0.1) + wkcalc1);
			} else if (atk_kakinFlg == 1 && att_skilnum == 0) {
				wkcalc1 = Math.ceil((parseFloat(card_att[l]) * 0.1) + parseFloat(card_att[l]));
			}

			var sts_atk = j$(".status_att");

			sts_atk.eq(l).html("<span style=\"color:#FF0000;\">" + wkcalc1 + "</span>");

			//ｶｰﾄﾞ表示以外の場合
			if (deckcnt < l) {
				var sts_atk1 = j$(".statusParameter1");
				var sts_atk2 = sts_atk1.eq(l - deckcnt - 1).find("td");
				sts_atk2.eq(1).html("<span style=\"color:#FF0000;\">" + wkcalc1 + "</span>");
			}
		} else {
			j$(".status_att").eq(l).html(card_att[l]);		//攻撃力

			//ｶｰﾄﾞ表示以外の場合
			if (deckcnt < l) {
				var sts_atk1 = j$(".statusParameter1");
				var sts_atk2 = sts_atk1.eq(l - deckcnt - 1).find("td");
				sts_atk2.eq(1).html(card_att[l]);
			}
		}

		//防御用
		if (alliFlg == 1 && alliance2 != 0 && val > 0 && def_skilnum != 0) {
			def_skilnum = def_skilnum + alliance2;
		} else if (alliFlg == 1 && alliance2 != 0 && val == 0) {
			def_skilnum = alliance2;
		}
		if (def_skilnum != 0 || def_kakinFlg == 1) {
			var wkcalc2 = 0;
			var wkcalc3 = 0;
			var wkcalc4 = 0;
			var wkcalc5 = 0;

			if (def_kakinFlg == 0) {
				wkcalc2 = Math.ceil((parseFloat(card_wdef[l]) * def_skilnum) + parseFloat(card_wdef[l]));
				wkcalc3 = Math.ceil((parseFloat(card_sdef[l]) * def_skilnum) + parseFloat(card_sdef[l]));
				wkcalc4 = Math.ceil((parseFloat(card_bdef[l]) * def_skilnum) + parseFloat(card_bdef[l]));
				wkcalc5 = Math.ceil((parseFloat(card_rdef[l]) * def_skilnum) + parseFloat(card_rdef[l]));
			} else if (def_kakinFlg == 1 && def_skilnum != 0) {
				wkcalc2 = Math.ceil((parseFloat(card_wdef[l]) * def_skilnum) + parseFloat(card_wdef[l]));
				wkcalc3 = Math.ceil((parseFloat(card_sdef[l]) * def_skilnum) + parseFloat(card_sdef[l]));
				wkcalc4 = Math.ceil((parseFloat(card_bdef[l]) * def_skilnum) + parseFloat(card_bdef[l]));
				wkcalc5 = Math.ceil((parseFloat(card_rdef[l]) * def_skilnum) + parseFloat(card_rdef[l]));

				wkcalc2 = Math.ceil((wkcalc2 * 0.1) + wkcalc2);
				wkcalc3 = Math.ceil((wkcalc3 * 0.1) + wkcalc3);
				wkcalc4 = Math.ceil((wkcalc4 * 0.1) + wkcalc4);
				wkcalc5 = Math.ceil((wkcalc5 * 0.1) + wkcalc5);
			} else if (def_kakinFlg == 1 && def_skilnum == 0) {
				wkcalc2 = Math.ceil((parseFloat(card_wdef[l]) * 0.1) + parseFloat(card_wdef[l]));
				wkcalc3 = Math.ceil((parseFloat(card_sdef[l]) * 0.1) + parseFloat(card_sdef[l]));
				wkcalc4 = Math.ceil((parseFloat(card_bdef[l]) * 0.1) + parseFloat(card_bdef[l]));
				wkcalc5 = Math.ceil((parseFloat(card_rdef[l]) * 0.1) + parseFloat(card_rdef[l]));
			}

			j$(".status_wdef").eq(l).html("<span style=\"color:#FF0000;\">" + wkcalc2 + "</span>");	//歩防御
			j$(".status_sdef").eq(l).html("<span style=\"color:#FF0000;\">" + wkcalc3 + "</span>");	//槍防御
			j$(".status_bdef").eq(l).html("<span style=\"color:#FF0000;\">" + wkcalc4 + "</span>");	//弓防御
			j$(".status_rdef").eq(l).html("<span style=\"color:#FF0000;\">" + wkcalc5 + "</span>");	//馬防御

			//ｶｰﾄﾞ表示以外の場合
			if (deckcnt < l) {
				var sts_atk1 = j$(".statusParameter1");
				var sts_atk2 = sts_atk1.eq(l - deckcnt - 1).find("td");
				sts_atk2.eq(5).html("<span style=\"color:#FF0000;\">" + wkcalc2 + "</span>");
				sts_atk2.eq(7).html("<span style=\"color:#FF0000;\">" + wkcalc3 + "</span>");
				sts_atk2.eq(9).html("<span style=\"color:#FF0000;\">" + wkcalc4 + "</span>");
				sts_atk2.eq(11).html("<span style=\"color:#FF0000;\">" + wkcalc5 + "</span>");
			}
		} else {
			j$(".status_wdef").eq(l).html(card_wdef[l]);		//歩防御
			j$(".status_sdef").eq(l).html(card_sdef[l]);		//槍防御
			j$(".status_bdef").eq(l).html(card_bdef[l]);		//弓防御
			j$(".status_rdef").eq(l).html(card_rdef[l]);		//馬防御

			//ｶｰﾄﾞ表示以外の場合
			if (deckcnt < l) {
				var sts_atk1 = j$(".statusParameter1");
				var sts_atk2 = sts_atk1.eq(l - deckcnt - 1).find("td");
				sts_atk2.eq(5).html(card_wdef[l]);
				sts_atk2.eq(7).html(card_sdef[l]);
				sts_atk2.eq(9).html(card_bdef[l]);
				sts_atk2.eq(11).html(card_rdef[l]);
			}
		}

		//速度用
		if (spd_skilnum != 0 || wk_spe_skil == 99999) {
			var wkcalc6 = 0;
			if (housan_Flg != 0) {
				wkcalc6 = housan_Flg;

				j$(".status_speed").eq(l).html("<span style=\"color:#FF0000;\">" + wkcalc6 + "</span>");	//移動速度
			} else {
				if (wk_spe_skil != 99999) {
					wkcalc6 = (parseFloat(card_speed[l]) * spd_skilnum) + parseFloat(card_speed[l]);
				} else {
					wkcalc6 = ((parseFloat(card_speed[l]) * spd_skilnum) + parseFloat(card_speed[l])) / 2;
				}

				j$(".status_speed").eq(l).html("<span style=\"color:#FF0000;\">" + wkcalc6.toFixed(1) + "</span>");	//移動速度
			}

			//ｶｰﾄﾞ表示以外の場合
			if (deckcnt < l) {
				var sts_atk1 = j$(".statusParameter1");
				var sts_atk2 = sts_atk1.eq(l - deckcnt - 1).find("td");
				if (housan_Flg != 0) {
					sts_atk2.eq(13).html("<span style=\"color:#FF0000;\">" + wkcalc6 + "</span>");
				} else {
					sts_atk2.eq(13).html("<span style=\"color:#FF0000;\">" + wkcalc6.toFixed(1) + "</span>");
				}
			}
		} else {
			j$(".status_speed").eq(l).html(card_speed[l]);	//移動速度

			//ｶｰﾄﾞ表示以外の場合
			if (deckcnt < l) {
				var sts_atk1 = j$(".statusParameter1");
				var sts_atk2 = sts_atk1.eq(l - deckcnt - 1).find("td");
				sts_atk2.eq(13).html(card_speed[l]);
			}
		}
	}

	function ac_Init_Proc() {
		//表示コンテナ作成
		var div1 = j$("<div/>");
		div1.attr("id", "atk_calc_C");
		div1.attr("style", "position:absolute;color:#FFF;background-color:#666666;border:outset 2px darkgray;left:100px;top:250px;font-size:13px;padding:3px;width:250px;height:90px;z-index:999;");
		var div2 = j$("<div/>");
		div2.attr("style", "margin-top:2px;margin-left:5px;");
		var radio1 = j$('<input type="radio"/>');
		var radio2 = j$('<input type="radio"/>');
		radio1.attr("id", "atk_calc_radio1");
		radio1.attr("name", "atk_calc_radio");
		radio2.attr("id", "atk_calc_radio2");
		radio2.attr("name", "atk_calc_radio");
		var div3 = j$("<div/>");
		div3.attr("style", "margin-top:5px;");
		var btn1 = j$('<input type="button"/>');
		btn1.attr("id", "ac_write");
		btn1.attr("value", "登録");
		var btn2 = j$('<input type="button"/>');
		btn2.attr("id", "ac_close");
		btn2.attr("value", "閉じる");

		var div4 = j$("<div/>");
		div4.attr("style", "margin-top:4px;");
		var chk1 = j$('<input type="checkbox"/>');
		chk1.attr("id", "ac_afchk");
		var text1 = j$('<input type="text"/>');
		text1.attr("style", "width:70px;");
		text1.attr("maxlength", "7");
		text1.attr("id", "ac_afnum");
		div4.append(chk1).append("&nbsp;全軍用スキルON/OFF　").append(text1).append("％");

		div3.append(btn1).append(btn2);
		div2.append(radio1).append("同盟スキルON　").append(radio2).append("同盟スキルOFF").append("<br />").append(div4).append(div3);
		div1.append("【スキル込計算設定】").append(div2);

		j$("body").append(div1);

		if (AlliSkilFlg == 1) {
			j$("#atk_calc_radio1").attr("checked", "true");
		} else {
			j$("#atk_calc_radio2").attr("checked", "true");
		}
		if (AFFlg == 1) {
			j$("#ac_afchk").attr("checked", true);
		} else {
			j$("#ac_afchk").attr("checked", false);
			j$("#ac_afnum").attr("disabled", "disabled");
			j$("#ac_afnum").css({"background-color":"#DDD"});
		}
		j$("#ac_afnum").val(AFNum);

		j$("#ac_write").live("click", function(){
			ac_Init_Write();
		});
		j$("#ac_close").live("click", function(){
			CloseBtn_Proc();
		});
		j$("#ac_afchk").live("click", function(){
			AFSelect();
		});
		j$("#ac_afnum").blur(function() {
			//if (j$("#ac_afnum").val().match(/[^0-9]/)) {
			if (!j$("#ac_afnum").val().match(/^\d{0,4}(\.\d{1,2})?$/)) {
				alert("半角数字(最大値：9999.99)で入力してください。");
				j$("#ac_afnum").focus();
			}
		});
	}
	function ac_Init_Write() {
		if (j$("#atk_calc_radio1").attr("checked")) {
			GM_setValue(server + "_alliskilflg", 1);
		} else {
			GM_setValue(server + "_alliskilflg", 0);
		}
		if (j$("#ac_afchk").attr("checked") == true) {
			GM_setValue(server + "_afflg", 1);
		} else {
			GM_setValue(server + "_afflg", 0);
		}
		GM_setValue(server + "_afnum", j$("#ac_afnum").val());

		alert("登録しました。");
		var url = location.href;
		location.href = url;
	}
	function CloseBtn_Proc() {
		var elem = j$("#atk_calc_C");
		if (elem == undefined) return;
		j$("#atk_calc_C").remove();
		j$("#ac_write").die();
		j$("#ac_close").die();
	}
	function AFSelect() {
		if (j$("#ac_afchk").attr("checked") == true) {
			j$("#ac_afnum").removeAttr("disabled");
			j$("#ac_afnum").css({"background-color":"#FFF"});
		} else {
			j$("#ac_afnum").attr("disabled", "disabled");
			j$("#ac_afnum").css({"background-color":"#DDD"});
		}
	}

	/*------------+---------------------------------------------------------+
	 * 現在ﾌｧｲﾙ名取得用 													|
	 *------------+---------------------------------------------------------+
	 * 戻り値	  | Path													|
	 *------------+---------------------------------------------------------*/
	function URLGet() {
		wkurl = location.href;
		var arr = wkurl.split("/");
		wkurl = arr[arr.length-1];
		arr = wkurl.split("#");
		wkurl = arr[0];
		arr = wkurl.split("?");
		wkurl = arr[0];

		return wkurl;

	}
}

//---------------------------------------------------------
// NPC砦、領土検索ツール 2014/02/21 refactoring
//---------------------------------------------------------
// start
function disp_npcfort() {
	jQuery.noConflict();
	j$ = jQuery;

	npcfort_main();

	function npcfort_main(){
		if (location.pathname != "/map.php" && location.pathname != "/big_map.php") {
			return;
		}

		var ua = navigator.userAgent;
		if( ua.match(/Chrome\/([\.\d]+)/)) {
			browserType = "Chrome";
		}
		else{
			browserType = "";
		}

		// 51x51モードの実装されているサーバーかを取得
		add51_51mode = 1;

		//HTML追加
		addHtml_7();

		// 51x51モードか？
		if( getViewSize() != 51 ){
			//結果取得
			getNPCCastleInfo();
		}
		else{
			//結果取得
			getNPCCastleInfo_51(0);		// 0: ルート構築再描画ではない
		}
	}

	//----------------//
	// 出兵情報の検索 //
	//----------------//
	function putSoldierInfo(){

		//----------------------------//
		// スプレッドシート情報の取得 //
		//----------------------------//
		var chkflg4;
		execFlag = loadExecFlag(location.hostname, "FLAG4");
		if( execFlag == "" ){
			chkflg4 = new String(FLAG4);  // 初期値
		}
		else{
			chkflg4 = execFlag;
		}

		// スプレッドシート名の加工
		if( chkflg4.charAt(0) == '1' ){
			var key = chkflg4.substr(1).replace(/.*[\?&]key=([^&]+).*/, '$1');

			// 出兵情報を取得
			var battleType = new Array();
			var target = new Array();
			var arriveDate = new Array();
			var fdata = new Array();
			var count = 0;
			var sortie = $e_7('//div[@id="sortie"]//th[@class="ttl3 w80"]');
			var flist = $e_7('//div[@id="sortie"]//table[@class="commonTablesNoMG"]//td[@class="digit"]');
			for( var i = 0; i < sortie.snapshotLength/3; i++ ){
				// 殲滅戦、援軍、強襲等
				battleType[count] = sortie.snapshotItem(i*3+0).textContent;
				// 出兵先
				var pos = sortie.snapshotItem(i*3+1).parentNode.innerHTML.match(/\([-]*\d+,[-]*\d+\)/);
				target[count] = pos[0];
				// 到着日時
				var dt = sortie.snapshotItem(i*3+2).parentNode.innerHTML.match(/\d+-\d+-\d+ \d+:\d+:\d+/);
				arriveDate[count] = dt[0];
				// 兵士構成
				var fd = "";
				var total = 0;
				for( var j = 0; j < 11; j++ ){
					var num = parseInt(flist.snapshotItem(i*12+j).textContent);
					if( fd != "" ){
						fd = fd + "/";
					}
					fd = fd + num;
					total = parseInt(total) + parseInt(num);
				}
				if( total != 0 ){
					fdata[count] = fd + "[" + flist.snapshotItem(i*12+11).textContent + "]";
				}
				else{
					fdata[count] = "SMK[" + flist.snapshotItem(i*12+11).textContent + "]";
				}
				count ++;
			}

			// 出兵データをPOSTする
		}
	}

	//----------------//
	// 領土情報の検索 //
	//----------------//
	//拠点の作業中情報を取得
	function getNPCCastleInfo() {
		//--------------//
		// ホスト名判別 //
		//--------------//
		var hostname;
		var ikibaku_flg;
		hostname = location.hostname;
		if( hostname.indexOf("1kibaku.jp") != -1 ){
			ikibaku_flg = 1;
		}
		else{
			ikibaku_flg = 0;
		}

		//--------------------------------------//
		// チェックボックスに関する情報をロード //
		//--------------------------------------//
		var chkflg1;
		var chkflg2;
		execFlag = loadExecFlag(location.hostname, "FLAG0");
		if( execFlag == "" ){
			// 表示フラグをロード
			var execFlag1 = loadExecFlag(location.hostname, "FLAG1");
			if( execFlag1 == "" ){
				chkflg1 = new String(FLAG1);  // 初期値
			}
			else{
				chkflg1 = execFlag1;
			}

			// オプションフラグをロード
			var execFlag2 = loadExecFlag(location.hostname, "FLAG2");
			if( execFlag2 == "" ){
				chkflg2 = new String(FLAG2);  // 初期値
			}
			else{
				chkflg2 = execFlag2;
			}

			// 初回のときは、フラグを保存
			execFlag = chkflg1 + DELIMIT1_7 + chkflg2;
			saveExecFlag(location.hostname, "FLAG0", execFlag);
		}
		else{
			var loadflg = new Array();
			loadflg = execFlag.split(DELIMIT1_7);
			chkflg1 = loadflg[0];
			chkflg2 = loadflg[1];
		}

		// 個人、同盟検索情報をロード
		var chkflg3 = new Array();
		execFlag = loadExecFlag(location.hostname, "FLAG3");
		if( execFlag == "" ){
			var execFlag3 = loadExecFlag(location.hostname, "FLAG3-1");
			if( execFlag3 == "" ){
				chkflg3[0] = new String(FLAG3_1);  // 初期値
			}
			else{
				chkflg3[0] = execFlag3;
			}
			execFlag3 = loadExecFlag(location.hostname, "FLAG3-2");
			if( execFlag3 == "" ){
				chkflg3[1] = new String(FLAG3_2);  // 初期値
			}
			else{
				chkflg3[1] = execFlag3;
			}
			execFlag3 = loadExecFlag(location.hostname, "FLAG3-3");
			if( execFlag3 == "" ){
				chkflg3[2] = new String(FLAG3_3);  // 初期値
			}
			else{
				chkflg3[2] = execFlag3;
			}

			// 初回のときは、フラグを保存
			execFlag = chkflg3[0] + DELIMIT1_7 + chkflg3[1] + DELIMIT1_7 + chkflg3[2];
			saveExecFlag(location.hostname, "FLAG3", execFlag);
		}
		else{
			chkflg3 = execFlag.split(DELIMIT1_7);
		}

		//----------------------//
		// 処理パラメータの抽出 //
		//----------------------//
		//-- データ絞り込み時のユーザー名情報の取得 --//
		var checkBox1;
		var checkBox2;
		var userBox;
		var listbox;
		var userName = new Array();
		var userText;
		var fullmatch = new Array();
		var nodisp = new Array();
		var target = new Array();
		var colorNo = new Array();
		for( var i = 0; i < 3; i++ ){
			fullmatch[i] = 0;
			nodisp[i] = 0;
			target[i] = 0;
			colorNo[i] = 0;
		}

		// 個人・同盟検索１
		checkBox1 = $e_7('//*[@id="ckEnable1"]');
		if( checkBox1.snapshotItem(0).checked == true ){
			// 個人・同盟の別
			checkBox2 = $e_7('//*[@id="ckType1"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				target[0] = 1;
			}
			else{
				target[0] = 2;
			}
			// 完全一致
			checkBox2 = $e_7('//*[@id="ckFullMatch1"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				fullmatch[0] = 1;
			}
			else{
				fullmatch[0] = 0;
			}
			// ☆表示
			checkBox2 = $e_7('//*[@id="ckLevelSearch1"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				nodisp[0] = 1;
			}
			else{
				nodisp[0] = 0;
			}
			userBox = $e_7('//*[@id="userBox1"]');
			userText = userBox.snapshotItem(0).value;
			userName[0] = new Array();
			userName[0] = userText.split(OWNER_SPLITKEY);
			// 枠色
			listbox = $e_7('//*[@id="lsColor1"]');
			colorNo[0] = listbox.snapshotItem(0).selectedIndex + 1;
		}
		else{
			userName[0] = "";
		}

		// 個人・同盟検索２
		checkBox1 = $e_7('//*[@id="ckEnable2"]');
		if( checkBox1.snapshotItem(0).checked == true ){
			// 個人・同盟の別
			checkBox2 = $e_7('//*[@id="ckType2"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				target[1] = 1;
			}
			else{
				target[1] = 2;
			}
			// 完全一致
			checkBox2 = $e_7('//*[@id="ckFullMatch2"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				fullmatch[1] = 1;
			}
			else{
				fullmatch[1] = 0;
			}
			// ☆表示
			checkBox2 = $e_7('//*[@id="ckLevelSearch2"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				nodisp[1] = 1;
			}
			else{
				nodisp[1] = 0;
			}
			userBox = $e_7('//*[@id="userBox2"]');
			userText = userBox.snapshotItem(0).value;
			userName[1] = new Array();
			userName[1] = userText.split(OWNER_SPLITKEY);
			// 枠色
			listbox = $e_7('//*[@id="lsColor2"]');
			colorNo[1] = listbox.snapshotItem(0).selectedIndex + 1;
		}
		else{
			userName[1] = "";
		}

		// 個人・同盟検索３
		checkBox1 = $e_7('//*[@id="ckEnable3"]');
		if( checkBox1.snapshotItem(0).checked == true ){
			// 個人・同盟の別
			checkBox2 = $e_7('//*[@id="ckType3"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				target[2] = 1;
			}
			else{
				target[2] = 2;
			}
			// 完全一致
			checkBox2 = $e_7('//*[@id="ckFullMatch3"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				fullmatch[2] = 1;
			}
			else{
				fullmatch[2] = 0;
			}
			// ☆表示
			checkBox2 = $e_7('//*[@id="ckLevelSearch3"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				nodisp[2] = 1;
			}
			else{
				nodisp[2] = 0;
			}
			userBox = $e_7('//*[@id="userBox3"]');
			userText = userBox.snapshotItem(0).value;
			userName[2] = new Array();
			userName[2] = userText.split(OWNER_SPLITKEY);
			// 枠色
			listbox = $e_7('//*[@id="lsColor3"]');
			colorNo[2] = listbox.snapshotItem(0).selectedIndex + 1;
		}
		else{
			userName[2] = "";
		}

		//-- 資源判別ONのとき、資源表示 --//
		var res_mode;
		var areaNo;
		var areaNo2;
		var areaNo3;
		if( chkflg2.charAt(FLAG2_ANALYZE) == '1' ){
			res_mode = 1;
		}
		else{
			res_mode = 0;
		}

		// 強調表示選択値を取得
		areaNo = parseInt(chkflg2.substr(FLAG2_STRONG_AREANO,3));
		areaNo2 = parseInt(chkflg2.substr(FLAG2_STRONG_AREANO2,3));
		areaNo3 = parseInt(chkflg2.substr(FLAG2_STRONG_AREANO3,3));

		//------------------//
		// 画面サイズの取得 //
		//------------------//
		var viewSize;
		viewSize = getViewSize();

		//--------------------------------------------//
		// 全体表示画面から、画面中央座標を手に入れる //
		//--------------------------------------------//
		var codx = $e_7('//div[@id="datas"]/input[@id=\"x\"]');
		var cody = $e_7('//div[@id="datas"]/input[@id=\"y\"]');
		var bx = codx.snapshotItem(0).value;
		var by = cody.snapshotItem(0).value;
		var sx;
		var sy;
		var ex;
		var ey;

		//--------------//
		// ホスト名判別 //
		//--------------//
		var hosttype = "";
		if(	(location.hostname.indexOf("1kibaku") == -1)
			&& (location.hostname.indexOf("legend") == -1) ){
			hosttype = "0";
		}

		//------------------//
		// 左上座標を求める //
		//------------------//
		if( viewSize == 11 ){
			sx = parseInt(bx) - 5;
			sy = parseInt(by) + 5;
		}
		else if( viewSize == 15 ){
			sx = parseInt(bx) - 7;
			sy = parseInt(by) + 7;
		}
		else{
			sx = parseInt(bx) - 10;
			sy = parseInt(by) + 10;
		}

		//----------------------//
		// レーダーマップの描画 //
		//----------------------//
		var mapdata = new Array();
		var smallmapdv = $e_7('//*[@id="smallmap_dv"]');
		smallmapdv.snapshotItem(0).style.display = "inline";

		//--------------------------------------//
		// マップデータからレーダーマップを作る //
		//--------------------------------------//
		var areasrc = document.evaluate('//*[@id="mapsAll"]//img/@src',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		var areacls = document.evaluate('//*[@id="mapsAll"]//img/@class',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		var smallmap = $e_7('//*[@id="smallmap"]');

		// マップの作成
		for(var i = 0; i < 21; i++ ){
			mapdata[i] = new Array();
		}
		for(var i = 0; i < 21; i++ ){
			for(var j = 0; j < 21; j++ ){
				mapdata[j][i] = 'blank';
			}
		}

		var ck = $e_7('//*[@id="OldDesign"]');
		for (var i=0; i < areacls.snapshotLength-1; i++) {
			// 施設情報を全てリスト
			var rowTextA = areasrc.snapshotItem(i).textContent
			rowTextA = rowTextA.replace(/^.*\//,'');
			var clsText = areacls.snapshotItem(i).textContent;
			clsText = clsText.replace(/^mapAll0*/,'');
			var clsNo = parseInt(clsText) - 1;

			var areaimg;
			if( clsNo < 9 ){
				areaimg = $x_7('//div[@id="mapsAll"]//img[@class="mapAll0' + clsText + '"]');
			}
			else{
				areaimg = $x_7('//div[@id="mapsAll"]//img[@class="mapAll' + clsText + '"]');
			}

			var oldName = "";
			if( (areaimg != undefined) && (areaimg != null) ){
				oldName = areaimg.getAttribute("old");
				if( (oldName != undefined) && (oldName != null) ){
					rowTextA = oldName;
				}
			}

			var x = clsNo % viewSize;
			var y = Math.floor(clsNo / viewSize);

			// 城の情報をチェック
			if( rowTextA.indexOf('_bk_') >= 0 ){
				mapdata[y][x] = 'black';
			}else if( rowTextA.indexOf('_bg_') >= 0 ){
				mapdata[y][x] = 'aqua';
			}else if( rowTextA.indexOf('_b_') >= 0 ){
				mapdata[y][x] = 'blue';
			}else if( rowTextA.indexOf('_p_') >= 0 ){
				mapdata[y][x] = 'purple';
			}else if( rowTextA.indexOf('_r_') >= 0 ){
				mapdata[y][x] = 'red';
			}else if( rowTextA.indexOf('_g_') >= 0 ){
				mapdata[y][x] = 'green';
			}else if( rowTextA.indexOf('_o_') >= 0 ){
				mapdata[y][x] = 'orange';
			}else if( rowTextA.indexOf('_y_') >= 0 ){
				mapdata[y][x] = 'yellow';
			}else if( rowTextA.indexOf('blanc') >= 0 ){
				mapdata[y][x] = 'wall';
			}

			// 51x51モードが実装されており、かつ旧マップ使用が有効
			if( hosttype == "0" ){
				if( (oldName != null) && (oldName != undefined) && (oldName != "")){
					areasrc.snapshotItem(i).textContent = "/20110414-01/extend_project/w760/img/panel/" + oldName;
				}
			}
		}

		// 51x51モードが実装されており、かつ旧マップ使用が有効
		if( hosttype == "0" ){
			for( y = 0; y < viewSize; y++ ){
				for( x = 0; x < viewSize; x++ ){
					if( mapdata[y][x] == 'blank' ){
						var classNo;
						if( y*viewSize + x + 1 <= 9 ){
							classNo = "0" + parseInt(x + 1);
						}
						else{
							classNo = parseInt(y*viewSize + x + 1);
						}

						var ex = $x_7('//div[@id="mapsAll"]//img[@add="1"]');
						if( (ex != undefined) && (ex != null) ){
							var ex2_p = ex.parentNode;
							ex2_p.removeChild(ex);
						}
					}
				}
			}
		}

		// オプションオンのときだけレーダー描画
		if( chkflg2.charAt(FLAG2_RADER) == '1' ){
			// テキストボックスサイズの修正
			if( viewSize == 11 ){
				smallmap.snapshotItem(0).style.width = "66px";
				smallmap.snapshotItem(0).style.height = "66px";
				smallmap.snapshotItem(0).style.marginLeft = '-10px';
				smallmap.snapshotItem(0).style.marginTop = '354px';
			}
			else if( viewSize == 15 ){
				smallmap.snapshotItem(0).style.width = "90px";
				smallmap.snapshotItem(0).style.height = "90px";
				smallmap.snapshotItem(0).style.marginLeft = '-10px';
				smallmap.snapshotItem(0).style.marginTop = '330px';
			}
			else{
				smallmap.snapshotItem(0).style.width = "126px";
				smallmap.snapshotItem(0).style.height = "126px";
				smallmap.snapshotItem(0).style.marginLeft = '-10px';
				smallmap.snapshotItem(0).style.marginTop = '300px';
			}

			// 画像の設置
			var areaText = '';
			for( i = 0; i < viewSize; i++ ){
				for( j = 0; j < viewSize; j++ ){
					if( mapdata[j][i] == 'red' ){
						areaText = areaText + '<img src="' + icon_m[0] + '" width="6px" height="6px"/>';
					}
					else if( mapdata[j][i] == 'green' ){
						areaText = areaText + '<img src="' + icon_m[1] + '" width="6px" height="6px"/>';
					}
					else if( mapdata[j][i] == 'orange' ){
						areaText = areaText + '<img src="' + icon_m[2] + '" width="6px" height="6px"/>';
					}
					else if( mapdata[j][i] == 'yellow' ){
						areaText = areaText + '<img src="' + icon_m[3] + '" width="6px" height="6px"/>';
					}
					else if( mapdata[j][i] == 'black' ){
						areaText = areaText + '<img src="' + icon_m[4] + '" width="6px" height="6px"/>';
					}
					else if( mapdata[j][i] == 'blank' ){
						areaText = areaText + '<img src="' + icon_m[5] + '" width="6px" height="6px"/>';
					}
					else if( mapdata[j][i] == 'purple' ){
						areaText = areaText + '<img src="' + icon_m[6] + '" width="6px" height="6px"/>';
					}
					else if( mapdata[j][i] == 'blue' ){
						areaText = areaText + '<img src="' + icon_m[7] + '" width="6px" height="6px"/>';
					}
					else if( mapdata[j][i] == 'aqua' ){
						areaText = areaText + '<img src="' + icon_m[8] + '" width="6px" height="6px"/>';
					}
					else if( mapdata[j][i] == 'wall' ){
						areaText = areaText + '<img src="' + icon_m[9] + '" width="6px" height="6px"/>';
					}
				}
				areaText = areaText + '<br>';
			}
			if( areaText != '' ){
				smallmap.snapshotItem(0).innerHTML = areaText;
			}
		}
		else{
			var smallmapdv = $e_7('//*[@id="smallmap_dv"]');
			smallmapdv.snapshotItem(0).style.display = "none";
		}

		//----------------------------------------//
		// 全体表示画面から、領土情報を手に入れる //
		//----------------------------------------//
		// イベントデータ
		var areas = $e_7('//*[@id="mapOverlayMap"]//area/@onmouseover');
		var mouseout = $e_7('//*[@id="mapOverlayMap"]//area/@onmouseout');
		var href = $e_7('//*[@id="mapOverlayMap"]//area/@href');
		var textArea = $e_7('//*[@id="castleInfoText"]');

		var putText = "";

		//------------------//
		// 全領土を検索する //
		//------------------//
		for (var i=0; i<areas.snapshotLength; i++) {

			// 取得した領土の情報を抽出
			var rowText = areas.snapshotItem(i).textContent;
			var rowText2 = href.snapshotItem(i).textContent;
			rowText = rowText.replace(/^.*rewrite\(/, "");
			rowText = rowText.replace(/\); .*$/, "");
			var bkText = rowText;
			rowText = rowText.replace(/\//g,"==uZer==");
			rowText = rowText.replace(/', '/g,"'/'");
			rowText = rowText.replace(/'/g,"");
			var valueA = new Array();
			valueA = rowText.split('/');
			valueA[1] = valueA[1].replace(/==uZer==/,"/");
			var userTxt = '<b><font color="green">' + valueA[1] + '</font></b>';
			var groupTxt = '<b><font color="green">' + valueA[4] + '</font></b>';

			var pictImg = '<a href="' + rowText2 + '">'
					  + '<img src="/20100705-01/img/common/sidebar/icon_base.gif" onmouseover="' //ac22
					  + areas.snapshotItem(i).textContent + '" onmouseout="'
					  + mouseout.snapshotItem(i).textContent + '" ></a>';
			var linkText = '/' + pictImg + '<a href="' + rowText2 +  '" style="text-decoration: none"><font color="#00BFFF"><b>' + valueA[3] + '</b></font></a>' + '/距離' + valueA[6];

			// マップ座標の取得
			var rowText3 = valueA[3];
			rowText3 = rowText3.replace(/\(/,"");
			rowText3 = rowText3.replace(/\)/,"");
			var valueB = new Array();
			valueB = rowText3.split(',');
			var cx = parseInt(valueB[0]);
			var cy = parseInt(valueB[1]);

			// 資源数をカウント
			var max;
			var maxtype;
			var maxcount;
			max = 0;
			maxtype = 0;
			maxcount = 0;
			if( res_mode == 1 ){
				for(var j = 7; j <= 10; j++ ){
					if( valueA[j] > max ){
						max = valueA[j];
						maxtype = j - 6;
					}
				}
				for(var j = 7; j <= 10; j++ ){
					if( valueA[j] == max ){
						maxcount = maxcount + 1;
					}
				}
				if(maxcount > 1){
					maxtype = 0;
				}
			}

			//----------------------//
			// 個人・同盟検索の判定 //
			//----------------------//
			var matchcase = -1;	// マッチしたパターン

			// 個人・同盟マッチチェック
			for( var j = 0; j < 3; j++ ){
				for( var k = 0; k < userName[j].length; k++ ){
					// 検索有効時 username に値が入る
					if( userName[j][k] != "" ){
						// ターゲットが個人
						if( target[j] == 1 ){
							// 完全一致かつ、ユーザー名が一致
							if( (fullmatch[j] == 1) && (valueA[1] == userName[j][k]) ){
								matchcase = j;
								break;
							}
							// 部分一致かつ、ユーザー名が一致
							if( (fullmatch[j] == 0) && (valueA[1].indexOf(userName[j][k]) != -1) ){
								matchcase = j;
								break;
							}
						}
						// ターゲットが同盟
						else{
							// 完全一致かつ、ユーザー名が一致
							if( (fullmatch[j] == 1) && (valueA[4] == userName[j][k]) ){
								matchcase = j;
								break;
							}
							// 部分一致かつ、ユーザー名が一致
							if( (fullmatch[j] == 0) && (valueA[4].indexOf(userName[j][k]) != -1) ){
								matchcase = j;
								break;
							}
						}
					}
				}
				if( matchcase != -1 ){
					break;
				}
			}

			if( mapdata[Math.abs(cx-sx)][Math.abs(cy-sy)] == 'black' ){
				matchcase = -1;
			}

			//--------------//
			// 資源強調判定 //
			//--------------//
			var landLevel = valueA[5].length;
			if( valueA[5].substr(0,4) == '<img' ){
				// FaceBook Lands of Legends! 対応
				var stars = valueA[5].match(/<img/g);
				landLevel = stars.length;
			}

			var strongflg = 0;
			if( res_mode == 1 ){
				// 資源一致判定
				if(	(season1[areaNo][1] == parseInt(valueA[7]))	// 木
					&& (season1[areaNo][2] == parseInt(valueA[8]))	// 石
					&& (season1[areaNo][3] == parseInt(valueA[9]))	// 鉄
					&& (season1[areaNo][4] == parseInt(valueA[10]))	// 糧
					&& (season1[areaNo][5] == landLevel) ){		// ★
					strongflg = 1;
				}
				else if(	(season1[areaNo2][1] == parseInt(valueA[7]))	// 木
						 && (season1[areaNo2][2] == parseInt(valueA[8]))	// 石
						 && (season1[areaNo2][3] == parseInt(valueA[9]))	// 鉄
						 && (season1[areaNo2][4] == parseInt(valueA[10]))	// 糧
						 && (season1[areaNo2][5] == landLevel) ){		// ★
					strongflg = 2;
				}
				else if(	(season1[areaNo3][1] == parseInt(valueA[7]))	// 木
						 && (season1[areaNo3][2] == parseInt(valueA[8]))	// 石
						 && (season1[areaNo3][3] == parseInt(valueA[9]))	// 鉄
						 && (season1[areaNo3][4] == parseInt(valueA[10]))	// 糧
						 && (season1[areaNo3][5] == landLevel) ){		// ★
					strongflg = 3;
				}
			}

			//-----------------//
			// NPC砦の検索判定 //
			//-----------------//
			if( (chkflg1.charAt(FLAG1_NPC) == '1') && (valueA[11] == '1') ){
				// NPC砦
				if( putText != "" ){
					putText = putText + "\n";
				}
				// 砦名[0], 君主名[1], 座標[3], 所有者[4], ★[5]
				if( valueA[4] == '-' ){
					putText = putText + '<b><font color="purple">ＮＰＣ</font></b>/' + valueA[0] + '/<b><font color="red">未攻略</font></b>/' + userTxt + linkText + '/' + valueA[5];
				}
				else{
					putText = putText + '<b><font color="purple">ＮＰＣ</font></b>/' + valueA[0] + '/' + groupTxt + '/' + userTxt + linkText + '/' + valueA[5];
				}

				if( res_mode == 0 ){
					disp_AreaIcon(cx,cy,valueA[5].length,viewSize,0);
				}
			}

			//------------------------------------------//
			// 領土検索、または個人・同盟領土の検索判定 //
			//------------------------------------------//
			if( valueA[1] != '' ){
				// 領地化されている土地

				if( (matchcase == -1) && (chkflg2.charAt(FLAG2_LAND) == '1') ){
					// 個人・同盟検索に該当せず、領土検索がオンの場合

					// ☆数による絞り込み
					if(	((chkflg1.charAt(FLAG1_LV1) == '1') && (landLevel == 1))
						|| ((chkflg1.charAt(FLAG1_LV2) == '1') && (landLevel == 2))
						|| ((chkflg1.charAt(FLAG1_LV3) == '1') && (landLevel == 3))
						|| ((chkflg1.charAt(FLAG1_LV4) == '1') && (landLevel == 4))
						|| ((chkflg1.charAt(FLAG1_LV5) == '1') && (landLevel == 5))
						|| ((chkflg1.charAt(FLAG1_LV6) == '1') && (landLevel == 6))
						|| ((chkflg1.charAt(FLAG1_LV7) == '1') && (landLevel == 7))
						|| ((chkflg1.charAt(FLAG1_LV8) == '1') && (landLevel == 8))
						|| ((chkflg1.charAt(FLAG1_LV9) == '1') && (landLevel == 9)) ){

						// 領土情報は検索結果に反映
						if( putText != "" ){
							putText = putText + "\n";
						}
						// 砦名[0], 君主名[1], 座標[3], ★[5]
						if( valueA[5] != "" ){
							if( ikibaku_flg == 1 ){
								putText = putText + groupTxt + '領土/' + userTxt + '/' + valueA[0] + linkText + '/' + valueA[5] + '/学' + valueA[7] + '/体' + valueA[8] + '/武' + valueA[9] + '/糧' + valueA[10];
							}
							else{
								putText = putText + groupTxt + '領土/' + userTxt + '/' + valueA[0] + linkText + '/' + valueA[5] + '/木' + valueA[7] + '/石' + valueA[8] + '/鉄' + valueA[9] + '/糧' + valueA[10];
							}
						}
						else{
							putText = putText + groupTxt + '領土/' + userTxt + '<b><font color="#FF0000">拠点</font></b>/' + valueA[0] + '/人口' + valueA[2] + linkText;
						}

						// 資源表示の有無で関数が変わる
						if( res_mode == 0 ){
							// パステルカラー表示
							disp_AreaIcon(cx,cy,landLevel,viewSize,100);
						}
						else{
							// 資源別着色表示
							disp_AreaIcon2(cx,cy,landLevel,viewSize,100 + strongflg*1000,maxtype);
						}
					}
				}
				else if( matchcase != -1 ){
					// 個人・同盟検索結果がマッチ

					if( nodisp[matchcase] == 0 ){
						// 画面に☆数を出す場合

						// ☆数による絞り込み
						if(	((chkflg1.charAt(FLAG1_LV1) == '1') && (landLevel == 1))
							|| ((chkflg1.charAt(FLAG1_LV2) == '1') && (landLevel == 2))
							|| ((chkflg1.charAt(FLAG1_LV3) == '1') && (landLevel == 3))
							|| ((chkflg1.charAt(FLAG1_LV4) == '1') && (landLevel == 4))
							|| ((chkflg1.charAt(FLAG1_LV5) == '1') && (landLevel == 5))
							|| ((chkflg1.charAt(FLAG1_LV6) == '1') && (landLevel == 6))
							|| ((chkflg1.charAt(FLAG1_LV7) == '1') && (landLevel == 7))
							|| ((chkflg1.charAt(FLAG1_LV8) == '1') && (landLevel == 8))
							|| ((chkflg1.charAt(FLAG1_LV9) == '1') && (landLevel == 9)) ){

							// 領土情報は検索結果に反映
							if( putText != "" ){
								putText = putText + "\n";
							}
							// 砦名[0], 君主名[1], 座標[3], ★[5]
							if( valueA[5] != "" ){
								if( ikibaku_flg == 1 ){
									putText = putText + groupTxt + '領土/' + userTxt + '/' + valueA[0] + linkText + '/' + valueA[5] + '/学' + valueA[7] + '/体' + valueA[8] + '/武' + valueA[9] + '/糧' + valueA[10];
								}
								else{
									putText = putText + groupTxt + '領土/' + userTxt + '/' + valueA[0] + linkText + '/' + valueA[5] + '/木' + valueA[7] + '/石' + valueA[8] + '/鉄' + valueA[9] + '/糧' + valueA[10];
								}
							}
							else{
								putText = putText + groupTxt + '領土/' + userTxt + '<b><font color="#FF0000">拠点</font></b>/' + valueA[0] + '/人口' + valueA[2] + linkText;
							}

							// 資源表示の有無で関数が変わる
							if( res_mode == 0 ){
								// パステルカラー表示
								disp_AreaIcon(cx,cy,landLevel,viewSize,100 + colorNo[matchcase]);
							}
							else{
								// 資源別着色表示
								disp_AreaIcon2(cx,cy,landLevel,viewSize,100 + colorNo[matchcase] + strongflg*1000,maxtype);
							}
						}
						else{
							// ☆数の絞り込み対象外となった土地は枠のみつける
							disp_AreaIcon(cx,cy,landLevel,viewSize,colorNo[matchcase]);
						}
					}
					else{
						// 画面に☆数を出さない（領土の着色のみ行う）

						// 枠のみつける
						disp_AreaIcon(cx,cy,landLevel,viewSize,colorNo[matchcase]);
					}
				}
			}

			// 空き地検索結果
			if( (chkflg2.charAt(FLAG2_EMPTY) == '1') && (valueA[1] == '') ){
				// 空き地(空き地同時検索を除き、個人/同盟領土検索時は出さない)
				if(	((chkflg1.charAt(FLAG1_LV1) == '1') && (landLevel == 1))
					|| ((chkflg1.charAt(FLAG1_LV2) == '1') && (landLevel == 2))
					|| ((chkflg1.charAt(FLAG1_LV3) == '1') && (landLevel == 3))
					|| ((chkflg1.charAt(FLAG1_LV4) == '1') && (landLevel == 4))
					|| ((chkflg1.charAt(FLAG1_LV5) == '1') && (landLevel == 5))
					|| ((chkflg1.charAt(FLAG1_LV6) == '1') && (landLevel == 6))
					|| ((chkflg1.charAt(FLAG1_LV7) == '1') && (landLevel == 7))
					|| ((chkflg1.charAt(FLAG1_LV8) == '1') && (landLevel == 8))
					|| ((chkflg1.charAt(FLAG1_LV9) == '1') && (landLevel == 9)) ){
					if( putText != "" ){
						putText = putText + "\n";
					}
					// 座標[3], ★[5], 木[7], 石[8], 鉄[9], 糧[10]
					if( ikibaku_flg == 1 ){
						putText = putText + '空き地★' + landLevel + linkText + '/学' + valueA[7] + '/体' + valueA[8] + '/武' + valueA[9] + '/糧' + valueA[10];
					}
					else{
						putText = putText + '空き地★' + landLevel + linkText + '/木' + valueA[7] + '/石' + valueA[8] + '/鉄' + valueA[9] + '/糧' + valueA[10];
					}

					var drawColor;
					if( chkflg2.charAt(FLAG2_EMPTY_DRAW) == "1" ){
						// 空き地着色モード有効時
						drawColor = parseInt(chkflg2.charAt(FLAG2_EMPTY_DRAW_COLOR)) + 1;
					}
					else{
						drawColor = 0;
					}

					drawColor = drawColor + 100 + strongflg*1000;	// drawColor > 100で着色
					if( res_mode == 0 ){
						disp_AreaIcon(cx,cy,landLevel,viewSize,drawColor);
					}
					else{
						disp_AreaIcon2(cx,cy,landLevel,viewSize,drawColor,maxtype);
					}
				}
				else if( chkflg2.charAt(FLAG2_EMPTY_DRAW) == "1" ){
					// 空き地着色モード有効時
					drawColor = parseInt(chkflg2.charAt(FLAG2_EMPTY_DRAW_COLOR)) + 1;

					disp_AreaIcon(cx,cy,valueA[5].length,viewSize,drawColor);
				}
			}
			else if( (chkflg2.charAt(FLAG2_EMPTY_DRAW) == "1") && (valueA[1] == '') ){
				// 空き地着色モード有効時
				drawColor = parseInt(chkflg2.charAt(FLAG2_EMPTY_DRAW_COLOR)) + 1;

				disp_AreaIcon(cx,cy,valueA[5].length,viewSize,drawColor);
			}
		}

		// 結果をTextAreaに表示
		textArea.snapshotItem(0).innerHTML = putText;

		//------------------//
		// 本拠地一覧の描画 //
		//------------------//
		if( chkflg2.charAt(FLAG2_OWNER) == '1' ){
			var baseinfodv = $e_7('//*[@id="baseinfo_dv"]');
			baseinfodv.snapshotItem(0).style.display = "inline";

			//----------------------------------//
			// マップデータから本拠地一覧を作る //
			//----------------------------------//
			var areasrc = document.evaluate('//*[@id="mapsAll"]//img/@src',
				document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
			var areacls = document.evaluate('//*[@id="mapsAll"]//img/@class',
				document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
			var baseText = $e_7('//*[@id="baseInfoText"]');

			var blank = '					  ';
			var outTextLine = new Array();
			var outLineMax = 0;
			var outLine = 0;
			for (var i = 0; i < 9; i++ ){
				outTextLine[i] = '';
			}
			for (var i=0; i < areacls.snapshotLength-1; i++) {
				// 施設情報を全てリスト
				var rowTextA = areasrc.snapshotItem(i).textContent
				rowTextA = rowTextA.replace(/^.*\//,'');
				var clsText = areacls.snapshotItem(i).textContent;
				clsText = clsText.replace(/^mapAll0*/,'');
				var clsNo = parseInt(clsText) - 1;

				// 城の情報をチェック
				if( rowTextA.substr(0,7) == 'capital' ){
					// テキストデータ
					var text = areas.snapshotItem(clsNo).textContent;

					// 城の情報を抽出
					var rowText = areas.snapshotItem(clsNo).textContent;
					var rowText2 = href.snapshotItem(clsNo).textContent;
					rowText = rowText.replace(/^.*rewrite\(/, "");
					rowText = rowText.replace(/\); .*$/, "");
					var bkText = rowText;
					rowText = rowText.replace(/\//g,"==uZer==");
					rowText = rowText.replace(/', '/g,"'/'");
					rowText = rowText.replace(/'/g,"");
					var valueA = new Array();
					valueA = rowText.split('/');
					valueA[1] = valueA[1].replace(/==uZer==/,"/");

					if( valueA[11] != '1' ){
						// NPC砦ではない

						// マップ座標の取得
						var rowText3 = valueA[3];
						rowText3 = rowText3.replace(/\(/,"");
						rowText3 = rowText3.replace(/\)/,"");
						var valueB = new Array();
						valueB = rowText3.split(',');
						var cx = parseInt(valueB[0]);
						var cy = parseInt(valueB[1]);

						// テキストの生成
						var data2 = '(' + formatRightNumber(cx,4) + ',' +  formatRightNumber(cy,4) + ') ';
						if( rowTextA.substr(0,9) == 'capital_r' ){
							// 他同盟
							data2 = data2 + '<font color="red"	 >'
						}else if( rowTextA.substr(0,9) == 'capital_g' ){
							// 自同盟
							data2 = data2 + '<font color="green" >'
						}else if( rowTextA.substr(0,10) == 'capital_bk' ){
							// 自配下
							data2 = data2 + '<font color="black" >'
						}else if( rowTextA.substr(0,10) == 'capital_bg' ){
							// 同盟が配下
							data2 = data2 + '<font color="cyan"  >'
						}else if( rowTextA.substr(0,9) == 'capital_b' ){
							// プレイヤー
							data2 = data2 + '<font color="blue"  >'
						}else if( rowTextA.substr(0,9) == 'capital_o' ){
							// 他配下
							data2 = data2 + '<font color="orange">'
						}else if( rowTextA.substr(0,9) == 'capital_y' ){
							// 不可侵
							data2 = data2 + '<font color="yellow">'
						}
						data2 = data2 + valueA[1] + blank.substr(jstrlen(valueA[1])) + '</font>';
						outTextLine[outLine] = outTextLine[outLine] + data2;
						if( outLine == 8 ){
							outLine = 0;
						}
						else{
							outLine = outLine + 1;
							if( outLine > outLineMax ){
								outLineMax = outLine;
							}
						}
					}
				}
			}
			var outText = '';
			for( var i = 0; i < outLineMax; i++ ){
				// テキストの生成
				if( outText != '' ){
					outText = outText + '<br>';
				}
				outText = outText + outTextLine[i];
			}

			if( outText != '' ){
				baseText.snapshotItem(0).innerHTML = '<font color="brown"><b>本拠地リスト</b></font><br>' + outText;
			}
		}
		else{
			var baseinfodv = $e_7('//*[@id="baseinfo_dv"]');
			baseinfodv.snapshotItem(0).style.display = "none";
		}

		//----------------//
		// 方位表示の描画 //
		//----------------//
		if( chkflg2.charAt(FLAG2_DIRECTION) == '1' ){
			var dv2;
			var img;

			// 方位アイコン（東）
			img = 'data:image/png;base64,'+
					'iVBORw0KGgoAAAANSUhEUgAAACAAAAAiCAYAAAA+stv/AAAABnRSTlMAwADAAMCNeLu6AAABIUlEQVR42tWXaw6EIAyEtydbj86eTOMmNezY'+
					'aSsiZPuTDPbrA6hSSnnNNGkBWJb3aq2X8pFhACsgiEwEEJmcgSh6LFmtfRxAnateKtW+5wvAmsozqwQZLUIfAOtlhHt2AngyA8wOgNo0G1gr'+
					'S4PRoAadmZlgAFF0VzTeMQ0BehmDGJKBWtcE0NoDmdtyWAbYZTW0B5oApmegZw/8ZwZ6WdcMsNftkQzoRnzXWZS7qf42gPdBdGwNHGhpANwU'+
					'Ra9OW+bEcCSznNcRY9RsPf0cZ5xba16mPBAK4A2TDIBBWyAK4/YAGyiiDs+emBNANELXuuxI5jWuOZRmxqjsGfd66KcE1tlnzq8AWCVFrTmW'+
					'R2eXXVbRHuv7XX7PW35KbwH0tA1E3rSyVRg+QgAAAABJRU5ErkJggg==';
			dv2 = d_7.createElement("div");
			dv2.style.position = "absolute";
			dv2.style.top = "390px";
			dv2.style.left = "500px";
			dv2.style.zIndex = 500;
			dv2.id = "icon_east";
			dv2.innerHTML = '<img src="' + img + '">';
			$d("datas").parentNode.appendChild(dv2);

			// 方位アイコン（西）
			img = 'data:image/png;base64,'+
					'iVBORw0KGgoAAAANSUhEUgAAACIAAAAgCAYAAAB3j6rJAAAABnRSTlMAwADAAMCNeLu6AAAA9klEQVR42u2YYQ7DIAiF58nWo7uTubjMhlJA'+
					'EHRd0vevWvXzFdA05ZwfV1BaCbJtzwKfc36l5SANonxRUjrCfEAw6SwVtAqE2UHKEpSzKswBZGRXbUdUm0U7iFbYOQ4EBqHamRtEApHy3AvS'+
					'm/sEgvMcyxOsXA0RQWYLOyeCULsbdYQqZiYQ+PJojHDjLgGiDtYIEJgpYSDc6dkDqX21LRSE6tOM+RkIVCiIdKmhag8VO7jfDKKNA4uGQaQa'+
					'wGUGXtj9adoC0B3NoYblAuFcsCqkoEkuLAXxAExxxKuQGInW/zoyI0a4DBQvz9SAUZDenEv/Bkh6A3xNvDBXWpYCAAAAAElFTkSuQmCC';
			dv2 = d_7.createElement("div");
			dv2.style.position = "absolute";
			dv2.style.top = "145px";
			dv2.style.left = "220px";
			dv2.style.zIndex = 500;
			dv2.id = "icon_west";
			dv2.innerHTML = '<img src="' + img + '">';
			$d("datas").parentNode.appendChild(dv2);

			// 方位アイコン（南）
			img = 'data:image/png;base64,'+
					'iVBORw0KGgoAAAANSUhEUgAAACIAAAAiCAYAAAA6RwvCAAAABnRSTlMAwADAAMCNeLu6AAABAUlEQVR42u2XaxLCIAyE5WT26HiyOnUmHVzz'+
					'wJDQjnZ/0kC/hOVVaq23M6h4QZblvnLttT7KdJAVUEq5QN4hNp0CxILgfEV9poEQhFTFF4i0Aixxg/bGYwI7yOpCGdcHyIyKSNpBWiGUNO9e'+
					'j0hjsiD0AytLj0ekZa6CZImDMUHaTNuMrCphnLULd4FsHXAfwKykfYL6hoF4vhFoz3GQAsJNn7XCQkDaaSEIhAoBkbJDI1Mb54dhkAyFVQSr'+
					'YMVxsUMe6Y3jzq4Uj/RUBL+FgER75v884on9bZC0VeMB0Qx+SEW0m3s6SBuDQK6rovaM1F5tErQ2nvsW/42sGzwLcpSeYYfishi2CCMAAAAA'+
					'SUVORK5CYII=';
			dv2 = d_7.createElement("div");
			dv2.style.position = "absolute";
			dv2.style.top = "390px";
			dv2.style.left = "220px";
			dv2.style.zIndex = 500;
			dv2.id = "icon_south";
			dv2.innerHTML = '<img src="' + img + '">';
			$d("datas").parentNode.appendChild(dv2);

			// 方位アイコン（南）
			img = 'data:image/png;base64,'+
					'iVBORw0KGgoAAAANSUhEUgAAACIAAAAgCAYAAAB3j6rJAAAABnRSTlMAwADAAMCNeLu6AAABAElEQVR42u3WXQ7DIAgA4HGy9ejuZDZLZovI'+
					'n0aM2cZjNfoFLQIppccOAV7IcTwz9z2lF2hjIZBMtgO4IdLY70DgswUHwWNLIGUjbWw7CL7QHHIJpCDecwAR8JxlEO4yY0w4BGejOQ5gIFJR'+
					'wtELkRDc8VSQbFL8EAlPAddYVEbwfA3QQKzovSMUYdWVEIg3C0sy4gWEQ7Yt8X/I90JwoZsBkdoBFkKrrPVg9UJKO9BAuPLOFahZGVEh2oNH'+
					'345RCG2Q3BAgS81oFaU3qDoarUyPlHjPcZc9mjYA95Vau2c9et4o61R/jdZpj7aDFqLJiBXeTr03hppnaZEZ4YZExwnhd/gwvUipkQAAAABJ'+
					'RU5ErkJggg==';
			dv2 = d_7.createElement("div");
			dv2.style.position = "absolute";
			dv2.style.top = "145px";
			dv2.style.left = "500px";
			dv2.style.zIndex = 500;
			dv2.id = "icon_north";
			dv2.innerHTML = '<img src="' + img + '">';
			$d("datas").parentNode.appendChild(dv2);
		}

		//--------------//
		// 出兵情報共有 //
		//--------------//
		unionAttackInfo();
	}

	//----------------//
	// 領土情報の検索 //
	//----------------//
	//拠点の作業中情報を取得
	function getNPCCastleInfo_51(drawflag) {
		//--------------------------------------//
		// チェックボックスに関する情報をロード //
		//--------------------------------------//
		var chkflg1;
		var chkflg2;
		execFlag = loadExecFlag(location.hostname, "FLAG0");
		if( execFlag == "" ){
			// 表示フラグをロード
			var execFlag1 = loadExecFlag(location.hostname, "FLAG1");
			if( execFlag1 == "" ){
				chkflg1 = new String(FLAG1);  // 初期値
			}
			else{
				chkflg1 = execFlag1;
			}

			// オプションフラグをロード
			var execFlag2 = loadExecFlag(location.hostname, "FLAG2");
			if( execFlag2 == "" ){
				chkflg2 = new String(FLAG2);  // 初期値
			}
			else{
				chkflg2 = execFlag2;
			}

			// 初回のときは、フラグを保存
			execFlag = chkflg1 + DELIMIT1_7 + chkflg2;
			saveExecFlag(location.hostname, "FLAG0", execFlag);
		}
		else{
			var loadflg = new Array();
			loadflg = execFlag.split(DELIMIT1_7);
			chkflg1 = loadflg[0];
			chkflg2 = loadflg[1];
		}

		// 個人、同盟検索情報をロード
		var chkflg3 = new Array();
		execFlag = loadExecFlag(location.hostname, "FLAG3");
		if( execFlag == "" ){
			var execFlag3 = loadExecFlag(location.hostname, "FLAG3-1");
			if( execFlag3 == "" ){
				chkflg3[0] = new String(FLAG3_1);  // 初期値
			}
			else{
				chkflg3[0] = execFlag3;
			}
			execFlag3 = loadExecFlag(location.hostname, "FLAG3-2");
			if( execFlag3 == "" ){
				chkflg3[1] = new String(FLAG3_2);  // 初期値
			}
			else{
				chkflg3[1] = execFlag3;
			}
			execFlag3 = loadExecFlag(location.hostname, "FLAG3-3");
			if( execFlag3 == "" ){
				chkflg3[2] = new String(FLAG3_3);  // 初期値
			}
			else{
				chkflg3[2] = execFlag3;
			}

			// 初回のときは、フラグを保存
			execFlag = chkflg3[0] + DELIMIT1_7 + chkflg3[1] + DELIMIT1_7 + chkflg3[2];
			saveExecFlag(location.hostname, "FLAG3", execFlag);
		}
		else{
			chkflg3 = execFlag.split(DELIMIT1_7);
		}

		//-------------------------------------------------//
		// 51x51モード未使用設定の場合、なにもしないで戻る //
		//-------------------------------------------------//
		if( chkflg2.charAt(FLAG2_NOEXEC51) == '1' ){
			return;
		}


		//----------------------//
		// 処理パラメータの抽出 //
		//----------------------//
		//-- データ絞り込み時のユーザー名情報の取得 --//
		var checkBox1;
		var checkBox2;
		var userBox;
		var listbox;
		var userName = new Array();
		var userText;
		var fullmatch = new Array();
		var nodisp = new Array();
		var target = new Array();
		var colorNo = new Array();
		for( var i = 0; i < 3; i++ ){
			fullmatch[i] = 0;
			nodisp[i] = 0;
			target[i] = 0;
			colorNo[i] = 0;
		}

		// 個人・同盟検索１
		checkBox1 = $e_7('//*[@id="ckEnable1"]');
		if( checkBox1.snapshotItem(0).checked == true ){
			// 個人・同盟の別
			checkBox2 = $e_7('//*[@id="ckType1"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				target[0] = 1;
			}
			else{
				target[0] = 2;
			}
			// 完全一致
			checkBox2 = $e_7('//*[@id="ckFullMatch1"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				fullmatch[0] = 1;
			}
			else{
				fullmatch[0] = 0;
			}
			// ☆表示
			checkBox2 = $e_7('//*[@id="ckLevelSearch1"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				nodisp[0] = 1;
			}
			else{
				nodisp[0] = 0;
			}
			userBox = $e_7('//*[@id="userBox1"]');
			userText = userBox.snapshotItem(0).value;
			userName[0] = new Array();
			userName[0] = userText.split(OWNER_SPLITKEY);
			// 枠色
			listbox = $e_7('//*[@id="lsColor1"]');
			colorNo[0] = listbox.snapshotItem(0).selectedIndex + 1;
		}
		else{
			userName[0] = "";
		}

		// 個人・同盟検索２
		checkBox1 = $e_7('//*[@id="ckEnable2"]');
		if( checkBox1.snapshotItem(0).checked == true ){
			// 個人・同盟の別
			checkBox2 = $e_7('//*[@id="ckType2"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				target[1] = 1;
			}
			else{
				target[1] = 2;
			}
			// 完全一致
			checkBox2 = $e_7('//*[@id="ckFullMatch2"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				fullmatch[1] = 1;
			}
			else{
				fullmatch[1] = 0;
			}
			// ☆表示
			checkBox2 = $e_7('//*[@id="ckLevelSearch2"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				nodisp[1] = 1;
			}
			else{
				nodisp[1] = 0;
			}
			userBox = $e_7('//*[@id="userBox2"]');
			userText = userBox.snapshotItem(0).value;
			userName[1] = new Array();
			userName[1] = userText.split(OWNER_SPLITKEY);
			// 枠色
			listbox = $e_7('//*[@id="lsColor2"]');
			colorNo[1] = listbox.snapshotItem(0).selectedIndex + 1;
		}
		else{
			userName[1] = "";
		}

		// 個人・同盟検索３
		checkBox1 = $e_7('//*[@id="ckEnable3"]');
		if( checkBox1.snapshotItem(0).checked == true ){
			// 個人・同盟の別
			checkBox2 = $e_7('//*[@id="ckType3"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				target[2] = 1;
			}
			else{
				target[2] = 2;
			}
			// 完全一致
			checkBox2 = $e_7('//*[@id="ckFullMatch3"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				fullmatch[2] = 1;
			}
			else{
				fullmatch[2] = 0;
			}
			// ☆表示
			checkBox2 = $e_7('//*[@id="ckLevelSearch3"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				nodisp[2] = 1;
			}
			else{
				nodisp[2] = 0;
			}
			userBox = $e_7('//*[@id="userBox3"]');
			userText = userBox.snapshotItem(0).value;
			userName[2] = new Array();
			userName[2] = userText.split(OWNER_SPLITKEY);
			// 枠色
			listbox = $e_7('//*[@id="lsColor3"]');
			colorNo[2] = listbox.snapshotItem(0).selectedIndex + 1;
		}
		else{
			userName[2] = "";
		}

		//-- 資源判別ONのとき、資源表示 --//
		var res_mode;
		var areaNo;
		var areaNo2;
		var areaNo3;
		if( chkflg2.charAt(FLAG2_ANALYZE) == '1' ){
			res_mode = 1;
		}
		else{
			res_mode = 0;
		}

		// 強調表示選択値を取得
		areaNo = parseInt(chkflg2.substr(FLAG2_STRONG_AREANO,3));
		areaNo2 = parseInt(chkflg2.substr(FLAG2_STRONG_AREANO2,3));
		areaNo3 = parseInt(chkflg2.substr(FLAG2_STRONG_AREANO3,3));

		//------------------//
		// 画面サイズの取得 //
		//------------------//
		var viewSize = 51;

		//-------------------------//
		// 51x51モードへの設定反映 //
		//-------------------------//
		// 処理データの取得
		var href = $e_7('//*[@id="map51-content"]//div/a');

		var redrawX = new Array();
		var redrawY = new Array();
		if( drawflag == 1 ){
			if( (autoroute == AUTO_ROUTE_EDIT_LAST) || (autoroute == AUTO_ROUTE_NONE) ){
				// 始点を配列に保存
				redrawX[0] = autoroute_f[0];
				redrawY[0] = autoroute_f[1];
			}

			// 終点を配列に保存
			redrawX[1] = autoroute_l[0];
			redrawY[1] = autoroute_l[1];

			// ルート構築ビューの中身を配列に保存
			var pos = 2;
			var baseText = $e_7('//*[@id="routeInfoText"]');
			var text = baseText.snapshotItem(0).innerHTML;
			if( text != "" ){
				var text2 = text.split("<br>");
				for( var i = 0; i < text2.length; i++ ){
					if( (i == 0) && (autoroute != AUTO_ROUTE_EDIT_FIRST) ){
						continue;
					}
					var list = text2[i].match(/(([-]*\d+),([-]*\d+))/);
					redrawX[pos] = list[2];
					redrawY[pos] = list[3];
					pos = pos + 1;
				}
			}
		}

		var maxcount;
		if( drawflag == 0 ){
			maxcount = href.snapshotLength;
		}
		else{
			maxcount = redrawX.length;
		}
		for( var i = 0; i < maxcount; i++ ){
	//	for( var i = 0; i < 10; i++ ){
			var dt;
			if( drawflag == 0 ){
				dt = href.snapshotItem(i);
			}
			else{
				dt = $x_7("//div[@id=\"map51-content\"]//a[@href=\"/land.php?x=" + redrawX[i] + "&y=" + redrawY[i] + "#ptop\"]");
				if( (dt == null) || (dt == undefined) ){
					continue;
				}
			}
			var text = trim_7(dt.innerHTML);
			var p;
			var user = "";
			var group = "";
			var land = "";
			var landLevel = 0;
			var space = 0;

			// いま設定されている着色指定を解除
			if( text.indexOf("font") >= 0 ){
				text = text.substr(text.indexOf("</font>")-1,1);
				if( text == "S" ){
					text = autoroute_f[2];
				}
				else if( text == "E" ){
					text = autoroute_l[2];
				}
			}

			// 砦などの表示を英字に変更
			if( text == "村" ){
				text = "V";
			} else if( text == "砦" ){
				text = "F";
			} else if( text == "城" ){
				text = "C";
			}

			//----------------------//
			// 個人・同盟検索の判定 //
			//----------------------//
			var matchcase = -1;	// マッチしたパターン

			// 同盟名、個人名の取得
			p = dt.parentNode.innerHTML.match(/君主名<\/dt><dd>(.*)<\/dd><dt>座標/);
			if( p != undefined ){
				user = p[1];
			}
			else{
				p = dt.parentNode.innerHTML.match(/君主名&lt;\/dt&gt;&lt;dd&gt;(.*)&lt;\/dd&gt;&lt;dt&gt;座標/);
				if( p != undefined ){
					user = p[1];
				}
			}
			p = dt.parentNode.innerHTML.match(/君主名<\/dt><dd>(.*)<\/dd><dt>人口/);
			if( p != undefined ){
				user = p[1];
			}
			else{
				p = dt.parentNode.innerHTML.match(/君主名&lt;\/dt&gt;&lt;dd&gt;(.*)&lt;\/dd&gt;&lt;dt&gt;人口/);
				if( p != undefined ){
					user = p[1];
				}
			}
			p = dt.parentNode.innerHTML.match(/同盟名<\/dt><dd>(.*)<\/dd><dt>戦力/);
			if( p != undefined ){
				group = p[1];
			}
			else{
				p = dt.parentNode.innerHTML.match(/同盟名&lt;\/dt&gt;&lt;dd&gt;(.*)&lt;\/dd&gt;&lt;dt&gt;戦力/);
				if( p != undefined ){
					group = p[1];
				}
			}
			p = dt.parentNode.innerHTML.match(/同盟名<\/dt><dd class=&quot;bottom-popup-r&quot;>(.*)<\/dd><\/dl>/);
			if( p != undefined ){
				group = p[1];
			}
			else{
				p = dt.parentNode.innerHTML.match(/同盟名&lt;\/dt&gt;&lt;dd class=&quot;bottom-popup-r&quot;&gt;(.*)&lt;\/dd&gt;&lt;\/dl&gt;/);
				if( p != undefined ){
					group = p[1];
				}
			}
			p = dt.parentNode.innerHTML.match(/戦力<\/dt><dd>(.*)<\/dd><dt class=/);
			if( p != undefined ){
				land = p[1];
				landLevel = land.length;
				if(text == "　"){
					text = landLevel;
				}
			}
			else{
				p = dt.parentNode.innerHTML.match(/戦力&lt;\/dt&gt;&lt;dd&gt;(.*)&lt;\/dd&gt;&lt;dt class=/);
				if( p != undefined ){
					land = p[1];
					landLevel = land.length;
					if(text == "　"){
						text = landLevel;
					}
				}
			}
			if( dt.parentNode.innerHTML.indexOf(">空き地<") >= 0 ){
				space = 1;
			}
			else if( dt.parentNode.innerHTML.indexOf("&gt;空き地&lt;") >= 0 ){
				space = 1;
			}
			// 個人・同盟マッチチェック
			for( var j = 0; j < 3; j++ ){
				for( var k = 0; k < userName[j].length; k++ ){
					// 検索有効時 username に値が入る
					if( userName[j][k] != "" ){
						// ターゲットが個人
						if( target[j] == 1 ){
							// 完全一致かつ、ユーザー名が一致
							if( (fullmatch[j] == 1) && (user == userName[j][k]) ){
								matchcase = j;
								break;
							}
							// 部分一致かつ、ユーザー名が一致
							if( (fullmatch[j] == 0) && (user.indexOf(userName[j][k]) != -1) ){
								matchcase = j;
								break;
							}
						}
						// ターゲットが同盟
						else{
							// 完全一致かつ、ユーザー名が一致
							if( (fullmatch[j] == 1) && (group == userName[j][k]) ){
								matchcase = j;
								break;
							}
							// 部分一致かつ、ユーザー名が一致
							if( (fullmatch[j] == 0) && (group.indexOf(userName[j][k]) != -1) ){
								matchcase = j;
								break;
							}
						}
					}
				}
				if( matchcase != -1 ){
					break;
				}
			}

			//-----------------//
			// cssデータの作成 //
			//-----------------//
			var css = "";
			var strong = 0;		// 太字にするか

			if( space == 0 ){
				// 領地化されている土地

				if( (matchcase == -1) && (chkflg2.charAt(FLAG2_LAND) == '1') ){
					// 個人・同盟検索に該当せず、領土検索がオンの場合

					// ☆数による絞り込み
					if(	((chkflg1.charAt(FLAG1_LV1) == '1') && (landLevel == 1))
						|| ((chkflg1.charAt(FLAG1_LV2) == '1') && (landLevel == 2))
						|| ((chkflg1.charAt(FLAG1_LV3) == '1') && (landLevel == 3))
						|| ((chkflg1.charAt(FLAG1_LV4) == '1') && (landLevel == 4))
						|| ((chkflg1.charAt(FLAG1_LV5) == '1') && (landLevel == 5))
						|| ((chkflg1.charAt(FLAG1_LV6) == '1') && (landLevel == 6))
						|| ((chkflg1.charAt(FLAG1_LV7) == '1') && (landLevel == 7))
						|| ((chkflg1.charAt(FLAG1_LV8) == '1') && (landLevel == 8))
						|| ((chkflg1.charAt(FLAG1_LV9) == '1') && (landLevel == 9)) ){

						// レベル表示指定のとき、太字にする
						strong = 1;
					}
				}
			}
			if( (space == 1) && (chkflg2.charAt(FLAG2_EMPTY) == '1') ){
				// 空き地かつ、空き地検索が有効
				if(	((chkflg1.charAt(FLAG1_LV1) == '1') && (landLevel == 1))
					|| ((chkflg1.charAt(FLAG1_LV2) == '1') && (landLevel == 2))
					|| ((chkflg1.charAt(FLAG1_LV3) == '1') && (landLevel == 3))
					|| ((chkflg1.charAt(FLAG1_LV4) == '1') && (landLevel == 4))
					|| ((chkflg1.charAt(FLAG1_LV5) == '1') && (landLevel == 5))
					|| ((chkflg1.charAt(FLAG1_LV6) == '1') && (landLevel == 6))
					|| ((chkflg1.charAt(FLAG1_LV7) == '1') && (landLevel == 7))
					|| ((chkflg1.charAt(FLAG1_LV8) == '1') && (landLevel == 8))
					|| ((chkflg1.charAt(FLAG1_LV9) == '1') && (landLevel == 9)) ){

					// レベル表示指定のとき、太字にする
					strong = 1;
				}
			}

			// 個人・同盟マッチ判定
			if( matchcase != -1 ){
				// 枠着色CSSの追加
				css = css + 'border-style: solid; border-color: ' + cname_en[colorNo[matchcase]-1] + '; background-color: white; ';

				if( nodisp[matchcase] == 0 ){
					if(	((chkflg1.charAt(FLAG1_LV1) == '1') && (landLevel == 1))
						|| ((chkflg1.charAt(FLAG1_LV2) == '1') && (landLevel == 2))
						|| ((chkflg1.charAt(FLAG1_LV3) == '1') && (landLevel == 3))
						|| ((chkflg1.charAt(FLAG1_LV4) == '1') && (landLevel == 4))
						|| ((chkflg1.charAt(FLAG1_LV5) == '1') && (landLevel == 5))
						|| ((chkflg1.charAt(FLAG1_LV6) == '1') && (landLevel == 6))
						|| ((chkflg1.charAt(FLAG1_LV7) == '1') && (landLevel == 7))
						|| ((chkflg1.charAt(FLAG1_LV8) == '1') && (landLevel == 8))
						|| ((chkflg1.charAt(FLAG1_LV9) == '1') && (landLevel == 9)) ){
						// 枠表示のみでなく、指定領土レベル以上のばあい、太字にする
						strong = 1;
					}
				}
			}

			// 太字処理
			if( (strong == 1) && (landLevel > 0) ){
				// 太字化CSSの追加 資源判別オンのときのみ
				if( res_mode == 1 ){
					css = css + 'text-shadow: -1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000;';
				}
			}
			else if( landLevel != 0 ){
				// 拠点以外の場合、灰色化CSSの追加
				css = css + 'color: transparent; ';
			}

			// 資源判別(太字処理のときのみ)
			if( (strong == 1) && (res_mode == 1) ){
				p = dt.parentNode.innerHTML.match(/.*木(\d+)&amp;nbsp;岩(\d+)&amp;nbsp;鉄(\d+)&amp;nbsp;糧(\d+).*/);
				if( p != undefined ){
					// マッチ
					var maxres = -1;
					var maxpos = -1;
					var multi = 0;
					for( var j = 1; j < 5; j++ ){
						if(p[j] > maxres){
							maxres = p[j];
							maxpos = j;
							multi = 0;
						}
						else if( p[j] == maxres ){
							multi = 1;
						}
					}

					var col;
					if( multi == 1 ){
						col = "white";
					}
					else if( maxpos == 1 ){
						col = "springgreen";
					}
					else if( maxpos == 2 ){
						col = "aqua";
					}
					else if( maxpos == 3 ){
						col = "orange";
					}
					else if( maxpos == 4 ){
						col = "yellow";
					}

					// 資源判別CSSの追加
					css = css + 'color: ' + col + '; ';
				}
			}

			//---------------------------------//
			// 生成したCSSをマップデータに反映 //
			//---------------------------------//
			var newText;
			if( css != "" ){
				if( res_mode == 1 ){
					newText = '<b><font style="' + css + '">' + text + '</font></b>';
				}
				else{
					newText = '<font style="' + css + '">' + text + '</font>';
				}
				dt.innerHTML = newText;
			}
			else{
				newText = '<font>' + text + '</font>';
				dt.innerHTML = newText;
			}
		}

		return;
	}


	//--------------//
	// 出兵情報共有 //
	//--------------//
	function unionAttackInfo()
	{
		//--------------//
		// 出兵情報共有 //
		//--------------//
		// チェック情報
		var checkBox = $e_7('//*[@id="ckUnion"]');

		// 画面サイズの取得
		var viewSize;
		viewSize = getViewSize();
		if( viewSize == 51 ){
			// 51x51だといまのとこなにもできないので戻る

			return;
		}

		// 全体表示画面から、画面中央座標を手に入れる //
		var codx = $e_7('//div[@id="datas"]/input[@id=\"x\"]');
		var cody = $e_7('//div[@id="datas"]/input[@id=\"y\"]');
		var bx = codx.snapshotItem(0).value;
		var by = cody.snapshotItem(0).value;
		var sx;
		var sy;
		var ex;
		var ey;

		// 左上座標を求める
		if( viewSize == 11 ){
			sx = parseInt(bx) - 5;
			sy = parseInt(by) + 5;
		}
		else if( viewSize == 15 ){
			sx = parseInt(bx) - 7;
			sy = parseInt(by) + 7;
		}
		else{
			sx = parseInt(bx) - 10;
			sy = parseInt(by) + 10;
		}
		ex = parseInt(sx) + (parseInt(viewSize) - 1)
		ey = parseInt(sy) - (parseInt(viewSize) - 1)

		// chromeでクロスドメイン処理がうまくいかないので、とりあえずFireFox限定
		if( /*(browserType != "Chrome") &&*/ (checkBox.snapshotItem(0).checked == true) && (spreadsheet != "") ){	//faraway コメントにしてある
			GM_xmlhttpRequest({
				method:"GET",
				url:spreadsheet,
				onload:function(x){
					var rollover = $d("rollover");

					var textline = x.responseText.split('\n');

					var pos = -1;
					var user = -1;
					var pd = -1;
					var com = -1;
					var data = textline[0].split('\t');
					for( var j = 0; j < data.length; j++ ){
						if( data[j] == '座標' ){
							pos = j;
						}
						else if( data[j] == 'ユーザー' ){
							user = j;
						}
						else if( data[j] == '着弾時刻' ){
							pd = j;
						}
						else if( data[j] == '補足' ){
							com = j;
						}
					}

					// サーバー時間の取得
					var svdata = document.evaluate('//span[@id="server_time"]',
						document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
					var time_text = svdata.snapshotItem(0).textContent;
					var day = time_text.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/);
					var servertime = new Date(parseInt(day[1],10),parseInt(day[2],10)-1,parseInt(day[3],10),parseInt(day[4],10),parseInt(day[5],10),parseInt(day[6],10),0);

					if( (pos >= 0) && (user >=0) && (pd >= 0) ){
						var stack = new Array();
						for( var i = 1; i < textline.length; i++ ){
							var data = textline[i].split('\t');
							var posv = data[pos].match(/([-]*\d+),([-]*\d+)/);
							if((posv == null) || (posv.length < 2) || (posv[1] < sx) || (posv[1] > ex) || (posv[2] < ey) || posv[2] > sy ){
								// 画面外
								continue;
							}

							stack[0] = posv[1];
							stack[1] = posv[2];
							stack[2] = data[user];
							stack[3] = data[pd];

							var flagWill = false;	//other
							// 終了時間の取得
							day = stack[3].match(/(\d+)[\/-](\d+)[\/-](\d+) +(\d+):(\d+):(\d+)/);
							if((day == null) || (day.length < 7)){
								flagWill = true;
							}
							if(!flagWill) {
								var endtime = new Date(parseInt(day[1],10),parseInt(day[2],10)-1,parseInt(day[3],10),parseInt(day[4],10),parseInt(day[5],10),parseInt(day[6],10),0);

								var waittime = endtime.getTime() - servertime.getTime();
								if( waittime < 0 ){
									continue;
								}
							}
							// areaデータを取ってみる
							var area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + posv[1] + "&y=" + posv[2] + "#ptop\"]");
							if( area_pos == null ){
								area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + posv[1] + "&y=" + posv[2] + "\"]");
							}
							var list3 = area_pos.getAttribute("onmouseover").match(/'(\d+)px', '(\d+)px/);

							var puttext = !flagWill ? "　" + stack[2] + "　" + stack[3] : '　予定ルート';
							if( com != -1 ){
								if( data[com] != undefined ){
									puttext += "　" + data[com];
								}
							}
							area_pos.title = area_pos.alt;
							area_pos.title += puttext;

							// クリックしたポイントに画像を埋め込む
							var img = d_7.createElement("img");
							img.style.position = "absolute";

							img.style.left = list3[1] + "px";
							img.style.top = list3[2] + "px";

							// アイコンの決定
							if(flagWill) {
								img.name = "RootIcon";
								img.src = root_icon;
							} else {
								img.src = atk_icon;
								img.name = "atkIcon";
							}
							if( viewSize == 15 ){
								img.style.width = "44px";
								img.style.height = "44px";
								img.style.zIndex = 227;
							} else if( viewSize == 21 ){
								img.style.width = "33px";
								img.style.height = "33px";
								img.style.zIndex = 444;
							} else {
								img.style.width = "60px";
								img.style.height = "60px";
								img.style.zIndex = 123;
							}
							rollover.parentNode.insertBefore(img, rollover.nextSibling);
						}
					}
				}
			});
		}
	}


	//------------------------//
	// 文字列の長さをチェック //
	//------------------------//
	function jstrlen(str, i) {
	   var len = 0;
	   str = escape(str);
	   for (i = 0; i < str.length; i++, len++) {
		  if (str.charAt(i) == "%") {
			 if (str.charAt(++i) == "u") {
				i += 3;
				len++;
			 }
			 i++;
		  }
	   }
	   return len;
	}

	//----------//
	// 桁数整形 //
	//----------//
	function formatRightNumber( num, length ){
		var fix = '	  ';
		var str;
		var result = '';

		str = num.toString(10);
		if( str.length < length ){
			result = fix.substr(0,length - str.length) + str;
		}
		else{
			result = str;
		}

		return result;
	}

	//--------------------------------//
	// アイコン表示（レベル表示のみ） //
	//--------------------------------//
	function disp_AreaIcon(cx,cy,num,viewSize,group_flg)
	{
		var area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + cx + "&y=" + cy + "#ptop\"]");
		if( area_pos == null ){
			area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + cx + "&y=" + cy + "\"]");
		}

		var dat = area_pos.getAttribute("onmouseover");
		dat = dat.replace(/^.*overOperation/, "setArea");
		dat = dat.replace(/\);.*$/, '');
		dat = dat + ',' + num + ',' + viewSize + ',' + group_flg + ');';
		eval(dat);

		function setArea(act, x, y, num, viewSize, group_flg)
		{
			var rollover = $d("rollover");

			//--------------//
			// ホスト名判別 //
			//--------------//
			var hosttype = "";
			if(	(location.hostname.indexOf("1kibaku") == -1)
				&& (location.hostname.indexOf("legend") == -1) ){
				hosttype = "0";
			}

			//------------------//
			// 旧マップ使用判定 //
			//------------------//
			var old = false;
			if( group_flg >= 100 ){
				// 100より大きい場合は☆数表示あり
				var img = d_7.createElement("img");
				img.style.position = "absolute";

				img.style.left = x;
				var t = (y.substr(0,y.length-2));

				img.name = "viewIcon";

				if( viewSize == 15 ){
					img.src = icon_c_7[1][num];
					img.style.zIndex = 226;
					img.style.top = (parseInt(t) + 3) + "px";
				} else if( viewSize == 21 ){
					img.src = icon_c_7[2][num];
					img.style.zIndex = 443;
					img.style.top = (parseInt(t) + 3) + "px";
				} else {
					img.src = icon_c_7[0][num];
					img.style.zIndex = 122;
					img.style.top = (parseInt(t) + 0) + "px";
				}
				rollover.parentNode.insertBefore(img, rollover.nextSibling);
			}

			if( (group_flg % 100) > 0 ){
				// カラー指定があるばあいは、枠を表示
				var img2 = d_7.createElement("img");
				img2.style.position = "absolute";

				img2.name = "viewIcon";

				var iconNo = group_flg % 100;
				if( viewSize == 15 ){
					img2.src = icon_2[iconNo];
					img2.style.width = "44px";
					img2.style.height = "44px";
					img2.style.zIndex = 226;

					if( (hosttype == "0") && (old != true) ){
						img2.style.left = x;
						img2.style.top = parseInt(y.substr(0,y.length-2)) + 2 + "px";
					}
					else{
						img2.style.left = x;
						img2.style.top = y;
					}
				} else if( viewSize == 21 ){
					img2.src = icon_2[iconNo];
					img2.style.width = "33px";
					img2.style.height = "33px";
					img2.style.zIndex = 443;

					if( (hosttype == "0") && (old != true) ){
						img2.style.left = parseInt(x.substr(0,x.length-2)) + 1 + "px";
						img2.style.top = parseInt(y.substr(0,y.length-2)) + 4 + "px";
					}
					else{
						img2.style.left = x;
						img2.style.top = parseInt(y.substr(0,y.length-2)) + 1 + "px";
					}
				} else {
					img2.src = icon_2[iconNo];
					img2.style.width = "60px";
					img2.style.height = "60px";
					img2.style.zIndex = 122;

					if( (hosttype == "0") && (old != true) ){
						img2.style.left = parseInt(x.substr(0,x.length-2)) + 1 + "px";
						img2.style.top = parseInt(y.substr(0,y.length-2)) + 2 + "px";
					}
					else{
						img2.style.left = x;
						img2.style.top = y;
					}
				}
				rollover.parentNode.insertBefore(img2, rollover.nextSibling);
			}
		}

	}

	//----------------------------//
	// アイコン表示（資源モード） //
	//----------------------------//
	function disp_AreaIcon2(cx,cy,num,viewSize,group_flg,maxtype)
	{
		var area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + cx + "&y=" + cy + "#ptop\"]");
		if( area_pos == null ){
			area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + cx + "&y=" + cy + "\"]");
		}
		var dat = area_pos.getAttribute("onmouseover");
		dat = dat.replace(/^.*overOperation/, "setArea");
		dat = dat.replace(/\);.*$/, '');
		dat = dat + ',' + num + ',' + viewSize + ',' + group_flg + ',' + maxtype + ');';
		eval(dat);

		function setArea(act, x, y, num, viewSize, group_flg, maxtype)
		{
			var rollover = $d("rollover");

			//--------------//
			// ホスト名判別 //
			//--------------//
			var hosttype = "";
			if(	(location.hostname.indexOf("1kibaku") == -1)
				&& (location.hostname.indexOf("legend") == -1) ){
				hosttype = "0";
			}

			var old = false;
			if( group_flg % 1000 >= 100 ){
				// 100より大きい場合は☆数表示あり
				var img = d_7.createElement("img");
				img.style.position = "absolute";

				img.style.left = x;
				var t = (y.substr(0,y.length-2));

				img.name = "viewIcon";

				if( viewSize == 15 ){
					img.src = icon_cs[1][num*5+maxtype];
					img.style.zIndex = 226;
					img.style.top = (parseInt(t) + 3) + "px";
				} else if( viewSize == 21 ){
					img.src = icon_cs[2][num*5+maxtype];
					img.style.zIndex = 443;
					img.style.top = (parseInt(t) + 3) + "px";
				} else {
					img.src = icon_cs[0][num*5+maxtype];
					img.style.zIndex = 122;
					img.style.top = (parseInt(t) + 0) + "px";
				}
				rollover.parentNode.insertBefore(img, rollover.nextSibling);
			}

			if( (group_flg % 100) > 0 ){
				// カラー指定があるばあいは、枠を表示
				var img2 = d_7.createElement("img");
				img2.style.position = "absolute";

				img2.name = "viewIcon";

				var iconNo = group_flg % 100;
				if( viewSize == 15 ){
					img2.src = icon_2[iconNo];
					img2.style.width = "44px";
					img2.style.height = "44px";
					img2.style.zIndex = 226;

					if( (hosttype == "0") && (old != true) ){
						img2.style.left = x;
						img2.style.top = parseInt(y.substr(0,y.length-2)) + 2 + "px";
					}
					else{
						img2.style.left = x;
						img2.style.top = y;
					}
				} else if( viewSize == 21 ){
					img2.src = icon_2[iconNo];
					img2.style.width = "33px";
					img2.style.height = "33px";
					img2.style.zIndex = 443;

					if( (hosttype == "0") && (old != true) ){
						img2.style.left = parseInt(x.substr(0,x.length-2)) + 1 + "px";
						img2.style.top = parseInt(y.substr(0,y.length-2)) + 4 + "px";
					}
					else{
						img2.style.left = x;
						img2.style.top = parseInt(y.substr(0,y.length-2)) + 1 + "px";
					}
				} else {
					img2.src = icon_2[iconNo];
					img2.style.width = "60px";
					img2.style.height = "60px";
					img2.style.zIndex = 122;

					if( (hosttype == "0") && (old != true) ){
						img2.style.left = parseInt(x.substr(0,x.length-2)) + 1 + "px";
						img2.style.top = parseInt(y.substr(0,y.length-2)) + 2 + "px";
					}
					else{
						img2.style.left = x;
						img2.style.top = y;
					}
				}
				rollover.parentNode.insertBefore(img2, rollover.nextSibling);
			}
			if( Math.floor(group_flg / 1000) > 0 ){
				// 強調指定があるばあいは、強調★を表示
				var img3 = d_7.createElement("img");
				img3.style.position = "absolute";

				img3.style.left = x;
				var t = (y.substr(0,y.length-2));

				img3.name = "viewIcon";

				var pow = Math.floor(group_flg / 1000) - 1;
				if( viewSize == 15 ){
					img3.src = icon_3[pow*3+2];
					img3.style.width = "44px";
					img3.style.height = "44px";
					img3.style.zIndex = 227;
					img3.style.top = (parseInt(t) + 3) + "px";
				} else if( viewSize == 21 ){
					img3.src = icon_3[pow*3+1];
					img3.style.width = "33px";
					img3.style.height = "33px";
					img3.style.zIndex = 443;
					img3.style.top = (parseInt(t) + 3) + "px";
				} else {
					img3.src = icon_3[pow*3+3];
					img3.style.width = "60px";
					img3.style.height = "60px";
					img3.style.zIndex = 123;
					img3.style.top = (parseInt(t) + 0) + "px";
				}
				rollover.parentNode.insertBefore(img3, rollover.nextSibling);
			}
		}

	}

	//--------------//
	// データロード //
	//--------------//
	function loadExecFlag(hostname, key) {
		var datakey = new String();
		datakey = hostname + VERSION_KEY + key;

		var ret = new String();
		var src = CookieRead(datakey);
		if (src == "") return ret;

		return src;
	}

	//--------------//
	// データセーブ //
	//--------------//
	function saveExecFlag(hostname, key, data) {

		var datakey = new String();
		datakey = hostname + VERSION_KEY + key;

		CookieWrite(datakey, data, 30);
	}

	//----------------------//
	// クッキーへの書き込み //
	//----------------------//
	function CookieWrite(kword, kdata, kday)
	{
		if(!navigator.cookieEnabled){	// クッキーが利用可能かどうか
			alert("クッキーへの書き込みができません");
			return;
		}

		sday = new Date();
		sday.setTime(sday.getTime() + (kday * 1000 * 60 * 60 * 24));
		s2day = sday.toGMTString();
		document.cookie = kword + "=" + escape(kdata) + ";expires=" + s2day;
	}

	//----------------------//
	// クッキーから読み込み //
	//----------------------//
	function CookieRead(kword)
	{
		if(typeof(kword) == "undefined"){	// キーワードなし
			return "";	// 何もしないで戻る
		}

		kword = kword + "=";
		kdata = "";
		scookie = document.cookie + ";";	// クッキー情報を読み込む
		start = scookie.indexOf(kword);		// キーワードを検索
		if (start != -1){
			// キーワードと一致するものあり
			end = scookie.indexOf(";", start);	// 情報の末尾位置を検索
			kdata = unescape(scookie.substring(start + kword.length, end));	// データ取り出し
		}

		return kdata;
	}

	//------------//
	// HTMLの生成 //
	//------------//
	function addHtml_7() {
		var dv;
		var dv2;

		var body = $e_7('//body');
		if( body.snapshotLength > 0 ){
			body.snapshotItem(0).addEventListener("mousedown", function(e) {if(e.button == 2){checkData(e);}}, true);
			body.snapshotItem(0).innerHTML = body.snapshotItem(0).innerHTML.replace(/\u2028/g," ");
		}

		//----------------//
		// コンテナの取得 //
		//----------------//
		var container;
		var mapbox = $e_7('//*[@id="mapboxInner"]');
		if (mapbox.snapshotLength == 0) {
			container = document.body;
		} else {
			container = mapbox.snapshotItem(0);
		}

		//--------------------------------------//
		// チェックボックスに関する情報をロード //
		//--------------------------------------//
		var chkflg1;
		var chkflg2;
		execFlag = loadExecFlag(location.hostname, "FLAG0");
		if( execFlag == "" ){
			// 表示フラグをロード
			var execFlag1 = loadExecFlag(location.hostname, "FLAG1");
			if( execFlag1 == "" ){
				chkflg1 = new String(FLAG1);  // 初期値
			}
			else{
				chkflg1 = execFlag1;
			}

			// オプションフラグをロード
			var execFlag2 = loadExecFlag(location.hostname, "FLAG2");
			if( execFlag2 == "" ){
				chkflg2 = new String(FLAG2);  // 初期値
			}
			else{
				chkflg2 = execFlag2;
			}

			// 初回のときは、フラグを保存
			execFlag = chkflg1 + DELIMIT1_7 + chkflg2;
			saveExecFlag(location.hostname, "FLAG0", execFlag);
		}
		else{
			var loadflg = new Array();
			loadflg = execFlag.split(DELIMIT1_7);
			chkflg1 = loadflg[0];
			chkflg2 = loadflg[1];
		}

		// 個人、同盟検索情報をロード
		var chkflg3 = new Array();
		var execFlag = loadExecFlag(location.hostname, "FLAG3");
		if( execFlag == "" ){
			var execFlag3 = loadExecFlag(location.hostname, "FLAG3-1");
			if( execFlag3 == "" ){
				chkflg3[0] = new String(FLAG3_1);  // 初期値
			}
			else{
				chkflg3[0] = execFlag3;
			}
			execFlag3 = loadExecFlag(location.hostname, "FLAG3-2");
			if( execFlag3 == "" ){
				chkflg3[1] = new String(FLAG3_2);  // 初期値
			}
			else{
				chkflg3[1] = execFlag3;
			}
			execFlag3 = loadExecFlag(location.hostname, "FLAG3-3");
			if( execFlag3 == "" ){
				chkflg3[2] = new String(FLAG3_3);  // 初期値
			}
			else{
				chkflg3[2] = execFlag3;
			}

			// 初回のときは、フラグを保存
			execFlag = chkflg3[0] + DELIMIT1_7 + chkflg3[1] + DELIMIT1_7 + chkflg3[2];
			saveExecFlag(location.hostname, "FLAG3", execFlag);
		}
		else{
			chkflg3 = execFlag.split(DELIMIT1_7);
		}

		// 出兵情報共有設定
		var chkflg4;
		execFlag = loadExecFlag(location.hostname, "FLAG4");
		if( execFlag == "" ){
			chkflg4 = new String(FLAG4);  // 初期値

			// 初回のときは、フラグを保存
			execFlag = chkflg4;
			saveExecFlag(location.hostname, "FLAG4", execFlag);
		}
		else{
			chkflg4 = execFlag;
		}

		//--------------------------------------//
		// 画面生成							 //
		//--------------------------------------//
		var textLabel;
		var button1;
		var textArea;

		//----------------//
		//-- ヘッダー部 --//
		//----------------//
		//-- コントロール配置DIV --//
		var linksDiv = document.createElement("div");
		container.appendChild(linksDiv);

		//-- ツール名称ラベル --//
		textLabel = document.createElement("span");
		textLabel.id = "toolLabel";
		textLabel.style.fontSize = "16px";
		textLabel.innerHTML = "<br><b>NPC砦、領土情報検索ツール Ver." + VERSION_7 + "</b>";
		textLabel.style.color = "black";
		linksDiv.appendChild(textLabel);

		//-- 更新ボタン --//
		button1 = document.createElement("input");
		button1.type = "button";
		button1.id = "ckButton1";
		button1.style.fontSize = "12px";
		button1.style.marginLeft = "6px";
		button1.value = "選択した条件で表示を更新";
		button1.addEventListener("click", function() {updateButtonClicked()}, true);
		linksDiv.appendChild(button1);

		//-- ★セットボタン --//
		button1 = document.createElement("input");
		button1.type = "button";
		button1.id = "ckButton2a";
		button1.style.fontSize = "12px";
		button1.style.marginLeft = "6px";
		button1.value = "★のチェックを付ける";
		button1.addEventListener("click", function() {checkButtonClicked()}, true);
		linksDiv.appendChild(button1);

		//-- ★解除ボタン --//
		button1 = document.createElement("input");
		button1.type = "button";
		button1.id = "ckButton2";
		button1.style.fontSize = "12px";
		button1.style.marginLeft = "6px";
		button1.value = "★のチェックを外す";
		button1.addEventListener("click", function() {uncheckButtonClicked()}, true);
		linksDiv.appendChild(button1);

		//-- (改行) --//
		textLabel = document.createElement("span");
		textLabel.innerHTML = "<br>";
		linksDiv.appendChild(textLabel);

		//--------------------//
		//-- 検索オプション --//
		//--------------------//
		var checkbox;
		var ckLabel;
		var userBox;
		var listbox;
		var colorNo;
		var areaNo;
		var img;

		var optionPre = document.createElement("pre");
		optionPre.style.fontSize = "14px";
		optionPre.style.color = "black";
		optionPre.style.backgroundColor = "#ffffcc";
		optionPre.style.width = "750px";
		optionPre.style.height = "100%";
		optionPre.style.border = "solid 2px";
		optionPre.style.padding = "2px";
		optionPre.style.marginTop = "2px";
		linksDiv.appendChild(optionPre);

		//-- 検索・表示オプション見出し --//
		textLabel = document.createElement("span");
		textLabel.style.fontSize = "14px";
		textLabel.id = "test";
		textLabel.innerHTML = "<font color=\"red\"><b>検索対象</b></font>";
		optionPre.appendChild(textLabel);

		chkbox = document.createElement("input");
		chkbox.type = "checkbox";
		chkbox.id = "ckMenu2";
		chkbox.style.marginLeft = "400px";
		if( chkflg2.charAt(FLAG2_MENU2) == '1' ){
			chkbox.checked = true;
		}
		chkbox.addEventListener("click", function() {menu2Clicked()}, true);
		optionPre.appendChild(chkbox);

		// 補助オプション表示切り替え
		textLabel = document.createElement("span");
		textLabel.style.marginLeft = "4px";
		textLabel.style.fontSize = "14px";
		textLabel.innerHTML = "<font color=\"blue\"><b>補助OPTION表示</b></font>";
		optionPre.appendChild(textLabel);

		chkbox = document.createElement("input");
		chkbox.type = "checkbox";
		chkbox.id = "ckMenu4";
		chkbox.style.marginLeft = "14px";
		if( chkflg2.charAt(FLAG2_MENU4) == '1' ){
			chkbox.checked = true;
		}
		chkbox.addEventListener("click", function() {menu4Clicked()}, true);
		optionPre.appendChild(chkbox);

		// 同盟オプション表示切り替え
		textLabel = document.createElement("span");
		textLabel.style.marginLeft = "4px";
		textLabel.style.fontSize = "14px";
		textLabel.innerHTML = "<font color=\"blue\"><b>同盟OPTION表示</b></font><br>";
		optionPre.appendChild(textLabel);

		// 空き地検索
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckEmpty";
		chkbox.style.marginLeft = "15px";
		if( chkflg2.charAt(FLAG2_EMPTY) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "空き地検索";
		optionPre.appendChild(ckLabel);

		// 領土検索
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckLand";
		chkbox.style.marginLeft = "15px";
		if( chkflg2.charAt(FLAG2_LAND) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "領土検索";
		optionPre.appendChild(ckLabel);

		//-- ルート構築モード --//
		// ルート構築モードチェックボックス
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckRouteMode";
		chkbox.style.marginLeft = "15px";
		chkbox.addEventListener("click", function() {routeModeChecked()}, true);
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "<font color=\"green\"><b>ルート構築モード（</b></font>";
		optionPre.appendChild(ckLabel);

		// 資源情報出力なしチェックボックス
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckRouteMode2";
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "<font color=\"green\"><b>資源情報なし</b></font>";
		optionPre.appendChild(ckLabel);

		// 自動ルート構築チェックボックス
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.style.marginLeft = "14px";
		chkbox.type = "checkbox";
		chkbox.id = "ckAutoRouteMode";
		chkbox.addEventListener("click", function() {autoRouteModeChecked()}, true);
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "<font color=\"green\"><b>ルート自動構築）</b></font>";
		optionPre.appendChild(ckLabel);

		// （ギャップ埋め）
		ckLabel = document.createElement("pre");
		ckLabel.style.height = "2px";
		optionPre.appendChild(ckLabel);

		//-- ルート自動構築オプション見出し --//
		textLabel = document.createElement("pre");
		textLabel.style.fontSize = "14px";
		textLabel.style.marginTop = "2px";
		textLabel.innerHTML = "<font color=\"green\"><b>ルート自動構築条件設定</b></font><br>";
		optionPre.appendChild(textLabel);

		// 探査レベル
		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "15px";
		ckLabel.innerHTML = "探索レベル";
		optionPre.appendChild(ckLabel);

		areaNo = parseInt(chkflg2.charAt(FLAG2_SEARCH_LEVEL));
		listbox = document.createElement("select");
		listbox.id = "lsRouteLevel";
		for( var i = 0; i < croutename.length; i++ ){
			var opt = document.createElement("option");
			opt.id = i;
			var str = document.createTextNode(croutename[i]);
			opt.appendChild(str);
			listbox.appendChild(opt);
		}
		listbox.style.marginLeft = "4px";
		listbox.selectedIndex = areaNo;
		optionPre.appendChild(listbox);

		// 資源回避レベル
		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "14px";
		ckLabel.innerHTML = "回避資源";
		optionPre.appendChild(ckLabel);

		areaNo = parseInt(chkflg2.charAt(FLAG2_SKIP_RES));
		listbox = document.createElement("select");
		listbox.id = "lsSkipRes";
		for( var i = 0; i < croutelim.length; i++ ){
			var opt = document.createElement("option");
			opt.id = i;
			var str = document.createTextNode(croutelim[i]);
			opt.appendChild(str);
			listbox.appendChild(opt);
		}
		listbox.style.marginLeft = "4px";
		listbox.selectedIndex = areaNo;
		optionPre.appendChild(listbox);

		// 個人領土回避
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckRouteUser";
		chkbox.style.marginLeft = "14px";
		if( chkflg2.charAt(FLAG2_SKIP_USER) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "個人領地を通過（";
		optionPre.appendChild(ckLabel);

		// 通過同盟指定
		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "個人・同盟";
		optionPre.appendChild(ckLabel);

		areaNo = parseInt(chkflg2.charAt(FLAG2_SKIP_GROUP));
		listbox = document.createElement("select");
		listbox.id = "lsSkipGroup";
		for( var i = 0; i < groupname.length; i++ ){
			var opt = document.createElement("option");
			opt.id = i;
			var str = document.createTextNode(groupname[i]);
			opt.appendChild(str);
			listbox.appendChild(opt);
		}
		listbox.style.marginLeft = "4px";
		listbox.selectedIndex = areaNo;
		optionPre.appendChild(listbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "）";
		optionPre.appendChild(ckLabel);

		// 可変ルート
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckRouteRandom";
		chkbox.style.marginLeft = "10px";
		if( chkflg2.charAt(FLAG2_RANDOM_ROUTE) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "可変ルート";
		optionPre.appendChild(ckLabel);

		// （ギャップ埋め）
		ckLabel = document.createElement("pre");
		ckLabel.style.height = "2px";
		optionPre.appendChild(ckLabel);

		//-- 検索・表示オプション２見出し --//
		// 項目ラベル
		textLabel = document.createElement("pre");
		textLabel.id = "Label2-1";
		textLabel.style.fontSize = "14px";
		textLabel.innerHTML = "<font color=\"red\"><b>表示補助</b></font><br>";
		optionPre.appendChild(textLabel);

		// 資源判別
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckAnalyze";
		chkbox.style.marginLeft = "15px";
		if( chkflg2.charAt(FLAG2_ANALYZE) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "資源別に着色";
		ckLabel.id = "Label2-2";
		optionPre.appendChild(ckLabel);

		// 資源判別（強調表示）
		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "0px";
		ckLabel.innerHTML = "（強調表示";
		ckLabel.id = "Label2-3";
		optionPre.appendChild(ckLabel);

		// 強調種別選択１
		areaNo = parseInt(chkflg2.substr(FLAG2_STRONG_AREANO,3));
		if( areaNo > season1.length ){
			areaNo = 0;
		}
		listbox = document.createElement("select");
		listbox.id = "lsArea";
		for( var i = 0; i < season1.length; i++ ){
			var opt = document.createElement("option");
			opt.id = i;
			var str = document.createTextNode(season1[i][0]);
			opt.appendChild(str);
			listbox.appendChild(opt);
		}
		listbox.style.marginLeft = "4px";
		listbox.selectedIndex = areaNo;
		optionPre.appendChild(listbox);

		// 強調種別選択２
		areaNo = parseInt(chkflg2.substr(FLAG2_STRONG_AREANO2,3));
		if( areaNo > season1.length ){
			areaNo = 0;
		}
		listbox = document.createElement("select");
		listbox.id = "lsArea2";
		for( var i = 0; i < season1.length; i++ ){
			var opt = document.createElement("option");
			opt.id = i;
			var str = document.createTextNode(season1[i][0]);
			opt.appendChild(str);
			listbox.appendChild(opt);
		}
		listbox.style.marginLeft = "4px";
		listbox.selectedIndex = areaNo;
		optionPre.appendChild(listbox);

		// 強調種別選択３
		areaNo = parseInt(chkflg2.substr(FLAG2_STRONG_AREANO3,3));
		if( areaNo > season1.length ){
			areaNo = 0;
		}
		listbox = document.createElement("select");
		listbox.id = "lsArea3";
		for( var i = 0; i < season1.length; i++ ){
			var opt = document.createElement("option");
			opt.id = i;
			var str = document.createTextNode(season1[i][0]);
			opt.appendChild(str);
			listbox.appendChild(opt);
		}
		listbox.style.marginLeft = "4px";
		listbox.selectedIndex = areaNo;
		optionPre.appendChild(listbox);

		// 閉じかっこ
		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "0px";
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "）<br>";
		ckLabel.id = "Label2-4";
		optionPre.appendChild(ckLabel);

		// 空き地を着色
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckEmptyDraw";
		chkbox.style.marginLeft = "15px";
		if( chkflg2.charAt(FLAG2_EMPTY_DRAW) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "空き地を着色";
		ckLabel.id = "Label2-5";
		optionPre.appendChild(ckLabel);

		// カラー選択
		colorNo = chkflg2.charAt(FLAG2_EMPTY_DRAW_COLOR);

		listbox = document.createElement("select");
		listbox.id = "lsEmptyColor";
		for( var i = 0; i < cname.length; i++ ){
			var opt = document.createElement("option");
			opt.id = i;
			var str = document.createTextNode(cname[i]);
			opt.appendChild(str);
			listbox.appendChild(opt);
		}
		listbox.style.marginLeft = "4px";
		listbox.selectedIndex = colorNo;
		optionPre.appendChild(listbox);

		// レーダー
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckRader";
		chkbox.style.marginLeft = "15px";
		if( chkflg2.charAt(FLAG2_RADER) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "縮小マップ";
		ckLabel.id = "Label2-6";
		optionPre.appendChild(ckLabel);

		// 本拠地一覧
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckOwnerList";
		chkbox.style.marginLeft = "15px";
		if( chkflg2.charAt(FLAG2_OWNER) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "本拠地一覧";
		ckLabel.id = "Label2-7";
		optionPre.appendChild(ckLabel);

		// 方位表示
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckDirection";
		chkbox.style.marginLeft = "15px";
		if( chkflg2.charAt(FLAG2_DIRECTION) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "方位表示";
		ckLabel.id = "Label2-8";
		optionPre.appendChild(ckLabel);

		// 51x51画面で本ツールを使わない
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckNoExec51";
		chkbox.style.marginLeft = "15px";
		if( chkflg2.charAt(FLAG2_NOEXEC51) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "51x51で使用しない";
		ckLabel.id = "Label2-9";
		optionPre.appendChild(ckLabel);

		//-- 表示対象オプション見出し --//
		textLabel = document.createElement("pre");
		textLabel.style.fontSize = "14px";
		textLabel.style.marginTop = "2px";
		textLabel.innerHTML = "<font color=\"red\"><b>表示する領土の種類</b></font><br>";
		optionPre.appendChild(textLabel);

		// NPC砦
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckNPC";
		chkbox.style.marginLeft = "15px";
		if( chkflg1.charAt(FLAG1_NPC) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "NPC砦";
		optionPre.appendChild(ckLabel);

		// ☆1
		chkbox = document.createElement("input");
		chkbox.type = "checkbox";
		chkbox.id = "ckLevel1";
		chkbox.style.marginLeft = "10px";
		if( chkflg1.charAt(FLAG1_LV1) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "☆1";
		optionPre.appendChild(ckLabel);

		// ☆2
		chkbox = document.createElement("input");
		chkbox.type = "checkbox";
		chkbox.id = "ckLevel2";
		chkbox.style.marginLeft = "10px";
		if( chkflg1.charAt(FLAG1_LV2) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "☆2";
		optionPre.appendChild(ckLabel);

		// ☆3
		chkbox = document.createElement("input");
		chkbox.type = "checkbox";
		chkbox.id = "ckLevel3";
		chkbox.style.marginLeft = "10px";
		if( chkflg1.charAt(FLAG1_LV3) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "☆3";
		optionPre.appendChild(ckLabel);

		// ☆4
		chkbox = document.createElement("input");
		chkbox.type = "checkbox";
		chkbox.id = "ckLevel4";
		chkbox.style.marginLeft = "10px";
		if( chkflg1.charAt(FLAG1_LV4) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "☆4";
		optionPre.appendChild(ckLabel);

		// ☆5
		chkbox = document.createElement("input");
		chkbox.type = "checkbox";
		chkbox.id = "ckLevel5";
		chkbox.style.marginLeft = "10px";
		if( chkflg1.charAt(FLAG1_LV5) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "☆5";
		optionPre.appendChild(ckLabel);

		// ☆6
		chkbox = document.createElement("input");
		chkbox.type = "checkbox";
		chkbox.id = "ckLevel6";
		chkbox.style.marginLeft = "10px";
		if( chkflg1.charAt(FLAG1_LV6) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "☆6";
		optionPre.appendChild(ckLabel);

		// ☆7
		chkbox = document.createElement("input");
		chkbox.type = "checkbox";
		chkbox.id = "ckLevel7";
		chkbox.style.marginLeft = "10px";
		if( chkflg1.charAt(FLAG1_LV7) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "☆7";
		optionPre.appendChild(ckLabel);

		// ☆8
		chkbox = document.createElement("input");
		chkbox.type = "checkbox";
		chkbox.id = "ckLevel8";
		chkbox.style.marginLeft = "10px";
		if( chkflg1.charAt(FLAG1_LV8) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "☆8";
		optionPre.appendChild(ckLabel);

		// ☆9
		chkbox = document.createElement("input");
		chkbox.type = "checkbox";
		chkbox.id = "ckLevel9";
		chkbox.style.marginLeft = "10px";
		if( chkflg1.charAt(FLAG1_LV9) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "☆9<br>";
		optionPre.appendChild(ckLabel);

		// （ギャップ埋め）
		ckLabel = document.createElement("pre");
		ckLabel.style.height = "2px";
		optionPre.appendChild(ckLabel);

		//-- 個人・同盟検索オプション見出し --//
		textLabel = document.createElement("pre");
		textLabel.style.fontSize = "14px";
		textLabel.innerHTML = "<font color=\"red\"><b>個人・同盟の検索</b></font><br>";
		textLabel.id = "Label4-1";
		optionPre.appendChild(textLabel);

		//-- 個人・同盟検索オプション１ --//
		// ナンバリング
		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "<font color='blue'><b>No.1</b></font>";
		ckLabel.style.marginLeft = "15px";
		ckLabel.id = "Label4-2-1";
		optionPre.appendChild(ckLabel);

		// 有効/無効
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckEnable1";
		chkbox.style.marginLeft = "8px";
		if( chkflg3[0].charAt(FLAG3_ENABLE) == '1' ){
			chkbox.checked = true;
		}
		chkbox.addEventListener("click", function() {enable1Checked()}, true);
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "有効にする";
		ckLabel.id = "Label4-2";
		optionPre.appendChild(ckLabel);

		// 個人
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "radio";
		chkbox.id = "ckType1";
		chkbox.name = "ckType1";
		chkbox.value = "1";
		chkbox.style.marginLeft = "8px";
		if( chkflg3[0].charAt(FLAG3_USER) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "個人";
		ckLabel.id = "Label4-3";
		optionPre.appendChild(ckLabel);

		// 同盟
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "radio";
		chkbox.id = "ckType1";
		chkbox.name = "ckType1";
		chkbox.value = "2";
		chkbox.style.marginLeft = "4px";
		if( chkflg3[0].charAt(FLAG3_GROUP) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "同盟";
		ckLabel.id = "Label4-4";
		optionPre.appendChild(ckLabel);

		// 完全一致
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckFullMatch1";
		chkbox.style.marginLeft = "8px";
		if( chkflg3[0].charAt(FLAG3_MATCH) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "完全一致";
		ckLabel.id = "Label4-5";
		optionPre.appendChild(ckLabel);

		// 個人・同盟名
		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "8px";
		ckLabel.innerHTML = "検索名称";
		ckLabel.id = "Label4-6";
		optionPre.appendChild(ckLabel);

		userBox = document.createElement("input");
		userBox.id = "userBox1";
		userBox.style.marginLeft = "4px";
		userBox.width = 240;
		if( chkflg3[0].charAt(FLAG3_ENABLE) == '1' ){
			userBox.disabled = false;
		}
		else{
			userBox.disabled = true;
		}
		userBox.value = chkflg3[0].substr(FLAG3_NAME);
		userBox.href = "javascript:void(0);";
		optionPre.appendChild(userBox);

		// 表示種別での絞り込み
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckLevelSearch1";
		chkbox.style.marginLeft = "8px";
		if( chkflg3[0].charAt(FLAG3_FILL) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "領土着色のみ";
		ckLabel.id = "Label4-7";
		optionPre.appendChild(ckLabel);

		// カラー選択
		ckLabel = document.createElement("span");
		ckLabel.style.marginTop = "1px";
		ckLabel.style.marginLeft = "8px";
		ckLabel.innerHTML = "枠色";
		ckLabel.id = "Label4-8";
		optionPre.appendChild(ckLabel);

		colorNo = chkflg3[0].charAt(FLAG3_COLOR);

		listbox = document.createElement("select");
		listbox.id = "lsColor1";
		for( var i = 0; i < cname.length; i++ ){
			var opt = document.createElement("option");
			opt.id = i;
			var str = document.createTextNode(cname[i]);
			opt.appendChild(str);
			listbox.appendChild(opt);
		}
		listbox.style.marginLeft = "4px";
		listbox.selectedIndex = colorNo;
		optionPre.appendChild(listbox);

		// (改行)
		textLabel = document.createElement("span");
		textLabel.innerHTML = "<br>";
		textLabel.id = "Label4-9";
		optionPre.appendChild(textLabel);

		//-- 個人・同盟検索オプション２ --//
		// ナンバリング
		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "<font color='blue'><b>No.2</b></font>";
		ckLabel.style.marginLeft = "15px";
		ckLabel.id = "Label4-2-2";
		optionPre.appendChild(ckLabel);

		// 有効/無効
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckEnable2";
		chkbox.style.marginLeft = "8px";
		if( chkflg3[1].charAt(FLAG3_ENABLE) == '1' ){
			chkbox.checked = true;
		}
		chkbox.addEventListener("click", function() {enable2Checked()}, true);
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "有効にする";
		ckLabel.id = "Label4-10";
		optionPre.appendChild(ckLabel);

		// 個人
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "radio";
		chkbox.id = "ckType2";
		chkbox.name = "ckType2";
		chkbox.value = "1";
		chkbox.style.marginLeft = "8px";
		if( chkflg3[1].charAt(FLAG3_USER) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "個人";
		ckLabel.id = "Label4-11";
		optionPre.appendChild(ckLabel);

		// 同盟
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "radio";
		chkbox.id = "ckType2";
		chkbox.name = "ckType2";
		chkbox.value = "2";
		chkbox.style.marginLeft = "4px";
		if( chkflg3[1].charAt(FLAG3_GROUP) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "同盟";
		ckLabel.id = "Label4-12";
		optionPre.appendChild(ckLabel);

		// 完全一致
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckFullMatch2";
		chkbox.style.marginLeft = "8px";
		if( chkflg3[1].charAt(FLAG3_MATCH) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "完全一致";
		ckLabel.id = "Label4-13";
		optionPre.appendChild(ckLabel);

		// 個人・同盟名
		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "8px";
		ckLabel.innerHTML = "検索名称";
		ckLabel.id = "Label4-14";
		optionPre.appendChild(ckLabel);

		userBox = document.createElement("input");
		userBox.id = "userBox2";
		userBox.style.marginLeft = "4px";
		userBox.width = 240;
		if( chkflg3[1].charAt(FLAG3_ENABLE) == '1' ){
			userBox.disabled = false;
		}
		else{
			userBox.disabled = true;
		}
		userBox.value = chkflg3[1].substr(FLAG3_NAME);
		userBox.href = "javascript:void(0);";
		optionPre.appendChild(userBox);

		// 表示種別での絞り込み
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckLevelSearch2";
		chkbox.style.marginLeft = "8px";
		if( chkflg3[1].charAt(FLAG3_FILL) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "領土着色のみ";
		ckLabel.id = "Label4-15";
		optionPre.appendChild(ckLabel);

		// カラー選択
		ckLabel = document.createElement("span");
		ckLabel.style.marginTop = "1px";
		ckLabel.style.marginLeft = "8px";
		ckLabel.innerHTML = "枠色";
		ckLabel.id = "Label4-16";
		optionPre.appendChild(ckLabel);

		colorNo = chkflg3[1].charAt(FLAG3_COLOR);

		listbox = document.createElement("select");
		listbox.id = "lsColor2";
		for( var i = 0; i < cname.length; i++ ){
			var opt = document.createElement("option");
			opt.id = i;
			var str = document.createTextNode(cname[i]);
			opt.appendChild(str);
			listbox.appendChild(opt);
		}
		listbox.style.marginLeft = "4px";
		listbox.selectedIndex = colorNo;
		optionPre.appendChild(listbox);

		// (改行)
		textLabel = document.createElement("span");
		textLabel.innerHTML = "<br>";
		textLabel.id = "Label4-17";
		optionPre.appendChild(textLabel);

		//-- 個人・同盟検索オプション３ --//
		// ナンバリング
		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "<font color='blue'><b>No.3</b></font>";
		ckLabel.style.marginLeft = "15px";
		ckLabel.id = "Label4-2-3";
		optionPre.appendChild(ckLabel);

		// 有効/無効
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckEnable3";
		chkbox.style.marginLeft = "8px";
		if( chkflg3[2].charAt(FLAG3_ENABLE) == '1' ){
			chkbox.checked = true;
		}
		chkbox.addEventListener("click", function() {enable3Checked()}, true);
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "有効にする";
		ckLabel.id = "Label4-18";
		optionPre.appendChild(ckLabel);

		// 個人
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "radio";
		chkbox.id = "ckType3";
		chkbox.name = "ckType3";
		chkbox.value = "1";
		chkbox.style.marginLeft = "8px";
		if( chkflg3[2].charAt(FLAG3_USER) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "個人";
		ckLabel.id = "Label4-19";
		optionPre.appendChild(ckLabel);

		// 同盟
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "radio";
		chkbox.id = "ckType3";
		chkbox.name = "ckType3";
		chkbox.value = "2";
		chkbox.style.marginLeft = "4px";
		if( chkflg3[2].charAt(FLAG3_GROUP) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "同盟";
		ckLabel.id = "Label4-20";
		optionPre.appendChild(ckLabel);

		// 完全一致
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckFullMatch3";
		chkbox.style.marginLeft = "8px";
		if( chkflg3[2].charAt(FLAG3_MATCH) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "完全一致";
		ckLabel.id = "Label4-21";
		optionPre.appendChild(ckLabel);

		// 個人・同盟名
		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "8px";
		ckLabel.innerHTML = "検索名称";
		ckLabel.id = "Label4-22";
		optionPre.appendChild(ckLabel);

		userBox = document.createElement("input");
		userBox.id = "userBox3";
		userBox.style.marginLeft = "4px";
		userBox.width = 240;
		if( chkflg3[2].charAt(FLAG3_ENABLE) == '1' ){
			userBox.disabled = false;
		}
		else{
			userBox.disabled = true;
		}
		userBox.value = chkflg3[2].substr(FLAG3_NAME);
		userBox.href = "javascript:void(0);";
		optionPre.appendChild(userBox);

		// 表示種別での絞り込み
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckLevelSearch3";
		chkbox.style.marginLeft = "8px";
		if( chkflg3[2].charAt(FLAG3_FILL) == '1' ){
			chkbox.checked = true;
		}
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "領土着色のみ";
		ckLabel.id = "Label4-23";
		optionPre.appendChild(ckLabel);

		// カラー選択
		ckLabel = document.createElement("span");
		ckLabel.style.marginTop = "1px";
		ckLabel.style.marginLeft = "8px";
		ckLabel.innerHTML = "枠色";
		ckLabel.id = "Label4-24";
		optionPre.appendChild(ckLabel);

		colorNo = chkflg3[2].charAt(FLAG3_COLOR);

		listbox = document.createElement("select");
		listbox.id = "lsColor3";
		for( var i = 0; i < cname.length; i++ ){
			var opt = document.createElement("option");
			opt.id = i;
			var str = document.createTextNode(cname[i]);
			opt.appendChild(str);
			listbox.appendChild(opt);
		}
		listbox.style.marginLeft = "4px";
		listbox.selectedIndex = colorNo;
		optionPre.appendChild(listbox);

		// （ギャップ埋め）
		ckLabel = document.createElement("pre");
		ckLabel.style.height = "2px";
		optionPre.appendChild(ckLabel);

		//-- 出兵情報共有見出し --//
		textLabel = document.createElement("pre");
		textLabel.style.fontSize = "14px";
		textLabel.style.marginTop = "2px";
		textLabel.innerHTML = "<font color=\"green\"><b>出兵情報共有設定</b></font><br>";
		optionPre.appendChild(textLabel);

		// 共有フラグ
		chkbox = document.createElement("input");
		chkbox.style.marginTop = "1px";
		chkbox.type = "checkbox";
		chkbox.id = "ckUnion";
		chkbox.style.marginLeft = "14px";
		if( chkflg4.charAt(0) == '1' ){
			chkbox.checked = true;
		}
		chkbox.addEventListener("click", function() {attackIconClear()}, true);
		optionPre.appendChild(chkbox);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "有効";
		optionPre.appendChild(ckLabel);

		// シート名
		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "8px";
		ckLabel.innerHTML = "スプレッドシートURL";
		ckLabel.id = "Label5-1";
		optionPre.appendChild(ckLabel);

		userBox = document.createElement("input");
		userBox.id = "userBox4";
		userBox.style.marginLeft = "4px";
		userBox.style.width = "500px";
		userBox.value = chkflg4.substr(1);
		userBox.href = "javascript:void(0);";
		optionPre.appendChild(userBox);

		// スプレッドシート名の加工
		if( chkflg4.charAt(0) == '1' ){
			spreadsheet = userBox.value.replace(/#gid/,"&gid") + "&output=txt";
		}

		// （ギャップ埋め）
		ckLabel = document.createElement("pre");
		ckLabel.style.height = "2px";
		optionPre.appendChild(ckLabel);

		//----------------------------//
		// 検索結果のテキスト表示領域 //
		//----------------------------//
		textArea = document.createElement("pre");
		textArea.id = "castleInfoText";
		textArea.innerHTML = "";
		textArea.style.fontSize = "14px";
		textArea.style.color = "black";
		textArea.style.backgroundColor = "#FFDEAD";
		textArea.style.width = "750px";
		textArea.style.height = "120px";
		textArea.style.overflow = "auto";
		textArea.style.border = "solid 2px";
		textArea.style.padding = "2px";
		textArea.style.marginTop = "-2px";
		linksDiv.appendChild(textArea);

		//------------------//
		// 部品描画先の設定 //
		//------------------//
		var target;
		if( $d("datas") == undefined ){
			target = "change-map-scale";
		}
		else{
			target = "datas";
		}

		//--------------//
		// ホスト名判別 //
		//--------------//
		var hosttype = location.hostname.substr(0,1);

		//----------------------------//
		// 縮小マップ描画エリアの定義 //
		//----------------------------//
		dv2 = d_7.createElement("div");
		dv2.style.display = "none";
		dv2.style.zIndex = 0;
		dv2.id = "smallmap_dv";
		dv2.style.fontSize= "10px";

		// データ描画用
		textArea = document.createElement("div");
		textArea.id = "smallmap";
		textArea.style.width = "66px";
		textArea.style.height = "66px";
		textArea.innerHTML = "";
		textArea.style.color = "black";
		textArea.innerHTML = "";
		textArea.style.borderTop = "solid white 2px";
		textArea.style.borderLeft = "solid white 2px";
		textArea.style.borderRight = "solid white 1px";
		textArea.style.borderBottom = "solid white 1px";
		// 51x51モードがある鯖
		if( hosttype == "m" ){
			textArea.style.position = "absolute";
			textArea.style.top = '40px';
			textArea.style.left = '5px';
		}
		dv2.appendChild(textArea);
		$d(target).appendChild(dv2);

		//----------------------------//
		// 本拠地情報描画エリアの定義 //
		//----------------------------//
		dv = d_7.createElement("div");
		dv.style.position = "absolute";
		if( add51_51mode == 0 ){
			// 51x51モードがない鯖
			dv.style.top = '16px';
			dv.style.left = '260px';
		}
		else{
			// mixi鯖とそれ以外
			if( hosttype == "m" ){
				dv.style.top = '380px';
				dv.style.left = '400px';
			}
			else{
				dv.style.top = '420px';
				dv.style.left = '400px';
			}
		}
		dv.style.fontSize= "10px";
		dv.style.display = "none";
		dv.id = "baseinfo_dv";
		dv.style.zIndex = 500;

		// レイアウト調整用
		textArea = document.createElement("pre");
		textArea.innerHTML = "";
		textArea.style.fontSize = "10px";
		textArea.innerHTML = "";
		dv.appendChild(textArea);

		dv2 = d_7.createElement("div");
		dv2.style.border = "solid 2px";
		dv2.style.borderColor = "transparent";
		dv.appendChild(dv2);

		// データ描画用
		textArea = document.createElement("pre");
		textArea.id = "baseInfoText";
		textArea.innerHTML = "";
		textArea.style.fontSize = "10px";
		textArea.style.color = "black";
		textArea.innerHTML = "";
		textArea.style.margin = "2px";
		dv2.appendChild(textArea);
		$d(target).appendChild(dv);

		//------------------//
		// ルート構築モード //
		//------------------//
		dv2 = d_7.createElement("div");
		dv2.style.position = "absolute";
		if( add51_51mode == 0 ){
			// 51x51モードがない鯖
			dv2.style.top = "24px";
			dv2.style.left = "420px";
		}
		else{
			// 51x51モードがある鯖

			if( location.pathname != "/big_map.php" ){
				if( location.hostname.substr(0,1) == "m" ){
					dv2.style.top = "54px";
					dv2.style.left = "430px";
				}
				else{
					dv2.style.top = "61px";
					dv2.style.left = "560px";
				}
			}
			else{
				if( location.hostname.substr(0,1) == "m" ){
					dv2.style.top = "0px";
					dv2.style.left = "430px";
				}
				else{
					dv2.style.top = "0px";
					dv2.style.left = "550px";
				}
			}
		}
		dv2.style.fontSize= "10px";
		dv2.style.width = "184px";
		dv2.style.zIndex = 500;
		dv2.style.display = "none";
		dv2.id = "routeField";
		$d(target).parentNode.appendChild(dv2);

		ckLabel = document.createElement("span");
		ckLabel.style.marginLeft = "4px";
		ckLabel.innerHTML = "<font color=\"blue\"><b>ルート構築ビュー</b></font>";
		dv2.appendChild(ckLabel);

		dv2 = d_7.createElement("div");
		dv2.style.position = "absolute";
		dv2.style.paddingLeft = "4px";
		if( add51_51mode == 0 ){
			// 51x51モードがない鯖
			dv2.style.top = "36px";
			dv2.style.left = "420px";
		}
		else{
			// 51x51モードがある鯖
			if( location.pathname != "/big_map.php" ){
				if( location.hostname.substr(0,1) == "m" ){
					dv2.style.top = "66px";
					dv2.style.left = "420px";
				}
				else{
					dv2.style.top = "73px";
					dv2.style.left = "560px";
				}
			}
			else{
				if( location.hostname.substr(0,1) == "m" ){
					dv2.style.top = "12px";
					dv2.style.left = "430px";
				}
				else{
					dv2.style.top = "12px";
					dv2.style.left = "550px";
				}
			}
		}
		dv2.style.fontSize= "10px";
		dv2.style.color= "blue";
		dv2.style.width = "184px";
		if( location.hostname.substr(0,1) == "m" ){
			if( location.pathname != "/big_map.php" ){
				dv2.style.height = "70px";
			}
			else{
				dv2.style.height = "55px";
			}
		}
		else{
			if( location.pathname != "/big_map.php" ){
				dv2.style.height = "90px";
			}
			else{
				dv2.style.height = "55px";
			}
		}
		dv2.style.border = "1px black solid";
		dv2.style.backgroundColor = "#FFFFCC";
		dv2.style.zIndex = 500;
		dv2.style.overflowY = "scroll";
		dv2.style.display = "none";
		dv2.id = "routeField2";
		$d(target).parentNode.appendChild(dv2);

		ckLabel = document.createElement("text");
		ckLabel.id = "routeInfoText";
		ckLabel.innerHTML = "";
		dv2.appendChild(ckLabel);

		//-- 全選択ボタン --//
		var button1 = document.createElement("input");
		button1.style.position = "absolute";
		if( add51_51mode == 0 ){
			// 51x51モードがない鯖
			button1.style.top = "128px";
			button1.style.left = "525px";
		}
		else{
			// 51x51モードがある鯖
			if( location.pathname != "/big_map.php" ){
				if( location.hostname.substr(0,1) == "m" ){
					button1.style.top = "138px";
					button1.style.left = "525px";
				}
				else{
					button1.style.top = "165px";
					button1.style.left = "665px";
				}
			}
			else{
				if( location.hostname.substr(0,1) == "m" ){
					button1.style.top = "69px";
					button1.style.left = "535px";
				}
				else{
					button1.style.top = "69px";
					button1.style.left = "655px";
				}
			}
		}
		button1.style.zIndex = 500;
		button1.type = "button";
		button1.style.fontSize = "10px";
		button1.style.marginLeft = "6px";
		button1.value = "全選択";
		button1.style.display = "none";
		button1.id = "routeField5";
		button1.addEventListener("click", function() {routeSelectButtonClicked()}, true);
		$d(target).parentNode.appendChild(button1);

		//-- クリアボタン --//
		button1 = document.createElement("input");
		button1.style.position = "absolute";
		if( add51_51mode == 0 ){
			// 51x51モードがない鯖
			button1.style.top = "128px";
			button1.style.left = "570px";
		}
		else{
			// 51x51モードがある鯖
			if( location.pathname != "/big_map.php" ){
				if( location.hostname.substr(0,1) == "m" ){
					button1.style.top = "138px";
					button1.style.left = "570px";
				}
				else{
					button1.style.top = "165px";
					button1.style.left = "710px";
				}
			}
			else{
				if( location.hostname.substr(0,1) == "m" ){
					button1.style.top = "69px";
					button1.style.left = "580px";
				}
				else{
					button1.style.top = "69px";
					button1.style.left = "700px";
				}
			}
		}
		button1.style.zIndex = 500;
		button1.type = "button";
		button1.style.fontSize = "10px";
		button1.style.marginLeft = "6px";
		button1.value = "クリア";
		button1.style.display = "none";
		button1.id = "routeField3";
		button1.addEventListener("click", function() {routeClearButtonClicked()}, true);
		$d(target).parentNode.appendChild(button1);

		// インフォメーションエリア
		dv2 = d_7.createElement("div");
		dv2.style.position = "absolute";
		if( location.pathname != "/big_map.php" ){
			dv2.style.top = "450px";
			dv2.style.left = "145px";
		}
		else{
			if( location.hostname.substr(0,1) == "m" ){
				dv2.style.top = "90px";
				dv2.style.left = "430px";
			}
			else{
				dv2.style.top = "90px";
				dv2.style.left = "550px";
			}
		}
		dv2.style.width = "500px";
		dv2.style.zIndex = 500;
		dv2.id = "route_info";
		dv2.innerHTML = '';
		$d(target).parentNode.appendChild(dv2);

		//--------------//
		// メニュー制御 //
		//--------------//
		menu2Clicked();
		menu4Clicked();
	}

	//----------------//
	// ルート構築処理 //
	//----------------//
	function checkData(e){
		var rollover = $d("rollover");
		var checkBox = $e_7('//*[@id="ckRouteMode"]');
		var checkBox2 = $e_7('//*[@id="ckRouteMode2"]');
		var checkBox3 = $e_7('//*[@id="ckAutoRouteMode"]');
		var baseText = $e_7('//*[@id="routeInfoText"]');

		//------------------//
		// 画面サイズの取得 //
		//------------------//
		var viewSize;
		viewSize = getViewSize();
		var enf = true;
		if( checkBox.snapshotLength > 0 ){
			// ルート構築モードがON
			if( checkBox.snapshotItem(0).checked == true ){
				// ルート構築モード
				enf = false;

				if( viewSize == 51 ){
					// 51x51モードの場合、他とは違う処理をする
					var elem;
					var elemhtml = "";

					// マウス直下の情報を取得
					var el = document.elementFromPoint(e.clientX, e.clientY);
					if( el != undefined ){
						if( el.tagName == "A" ){
							elem = el.parentNode;
						}
						else if( el.tagName == "FONT" ){
							elem = el.parentNode.parentNode.parentNode;
						}
						else{
							return;
						}
						elemhtml = elem.innerHTML;
					}

					// 自動構築モードがOFF
					if( checkBox3.snapshotItem(0).checked == false ){
						alert("51x51画面では、自動ルート構築のみ実施可能です。\n自動ルート構築をチェックしてください。");

						return;
					}

					var list2 = elemhtml.match(/x=([-]*\d+)&amp;y=([-]*\d+)#/);
					if( (list2 != null) && (list2 != undefined) ){
						// クリックタイミングにより取れない場合は飛ばすため

						if( (autoroute == AUTO_ROUTE_EDIT_LAST) && (autoroute_f[0] == list2[1]) && (autoroute_f[1] == list2[2]) ){
							// 終点＝始点の場合、経路情報を削除し、モードを戻す

							// 経路情報を消す
							getNPCCastleInfo_51(1);

							// モードを戻す
							autoroute = AUTO_ROUTE_EDIT_FIRST;

							// インフォメーションの更新
							autoRouteInfo();
						}
						else if( (autoroute == AUTO_ROUTE_EDIT_END) && (autoroute_l[0] == list2[1]) && (autoroute_l[1] == list2[2]) ){
							// 終了後に終点クリックの場合、始点以外を削除し、モードを戻す

							// 経路情報を消す
							getNPCCastleInfo_51(1);

							// ルートテキストをクリア
							baseText.snapshotItem(0).innerHTML = "";

							// モードを戻す
							autoroute = AUTO_ROUTE_EDIT_LAST;

							// インフォメーションの更新
							autoRouteInfo();
						}
						else{
							var newhtml;
							var vtext;

							var data = elemhtml.match(/<font.*>(.*)<\/font>/);

							// 座標の登録
							if( autoroute == AUTO_ROUTE_EDIT_FIRST ){
								autoroute_f[0] = list2[1];
								autoroute_f[1] = list2[2];
								autoroute_f[2] = data[1];

								// 表示テキスト
								vtext = "S";

								// モード変更
								autoroute = AUTO_ROUTE_EDIT_LAST;

								// インフォメーションの更新
								autoRouteInfo();
							}
							else if( autoroute == AUTO_ROUTE_EDIT_LAST ){
								autoroute_l[0] = list2[1];
								autoroute_l[1] = list2[2];
								autoroute_l[2] = data[1];

								// 表示テキスト
								vtext = "E";

								// モード変更
								autoroute = AUTO_ROUTE_EDIT_END;

								// インフォメーションの更新
								autoRouteInfo();
							}

							// テキスト設定
							if( elemhtml.indexOf("<b>") >= 0 ){
								newhtml = elemhtml.replace(/<b>.*<\/b>/,"<font style=\"text-shadow: -1px -1px 0 #FFF, 1px -1px 0 #FFF, -1px 1px 0 #FFF, 1px 1px 0 #FFF; color:red; border-style: solid; border-color: cyan; background-color:cyan;\">" + vtext + "</font>");
							}
							else{
								newhtml = elemhtml.replace(/<font.*>.*<\/font>/,"<font style=\"text-shadow: -1px -1px 0 #FFF, 1px -1px 0 #FFF, -1px 1px 0 #FFF, 1px 1px 0 #FFF; border-style: solid; border-color: cyan; color:red; background-color:cyan;\">" + vtext + "</font>");
							}

							// マークを画面上に表示
							elem.innerHTML = newhtml;

							if( autoroute == AUTO_ROUTE_EDIT_END ){
								// 始点、終点の設定がおわった

								// ルート構築チェック(引数"1"はルートチェック)
								if( makeAutoRoute_51("1") == false ){
									alert("目的地に到達するルートには到達できません。条件を見直してください。");

									// 経路情報を消す
									getNPCCastleInfo_51(1);

									// モードを戻す
									autoroute = AUTO_ROUTE_EDIT_LAST;

									// インフォメーションの更新
									autoRouteInfo();

									return;
								}


								// 確認
								if( window.confirm("この座標からルートを構築します") ){
									// ルート構築
									makeAutoRoute_51("0");
								}
								else{
									// 経路情報を消す
									getNPCCastleInfo_51(1);

									// モードを戻す
									autoroute = AUTO_ROUTE_EDIT_LAST;

									// インフォメーションの更新
									autoRouteInfo();
								}
							}
						}
					}

					// コンテキストメニュー制御
					var body = $e_7('//body');
					if( body.snapshotLength > 0 ){
						if( enf == false ){
							body.snapshotItem(0).setAttribute("onContextmenu","return false;");
						}
						else{
							body.snapshotItem(0).setAttribute("onContextmenu","return true;");
						}
					}

					return;
				}

				//---------------------------------//
				// 51x51モードでないルート構築処理 //
				//---------------------------------//
				// 自動構築モードがOFF
				if( checkBox3.snapshotItem(0).checked == false ){
					//----------------//
					// 手動ルート構築 //
					//----------------//

					var obj = $e_7('//*[@id="x_y"]');
					var obj2 = $e_7('//*[@id="power"]');
					var obj3 = $e_7('//*[@id="material"]');
					var obj4 = $e_7('//*[@id="village_name"]');
					if( obj.snapshotLength > 0 ){
						var data = obj.snapshotItem(0).textContent;
						data = data.replace(/ \/.*$/,"");
						var data2 = obj2.snapshotItem(0).textContent;
						var data3 = obj3.snapshotItem(0).textContent;
						var list = data3.match(/^. *(\d+) . *(\d+) . *(\d+) . *(\d+)/);
						var list2 = data.match(/^.([-]*\d+),([-]*\d+)/);
						if( list2 != null ){
							// クリックタイミングにより取れない場合は飛ばすため

							//----------------------//
							// クリックデータの処理 //
							//----------------------//
							// ルート構築テキストの取得
							var text = baseText.snapshotItem(0).innerHTML;

							// areaデータを取ってみる
							var area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + list2[1] + "&y=" + list2[2] + "#ptop\"]");
							if( area_pos == null ){
								area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + list2[1] + "&y=" + list2[2] + "\"]");
							}
							var list3 = area_pos.getAttribute("onmouseover").match(/'(\d+)px', '(\d+)px/);

							// すでに画像が登録されてるか調べる
							var ex = $e_7('//*[@id="' + list2[1] + '_' + list2[2] + '"]');
							if( ex.snapshotLength > 0 ){
								// 画像がいたら消す
								var ex2 = $x_7('//*[@id="' + list2[1] + '_' + list2[2] + '"]');
								var ex2_p = ex2.parentNode;
								ex2_p.removeChild(ex2);

								var fp = text.indexOf(list2[0]);
								var ep = text.indexOf("<br>",fp);
								if( ep == -1 ){
									if( fp == 0 ){
										text = text.substr(0,fp);
									}
									else{
										text = text.substr(0,fp-4);
									}
								}
								else{
									text = text.substr(0,fp) + text.substr(ep+4);
								}
								baseText.snapshotItem(0).innerHTML = text;

								// ルートチェックの再実行
								routeCheckButtonClicked();
							}
							else{
								// 画像がいなければルート追加
								var landLevel = data2.length;
								var dt = obj2.snapshotItem(0).innerHTML.match(/star_warpower_b.gif/);
								if( dt != null && dt.length > 0){
									// FaceBook Lands of Legends! 対応
									var stars = obj2.snapshotItem(0).innerHTML.match(/<img/g);
									landLevel = stars.length;
									list = data3.match(/Forest (\d+) Clay (\d+) Iron (\d+) Crop (\d+)/);
								}

								// 直前のルートからの距離を求める
								var errf = false;
								if( text != "" ){
									var p1 = text.lastIndexOf("<br>");
									var p2 = text.indexOf("×");
									var pos = new Array();
									if( p1 != -1 ){
										pos = text.substr(p1+4).match(/^\(([-]*\d+),([-]*\d+)/);
									}
									else{
										pos = text.match(/^\(([-]*\d+),([-]*\d+)/);
									}

									var dx = Math.abs(parseInt(pos[1]) - parseInt(list2[1]));
									var dy = Math.abs(parseInt(pos[2]) - parseInt(list2[2]));
									if( (dx >= 2) || (dy >= 2) || (p2 != -1) ){
										// 距離2以上か、すでに×アイコンがあればエラーアイコン
										errf = true;
									}
								}

								// テキストの更新
								if( text != "" ){
									text = text + "<br>";
								}
								if( checkBox2.snapshotItem(0).checked == false ){
									if( list != null ){
										// 資源量出力があれば領地または空き地
										text = text + data + "&nbsp;★" + landLevel + "&nbsp;(" + list[1] + "-" + list[2] + "-" + list[3] + "-" + list[4] + ")";
									}
									else{
										// 資源量出力がなければ拠点か本拠地かNPC砦
										if( landLevel == 0 ){
											// ★0なら個人の本拠地または拠点
											text = text + data + "&nbsp;個人本拠地/拠点";
										}
										else{
											// ★0以外ならNPC砦または武将砦
											text = text + data + "&nbsp;★" + landLevel + "&nbsp;(" + obj4.snapshotItem(0).textContent + ")";
										}
									}
								}
								else{
									text = text + data + "&nbsp;★" + landLevel;
								}
								if( (errf == true) && (p2 == -1) ){
									// 初回ルートエラーの場合赤×を追加
									text = text + '<b><font color="red">×</font></b>';
								}
								baseText.snapshotItem(0).innerHTML = text;

								// クリックしたポイントに画像を埋め込む
								var img = d_7.createElement("img");
								img.style.position = "absolute";

								img.style.left = list3[1] + "px";
								img.style.top = list3[2] + "px";

								// アイコンの決定
								if( errf == false ){
									img.src = ricon;
								}
								else{
									img.src = ricon_e;
								}

								if( viewSize == 15 ){
									img.style.width = "44px";
									img.style.height = "44px";
									img.style.zIndex = 227;
								} else if( viewSize == 21 ){
									img.style.width = "33px";
									img.style.height = "33px";
									img.style.zIndex = 444;
								} else {
									img.style.width = "60px";
									img.style.height = "60px";
									img.style.zIndex = 123;
								}
								img.name = "routeIcon";
								img.id = list2[1] + "_" + list2[2];	// 座標をイメージのIDにする
								rollover.parentNode.insertBefore(img, rollover.nextSibling);

								// スクロールバーを最下段に移動する
								baseText.snapshotItem(0).parentNode.scrollTop = baseText.snapshotItem(0).parentNode.scrollHeight;
							}
						}
					}
				}
				else{
					//----------------//
					// 自動ルート構築 //
					//----------------//
					var obj = $e_7('//*[@id="x_y"]');
					if( obj.snapshotLength > 0 ){
						var data = obj.snapshotItem(0).textContent;
						data = data.replace(/ \/.*$/,"");
						var list2 = data.match(/^.([-]*\d+),([-]*\d+)/);
						if( (list2 != null) && (list2 != undefined) ){
							// クリックタイミングにより取れない場合は飛ばすため

							//----------------------//
							// クリックデータの処理 //
							//----------------------//
							// areaデータを取ってみる
							var area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + list2[1] + "&y=" + list2[2] + "#ptop\"]");
							if( area_pos == null ){
								area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + list2[1] + "&y=" + list2[2] + "\"]");
							}
							var list3 = area_pos.getAttribute("onmouseover").match(/'(\d+)px', '(\d+)px/);

							var ex = $e_7('//*[@id="' + list2[1] + '_' + list2[2] + '"]');
							if( (autoroute == AUTO_ROUTE_EDIT_LAST) && (ex.snapshotLength > 0)
								&& (autoroute_f[0] == list2[1]) && (autoroute_f[1] == list2[2]) ){
								// 終点＝始点の場合、登録済み画像を削除し、モードを戻す

								// 画像がいたら消す
								var ex2 = $x_7('//*[@id="' + list2[1] + '_' + list2[2] + '"]');
								var ex2_p = ex2.parentNode;
								ex2_p.removeChild(ex2);

								// モードを戻す
								autoroute = AUTO_ROUTE_EDIT_FIRST;

								// インフォメーションの更新
								autoRouteInfo();
							}
							else if( (autoroute == AUTO_ROUTE_EDIT_END) && (ex.snapshotLength > 0)
								&& (autoroute_l[0] == list2[1]) && (autoroute_l[1] == list2[2]) ){
								// 終了後に終点クリックの場合、始点以外を削除し、モードを戻す

								// 始点以外の画像を全部消す
								var en = $e_7('//*[@name="routeIcon"]');
								if( en.snapshotLength > 0 ){
									for( var i = 0; i < en.snapshotLength; i++ ){
										if( en.snapshotItem(i).id != autoroute_f[0] + "_" + autoroute_f[1] ){
											var ex = $x_7('//*[@id="' + en.snapshotItem(i).id + '"]');
											var ex_p = ex.parentNode;
											ex_p.removeChild(ex);
										}
									}
								}

								// ルートテキストをクリア
								baseText.snapshotItem(0).innerHTML = "";

								// モードを戻す
								autoroute = AUTO_ROUTE_EDIT_LAST;

								// インフォメーションの更新
								autoRouteInfo();
							}
							else{
								// クリックしたポイントに画像を埋め込む
								var img = d_7.createElement("img");
								img.style.position = "absolute";

								img.style.left = list3[1] + "px";
								img.style.top = list3[2] + "px";

								// アイコンの決定
								if( autoroute == AUTO_ROUTE_EDIT_FIRST ){
									img.src = ricon_f;
								}
								else if( autoroute == AUTO_ROUTE_EDIT_LAST ){
									img.src = ricon_l;
								}

								if( viewSize == 15 ){
									img.style.width = "44px";
									img.style.height = "44px";
									img.style.zIndex = 227;
								} else if( viewSize == 21 ){
									img.style.width = "33px";
									img.style.height = "33px";
									img.style.zIndex = 444;
								} else {
									img.style.width = "60px";
									img.style.height = "60px";
									img.style.zIndex = 123;
								}
								img.name = "routeIcon";
								img.id = list2[1] + "_" + list2[2];	// 座標をイメージのIDにする
								rollover.parentNode.insertBefore(img, rollover.nextSibling);

								// 座標の登録
								if( autoroute == AUTO_ROUTE_EDIT_FIRST ){
									autoroute_f[0] = list2[1];
									autoroute_f[1] = list2[2];

									// モード変更
									autoroute = AUTO_ROUTE_EDIT_LAST;

									// インフォメーションの更新
									autoRouteInfo();
								}
								else if( autoroute == AUTO_ROUTE_EDIT_LAST ){
									autoroute_l[0] = list2[1];
									autoroute_l[1] = list2[2];

									// モード変更
									autoroute = AUTO_ROUTE_EDIT_END;

									// インフォメーションの更新
									autoRouteInfo();

									// ルート構築チェック(引数"1"はルートチェック)
									if( makeAutoRoute("1") == false ){
										alert("目的地に到達するルートには到達できません。条件を見直してください。");

										// 画像の削除とモードの戻し
										var ex2 = $x_7('//*[@id="' + list2[1] + '_' + list2[2] + '"]');
										var ex2_p = ex2.parentNode;
										ex2_p.removeChild(ex2);

										// モードを戻す
										autoroute = AUTO_ROUTE_EDIT_LAST;

										// インフォメーションの更新
										autoRouteInfo();

										return;
									}


									// 確認
									if( window.confirm("この座標からルートを構築します") ){
										// ルート構築
										makeAutoRoute("0");
									}
									else{
										// 画像の削除とモードの戻し
										var ex2 = $x_7('//*[@id="' + list2[1] + '_' + list2[2] + '"]');
										var ex2_p = ex2.parentNode;
										ex2_p.removeChild(ex2);

										// モードを戻す
										autoroute = AUTO_ROUTE_EDIT_LAST;

										// インフォメーションの更新
										autoRouteInfo();
									}
								}
							}
						}
					}
				}
			}
		}

		// コンテキストメニュー制御
		var body = $e_7('//body');
		if( body.snapshotLength > 0 ){
			if( enf == false ){
				body.snapshotItem(0).setAttribute("onContextmenu","return false;");
			}
			else{
				body.snapshotItem(0).setAttribute("onContextmenu","return true;");
			}
		}
	}

	//--------------//
	// リロード処理 //
	//--------------//
	function reloadNext(){

		// マップに埋め込んだマーク画像を全部消す
		var rollover = $d("rollover");

		// すでに画像が登録されてるか調べる
		var en = $e_7('//*[@name="viewIcon"]');
		if( en.snapshotLength > 0 ){
			// 画像がいたら消す
			for( var i = 0; i < en.snapshotLength; i++ ){
				var ex = $x_7('//*[@name="viewIcon"]');
				var ex_p = ex.parentNode;
				ex_p.removeChild(ex);
			}
		}

		en = $e_7('//*[@name="atkIcon"]');
		if( en.snapshotLength > 0 ){
			// 画像がいたら消す
			for( var i = 0; i < en.snapshotLength; i++ ){
				var ex = $x_7('//*[@name="atkIcon"]');
				var ex_p = ex.parentNode;
				ex_p.removeChild(ex);
			}
		}

		en = $e_7('//*[@id="icon_east"]');
		if( en.snapshotLength > 0 ){
			// 画像がいたら消す
			var ex = $x_7('//*[@id="icon_east"]');
			var ex_p = ex.parentNode;
			ex_p.removeChild(ex);
		}
		en = $e_7('//*[@id="icon_west"]');
		if( en.snapshotLength > 0 ){
			// 画像がいたら消す
			var ex = $x_7('//*[@id="icon_west"]');
			var ex_p = ex.parentNode;
			ex_p.removeChild(ex);
		}
		en = $e_7('//*[@id="icon_north"]');
		if( en.snapshotLength > 0 ){
			// 画像がいたら消す
			var ex = $x_7('//*[@id="icon_north"]');
			var ex_p = ex.parentNode;
			ex_p.removeChild(ex);
		}
		en = $e_7('//*[@id="icon_south"]');
		if( en.snapshotLength > 0 ){
			// 画像がいたら消す
			var ex = $x_7('//*[@id="icon_south"]');
			var ex_p = ex.parentNode;
			ex_p.removeChild(ex);
		}

		// 画面更新
		if( getViewSize() != 51 ){
			getNPCCastleInfo();
		}
		else{
			getNPCCastleInfo_51(0);		// 0:通常再描画
		}
	}

	//------------------------//
	// 更新ボタン押下処理処理 //
	//------------------------//
	function updateButtonClicked() {
		var checkbox;
		var userbox;
		var listbox;
		var colorNo;

		//--------------------------------------//
		// チェックボックスに関する情報をロード //
		//--------------------------------------//
		var chkflg1;
		var chkflg2;
		execFlag = loadExecFlag(location.hostname, "FLAG0");
		if( execFlag == "" ){
			// 表示フラグをロード
			var execFlag1 = loadExecFlag(location.hostname, "FLAG1");
			if( execFlag1 == "" ){
				chkflg1 = new String(FLAG1);  // 初期値
			}
			else{
				chkflg1 = execFlag1;
			}

			// オプションフラグをロード
			var execFlag2 = loadExecFlag(location.hostname, "FLAG2");
			if( execFlag2 == "" ){
				chkflg2 = new String(FLAG2);  // 初期値
			}
			else{
				chkflg2 = execFlag2;
			}

			// 初回のときは、フラグを保存
			execFlag = chkflg1 + DELIMIT1_7 + chkflg2;
			saveExecFlag(location.hostname, "FLAG0", execFlag);
		}
		else{
			var loadflg = new Array();
			loadflg = execFlag.split(DELIMIT1_7);
			chkflg1 = loadflg[0];
			chkflg2 = loadflg[1];
		}

		// 個人、同盟検索情報をロード
		var chkflg3 = new Array();
		var execFlag = loadExecFlag(location.hostname, "FLAG3");
		if( execFlag == "" ){
			var execFlag3 = loadExecFlag(location.hostname, "FLAG3-1");
			if( execFlag3 == "" ){
				chkflg3[0] = new String(FLAG3_1);  // 初期値
			}
			else{
				chkflg3[0] = execFlag3;
			}
			execFlag3 = loadExecFlag(location.hostname, "FLAG3-2");
			if( execFlag3 == "" ){
				chkflg3[1] = new String(FLAG3_2);  // 初期値
			}
			else{
				chkflg3[1] = execFlag3;
			}
			execFlag3 = loadExecFlag(location.hostname, "FLAG3-3");
			if( execFlag3 == "" ){
				chkflg3[2] = new String(FLAG3_3);  // 初期値
			}
			else{
				chkflg3[2] = execFlag3;
			}

			// 初回のときは、フラグを保存
			execFlag = chkflg3[0] + DELIMIT1_7 + chkflg3[1] + DELIMIT1_7 + chkflg3[2];
			saveExecFlag(location.hostname, "FLAG3", execFlag);
		}
		else{
			chkflg3 = execFlag.split(DELIMIT1_7);
		}

		var chkflg4;
		execFlag = loadExecFlag(location.hostname, "FLAG4");
		if( execFlag == "" ){
			chkflg4 = new String(FLAG4);  // 初期値

			// 初回のときは、フラグを保存
			execFlag = chkflg4;
			saveExecFlag(location.hostname, "FLAG4", execFlag);
		}
		else{
			chkflg4 = execFlag;
		}

		//--------------------//
		// 空き地検索チェック //
		//--------------------//
		checkBox = $e_7('//*[@id="ckEmpty"]');

		if( checkBox.snapshotItem(0).checked == false ){
			chkflg2 = '0' + chkflg2.substr(1);
		}
		else{
			chkflg2 = '1' + chkflg2.substr(1);
		}

		//------------------//
		// 領土検索チェック //
		//------------------//
		checkBox = $e_7('//*[@id="ckLand"]');

		if( checkBox.snapshotItem(0).checked == false ){
			chkflg2 = chkflg2.substr(0,1) + '0' + chkflg2.substr(2);
		}
		else{
			chkflg2 = chkflg2.substr(0,1) + '1' + chkflg2.substr(2);
		}

		//------------------//
		// 資源表示チェック //
		//------------------//
		checkBox = $e_7('//*[@id="ckAnalyze"]');

		if( checkBox.snapshotItem(0).checked == false ){
			chkflg2 = chkflg2.substr(0,2) + '0' + chkflg2.substr(3);
		}
		else{
			chkflg2 = chkflg2.substr(0,2) + '1' + chkflg2.substr(3);
		}

		//----------------------//
		// レーダー表示チェック //
		//----------------------//
		checkBox = $e_7('//*[@id="ckRader"]');

		if( checkBox.snapshotItem(0).checked == false ){
			chkflg2 = chkflg2.substr(0,3) + '0' + chkflg2.substr(4);
		}
		else{
			chkflg2 = chkflg2.substr(0,3) + '1' + chkflg2.substr(4);
		}

		//------------------------//
		// 本拠地一覧表示チェック //
		//------------------------//
		checkBox = $e_7('//*[@id="ckOwnerList"]');

		if( checkBox.snapshotItem(0).checked == false ){
			chkflg2 = chkflg2.substr(0,4) + '0' + chkflg2.substr(5);
		}
		else{
			chkflg2 = chkflg2.substr(0,4) + '1' + chkflg2.substr(5);
		}

		//--------------------//
		// 空き地着色チェック //
		//--------------------//
		checkBox = $e_7('//*[@id="ckEmptyDraw"]');

		if( checkBox.snapshotItem(0).checked == false ){
			chkflg2 = chkflg2.substr(0,5) + '0' + chkflg2.substr(6);
		}
		else{
			chkflg2 = chkflg2.substr(0,5) + '1' + chkflg2.substr(6);
		}

		// 枠色
		listBox = $e_7('//*[@id="lsEmptyColor"]');
		colorNo = listBox.snapshotItem(0).selectedIndex;
		chkflg2 = chkflg2.substr(0,6) + colorNo + chkflg2.substr(7);

		//--------------//
		// 強調表示指定 //
		//--------------//
		checkBox = $e_7('//*[@id="ckEmptyDraw"]');

		// 選択領土１
		listBox = $e_7('//*[@id="lsArea"]');
		areaNo = listBox.snapshotItem(0).selectedIndex;
		chkflg2 = chkflg2.substr(0,7) + formatRightNumber(areaNo,3) + chkflg2.substr(10);

		// 選択領土２
		listBox = $e_7('//*[@id="lsArea2"]');
		areaNo = listBox.snapshotItem(0).selectedIndex;
		chkflg2 = chkflg2.substr(0,10) + formatRightNumber(areaNo,3) + chkflg2.substr(13);

		// 選択領土３
		listBox = $e_7('//*[@id="lsArea3"]');
		areaNo = listBox.snapshotItem(0).selectedIndex;
		chkflg2 = chkflg2.substr(0,13) + formatRightNumber(areaNo,3) + chkflg2.substr(16);

		//----------------------//
		// メニュー表示チェック //
		//----------------------//
		checkBox = $e_7('//*[@id="ckMenu2"]');

		// メニュー２
		if( checkBox.snapshotItem(0).checked == false ){
			chkflg2 = chkflg2.substr(0,16) + '0' + chkflg2.substr(17);
		}
		else{
			chkflg2 = chkflg2.substr(0,16) + '1' + chkflg2.substr(17);
		}

		// メニュー４
		checkBox = $e_7('//*[@id="ckMenu4"]');

		if( checkBox.snapshotItem(0).checked == false ){
			chkflg2 = chkflg2.substr(0,17) + '0' + chkflg2.substr(18);
		}
		else{
			chkflg2 = chkflg2.substr(0,17) + '1' + chkflg2.substr(18);
		}

		//--------------------------//
		// ルート自動構築オプション //
		//--------------------------//
		//-- ルート自動構築オプション見出し --//
		// 探査レベル
		listBox = $e_7('//*[@id="lsRouteLevel"]');
		var level = listBox.snapshotItem(0).selectedIndex;
		chkflg2 = chkflg2.substr(0,19) + level + chkflg2.substr(20);

		// 資源回避レベル
		listBox = $e_7('//*[@id="lsSkipRes"]');
		var level = listBox.snapshotItem(0).selectedIndex;
		chkflg2 = chkflg2.substr(0,20) + level + chkflg2.substr(21);

		// 個人領土回避
		checkBox = $e_7('//*[@id="ckRouteUser"]');
		if( checkBox.snapshotItem(0).checked == false ){
			chkflg2 = chkflg2.substr(0,21) + '0' + chkflg2.substr(22);
		}
		else{
			chkflg2 = chkflg2.substr(0,21) + '1' + chkflg2.substr(22);
		}

		// 通過同盟指定
		listBox = $e_7('//*[@id="lsSkipGroup"]');
		var level = listBox.snapshotItem(0).selectedIndex;
		chkflg2 = chkflg2.substr(0,22) + level + chkflg2.substr(23);

		// 可変ルート
		checkBox = $e_7('//*[@id="ckRouteRandom"]');
		if( checkBox.snapshotItem(0).checked == false ){
			chkflg2 = chkflg2.substr(0,23) + '0' + chkflg2.substr(24);
		}
		else{
			chkflg2 = chkflg2.substr(0,23) + '1' + chkflg2.substr(24);
		}

		//-- 表示オプション追加 --//
		// 方位表示
		checkBox = $e_7('//*[@id="ckDirection"]');
		if( checkBox.snapshotItem(0).checked == false ){
			chkflg2 = chkflg2.substr(0,24) + '0' + chkflg2.substr(25);
		}
		else{
			chkflg2 = chkflg2.substr(0,24) + '1' + chkflg2.substr(25);
		}

		//-- 旧マップモード --//
		chkflg2 = chkflg2.substr(0,25) + '0' + chkflg2.substr(26);

		//-- 51x51で使わない --//
		checkBox = $e_7('//*[@id="ckNoExec51"]');
		if( checkBox.snapshotItem(0).checked == false ){
			chkflg2 = chkflg2.substr(0,26) + '0' + chkflg2.substr(27);
		}
		else{
			chkflg2 = chkflg2.substr(0,26) + '1' + chkflg2.substr(27);
		}

		//---------------//
		// NPC砦チェック //
		//---------------//
		checkBox = $e_7('//*[@id="ckNPC"]');

		if( checkBox.snapshotItem(0).checked == false ){
			chkflg1 = '0' + chkflg1.substr(1);
		}
		else{
			chkflg1 = '1' + chkflg1.substr(1);
		}

		//---------------//
		// ☆1砦チェック //
		//---------------//
		checkBox = $e_7('//*[@id="ckLevel1"]');

		if( checkBox.snapshotItem(0).checked == false ){
			chkflg1 = chkflg1.substr(0,1) + '0' + chkflg1.substr(2);
		}
		else{
			chkflg1 = chkflg1.substr(0,1) + '1' + chkflg1.substr(2);
		}

		//---------------//
		// ☆2砦チェック //
		//---------------//
		checkBox = $e_7('//*[@id="ckLevel2"]');

		if( checkBox.snapshotItem(0).checked == false ){
			chkflg1 = chkflg1.substr(0,2) + '0' + chkflg1.substr(3);
		}
		else{
			chkflg1 = chkflg1.substr(0,2) + '1' + chkflg1.substr(3);
		}

		//---------------//
		// ☆3砦チェック //
		//---------------//
		checkBox = $e_7('//*[@id="ckLevel3"]');

		if( checkBox.snapshotItem(0).checked == false ){
			chkflg1 = chkflg1.substr(0,3) + '0' + chkflg1.substr(4);
		}
		else{
			chkflg1 = chkflg1.substr(0,3) + '1' + chkflg1.substr(4);
		}

		//---------------//
		// ☆4砦チェック //
		//---------------//
		checkBox = $e_7('//*[@id="ckLevel4"]');

		if( checkBox.snapshotItem(0).checked == false ){
			chkflg1 = chkflg1.substr(0,4) + '0' + chkflg1.substr(5);
		}
		else{
			chkflg1 = chkflg1.substr(0,4) + '1' + chkflg1.substr(5);
		}

		//---------------//
		// ☆5砦チェック //
		//---------------//
		checkBox = $e_7('//*[@id="ckLevel5"]');

		if( checkBox.snapshotItem(0).checked == false ){
			chkflg1 = chkflg1.substr(0,5) + '0' + chkflg1.substr(6);
		}
		else{
			chkflg1 = chkflg1.substr(0,5) + '1' + chkflg1.substr(6);
		}

		//---------------//
		// ☆6砦チェック //
		//---------------//
		checkBox = $e_7('//*[@id="ckLevel6"]');

		if( checkBox.snapshotItem(0).checked == false ){
			chkflg1 = chkflg1.substr(0,6) + '0' + chkflg1.substr(7);
		}
		else{
			chkflg1 = chkflg1.substr(0,6) + '1' + chkflg1.substr(7);
		}

		//---------------//
		// ☆7砦チェック //
		//---------------//
		checkBox = $e_7('//*[@id="ckLevel7"]');

		if( checkBox.snapshotItem(0).checked == false ){
			chkflg1 = chkflg1.substr(0,7) + '0' + chkflg1.substr(8);
		}
		else{
			chkflg1 = chkflg1.substr(0,7) + '1' + chkflg1.substr(8);
		}

		//---------------//
		// ☆8砦チェック //
		//---------------//
		checkBox = $e_7('//*[@id="ckLevel8"]');

		if( checkBox.snapshotItem(0).checked == false ){
			chkflg1 = chkflg1.substr(0,8) + '0' + chkflg1.substr(9);
		}
		else{
			chkflg1 = chkflg1.substr(0,8) + '1' + chkflg1.substr(9);
		}

		//---------------//
		// ☆9砦チェック //
		//---------------//
		checkBox = $e_7('//*[@id="ckLevel9"]');

		if( checkBox.snapshotItem(0).checked == false ){
			chkflg1 = chkflg1.substr(0,9) + '0';
		}
		else{
			chkflg1 = chkflg1.substr(0,9) + '1';
		}

		//--------------------//
		// 個人／同盟１の処理 //
		//--------------------//
		userBox = $e_7('//*[@id="userBox1"]');

		// 有効/無効
		checkBox = $e_7('//*[@id="ckEnable1"]');
		if( checkBox.snapshotItem(0).checked == false ){
			chkflg3[0] = '0' + chkflg3[0].substr(1);
			userBox.disabled = true;
		}
		else{
			chkflg3[0] = '1' + chkflg3[0].substr(1);
			userBox.disabled = false;
		}

		// 個人/同盟
		checkBox = $e_7('//*[@id="ckType1"]');
		if( checkBox.snapshotItem(0).checked == true ){
			// 個人
			chkflg3[0] = chkflg3[0].substr(0,1) + '10' + chkflg3[0].substr(3);
		}
		else{
			// 同盟
			chkflg3[0] = chkflg3[0].substr(0,1) + '01' + chkflg3[0].substr(3);
		}

		// 完全一致
		checkBox = $e_7('//*[@id="ckFullMatch1"]');
		if( checkBox.snapshotItem(0).checked == false ){
			chkflg3[0] = chkflg3[0].substr(0,3) + '0' + chkflg3[0].substr(4);
		}
		else{
			chkflg3[0] = chkflg3[0].substr(0,3) + '1' + chkflg3[0].substr(4);
		}

		// 絞り込み
		checkBox = $e_7('//*[@id="ckLevelSearch1"]');
		if( checkBox.snapshotItem(0).checked == false ){
			chkflg3[0] = chkflg3[0].substr(0,4) + '0' + chkflg3[0].substr(5);
		}
		else{
			chkflg3[0] = chkflg3[0].substr(0,4) + '1' + chkflg3[0].substr(5);
		}

		// ユーザー名を更新
		chkflg3[0] = chkflg3[0].substr(0,FLAG3_NAME) + userBox.snapshotItem(0).value;

		// 枠色
		listBox = $e_7('//*[@id="lsColor1"]');
		colorNo = listBox.snapshotItem(0).selectedIndex;
		chkflg3[0] = chkflg3[0].substr(0,5) + colorNo + chkflg3[0].substr(6);

		//--------------------//
		// 個人／同盟２の処理 //
		//--------------------//
		userBox = $e_7('//*[@id="userBox2"]');

		// 有効/無効
		checkBox = $e_7('//*[@id="ckEnable2"]');
		if( checkBox.snapshotItem(0).checked == false ){
			chkflg3[1] = '0' + chkflg3[1].substr(1);
			userBox.disabled = true;
		}
		else{
			chkflg3[1] = '1' + chkflg3[1].substr(1);
			userBox.disabled = false;
		}

		// 個人/同盟
		checkBox = $e_7('//*[@id="ckType2"]');
		if( checkBox.snapshotItem(0).checked == true ){
			// 個人
			chkflg3[1] = chkflg3[1].substr(0,1) + '10' + chkflg3[1].substr(3);
		}
		else{
			// 同盟
			chkflg3[1] = chkflg3[1].substr(0,1) + '01' + chkflg3[1].substr(3);
		}

		// 完全一致
		checkBox = $e_7('//*[@id="ckFullMatch2"]');
		if( checkBox.snapshotItem(0).checked == false ){
			chkflg3[1] = chkflg3[1].substr(0,3) + '0' + chkflg3[1].substr(4);
		}
		else{
			chkflg3[1] = chkflg3[1].substr(0,3) + '1' + chkflg3[1].substr(4);
		}

		// 絞り込み
		checkBox = $e_7('//*[@id="ckLevelSearch2"]');
		if( checkBox.snapshotItem(0).checked == false ){
			chkflg3[1] = chkflg3[1].substr(0,4) + '0' + chkflg3[1].substr(5);
		}
		else{
			chkflg3[1] = chkflg3[1].substr(0,4) + '1' + chkflg3[1].substr(5);
		}

		// ユーザー名を更新
		chkflg3[1] = chkflg3[1].substr(0,FLAG3_NAME) + userBox.snapshotItem(0).value;

		// 枠色
		listBox = $e_7('//*[@id="lsColor2"]');
		colorNo = listBox.snapshotItem(0).selectedIndex;
		chkflg3[1] = chkflg3[1].substr(0,5) + colorNo + chkflg3[1].substr(6);

		//--------------------//
		// 個人／同盟３の処理 //
		//--------------------//
		userBox = $e_7('//*[@id="userBox3"]');

		// 有効/無効
		checkBox = $e_7('//*[@id="ckEnable3"]');
		if( checkBox.snapshotItem(0).checked == false ){
			chkflg3[2] = '0' + chkflg3[2].substr(1);
			userBox.disabled = true;
		}
		else{
			chkflg3[2] = '1' + chkflg3[2].substr(1);
			userBox.disabled = false;
		}

		// 個人/同盟
		checkBox = $e_7('//*[@id="ckType3"]');
		if( checkBox.snapshotItem(0).checked == true ){
			// 個人
			chkflg3[2] = chkflg3[2].substr(0,1) + '10' + chkflg3[2].substr(3);
		}
		else{
			// 同盟
			chkflg3[2] = chkflg3[2].substr(0,1) + '01' + chkflg3[2].substr(3);
		}

		// 完全一致
		checkBox = $e_7('//*[@id="ckFullMatch3"]');
		if( checkBox.snapshotItem(0).checked == false ){
			chkflg3[2] = chkflg3[2].substr(0,3) + '0' + chkflg3[2].substr(4);
		}
		else{
			chkflg3[2] = chkflg3[2].substr(0,3) + '1' + chkflg3[2].substr(4);
		}

		// 絞り込み
		checkBox = $e_7('//*[@id="ckLevelSearch3"]');
		if( checkBox.snapshotItem(0).checked == false ){
			chkflg3[2] = chkflg3[2].substr(0,4) + '0' + chkflg3[2].substr(5);
		}
		else{
			chkflg3[2] = chkflg3[2].substr(0,4) + '1' + chkflg3[2].substr(5);
		}

		// ユーザー名を更新
		chkflg3[2] = chkflg3[2].substr(0,FLAG3_NAME) + userBox.snapshotItem(0).value;

		// 枠色
		listBox = $e_7('//*[@id="lsColor3"]');
		colorNo = listBox.snapshotItem(0).selectedIndex;
		chkflg3[2] = chkflg3[2].substr(0,5) + colorNo + chkflg3[2].substr(6);

		//----------------------//
		// スプレッド連携の処理 //
		//----------------------//
		userBox = $e_7('//*[@id="userBox4"]');

		// 有効/無効
		checkBox = $e_7('//*[@id="ckUnion"]');
		if( checkBox.snapshotItem(0).checked == false ){
			chkflg4 = '0' + chkflg4.substr(1);
			userBox.disabled = true;
		}
		else{
			chkflg4 = '1' + chkflg4.substr(1);
			userBox.disabled = false;
		}

		// ユーザー名を更新
		chkflg4 = chkflg4.substr(0,1) + userBox.snapshotItem(0).value;

		//----------------------//
		// 更新したフラグを保存 //
		//----------------------//
		execFlag = chkflg1 + DELIMIT1_7 + chkflg2;
		saveExecFlag(location.hostname, "FLAG0", execFlag);
		execFlag = chkflg3[0] + DELIMIT1_7 + chkflg3[1] + DELIMIT1_7 + chkflg3[2];
		saveExecFlag(location.hostname, "FLAG3", execFlag);
		saveExecFlag(location.hostname, "FLAG4", chkflg4);

		//----------//
		// リロード //
		//----------//
		reloadNext();
	}

	//------------------------------//
	// ★のチェックを付ける押下処理 //
	//------------------------------//
	function checkButtonClicked() {

		// チェックボックスのチェックを外す //
		var checkBox1 = $e_7('//*[@id="ckLevel1"]');
		var checkBox2 = $e_7('//*[@id="ckLevel2"]');
		var checkBox3 = $e_7('//*[@id="ckLevel3"]');
		var checkBox4 = $e_7('//*[@id="ckLevel4"]');
		var checkBox5 = $e_7('//*[@id="ckLevel5"]');
		var checkBox6 = $e_7('//*[@id="ckLevel6"]');
		var checkBox7 = $e_7('//*[@id="ckLevel7"]');
		var checkBox8 = $e_7('//*[@id="ckLevel8"]');
		var checkBox9 = $e_7('//*[@id="ckLevel9"]');

		checkBox1.snapshotItem(0).checked = true;
		checkBox2.snapshotItem(0).checked = true;
		checkBox3.snapshotItem(0).checked = true;
		checkBox4.snapshotItem(0).checked = true;
		checkBox5.snapshotItem(0).checked = true;
		checkBox6.snapshotItem(0).checked = true;
		checkBox7.snapshotItem(0).checked = true;
		checkBox8.snapshotItem(0).checked = true;
		checkBox9.snapshotItem(0).checked = true;
	}

	//----------------------------//
	// ★のチェックを外す押下処理 //
	//----------------------------//
	function uncheckButtonClicked() {

		// チェックボックスのチェックを外す //
		var checkBox1 = $e_7('//*[@id="ckLevel1"]');
		var checkBox2 = $e_7('//*[@id="ckLevel2"]');
		var checkBox3 = $e_7('//*[@id="ckLevel3"]');
		var checkBox4 = $e_7('//*[@id="ckLevel4"]');
		var checkBox5 = $e_7('//*[@id="ckLevel5"]');
		var checkBox6 = $e_7('//*[@id="ckLevel6"]');
		var checkBox7 = $e_7('//*[@id="ckLevel7"]');
		var checkBox8 = $e_7('//*[@id="ckLevel8"]');
		var checkBox9 = $e_7('//*[@id="ckLevel9"]');

		checkBox1.snapshotItem(0).checked = false;
		checkBox2.snapshotItem(0).checked = false;
		checkBox3.snapshotItem(0).checked = false;
		checkBox4.snapshotItem(0).checked = false;
		checkBox5.snapshotItem(0).checked = false;
		checkBox6.snapshotItem(0).checked = false;
		checkBox7.snapshotItem(0).checked = false;
		checkBox8.snapshotItem(0).checked = false;
		checkBox9.snapshotItem(0).checked = false;
	}

	//----------------------------------//
	// 有効チェックボックスチェック処理 //
	//----------------------------------//
	function enable1Checked() {

		var userBox = $e_7('//*[@id="userBox1"]');
		var checkBox = $e_7('//*[@id="ckEnable1"]');

		// ユーザー指定のフラグを反転
		if( checkBox.snapshotItem(0).checked == false ){
			userBox.snapshotItem(0).disabled = true;
		}
		else{
			userBox.snapshotItem(0).disabled = false;
		}
	}

	function enable2Checked() {

		var userBox = $e_7('//*[@id="userBox2"]');
		var checkBox = $e_7('//*[@id="ckEnable2"]');

		// ユーザー指定のフラグを反転
		if( checkBox.snapshotItem(0).checked == false ){
			userBox.snapshotItem(0).disabled = true;
		}
		else{
			userBox.snapshotItem(0).disabled = false;
		}
	}

	function enable3Checked() {

		var userBox = $e_7('//*[@id="userBox3"]');
		var checkBox = $e_7('//*[@id="ckEnable3"]');

		// ユーザー指定のフラグを反転
		if( checkBox.snapshotItem(0).checked == false ){
			userBox.snapshotItem(0).disabled = true;
		}
		else{
			userBox.snapshotItem(0).disabled = false;
		}
	}

	//------------------//
	// ルート構築モード //
	//------------------//
	function routeModeChecked() {
		var checkBox = $e_7('//*[@id="ckRouteMode"]');
		var checkBox2 = $e_7('//*[@id="ckAutoRouteMode"]');
		var routeField = $e_7('//*[@id="routeField"]');
		var routeField2 = $e_7('//*[@id="routeField2"]');
		var routeField3 = $e_7('//*[@id="routeField3"]');
		var routeField5 = $e_7('//*[@id="routeField5"]');
		var baseField = $e_7('//*[@id="baseField"]');

		// ユーザー指定のフラグを反転
		if( checkBox.snapshotItem(0).checked == false ){
			if( baseField.snapshotLength > 0 ){
				baseField.snapshotItem(0).style.display = "inline";
			}
			routeField.snapshotItem(0).style.display = "none";
			routeField2.snapshotItem(0).style.display = "none";
			routeField3.snapshotItem(0).style.display = "none";
			routeField5.snapshotItem(0).style.display = "none";

			// メニュー解除されたらクリアボタンクリックを実行
			routeClearButtonClicked()
		}
		else{
			if( baseField.snapshotLength > 0 ){
				baseField.snapshotItem(0).style.display = "none";
			}
			routeField.snapshotItem(0).style.display = "inline";
			routeField2.snapshotItem(0).style.display = "inline";
			routeField3.snapshotItem(0).style.display = "inline";
			routeField5.snapshotItem(0).style.display = "inline";

			if( checkBox2.snapshotItem(0).checked == true ){
				// 自動構築モードがすでにチェックされてたら警告処理
				autoRouteModeChecked();
			}
		}

		// インフォメーションの更新
		autoRouteInfo();
	}

	//----------------------//
	// 自動ルート構築モード //
	//----------------------//
	function autoRouteModeChecked() {

		var checkBox = $e_7('//*[@id="ckRouteMode"]');
		var checkBox2 = $e_7('//*[@id="ckAutoRouteMode"]');

		// 自動構築のチェック
		if( (checkBox.snapshotItem(0).checked == true) && (checkBox2.snapshotItem(0).checked == true) ){
			if( window.confirm("作成中のルートが破棄されますがよろしいですか？") ){
				routeClearButtonClicked();
				autoroute = AUTO_ROUTE_EDIT_FIRST;
			}
			else{
				// 解除時はルートをクリアする
				checkBox2.snapshotItem(0).checked = false;
	 			return;
			}
		}
		else{
			autoroute = AUTO_ROUTE_NONE;
			routeClearButtonClicked();
		}

		// インフォメーションの更新
		autoRouteInfo();
	}

	//------------------------------------------//
	// 自動ルート構築モードの指示メッセージ表示 //
	//------------------------------------------//
	function autoRouteInfo(){
		var routeField = $e_7('//*[@id="route_info"]');
		var checkBox = $e_7('//*[@id="ckRouteMode"]');

		if( checkBox.snapshotItem(0).checked == false ){
			// ルート構築モードがオフのときはメッセージをださない
			routeField.snapshotItem(0).innerHTML = '';
			return;
		}

		if( location.pathname != "/big_map.php" ){
			if( autoroute == AUTO_ROUTE_EDIT_FIRST ){
				routeField.snapshotItem(0).innerHTML = '<font color="red"><b>ルート起点を<br>右クリックして下さい</b></font>';
			}
			else if( autoroute == AUTO_ROUTE_EDIT_LAST ){
				routeField.snapshotItem(0).innerHTML = '<font color="red"><b>ルート終点を<br>右クリックして下さい</b></font>';
			}
			else if( autoroute == AUTO_ROUTE_EDIT_END ){
				routeField.snapshotItem(0).innerHTML = '<font color="red"><b>ルート終点を<br>右クリックで再試行できます</b></font>';
			}
			else{
				routeField.snapshotItem(0).innerHTML = '';
			}
		}
		else{
			if( autoroute == AUTO_ROUTE_EDIT_FIRST ){
				routeField.snapshotItem(0).innerHTML = '<font color="red"><b>右クリックで起点設定</b></font>';
			}
			else if( autoroute == AUTO_ROUTE_EDIT_LAST ){
				routeField.snapshotItem(0).innerHTML = '<font color="red"><b>右クリックで終点設定</b></font>';
			}
			else if( autoroute == AUTO_ROUTE_EDIT_END ){
				routeField.snapshotItem(0).innerHTML = '<font color="red"><b>終点右クリックで終点解除</b></font>';
			}
			else{
				routeField.snapshotItem(0).innerHTML = '';
			}
		}
	}

	//--------------------//
	// ルート全選択ボタン //
	//--------------------//
	function routeSelectButtonClicked() {
		// 構築ルート情報の選択
		var routeText = $x_7('//*[@id="routeInfoText"]');

		var objs = routeText.firstChild;
		var obje = routeText.lastChild;

		var range = document.createRange();
		range.setStart(objs,0);
		range.setEnd(obje,obje.textContent.length);
		var sel = getSelection();
		sel.removeAllRanges();
		sel.addRange(range);
	}

	//--------------------//
	// ルートクリアボタン //
	//--------------------//
	function routeClearButtonClicked() {
		var routeText = $e_7('//*[@id="routeInfoText"]');
		var checkBox = $e_7('//*[@id="ckAutoRouteMode"]');

		if( location.pathname == "/big_map.php" ){
			// 51x51画面では対象座標再描画で対応
			autoroute = AUTO_ROUTE_NONE;

			getNPCCastleInfo_51(1);

			routeText.snapshotItem(0).innerHTML = "";

			// ルート自動構築中ならフラグを初期化
			if( checkBox.snapshotItem(0).checked == true ){
				autoroute = AUTO_ROUTE_EDIT_FIRST;
			}

			return;
		}

		// 構築ルート情報のクリア
		routeText.snapshotItem(0).innerHTML = "";

		// マップに埋め込んだマーク画像を全部消す
		var rollover = $d("rollover");

		// すでに画像が登録されてるか調べる
		var en = $e_7('//*[@name="routeIcon"]');
		if( en.snapshotLength > 0 ){
			// 画像がいたら消す
			for( var i = 0; i < en.snapshotLength; i++ ){
				var ex = $x_7('//*[@id="' + en.snapshotItem(i).id + '"]');
				var ex_p = ex.parentNode;
				ex_p.removeChild(ex);
			}
		}

		// ルート自動構築中ならフラグを初期化
		if( checkBox.snapshotItem(0).checked == true ){
			autoroute = AUTO_ROUTE_EDIT_FIRST;
		}
	}

	//------------------//
	// ルート検証ボタン //
	//------------------//
	function routeCheckButtonClicked(e){
		var rollover = $d("rollover");
		var checkBox = $e_7('//*[@id="ckRouteMode"]');
		var checkBox2 = $e_7('//*[@id="ckRouteMode2"]');

		// マップに埋め込んだマーク画像を拾う
		var rollover = $d("rollover");

		// すでに画像が登録されてるか調べる
		var cx = 0;
		var cy = 0;
		var errf = false;
		var errx;
		var erry;
		var en = $e_7('//*[@name="routeIcon"]');
		if( en.snapshotLength > 0 ){
			// 画像がいたら消す
			for( var i = en.snapshotLength -1; i >= 0; i-- ){
				var ex = $x_7('//*[@id="' + en.snapshotItem(i).id + '"]');
				var list = en.snapshotItem(i).id.match(/^([-]*\d+).([-]*\d+)/);
				if( i != en.snapshotLength -1 ){
					var dx = Math.abs(cx - parseInt(list[1]));
					var dy = Math.abs(cy - parseInt(list[2]));
					if( (dx >= 2) || (dy >= 2) || (errf == true) ){
						if( errf == false ){
							errx = parseInt(list[1]);
							erry = parseInt(list[2]);
						}
						ex.src = ricon_e;
						errf = true;
					}
					else{
						ex.src = ricon;
					}
				}

				cx = parseInt(list[1]);
				cy = parseInt(list[2]);
			}

			if( errf == true ){
				var baseText = $e_7('//*[@id="routeInfoText"]');
				var text = baseText.snapshotItem(0).innerHTML;
				var fp = text.indexOf('(' + errx + ',' + erry + ')');
				var xp = text.indexOf('×',fp);
				var ep = text.indexOf("<",fp);
				if( ep == -1 ){
					if( xp == -1 ){
						// マークがないばあいだけつける
						text = text + '<b><font color="red">×</font></b>';
					}
				}
				else{
					if( xp == -1 ){
						// マークがないばあいだけつける
						text = text.substr(0,ep) + '<b><font color="red">×</font></b>' + text.substr(ep);
					}
				}
				baseText.snapshotItem(0).innerHTML = text;
			}
		}

	}

	//----------------------//
	// 表示補助メニュー制御 //
	//----------------------//
	function menu2Clicked() {

		var checkBox = $e_7('//*[@id="ckMenu2"]');
		var label;
		var chkbox;
		var listbox;

		// コントロールの表示切り替え
		if( checkBox.snapshotItem(0).checked == false ){
			for( var i = 1; i <= 9; i++ ){
				label = $e_7('//*[@id="Label2-' + i + '"]');
				label.snapshotItem(0).style.display = "none";
			}

			checkbox = $e_7('//*[@id="ckAnalyze"]');
			checkbox.snapshotItem(0).style.display = "none";
			checkbox = $e_7('//*[@id="ckEmptyDraw"]');
			checkbox.snapshotItem(0).style.display = "none";
			checkbox = $e_7('//*[@id="ckRader"]');
			checkbox.snapshotItem(0).style.display = "none";
			checkbox = $e_7('//*[@id="ckOwnerList"]');
			checkbox.snapshotItem(0).style.display = "none";
			checkbox = $e_7('//*[@id="ckDirection"]');
			checkbox.snapshotItem(0).style.display = "none";
			checkbox = $e_7('//*[@id="ckNoExec51"]');
			checkbox.snapshotItem(0).style.display = "none";

			listbox = $e_7('//*[@id="lsArea"]');
			listbox.snapshotItem(0).style.display = "none";
			listbox = $e_7('//*[@id="lsArea2"]');
			listbox.snapshotItem(0).style.display = "none";
			listbox = $e_7('//*[@id="lsArea3"]');
			listbox.snapshotItem(0).style.display = "none";
			listbox = $e_7('//*[@id="lsEmptyColor"]');
			listbox.snapshotItem(0).style.display = "none";
		}
		else{
			for( var i = 1; i <= 9; i++ ){
				label = $e_7('//*[@id="Label2-' + i + '"]');
				label.snapshotItem(0).style.display = "inline";
			}

			checkbox = $e_7('//*[@id="ckAnalyze"]');
			checkbox.snapshotItem(0).style.display = "inline";
			checkbox = $e_7('//*[@id="ckEmptyDraw"]');
			checkbox.snapshotItem(0).style.display = "inline";
			checkbox = $e_7('//*[@id="ckRader"]');
			checkbox.snapshotItem(0).style.display = "inline";
			checkbox = $e_7('//*[@id="ckOwnerList"]');
			checkbox.snapshotItem(0).style.display = "inline";
			checkbox = $e_7('//*[@id="ckDirection"]');
			checkbox.snapshotItem(0).style.display = "inline";
			checkbox = $e_7('//*[@id="ckNoExec51"]');
			checkbox.snapshotItem(0).style.display = "inline";

			listbox = $e_7('//*[@id="lsArea"]');
			listbox.snapshotItem(0).style.display = "inline";
			listbox = $e_7('//*[@id="lsArea2"]');
			listbox.snapshotItem(0).style.display = "inline";
			listbox = $e_7('//*[@id="lsArea3"]');
			listbox.snapshotItem(0).style.display = "inline";
			listbox = $e_7('//*[@id="lsEmptyColor"]');
			listbox.snapshotItem(0).style.display = "inline";
		}
	}

	//----------------------//
	// 同盟検索メニュー制御 //
	//----------------------//
	function menu4Clicked() {
		var checkBox = $e_7('//*[@id="ckMenu4"]');
		var label;
		var chkbox;
		var listbox;
		var userbox;

		// コントロールの表示切り替え
		if( checkBox.snapshotItem(0).checked == false ){
			for( var i = 1; i <= 24; i++ ){
				label = $e_7('//*[@id="Label4-' + i + '"]');
				label.snapshotItem(0).style.display = "none";
			}

			for( var i = 1; i <= 3; i++ ){
				label = $e_7('//*[@id="Label4-2-' + i + '"]');
				label.snapshotItem(0).style.display = "none";
			}

			for( var i = 1; i <=3; i++ ){
				checkbox = $e_7('//*[@id="ckEnable' + i + '"]');
				checkbox.snapshotItem(0).style.display = "none";
				checkbox = $e_7('//*[@id="ckType' + i + '"]');
				checkbox.snapshotItem(0).style.display = "none";
				checkbox.snapshotItem(1).style.display = "none";
				checkbox = $e_7('//*[@id="ckFullMatch' + i + '"]');
				checkbox.snapshotItem(0).style.display = "none";
				checkbox = $e_7('//*[@id="ckLevelSearch' + i + '"]');
				checkbox.snapshotItem(0).style.display = "none";

				userbox = $e_7('//*[@id="userBox' + i + '"]');
				userbox.snapshotItem(0).style.display = "none";

				listbox = $e_7('//*[@id="lsColor' + i + '"]');
				listbox.snapshotItem(0).style.display = "none";
			}
		}
		else{
			for( var i = 1; i <= 24; i++ ){
				label = $e_7('//*[@id="Label4-' + i + '"]');
				label.snapshotItem(0).style.display = "inline";
			}

			for( var i = 1; i <= 3; i++ ){
				label = $e_7('//*[@id="Label4-2-' + i + '"]');
				label.snapshotItem(0).style.display = "inline";
			}

			for( var i = 1; i <=3; i++ ){
				checkbox = $e_7('//*[@id="ckEnable' + i + '"]');
				checkbox.snapshotItem(0).style.display = "inline";
				checkbox = $e_7('//*[@id="ckType' + i + '"]');
				checkbox.snapshotItem(0).style.display = "inline";
				checkbox.snapshotItem(1).style.display = "inline";
				checkbox = $e_7('//*[@id="ckFullMatch' + i + '"]');
				checkbox.snapshotItem(0).style.display = "inline";
				checkbox = $e_7('//*[@id="ckLevelSearch' + i + '"]');
				checkbox.snapshotItem(0).style.display = "inline";

				userbox = $e_7('//*[@id="userBox' + i + '"]');
				userbox.snapshotItem(0).style.display = "inline";

				listbox = $e_7('//*[@id="lsColor' + i + '"]');
				listbox.snapshotItem(0).style.display = "inline";
			}
		}
	}

	//----------//
	// 空白除去 //
	//----------//
	function trim_7(str)
	{
		if (str == undefined) return "";
		return str.replace(/^[ 　\t\r\n]+|[ 　\t\r\n]+$/g, "");
	}


	//------------------//
	// 画面サイズの取得 //
	//------------------//
	function getViewSize()
	{
		var viewSize;

		if( $x_7("//div[@id=\"changemapscale\"]/ul/li[@class=\"sort15 now\"]") ){
			viewSize = 15;	// 15x15
		}
		else if( $x_7("//div[@id=\"changemapscale\"]/ul/li[@class=\"sort20 now\"]") ){
			viewSize = 20;	// 20x20
		}
		else if( $x_7("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort15 now\"]") ){
			viewSize = 15;	// 15x15 本鯖の仕様変更対応
		}
		else if( $x_7("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort21 now\"]") ){
			viewSize = 21;	// 21x21 本鯖の仕様変更対応
		}
		else if( $x_7("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort51 now\"]") ){
			viewSize = 51;	// 51x51 本鯖の仕様変更対応
		}
		else{
			viewSize = 11;	// 11x11
		}

		return viewSize;
	}

	//----------------//
	// 自動ルート構築 //
	//----------------//
	function makeAutoRoute(checkmode)
	{
		//------//
		// 定数 //
		//------//
		var MAP_NONE  = -1;	// 未処理
		var MAP_NPC   = -2;	// NPC砦
		var MAP_WALL  = -3;	// 壁
		var MAP_START = 0;	 // 起点
		var MAP_END   = -999;  // 目的地

		//------------------//
		// 画面サイズの取得 //
		//------------------//
		var viewSize;
		viewSize = getViewSize();

		//--------------------------//
		// 同盟検索オプションの取得 //
		//--------------------------//
		var checkBox1;
		var userName = new Array();
		var userText;
		var fullmatch = new Array();
		var target = new Array();
		for( var i = 0; i < 3; i++ ){
			fullmatch[i] = 0;
			target[i] = 0;
		}

		// 個人・同盟検索１
		checkBox1 = $e_7('//*[@id="ckEnable1"]');
		if( checkBox1.snapshotItem(0).checked == true ){
			// 個人・同盟の別
			checkBox2 = $e_7('//*[@id="ckType1"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				target[0] = 1;
			}
			else{
				target[0] = 2;
			}
			// 完全一致
			checkBox2 = $e_7('//*[@id="ckFullMatch1"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				fullmatch[0] = 1;
			}
			else{
				fullmatch[0] = 0;
			}
			userBox = $e_7('//*[@id="userBox1"]');
			userText = userBox.snapshotItem(0).value;
			userName[0] = new Array();
			userName[0] = userText.split(OWNER_SPLITKEY);
		}
		else{
			userName[0] = "";
		}

		// 個人・同盟検索２
		checkBox1 = $e_7('//*[@id="ckEnable2"]');
		if( checkBox1.snapshotItem(0).checked == true ){
			// 個人・同盟の別
			checkBox2 = $e_7('//*[@id="ckType2"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				target[1] = 1;
			}
			else{
				target[1] = 2;
			}
			// 完全一致
			checkBox2 = $e_7('//*[@id="ckFullMatch2"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				fullmatch[1] = 1;
			}
			else{
				fullmatch[1] = 0;
			}
			userBox = $e_7('//*[@id="userBox2"]');
			userText = userBox.snapshotItem(0).value;
			userName[1] = new Array();
			userName[1] = userText.split(OWNER_SPLITKEY);
		}
		else{
			userName[1] = "";
		}

		// 個人・同盟検索３
		checkBox1 = $e_7('//*[@id="ckEnable3"]');
		if( checkBox1.snapshotItem(0).checked == true ){
			// 個人・同盟の別
			checkBox2 = $e_7('//*[@id="ckType3"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				target[2] = 1;
			}
			else{
				target[2] = 2;
			}
			// 完全一致
			checkBox2 = $e_7('//*[@id="ckFullMatch3"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				fullmatch[2] = 1;
			}
			else{
				fullmatch[2] = 0;
			}
			userBox = $e_7('//*[@id="userBox3"]');
			userText = userBox.snapshotItem(0).value;
			userName[2] = new Array();
			userName[2] = userText.split(OWNER_SPLITKEY);
		}
		else{
			userName[2] = "";
		}

		//--------------------------------------------//
		// 全体表示画面から、画面中央座標を手に入れる //
		//--------------------------------------------//
		var codx = $e_7('//div[@id="datas"]/input[@id=\"x\"]');
		var cody = $e_7('//div[@id="datas"]/input[@id=\"y\"]');
		var bx = codx.snapshotItem(0).value;
		var by = cody.snapshotItem(0).value;

		// 左上座標を求める
		if( viewSize == 11 ){
			bx = parseInt(bx) - 5;
			by = parseInt(by) + 5;
		}
		else if( viewSize == 15 ){
			bx = parseInt(bx) - 7;
			by = parseInt(by) + 7;
		}
		else{
			bx = parseInt(bx) - 10;
			by = parseInt(by) + 10;
		}

		// 始点、終点座標を求める
		var sx = Math.abs(parseInt(autoroute_f[0]) - parseInt(bx));
		var sy = Math.abs(parseInt(autoroute_f[1]) - parseInt(by));
		var ex = Math.abs(parseInt(autoroute_l[0]) - parseInt(bx));
		var ey = Math.abs(parseInt(autoroute_l[1]) - parseInt(by));

		//------------------//
		// 探査レベルの取得 //
		//------------------//
		var listBox = $e_7('//*[@id="lsRouteLevel"]');
		var listBox2 = $e_7('//*[@id="lsSkipRes"]');
		var listBox3 = $e_7('//*[@id="lsSkipGroup"]');
		var limit = listBox.snapshotItem(0).selectedIndex + 1;
		var skipres = listBox2.snapshotItem(0).selectedIndex;
		var skipgrp = listBox3.snapshotItem(0).selectedIndex;

		//------------------------------//
		// マップデータをマトリックス化 //
		//------------------------------//
		// マップの作成
		var mapdata = new Array();
		var resdata = new Array();
		for(var i = 0; i < 21; i++ ){
			mapdata[i] = new Array();
			resdata[i] = new Array();
		}
		for(var i = 0; i < 21; i++ ){
			for(var j = 0; j < 21; j++ ){
				if( (i >= viewSize) || (j >= viewSize) ){
					mapdata[i][j] = MAP_WALL;	// 画面外は壁扱い
				}
				else{
					mapdata[i][j] = MAP_NONE;	// 未処理エリア
				}
			}
		}

		//----------------//
		// 領土情報の取得 //
		//----------------//
		var areas = $e_7('//*[@id="mapOverlayMap"]//area/@onmouseover');

		//--------------------------------//
		// 領土の情報をマトリックスに反映 //
		//--------------------------------//
		var ckUser = $e_7('//*[@id="ckRouteUser"]');
		for (var i = 0; i < areas.snapshotLength; i++) {
			var rowText = areas.snapshotItem(i).textContent;
			rowText = rowText.replace(/^.*rewrite\(/, "");
			rowText = rowText.replace(/\); .*$/, "");
			var bkText = rowText;
			rowText = rowText.replace(/\//g,"==uZer==");
			rowText = rowText.replace(/', '/g,"'/'");
			rowText = rowText.replace(/'/g,"");
			var valueA = new Array();
			valueA = rowText.split('/');
			valueA[1] = valueA[1].replace(/==uZer==/,"/");

			// マップ座標の取得
			var rowText3 = valueA[3];
			rowText3 = rowText3.replace(/\(/,"");
			rowText3 = rowText3.replace(/\)/,"");
			var valueB = new Array();
			valueB = rowText3.split(',');
			var x = parseInt(valueB[0]);
			var y = parseInt(valueB[1]);

			// 資源レベル
			var landLevel = valueA[5].length;
			if( valueA[5].substr(0,4) == '<img' ){
				// FaceBook Lands of Legends! 対応
				var stars = valueA[5].match(/<img/g);
				landLevel = stars.length;
			}

			//--------------------------------//
			// マトリックス上のオフセット計算 //
			//--------------------------------//
			var px = Math.abs(parseInt(x) - parseInt(bx));
			var py = Math.abs(parseInt(y) - parseInt(by));

			//--------------------//
			// 各種情報の埋め込み //
			//--------------------//
			if( valueA[11] == '1' ){
				// NPC砦
				mapdata[px][py] = MAP_NPC;

				// リソース情報
				resdata[px][py] = "★" + landLevel + "&nbsp;(" + valueA[0] + ")";
			}
			else if( valueA[1] != '' ){
				// 個人領土
				if( (ckUser.snapshotItem(0).checked == false) || ((ckUser.snapshotItem(0).checked == true) && (landLevel == 0)) ){
					mapdata[px][py] = MAP_WALL;   // 個人領土を対象外、あるいは対象かつ拠点の場合、壁とみなす
				}

				// 同盟指定
				if( (ckUser.snapshotItem(0).checked == true) && (skipgrp > 0) ){
					// 同盟指定ありの場合、指定条件にマッチしない領土は壁とみなす

					var matchcase = false;	// マッチしたパターン
					var groupNo = skipgrp - 1;

					// 個人・同盟マッチチェック
					for( var k = 0; k < userName[groupNo].length; k++ ){
						// 検索有効時 username に値が入る
						if( userName[groupNo][k] != "" ){
							// ターゲットが個人
							if( target[groupNo] == 1 ){
								// 完全一致かつ、ユーザー名が一致
								if( (fullmatch[groupNo] == 1) && (valueA[1] == userName[groupNo][k]) ){
									matchcase = true;
									break;
								}
								// 部分一致かつ、ユーザー名が一致
								if( (fullmatch[groupNo] == 0) && (valueA[1].indexOf(userName[groupNo][k]) != -1) ){
									matchcase = true;
									break;
								}
							}
							// ターゲットが同盟
							else{
								// 完全一致かつ、ユーザー名が一致
								if( (fullmatch[groupNo] == 1) && (valueA[4] == userName[groupNo][k]) ){
									matchcase = true;
									break;
								}
								// 部分一致かつ、ユーザー名が一致
								if( (fullmatch[groupNo] == 0) && (valueA[4].indexOf(userName[groupNo][k]) != -1) ){
									matchcase = true;
									break;
								}
							}
						}
					}
					if( matchcase == false ){
						// マッチしない場合は壁扱い
						mapdata[px][py] = MAP_WALL;
					}
				}

				// リソース情報
				if( landLevel != 0 ){
					resdata[px][py] = '★' + landLevel + '&nbsp;(' + valueA[7] + ',' + valueA[8] + ',' + valueA[9] + ',' + valueA[10] + ')';
				}
				else{
					resdata[px][py] = '個人本拠地/拠点';
				}
			}
			else{
				// リソース情報
				resdata[px][py] = '★' + landLevel + '&nbsp;(' + valueA[7] + ',' + valueA[8] + ',' + valueA[9] + ',' + valueA[10] + ')';
			}

			//----------------//
			// ルート特殊処理 //
			//----------------//
			// 土地レベルでの判定
			if( (landLevel > limit) || (mapdata[px][py] == MAP_NPC) ){
				// レベル超過の土地とNPC砦は壁扱いとする
				mapdata[px][py] = MAP_WALL;   // 壁扱い
			}

			// 資源回避での判定
			if(	(season1[cchkres[skipres]][1] == valueA[7])
				&& (season1[cchkres[skipres]][2] == valueA[8])
				&& (season1[cchkres[skipres]][3] == valueA[9])
				&& (season1[cchkres[skipres]][4] == valueA[10]) ){
				// 回避条件に一致する資源は壁扱いとする
				mapdata[px][py] = MAP_WALL;   // 壁扱い
			}

			// 始点、終点特例
			if( ((px == sx) && (py == sy)) || ((px == ex) && (py == ey)) ){
				mapdata[px][py] = MAP_NONE;   // 始点と目的地はルートに加える
			}
		}

		//--------------------//
		// 始点情報の埋め込み //
		//--------------------//
		mapdata[sx][sy] = MAP_START;

		// 探索情報設定
		var posdata = new Array();
		var maxpos = 0;
		posdata[0] = parseInt(sy) * 21 + parseInt(sx);

		for( var i = 0; i <= maxpos; i++ ){
			var cx = parseInt(posdata[i]) % 21;
			var cy = Math.floor(parseInt(posdata[i]) / 21);

			for( var j = 0; j < chkptn.length; j++ ){
				var lx = parseInt(cx) + parseInt(chkptn[j][0]);
				if( (parseInt(lx) < 0) || (parseInt(lx) >= viewSize) ){
					continue;
				}
				var ly = parseInt(cy) + parseInt(chkptn[j][1]);
				if( (parseInt(ly) < 0) || (parseInt(ly) >= viewSize) ){
					continue;
				}

				// 現座標からの移動距離＋１を求める
				var dist = parseInt(mapdata[cx][cy]) + 1;
				// 編集可能？
				if( (mapdata[lx][ly] == MAP_NONE) || (mapdata[lx][ly] == MAP_NPC) ){
					// 距離更新
					mapdata[lx][ly] = dist;

					// 座標登録
					maxpos = maxpos + 1;
					posdata[maxpos] = parseInt(ly) * 21 + parseInt(lx);
				}
				else if( (mapdata[lx][ly] > 0) && (parseInt(mapdata[lx][ly])) > dist ){
					// 距離更新
					mapdata[lx][ly] = dist;

					// 座標登録
					maxpos = maxpos + 1;
					posdata[maxpos] = parseInt(ly) * 21 + parseInt(lx);
				}
			}
		}

		// 事前チェックオンのとき、結果だけ返す
		if( checkmode == "1" ){
			if( mapdata[ex][ey] < 0 ){
				return false;
			}
			else{
				return true;
			}
		}

		// 終点にたどりつけたか？
		if( mapdata[ex][ey] < 0 ){
			alert("目的地に到達するルートを構築できませんでした。構築条件を見直してください。");
			return false;
		}

		//--------------------//
		// サーチルート逆探査 //
		//--------------------//
		posdata[0] = parseInt(ey) * 21 + parseInt(ex);
		maxpos = 0;

		for( var i = 0; i <= maxpos; i++ ){
			var cx = parseInt(posdata[i]) % 21;
			var cy = Math.floor(parseInt(posdata[i]) / 21);

			if( (cx == sx) && (cy == sy) ){
				break;
			}

			// コースとして通過可能な最小資源の土地を調べる
			var lowLevel = 9;
			for( var j = 0; j < chkptn.length; j++ ){
				var lx = parseInt(cx) + parseInt(chkptn[j][0]);
				if( (parseInt(lx) < 0) || (parseInt(lx) >= viewSize) ){
					continue;
				}
				var ly = parseInt(cy) + parseInt(chkptn[j][1]);
				if( (parseInt(ly) < 0) || (parseInt(ly) >= viewSize) ){
					continue;
				}

				// 現座標からの移動距離－１を求める
				var dist = parseInt(mapdata[cx][cy]) - 1;
				// 該当する座標？
				if( (mapdata[lx][ly] >= 0) && (parseInt(mapdata[lx][ly])) == dist ){
					var level = resdata[lx][ly].substr(resdata[lx][ly].indexOf("★")+1,1);
					if( resdata[lx][ly].indexOf("個人本拠地/拠点") >= 0 ){
						level = 0;
					}
					if( lowLevel > level ){
						lowLevel = level;
					}
				}
			}

			//--------------------------//
			// 固定・ランダム構築の分岐 //
			//--------------------------//
			checkBox1 = $e_7('//*[@id="ckRouteRandom"]');
			if( checkBox1.snapshotItem(0).checked == true ){
				//--------------------//
				// ランダムルート構築 //
				//--------------------//

				// パターン乱数の算出
				var pattern;
				var rptn = new Array(2);
				pattern = Math.floor(Math.random() * 30);
				if( pattern < 24 ){
					// 十字優先のパターン(80%の確率でこちら)
					rptn[0] = pattern;

					// 後半4パターンの決定
					pattern = Math.floor(Math.random() * 24);
					rptn[1] = pattern + 24;
				}
				else{
					// ×字優先のパターン(20%の確率でこちら)
					pattern = Math.floor(Math.random() * 24);
					rptn[1] = pattern;

					// 前半4パターンの決定
					pattern = Math.floor(Math.random() * 24);
					rptn[0] = pattern + 24;
				}

				// ルート探索
				for( var j = 0; j < 8; j++ ){
					var rno;
					var offset;
					if( j < 4 ){
						rno = rptn[0];
						offset = j;
					}
					else{
						rno = rptn[1];
						offset = j - 4;
					}

					var lx = parseInt(cx) + parseInt(chkptn_r[rno*4 + offset][0]);
					if( (parseInt(lx) < 0) || (parseInt(lx) >= viewSize) ){
						continue;
					}
					var ly = parseInt(cy) + parseInt(chkptn_r[rno*4 + offset][1]);
					if( (parseInt(ly) < 0) || (parseInt(ly) >= viewSize) ){
						continue;
					}

					// 現座標からの移動距離－１を求める
					var dist = parseInt(mapdata[cx][cy]) - 1;
					var level = resdata[lx][ly].substr(resdata[lx][ly].indexOf("★")+1,1);
					if( resdata[lx][ly].indexOf("個人本拠地/拠点") >= 0 ){
						level = 0;
					}

					// 該当する座標？
					if( (mapdata[lx][ly] >= 0) && (parseInt(mapdata[lx][ly]) == dist) && (level == lowLevel) ){
						// 座標登録
						maxpos = maxpos + 1;
						posdata[maxpos] = parseInt(ly) * 21 + parseInt(lx);

						break;
					}
				}
			}
			else{
				//----------------//
				// 固定ルート構築 //
				//----------------//
				// ルート探索
				for( var j = 0; j < chkptn.length; j++ ){
					var lx = parseInt(cx) + parseInt(chkptn[j][0]);
					if( (parseInt(lx) < 0) || (parseInt(lx) >= viewSize) ){
						continue;
					}
					var ly = parseInt(cy) + parseInt(chkptn[j][1]);
					if( (parseInt(ly) < 0) || (parseInt(ly) >= viewSize) ){
						continue;
					}

					// 現座標からの移動距離－１を求める
					var dist = parseInt(mapdata[cx][cy]) - 1;
					var level = resdata[lx][ly].substr(resdata[lx][ly].indexOf("★")+1,1);
					if( resdata[lx][ly].indexOf("個人本拠地/拠点") >= 0 ){
						level = 0;
					}

					// 該当する座標？
					if( (mapdata[lx][ly] >= 0) && (parseInt(mapdata[lx][ly]) == dist) && (level == lowLevel) ){
						// 座標登録
						maxpos = maxpos + 1;
						posdata[maxpos] = parseInt(ly) * 21 + parseInt(lx);

						break;
					}
				}
			}
		}

		//----------------//
		// ルート情報表示 //
		//----------------//
		var baseText = $e_7('//*[@id="routeInfoText"]');
		checkBox1 = $e_7('//*[@id="ckRouteMode2"]');
		var rollover = $d("rollover");
		var text = '';
		for( var i = maxpos; i >= 0; i-- ){
			var cx = parseInt(posdata[i]) % 21;
			var cy = Math.floor(parseInt(posdata[i]) / 21);

			// areaデータを取ってみる
			var area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + (parseInt(bx) + cx) + "&y=" + (parseInt(by) - cy) + "#ptop\"]");
			if( area_pos == null ){
				area_pos = $x_7("//map[@id=\"mapOverlayMap\"]//area[@href=\"land.php?x=" + (parseInt(bx) + cx) + "&y=" + (parseInt(by) - cy) + "\"]");
			}
			var list3 = area_pos.getAttribute("onmouseover").match(/'(\d+)px', '(\d+)px/);

			// クリックしたポイントに画像を埋め込む
			var img = d_7.createElement("img");
			img.style.position = "absolute";

			img.style.left = list3[1] + "px";
			img.style.top = list3[2] + "px";

			// アイコンの決定
			if( (i != 0) && (i != maxpos) ){
				img.src = ricon;

				if( viewSize == 15 ){
					img.style.width = "44px";
					img.style.height = "44px";
					img.style.zIndex = 227;
				} else if( viewSize == 21 ){
					img.style.width = "33px";
					img.style.height = "33px";
					img.style.zIndex = 444;
				} else {
					img.style.width = "60px";
					img.style.height = "60px";
					img.style.zIndex = 123;
				}
				img.name = "routeIcon";
				img.id = (parseInt(bx) + cx) + "_" + (parseInt(by) - cy);	// 座標をイメージのIDにする
				rollover.parentNode.insertBefore(img, rollover.nextSibling);
			}

			if( text != '' ){
				text = text + '<br>';
			}

			// 資源表示での出力切り替え
			if( checkBox1.snapshotItem(0).checked == false ){
				// 資源出力あり
				text = text + '(' + (parseInt(bx) + cx) + ',' + (parseInt(by) - cy) + ')&nbsp;&nbsp;' + resdata[cx][cy];
			}
			else{
				// 資源出力なし
				if( resdata[cx][cy].indexOf("★") >= 0 ){
					text = text + '(' + (parseInt(bx) + cx) + ',' + (parseInt(by) - cy) + ')&nbsp;&nbsp;'
						+ resdata[cx][cy].substr(0,2);
				}
				else{
					text = text + '(' + (parseInt(bx) + cx) + ',' + (parseInt(by) - cy) + ')&nbsp;&nbsp;' + resdata[cx][cy];
				}
			}
		}

		// ルート表の表示
		baseText.snapshotItem(0).innerHTML = text;

		// ルートを記憶
		autoroute_path[autoroute_maxpaths] = text;
		autoroute_maxpaths = autoroute_maxpaths + 1;

		return true;
	}

	//-----------------------//
	// 自動ルート構築(51x51) //
	//-----------------------//
	function makeAutoRoute_51(checkmode)
	{
		//------//
		// 定数 //
		//------//
		var MAP_NONE  = -1;	// 未処理
		var MAP_NPC   = -2;	// NPC砦
		var MAP_WALL  = -3;	// 壁
		var MAP_START = 0;	 // 起点
		var MAP_END   = -999;  // 目的地

		//------------------//
		// 画面サイズの取得 //
		//------------------//
		var viewSize;
		viewSize = getViewSize();
		if( viewSize != 51 ){
			return false;
		}

		//--------------------------//
		// 同盟検索オプションの取得 //
		//--------------------------//
		var checkBox1;
		var userName = new Array();
		var userText;
		var fullmatch = new Array();
		var target = new Array();
		for( var i = 0; i < 3; i++ ){
			fullmatch[i] = 0;
			target[i] = 0;
		}

		// 個人・同盟検索１
		checkBox1 = $e_7('//*[@id="ckEnable1"]');
		if( checkBox1.snapshotItem(0).checked == true ){
			// 個人・同盟の別
			checkBox2 = $e_7('//*[@id="ckType1"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				target[0] = 1;
			}
			else{
				target[0] = 2;
			}
			// 完全一致
			checkBox2 = $e_7('//*[@id="ckFullMatch1"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				fullmatch[0] = 1;
			}
			else{
				fullmatch[0] = 0;
			}
			userBox = $e_7('//*[@id="userBox1"]');
			userText = userBox.snapshotItem(0).value;
			userName[0] = new Array();
			userName[0] = userText.split(OWNER_SPLITKEY);
		}
		else{
			userName[0] = "";
		}

		// 個人・同盟検索２
		checkBox1 = $e_7('//*[@id="ckEnable2"]');
		if( checkBox1.snapshotItem(0).checked == true ){
			// 個人・同盟の別
			checkBox2 = $e_7('//*[@id="ckType2"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				target[1] = 1;
			}
			else{
				target[1] = 2;
			}
			// 完全一致
			checkBox2 = $e_7('//*[@id="ckFullMatch2"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				fullmatch[1] = 1;
			}
			else{
				fullmatch[1] = 0;
			}
			userBox = $e_7('//*[@id="userBox2"]');
			userText = userBox.snapshotItem(0).value;
			userName[1] = new Array();
			userName[1] = userText.split(OWNER_SPLITKEY);
		}
		else{
			userName[1] = "";
		}

		// 個人・同盟検索３
		checkBox1 = $e_7('//*[@id="ckEnable3"]');
		if( checkBox1.snapshotItem(0).checked == true ){
			// 個人・同盟の別
			checkBox2 = $e_7('//*[@id="ckType3"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				target[2] = 1;
			}
			else{
				target[2] = 2;
			}
			// 完全一致
			checkBox2 = $e_7('//*[@id="ckFullMatch3"]');
			if( checkBox2.snapshotItem(0).checked == true ){
				fullmatch[2] = 1;
			}
			else{
				fullmatch[2] = 0;
			}
			userBox = $e_7('//*[@id="userBox3"]');
			userText = userBox.snapshotItem(0).value;
			userName[2] = new Array();
			userName[2] = userText.split(OWNER_SPLITKEY);
		}
		else{
			userName[2] = "";
		}

		//--------------------------------------------//
		// 全体表示画面から、画面中央座標を手に入れる //
		//--------------------------------------------//
		var ckUser = $e_7('//*[@id="ckRouteUser"]');

		// 処理データの取得
		var href = $e_7('//*[@id="map51-content"]//li');
		var list2 = href.snapshotItem(1300).innerHTML.match(/x=([-]*\d+)&amp;y=([-]*\d+)#/);

		// 左上座標を求める
		var bx = parseInt(list2[1]) - 25;
		var by = parseInt(list2[2]) + 25;

		// 始点、終点座標を求める
		var sx = Math.abs(parseInt(autoroute_f[0]) - parseInt(bx));
		var sy = Math.abs(parseInt(autoroute_f[1]) - parseInt(by));
		var ex = Math.abs(parseInt(autoroute_l[0]) - parseInt(bx));
		var ey = Math.abs(parseInt(autoroute_l[1]) - parseInt(by));

		//------------------//
		// 探査レベルの取得 //
		//------------------//
		var listBox = $e_7('//*[@id="lsRouteLevel"]');
		var listBox2 = $e_7('//*[@id="lsSkipRes"]');
		var listBox3 = $e_7('//*[@id="lsSkipGroup"]');
		var limit = listBox.snapshotItem(0).selectedIndex + 1;
		var skipres = listBox2.snapshotItem(0).selectedIndex;
		var skipgrp = listBox3.snapshotItem(0).selectedIndex;

		//------------------------------//
		// マップデータをマトリックス化 //
		//------------------------------//
		// マップの作成
		var mapdata = new Array();
		var resdata = new Array();
		for(var i = 0; i < 51; i++ ){
			mapdata[i] = new Array();
			resdata[i] = new Array();
		}
		for(var i = 0; i < 51; i++ ){
			for(var j = 0; j < 51; j++ ){
				if( (i >= viewSize) || (j >= viewSize) ){
					mapdata[i][j] = MAP_WALL;	// 画面外は壁扱い
				}
				else{
					mapdata[i][j] = MAP_NONE;	// 未処理エリア
				}
			}
		}

		//--------------------------------//
		// 領土の情報をマトリックスに反映 //
		//--------------------------------//
		for (var i = 0; i < href.snapshotLength; i++) {
			var elem = href.snapshotItem(i);

			list2 = elem.innerHTML.match(/x=([-]*\d+)&amp;y=([-]*\d+)#/);
			if( (list2 == null) || (list2 == undefined) ){
				continue;
			}

			// マトリックス上のオフセット計算
			var px = Math.abs(parseInt(list2[1]) - parseInt(bx));
			var py = Math.abs(parseInt(list2[2]) - parseInt(by));

			// 座標の取得
			var list = elem.innerHTML.match(/x=([-]*\d+)&amp;y=([-]*\d+)#/);
			if( (list == null) || (list == undefined) ){
				continue;
			}

			// 土地レベルの取得
			var p = elem.innerHTML.match(/戦力<\/dt><dd>(.*)<\/dd><dt class=/);
			if( p != undefined ){
				land = p[1];
				landLevel = land.length;
			}
			else{
				p = elem.innerHTML.match(/戦力&lt;\/dt&gt;&lt;dd&gt;(.*)&lt;\/dd&gt;&lt;dt class=/);
				if( p != undefined ){
					land = p[1];
					landLevel = land.length;
				}
				else{
					landLevel = 0;
				}
			}

			// 空き地状態の取得
			var space = 0;
			if( elem.innerHTML.indexOf(">空き地<") >= 0 ){
				space = 1;
			}
			else if( elem.innerHTML.indexOf("&gt;空き地&lt;") >= 0 ){
				space = 1;
			}

			// 同盟名、個人名の取得
			var user;
			var group;
			p = elem.innerHTML.match(/君主名<\/dt><dd>(.*)<\/dd><dt>座標/);
			if( p != undefined ){
				user = p[1];
			}
			else{
				p = elem.innerHTML.match(/君主名&lt;\/dt&gt;&lt;dd&gt;(.*)&lt;\/dd&gt;&lt;dt&gt;座標/);
				if( p != undefined ){
					user = p[1];
				}
			}
			p = elem.innerHTML.match(/君主名<\/dt><dd>(.*)<\/dd><dt>人口/);
			if( p != undefined ){
				user = p[1];
			}
			else{
				p = elem.innerHTML.match(/君主名&lt;\/dt&gt;&lt;dd&gt;(.*)&lt;\/dd&gt;&lt;dt&gt;人口/);
				if( p != undefined ){
					user = p[1];
				}
			}
			p = elem.innerHTML.match(/同盟名<\/dt><dd>(.*)<\/dd><dt>戦力/);
			if( p != undefined ){
				group = p[1];
			}
			else{
				p = elem.innerHTML.match(/同盟名&lt;\/dt&gt;&lt;dd&gt;(.*)&lt;\/dd&gt;&lt;dt&gt;戦力/);
				if( p != undefined ){
					group = p[1];
				}
			}
			p = elem.innerHTML.match(/同盟名<\/dt><dd class=&quot;bottom-popup-r&quot;>(.*)<\/dd><\/dl>/);
			if( p != undefined ){
				group = p[1];
			}
			else{
				p = elem.innerHTML.match(/同盟名&lt;\/dt&gt;&lt;dd class=&quot;bottom-popup-r&quot;&gt;(.*)&lt;\/dd&gt;&lt;\/dl&gt;/);
				if( p != undefined ){
					group = p[1];
				}
			}

			// 資源の取得
			var res = elem.innerHTML.match(/.*木(\d+)&amp;nbsp;岩(\d+)&amp;nbsp;鉄(\d+)&amp;nbsp;糧(\d+).*/);
			if( res == undefined){
				res = new Array();
				res[1] = 0;
				res[2] = 0;
				res[3] = 0;
				res[4] = 0;
			}

			//----------------//
			// 領地のチェック //
			//----------------//
			// NPC砦判定
			if( elem.innerHTML.indexOf("npc-red-star") >= 0 ){
				// NPC砦名
				var casname = elem.innerHTML.match(/bigmap-caption&quot;>(.*)<\/dt><dd class=/);
				if( (casname == null) || (casname == undefined) ){
					casname = elem.innerHTML.match(/bigmap-caption&quot;&gt;(.*)&lt;\/dt&gt;&lt;dd class=/);
				}

				// NPC砦
				mapdata[px][py] = MAP_NPC;

				// リソース情報
				resdata[px][py] = "★" + landLevel + "&nbsp;(" + casname[1] + ")";
			}
			else if( space == 0 ){
				// 個人領土
				if( (ckUser.snapshotItem(0).checked == false) || ((ckUser.snapshotItem(0).checked == true) && (landLevel == 0)) ){
					mapdata[px][py] = MAP_WALL;   // 個人領土を対象外、あるいは対象かつ拠点の場合、壁とみなす
				}

				// 同盟指定
				if( (ckUser.snapshotItem(0).checked == true) && (skipgrp > 0) ){
					// 同盟指定ありの場合、指定条件にマッチしない領土は壁とみなす

					var matchcase = false;	// マッチしたパターン
					var groupNo = skipgrp - 1;

					// 個人・同盟マッチチェック
					for( var k = 0; k < userName[groupNo].length; k++ ){
						// 検索有効時 username に値が入る
						if( userName[groupNo][k] != "" ){
							// ターゲットが個人
							if( target[groupNo] == 1 ){
								// 完全一致かつ、ユーザー名が一致
								if( (fullmatch[groupNo] == 1) && (user == userName[groupNo][k]) ){
									matchcase = true;
									break;
								}
								// 部分一致かつ、ユーザー名が一致
								if( (fullmatch[groupNo] == 0) && (user.indexOf(userName[groupNo][k]) != -1) ){
									matchcase = true;
									break;
								}
							}
							// ターゲットが同盟
							else{
								// 完全一致かつ、ユーザー名が一致
								if( (fullmatch[groupNo] == 1) && (group == userName[groupNo][k]) ){
									matchcase = true;
									break;
								}
								// 部分一致かつ、ユーザー名が一致
								if( (fullmatch[groupNo] == 0) && (group.indexOf(userName[groupNo][k]) != -1) ){
									matchcase = true;
									break;
								}
							}
						}
					}
					if( matchcase == false ){
						// マッチしない場合は壁扱い
						mapdata[px][py] = MAP_WALL;
					}
				}

				// リソース情報
				if( landLevel != 0 ){
					resdata[px][py] = '★' + landLevel + '&nbsp;(' + res[1] + ',' + res[2] + ',' + res[3] + ',' + res[4] + ')';
				}
				else{
					resdata[px][py] = '個人本拠地/拠点';
				}
			}
			else{
				// リソース情報
				resdata[px][py] = '★' + landLevel + '&nbsp;(' + res[1] + ',' + res[2] + ',' + res[3] + ',' + res[4] + ')';
			}

			//----------------//
			// ルート特殊処理 //
			//----------------//
			// 土地レベルでの判定
			if( (landLevel > limit) || (mapdata[px][py] == MAP_NPC) ){
				// レベル超過の土地とNPC砦は壁扱いとする
				mapdata[px][py] = MAP_WALL;   // 壁扱い
			}

			// 資源回避での判定
			if(	(season1[cchkres[skipres]][1] == res[1])
				&& (season1[cchkres[skipres]][2] == res[2])
				&& (season1[cchkres[skipres]][3] == res[3])
				&& (season1[cchkres[skipres]][4] == res[4]) ){
				// 回避条件に一致する資源は壁扱いとする
				mapdata[px][py] = MAP_WALL;   // 壁扱い
			}

			// 始点、終点特例
			if( ((px == sx) && (py == sy)) || ((px == ex) && (py == ey)) ){
				mapdata[px][py] = MAP_NONE;   // 始点と目的地はルートに加える
			}
		}

		//--------------------//
		// 始点情報の埋め込み //
		//--------------------//
		mapdata[sx][sy] = MAP_START;

		// 探索情報設定
		var posdata = new Array();
		var maxpos = 0;
		posdata[0] = parseInt(sy) * 51 + parseInt(sx);

		for( var i = 0; i <= maxpos; i++ ){
			var cx = parseInt(posdata[i]) % 51;
			var cy = Math.floor(parseInt(posdata[i]) / 51);

			for( var j = 0; j < chkptn.length; j++ ){
				var lx = parseInt(cx) + parseInt(chkptn[j][0]);
				if( (parseInt(lx) < 0) || (parseInt(lx) >= viewSize) ){
					continue;
				}
				var ly = parseInt(cy) + parseInt(chkptn[j][1]);
				if( (parseInt(ly) < 0) || (parseInt(ly) >= viewSize) ){
					continue;
				}

				// 現座標からの移動距離＋１を求める
				var dist = parseInt(mapdata[cx][cy]) + 1;
				// 編集可能？
				if( (mapdata[lx][ly] == MAP_NONE) || (mapdata[lx][ly] == MAP_NPC) ){
					// 距離更新
					mapdata[lx][ly] = dist;

					// 座標登録
					maxpos = maxpos + 1;
					posdata[maxpos] = parseInt(ly) * 51 + parseInt(lx);
				}
				else if( (mapdata[lx][ly] > 0) && (parseInt(mapdata[lx][ly])) > dist ){
					// 距離更新
					mapdata[lx][ly] = dist;

					// 座標登録
					maxpos = maxpos + 1;
					posdata[maxpos] = parseInt(ly) * 51 + parseInt(lx);
				}
			}
		}

		// 事前チェックオンのとき、結果だけ返す
		if( checkmode == "1" ){
			if( mapdata[ex][ey] < 0 ){
				return false;
			}
			else{
				return true;
			}
		}

		// 終点にたどりつけたか？
		if( mapdata[ex][ey] < 0 ){
			alert("目的地に到達するルートを構築できませんでした。構築条件を見直してください。");
			return false;
		}

		//--------------------//
		// サーチルート逆探査 //
		//--------------------//
		posdata[0] = parseInt(ey) * 51 + parseInt(ex);
		maxpos = 0;

		for( var i = 0; i <= maxpos; i++ ){
			var cx = parseInt(posdata[i]) % 51;
			var cy = Math.floor(parseInt(posdata[i]) / 51);

			if( (cx == sx) && (cy == sy) ){
				break;
			}

			// コースとして通過可能な最小資源の土地を調べる
			var lowLevel = 9;
			for( var j = 0; j < chkptn.length; j++ ){
				var lx = parseInt(cx) + parseInt(chkptn[j][0]);
				if( (parseInt(lx) < 0) || (parseInt(lx) >= viewSize) ){
					continue;
				}
				var ly = parseInt(cy) + parseInt(chkptn[j][1]);
				if( (parseInt(ly) < 0) || (parseInt(ly) >= viewSize) ){
					continue;
				}

				// 現座標からの移動距離－１を求める
				var dist = parseInt(mapdata[cx][cy]) - 1;
				// 該当する座標？
				if( (mapdata[lx][ly] >= 0) && (parseInt(mapdata[lx][ly])) == dist ){
					var level = resdata[lx][ly].substr(resdata[lx][ly].indexOf("★")+1,1);
					if( resdata[lx][ly].indexOf("個人本拠地/拠点") >= 0 ){
						level = 0;
					}
					if( lowLevel > level ){
						lowLevel = level;
					}
				}
			}

			//--------------------------//
			// 固定・ランダム構築の分岐 //
			//--------------------------//
			checkBox1 = $e_7('//*[@id="ckRouteRandom"]');
			if( checkBox1.snapshotItem(0).checked == true ){
				//--------------------//
				// ランダムルート構築 //
				//--------------------//

				// パターン乱数の算出
				var pattern;
				var rptn = new Array(2);
				pattern = Math.floor(Math.random() * 30);
				if( pattern < 24 ){
					// 十字優先のパターン(80%の確率でこちら)
					rptn[0] = pattern;

					// 後半4パターンの決定
					pattern = Math.floor(Math.random() * 24);
					rptn[1] = pattern + 24;
				}
				else{
					// ×字優先のパターン(20%の確率でこちら)
					pattern = Math.floor(Math.random() * 24);
					rptn[1] = pattern;

					// 前半4パターンの決定
					pattern = Math.floor(Math.random() * 24);
					rptn[0] = pattern + 24;
				}

				// ルート探索
				for( var j = 0; j < 8; j++ ){
					var rno;
					var offset;
					if( j < 4 ){
						rno = rptn[0];
						offset = j;
					}
					else{
						rno = rptn[1];
						offset = j - 4;
					}

					var lx = parseInt(cx) + parseInt(chkptn_r[rno*4 + offset][0]);
					if( (parseInt(lx) < 0) || (parseInt(lx) >= viewSize) ){
						continue;
					}
					var ly = parseInt(cy) + parseInt(chkptn_r[rno*4 + offset][1]);
					if( (parseInt(ly) < 0) || (parseInt(ly) >= viewSize) ){
						continue;
					}

					// 現座標からの移動距離－１を求める
					var dist = parseInt(mapdata[cx][cy]) - 1;
					var level = resdata[lx][ly].substr(resdata[lx][ly].indexOf("★")+1,1);
					if( resdata[lx][ly].indexOf("個人本拠地/拠点") >= 0 ){
						level = 0;
					}

					// 該当する座標？
					if( (mapdata[lx][ly] >= 0) && (parseInt(mapdata[lx][ly]) == dist) && (level == lowLevel) ){
						// 座標登録
						maxpos = maxpos + 1;
						posdata[maxpos] = parseInt(ly) * 51 + parseInt(lx);

						break;
					}
				}
			}
			else{
				//----------------//
				// 固定ルート構築 //
				//----------------//
				// ルート探索
				for( var j = 0; j < chkptn.length; j++ ){
					var lx = parseInt(cx) + parseInt(chkptn[j][0]);
					if( (parseInt(lx) < 0) || (parseInt(lx) >= viewSize) ){
						continue;
					}
					var ly = parseInt(cy) + parseInt(chkptn[j][1]);
					if( (parseInt(ly) < 0) || (parseInt(ly) >= viewSize) ){
						continue;
					}

					// 現座標からの移動距離－１を求める
					var dist = parseInt(mapdata[cx][cy]) - 1;
					var level = resdata[lx][ly].substr(resdata[lx][ly].indexOf("★")+1,1);
					if( resdata[lx][ly].indexOf("個人本拠地/拠点") >= 0 ){
						level = 0;
					}

					// 該当する座標？
					if( (mapdata[lx][ly] >= 0) && (parseInt(mapdata[lx][ly]) == dist) && (level == lowLevel) ){
						// 座標登録
						maxpos = maxpos + 1;
						posdata[maxpos] = parseInt(ly) * 51 + parseInt(lx);

						break;
					}
				}
			}
		}

		//----------------//
		// ルート情報表示 //
		//----------------//
		var baseText = $e_7('//*[@id="routeInfoText"]');
		checkBox1 = $e_7('//*[@id="ckRouteMode2"]');
		var text = '';
		for( var i = maxpos; i >= 0; i-- ){
			var cx = parseInt(posdata[i]) % 51;
			var cy = Math.floor(parseInt(posdata[i]) / 51);

			// areaデータを取ってみる
			var elem = $x_7("//div[@id=\"map51-content\"]//a[@href=\"/land.php?x=" + (parseInt(bx) + cx) + "&y=" + (parseInt(by) - cy) + "#ptop\"]");

			// アイコン表示
			var newhtml;
			if( elem.innerHTML.indexOf("<b>") >= 0 ){
				newhtml = elem.innerHTML.replace(/<b>.*<\/b>/,"<font style=\"border-style: solid; border-color: cyan; background-color:cyan;\">　</font>");
			}
			else{
				if( (elem.innerHTML.indexOf(">S</font>") >= 0) || (elem.innerHTML.indexOf(">E</font>") >= 0) ){
					newhtml = elem.innerHTML;
				}
				else{
					newhtml = elem.innerHTML.replace(/<font.*>.*<\/font>/,"<font style=\"border-style: solid; border-color: cyan; background-color:cyan;\">　</font>");
				}
			}
			elem.innerHTML = newhtml;

			if( text != '' ){
				text = text + '<br>';
			}

			// 資源表示での出力切り替え
			if( checkBox1.snapshotItem(0).checked == false ){
				// 資源出力あり
				text = text + '(' + (parseInt(bx) + cx) + ',' + (parseInt(by) - cy) + ')&nbsp;&nbsp;' + resdata[cx][cy];
			}
			else{
				// 資源出力なし
				if( resdata[cx][cy].indexOf("★") >= 0 ){
					text = text + '(' + (parseInt(bx) + cx) + ',' + (parseInt(by) - cy) + ')&nbsp;&nbsp;'
						+ resdata[cx][cy].substr(0,2);
				}
				else{
					text = text + '(' + (parseInt(bx) + cx) + ',' + (parseInt(by) - cy) + ')&nbsp;&nbsp;' + resdata[cx][cy];
				}
			}
		}

		// ルート表の表示
		baseText.snapshotItem(0).innerHTML = text;

		return true;
	}

	//--------------------//
	// 出兵アイコンクリア //
	//--------------------//
	function attackIconClear() {
		// 出兵アイコンのクリア
		var checkBox = $e_7('//*[@id="ckUnion"]');

		// マップに埋め込んだマーク画像を全部消す
		var rollover = $d("rollover");

		// 無効なら画像を消す
		if( checkBox.snapshotItem(0).checked == false ){
			// すでに画像が登録されてるか調べる
			var en = $e_7('//*[@name="atkIcon"]');
			if( en.snapshotLength > 0 ){
				// 画像がいたら消す
				for( var i = 0; i < en.snapshotLength; i++ ){
					var ex = en.snapshotItem(i);
					var ex_p = ex.parentNode;
					ex_p.removeChild(ex);
				}
			}
		}
		else{
			// 出兵情報マッピング
			unionAttackInfo();
		}
	}
}
//faraway 7.NPC砦、領土情報検索ツールのソース(bro3_npc_castle_info2.user.js)終了

//faraway 8.右クリック拡張のソース(b3rclick.user.js)開始
//================================================================================
//8.右クリック拡張
//================================================================================
function disp_rightclick() {
	/**
	 * gettextっぽい感じのやつ
	 * @param {String} message
	 * @param {Object} messageObject
	 * @function
	 */
	var _ = (function () {
		var locale = navigator.language.toLowerCase().substr(0,2),
		domain = location.hostname.replace(/^[^.]+\./,'').toLowerCase(),
		checks = [
				  {'default' : '_ja','locale' : locale},
				  {'default' : '_3gokushi.jp','locale' : domain}
				 ];

		return function (message,messageObject) {
			var messages,defKey;
			checks.forEach(function (check) {
				var key = '_'+check.locale;
				if (Object.prototype.hasOwnProperty.call(messageObject, key)) {
					messages = messageObject[key];
					defKey = check['default'];
				}
			});
			return messages[message] ? messages[message] : messageObject[defKey][message];
		};
	})(),

	NAMESPACE = 'com.dosukoi-kissa.www/'+location.host,　/*faraway120125+location.host*/
	systemMessages = {
			'_3gokushi.jp' : {
				'LordName' : '\u541b\u4e3b\u540d',	//君主名
				'Flatland' : '\u5e73\u5730'		//平地
			},
			'_1kibaku.jp' : {
				'LordName' : '\u982d\u9996\u540d',
				'Flatland' : '\u5e73\u5730'
			},
	},
	localeMessages = {	// 台湾、英語版すでにないのでロケール定義削除(2014/02/21)
		'_ja' : {
			'Infomation' : '\u60c5\u5831',								//情報
			'Deploy' : '\u51fa\u5175',																  //出兵
			'CenterMap' : '\u4e2d\u592e\u306b\u8868\u793a\u3059\u308b',								 //中央に表示する
			'ConvertTerritory' : '\u3053\u306e\u9818\u5730\u3092\u62e0\u70b9\u306b\u3059\u308b',		//この領地を拠点にする
			'LvUpTerritory' : '\u3053\u306e\u9818\u5730\u3092\u30ec\u30d9\u30eb\u30a2\u30c3\u30d7',	 //この領地をレベルアップ
			'DiscardTerritory' : '\u3053\u306e\u9818\u5730\u3092\u7834\u68c4\u3059\u308b',			  //この領地を破棄する
			'LvUp' : '\u30ec\u30d9\u30eb\u30a2\u30c3\u30d7',											//レベルアップ
			'Building' : '\u5efa\u7bc9>>',															  //建築>>
			'CityField' : '\u90fd\u5e02\u753b\u9762',												   //都市画面
			'MapField' : '\u5730\u56f3\u753b\u9762',													//地図画面
			'GovernorField' : '\u5185\u653f\u753b\u9762'												//内政画面
		},
	},

	$ = function (id,pd) {return pd ? pd.getElementById(id) : document.getElementById(id);},
	$x = function(xp, dc) {function c(f) {var g = '';if (typeof f === 'string') {g = f;}var h = function(a) {var b = document.implementation.createHTMLDocument('');var c = b.createRange();c.selectNodeContents(b.documentElement);c.deleteContents();b.documentElement.appendChild(c.createContextualFragment(a));return b;};if (0 <= navigator.userAgent.toLowerCase().indexOf('firefox')) {h = function(a) {var b = document.implementation.createDocumentType('html','-//W3C//DTD HTML 4.01//EN','http://www.w3.org/TR/html4/strict.dtd');var c = document.implementation.createDocument(null, 'html', b);var d = document.createRange();d.selectNodeContents(document.documentElement);var e = c.adoptNode(d.createContextualFragment(a));c.documentElement.appendChild(e);return c;};}return h(g);}var m = [], r = null, n = null;var o = dc || document.documentElement;var p = o.ownerDocument;if (typeof dc === 'object' && typeof dc.nodeType === 'number') {if (dc.nodeType === 1 && dc.nodeName.toUpperCase() === 'HTML') {o = c(dc.innerHTML);p = o;}else if (dc.nodeType === 9) {o = dc.documentElement;p = dc;}}else if (typeof dc === 'string') {o = c(dc);p = o;}try {r = p.evaluate(xp, o, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for ( var i = 0, l = r.snapshotLength; i < l; i++) m.push(r.snapshotItem(i));}catch (e) {try {var q = p.evaluate(xp, o, null, XPathResult.ANY_TYPE, null);while (n = q.iterateNext()) m.push(n);}catch (e) {throw new Error(e.message);}}return m;},
	$s = function(xp, dc) { return $x(xp,dc).shift();},
	$e = function(doc, event, func, useCapture) {var eventList = event;var eType = null;var capture = useCapture || false;if (typeof event == 'string') {eventList = {};eventList[event] = [func];} else {for (eType in eventList) {if (typeof eventList[eType] == 'object'&& eventList[eType] instanceof Array) {continue;}eventList[eType] = [ event[eType] ];}}for (eType in eventList) {var eventName = eType;for ( var i = 0; i < eventList[eType].length; i++) {doc.addEventListener(eventName, eventList[eType][i], capture);}}},

	//初期設定
	menuWarp = createElement('div'),
	mainMenu = createElement('div', {
		'attribute' : {
			'class' : 'rMenu'
		},
		'css' : {
			'padding': '3px',
			'opacity': 0.8,
			'font-size': 'small',
			'color': '#333333',
			'background-color': '#000000',
			'border': '1px solid #7777FF',
			'position': 'absolute',
			'z-index': 10000,
			'cursor': 'pointer',
			'display': 'none',
			'min-width': '75px'
		},
		'innerText' : 'none'
	}),

	subMenu = mainMenu.cloneNode(false);

	subMenu.setAttribute('ready','false');
	subMenu.innerHTML = "<ul><li>testdayo</li></ul>";

	document.body.appendChild(menuWarp);

	menuWarp.appendChild(mainMenu);
	menuWarp.appendChild(subMenu);

	$e(mainMenu, {
		'mouseover' : function(e){
			mainMenu.style.display = "block";
		},
		'mouseout' : function(e){
			mainMenu.style.display = "none";
		}
	});

	$e(subMenu, {
		'mouseover' : function(e){
			mainMenu.style.display = "block";
			subMenu.style.display = "block";
		},
		'mouseout' : function(e){
			mainMenu.style.display = "none";
			subMenu.style.display = "none";
		}
	});


	subMenu.innerHTML = "<ul><li>testdayo</li></ul>";

	var userName = GM_getValue(NAMESPACE+"userName",null);
	var preCheckTime = GM_getValue(NAMESPACE+"preCheckTime_UserName", null);
	var now = new Date().getTime();

	if (!preCheckTime) preCheckTime = new Date(1976,4,12,3,4,56,789).getTime();//十分前の日付

	if (userName == null || (preCheckTime + 24*60*60*1000) <= now) {
		var interval = 0;
		var getUserName = function(){
			GM_xmlhttpRequest({
				url:location.protocol + "//" + location.host+"/user/"+location.search,
				method : 'GET',
				onload : function(res){
					var dom = document.createElement("html");
					dom.innerHTML = res.responseText;
					var ret = $x('//table[contains(concat(" ",normalize-space(@class)," "), " commonTables ")]//tr[2]/td[2]',dom);
					ret.forEach(function(self){
						userName = self.innerHTML;
						GM_setValue(NAMESPACE+"userName",userName);
						GM_setValue(NAMESPACE+"preCheckTime_UserName",""+new Date().getTime());
					});
					if (userName) {
						clearInterval(interval);
					}
				}
			});
		};
		setTimeout(getUserName,0);
	}

	// 右クリック時の動作
	function rightClickMenu(){
		this.init.apply(this,arguments);
	}

	rightClickMenu.prototype = {
		init:function(){
			this.ruleList = new Array();
			this.ruleList.length = 0;
			this.menu = new Array();
			this.menu.length = 0;
		},
		addMenu:function(menuName){
			this.menu[menuName] = eval(menuName);
		},
		addRule:function(){
			this.ruleList[this.ruleList.length] = {
				type:arguments[0],
				value:arguments[1],
				menu:arguments[2]
			};
		},
		setListener:function(){
			var callee = this;



			var mFunc = function(event){
				var resultMenu = callee.evaluate.apply(callee,arguments);
				if(resultMenu != false && event.button == '2'){
					if (typeof resultMenu.ready == 'function') {
						resultMenu.ready(event);
					}

					var addWarp = document.createElement("UL");
					for(var n=0;n < resultMenu.items.length;n++){
						var addDoc = null;
						var item = resultMenu.items[n];
						var name = callee.getValue(item,"name",arguments);
						if (!name) {
							continue;;
						}
						switch(item.type){
							case 'link':
								var match = null;
								var href = callee.getValue(item,"href",arguments);
								addDoc = document.createElement("A");
								if (0 < href.length) {
									if (href.lastIndexOf("&") == (href.length - 1)) {
										href = href.slice(0,-1);
									}
									if ((match = event.target.href.match(/[\?|&](([x|y]|SSID)=[\w,-]+)/ig)) != null) {
										if (href.lastIndexOf("?") != (href.length - 1)) {
											href += "&";
										}
										href += match.join("").replace("?","");
									}
									$e(addDoc,"click",function() {
										subMenu.style.display = "none";
										mainMenu.style.display = "none";
									});
								}
								else {
									href = "javascript:void(0);";
								}

								addDoc.href = href;
								addDoc.appendChild(document.createTextNode(name));
								break;
							case 'text':
								addDoc = document.createElement("SPAN");
								addDoc.innerHTML = name;
								break;
						}

						if (typeof item.events == 'object') {
							$e(addDoc,item.events);
						}

						var li = document.createElement("LI");
						li.appendChild(addDoc);
						addWarp.appendChild(li);

					}

					mainMenu.replaceChild(addWarp,mainMenu.firstChild);

					mainMenu.style.display = 'block';
					mainMenu.style.top = event.pageY - 5 + 'px';
					mainMenu.style.left = event.pageX - 5  + 'px';

					var warpWidth = parseFloat(document.defaultView.getComputedStyle(addWarp, '').width);
					var bodyWidth = parseFloat(document.defaultView.getComputedStyle(mainMenu.parentNode, '').width);

					if (bodyWidth < (event.pageX + warpWidth + 10)) {
						mainMenu.style.left = (bodyWidth - warpWidth - 15) + "px";
					}

				} else {
					mainMenu.style.display = 'none';
				}

				event.preventDefault();
				return false;
			};


			['(id("mapOverlayMap") | id("map51-content")//div)/*[contains("aAareaAREA",name(.))][@href]','//div[contains(concat(" ",normalize-space(@class)," "), " sideBoxInner ") and contains(concat(" ",normalize-space(@class)," "), " basename ")]//li/a','id("lodgment")/div[contains(concat(" ",normalize-space(@class)," "), " floatInner ")]//li/a[not(contains(concat(" ",normalize-space(@class)," "), " map-basing "))]'].forEach(function(xpath){
				$x(xpath).forEach(function(self){
					$e(self,'contextmenu',mFunc);
				 });
			});
		},
		evaluate : function (event) {
			for (var n=0;n<this.ruleList.length;n++) {
				if (this.ruleList[n].type != 'cond') {
					if (eval("event.target." + this.ruleList[n].type) == this.ruleList[n].value) {
						return this.menu[this.ruleList[n].menu];
					}
				} else {
				 if(this.ruleList[n].value(event)){
						return this.menu[this.ruleList[n].menu];
					}
				}
			}
			return false;
		},
		getValue : function(item,prop,orgArguments) {
			switch (typeof item[prop]) {
				case "function":
					return item[prop].apply(item,orgArguments);
				case "string":
					return item[prop];
			}
			return "";
		}
	};

	// ***************************メニューオブジェクト*********************
	var mapMenu = {
		items:[
		{
			name:function(e){
				var name = '<b>';
				if (e.target.nodeName.toUpperCase() == 'A') {
					$x('@onmouseover',e.target).forEach(function(mouseover){
						var doc = mouseover.value.replace(/^[^']+'|'[^']+$/g,'');
						name += $s('//dt[contains(concat(" ",normalize-space(@class)," "), " bigmap-caption ")]/text()',doc).data;
					});
				}
				else {
					name += e.target.alt;
				}
				return name + "</b>";
			},
			type:"text"
		},
		{
			name: _("Infomation",localeMessages),		//情報
			type:"link",
			href:"land.php?"
		},
		{
			name:_("Deploy",localeMessages),			//出兵
			type:"link",
			href:"facility/castle_send_troop.php?"
		},
		{
			name:_("CenterMap",localeMessages),			//中央に表示する
			type:"link",
			href:"map.php?"
		},
		{
			name: function(e){
				var isMyTerritory = false;
				if (e.target.nodeName.toUpperCase() == 'A') {
				   $x('@onmouseover',e.target).forEach(function(mouseover){
						var doc = mouseover.value.replace(/^[^']+'|'[^']+$/g,'');
						var text = $s('//dt[contains(text(),"'+_('LordName', systemMessages)+'")]/following-sibling::dd[1]/text()',doc);
						if (text && text.data == userName) {
							isMyTerritory = true;
						}
					});
				}
				else {
					isMyTerritory = new RegExp("'[^']+'[^']+'"+userName+"'","i").test(e.target.getAttribute("onmouseover"));
				}
				return isMyTerritory ? _("ConvertTerritory",localeMessages) : null;
			},

			type:"link",
			href:"facility/select_type.php?"
		},
		{
			name: function(e){
				var isMyTerritory = false;
				if (e.target.nodeName.toUpperCase() == 'A') {
					$x('@onmouseover',e.target).forEach(function(mouseover){
						var doc = mouseover.value.replace(/^[^']+'|'[^']+$/g,'');
						var text = $s('//dt[contains(text(),"'+_('LordName', systemMessages)+'")]/following-sibling::dd[1]/text()',doc);
						if (text && text.data == userName) {
							isMyTerritory = true;
						}
					});
				}
				else {
					isMyTerritory = new RegExp("'[^']+'[^']+'"+userName+"'","i").test(e.target.getAttribute("onmouseover"));
				}
				return isMyTerritory ? _("LvUpTerritory",localeMessages) : null;
			},
			type:"link",
			href:"territory_proc.php?"
		},
		{
			name:function(e){
				var isMyTerritory = false;
				if (e.target.nodeName.toUpperCase() == 'A') {
					$x('@onmouseover',e.target).forEach(function(mouseover){
						var doc = mouseover.value.replace(/^[^']+'|'[^']+$/g,'');
						var text = $s('//dt[contains(text(),"'+_('LordName', systemMessages)+'")]/following-sibling::dd[1]/text()',doc);
						if (text && text.data == userName) {
							isMyTerritory = true;
						}
					});
				}
				else {
					isMyTerritory = new RegExp("'[^']+'[^']+'"+userName+"'","i").test(e.target.getAttribute("onmouseover"));
				}
				return isMyTerritory ? _("DiscardTerritory",localeMessages) : null;
			},
			type:"link",
			href:"territory_proc.php?mode=remove&",
			events : {
				click : function (event) {
					subMenu.style.display = "none";
					mainMenu.style.display = "none";
					event.target.href.match(/^.*[\?\&]x=(-?[0-9]+)&.*y=(-?[0-9]+).*$/);
					x=RegExp.$1;y=RegExp.$2;
					var url = "http://" + document.location.hostname + "/territory_proc.php?x=" + x + "&y=" + y + "&mode=remove";
					wrapHttpReq(url, "GET", null,
						function(response) {
							var rmtime = response.match(/(現在領地を破棄中です)[^\d]*\n*(\d+-\d+-\d+ \d+:\d+:\d+)/ );
							if( rmtime ) {
								if( rmtime[1] == "現在領地を破棄中です" ) {
									addTerritoryList(rmtime[2], 0, x, y );
								}
							}
							alert("座標(" + x + "," + y + ")の領地を破棄しました。");
						}
					);
					event.preventDefault();
				}
			}
		}
		]
	};

	var villageMenu = {
		items:[
		{
			name:function(event){
				return "<b>" + event.target.alt + "</b>";
			},
			type:"text"
		},
		{
			name: _("Infomation",localeMessages),
			type:"link",
			href:"facility/select_facility.php?"
		},
		{
			name:function(event){
				if (event.target.alt == _('Flatland', systemMessages)) {
					return null;
				}
				return _("LvUp",localeMessages);
			},
			type:"link",
			href:"facility/build.php?",
			events : {
				click : function (event) {
					subMenu.style.display = "none";
					mainMenu.style.display = "none";
			event.target.href.match(/^.*[\?\&]x=(-?[0-9]+)&.*y=(-?[0-9]+).*$/);
			x=RegExp.$1;y=RegExp.$2;
			hiro_lvupfacility(x,y,document.evaluate('//*[@id="basepoint"]/span[@class="xy"]',document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0).innerHTML);
					event.preventDefault();
					return false;
		}
			}
		},
		{
			name:function(event){
				if (event.target.alt == _('Flatland', systemMessages)) {
					return _('Building', localeMessages);
				}
				return "";
			},
			type:"link",
			href:"",
			events : {
				mouseover : function(event) {
					var enabled = function() {
						if (subMenu.getAttribute("ready") == "false") {
							setTimeout(enabled,200);
							return;
						};
						var left = parseFloat(mainMenu.style.left) + ((mainMenu.clientWidth < 75) ? 75 : mainMenu.clientWidth) - 15;
						subMenu.style.display = 'block';
						subMenu.style.top = event.pageY + 'px';
						subMenu.style.left = left + 'px';
					};
					enabled();
				},
				mouseout: function(e) {
					subMenu.style.display = 'none';
				},
				click : function (e) {
					e.preventDefault();
					return false;
				}
			}
		}
		],
		ready : function(event) {
			var baseUrl = location.protocol + "//"+location.hostname+"/";
			subMenu.setAttribute("ready","false");
			GM_xmlhttpRequest({
				url:event.target.href,
				method : 'GET',
				onload:function(respons){
					subMenu.innerHTML = "";
					var addWarp = document.createElement("UL");
					subMenu.appendChild(addWarp);
					var dom = document.createElement("html");
					dom.innerHTML = respons.responseText;

					$x('//table[@summary="object"]',dom).forEach(function(self){ //建設可能施設数分ループ
						var addDocWarp = document.createElement("LI");
						var addDoc = document.createElement("A");

						$x('.//th[contains(concat(" ",normalize-space(@class)," "), " mainTtl ")]',self).forEach(function(th){
							addDoc.innerHTML = th.innerHTML;			//施設名取得
						});
			//リンク先取得
						$x('.//div[contains(concat(" ",normalize-space(@class)," "), "lvupFacility")]/p[contains(concat(" ",normalize-space(@class)," "), " main ")]/a',self).forEach(function(a){
				addDoc.href = "javascript:void(0)";
				lfc2_formname=a.getAttribute('onClick').match(/\'([^\']+)/)[1]; //施設建築用のFORMの名称
				//FormのinputのnameとValue全部とりだし
				$x('//form[@name="' + lfc2_formname + '"]/input',self).forEach(function(input){
					if(input.name=="ssid"	  ) lfc2_ssid		=input.value;
					if(input.name=="id"	  ) lfc2_id		=input.value;
					if(input.name=="x"		 ) lfc2_x		=input.value;
					if(input.name=="y"		 ) lfc2_y		=input.value;
					if(input.name=="village_id") lfc2_village_id	=input.value;
				})
				addDoc.id = [lfc2_ssid,lfc2_id,lfc2_x,lfc2_y,lfc2_village_id].join(",");

			});
			//クリックした時の動作
			$e(addDoc,'click',function(e){
						subMenu.style.display = "none";mainMenu.style.display = "none";
						hiro_buildfacitity2(	this.id.split(',')[0],this.id.split(',')[1],
									this.id.split(',')[2],this.id.split(',')[3],this.id.split(',')[4]);
					});
						addDocWarp.appendChild(addDoc);
						addWarp.appendChild(addDocWarp);
//建設可能施設数分ループ完了
					});
					subMenu.setAttribute("ready","true");
				}
			});
		}
	};

	var sidebarVillageMenu = {
		items:[
		{
			name:function(event){
				return "<b>" + event.target.title + "</b>";
			},
			type:"text"
		},
		{
			name: _("CityField",localeMessages),
			type:"link",
			href:function(event){
				var res = null;
				var query = "";
				if((res = event.target.href.match(/village_id=([^&]*)/i)) != null){
					query = res[1];
				}
				return "http://" + location.host + "/village_change.php?page=%2Fvillage.php&village_id=" + query;
			}
		},
		{
			name:_("MapField",localeMessages),
			type:"link",
			href:function(event){
				var res = null;
				var query = "";
				if((res = event.target.href.match(/village_id=([^&]*)/i)) != null){
					query = res[1];
				}
				return "http://" + location.host + "/village_change.php?page=%2Fmap.php&village_id=" + query;
			}
		},
		{
			name:_("GovernorField",localeMessages),
			type:"link",
			href:function(event){
				var res = null;
				var query = "";
				if((res = event.target.href.match(/village_id=([^&]*)/i)) != null){
					query = res[1];
				}
				return "http://" + location.host + "/village_change.php?page=%2Fcard%2Fdomestic_setting.php&village_id=" + query + "&";
			}
		}
		]
	};

	// ***************************メニューオブジェクトここまで***************

	// **************************全体*************************
	var rMenu = new rightClickMenu();
	rMenu.setListener();

	rMenu.addMenu('sidebarVillageMenu');
	rMenu.addRule("cond",function(event){
		if(event.target.href != "undefined" && event.target.href.match(/village_change.php/i)){
			return true;
		}
	},'sidebarVillageMenu');

	// **************************地図画面*************************
	if(document.URL.match(/(?:big_)?map\.php/i)){
		rMenu.addMenu('mapMenu');
		rMenu.addRule('tagName','AREA','mapMenu');
		rMenu.addRule('tagName','A','mapMenu');
	}

	// **************************都市画面*************************
	if(document.URL.match(/village.php/i)){
		rMenu.addMenu('villageMenu');
		rMenu.addRule('tagName','AREA','villageMenu');
	}
	GM_addStyle([
					".rMenu li b{ color:#FFAAAA;list-style :none outside none;white-space: nowrap;}",
					".rMenu li{ color:#FFFFFF;list-style :none outside none;white-space: nowrap;}",
					".rMenu a:link{text-decoration:none;padding-right:2px;padding-left:1px}",
					".rMenu a:visited {text-decoration:none;padding-right:2px;padding-left:1px}",
					".rMenu a:hover {background-color:#DDDDDD;color:#333333;text-decoration:none;}",
					".rMenu a:active {background-color:#DDDDDD;color:#333333;text-decoration:none;}",
					".rMenu a {display: block;width: 98%;margin-right: 1px;}",
					"#headerArea{ display:none; }",
					].join("\n")
				);


	/**
	*
	* @param {String} text
	* @returns {Element}
	*/
	function createText(text) {
	   return document.createTextNode(text);
	}

	/**
	* Function createElement
	*
	* @param {String} elementName
	* @param {Object} [option]
	* @param {HTMLDocument} [doc]
	* @returns {Element}
	*/
	function createElement(elementName, option, doc) {
	   var pageDocument = doc ? doc : document;
	   var retElement = elementName == 'img' ? new Image() : pageDocument
			   .createElement(elementName);

	   if (typeof option == 'object') {
		   if (typeof option.attribute == 'object') {
			   for ( var attrName in option.attribute) {
				   retElement.setAttribute(attrName, option.attribute[attrName]);
			   }
		   }
		   if (typeof option.events == 'object') {
			   $e(retElement, option.events);
		   }
		   if (typeof option.innerText == 'string') {
			   retElement.appendChild(pageDocument.createTextNode(option.innerText));
		   }
		   if (typeof option.css == 'object') {
			   var cssString = '';
			   for ( var cssProp in option.css) {
				   retElement.style.setProperty(cssProp, option.css[cssProp], '');
			   }
		   } else if (option.css == 'string') {
			   retElement.style.cssText = option.css;
		   }
	   }
	   return retElement;
	}


	/**
	 * initGMFunctions
	 * @description GM関数初期化
	 */
	function initGMFunctions() {
		var hasGM = (function() {
			var result = {},
				notSupportReg = /not\s*support/i,
				existsAPI = function(func) {
					return typeof func === 'function' &&
									( Object.prototype.hasOwnProperty.call(func, '__proto__') === false ||
											notSupportReg.test(String(func)) === false );
				};
			[
					'GM_getValue', 'GM_setValue', 'GM_listValues', 'GM_deleteValue', 'GM_addStyle',
					'GM_log', 'GM_xmlhttpRequest', 'GM_getResourceURL', 'GM_getResourceText'
			].forEach(function(methodName) {
				var resName = methodName.substr(3);
				result[resName] = false;

				if (Object.prototype.hasOwnProperty.call(this, methodName) && existsAPI(this[methodName])) {
					result[resName] = true;
				}
			});
			return result;
		})();

		/**
		 * GM_addStyle
		 * @param {String} css css text
		 * @function
		 */
		if (hasGM.addStyle === false) {
			GM_addStyle = function(css) {
				var style = document.evaluate('//head/style[not(@src) and last()]', document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null);
				style = style && style.singleNodeValue || document.createElement('style');
				style.type = 'text/css';
				style.appendChild(document.createTextNode(css));
				if (!(style.parentNode || style.parentElement)) {
					document.getElementsByTagName('head')[0].appendChild(style);
				}
			};
		}

		/**
		 * GM_setValue
		 * @param {String} name storage key
		 * @param {String|Number|Boolean} value storage saved object
		 * @throws {TypeError}
		 * @see localStorage
		 * @function
		 */
		if (hasGM.setValue === false) {
			GM_setValue = function(name, value) {
				switch (typeof value) {
					case 'string':
					case 'number':
					case 'boolean':
						break;
					default:
						throw new TypeError();
				}

				value = (typeof value)[0] + value;
				localStorage.setItem(name, value);
			};
		}

		/**
		 * GM_getValue
		 * @param {String} key storage key
		 * @param {Object} [defaultValue] any Object
		 * @returns {Object}
		 * @see localStorage
		 * @function
		 */
		if (hasGM.getValue === false) {
			GM_getValue = function(key, defaultValue) {
				var value = localStorage.getItem(key);
				if (!value) {
					return defaultValue;
				}
				var type = value[0];
				value = value.substring(1);
				switch (type) {
					case 'b':
						return value == 'true';
					case 'n':
						return Number(value);
					default:
						return value;
				}
			};
		}

		/**
		 * GM_deleteValue
		 * @param {String} key storage key
		 * @see localStorage
		 * @function
		 */
		if (hasGM.deleteValue === false) {
			GM_deleteValue = function(key) {
				localStorage.removeItem(key);
			};
		}

		/**
		 * GM_listValues
		 * @returns {Array}
		 * @see localStorage
		 * @function
		 */
		if (hasGM.listValues === false) {
			GM_listValues = function() {
				var len = localStorage.length;
				var res = [];
				var key = '';
				for ( var i = 0; i < len; i++) {
					key = localStorage.key(i);
					res[key] = key;
				}
				return res;
			};
		}

		/**
		 * GM_log
		 * @param {Object} message any Object
		 * @function
		 * @see console
		 */
		if (hasGM.log === false) {
			GM_log = function(message) {
				if (typeof console === 'object' && Object.prototype.hasOwnProperty.call(console, 'log')) {
					console.log(message);
				}
				else if (typeof opera == 'object' && Object.prototype.hasOwnProperty.call(opera, 'postError')) {
					opera.postError(message);
				}
				else {
					window.alert(message);
				}
			};
		}

		/**
		 * GM_xmlhttpRequest
		 * @param requestParam Object request parameter settings
		 * @param requestParam.url request url string
		 * @param [requestParam.method="GET"] request method. default is GET
		 * @param [requestParam.data] request data
		 * @param [requestParam.headers] request headers object
		 * @param [requestParam.onload] request complite event handler
		 * @param [requestParam.onerror] request error event handler
		 * @param [requestParam.onreadystatechange] request readystatechange event handler
		 * @returns {XMLHttpRequest}
		 */
		if (hasGM.xmlhttpRequest === false) {
			GM_xmlhttpRequest = function(requestParam) {
				var xhr;
				if (typeof XMLHttpRequest == 'function') {
					xhr = XMLHttpRequest;
				}
				else {
					return null;
				}
				var req = new xhr();
				[
						'onload', 'onerror', 'onreadystatechange'
				].forEach(function(event) {
					if ((event in requestParam) == false) {
						return;
					}
					req[event] = function() {
						var isComplete = (req.readyState == 4);
						var responseState = {
							responseText : req.responseText,
							readyState : req.readyState,
							responseHeaders : isComplete ? req.getAllResponseHeaders() : '',
							status : isComplete ? req.status : 0,
							statusText : isComplete ? req.statusText : '',
							finalUrl : isComplete ? requestParam.url : ''
						};
						requestParam[event](responseState);
					};
				});

				try {
					req.open(requestParam.method ? requestParam.method : 'GET', requestParam.url, true);
				}
				catch (e) {
					if (requestParam.onerror) {
						requestParam.onerror({
							readyState : 4,
							responseHeaders : '',
							responseText : '',
							status : 403,
							statusText : 'Forbidden',
							finalUrl : ''
						});
					}
					return null;
				}

				if ('headers' in requestParam && typeof requestParam.headers == 'object') {
					for ( var name in requestParam.headers) {
						req.setRequestHeader(name, requestParam.headers[name]);
					}
				}

				req.send(('data' in requestParam) ? requestParam.data : null);
				return req;
			};
		}
	}
}

//faraway 8.右クリック拡張のソース(b3rclick.user.js)終了

//-----------------------------------------
// 同盟レベル画面改善ツール
//-----------------------------------------
function disp_alliancelevel() {
	if(location.pathname != "/alliance/level.php") return;

/* レベル/人数/寄付総額/最大人数/必要寄付額/次レベル最大人数 */
	cl=document.getElementsByClassName('contents');
	np=parseInt(cl[4].innerHTML)-parseInt(cl[2].innerHTML);
	cl[1].innerHTML+=' <span style="color:red">(空き枠:'+(parseInt(cl[3].innerHTML)-parseInt(cl[1].innerHTML))+')</span>';
	cl[2].innerHTML+=' <br><span style="color:red">(次まで:'+(np)+'／1人あたり:'+Math.round(np/parseInt(cl[1].innerHTML))+')</span>';
	cl[3].innerHTML+=' <span style="color:red">(次で+'+(parseInt(cl[5].innerHTML)-parseInt(cl[3].innerHTML))+')</span>';
}

//--------------------------------
// ミス防止補助ツール
//--------------------------------
function disp_mistakeprevention() {
if (location.pathname != "/facility/facility.php" && location.pathname != "/facility/castle_send_troop.php")  return;

	var chkFight='fighting_units';
	var dispatchOfTroops='btn_send';
	var soldierType=Array('infantry_count','shield_count','spear_count','archer_count','cavalry_count','heavy_shield_count','large_infantry_count','halbert_count','crossbow_count','cavalry_guards_count','scout_count','cavalry_scout_count','ram_count','catapult_count');
	var StatusTable='status_table';

	var chktype = [
		['301','剣兵'],['303','槍兵'],['304','矛槍兵'],['305','騎兵'],['307','近衛騎兵'],['308','弓兵'],['309','弩兵'],['310','斥候'],['311', '斥候騎兵'],['312', '衝車'],['313', '投石'],['315', '大剣兵'],['316', '盾兵'],['317','重盾兵']
	];
	for(var i = 0; i < chktype.length; i++){
		sc = document.getElementById("unit_value[" + chktype[i][0] + "]");
		if( sc ){
			sc.style.backgroundColor='#ecc';
			sc.style.textAlign='center';
			sc.style.width='8em';
			sc.value = chktype[i][1];
			sc.select();
			sc.addEventListener ('click', function(){ if(!parseInt(this.value)){ this.value ="" }}, true );
		}
	}
	// 出兵画面か判定
	if (document.getElementsByClassName(chkFight).length>0) {
		var soldiers='';
		var smodecls='';
		var smodetxt='';
		// suport：援軍
		// fight：賊討伐・殲滅戦
		// forceattack：強襲
		// spy：偵察
		smode=document.getElementsByClassName('suport');
		if (smode.length>0) {
			smodetxt=smode[0].innerHTML.replace(/<sp.*an>/,'');
		}
		smode=document.getElementsByClassName('fight');
		if (smode.length>0) {
			smodetxt=smode[0].innerHTML.replace(/<sp.*an>/,'');
		}
		smode=document.getElementsByClassName('forceattack');
		if (smode.length>0) {
			smodetxt=smode[0].innerHTML.replace(/<sp.*an>/,'');
		}
		smode=document.getElementsByClassName('spy');
		if (smode.length>0) {
			smodetxt=smode[0].innerHTML.replace(/<sp.*an>/,'');
		}
		areaplus=document.getElementsByClassName('controlArea');
		if (areaplus.length>0) {
			areaplus[0].innerHTML+=' <span style="text-align:center;margin-left:1em;padding:3px 5px;font-weight:bold;background-color:#fc0">'+smodetxt+'<\/span>';
		}
		for (lp=0;lp<soldierType.length;lp++) {
			soldierels=document.getElementsByName(soldierType[lp]);
			soldiers+=soldierels[0].value;
		}
		el=document.getElementById(dispatchOfTroops);
		el.title=smodetxt;
		if (soldiers=='') {
			el.value='出兵（武将単騎）';
			el.style.color='#f00';
			el.style.backgroundColor='#ff0';
		}
		//援軍判定
		html=document.getElementsByClassName('fightingpower');
		if (html[0].innerHTML.indexOf('援軍部隊戦力',0)>-1) {
			el.value=(soldiers=='')?'出兵（単騎援軍）':'出兵（援軍）';
			el.style.color='#fff';
			el.style.backgroundColor=(soldiers=='')?'#009':'#363';
		}
	}
	//ステータス強化画面
	st=document.getElementById(StatusTable);
	if (st) {
		st.style.width='500px';
	}
	// 鯖を表示

	sn=document.getElementById('worldtime');
	if (sn) {
		str=sn.innerHTML;
		pp=str.indexOf('ワールド');
		str=str.substring(0,pp);
		str=str.match('[0-9]*$');
		document.title='['+str+']'+document.title;
	}
}

//faraway 10.ミス防止補助ツールのソース(3594warning.user.js)終了

//------------------------------------
// 書簡送信アシスタント
//------------------------------------
function disp_lettertransmission() {
	if (location.pathname != "/message/new.php" && location.pathname != "/false/login_sessionout.php" && location.pathname != "/message/outbox.php"){
		return;
	}

	//操作ボックスの表示リンク追加
	addOpenLinkHtml_11();
	//通常の送信時に書簡をバックアップする。
	document.forms[0].elements[5].addEventListener("click", function(){ SubjectSave();BodySave();}, false);
	//送信状況の取得
	var Send_Flg = GM_getValue(HOST + PGNAME + "Send_Flg", SENDTFLG_NEW);
	GM_log("Main() Send_Flg=" + Send_Flg);
	//プレビュー時
	if (Send_Flg == SENDTFLG_PRE) {
		openSupportBox();
		var objtextTo = document.getElementsByName("to");
		if (objtextTo[0].type == "hidden"){
			GM_setValue(HOST + PGNAME + "Send_Flg", SENDTFLG_END);
			var tid=setTimeout(function(){btn=document.getElementById("btn_send");btn.disabled=true;setHiddenValue(btn);btn.form.submit();},INTERVAL);
		}else{
			GM_setValue(HOST + PGNAME + "Send_Flg", SENDTFLG_NEW);
			alert("送信しようとしましたが、エラーで出来ませんでした。");
			return;
		}
	}
	//送信終了時(送信履歴)
	if (Send_Flg == SENDTFLG_END) {
		GM_setValue(HOST + PGNAME + "Send_Flg", SENDTFLG_CON);
		var tid=setTimeout(function(){location.href = "/message/new.php#ptop";},INTERVAL);
	}
	//連続送信中(新規作成画面)
	if (Send_Flg == SENDTFLG_CON) {
		OneAddressFlgDel();
		openSupportBox();
		//次の送信があるかチェック
		if(SendConti()){
			GM_setValue(HOST + PGNAME + "Send_Flg", SENDTFLG_PRE);
			var tid=setTimeout(function(){document.forms[0].elements[5].click();},INTERVAL);
		}
	}
	//セッションタイムアウト画面
	if (location.pathname == "/false/login_sessionout.php") {
		if (Send_Flg != SENDTFLG_NEW) {
			alert("送信途中でセッションタイムアウトになりました。\n書簡の送信履歴でどこまで送信されているかチェックし\n再度送信してください。");
			GM_setValue(HOST + PGNAME + "Send_Flg", SENDTFLG_NEW);
		}
	}

}

//送信したアドレスのフラグを消す。
function OneAddressFlgDel(){
	var arrylist = GetSendAddress();
	var arrynewlist ="";
	var SendFLg = true;
	for (var i=0; i < ADDRESSCNT; i++){
		if (arrylist[i] != undefined) {
			if (arrylist[i] != "") {
				GM_log("OneAddressFlgDel() SendFLg=" + SendFLg);
				if (arrylist[i].split(DELIMIT2_11)[2] == 1 && SendFLg == true){
				GM_log("OneAddressFlgDel() if SendFLg=" + SendFLg);
					arrynewlist += arrylist[i].split(DELIMIT2_11)[0] + DELIMIT2_11;
					arrynewlist += arrylist[i].split(DELIMIT2_11)[1] + DELIMIT2_11;
					arrynewlist += "0" + DELIMIT_11;
					SendFLg = false;
				}else{
				GM_log("OneAddressFlgDel() else SendFLg=" + SendFLg);
					arrynewlist += arrylist[i].split(DELIMIT2_11)[0] + DELIMIT2_11;
					arrynewlist += arrylist[i].split(DELIMIT2_11)[1] + DELIMIT2_11;
					arrynewlist += arrylist[i].split(DELIMIT2_11)[2] + DELIMIT_11;
				}
			}
		}
	}
	GM_log("OneAddressFlgDel() arrynewlist=" + arrynewlist);
	GM_setValue(HOST + PGNAME + "addresslist", arrynewlist);
}
//送信開始
function SendConti(){
	//アドレスチェック
	var chkret = AdressCheck();
	if (chkret == false){
		GM_setValue(HOST + PGNAME + "Send_Flg", SENDTFLG_NEW);
		alert("送信が完了しました。\n送信履歴で送信されてるか確認してください。");
		var tid=setTimeout(function(){location.href = "/message/outbox.php";},0);
		return false;
	}

	//送信内容の読込み
	SubjectLoad();
	BodyLoad();
	//送信先のチェック保存
	var arrylist = GetSendAddress();
	var arryflg = new Array();
	for (var i = 0; i < ADDRESSCNT; i++) {
		var objChk = document.getElementById("chk" + i);
		arryflg[i] = false;
		if(objChk.checked == true){
			arryflg[i] = true;
		}
	}
	GM_log("SendConti() arryflg=" + arryflg);
	ChkSendAddress(arryflg);

	var ret = SetSendAddress();
	return true;
}
//リンクHTML追加
function addOpenLinkHtml_11() {
	var menu = d_11.evaluate('//*[@id="statMenu"]',d_11, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	if (menu.snapshotLength == 0){GM_log("bro3_send_mail_supporter: htmlが変わってます。判る人は170行目付近のソースを書き換えてください。");return;}

	var newmenu = d_11.createElement("li");
	newmenu.className = "last";
	//メニューリンク
	var openLink = document.createElement("a");
	openLink.id = "AutoMoveLink";
	openLink.href = "javascript:void(0);";
	openLink.innerHTML = "  書簡送信サポート  ";
	openLink.addEventListener("click", function() {openSupportBox()}, true);
	newmenu.appendChild(openLink);
	menu.snapshotItem(0).appendChild(newmenu);
}

//ベースフォームを開く
function openSupportBox() {
	closeSupportBox();
	addSupportHtml();
}
//ベースフォームを閉じる
function closeSupportBox() {
	deleteSupportHtml();
	closeSupportAddressBox();
}
//ベースフォーム表示HTML削除
function deleteSupportHtml() {
	var elem = document.getElementById("SuppContainer");
	if (elem == undefined) return;
	document.body.removeChild(document.getElementById("SuppContainer"));
}

//宛先追加フォームを開く
function openSupportAddressBox() {
	closeSupportAddressBox();
	addSupport_AddressHtml();
}
//宛先追加フォームを閉じる
function closeSupportAddressBox() {
	deleteSupportAddressHtml();
}
//宛先追加HTML削除
function deleteSupportAddressHtml() {
	var elem = document.getElementById("SuppAddresContainer");
	if (elem == undefined) return;
	document.body.removeChild(document.getElementById("SuppAddresContainer"));
}

//ベースフォーム表示HTML追加
function addSupportHtml() {

	var popupLeft = GM_getValue(HOST + "popup_Suppleft", 0);
	var popupTop = GM_getValue(HOST + "popup_Supptop", 0);
	if (popupLeft < 0) popupLeft = 0;
	if (popupTop < 0) popupTop = 0;

	//表示コンテナ作成
	var SuppContainer = document.createElement("div");
	SuppContainer.id = "SuppContainer";
	SuppContainer.style.position = "absolute";
	SuppContainer.style.backgroundColor = "darkgray";
	SuppContainer.style.border = "outset 2px darkgray";
	SuppContainer.style.left = popupLeft + "px";
	SuppContainer.style.top = popupTop + "px";
	SuppContainer.style.fontSize = "10px";
	SuppContainer.style.padding = "3px";
	SuppContainer.style.zIndex = 8001;
	document.body.appendChild(SuppContainer);

	//閉じるリンク
	var closeLink = document.createElement("a");
	closeLink.id = "timerCloseLink";
	closeLink.href = "javascript:void(0);";
	closeLink.style.margin = "3px";
	closeLink.innerHTML = "閉じる";
	closeLink.addEventListener("click", function() {closeSupportBox()}, true);
	SuppContainer.appendChild(closeLink);

	//バージョン
	var version = document.createElement("span");
	version.style.fontSize = "9px";
	version.style.margin = "3px";
	version.innerHTML = "Ver." + VERSION_11;
	SuppContainer.appendChild(version);

	//入力項目の作成
	var table = document.createElement("div");
	table.innerHTML = "\
	<table width='930' border='1' cellspacing='0' cellpadding='10'>\
	  <tr>\
		<td colspan='6' style='text-align:center' width='750'>宛先</td>\
		<td style='text-align:center' width='180'>件名</td>\
	  </tr>\
	  <tr>\
		<td rowspan='3' width='125'>\
		  <input id='chk0' type='checkbox' /><span id='chk_name0'></span><br />\
		  <input id='chk1' type='checkbox' /><span id='chk_name1'></span><br />\
		  <input id='chk2' type='checkbox' /><span id='chk_name2'></span><br />\
		  <input id='chk3' type='checkbox' /><span id='chk_name3'></span><br />\
		  <input id='chk4' type='checkbox' /><span id='chk_name4'></span><br />\
		  <input id='chk5' type='checkbox' /><span id='chk_name5'></span>\
		</td>\
		<td rowspan='3' width='125'>\
		  <input id='chk6' type='checkbox' /><span id='chk_name6' /><br />\
		  <input id='chk7' type='checkbox' /><span id='chk_name7' /><br />\
		  <input id='chk8' type='checkbox' /><span id='chk_name8' /><br />\
		  <input id='chk9' type='checkbox' /><span id='chk_name9' /><br />\
		  <input id='chk10' type='checkbox' /><span id='chk_name10' /><br />\
		  <input id='chk11' type='checkbox' /><span id='chk_name11' />\
		</td>\
		<td rowspan='3' width='125'>\
		  <input id='chk12' type='checkbox' /><span id='chk_name12'></span><br />\
		  <input id='chk13' type='checkbox' /><span id='chk_name13'></span><br />\
		  <input id='chk14' type='checkbox' /><span id='chk_name14'></span><br />\
		  <input id='chk15' type='checkbox' /><span id='chk_name15'></span><br />\
		  <input id='chk16' type='checkbox' /><span id='chk_name16'></span><br />\
		  <input id='chk17' type='checkbox' /><span id='chk_name17'></span>\
		</td>\
		<td rowspan='3' width='125'>\
		  <input id='chk18' type='checkbox' /><span id='chk_name18'></span><br />\
		  <input id='chk19' type='checkbox' /><span id='chk_name19'></span><br />\
		  <input id='chk20' type='checkbox' /><span id='chk_name20'></span><br />\
		  <input id='chk21' type='checkbox' /><span id='chk_name21'></span><br />\
		  <input id='chk22' type='checkbox' /><span id='chk_name22'></span><br />\
		  <input id='chk23' type='checkbox' /><span id='chk_name23'></span>\
		</td>\
		<td rowspan='3' width='125'>\
		  <input id='chk24' type='checkbox' /><span id='chk_name24'></span><br />\
		  <input id='chk25' type='checkbox' /><span id='chk_name25'></span><br />\
		  <input id='chk26' type='checkbox' /><span id='chk_name26'></span><br />\
		  <input id='chk27' type='checkbox' /><span id='chk_name27'></span><br />\
		  <input id='chk28' type='checkbox' /><span id='chk_name28'></span><br />\
		  <input id='chk29' type='checkbox' /><span id='chk_name29'></span>\
		</td>\
		<td rowspan='3' width='125'>\
		  <input id='chk30' type='checkbox' /><span id='chk_name30'></span><br />\
		  <input id='chk31' type='checkbox' /><span id='chk_name31'></span><br />\
		  <input id='chk32' type='checkbox' /><span id='chk_name32'></span><br />\
		  <input id='chk33' type='checkbox' /><span id='chk_name33'></span><br />\
		  <input id='chk34' type='checkbox' /><span id='chk_name34'></span><br />\
		  <input id='chk35' type='checkbox' /><span id='chk_name35'></span>\
		</td>\
		<td style='text-align:center'>\
		  <input id='btn_mail_getSubject' type='button' value='件名保存' />\
		  <input id='btn_mail_setSubject' type='button' value='件名読込' />\
		  <input id='btn_mail_preSubject' type='button' value='保存中の件名表示' />\
		</td>\
	  </tr>\
	  <tr>\
		<td style='text-align:center'>本文(@@@name@@@=正式名称に置換)</td>\
	  </tr>\
	  <tr>\
		<td style='text-align:center'>\
		  <input id='btn_mail_getBody' type='button' value='本文保存' />\
		  <input id='btn_mail_setBody' type='button' value='本文読込' />\
		  <input id='btn_mail_preBody' type='button' value='保存中の本文表示' />\
		</td>\
	  </tr>\
		<tr>\
		<td colspan='6' style='text-align:center'>\
		<input id='btn_mail_add_list' type='button' value='宛先追加' />\
		<input id='btn_mail_del_list' type='button' value='宛先削除' /> 　　\
		<input id='btn_Adress_checkALL' type='button' value='CheckALL' /> 　　\
		<input id='btn_send_start' type='button' value='送信開始' /></td>\
		<td style='text-align:center'><input id='btn_cls_sub_body' type='button' value='保存件名・本文削除' /></td>\
	  </tr>\
	</table>";
	SuppContainer.appendChild(table);

	var arrylist = GetSendAddress();
	var ad = new Array();
	for (var i = 0; i < ADDRESSCNT; i++) {
		if (arrylist[i] !=undefined){
			if (arrylist[i] != "") {
			ad = arrylist[i].split(DELIMIT2_11);
			var chk_name = document.getElementById("chk_name" + i);
			chk_name.innerHTML = ad[0] + chk_name.innerHTML;
			if (ad[2] != 0) {
				var chkbox = document.getElementById("chk" + i);
				chkbox.checked = true;
			}
			}else{
				var chkbox = document.getElementById("chk" + i);
				chkbox.disabled = true;
			}
		}else{
			var chkbox = document.getElementById("chk" + i);
			chkbox.disabled = true;
		}
	}

	//件名○○ボタンへのイベント登録
	document.getElementById('btn_mail_getSubject').addEventListener("click",function() { SubjectSave(); }, true);
	document.getElementById('btn_mail_setSubject').addEventListener("click",function() { SubjectLoad(); }, true);
	document.getElementById('btn_mail_preSubject').addEventListener("click",function() { SubjectPreview(); }, true);

	//本文○○ボタンへのイベント登録
	document.getElementById('btn_mail_getBody').addEventListener("click",function() { BodySave(); }, true);
	document.getElementById('btn_mail_setBody').addEventListener("click",function() { BodyLoad(); }, true);
	document.getElementById('btn_mail_preBody').addEventListener("click",function() { BodyPreview(); }, true);
	//保存件名・本文削除
	document.getElementById('btn_cls_sub_body').addEventListener("click",function() { Cls_Sub_Body(); }, true);

	//宛先○○ボタンへのイベント登録
	document.getElementById('btn_mail_add_list').addEventListener("click",function() { openSupportAddressBox(); }, true);
	document.getElementById('btn_mail_del_list').addEventListener("click",function() { DellSupportAddress(); }, true);

	//アドレス全部へのチェック
	document.getElementById('btn_Adress_checkALL').addEventListener("click",function() { Adress_checkALL(); }, true);
	//送信開始ボタンへのイベント登録
	document.getElementById('btn_send_start').addEventListener("click",function() { SendStert(); }, true);
}

function Adress_checkALL(){
	for (var i = 0; i < ADDRESSCNT; i++) {
		var objChk = document.getElementById("chk" + i);
		if (objChk.disabled != true){
			if (objChk.checked != true){
				objChk.checked = true;
			}else{
				objChk.checked = false;
			}
		}
	}
}

//送信開始
function SendStert(){
	//アドレスチェック
	var chkret = AdressCheck();
	if (chkret == false){
		alert("送信先をチェックしてください。\n下のフォームの送信先に入力されても送信されません。");
		return;
	}
	//入力チェック
	var objtextsub = document.getElementsByName("subject");
	var objtextbody = document.getElementsByName("body");
	if (objtextsub[0].value == "" || objtextbody[0].value == "") {
		alert("件名・本文ともに入力してください。");
		return;
	}
	var ret = confirm("件名＆本文を保存し、送信を開始します。");
	if (ret == true) {
		//送信内容の保存
		SubjectSave();
		BodySave();
		//送信先のチェック保存
		var arrylist = GetSendAddress();
		var arryflg = new Array();
		for (var i = 0; i < ADDRESSCNT; i++) {
			var objChk = document.getElementById("chk" + i);
			arryflg[i] = false;
			if(objChk.checked == true){
				arryflg[i] = true;
			}
		}
		ChkSendAddress(arryflg);
	}
	var ret = SetSendAddress();
	GM_setValue(HOST + PGNAME + "Send_Flg", SENDTFLG_PRE);
	document.forms[0].elements[5].click();
}

//宛先アドレスへフラグのセット
function ChkSendAddress(arryflg) {
	var arrylist = GetSendAddress();
	var arrynewlist ="";
	for (var i=0; i < ADDRESSCNT; i++){
		if (arryflg[i] == false){
			if (arrylist[i] != undefined) {
				if (arrylist[i] != "") {
					arrynewlist += arrylist[i].split(DELIMIT2_11)[0] + DELIMIT2_11;
					arrynewlist += arrylist[i].split(DELIMIT2_11)[1] + DELIMIT2_11;
					arrynewlist += "0" + DELIMIT_11;
				}
			}
		}else{
			if (arrylist[i] != undefined) {
				if (arrylist[i] != "") {
					arrynewlist += arrylist[i].split(DELIMIT2_11)[0] + DELIMIT2_11;
					arrynewlist += arrylist[i].split(DELIMIT2_11)[1] + DELIMIT2_11;
					arrynewlist += "1" + DELIMIT_11;	//送信フラグのセット
				}
			}
		}
	}
	GM_setValue(HOST + PGNAME + "addresslist", arrynewlist);
}
//送信先がチェックされているかどうか
function AdressCheck() {
	for (var i = 0; i < ADDRESSCNT; i++) {
		var objChk = document.getElementById("chk" + i);
		if(objChk.checked == true){
			return true;
		}
	}
	return false;
}
//送信アドレスのセット 返値 true=送信可能 false=送信リスト終了
function SetSendAddress(){
	var arrylist = GetSendAddress();
	for (var i = 0; i < ADDRESSCNT; i++){
	GM_log("Main() arrylist[i]=" + arrylist[i]);
		if (arrylist[i] != undefined) {
			if (arrylist[i] != "") {
				if (arrylist[i].split(DELIMIT2_11)[2] == 1){
					var objtextTo = document.getElementsByName("to");
					objtextTo[0].value = arrylist[i].split(DELIMIT2_11)[0];
					var objtextBody = document.getElementsByName("body");
					objtextBody[0].value = objtextBody[0].value.replace("@@@name@@@", arrylist[i].split(DELIMIT2_11)[1]);
					return true;
				}
			}
		}
	}
	return false;
}

//宛先追加フォームHTML追加
function addSupport_AddressHtml() {
	var arrylist = GetSendAddress();

	if (arrylist[0] != undefined){
		if (arrylist.length == ADDRESSCNT+1){
			alert("これ以上追加できません。");
			return;
		}
	}
	var popupLeft = GM_getValue(HOST + "popup_SuppAdleft", 150);
	var popupTop = GM_getValue(HOST + "popup_SuppAdtop", 150);
	if (popupLeft < 0) popupLeft = 0;
	if (popupTop < 0) popupTop = 0;

	//表示コンテナ作成
	var SuppContainer = document.createElement("div");
	SuppContainer.id = "SuppAddresContainer";
	SuppContainer.style.position = "absolute";
	SuppContainer.style.backgroundColor = "darkgray";
	SuppContainer.style.border = "outset 2px darkgray";
	SuppContainer.style.left = popupLeft + "px";
	SuppContainer.style.top = popupTop + "px";
	SuppContainer.style.fontSize = "10px";
	SuppContainer.style.padding = "3px";
	SuppContainer.style.zIndex = 253;
	document.body.appendChild(SuppContainer);


	//入力項目の作成
	var table = document.createElement("div");
	table.innerHTML = "\
	<table border='1' cellspacing='1' cellpadding='10'>\
	  <tr>\
		<td>\
		  宛先の追加 ※@は<font color='red'>半角</font>でお願いします。※<br />\
		  ※宛先名@@@正式名称(nottisan@@@呉越同舟 支部担当 nottisan様)<br />\
		</td>\
	  </tr>\
	  <tr>\
		<td>\
		  <input id='inAddress' type='text' value='' size='65' /><br />\
		</td>\
	  </tr>\
	  <tr>\
		<td style='text-align:center'>\
		  <input id='btn_add_ad' type='button' value='宛先保存' />\
		  <input id='btn_add_ad_close' type='button' value='閉じる' />\
		</td>\
	  </tr>\
	</table>";
	SuppContainer.appendChild(table);

	//ボタンへのイベント登録
	document.getElementById('btn_add_ad').addEventListener("click",function() { SaveAddress(); }, true);
	document.getElementById('btn_add_ad_close').addEventListener("click",function() { closeSupportAddressBox(); }, true);

}
//宛先の削除＆保存、基本フォームのリフレッシュ
function DellSupportAddress() {
	var arrylist = GetSendAddress();
	var arryflg = new Array();
	for (var i = 0; i < ADDRESSCNT; i++) {
		var objChk = document.getElementById("chk" + i);
		arryflg[i] = false;
		if(objChk.checked == true){
			var ret = confirm(arrylist[i].split(DELIMIT2_11)[0] + "を削除します。");
			if (ret == true) arryflg[i] = true;
		}
	}
	DelSendAddress(arryflg);
	openSupportBox();
}
//宛先アドレスの削除
function DelSendAddress(arryflg) {
	var arrylist = GetSendAddress();
	var arrynewlist =""
	for (var i=0; i < ADDRESSCNT; i++){
		if (arryflg[i] == false){
			if (arrylist[i] != undefined) {
				if (arrylist[i] != "") {
					arrynewlist += arrylist[i] + DELIMIT_11;
				}
			}
		}
	}
	GM_setValue(HOST + PGNAME + "addresslist", arrynewlist);
}

//宛先の保存後、基本フォームのリフレッシュ
function SaveAddress() {
	var inAddress = document.getElementById('inAddress').value;
	if (inAddress.split("@@@").length < 1){
		alert("書式通りに入力してください。");
		return;
	}
	if (inAddress.length == 0){
		alert("宛先を入力してください。");
		return;
	}
	inAddress = inAddress.replace("@@@",DELIMIT2_11) + DELIMIT2_11 + "0";
	var addreslist = GM_getValue(HOST + PGNAME + "addresslist", "");
	addreslist += inAddress + DELIMIT_11;
	GM_setValue(HOST + PGNAME + "addresslist", addreslist);
	openSupportBox();
	openSupportAddressBox();
}
//件名保存
function SubjectSave() {
	var objtextsub = document.getElementsByName("subject");
	var textsub = objtextsub[0].value;
	GM_setValue(HOST + PGNAME + "SendSubject", textsub);
}
//件名読込み
function SubjectLoad() {
	var textsub = GM_getValue(HOST + PGNAME + "SendSubject", "");
	var objtextsub = document.getElementsByName("subject");
	objtextsub[0].value = textsub;
}
//件名プレビュー
function SubjectPreview() {
	var textsub = GM_getValue(HOST + PGNAME + "SendSubject", "");
	alert(textsub);
}


//本文保存
function BodySave() {
	var objtextbody = document.getElementsByName("body");
	var textbody = objtextbody[0].value;
	GM_setValue(HOST + PGNAME + "SendBody", textbody);
}
//本文読込み
function BodyLoad() {
	var textbody = GM_getValue(HOST + PGNAME + "SendBody", "");
	var objtextbody = document.getElementsByName("body");
	objtextbody[0].value = textbody;
}
//本文プレビュー
function BodyPreview() {
	var textbody = GM_getValue(HOST + PGNAME + "SendBody", "");
	alert(textbody);
}

//件名・本文保存の削除
function Cls_Sub_Body() {
	GM_setValue(HOST + PGNAME + "SendSubject", "");
	GM_setValue(HOST + PGNAME + "SendBody", "");
}

//アドレスの取得(名前)
function GetSendAddress(){
	var addreslist = GM_getValue(HOST + PGNAME + "addresslist", "");
	if (addreslist.length < 1 ) return "";
	var ArryList = new Array();
	ArryList = addreslist.split(DELIMIT_11);
	return 	ArryList;
}

//デリミタ区切り文字列生成
function genDelimitString_11(dataArray, delimiter) {
	var ret = "";
	for (var i=0; i < dataArray.length; i++) {
		if (dataArray[i] != undefined) ret += dataArray[i];
		if (i < dataArray.length-1) ret += delimiter;
	}
	return ret;
}
//デリミタ区切りアドレス文字列生成（宛先：dataArray,正式名称：dataArray2,チェックフラグ：dataArray3, delimiter
function genDelimitString_Adoress(dataArray,dataArray2,dataArray3, delimiter) {
	var ret = "";
	for (var i=0; i < dataArray.length; i++) {
		if (dataArray[i] != undefined) ret += dataArray[i];
		if (i < dataArray.length-1) ret += delimiter;
	}
	return ret;
}

function setHiddenValue(a){
if(a.name){hid=document.createElement("input");
hid.type="hidden";
hid.name=a.name;
hid.value=a.value;
a.form.appendChild(hid);
}}
//faraway 11.書簡送信アシスタントのソース(bro3_Send_Mail_Supporter.user.js)終了

//---------------------------------------
// 書簡同胞リンク
//---------------------------------------
function disp_letterbroadcast() {

if (location.pathname != "/message/new.php" ) return;
	var sendTd = xpath('//*[@id="gray02Wrapper"]//table[@class="commonTables"]//tr/td', document);

	var ar = GM_getValue(location.hostname + "CCALLY");
	var ALLY = new Array();

	if(ar == undefined){
		for(var i=0;i<num_12;i++){
			ALLY[i] = "";
		}
	}else{
		ALLY = ar.split("#$%")
	}

	var ccLnk = new Array();
	var bar = document.createElement("ul");
	bar.id = "statMenu";

	for(var i=0;i<num_12;i++){

		ccLnk[i] = document.createElement("li");
		ccLnk[i].innerHTML = ALLY[i];
		(function(){
			var n = i;
			ccLnk[i].addEventListener("click", function(){ccSet_12(n);}, true);
		})();
		bar.appendChild(ccLnk[i]);
	}

	var opt = document.createElement("li");
	opt.className = "last";
	opt.innerHTML = "設定画面";
	opt.addEventListener("click", optMenu, true);
	bar.appendChild(opt);

	sendTd.snapshotItem(0).appendChild(bar);

}

function xpath(query,targetDoc) {return document.evaluate(query, targetDoc, null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);}

function ccSet_12(i){//faraway110606 ccSet()->ccSet_12() 14.トレード検索条件記憶と重複していた為、ユニークな名前に変更
	var input = xpath('//*[@id="gray02Wrapper"]//table[@class="commonTables"]//tr/td/input', document);

	var NAME = GM_getValue(location.hostname + "CCNAME").split("#$%");
	input.snapshotItem(0).value = NAME[i];
}

function optMenu(){
	var wrap = xpath('//*[@id="gray02Wrapper"]',document);

	for(var i=wrap.snapshotItem(0).childNodes.length;i>0;i--){
		wrap.snapshotItem(0).removeChild(wrap.snapshotItem(0).lastChild);
	}

	var table = document.createElement("table");
	table.className = "commonTables";

	var tr = document.createElement("tr");
	var th = document.createElement("th");
	th.className = "ttl3";
	th.innerHTML = "表示名";
	th2 = document.createElement("th");
	th2.className = "ttl4";
	th2.innerHTML = "送信対象者";

	tr.appendChild(th);
	tr.appendChild(th2);
	table.appendChild(tr);

	var ALLY = new Array();
	var NAME = new Array();

	var ar = GM_getValue(location.hostname + "CCALLY");
	if(ar == undefined){
		for(var i=0;i<num_12;i++){
			ALLY[i] = "";
		}
	}else{
		ALLY = ar.split("#$%")
	}

	var ar = GM_getValue(location.hostname + "CCNAME");
	if(ar == undefined){
		for(var i=0;i<num_12;i++){
			NAME[i] = "";
		}
	}else{
		NAME = ar.split("#$%")
	}

	for(var i=0;i<num_12;i++){
		var tr = document.createElement("tr");
		var td = document.createElement("th");
		td.innerHTML = "<input type=\"text\" size=\"15\" name=\"ally" + i + "\" id=\"ally" + i + "\" style=\"border:1px solid;\" value=\"" + ALLY[i] + "\" />";
		td.className = "ttl";
		var td2 = document.createElement("th");
		td2.className = "ttl";
		td2.innerHTML = "<input type=\"text\" size=\"40\" name=\"names" + i + "\" id=\"names" + i + "\" style=\"border:1px solid;\" value=\"" + NAME[i] + "\" />";

		tr.appendChild(td);
		tr.appendChild(td2);
		table.appendChild(tr);
	}

	var tr = document.createElement("tr");
	var td = document.createElement("td");
	td.colSpan = 2;
	td.align = "center";

	var btn = document.createElement("input");
	btn.type = "button";
	btn.value = "保存";
	btn.addEventListener("click", saveData, true);

	var wrlink = document.createElement("span");
	wrlink.innerHTML = " | ";

	var link = document.createElement("a");
	link.href = "javascript:void(0)";
	link.innerHTML = "戻る";
	link.addEventListener("click",
		function(){
			location.reload();
		},
	true);

	wrlink.appendChild(link);

	td.appendChild(btn);
	td.appendChild(wrlink);
	tr.appendChild(td);
	table.appendChild(tr);

	wrap.snapshotItem(0).appendChild(table);
}

function saveData(){
	var scrALLY = "";	// save用変数
	var scrNAME = "";

	var table = xpath('//*[@id="gray02Wrapper"]/table[@class="commonTables"]',document);

	var n = 0;
	var len = table.snapshotItem(0).rows.length;
	for(var i=1;i<len-1;i++){
		var ally  = xpath('//input[@id="ally' + n + '"]',document);
		var names = xpath('//input[@id="names' + n + '"]',document);
		scrALLY += ally.snapshotItem(0).value;
		scrALLY += "#$%";
		scrNAME += names.snapshotItem(0).value;
		scrNAME += "#$%";
		n++;
	}

	GM_setValue(location.hostname + "CCALLY", scrALLY);
	GM_setValue(location.hostname + "CCNAME", scrNAME);

	alert('保存OK。多分ね。');
}


//faraway 12.書簡同報リンクのソース(b3ccmail.user.js)終了

//--------------------------------------
// 書簡保存＆検索ツール
//--------------------------------------
function disp_letterpreservation() {

////////////////////////////////////////////////////////
// ページ読み込み完了を待たない処理
////////////////////////////////////////////////////////
// 対象ページでない場合処理中断
if (!(location.pathname == location_inboxURL || location.pathname == location_outboxURL)) { return; }
// 各種チェック
if (!pre_check()) {
	// 確認用
	return;
}
function pre_check() {
	if (!worldKey) { console.log("ワールドキー取得エラー"); return false; }

	var time_checker = new Date().toString();
	GM_setValue(worldKey + "time_checker", time_checker.toSource());
	var res_time_checker = eval(GM_getValue(worldKey + "time_checker", ""));
	if (time_checker != res_time_checker) {
		console.log("GM変数の利用エラー");
		console.log("　：" + time_checker);
		console.log("　：" + res_time_checker);
		return false;
	}

	if (!$_13) { console.log("jquery取得エラー"); return false; }
	return true;
}
// GM変数ロード
loadOpValues();
loadCmValue();

// ページ読み込み完了後に本処理開始
window.addEventListener("load", function() { pre_main(); }, false);

////////////////////////////////////////////////////////
// ページ読み込み完了後に起動する処理
// 　1.ボタン付加
// 　2.autoCashオプションが有効な場合、書簡キャッシュ処理を稼働。
////////////////////////////////////////////////////////
function pre_main() {
	addBtnMain();
	if (opValues["autoCash"]) {
		syokanCashMain();
	}
}

////////////////////////////////////////////////////////
// ボタン付加
////////////////////////////////////////////////////////
function addBtnMain() {
	var targetNode = $xp1('//ul[@id="statMenu"]', d_13);

	var cashBtn = d_13.createElement("input");
		cashBtn.type = "button";
		cashBtn.id = "cashBtn";
		cashBtn.value = "【書簡保存】";
		cashBtn.addEventListener("click", function() {
			cashBtn.disabled = true;
			if (confirm("現ページに表示されている書簡情報を保存します。")) {
				syokanCashMain();
			} else {
				cashBtn.disabled = false;
			}
		}, false);
	// 自動キャッシュ有効時はボタン非活性
	if (opValues["autoCash"]) { cashBtn.disabled = true; }
	targetNode.appendChild(cashBtn);

	var introBtn = d_13.createElement("input");
		introBtn.type = "button";
		introBtn.id = "introBtn";
		introBtn.value = "【書簡検索】";
		introBtn.addEventListener("click", function() {
			cashBtn.disabled = true;
			introBtn.disabled = true;
			addOpBtn.disabled = true;
			searchModeMain();
		}, false);
	targetNode.appendChild(introBtn);

	var addOpBtn = d_13.createElement("input");
		addOpBtn.type = "button";
		addOpBtn.id = "addOpBtn";
		addOpBtn.value = "【設定】";
		addOpBtn.addEventListener("click", function() {
			cashBtn.disabled = true;
			introBtn.disabled = true;
			addOpBtn.disabled = true;
			addOpMain();
		}, false);
	targetNode.appendChild(addOpBtn);
}

////////////////////////////////////////////////////////
// 未キャッシュの書簡情報をキャッシュ
// 自動キャッシュの場合は確認メッセージ非活性
////////////////////////////////////////////////////////
function syokanCashMain() {
	var linkNodes = $xp('//table[@class="commonTables"]/tbody/tr/td[2]/a', d_13);

	// 未キャッシュIDのURLを格納
	for (var i = 0, len = linkNodes.snapshotLength; i < len; i++ ) {
		var href = linkNodes.snapshotItem(i).href;
		if (href == null) { continue; }
		var syokanId = href.match("id=[0-9]+")[0].split("=")[1];
		if (syokanId == null) { continue; }
		// 返信済みマークがある場合、保存件名をチェック
		var henshinImg = $xp1('descendant::img[@alt="返信済"]',linkNodes.snapshotItem(i).parentNode);
		if (!!henshinImg) {
			if (!checkKenmeiCash(syokanId)) {
				hrefArray.push([syokanId, href]);
				continue;
			}
		}
		if (checkIdCash(syokanId)) { continue; }
		hrefArray.push([syokanId, href]);
	}
	if (hrefArray.length <= 0) {
		if (!opValues["autoCash"]) { alert("新しい保存対象はありません。"); }
		return;
	}

	// 実行中表示レイヤー
	var layer = d_13.createElement("div");
		layer.id = "cash_layer";
		layer.style.backgroundColor = "#202020";
		layer.style.position = "fixed";
		layer.style.zIndex = 50000;
		layer.style.width = "100%";
		layer.style.height = "100%";
		layer.style.opacity = 0.9;
	var explain = d_13.createElement("div");
		explain.id = "cash_explain";
		explain.style.backgroundColor = "white";
		explain.style.marginTop  = "100px";
		explain.style.padding  = "20px";
		explain.style.width = "100%";
		explain.innerHTML = "<b>書簡保存処理実行中</b>　　" + 1 + "/" + hrefArray.length;
		layer.appendChild(explain);
	var targetNode = $xp1('//body', d_13);
		targetNode.insertBefore(layer, targetNode.firstChild);
	loadPage(0);
}
// 該当IDがキャッシュ済みならtrueを返す
function checkIdCash(syokanId) {
	for (var i in syokanIdArray) {
		if (syokanIdArray.hasOwnProperty(i) && syokanIdArray[i] == syokanId){ return true; }
	}
	return false;
}
// 該当IDの保存件名にimgタグが含まれていればtrueを返す
function checkKenmeiCash(syokanId) {
	var fillterEL = d_13.createElement('div');
		fillterEL.innerHTML = kenmeiArray[syokanId];
	var henshinImg = $xp1('descendant::img[@alt="返信済"]', fillterEL);
	if (!!henshinImg) { return true; }
	return false;
}
// loadNoにより同期処理させる
function loadPage(loadNo, res) {
	var opt = {
		method: 'get',
		url: hrefArray[loadNo][1],
		onload: function(res) {
			addSyokanCash(loadNo, res);
		}
	}
	GM_xmlhttpRequest(opt);
}
function addSyokanCash(loadNo, res) {
	var syokanId = hrefArray[loadNo][0];
	var fillterEL = d_13.createElement('div');
		fillterEL.innerHTML = res.responseText;

	var syokanTable = $xp1('descendant::table[@class="commonTables"]', fillterEL);
	var soushinsya = $xp1('descendant::td[1]/div', syokanTable).innerHTML;
	var atesaki = $xp1('descendant::td[2]', syokanTable).innerHTML;
	var nichiji = $xp1('descendant::td[3]', syokanTable).innerHTML;
	var kenmei = $xp1('descendant::td[4]', syokanTable).innerHTML;
	var honbun = $xp1('descendant::td[5]', syokanTable).innerHTML;

	// 未登録の書簡IDの場合は追加
	if (!checkIdCash(syokanId)) { syokanIdArray.push(syokanId) }

	soushinsyaArray[syokanId] = soushinsya;
	atesakiArray[syokanId] = atesaki;
	kenmeiArray[syokanId] = kenmei;
	nichijiArray[syokanId] = nichiji;

	saveHonbunValue(syokanId, honbun);

	if (loadNo + 1 >= hrefArray.length) {
		saveCmValue();
		if (!opValues["autoCash"]) { alert("書簡保存が終了しました。"); }
		var layer = $xp1('//div[@id="cash_layer"]', d_13);
			layer.parentNode.removeChild(layer);
		return;
	}
	var layerExplain = $xp1('//div[@id="cash_explain"]', d_13);
		layerExplain.innerHTML = "<b>書簡保存処理実行中</b>　　" + (loadNo + 2) + "/" + hrefArray.length;
	loadPage(loadNo + 1);
}

////////////////////////////////////////////////////////
// 書簡検索＆表示機能
// 共通で使用するCSS定義は最初にセット
////////////////////////////////////////////////////////
function searchModeMain() {
//faraway110601 GM_addStyle()への引数をString()で囲むFirefox4.0対応
	GM_addStyle("\
	table.showTable {\
		border: 2px solid black;\
		border-collapse: collapse;\
		margin: 5px;\
	}\
	.showTable th {\
		border: 2px solid black;\
		border-collapse: collapse;\
		color: white;\
		background-color: gray;\
		padding : 2px;\
	}\
	.showTable td {\
		border: 2px solid black;\
		border-collapse: collapse;\
		color: black;\
		background-color: white;\
		padding : 2px;\
	}\
	");

	var targetNode =  $xp1('//div[@id="gray02Wrapper"]', d_13);
		targetNode.innerHTML = null;
	var baseEL = d_13.createElement("div");
		baseEL.id = "bro_view_base";
		targetNode.appendChild(baseEL);

	addSearchHTML();
	if (opValues["uneiLimit"]) {
		addShowTable(uneiSyokanLimit(syokanIdArray));
	} else {
		addShowTable(syokanIdArray);
	}
}

// 検索句付加
function addSearchHTML() {
	var baseEL =  $xp1('//div[@id="bro_view_base"]', d_13);

		baseEL.appendChild(d_13.createTextNode("【保存書簡の検索】"));
		baseEL.appendChild(d_13.createElement("br"));

		var searchBaseEL = d_13.createElement("div");
			searchBaseEL.id = "search_base";
			searchBaseEL.appendChild(d_13.createTextNode("検索条件：　"));
		var inputTxtEL = d_13.createElement("input");
			inputTxtEL.size = 10;
			inputTxtEL.id = "searchTxt";
			searchBaseEL.appendChild(inputTxtEL);
			searchBaseEL.appendChild(d_13.createTextNode("　を　"));
		var selectEL = d_13.createElement("select");
			selectEL.id = "searchSelect";
		var optionEL = d_13.createElement("option");
			optionEL.value = "soushinsya_atesaki";
			optionEL.text = "送信者または宛先に含む";
			selectEL.appendChild(optionEL.cloneNode(true));
			optionEL.value = "soushinsya";
			optionEL.text = "送信者に含む";
			selectEL.appendChild(optionEL.cloneNode(true));
			optionEL.value = "atesaki";
			optionEL.text = "宛先に含む";
			selectEL.appendChild(optionEL.cloneNode(true));
			searchBaseEL.appendChild(selectEL);
			searchBaseEL.appendChild(d_13.createTextNode("　書簡を　"));

		var btnEL = d_13.createElement("input");
			btnEL.type = "button"
			btnEL.value = "検索する";
			btnEL.addEventListener("click", searchExe, false);
			searchBaseEL.appendChild(btnEL);
			searchBaseEL.appendChild(d_13.createTextNode("　/　"));

		var allBtnEL = d_13.createElement("input");
			allBtnEL.type = "button"
			allBtnEL.value = "全件表示";
			allBtnEL.addEventListener("click", function() {
				inputTxtEL.value = null;
				selectEL.selectedIndex = 0;
				searchExe()
			}, false);
			searchBaseEL.appendChild(allBtnEL);

		baseEL.appendChild(searchBaseEL);
		baseEL.appendChild(d_13.createElement("br"));
}

// 検索句の情報を元に検索実行
function searchExe() {
	var searchSelectNode = $xp1('//select[@id="searchSelect"]', d_13);
	var searchMode = searchSelectNode.options[searchSelectNode.selectedIndex].value;
	var searchTxt = $xp1('//input[@id="searchTxt"]', d_13).value;

	var show_syokanIdArray = [];
	if (searchMode == "soushinsya_atesaki") {
		show_syokanIdArray = searchSoushinsya(syokanIdArray, searchTxt);
		var addIdArray = searchAtesaki(syokanIdArray, searchTxt);
		for (var i = 0, len = addIdArray.length; i < len; i++) {
			if (show_syokanIdArray.indexOf(addIdArray[i]) == -1) {
				show_syokanIdArray.push(addIdArray[i]);
			}
		}
	} else if (searchMode == "soushinsya") {
		show_syokanIdArray = searchSoushinsya(syokanIdArray, searchTxt);
	} else if (searchMode == "atesaki") {
		show_syokanIdArray = searchAtesaki(syokanIdArray, searchTxt);
	} else {
		return;
	}

	if (opValues["uneiLimit"]) {
		addShowTable(uneiSyokanLimit(show_syokanIdArray));
	} else {
		addShowTable(show_syokanIdArray);
	}
}
// 送信者名で検索し、条件に合致するIDを返す
function searchSoushinsya(search_syokanIdArray, searchTxt) {
	var resSyokanIdArray = [];
	for (var i = 0, len = search_syokanIdArray.length; i < len; i++) {
		var syokanId = search_syokanIdArray[i];
		if (soushinsyaArray[syokanId].indexOf(searchTxt) != -1) {
			resSyokanIdArray.push(syokanId);
		}
	}
	return resSyokanIdArray;
}
// 宛先名で検索し、条件に合致するIDを返す
function searchAtesaki(search_syokanIdArray, searchTxt) {
	var resSyokanIdArray = [];
	for (var i = 0, len = search_syokanIdArray.length; i < len; i++) {
		var syokanId = search_syokanIdArray[i];
		if (atesakiArray[syokanId].indexOf(searchTxt) != -1) {
			resSyokanIdArray.push(syokanId);
		}
	}
	return resSyokanIdArray;
}
// 運営名で検索し、条件に合致しないIDを返す
function uneiSyokanLimit(search_syokanIdArray){
	var resSyokanIdArray = [];
	for (var i = 0, len = search_syokanIdArray.length; i < len; i++) {
		var syokanId = search_syokanIdArray[i];
		if (soushinsyaArray[syokanId].indexOf(uneiLimitTxt) == -1) {
			resSyokanIdArray.push(syokanId);
		}
	}
	return resSyokanIdArray;
}

// 引数の書簡ID配列、ページ番号を元に検索結果表示
function addShowTable (show_syokanIdArray, page_index) {
	if (page_index == null) { page_index = 0 };
	var pre_tableEL = $xp1('//table[@id="showTable"]', d_13);
	if (pre_tableEL != null) {
		pre_tableEL.parentNode.removeChild(pre_tableEL);
	}
	var pre_pagerEL = $xp1('//div[@id="search_pager"]', d_13);
	if (pre_pagerEL != null) {
		pre_pagerEL.parentNode.removeChild(pre_pagerEL);
	}
	var tableEL = d_13.createElement("table");
		tableEL.className = "showTable";
		tableEL.id = "showTable";
	var trEL = d_13.createElement("tr");
	var thEL = d_13.createElement("th");
	var tdEL = d_13.createElement("td");
	var pargerEL = d_13.createElement("div");
		pargerEL.id = "search_pager";

		thEL.innerHTML = "No";
		thEL.style.width = "20px";
		trEL.appendChild(thEL.cloneNode(true));
		thEL.innerHTML = "送信者";
		thEL.style.width = "80px";
		trEL.appendChild(thEL.cloneNode(true));
		thEL.innerHTML = "宛先";
		thEL.style.width = "120px";
		trEL.appendChild(thEL.cloneNode(true));
		thEL.innerHTML = "件名";
		thEL.style.width = "200px";
		trEL.appendChild(thEL.cloneNode(true));
		thEL.innerHTML = "日時";
		thEL.style.width = "80px";
		trEL.appendChild(thEL.cloneNode(true));
		thEL.innerHTML = "本文表示";
		thEL.style.width = "200px";
		trEL.appendChild(thEL.cloneNode(true));
	tableEL.appendChild(trEL.cloneNode(true));

	var len = show_syokanIdArray.length;
	if (len <= 0 ) {
		var data_trEL = d_13.createElement("tr");
		var data_thEL = d_13.createElement("th");
		var data_tdEL = d_13.createElement("td");
			data_tdEL.colSpan = 5;
			data_tdEL.innerHTML = "※該当書簡は存在しません。";
			data_tdEL.align = "center";
			data_trEL.appendChild(data_thEL);
			data_trEL.appendChild(data_tdEL);
		tableEL.appendChild(data_trEL);
	} else {
		show_syokanIdArray.sort ( function sort(a, b) { return (b - a); } )
		var i_start = page_index * pageUnit;
		var i_end = i_start + pageUnit;
		if (i_end >= len) { i_end = len }

		function returnShowSyokan(syokanId) {
			return function() { showSyokan(syokanId); }
		}
		function returnSeachExe(searchTxt) {
			return function() {
				var searchSelectNode = $xp1('//select[@id="searchSelect"]', d_13);
					searchSelectNode.selectedIndex = 0;
				var searchTxtNode = $xp1('//input[@id="searchTxt"]', d_13);
					searchTxtNode.value = searchTxt;
				searchExe();
			}
		}

		for (var i = i_start; i < i_end; i++ ) {
			var syokanId = show_syokanIdArray[i];
			var soushinsya = soushinsyaArray[syokanId];
			var kenmei = kenmeiArray[syokanId];
			var atesaki = atesakiArray[syokanId];
			var nichiji = nichijiArray[syokanId];
			var honbun = loadSyokanValue(syokanId);
				honbun = honbun.replace(/<br>/g, "");

			var data_trEL = d_13.createElement("tr");
			var data_thEL = d_13.createElement("th");
			var data_tdEL = d_13.createElement("td");
			var data_tdBtnEL1 = d_13.createElement("td");
				data_tdBtnEL1.style.backgroundColor = "#ffffdf";
			var data_tdBtnEL2 = d_13.createElement("td");
				data_tdBtnEL2.style.backgroundColor = "#ffdfff";
			var data_tdBtnEL3 = d_13.createElement("td");
				data_tdBtnEL3.style.backgroundColor = "#dfffff";

				data_thEL.innerHTML = i + 1;
				data_trEL.appendChild(data_thEL.cloneNode(true));
				data_tdBtnEL1.innerHTML = soushinsya;
				data_tdBtnEL1.addEventListener("click", returnSeachExe(soushinsya), false);
				data_trEL.appendChild(data_tdBtnEL1);
				data_tdBtnEL2.innerHTML = atesaki;
				data_tdBtnEL2.addEventListener("click", returnSeachExe(atesaki), false);
				data_trEL.appendChild(data_tdBtnEL2);
				data_tdEL.innerHTML = kenmei;
				data_trEL.appendChild(data_tdEL.cloneNode(true));
				data_tdEL.innerHTML = nichiji;
				data_trEL.appendChild(data_tdEL.cloneNode(true));
				data_tdBtnEL3.appendChild(d_13.createTextNode(c_subString(honbun, 30)));
				data_tdBtnEL3.addEventListener("click", returnShowSyokan(syokanId), false);
				data_trEL.appendChild(data_tdBtnEL3);
			tableEL.appendChild(data_trEL);
		}

		if (len > pageUnit) {
			var preBtnEL = d_13.createElement("input");
				preBtnEL.type = "button";
				preBtnEL.id = "prePager";
				preBtnEL.value = "前のページへ";
				preBtnEL.addEventListener("click", function() {
					addShowTable(show_syokanIdArray, page_index - 1)
					}, false);
			var nextBtnEL = d_13.createElement("input");
				nextBtnEL.type = "button";
				nextBtnEL.id = "nextPager";
				nextBtnEL.value = "次のページへ";
				nextBtnEL.addEventListener("click", function() {
					addShowTable(show_syokanIdArray, page_index + 1)
				}, false);

			if (i_start <= 0 ) { preBtnEL.disabled = true; }
			if (i_end >= len ) { nextBtnEL.disabled = true; }
			pargerEL.appendChild(preBtnEL);
			pargerEL.appendChild(nextBtnEL);
		}
		pargerEL.appendChild(d_13.createTextNode("　該当件数" + len + "件"));
	}

	var baseEL = $xp1('//div[@id="bro_view_base"]', d_13);
		baseEL.appendChild(pargerEL);
		baseEL.appendChild(tableEL);
	$_13("#showTable").hide();
	$_13("#showTable").slideDown();
}
function c_subString(txt, num) {
	if (txt.length > num) { txt = txt.substring(0, num - 3) + "..."; }
	return txt;
}

// 書簡文表示
function showSyokan(syokanId) {

	var baseLayer = d_13.createElement("div");
		baseLayer.id = "baseLayer";
		baseLayer.style.position = "absolute";
		baseLayer.style.zIndex = 50000;
		baseLayer.style.width = "100%";
		baseLayer.style.height = "100%";

	var mask = d_13.createElement("div");
		mask.style.backgroundColor = "#202020";
		mask.style.position = "fixed";
		mask.style.width = "100%";
		mask.style.height = "100%";
		mask.style.opacity = 0.90;
		mask.addEventListener("click", function() {
			baseLayer.parentNode.removeChild(baseLayer);
		}, false);
		baseLayer.appendChild(mask);

	var explain = d_13.createElement("div");
		explain.id = "gray02Wrapper";
		explain.style.position = "absolute";
		explain.style.marginTop  = "200px";
		explain.style.marginLeft  = "50px";
		explain.style.padding  = "25px";
		explain.style.width = "600px";

	baseLayer.appendChild(explain);
	var targetNode = $xp1('//body', d_13);
		targetNode.insertBefore(baseLayer, targetNode.firstChild);

	var tableEL = d_13.createElement("table");
		tableEL.style.width = "100%";
		tableEL.className = "showTable";
	var trEL = d_13.createElement("tr");
	var thEL = d_13.createElement("th");
	var tdEL = d_13.createElement("td");
		tdEL.style.padding = "5px";
		thEL.innerHTML = "送信者";
		trEL.appendChild(thEL.cloneNode(true));
		thEL.innerHTML = "宛先";
		trEL.appendChild(thEL.cloneNode(true));
		thEL.innerHTML = "件名";
		trEL.appendChild(thEL.cloneNode(true));
		thEL.innerHTML = "日時";
		trEL.appendChild(thEL.cloneNode(true));
	tableEL.appendChild(trEL.cloneNode(true));

	var soushinsya = soushinsyaArray[syokanId];
	var kenmei = kenmeiArray[syokanId];
	var atesaki = atesakiArray[syokanId];
	var nichiji = nichijiArray[syokanId];
	var honbun = loadSyokanValue(syokanId);

		trEL.innerHTML = null;
		tdEL.innerHTML = soushinsya;
		trEL.appendChild(tdEL.cloneNode(true));
		tdEL.innerHTML = atesaki;
		trEL.appendChild(tdEL.cloneNode(true));
		tdEL.innerHTML = kenmei;
		trEL.appendChild(tdEL.cloneNode(true));
		tdEL.innerHTML = nichiji;
		trEL.appendChild(tdEL.cloneNode(true));
	tableEL.appendChild(trEL.cloneNode(true));

		trEL.innerHTML = null;
		tdEL.colSpan = 4;
		tdEL.innerHTML = honbun;
		tdEL.appendChild(d_13.createElement("br"));
		tdEL.appendChild(d_13.createElement("br"));
	var aEL = d_13.createElement("a");
		aEL.innerHTML = "返信する";
		aEL.href = "new.php?id=" + syokanId;
		tdEL.appendChild(aEL);
		trEL.appendChild(tdEL);
	tableEL.appendChild(trEL);
	explain.appendChild(tableEL);

	$_13("#gray02Wrapper").hide();
	$_13("#gray02Wrapper").slideDown();
}

////////////////////////////////////////////////////////
//オプション画面
////////////////////////////////////////////////////////
function addOpMain() {
	var targetNode = $xp1('//div[@id="gray02Wrapper"]', d_13);
		targetNode.innerHTML = null;

	var baseEL = d_13.createElement("div");
		baseEL.id = "bro_op_base";

		baseEL.appendChild(d_13.createTextNode("【書簡保存・検索　設定】"));
		baseEL.appendChild(d_13.createElement("br"));
		baseEL.appendChild(d_13.createElement("br"));
		baseEL.appendChild(d_13.createTextNode("　１．書簡画面表示時、未保存書簡の自動保存を"));

	var autoCashBtn = d_13.createElement("input");
		autoCashBtn.type = "button";
		autoCashBtn.id = "autoCashBtn";
		if (opValues["autoCash"]) {
			autoCashBtn.value = "【無効化する】";
			autoCashBtn.addEventListener("click", function() {
				opValues["autoCash"] = false;
				saveOpValues();
				addOpMain();
			}, false);
		} else {
			autoCashBtn.value = "【有効化する】";
			autoCashBtn.addEventListener("click", function() {
				opValues["autoCash"] = true;
				saveOpValues();
				addOpMain();
			}, false);
		}
		baseEL.appendChild(autoCashBtn);
		baseEL.appendChild(d_13.createElement("br"));
		baseEL.appendChild(d_13.createElement("br"));
		baseEL.appendChild(d_13.createTextNode("　２．運営からの書簡を検索結果に"));

	var UneiLimitBtn = d_13.createElement("input");
		UneiLimitBtn.type = "button";
		UneiLimitBtn.id = "UneiLimitBtn";
		if (opValues["uneiLimit"]) {
			UneiLimitBtn.value = "【表示する】";
			UneiLimitBtn.addEventListener("click", function() {
				opValues["uneiLimit"] = false;
				saveOpValues();
				addOpMain();
			}, false);
		} else {
			UneiLimitBtn.value = "【表示しない】";
			UneiLimitBtn.addEventListener("click", function() {
				opValues["uneiLimit"] = true;
				saveOpValues();
				addOpMain();
			}, false);
		}
		baseEL.appendChild(UneiLimitBtn);
		baseEL.appendChild(d_13.createElement("br"));
		baseEL.appendChild(d_13.createElement("br"));
		baseEL.appendChild(d_13.createTextNode("　３．指定ワールドの保存書簡をだらあああと"));

	var outputBtn = d_13.createElement("input");
		outputBtn.type = "button";
		outputBtn.id = "outputBtn";
		outputBtn.value = "【出力する】";
		outputBtn.addEventListener("click", function() {
			outputBtn.disabled = true;

			var key = prompt("現ワールド以外の書簡情報を出力したい場合は、\nホスト名を指定してください。\n※現ワールドのホスト名が初期値で表示されています。", worldKey);
			if (!key) { outputBtn.disabled = false; return; }
			key_loadCmValue(key);
			var len = syokanIdArray.length;
			if(len <= 0) { alert("指定ワールドの保存書簡は存在しません。"); outputBtn.disabled = false; return; }

			syokanOutput(key);
		}, false);
		baseEL.appendChild(outputBtn);
		baseEL.appendChild(d_13.createElement("br"));
		baseEL.appendChild(d_13.createElement("br"));
		baseEL.appendChild(d_13.createTextNode("　４．指定ワールドの保存情報を"));

	var resetBtn = d_13.createElement("input");
		resetBtn.type = "button";
		resetBtn.id = "resetBtn";
		resetBtn.value = "【リセットする】";
		resetBtn.addEventListener("click", function() {
			resetBtn.disabled = true;

			var key = prompt("現ワールド以外の書簡情報をリセットしたい場合は、\nホスト名を指定してください。\n※現ワールドのホスト名が初期値で表示されています。", worldKey);
			if (!key) { resetBtn.disabled = false; return; }
			key_loadCmValue(key);
			var len = syokanIdArray.length;
			if(len <= 0) { alert("指定ワールドの保存書簡は存在しません。"); resetBtn.disabled = false; return; }

			if (confirm("【再確認】ホスト名：" + key + "ワールドの書簡情報のすべてをクリアします。\n※また、処理には相当な時間を要します。気長に待てる時の実行を推奨します。")) {
				autoCashBtn.disabled = true;
				UneiLimitBtn.disabled = true;
				outputBtn.disabled = true;
				resetCashMain(key);
			} else {
				resetBtn.disabled = false;
			}
		}, false);
		baseEL.appendChild(resetBtn);
	targetNode.appendChild(baseEL);

	baseEL.appendChild(d_13.createElement("br"));
	baseEL.appendChild(d_13.createElement("br"));
	baseEL.appendChild(d_13.createTextNode("　５．本スクリプトの最新版などは→をご確認ください　・ｗ・　"));
	var aEL = d_13.createElement("a");
		aEL.innerHTML = "<font color='blue'><u>Project.殺伐</u></font>";
		aEL.href = "http://aoyamayuuto.blog92.fc2.com/";
		aEL.target = "_blank";
	baseEL.appendChild(aEL);

	$_13("#bro_op_base").hide();
	$_13("#bro_op_base").slideDown();
}

////////////////////////////////////////////////////////
//書簡出力
////////////////////////////////////////////////////////
function syokanOutput(key, page_index) {
	if (page_index == null) { page_index = 0 };
	var pre_baseEL = $xp1('//div[@id="bro_output_base"]', d_13);
	if (pre_baseEL != null) {
		pre_baseEL.parentNode.removeChild(pre_baseEL);
	}

	var targetNode = $xp1('//div[@id="gray02Wrapper"]', d_13);
		targetNode.innerHTML = null;
	var baseEL = d_13.createElement("div");
		baseEL.id = "bro_output_base";
		targetNode.appendChild(baseEL);

	var textAreaEL = d_13.createElement("textarea");
		textAreaEL.cols = 95;
		textAreaEL.rows = 25;

	var len = syokanIdArray.length;
	pageUnit = 100;
	var i_start = page_index * pageUnit;
	var i_end = i_start + pageUnit;
	if (i_end >= len) { i_end = len }

	for (var i = i_start; i < i_end; i++ ) {
		var syokanId = syokanIdArray[i];
		var nichiji = nichijiArray[syokanId];
		var soushinsya = soushinsyaArray[syokanId];
		var atesaki = atesakiArray[syokanId];
		var kenmei = kenmeiArray[syokanId];
		var honbun = key_loadSyokanValue(key, syokanId);
			honbun = honbun.replace(/\r\n/g, "");
			honbun = honbun.replace(/(\n|\r)/g, "");

		textAreaEL.defaultValue = textAreaEL.defaultValue +
									syokanId + "\t" +
									nichiji + "\t" +
									soushinsya + "\t" +
									atesaki + "\t" +
									kenmei + "\t" +
									honbun + "\n";
	}

	if (len > pageUnit) {
		var preBtnEL = d_13.createElement("input");
			preBtnEL.type = "button";
			preBtnEL.id = "prePager";
			preBtnEL.value = "前のページへ";
			preBtnEL.addEventListener("click", function() {
				syokanOutput(key, page_index - 1)
				}, false);
		var nextBtnEL = d_13.createElement("input");
			nextBtnEL.type = "button";
			nextBtnEL.id = "nextPager";
			nextBtnEL.value = "次のページへ";
			nextBtnEL.addEventListener("click", function() {
				syokanOutput(key, page_index + 1)
			}, false);

		if (i_start <= 0 ) { preBtnEL.disabled = true; }
		if (i_end >= len ) { nextBtnEL.disabled = true; }
		baseEL.appendChild(preBtnEL);
		baseEL.appendChild(nextBtnEL);
	}
	baseEL.appendChild(d_13.createTextNode("　総件数" + len + "件　" + (i_start + 1) + "～" + i_end));

	baseEL.appendChild(textAreaEL);
}

////////////////////////////////////////////////////////
// GM関連の共通関数
// 保持するGM変数は下記３分類
// 　１．オプション設定情報
// 　２．書簡項目ごとに分類したキャッシュ情報
// 　３．書簡本文のキャッシュ情報
////////////////////////////////////////////////////////
function loadOpValues () {
	opValues = eval(GM_getValue(worldKey + "opValues", {}));
	if (opValues["autoCash"] == null) { opValues["autoCash"] = false; }
	if (opValues["uneiLimit"] == null) { opValues["uneiLimit"] = false; }
}
function saveOpValues () {
	GM_setValue(worldKey + "opValues", opValues.toSource());
}
function loadCmValue () {
	syokanIdArray = eval(GM_getValue(worldKey + "syokanIdArray", []));
	soushinsyaArray = eval(GM_getValue(worldKey + "soushinsyaArray", {}));
	atesakiArray = eval(GM_getValue(worldKey + "atesakiArray", {}));
	kenmeiArray = eval(GM_getValue(worldKey + "kenmeiArray", {}));
	nichijiArray = eval(GM_getValue(worldKey + "nichijiArray", {}));
}
function saveCmValue () {
	GM_setValue(worldKey + "syokanIdArray", syokanIdArray.toSource());
	GM_setValue(worldKey + "soushinsyaArray", soushinsyaArray.toSource());
	GM_setValue(worldKey + "atesakiArray", atesakiArray.toSource());
	GM_setValue(worldKey + "kenmeiArray", kenmeiArray.toSource());
	GM_setValue(worldKey + "nichijiArray", nichijiArray.toSource());
}
function loadSyokanValue (syokanId) {
	var honbun = GM_getValue(worldKey + "syokan:" + syokanId, "");
	if (honbun == null) { return "" }
	return honbun;
}
function saveHonbunValue (syokanId, honbun) {
	GM_setValue(worldKey + "syokan:" + syokanId, honbun);
}
// サーバ指定用
function resetCashMain(key) {
	syokanIdArray = eval(GM_getValue(key + "syokanIdArray", []));

	for (var i = 0, len = syokanIdArray.length; i < len; i++) {
		GM_deleteValue(key + "syokan:" + syokanIdArray[i]);
	}
	GM_deleteValue(key + "syokanIdArray");
	GM_deleteValue(key + "soushinsyaArray");
	GM_deleteValue(key + "atesakiArray");
	GM_deleteValue(key + "kenmeiArray");
	GM_deleteValue(key + "nichijiArray");
	GM_deleteValue(key + "opValues");
	GM_deleteValue(key + "time_checker");
	alert("リセット完了しました。");
	location.reload();
}
function key_loadCmValue (key) {
	syokanIdArray = eval(GM_getValue(key + "syokanIdArray", []));
	soushinsyaArray = eval(GM_getValue(key + "soushinsyaArray", {}));
	atesakiArray = eval(GM_getValue(key + "atesakiArray", {}));
	kenmeiArray = eval(GM_getValue(key + "kenmeiArray", {}));
	nichijiArray = eval(GM_getValue(key + "nichijiArray", {}));
}
function key_loadSyokanValue (key, syokanId) {
	var honbun = GM_getValue(key + "syokan:" + syokanId, "");
	if (honbun == null) { return "" }
	return honbun;
}
}
//faraway 13.書簡保存＆検索ツールのソース(bro3_syokanbox.user.js)終了

//-----------------------------------
// トレード検索条件記憶
//-----------------------------------
function disp_tradingretrieval() {
	if(location.pathname != "/card/trade.php") return;
	var sendTd = xpath_14('//*[@id="gray02Wrapper"]//div[@class="ui-tabs-panel"]', document);

	var ar = GM_getValue(location.hostname + "TrdMem");
	var Mem = new Array();

	if(ar == undefined){
		for(var i=0;i<num_14;i++){
			Mem[i] = "";
		}
	}else{
		Mem = ar.split("#$%");
	}

	var conLnk = new Array();
	var bar = document.createElement("ul");
	bar.id = "statMenu";

	var opt = document.createElement("li");
	opt.className = "last";
	opt.innerHTML = "<a href='#'>検索条件設定画面</a>";
	opt.addEventListener("click", optMenu_14, true);
	bar.appendChild(opt);

	for(var i=0;i<num_14;i++){
		if(Mem[i] != undefined && Mem[i] != "undefined" && Mem[i] != ""){
			conLnk[i] = document.createElement("li");
			conLnk[i].innerHTML = "<a href='#'>" + Mem[i] + "</a>";
			(function(){
				var n = i;
				conLnk[i].addEventListener("click", function(){ccSet(n);}, true);
			})();
			bar.appendChild(conLnk[i]);
		}
	}


	sendTd.snapshotItem(0).insertBefore(bar, sendTd.snapshotItem(0).childNodes[2] );
}

function xpath_14(query,targetDoc) {return document.evaluate(query, targetDoc, null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);}

// 呼び出し
function ccSet(i){
	var input  = xpath_14('//input[@id="k"]', document);
	var select = xpath_14('//select[@id="t"]', document);

	var conMem = GM_getValue(location.hostname + "TrdCon").split("#$%");
	select.snapshotItem(0).selectedIndex = conMem[i];
	var keyMem = GM_getValue(location.hostname + "TrdKey").split("#$%");
	input.snapshotItem(0).value = keyMem[i];
	document.forms["trade"].submit()
}

// 設定画面
function optMenu_14(){
	var wrap = xpath_14('//*[@id="gray02Wrapper"]',document);

	for(var i=wrap.snapshotItem(0).childNodes.length;i>0;i--){
		wrap.snapshotItem(0).removeChild(wrap.snapshotItem(0).lastChild);
	}

	var table = document.createElement("table");
	table.className = "commonTables";

	var tr = document.createElement("tr");
	var td = document.createElement("td");
	td.colSpan = 3;
	td.align = "center";
	var btn = document.createElement("input");
		btn.type = "button";
		btn.value = "保存";
		btn.addEventListener("click", saveData_14, true);

	var wrlink = document.createElement("span");
		wrlink.innerHTML = " | ";

	var link = document.createElement("a");
		link.href = "javascript:void(0)";
		link.innerHTML = "戻る";
		link.addEventListener("click",function(){location.reload();},true);

	wrlink.appendChild(link);

	td.appendChild(btn);
	td.appendChild(wrlink);
	tr.appendChild(td);
	table.appendChild(tr);

	var tr = document.createElement("tr");
	var th = document.createElement("th");
	th.className = "ttl3";
	th.innerHTML = "表示名";

	th2 = document.createElement("th");
	th2.className = "ttl4";

	th2.innerHTML = "検索条件";
	th3 = document.createElement("th");

	th3.className = "ttl4";
	th3.innerHTML = "検索ワード";

	tr.appendChild(th);
	tr.appendChild(th2);
	tr.appendChild(th3);
	table.appendChild(tr);




	var Mem = new Array();
	var Con = new Array();
	var Key = new Array();

	var ar = GM_getValue(location.hostname + "TrdMem");
	if(ar == undefined){
		for(var i=0;i<num_14;i++){ Mem[i] = "";}
	}else{
		Mem = ar.split("#$%");
	}

	var ar = GM_getValue(location.hostname + "TrdCon");
	if(ar == undefined){
		for(var i=0;i<num_14;i++){Con[i] = "";}
	}else{
		Con = ar.split("#$%");
	}

	var ar = GM_getValue(location.hostname + "TrdKey");
	if(ar == undefined){
		for(var i=0;i<num_14;i++){Key[i] = "";}
	}else{
		Key = ar.split("#$%");
	}

	for(var i=0;i<num_14;i++){
		if(Mem[i] == undefined || Mem[i] == "undefined") Mem[i]="";
		if(Key[i] == undefined || Key[i] == "undefined") Key[i]="";


		var tr = document.createElement("tr");
		var td = document.createElement("th");
		td.innerHTML = "<input type=\"text\" size=\"15\" name=\"view" + i + "\" id=\"view" + i + "\" style=\"border:1px solid;\" value=\"" + Mem[i] + "\" />";
		td.className = "ttl";

		var td2 = document.createElement("th");
		td2.className = "ttl";

		var selTag = document.createElement("select");
		selTag.className = 'combo';
		selTag.id = 'con' + i;
		selTag.name = 'con' + i;

		var opt0   = document.createElement("option");	opt0.value = 0;	opt0.innerHTML = '武将名';
		var opt1   = document.createElement("option");	opt1.value = 1;	opt1.innerHTML = 'レベル';
		var opt2   = document.createElement("option");	opt2.value = 2;	opt2.innerHTML = 'カードNo';
		var opt3   = document.createElement("option");	opt3.value = 3;	opt3.innerHTML = '所持スキル';

		selTag.appendChild(opt0);
		selTag.appendChild(opt1);
		selTag.appendChild(opt2);
		selTag.appendChild(opt3);

		selTag.selectedIndex = Con[i];

		td2.appendChild(selTag);


		var td3 = document.createElement("th");
		td3.className = "ttl";
		td3.innerHTML = "<input type=\"text\" size=\"40\" name=\"key" + i + "\" id=\"key" + i + "\" style=\"border:1px solid;\" value=\"" + Key[i] + "\" />";

		tr.appendChild(td);
		tr.appendChild(td2);
		tr.appendChild(td3);
		table.appendChild(tr);
	}

	var tr = document.createElement("tr");
	var td = document.createElement("td");
	td.colSpan = 3;
	td.align = "center";

	var btn = document.createElement("input");
		btn.type = "button";
		btn.value = "保存";
		btn.addEventListener("click", saveData_14, true);

	var wrlink = document.createElement("span");
		wrlink.innerHTML = " | ";

	var link = document.createElement("a");
		link.href = "javascript:void(0)";
		link.innerHTML = "戻る";
		link.addEventListener("click",function(){location.reload();},true);

	wrlink.appendChild(link);

	td.appendChild(btn);
	td.appendChild(wrlink);
	tr.appendChild(td);
	table.appendChild(tr);

	wrap.snapshotItem(0).appendChild(table);
}

function saveData_14(){
	var scrMem = "";	// save用変数
	var scrCon = "";
	var scrKey = "";

	var table = xpath_14('//*[@id="gray02Wrapper"]/table[@class="commonTables"]',document);

	var n = 0;
	var len = table.snapshotItem(0).rows.length;
	for(var i=1;i<len-2;i++){
		var view = xpath_14('//input[@id="view' + n + '"]',document);
		var con  = xpath_14('//select[@id="con'  + n + '"]',document);
		var key  = xpath_14('//input[@id="key'  + n + '"]',document);


		scrMem += view.snapshotItem(0).value;
		scrMem += "#$%";
		scrCon += con.snapshotItem(0).value;
		scrCon += "#$%";
		scrKey += key.snapshotItem(0).value;
		scrKey += "#$%";
		n++;
	}

	GM_setValue(location.hostname + "TrdMem", scrMem);
	GM_setValue(location.hostname + "TrdCon", scrCon);
	GM_setValue(location.hostname + "TrdKey", scrKey);

	alert('保存OK。多分ね。');
}


//faraway 14.トレード検索条件記憶のソース(b3tradememory.user.js)終了

//------------------------------------------------------------
// トレードその後 2014/02/23 運営書簡開封/削除 に表現変更
//------------------------------------------------------------
//start
var c	= 0;
var url = new Array();

function disp_tradingafter() {
	if(location.pathname != "/message/inbox.php") return;
	var tableTitle = xpath_15('//*[@id="gray02Wrapper"]//ul[@id="statMenu"]', document);
	var classRmv = xpath_15('//*[@id="gray02Wrapper"]//ul[@id="statMenu"]/li[@class="last"]', document);

	classRmv.snapshotItem(0).removeAttribute('class');

	var opnNtc = document.createElement("li");
	opnNtc.innerHTML = "<br><a href=\"javascript:void(0)\">運営書簡開封します</a>";
	var num = tableTitle.snapshotItem(0).childNodes.length;
	tableTitle.snapshotItem(0).insertBefore(opnNtc, tableTitle.snapshotItem(0).childNodes.item(num));
	opnNtc.addEventListener("click", opnNtcF, true);

	var chkSet = document.createElement("li");
	chkSet.className = "last";
	chkSet.innerHTML = "<a href=\"javascript:void(0)\">運営書簡チェックします</a>";
	var num = tableTitle.snapshotItem(0).childNodes.length;
	tableTitle.snapshotItem(0).insertBefore(chkSet, tableTitle.snapshotItem(0).childNodes.item(num));
	chkSet.addEventListener("click", chkSetF, true);
}

//空白除去
function trim_15(str) {
	return str.replace(/^[ 　\t\r\n]+|[ 　\t\r\n]+$|&nbsp;/g, "");
}
function xpath_15(query,targetDoc) {return document.evaluate(query, targetDoc, null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);}

function opnNtcF(){
	var table = xpath_15('//table[@class="commonTables"]', document);

	var len = table.snapshotItem(0).rows.length;

	window.setTimeout(function(){
		for(var i=2;i<len;i++){
			if( (table.snapshotItem(0).rows[i].className == 'unread') && (table.snapshotItem(0).rows[i].cells[2].getElementsByTagName('span')[0].className == 'notice') ) {
				url[++c] = table.snapshotItem(0).rows[i].cells[1].getElementsByTagName('a')[0].href;
			}
		}
	},0);

	window.setTimeout(function(){
		for(var i=1;i<=c;i++){
				var xmlhttp = new XMLHttpRequest();
				xmlhttp.open("GET",url[i]);
				xmlhttp.send(null);
		}
	},0);

}

function chkSetF(){
	var table = xpath_15('//table[@class="commonTables"]', document);

	var len = table.snapshotItem(0).rows.length;

	for(var i=2;i<len;i++){
		if(table.snapshotItem(0).rows[i].cells[2].getElementsByTagName('span')[0]){
			table.snapshotItem(0).rows[i].cells[0].getElementsByTagName('input')[0].checked = true;
		}
	}

}
//end

//----------------------------------------------------------------
// ナビゲーションロールオーバーリンク作成 2014/02/13 refactoring
//----------------------------------------------------------------
function disp_navigationaddition() {
	// 定数宣言
	var R_DOM = "http://" + document.location.hostname;
	var R_ALI_URL = R_DOM + "/alliance";
	var R_ALI_LOG_PHP = R_ALI_URL + "/alliance_log.php";
	var R_CD_URL = R_DOM + "/card";
	var R_CD_TRADE_PHP = R_CD_URL + "/trade.php";
	var R_CD_TRADE_CARD_PHP = R_CD_URL + "/trade_card.php";
	var R_CD_DECK_PHP = R_CD_URL + "/deck.php";
	var R_CD_TRADE_LIST_PHP = R_CD_URL + "/trade_card_list.php";
	var R_CD_PICTURE_PHP = R_CD_URL + "/busyobook_picture.php";
	var R_COND_URL = R_DOM + "/conditions";
	var R_USER_URL = R_DOM + "/user";
	var R_USER_RANK_PHP = R_USER_URL + "/ranking.php";
	var R_BBS_URL = R_DOM + "/bbs";
	var R_FAC_URL = R_DOM + "/facility";
	var R_FAC_UNIT_PHP = R_FAC_URL + "/unit_status.php";
	var R_FAC_TERRITORY_PHP = R_FAC_URL + "/territory_status.php";
	var R_CD_EVENT_PHP = R_CD_URL + "/event_battle_top.php";
	var R_UNION_URL = R_DOM + "/union";
	var R_UNION_INDEX_PHP = R_UNION_URL + "/index.php";
	var R_BUSYODAS_URL = R_DOM + "/busyodas";
	var R_REP_LIST_PHP = R_DOM + "/report/list.php";
	var R_MES_URL = R_DOM + "/message";
	var R_QUEST_URL = R_DOM + "/quest";
	var R_ITEM_URL = R_DOM + "/item";

	// jquery
	jQuery.noConflict();
	j$ = jQuery;

	//ショートカット関数
	function $c(className){ return document.getElementsByClassName(className); }

	// GM_Wrapper
	GM_addStyle = function (css) {
		var style = document.createElement('style');
		style.textContent = css;
		document.getElementsByTagName('head')[0].appendChild(style);
	};

	function addLink(prClass, linkArr){
		var ul = j$("<ul class='ro'>");
		var base = ul;
		for(var i = 0; i < linkArr.length; i++){
			var blank = "";
			var mtext = linkArr[i][0];
			if (mtext.indexOf("!") > 0){
				mtext = mtext.substring(0,mtext.length-1);
				blank = " target='_blank' ";
			}
			var mlink1 = linkArr[i][1];
			var mlink2 = linkArr[i][2];
			var hh = mtext.indexOf("--");
			var h = mtext.indexOf("-");
			var pp = mtext.indexOf("++");
			var p = mtext.indexOf("+");

			// -- で始まる要素は無視
			if( hh == 0 ){
				continue;
			}
			// - も ++ もなかったら処理ノードを先頭に戻す
			if( h < 0 && pp < 0 ){
				base = ul;
			}

			// メニューに結び付けるTextを取得
			var menuText = "";
			if( pp == 0 ){
				menuText = mtext.slice(2);
			}else if(p == 0 || h == 0){
				menuText = mtext.slice(1);
			}else{
				menuText = mtext;
			}

			// メニューの生成
			var li;
			if( mlink1 !== "func" ){
				li = j$("li:last",base.append("<li><a href='" + mlink1 + "'" + blank + ">" + menuText + "</a></li>"));
			}else{
				li = j$("li:last",base.append("<li><div>" + menuText + "</div></li>"));
				li.bind("click", mlink2);
			}
			if( pp == 0 ){
				li.attr('class','pr');
				addlink_ch(li,linkArr,i,mtext);
			}
			else if( p == 0 ){
				li.attr('class','pr');
				base = j$("ul:last",li.append("<ul class='ro_ch'></ul>"));
			}
		}
		j$("li." + prClass).append(ul);
	}

	function addlink_ch(prEle,linkArr,start,keys){
		var ul = j$("<ul class='ro_ch'>");
		var found = 0;
		for(var i = start; i < linkArr.length; i++){
			var blank = "";
			var mtext = linkArr[i][0];
			if (mtext.indexOf("!") > 0){
				mtext = mtext.substring(0,mtext.length-1);
				blank = " target='_blank' ";
			}

			// 対象がみつかるまでスキップ
			if(found==0 && mtext!=keys){
				 continue;
			}
			if(mtext == keys){
				// 対象発見(++)
				found=1;
				continue;
			}
			if(mtext.indexOf("--") != 0){
				// 終了(--ではない)
				break;
			}
			ul.append("<li><a href='" + linkArr[i][1] + "'" + blank + ">" + mtext.slice(2) + "</a></li>");
		}
		prEle.append(ul);
	}

	function getEBUrl(d,l,h) {
		return R_CD_EVENT_PHP + "?filter_damege=" + d + "&filter_level=" + l + "&filter_hp=" + h + "&scope=3&battle_id=";
	}

	function getWikiUrl(n) {
		return "http://www35.atwiki.jp/browser3594/pages/" + n + ".html";
	}

	function getCLUrl(n) {
		return R_CD_TRADE_PHP + "?t=skill&k=" + encodeURIComponent(n) + "&tl=0&s=&o=&r_l=1&r_ur=1&r_sr=1&r_r=1&r_uc=1&r_c=1&r_pr=&r_hr=&r_lr=&lim=1&nation=gi&rarity=UR";
	}

	function getCNUrl(n) {
		return R_CD_TRADE_PHP + "?s=rarity&a=d&t=name&k=" + encodeURIComponent(n) + "&tl=0&r_ur=0&r_sr=0&r_r=0&r_uc=0&r_c=0";
	}

	function getCDUrl(p,l) {
		var params = "";
		if( p > 0 && l > 0 ){
			params = "p=" + p + "&l=" + l;
		}else if( p > 0 ){
			params = "p=" + p;
		}else{
			params = "l=" + l;
		}
		return R_CD_DECK_PHP + "?" + params + "#file-1";
	}
	function getUNSUrl(p,l) {
		var params = "";
		if( p > 0 && l > 0 ){
			params = "union_card_select=0&p=" + p + "&label=" + l;
		}else if( p > 0 ){
			params = "union_card_select=0&p=" + p;
		}else{
			params = "label=" + l;
		}
		return R_UNION_INDEX_PHP + "?" + params + "#file-1";
	}
	function getCPUrl(f) {
		return R_CD_PICTURE_PHP + "?filter=" + f + "&status=2#ptop";
	}

	function getQUrl(l,m,c,r) {
		if( l == 0 ){
			// modeのみ
			return R_QUEST_URL + "/index.php?list=1&p=1&mode=" + m + "&action=change_mode&sort_1st_item=-1&sort_1st_order=desc&sort_2nd_item=-1&sort_2nd_order=desc&sort_3rd_item=-1&sort_3rd_order=desc&filter_difficult=-1&filter_category=-1&filter_reward=-1";
		}
		return R_QUEST_URL + "/index.php?list=1&p=1&mode=0&action=apply_condition" +
							 "&sort_1st_item=-1&sort_1st_order=desc&sort_2nd_item=-1&sort_2nd_order=desc&sort_3rd_item=-1&sort_3rd_order=desc&" +
							 "filter_difficult=-1&filter_category=" + c + "&filter_reward=" + r;
	}

	function getQIdUrl(id){
		return R_QUEST_URL + "/index.php?list=1&p=1&mode=0&action=take_quest" +
							 "&sort_1st_item=-1&sort_1st_order=desc&sort_2nd_item=-1&sort_2nd_order=desc&sort_3rd_item=-1&sort_3rd_order=desc&" +
							 "filter_difficult=-1&filter_category=-1&filter_reward=-1&id=" + id
	}

	// 都市タブ
	if( j$("li[class*=gnavi01]").length > 0 ){
		var villa = [
			["都市トップ", j$("li[class*=gnavi01] a").attr('href')],
			["同盟拠点", R_ALI_URL + "/village.php"],
			["+デュエル", R_CD_URL + "/duel_redirect.php"],
				["-メイン", R_CD_URL + "/duel_main.php#ptop"],
				["-デッキセット", R_CD_URL + "/duel_set.php#ptop"],
				["-成績", R_CD_URL + "/duel_record.php#ptop"],
			["+プロフィール", R_USER_URL + "/"],
				["-プロフィール編集", R_USER_URL + "/change/change.php"],
				["-フレンド管理", R_USER_URL + "/friend/friend_list.php"],
				["-個人掲示板", R_BBS_URL + "/personal_topic_view.php"],
				["-ケータイ設定", R_USER_URL + "/mobile_setting.php"],
				["-獲得武勲", R_USER_URL + "/decoration.php"],
				["-シリアルコード", R_USER_URL + "/serial/serial.php"],
			["+開催中イベント", R_CD_EVENT_PHP + "?scope=4#ptop"],
				["-同盟員全部", R_CD_EVENT_PHP + "?p=1&scope=2#ptop"],
				["++攻撃戦全部", getEBUrl(1,-1,-1)],
				["--攻撃戦1-5万", getEBUrl(1,-1,5)],
				["--攻撃戦5万-50万", getEBUrl(1,-1,6)],
				["--攻撃戦50万-100万", getEBUrl(1,-1,7)],
				["--攻撃戦100万以上", getEBUrl(1,-1,8)],
				["++防御戦全部", getEBUrl(2,-1,-1)],
				["--防御戦1-5万", getEBUrl(2,-1,5)],
				["--防御戦5万-50万", getEBUrl(2,-1,6)],
				["--防御戦50万-100万", getEBUrl(2,-1,7)],
				["--防御戦100万以上", getEBUrl(2,-1,8)],
				["++知力戦全部", getEBUrl(3,-1,-1)],
				["--知力戦1-5万", getEBUrl(3,-1,5)],
				["--知力戦5万-50万", getEBUrl(3,-1,6)],
				["--知力戦50万-100万", getEBUrl(3,-1,7)],
				["--知力戦100万以上", getEBUrl(3,-1,8)],
				["++速度戦全部", getEBUrl(4,-1,-1)],
				["--速度戦1-5万", getEBUrl(4,-1,5)],
				["--速度戦5万-50万", getEBUrl(4,-1,6)],
				["--速度戦50万-100万", getEBUrl(4,-1,7)],
				["--速度戦100万以上", getEBUrl(4,-1,8)],
			["+武将図鑑", R_CD_URL + "/busyo_search.php"],
				["-L", R_CD_URL + "/busyo_search.php?search_options=name&q=&sort=card-no-asc&rarity[]=60&status=0&ability_type=attack&ability_value=&ability_sort=asc&search_start=1"],
				["-UR", R_CD_URL + "/busyo_search.php?search_options=name&q=&sort=card-no-asc&rarity[]=50&status=0&ability_type=attack&ability_value=&ability_sort=asc&search_start=1"],
				["-SR", R_CD_URL + "/busyo_search.php?search_options=name&q=&sort=card-no-asc&rarity[]=40&status=0&ability_type=attack&ability_value=&ability_sort=asc&search_start=1"],
				["-R", R_CD_URL + "/busyo_search.php?search_options=name&q=&sort=card-no-asc&rarity[]=30&status=0&ability_type=attack&ability_value=&ability_sort=asc&search_start=1"],
				["-UC", R_CD_URL + "/busyo_search.php?search_options=name&q=&sort=card-no-asc&rarity[]=20&status=0&ability_type=attack&ability_value=&ability_sort=asc&search_start=1"],
				["-C", R_CD_URL + "/busyo_search.php?search_options=name&q=&sort=card-no-asc&rarity[]=10&status=0&ability_type=attack&ability_value=&ability_sort=asc&search_start=1"],
				["-蜀", R_CD_URL + "/busyo_search.php?search_options=name&q=&sort=card-no-asc&rarity[]=1&status=0&ability_type=attack&ability_value=&ability_sort=asc&search_start=1"],
				["-魏", R_CD_URL + "/busyo_search.php?search_options=name&q=&sort=card-no-asc&rarity[]=2&status=0&ability_type=attack&ability_value=&ability_sort=asc&search_start=1"],
				["-呉", R_CD_URL + "/busyo_search.php?search_options=name&q=&sort=card-no-asc&rarity[]=3&status=0&ability_type=attack&ability_value=&ability_sort=asc&search_start=1"],
				["-他", R_CD_URL + "/busyo_search.php?search_options=name&q=&sort=card-no-asc&rarity[]=4&status=0&ability_type=attack&ability_value=&ability_sort=asc&search_start=1"],
				["-覇", R_CD_URL + "/busyo_search.php?search_options=name&q=&sort=card-no-asc&rarity[]=5&status=0&ability_type=attack&ability_value=&ability_sort=asc&search_start=1"],
				["-特", R_CD_URL + "/busyo_search.php?search_options=name&q=&sort=card-no-asc&T=1&status=0&ability_type=attack&ability_value=&ability_sort=asc&search_start=1"],
				["-指", R_CD_URL + "/busyo_search.php?search_options=name&q=&sort=card-no-asc&S=1&status=0&ability_type=attack&ability_value=&ability_sort=asc&search_start=1"],
			["+スキル図鑑", R_DOM + "/skill_book/skill_book.php"],
				["-攻撃", R_DOM + "/skill_book/skill_book.php?name=&attack=1"],
				["-防御", R_DOM + "/skill_book/skill_book.php?name=&defence=1"],
				["-自動攻撃", R_DOM + "/skill_book/skill_book.php?name=&passive_attack=1"],
				["-自動攻撃", R_DOM + "/skill_book/skill_book.php?name=&passive_defence=1"],
				["-デュエル", R_DOM + "/skill_book/skill_book.php?name=&duel=1"]
		];
		addLink("gnavi01", villa);
	}

	// 全体地図タブ
	if( j$("li.gnavi02").length > 0 ){
		var $link = j$("li.gnavi02 a").attr('href');
		var maplink = [
			["11x11", $link + "&type=1"],
			["15x15", $link + "&type=2"],
			["21x21", $link + "&type=5"],
			["51x51", $link + "&type=4"]
		];
		addLink("gnavi02", maplink);
	}

	// 同盟タブ
	if( j$("li[class*=gnavi03]").length > 0 ){
		wrapHttpReq(R_DOM + "/bbs/topic_view.php#ptop", "GET", null,
			function(response) {
				var bbstitle = new Array();
				var bbs_link = new Array();

				// html取り込みはjqueryは遅いので、documentを使う
				var html_bbs=document.createElement("div");
				html_bbs.innerHTML=response;
				var $x = function(xp,dc) { return document.evaluate(xp, dc||document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
				var trs = document.evaluate("//table[@class=\"commonTables\"][@summary=\"件名\"]/tbody/tr",html_bbs, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
				for(i=1;i<trs.snapshotLength;i++){
					var bbs_tt = $x("td[1]"  ,trs.snapshotItem(i)).textContent;if(bbs_tt == '現在スレッドはありません') break;	//掲示板タイトル
					var bbs_hr = $x("td[1]/a",trs.snapshotItem(i)).getAttribute("href");						//掲示板URL
					var bbs_tm = $x("td[3]"  ,trs.snapshotItem(i)).textContent.replace(/^\d{4}\-|:\d{2}$/g,'');			//更新時刻 年と分を消す
					bbstitle[i-1]= bbs_tm +" "+ bbs_tt;
					bbs_link[i-1]= "/bbs/"+bbs_hr;
				}

				wrapHttpReq(R_DOM + "/bbs/personal_topic_view.php", "GET", null,
					function(response) {
						var pbbstitle = new Array();
						var pbbs_link = new Array();

						// html取り込みはjqueryは遅いので、documentを使う
						var html_bbs=document.createElement("div");
						html_bbs.innerHTML=response;
						var $x = function(xp,dc) { return document.evaluate(xp, dc||document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
						var trs = document.evaluate("//table[@class=\"commonTables\"][@summary=\"件名\"]/tbody/tr",html_bbs, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
						for(i=1;i<trs.snapshotLength;i++){
							var bbs_tt = $x("td[1]"  ,trs.snapshotItem(i)).textContent;if(bbs_tt == '現在スレッドはありません') break;	//掲示板タイトル
							var bbs_hr = $x("td[1]/a",trs.snapshotItem(i)).getAttribute("href");						//掲示板URL
							var bbs_tm = $x("td[3]"  ,trs.snapshotItem(i)).textContent.replace(/^\d{4}\-|:\d{2}$/g,'');			//更新時刻 年と分を消す
							pbbstitle[i-1]= bbs_tm +" "+ bbs_tt;
							pbbs_link[i-1]= "/bbs/"+bbs_hr;
						}

						var link = j$("li[class*=gnavi03] a").attr('href');
						var cname = j$("li[class*=gnavi03]").attr('class');
						var al = [
							["同盟トップ", link],
							["+寄付", link],
								["-糧500寄付", "func",
									function(){
										wrapHttpReq(R_ALI_URL + "/level.php", "POST", "wood=&stone=&iron=&rice=500&contribution=1",
											function(x){document.location.reload()}
										);
									}
								],
							["ランキング詳細", R_ALI_URL +"/ranking.php#ptop"],
							["同盟レベル", R_ALI_URL +"/level.php#ptop"],
							["勢力リスト", R_ALI_URL +"/dependency.php#ptop"],
							["+同盟ログ", R_ALI_LOG_PHP + "#ptop"],
								["-全て", R_ALI_LOG_PHP],
								["-攻撃", R_ALI_LOG_PHP + "?m=attack"],
								["-防御", R_ALI_LOG_PHP + "?m=defense"],
								["-偵察", R_ALI_LOG_PHP + "?m=scout"],
								["-破壊", R_ALI_LOG_PHP + "?m=fall"],
								["-援軍", R_ALI_LOG_PHP + "?m=reinforcement"],
								["-同盟", R_ALI_LOG_PHP + "?m=alliance"]
						];
//						if( bbstitle.length > 0 ){
//							al.push(["+同盟掲示板(" + bbstitle.length + ")", R_BBS_URL + "/topic_view.php#ptop"]);
//							for (var i = 0; i < bbstitle.length; i++) {
//								al.push(["-"+bbstitle[i], bbs_link[i]]);
//							}
//						} else {
//							al.push(["同盟掲示板(0)", R_BBS_URL + "/topic_view.php#ptop"]);
//						}
//						if( pbbstitle.length > 0 ){
//							al.push(["+個人掲示板(" + pbbstitle.length + ")", R_BBS_URL + "/personal_topic_view.php#ptop"]);
//							for (var i = 0; i < pbbstitle.length; i++) {
//								al.push(["-"+pbbstitle[i], pbbs_link[i]]);
//							}
//						} else {
//							al.push(["個人掲示板(0)", R_BBS_URL + "/personal_topic_view.php#ptop"]);
//						}
						al.push(["同盟ひとこと掲示板", R_ALI_URL + "/chat_view.php#ptop"],
								["管理", R_ALI_URL + "/manage.php#ptop"],
								["配下同盟管理", R_ALI_URL + "/manage_dep.php#ptop"],
								["同盟情報変更", R_ALI_URL + "/change.php#ptop"],
								["同盟スキル", R_ALI_URL + "/alliance_skill.php#ptop"],
								["助力履歴", R_ALI_URL + "/assist_history.php#ptop"],
								["同盟募集", R_ALI_URL + "/recruit.php?p=0&po=1&cn=5180#ptop"],
								["同盟希望", R_ALI_URL + "/join_bbs.php#ptop"]);
						addLink(cname, al);
					}
				);
			}
		);
	}

	// デッキタブ
	function deckLink(response) {
		// 取得成功
		var result = response;
		var pos1 = result.indexOf("編集中のラベル名");
		var pos2 = result.indexOf("ラベルの設定を決定する", pos1);
		var result2 = result.substring(pos1, pos2);
		pos1 = 0;
		var labelName = new Array(6);
		for(i = 0; i < 6; i++){
			pos2 = result2.indexOf("<dt",pos1);
			pos1 = result2.indexOf(">",pos2);
			pos2 = result2.indexOf("</dt>",pos1);
			labelName[i] =	result2.substring(pos1+1, pos2);
			pos1 = pos2;
		}

		var numstr = ['','①','②','③','④','⑤','⑥','⑦','⑧','⑨','⑩','⑪','⑫','⑬','⑭','⑮','⑯','⑰','⑱','⑲','⑳'];

		var deck = [
			["カード一括破棄", R_CD_URL + "/allcard_delete.php?sz=100#ptop"],
			["+トレード", R_CD_TRADE_PHP + "#ptop"],
				["++個人用絞込", R_CD_TRADE_PHP + "#ptop"],
					["--スコア降順", R_CD_TRADE_PHP + "?t=name&k=&tl=0&s=score&o=d&r_l=1&r_ur=1&r_sr=1&r_r=1&r_uc=1&r_c=1&r_pr=&r_hr=&r_lr=&lim=1&nation=gi&rarity=UR"],
					["--全軍", getCLUrl("全軍")],
					["--UR水鏡", getCLUrl("水鏡鑑定")],
					["--SR水鏡", getCLUrl("水鏡眼識")],
					["--R水鏡", getCLUrl("水鏡評論")],
					["--UC水鏡", getCLUrl("水鏡指南")],
					["--パンダ", getCNUrl("パンダ")],
					["--猛将の鹵獲", getCLUrl("猛将の鹵獲")],
					["--鬼神の鹵獲", getCLUrl("鬼神の鹵獲")],
					["--劉備の大徳", getCLUrl("劉備の大徳")],
					["--鹵獲の強攻", getCLUrl("鹵獲の強攻")],
					["--鹵獲の猛攻", getCLUrl("鹵獲の猛攻")],
					["--鹵獲の極攻", getCLUrl("鹵獲の極攻")],
					["--迅速劫略", getCLUrl("迅速劫略")],
					["--神速劫略", getCLUrl("神速劫略")],
					["--皇叔の号令", getCLUrl("皇叔の号令")],
					["--攻城戦の極砕", getCLUrl("攻城戦の極砕")],
					["--智将器撃", getCLUrl("智将器撃")],
					["--智将砕器", getCLUrl("智将砕器")],
					["--市場繁栄", getCLUrl("市場繁栄")],
				["++絞込", R_CD_TRADE_PHP + "#ptop"],
					["--Ｌ即落", R_CD_TRADE_PHP + "?t=name&k=&tl=0&s=price&o=a&r_l=1&r_ur=0&r_sr=0&r_r=0&r_uc=0&r_c=0&r_pr=&r_hr=&r_lr=&lim=0&nation=gi&rarity=UR"],
					["--ＵＲ即落", R_CD_TRADE_PHP + "?t=name&k=&tl=0&s=price&o=a&r_l=0&r_ur=1&r_sr=0&r_r=0&r_uc=0&r_c=0&r_pr=&r_hr=&r_lr=&lim=0&nation=gi&rarity=UR"],
					["--ＳＲ即落", R_CD_TRADE_PHP + "?t=name&k=&tl=0&s=price&o=a&r_l=0&r_ur=0&r_sr=1&r_r=0&r_uc=0&r_c=0&r_pr=&r_hr=&r_lr=&lim=0&nation=gi&rarity=UR"],
					["--Ｒ即落", R_CD_TRADE_PHP + "?t=name&k=&tl=0&s=price&o=a&r_l=0&r_ur=0&r_sr=0&r_r=1&r_uc=0&r_c=0&r_pr=&r_hr=&r_lr=&lim=0&nation=gi&rarity=UR"],
					["--ＵＣ即落", R_CD_TRADE_PHP + "?t=name&k=&tl=0&s=price&o=a&r_l=0&r_ur=0&r_sr=0&r_r=0&r_uc=1&r_c=0&r_pr=&r_hr=&r_lr=&lim=0&nation=gi&rarity=UR"],
					["--Ｃ即落", R_CD_TRADE_PHP + "?t=name&k=&tl=0&s=price&o=a&r_l=0&r_ur=0&r_sr=0&r_r=0&r_uc=0&r_c=1&r_pr=&r_hr=&r_lr=&lim=0&nation=gi&rarity=UR"],
					["--Ｌ公開前", R_CD_TRADE_PHP + "?t=name&k=&tl=1&s=price&o=a&r_l=1&r_ur=0&r_sr=0&r_r=0&r_uc=0&r_c=0&r_pr=&r_hr=&r_lr=&lim=0"],
					["--ＵＲ公開前", R_CD_TRADE_PHP + "?t=name&k=&tl=0&s=&o=&r_l=0&r_ur=1&r_sr=0&r_r=0&r_uc=0&r_c=0&r_pr=&r_hr=&r_lr=&lim=0"],
					["--ＳＲ公開前", R_CD_TRADE_PHP + "?t=name&k=&tl=1&s=price&o=a&r_l=0&r_ur=0&r_sr=1&r_r=0&r_uc=0&r_c=1&r_pr=&r_hr=&r_lr=&lim=0"],
					["--Ｒ公開前", R_CD_TRADE_PHP + "?t=name&k=&tl=1&s=price&o=a&r_l=0&r_ur=0&r_sr=0&r_r=1&r_uc=0&r_c=0&r_pr=&r_hr=&r_lr=&lim=0"],
					["--ＵＣ公開前", R_CD_TRADE_PHP + "?t=name&k=&tl=1&s=price&o=a&r_l=0&r_ur=0&r_sr=0&r_r=0&r_uc=1&r_c=0&r_pr=&r_hr=&r_lr=&lim=0"],
					["--Ｃ公開前", R_CD_TRADE_PHP + "?t=name&k=&tl=1&s=price&o=a&r_l=0&r_ur=0&r_sr=0&r_r=0&r_uc=0&r_c=1&r_pr=&r_hr=&r_lr=&lim=0"],
					["--一覧(蜀)", R_CD_TRADE_LIST_PHP + "?s=&c[1]=#"],
					["--一覧(魏)", R_CD_TRADE_LIST_PHP + "?s=&c[2]=#"],
					["--一覧(呉)", R_CD_TRADE_LIST_PHP + "?s=&c[3]=#"],
					["--一覧(他)", R_CD_TRADE_LIST_PHP + "?s=&c[4]=#"],
					["--一覧(覇)", R_CD_TRADE_LIST_PHP + "?s=&c[5]=#"],
				["++絞込-攻撃(自動)系", R_CD_TRADE_PHP + "#ptop"],
					["--騎兵の猛攻", getCLUrl("騎兵の猛攻")],
					["--騎兵の強攻", getCLUrl("騎兵の強攻")],
					["--騎兵の進攻", getCLUrl("騎兵の進攻")],
					["--槍兵の猛攻", getCLUrl("槍兵の猛攻")],
					["--槍兵の強攻", getCLUrl("槍兵の強攻")],
					["--槍兵の進攻", getCLUrl("槍兵の進攻")],
					["--弓兵の猛攻", getCLUrl("弓兵の猛攻")],
					["--弓兵の強攻", getCLUrl("弓兵の強攻")],
					["--弓兵の進攻", getCLUrl("弓兵の進攻")],
				["++絞込-回復", R_CD_TRADE_PHP + "#ptop"],
					["--仁君", getCLUrl("仁君")],
					["--弓腰姫の愛", getCLUrl("弓腰姫の愛")],
					["--神医の施術", getCLUrl("神医の施術")],
					["--発憤興起", getCLUrl("発憤興起")],
					["--桃色吐息", getCLUrl("桃色吐息")],
					["--傾国", getCLUrl("傾国")],
					["--才女の瞳", getCLUrl("才女の瞳")],
					["--優雅な調べ", getCLUrl("優雅な調べ")],
					["--皇后の慈愛", getCLUrl("皇后の慈愛")],
				["++絞込-飛将素材", getCLUrl("飛将")],
					["--弓将の采配", getCLUrl("弓将の采配")],
					["--覇王の進撃", getCLUrl("覇王の進撃")],
					["--憂姫護国", getCLUrl("憂姫護国")],
					["--軍神", getCLUrl("軍神")],
					["--魏武王", getCLUrl("魏武王")],
					["--苦肉の計", getCLUrl("苦肉の計")],
					["--神飛将", getCLUrl("神飛将")],
					["--隻眼将の軍略", getCLUrl("隻眼将の軍略")],
					["--聡明叡智", getCLUrl("聡明叡智")],
				["++絞込-神医素材", getCLUrl("神医の術式")],
					["--傾国", getCLUrl("傾国")],
					["--大皇帝", getCLUrl("大皇帝")],
					["--臥龍覚醒", getCLUrl("臥竜覚醒")],
					["--神算鬼謀", getCLUrl("神算鬼謀")],
					["--群雄の極撃", getCLUrl("群雄の極撃")],
					["--皇后の慈愛", getCLUrl("皇后の慈愛")],
					["--神医の施術", getCLUrl("神医の施術")],
					["--強兵の檄文", getCLUrl("強兵の檄文")],
					["--攻城の檄文", getCLUrl("攻城の檄文")],
				["++絞込-護君素材", getCLUrl("護君")],
					["--不撓不屈", getCLUrl("不撓不屈")],
					["--勇猛果敢", getCLUrl("勇猛果敢")],
					["--堅忍不抜", getCLUrl("堅忍不抜")],
					["--優姫の敬愛", getCLUrl("優姫の敬愛")],
					["--勇姫督励", getCLUrl("勇姫督励")],
					["--暴姫の威令", getCLUrl("暴姫の威令")],
				["-一覧(全て)", R_CD_TRADE_LIST_PHP + "#ptop"],
				["-出品中のカード", R_CD_URL + "/exhibit_list.php#ptop"],
				["-入札中のカード", R_CD_URL + "/bid_list.php#ptop"],
				["-出品する", R_CD_TRADE_CARD_PHP],
			["城・村・砦", R_FAC_URL + "/castle.php#ptop"],
			["+兵士管理",  R_FAC_UNIT_PHP + "#ptop"],
				["-全て表示",	R_FAC_UNIT_PHP + "#all"],
				["-待機中",	R_FAC_UNIT_PHP + "#wait"],
				["-出撃中",	R_FAC_UNIT_PHP + "#sortie"],
				["-予約中",	R_FAC_UNIT_PHP + "#reserve"],
				["-移動中",	R_FAC_UNIT_PHP + "#move"],
				["-帰還中",	R_FAC_UNIT_PHP + "#return"],
				["-敵襲中",	R_FAC_UNIT_PHP + "#enemy"],
				["-援軍中",	R_FAC_UNIT_PHP + "#help"],
			["+領地管理",	R_FAC_TERRITORY_PHP + "#ptop"],
				["++領地LV上げ",	R_FAC_TERRITORY_PHP + "#all"],
					["--戦力降順①",	R_FAC_TERRITORY_PHP + "?p=1&s=2&o=1"],
					["--戦力降順②",	R_FAC_TERRITORY_PHP + "?p=2&s=2&o=1"],
					["--戦力降順③",	R_FAC_TERRITORY_PHP + "?p=3&s=2&o=1"],
					["--戦力降順④",	R_FAC_TERRITORY_PHP + "?p=4&s=2&o=1"],
					["--戦力降順⑤",	R_FAC_TERRITORY_PHP + "?p=5&s=2&o=1"],
				["-全て",	R_FAC_TERRITORY_PHP + "#all"],
				["-待機",	R_FAC_TERRITORY_PHP + "#wait"],
				["-移動",	R_FAC_TERRITORY_PHP + "#move"],
				["-敵襲",	R_FAC_TERRITORY_PHP + "#enemy"],
			["出兵",	 R_FAC_URL + "/castle_send_troop.php#ptop"],
			["内政設定", R_CD_URL + "/domestic_setting.php#ptop"],
			["+デッキ",  R_CD_DECK_PHP + "#ptop"]
		];
		deck.push(["++ファイル", getCDUrl(1,-1)]);
		for(var i = 1; i <= 20; i++){
			deck.push(["--すべて"+numstr[i], getCDUrl(i,-1)]);
		}
		for(var i = 1; i <= 6; i++){
			deck.push(["++"+labelName[i-1], getCDUrl(-1,i)]);
			for(var j = 1; j <= 9; j++) {
				deck.push(["--"+labelName[i-1]+numstr[j], getCDUrl(j,i)]);
			}
		}
		deck.push(
				["-ラベル名設定", R_CD_URL + "/tab_edit.php#ptop"]
		);
		deck.push(["+合成", R_UNION_URL + "/#ptop"]);
		deck.push(["++ファイル", getUNSUrl(1,-1)]);
		for(var i = 1; i <= 20; i++){
			deck.push(["--すべて"+numstr[i], getUNSUrl(i,-1)]);
		}
		for(var i = 1; i <= 6; i++){
			deck.push(["++"+labelName[i-1], getUNSUrl(-1,i)]);
			for(var j = 1; j <= 9; j++) {
				deck.push(["--"+labelName[i-1]+numstr[j], getUNSUrl(j,i)]);
			}
		}
		deck.push(
			["ブショーダス履歴", R_BUSYODAS_URL + "/busyodas_history.php#ptop"],
			["合成履歴", R_UNION_URL + "/union_history.php#ptop"]
		);

		addLink("gnavi_deck", deck);
	}
	if( j$("li.gnavi_deck").length > 0 ){
		wrapHttpReq(R_CD_URL + "/tab_edit.php#ptop", "GET", null, deckLink);
	}

	// アイテムタブ
	if( j$("li[class*=gnavi_item]").length > 0 ){
		var cname = j$("li[class*=gnavi_item]").attr('class');
		var item = [
			["便利アイテム", R_ITEM_URL +"/index.php"],
			["受信箱", R_ITEM_URL +"/inbox.php"],
		];
		addLink(cname, item);
	}

	// 統計タブ
	if( j$("li[class*=gnavi04]").length > 0 ){
		var rank = [
			["状況", R_COND_URL + "/top.php#ptop"],
			["自城・拠点", R_COND_URL + "/top.php#mode-my"],
			["NPC砦・城", R_COND_URL + "/top.php#mode-npc"],
			["直近陥落", R_COND_URL + "/top.php#mode-fall"],
			["同盟", R_ALI_URL + "/list.php#ptop"],
			["制圧", R_ALI_URL + "/npc_mastery_ranking.php#ptop"],
			["同盟総合", R_ALI_URL + "/list.php#ptop"],
			["同盟週間", R_ALI_URL + "/weekly_ranking.php#ptop"],
			["個人", R_USER_RANK_PHP + "#ptop"],
			["総合", R_USER_RANK_PHP + "#ptop"],
			["人口", R_USER_RANK_PHP + "?m=population"],
			["攻撃", R_USER_RANK_PHP + "?m=attack"],
			["防御", R_USER_RANK_PHP + "?m=defense"],
			["撃破スコア", R_USER_RANK_PHP + "?m=attack_score"],
			["防衛スコア", R_USER_RANK_PHP + "?m=defense_score"],
			["デュエル", R_USER_RANK_PHP + "?m=duel"],
			["週間ランキング", R_USER_URL + "/weekly_ranking.php#ptop"],
			["期間ランキング", R_USER_URL + "/period_ranking.php#ptop"],
			["イベントランキング", R_USER_URL + "/item_drop_ranking.php#ptop"],
		];
		addLink("gnavi04", rank);
	}

	// 報告書タブ
	if( j$("li[class*=gnavi05]").length > 0 ){
		var cname = j$("li[class*=gnavi05]").attr('class');
		var report = [
			["未読", R_REP_LIST_PHP + "?u=new&p=0&m="],
			["全て", R_REP_LIST_PHP + "#ptop"],
			["攻撃", R_REP_LIST_PHP + "?m=attack&u="],
			["防御", R_REP_LIST_PHP + "?m=defence&u="],
			["偵察", R_REP_LIST_PHP + "?m=scout&u="],
			["破壊", R_REP_LIST_PHP + "?m=fall&u="],
			["援軍", R_REP_LIST_PHP + "?m=reinforcement&u="],
			["同盟", R_REP_LIST_PHP + "?m=alliance&u="],
			["デュエル", R_REP_LIST_PHP + "?m=pvp&u="]
		];
		addLink(cname, report);

		j$("li[class*=" + cname + "] ul[class*=ro]").append("<li><input id='r_readreport' type=button value='全てを既読に' /><li>");
		j$("#r_readreport").bind("click",
			function() {
				if(confirm("全ての書簡を既読にしますか？")) {
					wrapHttpReq(R_DOM + "/report/list.php", "POST", "all_open=" + escape("全てを既読にする"),
						function(response) {
							alert("完了しました");
							if(String(document.location).indexOf("/report/list.php") != -1){
								document.location.reload();
							}
						}
					);
				}
			}
		);
	}

	// 書簡タブ
	if( j$("li[class*=gnavi06]").length > 0 ){
		var cname = j$("li[class*=gnavi06]").attr('class');
		var mes = [
			["未読", R_MES_URL + "/inbox.php?u=new&p=0"],
			["受信箱", R_MES_URL + "/inbox.php"],
			["送信履歴", R_MES_URL + "/outbox.php#ptop"],
			["新規作成", R_MES_URL + "/new.php#ptop"],
			["ブラックリスト", R_MES_URL + "/black_list/black_list.php#ptop"]
		]
		addLink(cname, mes);

		j$("li[class*=" + cname + "] ul[class*=ro]").append("<li><input id='r_readdoc' type=button value='全てを既読に' /><li>");
		j$("#r_readdoc").bind("click",
			function() {
				if(confirm("全ての書簡を既読にしますか？\n(運営チームからの書簡は既読にできません)")) {
					wrapHttpReq(R_DOM + "/message/inbox.php", "POST", "all_open=" + escape("全てを既読にする"),
						function(response) {
							alert("完了しました");
							if(String(document.location).indexOf("/message/inbox.php") != -1){
								document.location.reload();
							}
						}
					);
				}
			}
		);
	}

	// クエストタブ
	if( j$("li[class*=gnavi_quest]").length > 0 ){
		var cname = j$("li[class*=gnavi_quest]").attr('class');
		var quest = [
			["+繰り返し", getQUrl(0,2,0,0)],
				["-全部受理", "func",
					function(){
						wrapHttpReq(getQIdUrl(254),"GET",null,function(x){});
						wrapHttpReq(getQIdUrl(255),"GET",null,function(x){});
						wrapHttpReq(getQIdUrl(256),"GET",null,function(x){location.href=getQUrl(0,2,0,0)});
					}
				],
				["-寄付クエ受理", "func",
					function(){
						wrapHttpReq(getQIdUrl(254),"GET",null,function(x){location.href=getQUrl(0,2,0,0)});
					}
				],
				["-デュエルクエ受理", "func",
					function(){
						wrapHttpReq(getQIdUrl(255),"GET",null,function(x){location.href=getQUrl(0,2,0,0)});
					}
				],
				["-殲滅クエ受理", "func",
					function(){
						wrapHttpReq(getQIdUrl(256),"GET",null,function(x){location.href=getQUrl(0,2,0,0)});
					}
				],
			["+未クリア", getQUrl(0,0,0,0)],
			["-資源", getQUrl(1,0,-1,1)],
			["-名声", getQUrl(1,0,-1,2)],
			["-チケット/他", getQUrl(1,0,-1,"3%2C0")],
			["-勢力拡大", getQUrl(1,0,6,-1)],
			["-同盟拠点", getQUrl(1,0,12,-1)],
			["-BP", getQUrl(1,0,-1,4)],
			["-TP", getQUrl(1,0,-1,5)],
			["-CP", getQUrl(1,0,-1,6)],
			["クリア済", getQUrl(0,1,0,0)],
			["全部", getQUrl(0,2,0,0)],
			["受理中", getQUrl(0,3,0,0)]
		];
		addLink(cname, quest);
	}

	// 運営のロールオーバーを消す
	j$("div[id|=menu_container]").remove();


	//スタイル追加
	GM_addStyle("\
		#gNav > ul > li:hover > ul, #gNav ul.ro > li:hover > ul.ro_ch {\
			display: block !important;\
		}\
		div#gNav ul.ro, div#gNav ul.ro_ch {\
			background: #1a1a1a !important; border: 2px solid #1a1a1a; padding: 3px; width: auto; min-width: 80px; height: auto; position: absolute; z-index: 9999; display: none;\
		}\
		ul.ro li {\
			margin-right: 0 !important; float: none !important;\
		}\
		ul.ro > li {\
			position: relative;\
		}\
		li.pr > a {\
			background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAIAAADwlwNsAAAABGdBTUEAALGPC/xhBQAAAEBJREFUKFNj/P//PwN+AFTR0NAAJHEBBogKCMCqCEUFVkXoKjANw64CWR0+FRBLyTUD2VMk+gVfeBAIUzzSQCkAL60+obPpW1IAAAAASUVORK5CYII=') right no-repeat;\
		}\
		li.pr > a:after {\
			content: '>'; display: #1a1a1a; position: absolute; top: 3px; right: 5px;\
		}\
		#gNav ul.ro_ch {\
			border-left: 1px solid #1a1a1a !important; min-width: 90px !important; top: -5px; left: 80px;\
		}\
		#gNav ul ul a, #gNav ul ul div, #gNav ul ul input[type='button'] {\
			font-size: smaller;\
		}\
		#gNav ul ul a, #gNav ul ul div {\
			text-indent: 0 !important; text-decoration: none; color: #ffffff; background: #1a1a1a !important; border-bottom: 1px solid silver; margin-bottom: 2px; padding: 4px 2px 0 !important; width: auto !important; height: 1.6em !important;\
		}\
		#gNav ul ul a:hover, #gNav ul ul div:hover {\
			cursor:pointer; text-decoration: underline; background-color: #000000 !important;\
		}\
		ul.ro_ch > li {position: relative;}\
		#gNav > ul > li:hover > ul > li:hover > ul, #gNav ul.ro > li:hover > ul.ro_ch  > li:hover > ul{\
			display: block !important;\
		}\
		ul.ro_ch2 > ul {position: relative;}\
		#gNav > ul > li:hover > ul > li:hover > ul, #gNav ul.ro > li:hover > ul.ro_ch  > li:hover > ul{\
			display: block !important;\
		}\
	");
}
//end

//--------------------------------
// 出兵予約
//--------------------------------
function Reservation(){
	if (!location.pathname.match("/facility/")) {
   		return ;
	}

function delate2(){
   if(document.getElementById){
	  var obj = document.getElementById("test");
	  obj.innerHTML = "";
}}

function addOpenLinkHtml() {
	var container;
	var sidebar = document.evaluate('//*[@id="test"]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	if (sidebar.snapshotLength == 0) {
		container = document.body;
	} else {
		container = sidebar.snapshotItem(0);
	}

	var linksDiv = document.createElement("div");
	container.appendChild(linksDiv);
	var openLink = document.createElement("a");
	openLink.id = "timerOpenLink";
	openLink.href = "javascript:void(0);";
	openLink.innerHTML = "<span style=\"color: #0099CC;\">出発時刻をコピー</span><img src=\"/20091126-01/img/common/icon_link.gif\" id=\"test2\" style=\"cursor:pointer;\">";
	openLink.addEventListener("click", function() {displayTroop()}, true);
	linksDiv.appendChild(openLink);

}

executeTroop = function()
{
	var btn = window.document.getElementById("btn_send");
	btn.click();
}



displayTroop = function()
{
delate2();
	var obj = window.document.getElementById("test");
	var num = null;

	if(document.getElementById("beyond_send_time").firstChild){
var tt 	= document.getElementById("beyond_send_time").firstChild.nodeValue;

	var day2 = eval(tt.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/));
	if( !day2 ) return ;


	var html = "";

	html += '<strong>【出兵予約】</strong> ';
	html += '<select id="autoTroop_HH"><option value="">' + day2[4];
	html += '</option>';
   for ( var i=0; i < 24; i++) {
		html += '<option value="' + i + '">' + i +'</option>';
	}
	html += '</select>';
	html += '時';
	html += '<select id="autoTroop_MM"><option value="">' + day2[5];
	html += '</option>';
	for ( var i=0; i < 60; i++) {
		html += '<option value="' + i + '">' + i +'</option>';
	}
	html += '</select>';
	html += '分';
	// 秒の指定
	html += '<select id="autoTroop_SS"><option value="">' + day2[6];
	html += '</option>';
	for ( var i=0; i < 60; i++) {
		html += '<option value="' + i + '">' + i +'</option>';
	}
	html += '</select>';
	html += '秒';
	html += '<span id="autoTroop_hms" style="">に自動的に出兵ボタンを押します(最終チェック--時--分)</span>';
	obj.innerHTML +=  ''+ html;

		addOpenLinkHtml();

	// 0.5秒間隔でチェックする
	window.setInterval(function(){ checkTroopTime() } , 0.5 * 1000);


	}
	else{
		var html = "";

	html += '<strong>【出兵予約】</strong> ';
	html += '<select id="autoTroop_HH"><option value="">--</option>';
   for ( var i=0; i < 24; i++) {
		html += '<option value="' + i + '">' + i +'</option>';
	}
	html += '</select>';
	html += '時';
	html += '<select id="autoTroop_MM"><option value="">--</option>';
	for ( var i=0; i < 60; i++) {
		html += '<option value="' + i + '">' + i +'</option>';
	}
	html += '</select>';
	html += '分';
	// 秒の指定
	html += '<select id="autoTroop_SS"><option value="">--</option>';
	for ( var i=0; i < 60; i++) {
		html += '<option value="' + i + '">' + i +'</option>';
	}
	html += '</select>';
	html += '秒';
	html += '<span id="autoTroop_hms" style="">に自動的に出兵ボタンを押します(最終チェック--時--分)</span>';
	obj.innerHTML +=  ''+ html;

			addOpenLinkHtml();

		// 0.5秒間隔でチェックする
	window.setInterval(function(){ checkTroopTime() } , 0.5 * 1000);



}
}

checkTroopTime = function() {
		var tetete = window.document.getElementById("autoTroop_HH").value;
		if(document.getElementById("beyond_send_time").firstChild && tetete >= -1){
			var tt 	= document.getElementById("beyond_send_time").firstChild.nodeValue;
			var day2 = eval(tt.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/));
			if( !day2 ) return ;
			var h = eval(day2[4]);
			var m = eval(day2[5]);
			var s = eval(day2[6]);
			var h2 = (h+100).toString().substr(-2);
			var m2 = (m+100).toString().substr(-2);
			var s2 = (s+100).toString().substr(-2);

			// 現在時刻取得
			var now = new Date();
			now_h = now.getHours();
			now_m = now.getMinutes();
			now_s = now.getSeconds();
			now_h2 = (now_h+100).toString().substr(-2);
			now_m2 = (now_m+100).toString().substr(-2);
			now_s2 = (now_s+100).toString().substr(-2);
			if ( h == now_h && m == now_m && s <= now_s ) {
				executeTroop();
			}
		}

		var h = eval(window.document.getElementById("autoTroop_HH").value);
		var m = eval(window.document.getElementById("autoTroop_MM").value);
		var s = eval(window.document.getElementById("autoTroop_SS").value);

		var h2 = (h+100).toString().substr(-2);
		var m2 = (m+100).toString().substr(-2);
		var s2 = (s+100).toString().substr(-2);

		// 現在時刻取得
		var now = new Date();
		now_h = now.getHours();
		now_m = now.getMinutes();
		now_s = now.getSeconds();
		now_h2 = (now_h+100).toString().substr(-2);
		now_m2 = (now_m+100).toString().substr(-2);
		now_s2 = (now_s+100).toString().substr(-2);
		if ( h == now_h && m == now_m && s <= now_s ) {
			executeTroop();
		}
		if(document.getElementById("beyond_send_time").firstChild){
			var tt 	= document.getElementById("beyond_send_time").firstChild.nodeValue;
			var day2 = tt.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/);
			if( !day2 ) return ;
			var toh = (day2[4] * 60 * 60) + (day2[5] * 60) + (day2[6]*1);
			var nowh = (now_h * 60 * 60) + (now_m * 60) + now_s;
			var sasihiki = (toh - nowh);
			if((toh - nowh)>10800){
				var html3 = "3jigann";
				if ( h != "--" && m != "--" && s != "--") {
					var obj = window.document.getElementById("autoTroop_hms");
					obj.innerHTML = "に自動的に出兵ボタンを押します(最終チェック" + now_h + "時" + now_m + "分)<br><span style=\"color: #CC0000;\">注意!!3時間を越えています</span>";
				}
			} else {
				var obj = window.document.getElementById("autoTroop_hms");
				if ( h != "--" && m != "--" && s != "--") {
					obj.innerHTML = "に自動的に出兵ボタンを押します(最終チェック" + now_h + "時" + now_m + "分)";
				}
			}
		}
	}

	var title = window.document.title;
		var obj2 = window.document.getElementById("gray02Wrapper");

	if ( title.indexOf("出兵(確認) - ブラウザ三国志") != -1 ) {
		var html2 = "";
		html2 += "<div id=\"test\" style=\"text-align:center;  border:3px #000 solid;padding:6px;-moz-border-radius: 10px;-webkit-border-radius: 10px;border-radius: 10px;\">";
		html2 += "</div>";
		var newObj = document.createElement("p");
		newObj.innerHTML = html2;
		obj2.parentNode.insertBefore(newObj, obj2.nextSibling);
		addOpenLinkHtml();

		// 表示切り替え
		window.setTimeout(function() { displayTroop();}, 3000);

	}


	else {
	  // 出兵確認画面でなければ何もしない
	}
}
//faraway 30.出兵予約のソース(.user.js)終了　　//ac.30　ここまで

//---------------------------------------
// オートビルダー
//---------------------------------------
function disp_bro3auto() {
	var doc = document.evaluate('//img[@alt="歴史書"]', document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	if( doc.snapshotLength > 0 ){
		return;
	}

	//君主プロフィール画面なら都市画面URLを取得
	if ((location.pathname == "/user/" || location.pathname == "/user/index.php") &&
		getParameter_17("user_id") == "") {
		getUserProf_17();
	}
	var villages = loadVillages_17(HOST_17+PGNAME_17);
	//拠点画面なら対象建築物の建築チェック
	if (location.pathname == "/village.php" ) {
		//チュートリアル実施中は、市場・内政・寄付の動作停止
		if(document.getElementsByClassName("gnavi07").length==0 && document.getElementsByClassName("gnavi07new").length==0 ){
			setVillageFacility();
			ichibaChange();		//市場処理
			autoDonate();		//自動寄付処理
			Auto_Domestic();	//自動内政処理 by nottisan
		} else {
			var vID = "";
			//座標を取得
			var xyElem = document.evaluate('//*[@id="basepoint"]/span[@class="xy"]',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
			vId = trim_17(xyElem.snapshotItem(0).innerHTML);
		}
		forwardNextVillage();
	}else{

		if(location.pathname != "/facility/castle_send_troop.php"){
			var vURL = villages[0][IDX_URL_17];
			var tid=setTimeout(function(){location.href = vURL;},1800000);
		}
		clearInterval(tidMain2);
		clearTimeout(tidMain2);


	}
	addOpenLinkHtml_17();
}
function setVillageFacility() {

	var cnt=0;
	var vID = "";
	//座標を取得
	var xyElem = document.evaluate('//*[@id="basepoint"]/span[@class="xy"]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	vId = trim_17(xyElem.snapshotItem(0).innerHTML);
	if( typeof(getVillageID(vId)) == 'undefined' ){
		// 拠点情報が保存されていなかった場合何もしない
		return;
	};

	//建設情報を取得
	var actionsElem = document.evaluate('//*[@id="actionLog"]/ul/li',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);

	for (var i = 0; i < actionsElem.snapshotLength; i++) {
		var paItem = actionsElem.snapshotItem(i);
		//ステータス
		var buildStatusElem = document.evaluate('./span[@class="buildStatus"]/a',
			paItem, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		if (buildStatusElem.snapshotLength > 0) {
			for(var j=0; j<buildStatusElem.snapshotLength;j++){
				if(buildStatusElem.snapshotItem(j).parentNode.innerHTML.match(RegExp("(建設中|建設準備中)"))) {
					//施設建設数
					cnt++;
				}
			}
		}
	}

	Load_OPT(vId);	//LvUP対象の取得

	//建設予約ができるかどうか
	if(cnt >= 1) return;
	//if(cnt == 2) return;

	if(OPT_KATEMURA == 1) {
		var area_all = new Array();
		area_all = get_area_all();
		var hatake = 0; //畑の総数
		var souko = 0; //倉庫の総数
		var suzume = 0; //雀の総数
		var heichi = 0; //平地の総数
		var suzume_Flag = 0;
		var n = -1;
		for(var i=0;i < area_all.length;i++){
			if(area_all[i].name == "平地"){heichi++;n=i;}
			else if(area_all[i].name.match(/畑\s.*?(\d+)/)){hatake++;if(parseInt(RegExp.$1)>=5){suzume_Flag=1;}}
			else if(area_all[i].name.match(/倉庫/)){souko++;}
			else if(area_all[i].name.match(/銅雀台/)){suzume++;}
		}


		if(heichi>0){ //平地が余っていたら
			var tmp = heichi;
			if(suzume != 1){ //雀がまだ建っていなければ
				tmp -= 1; //平地の数をマイナス1
			}
			if(souko < OPT_SOUKO_MAX){ //倉庫がまだ最大数建っていなければ
				tmp -= (OPT_SOUKO_MAX - souko); //平地の数をマイナス]
			}
			if(tmp > 0){ //それでも平地が余っていれば
				if(Chek_Sigen(new lv_sort("畑",0,"")) != 1){ //資源チェック
					createFacility(HATAKE, area_all); //畑を建てる
					Reload_Flg = 0;
					return;
				};
			} else if(souko < OPT_SOUKO_MAX){ //倉庫が建てられる平地があれば
				if(Chek_Sigen(new lv_sort("倉庫",0,"")) != 1){ //資源チェック
					createFacility(SOUKO, area_all); //倉庫を建てる
					Reload_Flg = 0;
					return;
				}
			} else if(suzume != 1 && suzume_Flag == 1){ //雀がまだ建っていなければ
				if(Chek_Sigen(new lv_sort("銅雀台",0,"")) != 1){ //資源チェック
					createFacility(SUZUME, area_all); //雀を建てる
					Reload_Flg = 0;
					return;
				}
			}
		}
	}

	var area = new Array();
	area = get_area();

	area.sort(cmp_lv);
	var Reload_Flg = 0;
	for(i=0;i<area.length;i++){
		var tmpName1 = area[i].name;
		switch (tmpName1) {
			case "村":
			case "城":
			case "砦":
				tmpName1  = "拠点";			  //chkFlg = 1;
				break;
		}
		if(parseInt(area[i].lv) >= parseInt(OPT_CHKBOXLV[OPT_FNID[tmpName1]])){continue;} //指定Lv以上ならメインに戻る

		//建築物名分回す
		//村・城を追加
		OPT_FUC_NAME.push("村","城","砦");
		if(OPT_CHKBOX[0] == 1) {
			OPT_CHKBOX.push(1,1,1);
		} else {
			OPT_CHKBOX.push(0,0,0);
		}
		OPT_CHKBOX.push
		for(var ii=0;ii<OPT_FUC_NAME.length;ii++){
			//ソートしたLvの低い順に比較する
			if(area[i].name == OPT_FUC_NAME[ii]){
				//建築指示が有るか確認する。
				if(parseInt(OPT_CHKBOX[ii]) == 1){
					//建築に必要な資源が有るかどうかチェック
					var ret = Chek_Sigen(area[i]);
					if(ret == 1){
						//30分後にリロードするかどうか
						Reload_Flg = 1;
						break;
					}

					Reload_Flg = 0;
					var Temp = area[i].xy.match(/(-?[0-9]+),(-?[0-9]+)[^0-9]*/);
					hiro_lvupfacility(RegExp.$1,RegExp.$2,vId);
					return;
				}
			}
		}
	}

	if(Reload_Flg == 1){
		tidMain =setTimeout(function(){location.reload();},600000);
	}

}

//施設一覧取得
function get_area(){
	var results = document.evaluate('//area', document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	var area = new Array();
	for(var i=0,n=0; i<results.snapshotLength; i++){
		if(results.snapshotItem(i).alt.match(/(.*?)\s.*?(\d+)/)){
			var strURL = results.snapshotItem(i).href;
			area[n] = new lv_sort(RegExp.$1,RegExp.$2,getURLxy(strURL));
			n++;
		}
	}
	return area;
}

function get_area_all(){
	var results = document.evaluate('//area', document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	var area = new Array();
	for(var i=0,n=0; i<results.snapshotLength; i++){
		var strURL = results.snapshotItem(i).href;
		area[n] = new areas_17(results.snapshotItem(i).alt,getURLxy(strURL));
		//alert(area[n].xy + ":" + area[n].name);
		n++;
	}
	return area;
}

//施設建設
function createFacility(f, area){
	area.sort(cmp_areas);
	for(var i=0;i<area.length;i++){
		if(area[i].name == "平地"){ //一番最初に見つかった平地に建設
			var Temp = area[i].xy.match(/(-?[0-9]+),(-?[0-9]+)[^0-9]*/);
			hiro_buildfacility(f,RegExp.$1,RegExp.$2,vId);
			return;
		}
	}
}

function areas_17(name,xy){
	this.name = name;
	this.xy = xy;
}

//比較する関数
function cmp_areas(a,b){
	if(a.xy > b.xy){return 1;} else {return -1;}
}

// 次拠点移動
function forwardNextVillage() {

	loadAVCBox();

	if(OPT_CHKBOX_AVC) {
		var vcURL = nextVillageURL(getVillageID(vId));

		// 巡回時間→1分×入力値に設定 by 霧
		var RoundTime = OPT_CHKBOX_AVC * 60000;

		console.log(location.hostname + " 移動=" +vcURL);
		if(vcURL!=undefined){
			tidMain2 = setTimeout(mvURL,RoundTime,vcURL);
		}
	}
}
function mvURL(tURL){
	//ビルダー設定画面が開いてる間は巡回しない。
	if (document.getElementById("ABContainer") != undefined){
		tidMain2 = setTimeout(mvURL,OPT_CHKBOX_AVC * 60000,tURL);
		return;
	}
	location.href = tURL;
}
// 次拠点URL取得
function nextVillageURL(vId2){
	var villages = loadVillages_17(HOST_17+PGNAME_17);
	var nextIndex = 0;
	var chkNextVID = new Array();
	for(var i=0; i<villages.length;i++){

		var tChk1 = GM_getValue(HOST_17+PGNAME_17+"OPT_CHKBOX_AVC_"+i, true);

		if(tChk1==true){
			chkNextVID.push(villages[i][IDX_URL_17]);
		}
	}

	// 現在の拠点のインデックスを検索
	for(var i=0; i<chkNextVID.length;i++){
		var url = chkNextVID[i];
		if(vId2 == getParameter2_17(chkNextVID[i], "village_id")){
			if(i+1 < chkNextVID.length){
				nextIndex = i+1;
			}else{
				nextIndex = 0;
			}

			break;
		}
	}

	return chkNextVID[nextIndex];
}


// URLパラメタ取得
function getParameter2_17(url, key) {
	var str = url.split("?");
	if (str.length < 2) {
		return "";
	}

	var params = str[1].split("&");
	for (var i = 0; i < params.length; i++) {
		var keyVal = params[i].split("=");
		if (keyVal[0] == key && keyVal.length == 2) {
			return decodeURIComponent(keyVal[1]);
		}
	}
	return "";
}



//建築物の格納用
function lv_sort(name,lv,xy){
	this.name = name;
	this.lv = lv;
	this.xy = xy;
}
//比較する関数
function cmp_lv(a,b){
	return a.lv - b.lv;
}
//拠点IDの取得
function getVillageID(vId){
	//villages
	var villages = loadVillages_17(HOST_17+PGNAME_17);
	for(var i=0; i<villages.length;i++){
		if(villages[i][IDX_XY_17] == vId){
			var vURL = villages[i][IDX_URL_17];
			var temp = vURL.split("?");
			var temp2 = temp[1].split("=");
			return temp2[1];
		}
	}
}
function getURLxy(strURL){
	if(strURL == ""){ return "";}
	var strTemp = "";
	strTemp = strURL;
	var Temp = strTemp.split("?");
	var Temp2 = Temp[1].split("&");
	var Temp3 = Temp2[0].split("=");
	var Temp4 = Temp2[1].split("=");
	return Temp3[1] + "," +Temp4[1];
}

//リンクHTML追加
function addOpenLinkHtml_17() {
	var sidebar = d_17.evaluate('//*[@id="supportNavi"]', d_17, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);//ﾛｺﾞfaraway1100524

	if (sidebar.snapshotLength == 0) {
		sidebar = d_17.evaluate('//*[@class="sideBox"]',d_17, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	if (sidebar.snapshotLength == 0) return;
		isMixi_17 = false;

	}

	var openLink = d_17.createElement("a");
	openLink.id = "Auto_Bilder";
	openLink.href = "javascript:void(0);";
	openLink.innerHTML = "AutoBilder";	//ﾛｺﾞfaraway110524
	openLink.style.color = "#FFD700";	//ﾛｺﾞfaraway110524
	openLink.style.fontWeight = "bold";	//ﾛｺﾞfaraway110524

	// mixi鯖判定
	openLink.addEventListener("click", function() {openIniBilderBox()}, true);
	sidebar.snapshotItem(0).appendChild(openLink);

	// ---- 資源の桁数が増えた時の改行防止 ----
	sidebar.snapshotItem(0).style.width = "Auto";

}

//建築設定画面を開く
function openIniBilderBox() {
	closeIniBilderBox();
	addIniBilderHtml();
}

//建築設定画面を閉じる
function closeIniBilderBox() {
	deleteIniBilderHtml();
	deleteIniBilderFrameHtml();
}
//建築対象拠点表示HTML削除
function deleteIniBilderHtml() {
	var elem = d_17.getElementById("ABContainer");
	if (elem == undefined) return;
	d_17.body.removeChild(d_17.getElementById("ABContainer"));
}
//建築対象拠点表示HTML削除
function deleteIniBilderFrameHtml() {
	var elem = d_17.getElementById("ABContainer");
	if (elem == undefined) return;
	d_17.body.removeChild(document.getElementById("ABContainer"));
}

//LvUP対象施設設定画面を開く
function openInifacBox(vId) {
	closeInifacBox();
	addInifacHtml(vId);
}
///LvUP対象施設設定画面を閉じる
function closeInifacBox() {
	deleteInifacHtml();
	deleteInifacFrameHtml();
}

///LvUP対象施設設のチェックボックスをクリアする
function clearInifacBox() {
	var checkbox = $a_17('//input[@type="checkbox"]');
	for(var i= 0;i < checkbox.length; i++) {
		checkbox[i].checked = false;
	}
}

//建築対象施設表示HTML削除
function deleteInifacHtml() {
	var elem = d_17.getElementById("ABfacContainer");
	if (elem == undefined) return;
	d_17.body.removeChild(d_17.getElementById("ABfacContainer"));
}
//建築対象施設表示HTML削除
function deleteInifacFrameHtml() {
	var elem = d_17.getElementById("ABfacContainer");
	if (elem == undefined) return;
	d_17.body.removeChild(document.getElementById("ABfacContainer"));
}

//ステイタス取得HTML追加
function addIniBilderHtml() {

	var popupLeft = 50;
	var popupTop = 160;

	if(OPT_STYLE = "0") { //ac.39
		popupLeft = 50;
		popupTop = 250;
	}  //ac.39

	if(!isMixi_17) {
		popupLeft = 50;
		popupTop = 400;
	}

	//表示コンテナ作成
	var ABContainer = d_17.createElement("div");
	ABContainer.id = "ABContainer";
	ABContainer.style.position = "absolute";
	ABContainer.style.color = "white";
	ABContainer.style.backgroundColor = "#333333";
	ABContainer.style.backgroundColor = "#666666";//win風のグレー基調faraway110524
	ABContainer.style.border = "solid 2px black";
	ABContainer.style.border = "outset 2px darkgray";//win風のグレー基調faraway110524
	ABContainer.style.left = popupLeft + "px";
	ABContainer.style.top = popupTop + "px";
	ABContainer.style.fontSize = "10px";
	ABContainer.style.padding = "3px";
	ABContainer.style.zIndex = 999;
	d_17.body.appendChild(ABContainer);

	$e_17(ABContainer, "mousedown", function(event){
				if( event.target != $_17("ABContainer")) {return false;}
				g_MD_17="ABContainer";
				g_MX=event.pageX-parseInt(this.style.left,10);
				g_MY=event.pageY-parseInt(this.style.top,10);
				event.preventDefault();});
	$e_17(d_17, "mousemove", function(event){
				if(g_MD_17 != "ABContainer") return true;
				var ABContainer = $_17("ABContainer");
				if( !ABContainer ) return true;
				var x = event.pageX - g_MX;
				var y = event.pageY - g_MY;
				ABContainer.style.left = x + "px";
				ABContainer.style.top = y + "px";
				});
	$e_17(d_17, "mouseup", function(event){g_MD_17="";});

	//バージョン
	var version = d_17.createElement("span");
	version.style.color = "white";
	version.style.fontSize = "10px";
	version.style.margin = "3px";
	version.innerHTML = "Auto Bilder v" + VERSION_17;
	ABContainer.appendChild(version);

	//拠点設定リンクの作成
	var tbl = d_17.createElement("table");
	tbl.style.border = "solid 1px #FFDE49";
	tbl.style.border ="0px";//win風のグレー基調faraway110524

	//拠点情報のロード
	var villages = loadVillages_17(HOST_17+PGNAME_17);
	var vId2;

	//拠点情報が無い場合
	if(villages.length == 0){
		var tr = d_17.createElement("tr");
		var td = d_17.createElement("td");
		td.style.padding = "3px";
		td.style.verticalAlign = "top";
		td.style.border = "outset 2px black";//win風のグレー基調faraway110524
		tr.appendChild(td);
		tbl.appendChild(tr);
		var msg = d_17.createElement("span");
		msg.style.fontSize = "15px";
		msg.style.margin = "3px";//win風のグレー基調faraway110524
		msg.innerHTML = "インストールありがとうございます。<br>" +
						"まずは、プロフィール画面を開いて<br>" +
						"拠点情報を取得してください。";
		td.appendChild(msg);
	} else {
		var landElems = document.evaluate('//li[@class="on"]/span', document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		//console.log(landElems.snapshotItem(0).innerHTML);

		for (var i = 0; i < villages.length; i++) {
			var vname = villages[i][IDX_BASE_NAME_17];
			var fColor = "aqua";//win風のグレー基調faraway110524
			if(landElems.snapshotItem(0) && landElems.snapshotItem(0).innerHTML!=vname) fColor="white";
			if(!landElems.snapshotItem(0)) fColor="white";
			var tr = d_17.createElement("tr");
			var td = d_17.createElement("td");
			td.style.padding = "3px";
			td.style.verticalAlign = "top";
			td.style.border = "outset 2px black";//win風のグレー基調faraway110524
			tr.appendChild(td);
			tbl.appendChild(tr);
			tbl.style.width = "140px";

			//各拠点の設定画面リンク
			var vname = villages[i][IDX_BASE_NAME_17];
			vId2 = villages[i][IDX_XY_17];

			var td00 = d_17.createElement("div");

			var tdA = d_17.createElement("td");
			tdA.style.padding = "3px";
			tdA.style.verticalAlign = "top";

			ccreateCheckBox0(td00, "OPT_CHKBOX_AVC_"+i, loadAVCBox2(i), "","5分毎に拠点を巡回する場合はチェックをしてください。",0);

			var opfacLink = d_17.createElement("a");
			opfacLink.id = "vireLink" + villages[i][IDX_XY_17];
			opfacLink.href = "javascript:void(0);";
			opfacLink.style.margin = "3px";
			opfacLink.style.color = fColor;
			opfacLink.innerHTML = villages[i][IDX_BASE_NAME_17];

			opfacLink.setAttribute('vId', villages[i][IDX_XY_17]);
			opfacLink.addEventListener("click", function() { var vId = this.getAttribute('vId'); openInifacBox(vId);}, true);
			td00.appendChild(opfacLink);
			td.appendChild(td00);
			tr.appendChild(td);
		}
	}

	ABContainer.appendChild(tbl);

	var tbl3 = d_17.createElement("table");
	tbl3.style.border ="0px";

	var tr3 = d_17.createElement("tr");
	var td4 = d_17.createElement("td");
	td4.style.padding = "3px";
	td4.style.verticalAlign = "top";

	var trA = d_17.createElement("tr");
	var tdA = d_17.createElement("td");
	tdA.style.verticalAlign = "top";

	// ---- 拠点巡回設定 ---- by 霧
	var rnd = d_17.createElement("div");
	rnd.style.color = "#E86D61";
	tdA.appendChild(rnd);

	loadAVCBox();
	ccreateTextBox_17(rnd, "OPT_CHKBOX_AVC", OPT_CHKBOX_AVC, "拠点巡回/分 ","設定時間×1分で拠点巡回する。", 4, 0);

	// ---- 資源貯蓄設定 ---- by 霧
	var reso = d_17.createElement("div");
	reso.innerHTML = "資源貯蓄";
	reso.style.padding = "2px";
	tdA.appendChild(reso);

	ccreateTextBox_17(reso, "OPT_CHKBOX_W", OPT_CHKBOX_W, "木 ","自動建築で貯蓄値分は確保しておく。", 8, 3);
	ccreateTextBox_17(reso, "OPT_CHKBOX_S", OPT_CHKBOX_S, "石 ","自動建築で貯蓄値分は確保しておく。", 8, 3);
	ccreateTextBox_17(reso, "OPT_CHKBOX_I", OPT_CHKBOX_I, "鉄 ","自動建築で貯蓄値分は確保しておく。", 8, 3);
	ccreateTextBox_17(reso, "OPT_CHKBOX_R", OPT_CHKBOX_R, "糧 ","自動建築で貯蓄値分は確保しておく。", 8, 3);

	trA.appendChild(tdA);
	tbl3.appendChild(trA);

	var trB = d_17.createElement("tr");
	var tdB = d_17.createElement("td");

	ccreateButton_17(tdB, "保存", "設定内容を保存します", function() {

		for (var i = 0; i < villages.length; i++) {
			saveAVCBox();
			GM_setValue(HOST_17+PGNAME_17+"OPT_CHKBOX_AVC_" + i, document.getElementById('OPT_CHKBOX_AVC_' + i).checked);
			console.log("巡回時間 " + OPT_CHKBOX_AVC);
			console.log("保存 " + i + " : "  + document.getElementById('OPT_CHKBOX_AVC_' + i).checked);
		}
		tidMain=setTimeout(function(){location.reload();},INTERVAL_17);
	});

	ccreateButton_17(tdB, "閉じる", "ウインドウを閉じます", function() { closeIniBilderBox()} );

	trB.appendChild(tdB);
	tbl3.appendChild(trB);
	ABContainer.appendChild(tbl3);

}

// 拠点巡回読込
function loadAVCBox(){
	OPT_CHKBOX_AVC = parseInt(GM_getValue(HOST_17+PGNAME_17+"AVC", ""));
	if(isNaN(OPT_CHKBOX_AVC)) OPT_CHKBOX_AVC = 0;
	// 資源貯蓄読読込 by 霧
	OPT_CHKBOX_W = parseInt(GM_getValue(HOST_17+PGNAME_17+"AVC_W", ""));
	if(isNaN(OPT_CHKBOX_W)) OPT_CHKBOX_W = 0;
	OPT_CHKBOX_S = parseInt(GM_getValue(HOST_17+PGNAME_17+"AVC_S", ""));
	if(isNaN(OPT_CHKBOX_S)) OPT_CHKBOX_S = 0;
	OPT_CHKBOX_I = parseInt(GM_getValue(HOST_17+PGNAME_17+"AVC_I", ""));
	if(isNaN(OPT_CHKBOX_I)) OPT_CHKBOX_I = 0;
	OPT_CHKBOX_R = parseInt(GM_getValue(HOST_17+PGNAME_17+"AVC_R", ""));
	if(isNaN(OPT_CHKBOX_R)) OPT_CHKBOX_R = 0;
}

function loadAVCBox2(tVID){
	//OPT_CHKBOX_AVC = parseInt(GM_getValue(HOST_17+PGNAME_17+"AVC"+"_"+tVID, ""));
	OPT_CHKBOX_AVC = GM_getValue(HOST_17+PGNAME_17+"OPT_CHKBOX_AVC_" + tVID, true);
	return OPT_CHKBOX_AVC;
}

// 拠点巡回保存
function saveAVCBox(){
	OPT_CHKBOX_AVC = cgetTextBoxValue_17($_17("OPT_CHKBOX_AVC"));
	GM_setValue(HOST_17+PGNAME_17+"AVC", OPT_CHKBOX_AVC);
	// 資源貯蓄保存 by 霧
	OPT_CHKBOX_W = cgetTextBoxValue_17($_17("OPT_CHKBOX_W"));
	GM_setValue(HOST_17+PGNAME_17+"AVC_W", OPT_CHKBOX_W);
	OPT_CHKBOX_S = cgetTextBoxValue_17($_17("OPT_CHKBOX_S"));
	GM_setValue(HOST_17+PGNAME_17+"AVC_S", OPT_CHKBOX_S);
	OPT_CHKBOX_I = cgetTextBoxValue_17($_17("OPT_CHKBOX_I"));
	GM_setValue(HOST_17+PGNAME_17+"AVC_I", OPT_CHKBOX_I);
	OPT_CHKBOX_R = cgetTextBoxValue_17($_17("OPT_CHKBOX_R"));
	GM_setValue(HOST_17+PGNAME_17+"AVC_R", OPT_CHKBOX_R);
	tidMain =setTimeout(function(){location.reload();},INTERVAL_17);
}
function saveAVCBox2(tVID,flg){
	GM_setValue(HOST_17+PGNAME_17+"AVC"+"_"+tVID, flg);
	tidMain=setTimeout(function(){location.reload();},INTERVAL_17);
}

//施設建設必要資源読込
function loadFacility(){
}

//施設建設必要資源保存
function saveFacility(f){
}

//ステイタス取得HTML追加
function addInifacHtml(vId) {

	var popupLeft = 150;
	var popupTop = 190;


	if(OPT_STYLE = "0") { //ac.39
		popupLeft = 150;
		popupTop = 280;
	}  //ac.39

	if(!isMixi_17) {
		popupLeft = 150;
		popupTop = 160;
	}

	//表示コンテナ作成
	var ABfacContainer = d_17.createElement("div");
	ABfacContainer.id = "ABfacContainer";
	ABfacContainer.style.position = "absolute";
	ABfacContainer.style.color = "white";
	ABfacContainer.style.backgroundColor = "#333333";
	ABfacContainer.style.backgroundColor = "#666666";//win風のグレー基調faraway110524
	ABfacContainer.style.border = "solid 2px black";
	ABfacContainer.style.border = "outset 2px darkgray";//win風のグレー基調faraway110524
	ABfacContainer.style.left = popupLeft + "px";
	ABfacContainer.style.top = popupTop + "px";
	ABfacContainer.style.fontSize = "10px";
	ABfacContainer.style.padding = "3px";
	ABfacContainer.style.zIndex = 999;

	ABfacContainer.setAttribute('vId', vId);
	d_17.body.appendChild(ABfacContainer);

	$e_17(ABfacContainer, "mousedown", function(event){
				if( event.target != $_17("ABfacContainer")) {return false;}
				g_MD_17="ABfacContainer";
				g_MX=event.pageX-parseInt(this.style.left,10);
				g_MY=event.pageY-parseInt(this.style.top,10);
				event.preventDefault();});
	$e_17(d_17, "mousemove", function(event){
				if(g_MD_17 != "ABfacContainer") return true;
				var ABfacContainer = $_17("ABfacContainer");
				if( !ABfacContainer ) return true;
				var x = event.pageX - g_MX;
				var y = event.pageY - g_MY;
				ABfacContainer.style.left = x + "px";
				ABfacContainer.style.top = y + "px";
				});
	$e_17(d_17, "mouseup", function(event){g_MD_17="";});

	//入力項目の作成
	var tbl = d_17.createElement("table");
	tbl.style.border ="0px";

	var tr = d_17.createElement("tr");
	var td = d_17.createElement("td");

	td.style.fontSize ="12px";
	td.style.padding = "3px";
	td.style.verticalAlign = "top";
	td.style.border = "outset 2px black";//win風のグレー基調faraway110524

	tr.appendChild(td);
	tbl.appendChild(tr);

	var villages = loadVillages_17(HOST_17+PGNAME_17);
	for (var i = 0; i < villages.length; i++) {
		//表示中の設定対象拠点名の表示
		if(vId == villages[i][IDX_XY_17]){
			td.innerHTML = villages[i][IDX_BASE_NAME_17];
		}
	}
	ABfacContainer.appendChild(tbl);

	Load_OPT(vId);
	var tbl2 = d_17.createElement("table");
	tbl2.style.border ="0px";
	var tr0 = d_17.createElement("tr");
	tr0.style.border = "outset 2px black";
	var td1 = d_17.createElement("td");
	td1.style.padding = "3px";
	td1.style.verticalAlign = "top";
	var td2 = d_17.createElement("td");
	td2.style.padding = "3px";
	td2.style.verticalAlign = "top";
	var td3 = d_17.createElement("td");
	td3.style.padding = "3px";
	td3.style.verticalAlign = "top";
	tr0.appendChild(td1);
	tr0.appendChild(td2);
	tr0.appendChild(td3);
	tbl2.appendChild(tr0);

	ccreateCheckBoxKai2(td1, "OPT_CHKBOX", 0, " 拠点　　　　","中央の城・村・砦のLvを上げます。",0);
	ccreateCheckBoxKai2(td1, "OPT_CHKBOX", 1, " 伐採所　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td1, "OPT_CHKBOX", 2, " 石切り場　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td1, "OPT_CHKBOX", 3, " 製鉄所　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td1, "OPT_CHKBOX", 4, " 畑　　　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td1, "OPT_CHKBOX", 5, " 倉庫　　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td1, "OPT_CHKBOX", 6, " 銅雀台　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td1, "OPT_CHKBOX", 7, " 鍛冶場　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td1, "OPT_CHKBOX", 8, " 防具工場　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td2, "OPT_CHKBOX", 9, " 練兵所　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td2, "OPT_CHKBOX", 10, " 兵舎　　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td2, "OPT_CHKBOX", 11, " 弓兵舎　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td2, "OPT_CHKBOX", 12, " 厩舎　　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td2, "OPT_CHKBOX", 13, " 宿舎　　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td2, "OPT_CHKBOX", 14, " 兵器工房　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td2, "OPT_CHKBOX", 15, " 市場　　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td2, "OPT_CHKBOX", 16, " 訓練所　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td2, "OPT_CHKBOX", 17, " 水車　　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td3, "OPT_CHKBOX", 18, " 工場　　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td3, "OPT_CHKBOX", 19, " 研究所　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td3, "OPT_CHKBOX", 20, " 大宿舎　　　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td3, "OPT_CHKBOX", 21, " 遠征訓練所　","自動でLv上げをする建築物にチェックをしてください。",0);
	ccreateCheckBoxKai2(td3, "OPT_CHKBOX", 22, " 見張り台　　","自動でLv上げをする建築物にチェックをしてください。",0);

	var tbl4 = d_17.createElement("table");
	tbl4.style.border ="0px";
	var tr01 = d_17.createElement("tr");
	tr0.style.border = "solid 1px #FFDE49";
	tr0.style.border = "outset 2px black";//win風のグレー基調faraway110524
	var td11 = d_17.createElement("td");
	td11.style.padding = "3px";
	td11.style.verticalAlign = "top";
	tr01.appendChild(td11);
	tbl4.appendChild(tr01);

	//糧村化
	ccreateCheckBox_17(td11,"OPT_KATEMURA", OPT_KATEMURA, " 糧村化", "この都市を糧村にする。平地に畑・倉庫×4・銅雀台を建てる。",0);
	ccreateTextBox_17(td11,"OPT_SOUKO_MAX", OPT_SOUKO_MAX,"設置する倉庫の数 ","設置する倉庫の数を指定してください。",1,1);

	//市場変換処理用
	ccreateCheckBox_17(td11, "OPT_ICHIBA", OPT_ICHIBA, " 市場自動変換", "この都市で糧の市場自動変換をします。", 0);
	ccreateComboBox_17(td11, "OPT_ICHIBA_PA" , OPT_ICHIBA_PATS, OPT_ICHIBA_PA,
		"変換パターン ","平均変換：糧が一定量になった際に変換指定している一番少ない資源を変換します。   一括変換：糧が一定量になった際に指定してある資源を指定値変換します。   自動割当：少なめの資源を平滑化",5);
	ccreateTextBox_17(td11, "OPT_RISE_MAX", OPT_RISE_MAX, "糧が右の数量になったら変換する ","自動で糧を他の資源に変換し始める量指定します。", 10, 5);
	ccreateTextBox_17(td11, "OPT_TO_WOOD", OPT_TO_WOOD, "　木に変換する糧の量 ","自動で木に変換する糧の量を指定します。", 10, 5);
	ccreateTextBox_17(td11, "OPT_TO_STONE", OPT_TO_STONE, "　石に変換する糧の量 ","自動で石に変換する糧の量を指定します。", 10, 5);
	ccreateTextBox_17(td11, "OPT_TO_IRON", OPT_TO_IRON, "　鉄に変換する糧の量 ","自動で鉄に変換する糧の量を指定します。", 10, 5);

	//自動寄付用
	ccreateCheckBox_17(td11, "OPT_KIFU", OPT_KIFU, " 自動寄付", "この都市に来たら、自動的に寄付します。", 0);
	ccreateTextBox_17(td11, "OPT_RISE_KIFU_MAX", OPT_RISE_KIFU_MAX, "糧が右の数量になったら寄付する ","自動で糧を寄付し始める量指定します。", 10, 5);
	ccreateTextBox_17(td11, "OPT_RISE_KIFU", OPT_RISE_KIFU, "　自動で糧を寄付する量 ","自動で糧を寄付する量指定します。", 10, 5);

	//自動内政用
	ccreateCheckBox_17(td11, "OPT_DOME", OPT_DOME, " 自動内政", "この都市に来たら、自動的に内政スキルを発動します。", 1);

	// Presents
	var Presents = d_17.createElement("div");
	Presents.innerHTML = "Presents by " + credit;
	Presents.style.color = "#3399CC";
	td11.appendChild(Presents);

	var tbl3 = d_17.createElement("table");
	tbl3.style.border ="0px";
	var tr3 = d_17.createElement("tr");
	var td4 = d_17.createElement("td");
	td4.style.padding = "3px";
	td4.style.verticalAlign = "top";
	tr3.appendChild(td4);
	tbl3.appendChild(tr3);

	ccreateButton_17(td4, "保存", "設定内容を保存します", function() {SaveInifacBox(ABfacContainer.getAttribute('vId'))});
	ccreateButton_17(td4, "閉じる", "設定内容を保存せず閉じます", function() {closeInifacBox()});
	ccreateButton_17(td4, "リセット", "設定内容を消去します。", function() {clearInifacBox()});

	ABfacContainer.appendChild(tbl);
	ABfacContainer.appendChild(tbl2);
	ABfacContainer.appendChild(tbl4);
	ABfacContainer.appendChild(tbl3);

}
//拠点単位の設定の保存（XY MAX_LV CheckData)
function SaveInifacBox(vId){
	var i;
	var opt = $_17("OPT_MAX_LV");
	strSave = cgetTextBoxValue_17(opt) + DELIMIT1_17;
	for(i=0; i<=23;i++){
		var opt = $_17("OPT_CHKBOX"+i);
		strSave += cgetCheckBoxValue_17(opt) + DELIMIT2_17;
	}

	//市場変換処理用
	strSave += cgetCheckBoxValue_17($_17("OPT_ICHIBA")) + DELIMIT2_17; //市場で変換するかどうかのフラグ
	strSave += cgetTextBoxValue_17($_17("OPT_RISE_MAX")) + DELIMIT2_17;
	strSave += cgetTextBoxValue_17($_17("OPT_TO_WOOD")) + DELIMIT2_17;
	strSave += cgetTextBoxValue_17($_17("OPT_TO_STONE")) + DELIMIT2_17;
	strSave += cgetTextBoxValue_17($_17("OPT_TO_IRON")) + DELIMIT2_17;

	//糧村化
	strSave += cgetCheckBoxValue_17($_17("OPT_KATEMURA")) + DELIMIT2_17;
	strSave += cgetTextBoxValue_17($_17("OPT_SOUKO_MAX")) + DELIMIT2_17;

	//自動寄付用
	strSave += cgetCheckBoxValue_17($_17("OPT_KIFU")) + DELIMIT2_17; //寄付するかどうかのフラグ
	strSave += cgetTextBoxValue_17($_17("OPT_RISE_KIFU_MAX")) + DELIMIT2_17;
	strSave += cgetTextBoxValue_17($_17("OPT_RISE_KIFU")) + DELIMIT2_17; //自動内政用に修正

	//自動内政用 by nottisan ここから追加
	strSave += cgetCheckBoxValue_17($_17("OPT_DOME")) + DELIMIT2_17; //内政使用するかのフラグ
	strSave += cgetComboBoxValue($_17("OPT_ICHIBA_PA")); //市場での変換パターンフラグ

	GM_setValue(HOST_17+PGNAME_17+vId, strSave);

	var strtSave2  ="";
	for(i=0; i<=23;i++){
		var opt = $_17("OPT_CHKBOXLV"+i);
		strtSave2 += cgetTextBoxValue_17(opt) + DELIMIT2_17;
	}
	GM_setValue(HOST_17+PGNAME_17+vId+"_LV", strtSave2);


}
//拠点単位の設定の読み込み
function Load_OPT(vId){

	var src = GM_getValue(HOST_17+PGNAME_17+vId, "");
	var src2 = GM_getValue(HOST_17+PGNAME_17+vId+"_LV", "");


	if (src == "") return;

	var Temp = src.split(DELIMIT1_17);
	var Temp3 = src2.split(DELIMIT2_17);
	OPT_MAX_LV = Temp[0];
	var Temp2 = Temp[1].split(DELIMIT2_17);

	var i;
	for(i=0; i<=23;i++){
		if(Temp2[i] == ""){return;}
		OPT_CHKBOX[i] = parseInt(Temp2[i]);
	}
	for(i=0; i<=Temp3.length;i++){
		if(Temp3[i] == ""){continue;}
		OPT_CHKBOXLV[i] = parseInt(Temp3[i]);
	}



	//市場変換処理用
	if(Temp2[24] == ""){return;}
	OPT_ICHIBA = parseInt(Temp2[24]);
	OPT_RISE_MAX = parseInt(Temp2[25]);
	OPT_TO_WOOD = parseInt(Temp2[26]);
	OPT_TO_STONE = parseInt(Temp2[27]);
	OPT_TO_IRON = parseInt(Temp2[28]);

	//糧村化
	if(Temp2[29] == ""){return;}
	OPT_KATEMURA = parseInt(Temp2[29]);
	OPT_SOUKO_MAX = parseInt(Temp2[30]);

	//自動寄付
	if(Temp2[31] == ""){return;}
	OPT_KIFU = parseInt(Temp2[31]);
	OPT_RISE_KIFU_MAX = parseInt(Temp2[32]);
	OPT_RISE_KIFU = parseInt(Temp2[33]);

	//自動内政 by nottisan ここから追加
	if(Temp2[34] == ""){return;}
	OPT_DOME = parseInt(Temp2[34]);
	OPT_ICHIBA_PA = Temp2[35];
	//ここまで
	return;
}
//ユーザプロフィール画面の拠点情報を取得
function getUserProf_17() {
	var oldVillages = loadVillages_17(HOST_17+PGNAME_17);
	var newVillages = new Array();
	var landElems = document.evaluate(
		'//*[@id="gray02Wrapper"]//table',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	var src=landElems.snapshotItem(0).innerHTML.replace(/\t/g,"").split("</tr>\n");

	var flag_honkyo=0;
	for(i in src){
		src[i] =src[i].replace(/\n/g,"")
		//本拠地という文字列がでてくるまでスキップ
		if(flag_honkyo==0 && src[i].match(/.*本拠地.*/)){flag_honkyo=1;}
		if(flag_honkyo==0) continue;

		//本拠地以降の行はこっから
		if(src[i].match(/<tr><td[^>]*><a href="([^"]*)">([^<]*)<\/a>[^<]*<\/td><td.*>(-?[0-9]+,-?[0-9]+).*<\/td><td.*>([0-9]+)<\/td>/)) {
			//名前項目を取得
			var name = RegExp.$2;
			var url  = RegExp.$1;
			//座標項目を取得
			var xy = "(" + RegExp.$3 + ")";
			//人口項目を取得
			var popul = RegExp.$4;
			//データマージ
			var newVil = new Array();
			newVil[IDX_ACTIONS_17] = new Array();
			for (var j = 0; j < oldVillages.length; j++) {
				if (xy == oldVillages[j][IDX_XY_17]) {
					newVil = oldVillages[j];
				}
			}
			newVil[IDX_XY_17] = xy;
			newVil[IDX_BASE_NAME_17] = name;
			newVil[IDX_URL_17] = url;
			newVil[IDX_BASE_ID]=getParameter2_17(url, "village_id")
			newVillages.push(newVil);
		}
	}
	//保存
	saveVillages_17(HOST_17+PGNAME_17, newVillages);
}



//拠点情報を保存
function saveVillage_17(newData, type) {
	var allData = loadVillages_17(HOST_17+PGNAME_17);

	//新旧データをマージ
	var exists = false;
	for (var i = 0; i < allData.length; i++) {
		var villageData = allData[i];

		//作業リスト更新
		if (villageData[IDX_XY_17] == newData[IDX_XY_17]) {
			exists = true;
			villageData[IDX_BASE_NAME_17] = newData[IDX_BASE_NAME_17];

			var actions = villageData[IDX_ACTIONS_17];
			for (var j = actions.length - 1; j >= 0; j--) {
				if (actions[j][IDX2_TYPE_17] != type) continue;
				var endTime = new Date(actions[j][IDX2_TIME_17]);
				var nowTime = new Date();
				if (isNaN(endTime.valueOf()) || endTime > nowTime) actions.splice(j, 1);
			}
			villageData[IDX_ACTIONS_17] = actions.concat(newData[IDX_ACTIONS_17]);
		}

		allData[i] = villageData;
	}
	if (!exists) allData.push(newData);

	//Greasemonkey領域へ永続保存
	saveVillages_17(HOST_17+PGNAME_17, allData);
}
//拠点情報を読み出し
function loadVillages_17(hostname) {
	var ret = new Array();

	var src = GM_getValue(hostname, "");
	if (src == "") return ret;

	var villages = src.split(DELIMIT1_17);
	for (var i = 0; i < villages.length; i++) {
		var fields = villages[i].split(DELIMIT2_17);

		ret[i] = new Array();
		ret[i][IDX_XY_17] = fields[IDX_XY_17];
		ret[i][IDX_BASE_NAME_17] = fields[IDX_BASE_NAME_17];
		ret[i][IDX_URL_17] = fields[IDX_URL_17];
		ret[i][IDX_BASE_ID] = fields[IDX_BASE_ID];

		ret[i][IDX_ACTIONS_17] = new Array();
		if (fields[IDX_ACTIONS_17] == "") continue;
		var actions = fields[IDX_ACTIONS_17].split(DELIMIT3_17);
		for (var j = 0; j < actions.length; j++) {
			ret[i][IDX_ACTIONS_17][j] = new Array();
			if (actions[j] == "") continue;

			var item = actions[j].split(DELIMIT4_17);
			if (item[IDX2_TYPE_17] == undefined) item[IDX2_TYPE_17] = "C";

			ret[i][IDX_ACTIONS_17][j][IDX2_STATUS_17] = item[IDX2_STATUS_17];
			ret[i][IDX_ACTIONS_17][j][IDX2_TIME_17] = item[IDX2_TIME_17];
			ret[i][IDX_ACTIONS_17][j][IDX2_TYPE_17] = item[IDX2_TYPE_17];
			ret[i][IDX_ACTIONS_17][j][IDX2_ALERTED_17] = item[IDX2_ALERTED_17];
		}
	}

	return ret;
}
//拠点情報を保存
function saveVillages_17(hostname, newData) {

	//配列をデリミタ区切り文字列に変換
	var newDataStr = new Array();
	for (var i = 0; i < newData.length; i++) {
		var villageData = newData[i];
		var actions = villageData[IDX_ACTIONS_17];

		//配列をデリミタ区切り文字列に変換
		for (var j = 0; j < actions.length; j++) {
			actions[j] = genDelimitString_17(actions[j], DELIMIT4_17);
		}
		villageData[IDX_ACTIONS_17] = genDelimitString_17(actions, DELIMIT3_17);
		newDataStr[i] = genDelimitString_17(villageData, DELIMIT2_17);
	}
	if(newDataStr.length==0){
		return ;
	}
	//Greasemondey領域へ永続保存
	GM_setValue(hostname, genDelimitString_17(newDataStr, DELIMIT1_17));
}

//デリミタ区切り文字列生成
function genDelimitString_17(dataArray, delimiter) {
	var ret = "";
	for (var i=0; i < dataArray.length; i++) {
		if (dataArray[i] != undefined) ret += dataArray[i];
		if (i < dataArray.length-1) ret += delimiter;
	}
	return ret;
}

//URLパラメータ取得
function getParameter_17(key) {
	var str = location.search.split("?");
	if (str.length < 2) {
		return "";
	}

	var params = str[1].split("&");
	for (var i = 0; i < params.length; i++) {
		var keyVal = params[i].split("=");
		if (keyVal[0] == key && keyVal.length == 2) {
			return decodeURIComponent(keyVal[1]);
		}
	}
	return "";
}

//先頭ゼロ付加
function padZero_17(num) {
	var result;
	if (num < 10) {
		result = "0" + num;
	} else {
		result = "" + num;
	}
	return result;
}
//先頭ゼロ除去
function trimZero_17(str) {
	var res = str.replace(/^0*/, "");
	if (res == "") res = "0";
	return res;
}

//空白除去
function trim_17(str) {
	if (str == undefined) return "";
	return str.replace(/^[ 　\t\r\n]+|[ 　\t\r\n]+$/g, "");
}

//数値チェック
function isNumeric_17(num) {
	if (num.match(/^-?[0-9]+$/)) {
		return true;
	}
	return false;
}

//子Element取得
function getChildElement_17(parentNode, position) {
	var current = 0;
	for (var i = 0; i < parentNode.childNodes.length; i++){
		var childNode = parentNode.childNodes[i];
		if (childNode.nodeType == 1) {
			if (current == position) {
				return childNode;
			}
			current++;
		}
	}

	return undefined;
}


//時刻計算（現在時刻に加算、引数hh:mm:ss）
function computeTime_17(clock) {
	var hour = parseInt(trimZero_17(
		clock.replace(/^([0-9]{2}):([0-9]{2}):([0-9]{2})$/, "$1")));
	if (isNaN(hour)) hour = 0;
	var min = parseInt(trimZero_17(
		clock.replace(/^([0-9]{2}):([0-9]{2}):([0-9]{2})$/, "$2")));
	if (isNaN(min)) min = 0;
	var sec = parseInt(trimZero_17(
		clock.replace(/^([0-9]{2}):([0-9]{2}):([0-9]{2})$/, "$3")));
	if (isNaN(sec)) sec = 0;

	var now = new Date();
	var resTime = new Date();
	resTime.setHours(now.getHours() + hour);
	resTime.setMinutes(now.getMinutes() + min);
	resTime.setSeconds(now.getSeconds() + sec);

	return resTime;
}

//日時文字列編集（yyyy/mm/dd hh:mm:ss）
function generateDateString_17(date) {
	var res = "" + date.getFullYear() + "/" + padZero_17(date.getMonth() + 1) +
		"/" + padZero_17(date.getDate()) + " " + padZero_17(date.getHours()) + ":" +
		padZero_17(date.getMinutes()) + ":" + padZero_17(date.getSeconds());
	return res;
}

//日時文字列編集2（mm/dd hh:mm:ss）
function generateDateString2_17(date) {
	var res = "" + padZero_17(date.getMonth() + 1) + "/" + padZero_17(date.getDate()) +
		" " + padZero_17(date.getHours()) + ":" + padZero_17(date.getMinutes()) +
		":" + padZero_17(date.getSeconds());;
	return res;
}

//残時間文字列編集
function generateWaitTimeString_17(time1, time2) {
	var result = "";

	var waitTimeSec = Math.ceil((time1.getTime() - time2.getTime()) / 1000);
	result += Math.floor(waitTimeSec / (60*60));
	result += ":";
	result += padZero_17(Math.floor((waitTimeSec % (60*60)) / 60));
	result += ":";
	result += padZero_17(waitTimeSec % 60);

	return result;
}

function ccreateCheckBoxKai2(container, id, def, text, title, left )
{
	left += 2;
	var dv = d_17.createElement("div");
	dv.style.padding = "2px";
	dv.style.paddingLeft= left + "px";

	dv.title = title;
	var cb = d_17.createElement("input");
	cb.type = "checkbox";
	cb.id = id + def;
	cb.value = 1;
	var def2 = id  + ""  + "[" + def + "]";
	if( eval(def2) ) cb.checked = true;

	var lb = d_17.createElement("label");
	lb.htmlFor = id;

	var tx = d_17.createTextNode(text);
	lb.appendChild( tx );
	var tb = d_17.createElement("input");
	tb.type = "text";
	tb.id = id + "LV" + def;
	tb.value = eval(id	+ "LV"	+ "[" + def + "]");
	tb.size = 2;

	dv.appendChild(cb);
	dv.appendChild(lb);
	dv.appendChild(tb);
	container.appendChild(dv);
	return cb;
}



function ccreateTextBox_17(container, id, def, text, title, size, left )
{
	left += 2;
	var dv = d_17.createElement("div");
	dv.style.padding = "2px";
	dv.style.paddingLeft= left + "px";
	dv.title = title;
	var tb = d_17.createElement("input");
	tb.type = "text";
	tb.id = id;
	tb.value = def;
	tb.size = size;

	var tx = d_17.createTextNode(text);
	tx.title = title;

	dv.appendChild(tx);
	dv.appendChild(tb);
	container.appendChild(dv);
	return tb;
}
function ccreateCheckBox_17(container, id, def, text, title, left )
{
	left += 2;
	var dv = d_17.createElement("div");
	dv.style.padding = "2px";
	dv.style.paddingLeft= left + "px";
	dv.title = title;
	var cb = d_17.createElement("input");
	cb.type = "checkbox";
	cb.id = id;
	cb.value = 1;
	if( def ) cb.checked = true;

	var lb = d_17.createElement("label");
	lb.htmlFor = id;

	var tx = d_17.createTextNode(text);
	lb.appendChild( tx );

	dv.appendChild(cb);
	dv.appendChild(lb);
	container.appendChild(dv);
	return cb;
}
function ccreateCheckBox0(container, id, def, text, title, left )
{
	left += 2;

	var cb = d_17.createElement("input");
	cb.type = "checkbox";
	cb.id = id;
	cb.checked	= def;
	container.appendChild(cb);
	return cb;
}


function ccreateButton_17(container, text, title, func)
{
	var btn = d_17.createElement("input");
	btn.style.padding = "1px";
	btn.type = "button";
	btn.value = text;
	btn.title = title;
	container.appendChild(d_17.createTextNode(" "));
	container.appendChild(btn);
	container.appendChild(d_17.createTextNode(" "));
	$e_17(btn, "click", func);
	return btn;
}

function cgetCheckBoxValue_17(id)
{
	var c = id;
	if( !c ) return 0;
	if( !c.checked ) return 0;
	return 1;
}

function cgetTextBoxValue_17(id)
{
	var c = id;
	if( !c ) return "";
	return c.value;
}
function ccreateComboBox_17(container, id, sels, def, text, title, left )
{
	left += 2;
	var dv = d_17.createElement("div");
	dv.style.padding = "2px";
	dv.style.paddingLeft= left + "px";
	dv.title = title;
	var sel = d_17.createElement("select");
	sel.id = id;
	for(var i=0; i<sels.length; i++){
		var opt = d_17.createElement("option");
		opt.value = sels[i];
		opt.appendChild(d_17.createTextNode(sels[i]));
		sel.appendChild(opt);
	}
	if( def ) sel.value = def;

	var tx = d_17.createTextNode(text);
	tx.title = title;

	dv.appendChild(tx);
	dv.appendChild(sel);
	container.appendChild(dv);
	return sel;
}
function cgetComboBoxValue(id){
	var c = id;
	if( !c ) return "";
	return c.value;
}
function Chek_Sigen(area){
	var costs = getCostTables();

	// 現時の資源値-貯蓄値処理
	//alert(area.name +":" + area.lv +":" +area.xy );
	var RES_NOW = [];
	RES_NOW["wood"] = parseInt( $_17("wood").innerHTML, 10 );
	RES_NOW["stone"] = parseInt( $_17("stone").innerHTML, 10 );
	RES_NOW["iron"] = parseInt( $_17("iron").innerHTML, 10 );
	RES_NOW["rice"] = parseInt( $_17("rice").innerHTML, 10 );

	loadAVCBox();
	RES_NOW.wood -= OPT_CHKBOX_W;
	RES_NOW.stone -= OPT_CHKBOX_S;
	RES_NOW.iron -= OPT_CHKBOX_I;
	RES_NOW.rice -= OPT_CHKBOX_R;

	try {
		if( costs[area.name].length <= parseInt(area.lv) || // maxinum level reached
			RES_NOW.wood < costs[area.name][parseInt(area.lv)][0] ||
			RES_NOW.stone< costs[area.name][parseInt(area.lv)][1] ||
			RES_NOW.iron < costs[area.name][parseInt(area.lv)][2] ||
			RES_NOW.rice < costs[area.name][parseInt(area.lv)][3] ) {
				//建築不可 = 1
				return 1;
		}
	}catch(e) {
		console.log("catched");
	}
	return 0;

}

//市場変換処理
function ichibaChange() {
	if(OPT_ICHIBA != 1) {
		return;
	}

	var ichiba_x = -1; //市場のX座標
	var ichiba_y = -1; //市場のY座標
	var ichiba_lv = -1; //市場のレベル

	var area = new Array();
	area = get_area();

	for(i=0;i<area.length;i++){
		//市場の座標を取得
		if(area[i].name == "市場") {
			var Temp = area[i].xy.split(",");
			ichiba_x = Temp[0];
			ichiba_y = Temp[1];
			ichiba_lv = area[i].lv;
		}
	}

	if(ichiba_x < 0) {
		console.log("市場がありません");
		return;
	}

	var RES_NOW = [];
	RES_NOW["wood"] = parseInt( $_17("wood").innerHTML, 10 );
	RES_NOW["stone"] = parseInt( $_17("stone").innerHTML, 10 );
	RES_NOW["iron"] = parseInt( $_17("iron").innerHTML, 10 );
	RES_NOW["rice"] = parseInt( $_17("rice").innerHTML, 10 );

	//糧が指定量より多いかチェック
	if(RES_NOW["rice"] < OPT_RISE_MAX) {
		console.log("糧が" + OPT_RISE_MAX + "未満");
		return;
	}
	if(OPT_ICHIBA_PATS[0] == OPT_ICHIBA_PA){
		var min_sigen = RES_NOW["wood"];

		if(RES_NOW["stone"] < min_sigen ) { min_sigen = RES_NOW["stone"]; }
		if(RES_NOW["iron"] < min_sigen ) { min_sigen = RES_NOW["iron"]; }

		//糧から他の資源に返還開始
		if((OPT_TO_WOOD > 0) && ( RES_NOW["wood"] == min_sigen )) {
			changeResorceToResorce(RICE, OPT_TO_WOOD, WOOD, ichiba_x, ichiba_y);
		} else if((OPT_TO_STONE > 0) && ( RES_NOW["stone"] == min_sigen )) {
			changeResorceToResorce(RICE, OPT_TO_STONE, STONE, ichiba_x, ichiba_y);
		} else if((OPT_TO_IRON > 0) && ( RES_NOW["iron"] == min_sigen )) {
			changeResorceToResorce(RICE, OPT_TO_IRON, IRON, ichiba_x, ichiba_y);
		}
		return;
	}else{
		if(OPT_ICHIBA_PATS[1] == OPT_ICHIBA_PA) {
			if(OPT_RISE_MAX < OPT_TO_WOOD+OPT_TO_STONE+OPT_TO_IRON){
			}else{
				changeResorceToResorce(RICE, OPT_TO_WOOD, WOOD, ichiba_x, ichiba_y);
				changeResorceToResorce(RICE, OPT_TO_STONE, STONE, ichiba_x, ichiba_y);
				changeResorceToResorce(RICE, OPT_TO_IRON, IRON, ichiba_x, ichiba_y);
			}
			return;
		}else{
			var tmpIdx;
			var tmpNow;
			var tmpRes1 = new Array();
			var tmpRes2 = new Array();
			tmpRes1[0]=RES_NOW["wood"];
			tmpRes1[1]=RES_NOW["stone"];
			tmpRes1[2]=RES_NOW["iron"];
			tmpRes2[0]="wood";
			tmpRes2[1]="stone";
			tmpRes2[2]="iron";
			tmpNow=0;
			for(i=0; i<tmpRes1.length-1; i++) {
				for(j=tmpRes1.length-1; j>i; j--){
					if(tmpRes1[j] < tmpRes1[j-1]){
						tmpIdx = tmpRes2[j];
						tmpNow = tmpRes1[j];
						tmpRes1[j] = tmpRes1[j-1];
						tmpRes1[j-1] = tmpNow;
						tmpRes2[j] = tmpRes2[j-1];
						tmpRes2[j-1] = tmpIdx;
					}
				}
			}
			var ichiba_wariai=[0, 40, 42, 44, 46, 48, 50, 52, 54, 56, 60];
			var wariai = ichiba_wariai[ichiba_lv];

			for(i=0; i<tmpRes1.length - 1; i++) {
				if(i==0){
					var toRes = parseInt( (tmpRes1[2] - tmpRes1[0] ) / ( tmpRes1[0] + tmpRes1[1]  + tmpRes1[2] ) * OPT_RISE_MAX * (1 + 2 / 3));
				}else{
					var toRes = parseInt( (tmpRes1[2] - tmpRes1[1] ) / ( tmpRes1[0] + tmpRes1[1] +	tmpRes1[2] ) * OPT_RISE_MAX * (1 + 1 / 3));
				}
				if(toRes < RES_NOW["rice"] ){
					changeResorceToResorce(RICE, toRes , OPT_TO_CODE[tmpRes2[i]], ichiba_x, ichiba_y);
				}else{
					console.log("エラー" + toRes + " > " + RES_NOW["rice"] );
				}
			}
			return;
		}
	}
}
	// 資源のバランスが悪い場合、少ない資源を優先的に変換する処理
	// 基本的には変換後も現在の最大量を超えない場合に変換を行う。
	// すなわち、量が最大の資源は変換を行わない。

//実変換処理通信部
function changeResorceToResorce(from, tc, to, x, y) {
	var data = "form2=&x=" + x + "&y=" + y + "&change_btn=" + encodeURIComponent("はい") + "&st=1&tf_id=" + from + "&tc=" + tc + "&tt_id=" + to;
	tidMain=setTimeout(function(){
		GM_xmlhttpRequest({
			method:"POST",
			url:"http://" + HOST_17 + "/facility/facility.php",
			headers:{"Content-type":"application/x-www-form-urlencoded"},
			data: data,
			onload:function(x){
								}
		});
	},INTERVAL_17);
}

//自動寄付処理
function autoDonate() {
	if(OPT_KIFU != 1) {
		return;
	}

	//糧が指定量より多いかチェック
	if($_17("rice").innerHTML < OPT_RISE_KIFU_MAX) {
		return;
	}
	sendDonate(OPT_RISE_KIFU);
}

//寄付処理通信部
function sendDonate(rice) {
	var data = "contributionForm=&wood=0&stone=0&iron=0&rice=" + rice + "&contribution=1";
	tidMain=setTimeout(function(){
		GM_xmlhttpRequest({
			method:"POST",
			url:"http://" + HOST_17 + "/alliance/level.php",
			headers:{"Content-type":"application/x-www-form-urlencoded"},
			data: data,
			onload:function(x){ }
		});
	},INTERVAL_17);
}
//内政スキルの使用
function Auto_Domestic() {
	if (!OPT_DOME) {return;} //設定してなければ戻る
	tidMain=setTimeout(function(){
		GM_xmlhttpRequest({
			method:"GET",
			url:"http://" + HOST_17 + "/card/domestic_setting.php",
			headers:{"Content-type":"text/html"},
			overrideMimeType:'text/html; charset=utf-8',
			onload:function(x){

				var htmldoc = document.createElement("html");
				htmldoc.innerHTML = x.responseText;

				var skillElem = document.evaluate('//*[@class="skill"]',htmldoc, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
				if(skillElem.snapshotLength < 1){return;}

				//alert(skillTag);
				for(i=1;i<skillElem.snapshotLength;i++){
					var skillTag = trim_17(skillElem.snapshotItem(i).innerHTML);
					if(	(skillTag.indexOf("知識",0) > 1 )||
						(skillTag.indexOf("技術",0) > 1 )||
						(skillTag.indexOf("呉の治世",0) > 1 )||
						(skillTag.indexOf("王佐",0) > 1 )||
						(skillTag.indexOf("富国",0) > 1 )||
						(skillTag.indexOf("豊穣",0) > 1 )||
						(skillTag.indexOf("美玉歌舞",0) > 1 )||
						(skillTag.indexOf("人選眼力",0) > 1 )||
						(skillTag.indexOf("恵風",0) > 1 )||
						(skillTag.indexOf("賢妃施政",0) > 1 )||
						(skillTag.indexOf("麗妃都政",0) > 1 )||
						(skillTag.indexOf("陳留王政",0) > 1 )||
						(skillTag.indexOf("徳義為政",0) > 1 )||
						(skillTag.indexOf("食糧革命",0) > 1 )

					){
						var link = skillTag.substring(skillTag.indexOf("href=",0)+6,skillTag.indexOf("\"",skillTag.indexOf("href=",0)+7));
						do {
							link = link.replace(/&amp;/,"&");
						}while(link.indexOf("&amp;",0) > 1)
						GM_xmlhttpRequest({
								method:"GET",
								url:"http://" + HOST_17 + link,
								headers:{"Content-type":"text/html"},
								overrideMimeType:'text/html; charset=utf-8',
								onload:function(x){
								}
						});
					}
				}
			}
		});
	},INTERVAL_17);
}

///////////////////////////////////////////////
//Chrome用GM_関数
// @copyright 2009, James Campos
// @license cc-by-3.0; http://creativecommons.org/licenses/by/3.0/
if ((typeof GM_getValue == 'undefined') || (GM_getValue('a', 'b') == undefined)) {
	GM_addStyle = function(css) {
		var style = document.createElement('style');
		style.textContent = css;
		document.getElementsByTagName('head')[0].appendChild(style);
	};

	GM_deleteValue = function(name) {
		localStorage.removeItem(name);
	};

	GM_getValue = function(name, defaultValue) {
		var value = localStorage.getItem(name);
		if (!value)
		return defaultValue;
		var type = value[0];
		value = value.substring(1);
			switch (type) {
				case 'b':
				return value == 'true';
				case 'n':
				return Number(value);
				default:
				return value;
			}
	};

	GM_log = function(message) {
		if (window.opera) {
			opera.postError(message);
		return;
		}
		console.log(message);
	};

	GM_setValue = function(name, value) {
		value = (typeof value)[0] + value;
		localStorage.setItem(name, value);
	};
}
///////////////////////////////////////////////
//faraway 17.bro3_Auto_Bilder_nokin_customのソース(bro3_auto_bilder_nokin_custom.user.js)終了

//------------------------------------------------
// 全体マップ移動距離カスタムツール
//------------------------------------------------
function disp_change_move_size()
{
	//全体画面なら実行中作業を取得
	if ( (location.pathname == "/map.php") || (location.pathname == "/big_map.php") ) {

		//HTML追加
		addHtml_18();

		//HTML更新
		updateHtml();
	}
}

//-----------------------//
// 51x51モードの実装判定 //
//-----------------------//
function check51_51mode(){
	var result;

	var el = $e_18('//*[@id="change-map-scale"]');
	if( el.snapshotLength > 0 ){
		result = 1;
	}
	else{
		result = 0;
	}

	return result;
}

//------------//
// HTMLの追加 //
//------------//
function addHtml_18() {
	//----------------------//
	// 保存された値をロード //
	//----------------------//
	var execflag;
	var basevalue;
	var basepos;
	var basex;
	var basey;
	execflag = loadExecFlag_18(location.hostname, "MOVE");
	basevalue = new String("0");  // 初期値
	if( execflag == "" ){
		basevalue = 20;
	}
	else{
		basevalue = execflag;
	}

	execflag = loadExecFlag_18(location.hostname, "BASEPOS");
	basepos = new String(BASE);  // 初期値
	if( execflag == "" ){
		basepos = BASE;
	}
	else{
		basepos = execflag;
	}
	basex = basepos.substr(0,4);
	basey = basepos.substr(4,4);

	//--------------------------------------------//
	// 移動数切り替えラジオボタン描画エリアの定義 //
	//--------------------------------------------//
	var ckLabel;
	var textbox;
	var dv2;
	var img;
	var target;
	var bigmap;

	if( location.pathname != "/big_map.php" ){
		// 51x51画面ではない
		bigmap = 0;
		target = "datas";
	}
	else{
		// 51x51画面である
		bigmap = 1;
		target = "change-map-scale";
	}

	dv2 = d_18.createElement("div");
	dv2.style.position = "absolute";
	if( bigmap == 0 ){
		// 51x51画面ではない
		if( location.hostname.substr(0,1) == "m" ){
			dv2.style.top = "160px";
			dv2.style.left = "10px";
		}
		else{
			dv2.style.top = "132px";
			dv2.style.left = "10px";
		}
	}
	else{
		// 51x51画面である
		dv2.style.top = "60px";
		dv2.style.left = "20px";
	}
	dv2.style.fontSize= "10px";
	dv2.style.width = "120px";
	dv2.style.height = "20px";
	dv2.style.border = "1px black solid";
	dv2.style.backgroundColor = "#FFFFCC";
	dv2.style.zIndex = 500;
	$_18(target).parentNode.appendChild(dv2);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "<font color=\"blue\"><b>最小移動単位</b></font>";
	dv2.appendChild(ckLabel);

	// 1
	textbox = document.createElement("input");
	textbox.type = "input";
	textbox.id = "iMove1";
	textbox.style.fontSize= "10px";
	textbox.style.marginTop = "2px";
	textbox.style.marginLeft = "8px";
	textbox.style.width = "35px";
	textbox.style.height = "12px";
	textbox.value = basevalue;
	textbox.addEventListener("blur", function() {textChanged()}, true);
	dv2.appendChild(textbox);

	if( bigmap == 0 ){
		// 51x51画面ではない

		// 矢印アイコン（左）
		img = 'data:image/png;base64,'+
					'iVBORw0KGgoAAAANSUhEUgAAABEAAAAeCAYAAADKO/UvAAAABnRSTlMAgACAAIDTzS+jAAAAjUlEQVR42sXV3Q2AIAwEYDuMkzlI'+
					'YRAncxiUGBJTKfQQ8F769iX8pEfOuaUlzBzi9N4TtSAJSIERCcBIDoAQDTAjT2Dd73lsAJIDIEQDzEgJMCE1oIpYgCJiBVQEAbII'+
					'CryQcAUFxiBdjtPtYlM+PzEKjf/2VmjeKqhBEKJBMCIhmbmVUYL+qVEJxUI/AUUVoq80rfXnAAAAAElFTkSuQmCC';
		dv2 = d_18.createElement("div");
		dv2.style.position = "absolute";
		dv2.style.top = "265px";
		dv2.style.left = "20px";
		dv2.style.zIndex = 500;
		dv2.id = "icon_arrow_left";
		dv2.innerHTML = '<a href="#"><img src="' + img + '"></a>';
		$_18(target).parentNode.appendChild(dv2);

		// 矢印アイコン（右）
		img = 'data:image/png;base64,'+
					'iVBORw0KGgoAAAANSUhEUgAAABEAAAAeCAYAAADKO/UvAAAABnRSTlMAgACAAIDTzS+jAAAAjElEQVR42sXV0Q2AIAwEUBjGyRwE'+
					'GMTJHAZN/FGk0LszsT8kfLwEKNeYcw4ppRrOKqXEQFSsZ903GOiFMFAXQSETQaAHsmzXuq8Y1EVQyEQQaIh4oSnigVzIDHIjIwhC'+
					'LAhGehCFtNB/iHwc+WLlJ5abTW57+QPKUSCHkhSPbVFBzQAmIg8vaox+MdAP+VTKF6cnH+gAAAAASUVORK5CYII=';
		dv2 = d_18.createElement("div");
		dv2.style.position = "absolute";
		dv2.style.top = "265px";
		dv2.style.left = "720px";
		dv2.style.zIndex = 500;
		dv2.id = "icon_arrow_right";
		dv2.innerHTML = '<a href="#"><img src="' + img + '"></a>';
		$_18(target).parentNode.appendChild(dv2);

		// 矢印アイコン（下）
		img = 'data:image/png;base64,'+
					'iVBORw0KGgoAAAANSUhEUgAAAB4AAAARCAYAAADKZhx3AAAABnRSTlMAgACAAIDTzS+jAAAAhklEQVR42sXQwRGAIAxEUSjGyiwE'+
					'KMTKLAaNMzqoAbIR8N9yepO13nvjnItmYCEEa+PeSPTsP5ibelraIut8v4+pCaZSvCdM6PXxWQ+cQ19wazyHsnArvIRm4a94DS3C'+
					'WlyCVmEUl6IiWIojqBiu4SgKwTlcg8LwE09DUBXM4SiqhlNcg1IbqGBwiqHWlxEAAAAASUVORK5CYII=';
		dv2 = d_18.createElement("div");
		dv2.style.position = "absolute";
		dv2.style.top = "455px";
		dv2.style.left = "365px";
		dv2.style.zIndex = 500;
		dv2.id = "icon_arrow_bottom";
		dv2.innerHTML = '<a href="#"><img src="' + img + '"></a>';
		$_18(target).parentNode.appendChild(dv2);

		// 矢印アイコン（上）
		img = 'data:image/png;base64,'+
					'iVBORw0KGgoAAAANSUhEUgAAAB4AAAARCAYAAADKZhx3AAAABnRSTlMAgACAAIDTzS+jAAAAiElEQVR42sXUwQ2AIAyFYTuMkzkI'+
					'ZRAncxgUTY0iQvuE+F96ar6khxIzD0jOuRCn956QfUJgQSUEN8MpiuIm+IqO8zGXCcPVcA6VEFwFl1AUr8IaFMGLsAW14q8wglrw'+
					'LPwF1eIPuAWqwW9wS7SGn3APtITvcPoGe8KCU9hqy+j6D86dunfx1CtJpXCK46EJ0QAAAABJRU5ErkJggg==';
		dv2 = d_18.createElement("div");
		dv2.style.position = "absolute";
		dv2.style.top = "85px";
		dv2.style.left = "365px";
		dv2.style.zIndex = 500;
		dv2.id = "icon_arrow_top";
		dv2.innerHTML = '<a href="#"><img src="' + img + '"></a>';
		$_18(target).parentNode.appendChild(dv2);
	}

	// 起点に設定ボタン
	img = 'data:image/png;base64,'+
				'iVBORw0KGgoAAAANSUhEUgAAAEsAAAASCAYAAAATzyPVAAAABnRSTlMAAACAAP+ikfOcAAABaElEQVR42u2YTW7CMBCFHQkJrtVF'+
				'b4WUIPVWXXCtIiGZJtTJ2H7zJyOyqN8u47HxfJkZHA9hiqFUHENt/GcaLmGobBRWh1SLQlthlaCGj8ve+9xN8TpmzwnYAouCopDi'+
				'dfqzTQ0/3L4GtybV6fMcfr6/Kpuk5I/8bvdDBm0GlsFKoNBmOGkQuLXoPC/Q4+EuBo9glWPWuBKwBVb81eaQl54UhDVAi1/pI72s'+
				'2ceaWWjMmm0lrMWWYKEetRcsTSizKAxvOSLNZbjtb+RhtZahNr+c44XFZZYmaynOa5lhcUG0ZpPXzknKLA9ErcGbYHkz492wtJ4l'+
				'9SiLTxMsLrO04K2wvRms/Rt6YSHwL4OlBe+VF5bUsygAlDEvySwKjIPlCZzOpcEjEJKtFF1DKj0EwtPXEqzs6IBO8Cg4SZYy1YB5'+
				'JO0JwfHC2/YpnOATrK6nIKxloH9IrxI/pFenfkVTCV7RUHVo+PLvAaJdifjwNfADAAAAAElFTkSuQmCC';
	dv2 = d_18.createElement("div");
	dv2.style.position = "absolute";
	if( bigmap == 0 ){
		// 51x51画面ではない
		if( location.hostname.substr(0,1) == "m" ){
			dv2.style.top = "183px";
			dv2.style.left = "10px";
		}
		else{
			dv2.style.top = "155px";
			dv2.style.left = "10px";
		}
	}
	else{
		// 51x51画面である
		dv2.style.top = "60px";
		dv2.style.left = "160px";
	}
	dv2.style.zIndex = 500;
	dv2.id = "icon_base2";
	dv2.innerHTML = '<a href="#"><img src="' + img + '"></a>';
	dv2.addEventListener("click", function() {changeBasePos()}, true);
	$_18(target).parentNode.appendChild(dv2);

	dv2 = d_18.createElement("span");
	dv2.style.position = "absolute";
	if( bigmap == 0 ){
		// 51x51画面ではない
		if( location.hostname.substr(0,1) == "m" ){
			dv2.style.top = "184px";
			dv2.style.left = "90px";
		}
		else{
			dv2.style.top = "156px";
			dv2.style.left = "90px";
		}
	}
	else{
		// 51x51画面である
		dv2.style.top = "61px";
		dv2.style.left = "240px";
	}
	dv2.style.fontSize= "10px";
	dv2.style.border = "1px black solid";
	dv2.style.textAlign = "center";
	dv2.style.verticalAlign = "bottom";
	dv2.style.backgroundColor = "#FFFFCC";
	dv2.id = "txBasePos";
	dv2.style.width = "75px";
	dv2.style.height = "14px";
	var texta = "(" + basex + "," + basey + ")";
	texta = texta.replace(/ /g,"&nbsp;");
	dv2.innerHTML = texta;
	$_18(target).parentNode.appendChild(dv2);

	// 起点に戻るボタン
	img = 'data:image/png;base64,'+
				'iVBORw0KGgoAAAANSUhEUgAAAEsAAAASCAYAAAATzyPVAAAABnRSTlMAAACAAP+ikfOcAAABK0lEQVR42u2YURKDIAxE4Wg9mXoy'+
				'j0ZbWmwMCUmIjs6U/SuSsDyIRWKYU8BKU6gb/0xxCbFqg7AGpFoQ2gYLg4qP5Wqflymt0+53AZZhQVAQUlrnb9vsGNifo5VXq57x'+
				'IbQ3sB2sAspiRDLB5YJxZwH1eMLAMqz00q/zQialk+gmqOmH+7QWi4IsyTI2Byv3KbCod9RVsLSSJ+p7joGRsLxlKMXjGC+sIz02'+
				'S9Gys7y7ydquhXVUHN/u2Fl3hnVGaZpgcTtLmjwnCZZ1B2ukXYjDYfUa0RrsLXfOtxQvjV3BgsCsg3IGSiw0oC0daWEkwJZya813'+
				'd3SgTvCtRL0TkIBZRflqvQ60/4gsKHyCL7CGPiJh5QfjQ3pT80N66zSuaCqRVzRQAxp9+fcEj5tg+AMbz+MAAAAASUVORK5CYII=';
	dv2 = d_18.createElement("div");
	dv2.style.position = "absolute";
	if( bigmap == 0 ){
		// 51x51画面ではない
		if( location.hostname.substr(0,1) == "m" ){
			dv2.style.top = "203px";
			dv2.style.left = "10px";
		}
		else{
			dv2.style.top = "175px";
			dv2.style.left = "10px";
		}
	}
	else{
		// 51x51画面である
		dv2.style.top = "80px";
		dv2.style.left = "160px";
	}
	dv2.style.zIndex = 500;
	dv2.id = "icon_base";
	dv2.innerHTML = '<a href="#"><img src="' + img + '"></a>';
	$_18(target).parentNode.appendChild(dv2);

	// マップ中央までの距離
	dv2 = d_18.createElement("div");
	dv2.style.position = "absolute";
	if( bigmap == 0 ){
		// 51x51画面ではない
		if( location.hostname.substr(0,1) == "m" ){
			dv2.style.top = "226px";
			dv2.style.left = "10px";
		}
		else{
			dv2.style.top = "198px";
			dv2.style.left = "10px";
		}
	}
	else{
		// 51x51画面である
		dv2.style.top = "84px";
		dv2.style.left = "20px";
	}
	dv2.style.fontSize= "11px";
	$_18(target).parentNode.appendChild(dv2);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	if( bigmap == 0 ){
		// 51x51画面ではない
		if( location.hostname.substr(0,1) == "m" ){
			ckLabel.innerHTML = "<font color=\"blue\"><b>起点からマップ中央まで</b></font>";
		}
		else{
			ckLabel.innerHTML = "<font color=\"blue\"><b>起点からマップ中央までの距離</b></font>";
		}
	}
	else{
		// 51x51画面である
		ckLabel.innerHTML = "<font color=\"blue\"><b>起点からマップ中央まで</b></font>";
	}
	dv2.appendChild(ckLabel);

	dv2 = d_18.createElement("div");
	dv2.style.position = "absolute";
	if( bigmap == 0 ){
		// 51x51画面ではない
		if( location.hostname.substr(0,1) == "m" ){
			dv2.style.top = "242px";
			dv2.style.left = "10px";
		}
		else{
			dv2.style.top = "210px";
			dv2.style.left = "10px";
		}
	}
	else{
		// 51x51画面である
		dv2.style.top = "96px";
		dv2.style.left = "20px";
	}
	dv2.style.fontSize= "11px";
	$_18(target).parentNode.appendChild(dv2);

	ckLabel = document.createElement("span");
	ckLabel.style.marginLeft = "4px";
	ckLabel.id = "lDistCenter";
	ckLabel.innerHTML = "<font color=\"blue\"><b>0.00</b></font>";
	dv2.appendChild(ckLabel);
}

//----------------------//
// テキスト変更イベント //
//----------------------//
function textChanged(){
	//----------------------//
	// 保存された値をロード //
	//----------------------//
	var execflag = loadExecFlag_18(location.hostname, "MOVE");
	var basevalue = new String("1");  // 初期値
	if( execflag == "" ){
		basevalue = 1;
	}
	else{
		basevalue = execflag;
	}

	var text = $e_18('//*[@id="iMove1"]');
	var inp;
	var movesize;

	inp = text.snapshotItem(0).value;
	movesize = parseInt(inp);
	if( (inp == "0") || (inp == "1/2") || (inp == "1/3") || (inp == "1/4") || (inp == "1/5") ){
		//--------------//
		// 変更値を保存 //
		//--------------//
		saveExecFlag_18(location.hostname, "MOVE", inp);

		//------------//
		// 画面を更新 //
		//------------//
		updateHtml();
	}
	else if( isNaN(parseInt(text.snapshotItem(0).value)) || movesize <= 0 ){
		// 数値化できない、または0以下がいれられたら元の値にする
		movesize = basevalue;
		text.snapshotItem(0).value = movesize;
	}
	else{
		//--------------//
		// 変更値を保存 //
		//--------------//
		saveExecFlag_18(location.hostname, "MOVE", movesize);
		text.snapshotItem(0).value = movesize;

		//------------//
		// 画面を更新 //
		//------------//
		updateHtml();
	}
}

//------------//
// HTMLの更新 //
//------------//
function updateHtml() {
	//------------------//
	// 画面サイズの取得 //
	//------------------//
	var viewSize;
	viewSize = getViewSize_18();

	//----------------//
	// 移動単位の取得 //
	//----------------//
	var execflag;
	var movesize;
	var basepos;
	var basex;
	var basey;
	execflag = loadExecFlag_18(location.hostname, "MOVE");
	if( execflag == "" ){
		movesize = 1;
	}
	else{
		if( execflag == "0" ){
			if( viewSize == 11 ){
				movesize = 11;
			}
			else if( viewSize == 15 ){
				movesize = 15;
			}
			else if( viewSize == 51 ){
				movesize = 51;
			}
			else{
				movesize = 20;
			}
		}
		else if( execflag == "1/2" ){
			if( viewSize == 11 ){
				movesize = 5;
			}
			else if( viewSize == 15 ){
				movesize = 7;
			}
			else if( viewSize == 50 ){
				movesize = 25;
			}
			else{
				movesize = 9;
			}
		}
		else if( execflag == "1/3" ){
			if( viewSize == 11 ){
				movesize = 4;
			}
			else if( viewSize == 15 ){
				movesize = 5;
			}
			else if( viewSize == 51 ){
				movesize = 16;
			}
			else{
				movesize = 7;
			}
		}
		else if( execflag == "1/4" ){
			if( viewSize == 11 ){
				movesize = 3;
			}
			else if( viewSize == 15 ){
				movesize = 4;
			}
			else if( viewSize == 51 ){
				movesize = 12;
			}
			else{
				movesize = 5;
			}
		}
		else if( execflag == "1/5" ){
			if( viewSize == 11 ){
				movesize = 2;
			}
			else if( viewSize == 15 ){
				movesize = 3;
			}
			else if( viewSize == 51 ){
				movesize = 10;
			}
			else{
				movesize = 4;
			}
		}
		else{
			movesize = parseInt(execflag);
		}
	}

	//------------------//
	// ベース位置の取得 //
	//------------------//
	execflag = loadExecFlag_18(location.hostname, "BASEPOS");
	basepos = new String(BASE);  // 初期値
	if( execflag == "" ){
		basepos = BASE;
	}
	else{
		basepos = execflag;
	}
	basex = basepos.substr(0,4);
	basey = basepos.substr(4,4);

	//--------------------------------------------//
	// 全体表示画面から、画面中央座標を手に入れる //
	//--------------------------------------------//
	var codx;
	var cody;
	var x;
	var y;
	var bigmap;
	if( location.pathname != "/big_map.php" ){
		// 51x51画面ではない
		codx = $e_18('//div[@id="datas"]/input[@id=\"x\"]');
		cody = $e_18('//div[@id="datas"]/input[@id=\"y\"]');

		x = codx.snapshotItem(0).value;
		y = cody.snapshotItem(0).value;

		bigmap = 0;
	}
	else{
		// 51x51画面である
		var li = $e_18('//*[@id="map51-content"]//li');
		var dt = li.snapshotItem(1300).innerHTML;
		pos = dt.match(/.*x=([-]*\d+)&amp;y=([-]*\d+)#.*/);

		x = pos[1];
		y = pos[2];

		bigmap = 1;
	}

	//------------------------------------------//
	// 画面小移動アイコンを５マス移動に変更する //
	//------------------------------------------//
	// 座標を取得して、補正＆再設定する形で実装する
	{
		var arrow_img = new Array();
		// 右上
		arrow_img[0] = 'data:image/png;base64,'+
				'iVBORw0KGgoAAAANSUhEUgAAACEAAAAUCAYAAAADU1RxAAAABnRSTlMAAACAAIBiK58xAAAAqElEQVR42mNkaGhg+F9f/59hAABj'+
				'YyMjmP4PBAPhABTHDEpHRG1lYDj9gjaWmUpA6GXeaI7AlibmX2FgaDtJW9/fTibgCHo4ZikwNMwkkBwBAvhyCC0cg9URMEAvx+B1'+
				'BL0cQ5QjaO0YkhxBK8eQ5QhqO4YiR1DLMVRxBKWOoaojyHUMTRxBimNAdQhy/UF1RxDjGHRAM0eQ4hiaOwKfY+AtK3o5Ah8AAJN5'+
				'gtGmVHygAAAAAElFTkSuQmCC';
		// 右下
		arrow_img[1] = 'data:image/png;base64,'+
				'iVBORw0KGgoAAAANSUhEUgAAACEAAAAUCAYAAAADU1RxAAAABnRSTlMAAACAAIBiK58xAAAAp0lEQVR42mNkaGhgGGjASC9H/K+v'+
				'/49heWMjI10cgc1yuoUEMZbTzBH4LJ9/hYGh7SQDg6kEA8Mybxo4ghjLkcFSoCPMJKjkCFItp6ojyLWcKo6g1HKKHEEty8lyBLUt'+
				'J8kRtLKcKEfQ2nK8jqCX5TgdgcsBtLCcaEfQ0nIYuJ2MYDP+BwJkyaitDAynX9DGYlOoz5HrDayOGAgwOByBL2HS3HJoywoACHaC'+
				'0ZpxWZMAAAAASUVORK5CYII=';
		// 左下
		arrow_img[2] = 'data:image/png;base64,'+
				'iVBORw0KGgoAAAANSUhEUgAAACEAAAAUCAYAAAADU1RxAAAABnRSTlMAAACAAIBiK58xAAAArElEQVR42mNkaGhgGGjACHPE//r6'+
				'/xiSjY2MdHHEfyAgqIjGjiHKEbR2DIojorYyMJx+wcBQZc7AkKhDP8fAHXEKaHn0VlRJejkGryPo5RiiHEFrx5DkCFo5hixHUNsx'+
				'FDmCWo6hiiModQxVHUGuY2jiCFIdQ1NHEOMYkENQim3VubRxBD7HYDgCBKKgoQGqQ2gBTCUYGJZ5ozmElFqUVmBwOAJfy4ouDgCm'+
				'CQAiII8JcKepBgAAAABJRU5ErkJggg==';
		// 左上
		arrow_img[3] = 'data:image/png;base64,'+
				'iVBORw0KGgoAAAANSUhEUgAAACEAAAAUCAYAAAADU1RxAAAABnRSTlMAAACAAIBiK58xAAAAqElEQVR42mNkaGhgAIH/9fX/GQYA'+
				'MDY2MjL+B4KBsBzFIYPSEVFbIfTpF7Sx0FSCgWGZNx5HqM6lrY+rzBkYEnXQHICcJk4BfR69lX6W080R+CyHOQBM08IRxFoO51PT'+
				'EaRaTlVHkGs5VRxBqeUUOYJalpPlCGpbTpIjaGU5UY6gteUYjgABUL0BqjPoZTlWRxBUTGXLSXIErSyHm4+vZUVryzEcMZAAAHdt'+
				'jwkxygB9AAAAAElFTkSuQmCC';

		var alist = $e_18('//*[@class="fade"]');
		var dv;
		var cx;
		var cy;
		var varpos;
		var classname;
		var hrefText;

		// 画面上にある矢印アイコンの数によりチェック数がかわる（先頭４つは右下の画面切り替え用）
		if( bigmap == 0 ){
			for( var i = 0; i < alist.snapshotLength-4; i++ ){
				varpos = i + 4;
				classname = alist.snapshotItem(varpos).getAttribute("src");
				if( classname.indexOf("double_cur") == -1 ){
					if( (classname.indexOf("cur01.gif") != -1) || (classname == arrow_img[0]) ){
						// 右上（Ｙ軸＋）
						// 座標値の補正
						cx = x;
						cy = y;
						if( parseInt(cy) + parseInt(movesize) > 800 ){
							cy = 800;
						}
						else{
							cy = parseInt(cy) + parseInt(movesize);
						}
						// 値を書き換える
						hrefText = "map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
						alist.snapshotItem(varpos).parentNode.setAttribute("href",hrefText);
						alist.snapshotItem(varpos).setAttribute("src",arrow_img[0]);
					}
					else if( (classname.indexOf("cur02.gif") != -1) || (classname == arrow_img[1]) ){
						// 右下（Ｘ軸＋）
						// 座標値の補正
						cx = x;
						cy = y;
						if( parseInt(cx) + parseInt(movesize) > 800 ){
							cx = 800;
						}
						else{
							cx = parseInt(cx) + parseInt(movesize);
						}
						// 値を書き換える
						hrefText = "map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
						alist.snapshotItem(varpos).parentNode.setAttribute("href",hrefText);
						alist.snapshotItem(varpos).setAttribute("src",arrow_img[1]);
					}
					else if( (classname.indexOf("cur03.gif") != -1) || (classname == arrow_img[2]) ){
						// 左下（Ｙ軸－）
						// 座標値の補正
						cx = x;
						cy = y;
						if( parseInt(cy) - parseInt(movesize) < -800 ){
							cy = -800;
						}
						else{
							cy = parseInt(cy) - parseInt(movesize);
						}
						// 値を書き換える
						hrefText = "map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
						alist.snapshotItem(varpos).parentNode.setAttribute("href",hrefText);
						alist.snapshotItem(varpos).setAttribute("src",arrow_img[2]);
					}
					else{
						// 左上（Ｘ軸－）
						// 座標値の補正
						cx = x;
						cy = y;
						if( parseInt(cx) - parseInt(movesize) < -800 ){
							cx = -800;
						}
						else{
							cx = parseInt(cx) - parseInt(movesize);
						}
						// 値を書き換える
						hrefText = "map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
						alist.snapshotItem(varpos).parentNode.setAttribute("href",hrefText);
						alist.snapshotItem(varpos).setAttribute("src",arrow_img[3]);
					}
				}
			}
		}

		//------------------------//
		// 上下左右アイコンの補正 //
		//------------------------//
		if( bigmap == 0 ){
			var aicon;
			var dflag;

			//-- 左 --//
			dflag = 0;
			aicon = $e_18('//*[@id="icon_arrow_left"]');
			// 座標値の補正
			cx = x;
			cy = y;
			if( parseInt(cx) - parseInt(movesize) < -800 ){
				cx = -800;
				dflag = dflag + 1;
			}
			else{
				cx = parseInt(cx) - parseInt(movesize);
			}
			if( parseInt(cy) - parseInt(movesize) < -800 ){
				cy = -800;
				dflag = dflag + 1;
			}
			else{
				cy = parseInt(cy) - parseInt(movesize);
			}
			// 値を書き換える
			hrefText = "map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
			aicon.snapshotItem(0).firstChild.setAttribute("href",hrefText);
			// 消去判定
			if( dflag == 2 ){
				aicon.snapshotItem(0).style.display = "none";
			}
			else{
				aicon.snapshotItem(0).style.display = "inline";
			}

			//-- 右 --//
			dflag = 0;
			aicon = $e_18('//*[@id="icon_arrow_right"]');
			// 座標値の補正
			cx = x;
			cy = y;
			if( parseInt(cx) + parseInt(movesize) > 800 ){
				cx = 800;
				dflag = dflag + 1;
			}
			else{
				cx = parseInt(cx) + parseInt(movesize);
			}
			if( parseInt(cy) + parseInt(movesize) > 800 ){
				cy = 800;
				dflag = dflag + 1;
			}
			else{
				cy = parseInt(cy) + parseInt(movesize);
			}
			// 値を書き換える
			hrefText = "map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
			aicon.snapshotItem(0).firstChild.setAttribute("href",hrefText);
			// 消去判定
			if( dflag == 2 ){
				aicon.snapshotItem(0).style.display = "none";
			}
			else{
				aicon.snapshotItem(0).style.display = "inline";
			}

			//-- 下 --//
			dflag = 0;
			aicon = $e_18('//*[@id="icon_arrow_bottom"]');
			// 座標値の補正
			cx = x;
			cy = y;
			if( parseInt(cx) + parseInt(movesize) > 800 ){
				cx = 800;
				dflag = dflag + 1;
			}
			else{
				cx = parseInt(cx) + parseInt(movesize);
			}
			if( parseInt(cy) - parseInt(movesize) < -800 ){
				cy = -800;
				dflag = dflag + 1;
			}
			else{
				cy = parseInt(cy) - parseInt(movesize);
			}
			// 値を書き換える
			hrefText = "map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
			aicon.snapshotItem(0).firstChild.setAttribute("href",hrefText);
			// 消去判定
			if( dflag == 2 ){
				aicon.snapshotItem(0).style.display = "none";
			}
			else{
				aicon.snapshotItem(0).style.display = "inline";
			}

			//-- 上 --//
			dflag = 0;
			aicon = $e_18('//*[@id="icon_arrow_top"]');
			// 座標値の補正
			cx = x;
			cy = y;
			if( parseInt(cx) - parseInt(movesize) < -800 ){
				cx = -800;
				dflag = dflag + 1;
			}
			else{
				cx = parseInt(cx) - parseInt(movesize);
			}
			if( parseInt(cy) + parseInt(movesize) > 800 ){
				cy = 800;
				dflag = dflag + 1;
			}
			else{
				cy = parseInt(cy) + parseInt(movesize);
			}
			// 値を書き換える
			hrefText = "map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
			aicon.snapshotItem(0).firstChild.setAttribute("href",hrefText);
			// 消去判定
			if( dflag == 2 ){
				aicon.snapshotItem(0).style.display = "none";
			}
			else{
				aicon.snapshotItem(0).style.display = "inline";
			}
		}
		else{
			// 51x51マップ
			var aicon;
			var dflag;

			//-- 左 --//
			dflag = 0;
			aicon = $e_18('//*[@id="single-allow-west"]/a');
			// 座標値の補正
			cx = x;
			cy = y;
			if( parseInt(cx) - parseInt(movesize) < -800 ){
				cx = -800;
				dflag = dflag + 1;
			}
			else{
				cx = parseInt(cx) - parseInt(movesize);
			}
			if( parseInt(cy) - parseInt(movesize) < -800 ){
				cy = -800;
				dflag = dflag + 1;
			}
			else{
				cy = parseInt(cy) - parseInt(movesize);
			}
			// 値を書き換える
			hrefText = "big_map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
			aicon.snapshotItem(0).setAttribute("href",hrefText);
			// 消去判定
			if( dflag == 2 ){
				aicon.snapshotItem(0).style.display = "none";
			}
			else{
				aicon.snapshotItem(0).style.display = "inline";
			}

			//-- 右 --//
			dflag = 0;
			aicon = $e_18('//*[@id="single-allow-east"]/a');
			// 座標値の補正
			cx = x;
			cy = y;
			if( parseInt(cx) + parseInt(movesize) > 800 ){
				cx = 800;
				dflag = dflag + 1;
			}
			else{
				cx = parseInt(cx) + parseInt(movesize);
			}
			if( parseInt(cy) + parseInt(movesize) > 800 ){
				cy = 800;
				dflag = dflag + 1;
			}
			else{
				cy = parseInt(cy) + parseInt(movesize);
			}
			// 値を書き換える
			hrefText = "big_map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
			aicon.snapshotItem(0).setAttribute("href",hrefText);
			// 消去判定
			if( dflag == 2 ){
				aicon.snapshotItem(0).style.display = "none";
			}
			else{
				aicon.snapshotItem(0).style.display = "inline";
			}

			//-- 下 --//
			dflag = 0;
			aicon = $e_18('//*[@id="single-allow-south"]/a');
			// 座標値の補正
			cx = x;
			cy = y;
			if( parseInt(cx) + parseInt(movesize) > 800 ){
				cx = 800;
				dflag = dflag + 1;
			}
			else{
				cx = parseInt(cx) + parseInt(movesize);
			}
			if( parseInt(cy) - parseInt(movesize) < -800 ){
				cy = -800;
				dflag = dflag + 1;
			}
			else{
				cy = parseInt(cy) - parseInt(movesize);
			}
			// 値を書き換える
			hrefText = "big_map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
			aicon.snapshotItem(0).setAttribute("href",hrefText);
			// 消去判定
			if( dflag == 2 ){
				aicon.snapshotItem(0).style.display = "none";
			}
			else{
				aicon.snapshotItem(0).style.display = "inline";
			}

			//-- 上 --//
			dflag = 0;
			aicon = $e_18('//*[@id="single-allow-north"]/a');
			// 座標値の補正
			cx = x;
			cy = y;
			if( parseInt(cx) - parseInt(movesize) < -800 ){
				cx = -800;
				dflag = dflag + 1;
			}
			else{
				cx = parseInt(cx) - parseInt(movesize);
			}
			if( parseInt(cy) + parseInt(movesize) > 800 ){
				cy = 800;
				dflag = dflag + 1;
			}
			else{
				cy = parseInt(cy) + parseInt(movesize);
			}
			// 値を書き換える
			hrefText = "big_map.php?x=" + (parseInt(cx)) + "&y=" + parseInt(cy);
			aicon.snapshotItem(0).setAttribute("href",hrefText);
			// 消去判定
			if( dflag == 2 ){
				aicon.snapshotItem(0).style.display = "none";
			}
			else{
				aicon.snapshotItem(0).style.display = "inline";
			}
		}

		//----------------------------//
		// 起点に戻るボタンの書き換え //
		//----------------------------//
		// 拠点座標取得
		aicon = $e_18('//*[@id="icon_base"]');
		hrefText = "map.php?x=" + parseInt(basex) + "&y=" + parseInt(basey);
		aicon.snapshotItem(0).firstChild.setAttribute("href",hrefText);

		//----------------//
		// 距離の書き換え //
		//----------------//
		var dx;
		var dy;
		dx = parseInt(basex) - parseInt(x);
		dy = parseInt(basey) - parseInt(y);
		var distance = Math.round(Math.sqrt(Math.pow(parseInt(dx),2) + Math.pow(parseInt(dy),2)) * 100) / 100;
		aicon = $e_18('//*[@id="lDistCenter"]');
		aicon.snapshotItem(0).innerHTML = "<font color=\"blue\"><b>" + roundx(distance,2) + "</b></font>";
	}
}

// 書式整形：他サイトのソースを引用
function roundx(num, n) {
	var str = new String();
	var z = "";
	str = new String(num);
	for (i = 0; i < n; i++) z = z + "0";
	if (str.indexOf(".") < 0) return str + "." + z;
	str = str + z;
	return str.split(".")[0] + "." + str.split(".")[1].substring(0, n);
}


//--------------//
// データロード //
//--------------//
function loadExecFlag_18(hostname, key) {
	var datakey = new String();
	datakey = hostname + VERSION_KEY_18 + key;

	var ret = new String();
	var src = CookieRead_18(datakey);
	if (src == "") return ret;

	return src;
}

//--------------//
// データセーブ //
//--------------//
function saveExecFlag_18(hostname, key, data) {

	var datakey = new String();
	datakey = hostname + VERSION_KEY_18 + key;

	CookieWrite_18(datakey, data, 30);
}

//----------------------//
// クッキーへの書き込み //
//----------------------//
function CookieWrite_18(kword, kdata, kday)
{
	if(!navigator.cookieEnabled){	// クッキーが利用可能かどうか
		alert("クッキーへの書き込みができません");
		return;
	}

	sday = new Date();
	sday.setTime(sday.getTime() + (kday * 1000 * 60 * 60 * 24));
	s2day = sday.toGMTString();
	document.cookie = kword + "=" + escape(kdata) + ";expires=" + s2day;
}

//----------------------//
// クッキーから読み込み //
//----------------------//
function CookieRead_18(kword)
{
	if(typeof(kword) == "undefined"){	// キーワードなし
		return "";	// 何もしないで戻る
	}

	kword = kword + "=";
	kdata = "";
	scookie = document.cookie + ";";	// クッキー情報を読み込む
	start = scookie.indexOf(kword);		// キーワードを検索
	if (start != -1){
		// キーワードと一致するものあり
		end = scookie.indexOf(";", start);	// 情報の末尾位置を検索
		kdata = unescape(scookie.substring(start + kword.length, end));	// データ取り出し
	}

	return kdata;
}

//----------------//
// 起点座標の変更 //
//----------------//
function changeBasePos()
{
	//--------------------------------------------//
	// 全体表示画面から、画面中央座標を手に入れる //
	//--------------------------------------------//
	var codx;
	var cody;
	var x;
	var y;
	if( location.pathname != "/big_map.php" ){
		// 51x51画面ではない
		codx = $e_18('//div[@id="datas"]/input[@id=\"x\"]');
		cody = $e_18('//div[@id="datas"]/input[@id=\"y\"]');

		x = codx.snapshotItem(0).value;
		y = cody.snapshotItem(0).value;
	}
	else{
		// 51x51画面である
		var li = $e_18('//*[@id="map51-content"]//li');
		var dt = li.snapshotItem(1300).innerHTML;
		pos = dt.match(/.*x=([-]*\d+)&amp;y=([-]*\d+)#.*/);

		x = pos[1];
		y = pos[2];
	}

	// 表示更新
	var dv2 = $e_18('//*[@id="txBasePos"]');
	var texta = "(" + formatRightNumber_18(parseInt(x),4) + "," + formatRightNumber_18(parseInt(y),4) + ")";
	var textb = texta;
	texta = texta.replace(/ /g,"&nbsp;");
	dv2.snapshotItem(0).innerHTML = texta;

	//----------------------------//
	// 起点に戻るボタンの書き換え //
	//----------------------------//
	// 拠点座標取得
	var aicon = $e_18('//*[@id="icon_base"]');
	var hrefText = "map.php?x=" + parseInt(x) + "&y=" + parseInt(y);
	aicon.snapshotItem(0).firstChild.setAttribute("href",hrefText);

	//----------------//
	// 距離の書き換え //
	//----------------//
	aicon = $e_18('//*[@id="lDistCenter"]');
	aicon.snapshotItem(0).innerHTML = "<font color=\"blue\"><b>0.00</b></font>";

	//--------------//
	// クッキー更新 //
	//--------------//
	var savedata;
	savedata = formatRightNumber_18(parseInt(x),4) + formatRightNumber_18(parseInt(y),4);

	saveExecFlag_18(location.hostname, "BASEPOS", savedata);
}

//----------//
// 桁数整形 //
//----------//
function formatRightNumber_18( num, length ){
	var fix = ' 	 ';
	var str;
	var result = '';

	str = num.toString(10);
	if( str.length < length ){
		result = fix.substr(0,length - str.length) + str;
	}
	else{
		result = str;
	}

	return result;
}


//------------------//
// 画面サイズの取得 //
//------------------//
function getViewSize_18()
{
	var viewSize;

	if( $x_18("//div[@id=\"changemapscale\"]/ul/li[@class=\"sort15 now\"]") ){
		viewSize = 15;	// 15x15
	}
	else if( $x_18("//div[@id=\"changemapscale\"]/ul/li[@class=\"sort20 now\"]") ){
		viewSize = 20;	// 20x20
	}
	else if( $x_18("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort15 now\"]") ){
		viewSize = 15;	// 15x15
	}
	else if( $x_18("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort21 now\"]") ){
		viewSize = 21;	// 20x20
	}
	else if( $x_18("//div[@id=\"change-map-scale\"]/ul/li[@class=\"sort51 now\"]") ){
		viewSize = 51;	// 51x51
	}
	else{
		viewSize = 11;	// 11x11
	}

	return viewSize;
}

//-------------------------------------------------------
// 都市画面内政武将表示ツール(βバージョン)
//-------------------------------------------------------
function disp_display_adm_info()
{
	// デッキ画面なら使用中内政官を取得
	if (location.pathname == "/card/deck.php") {
		getDeckInfo();		//結果取得
	}
	// デッキ設定画面なら使用中内政官を取得
	else if (location.pathname == "/card/domestic_setting.php") {
		getDeckInfo2();		//結果取得
	}
	// 都市画面なら設定情報を表示
	else if (location.pathname == "/village.php") {
		addHtml_19();		//HTML追加
	}
}

//------------------//
// 内政武将情報取得 //
//------------------//
function getDeckInfo() {
	var w_vname = new Array();
	var w_fname = new Array();
	var w_rare = new Array();
	var w_gage = new Array();
	var w_skill = new Array();
	var w_limit = new Array();

	// データ保持変数初期化
	for( var i = 0; i < 10; i++ ){
		w_vname[i] = "";
		w_fname[i] = "";
		w_rare[i] = "";
		w_gage[i] = "";
		w_skill[i] = "";
		w_limit[i] = "";
		vname[i] = "";
		fname[i] = "";
		rare[i] = "";
		gage[i] = "";
		skill[i] = "";
		limit[i] = "";
	}

	//------------------------//
	// Cookie保存データの取得 //
	//------------------------//
	var loaddata = loadExecFlag_19(location.hostname, "GENE");
	if( loaddata != "" && loaddata != "undefined" ){
		// ロードデータの個別データへの分割
		splitLoadData(loaddata);
	}

	//------------------//
	// サーバ時間の取得 //
	//------------------//
	getServerTime();

	//------------------------------------------//
	// デッキ画面から、内政武将情報を手に入れる //
	//------------------------------------------//
	var p1;
	var p2;
	var p3;
	var s1;
	var text;
	var ct;

	// データ
	var data = document.evaluate('//div[@id="cardListDeck"]//div[@class="cardColmn"]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	ct = 0;
	for( var i = 0; i < data.snapshotLength; i++ ){
		text = data.snapshotItem(i).innerHTML;
		if( text.indexOf("内政セット済") != -1){

			if( text.indexOf("card rarerity_ur") != -1 ){
				w_rare[ct] = "ur";
			}
			else if( text.indexOf("card rarerity_sr") != -1 ){
				w_rare[ct] = "sr";
			}
			else if( text.indexOf("card rarerity_r") != -1 ){
				w_rare[ct] = "r";
			}
			else if( text.indexOf("card rarerity_uc") != -1 ){
				w_rare[ct] = "uc";
			}
			else if( text.indexOf("card rarerity_c") != -1 ){
				w_rare[ct] = "c";
			}

			// 画像ファイル名
			p1 = text.indexOf("<img src=");
			p2 = text.indexOf(".png");
			w_fname[ct] = text.substr(p1+10,p2-p1-6);

			// 拠点名
			p1 = text.indexOf("village_id=");
			s1 = text.substr(p1);
			p2 = s1.indexOf("\">");
			p3 = s1.indexOf("<");
			w_vname[ct] = s1.substr(p2+2,p3-p2-2);

			// 討伐ゲージ
			p1 = text.indexOf("class=\"para");
			s1 = text.substr(p1);
			p2 = s1.indexOf("\">");
			p3 = s1.indexOf("<");
			w_gage[ct] = s1.substr(p2+2,p3-p2-2);

			ct = ct + 1;
		}
	}

	// 保存情報と拠点名が一致するものについて、ファイル名、レアリティを書き換える
	for( var i = 0; i < 10; i++ ){
		if( vname[i] == "" ){
			continue;
		}
		for( var j = 0; j < ct; j++ ){
			if( w_vname[j] == vname[i] ){
				fname[i] = w_fname[j];	// ファイル名
				rare[i] = w_rare[j];	// レアリティ
				gage[i] = w_gage[j];	// 討伐ゲージ
			}
		}
	}

	// 保存データ内に、画面内にある拠点名が存在しない場合は、保存データを消去
	for( var i = 0; i < 10; i++ ){
		if( vname[i] == "" ){
			continue;
		}

		var found = 0;
		for( var j = 0; j < ct; j++ ){
			if( w_vname[j] == vname[i] ){
				found = 1;
				break;
			}
		}

		if( found == 0 ){
			// データをクリア
			vname[i] = "";	// 拠点名
			fname[i] = "";	// ファイル名
			rare[i] = "";	// レアリティ
			skill[i] = "";	// スキル名
			limit[i] = "";	// 終了時間
			gage[i] = "";	// 討伐ゲージ
		}
	}

	// 画面内にある拠点名が登録されていない場合は、新規登録
	for( var i = 0; i < ct; i++ ){
		if( w_vname[i] == "" ){
			break;
		}

		var found = 0;
		for( var j = 0; j < 10; j++ ){
			if( w_vname[i] == vname[j] ){
				found = 1;
			}
		}

		if( found == 0 ){
			for( var j = 0; j < 10; j++ ){
				if( vname[j] == "" ){
					// データを保存
					vname[j] = w_vname[i];	// 拠点名
					fname[j] = w_fname[i];	// ファイル名
					rare[j] = w_rare[i];	// レアリティ
					skill[j] = "";		// スキル名
					limit[j] = "";		// 終了時間
					gage[j] = w_gage[i];	// 討伐ゲージ
					break;
				}
			}
		}
	}

	//--------------//
	// データの保存 //
	//--------------//
	// セーブデータの作成
	var savedata = makeSaveData(vname,fname,rare,gage,skill,limit);
	// データの保存
	saveExecFlag_19(location.hostname, "GENE", savedata);	// 保存データ
}

//----------------------------//
// 内政武将情報取得(内政画面) //
//----------------------------//
function getDeckInfo2() {
	//------------------------//
	// Cookie保存データの取得 //
	//------------------------//
	var loaddata = loadExecFlag_19(location.hostname, "GENE");
	if( loaddata != "" && loaddata != "undefined" ){
		// ロードデータの個別データへの分割
		splitLoadData(loaddata);
	}

	//--------------------//
	// サーバー時間の取得 //
	//--------------------//
	getServerTime();

	//----------------------------------------//
	// 内政画面から、内政武将情報を手に入れる //
	//----------------------------------------//
	var p1;
	var p2;
	var p3;
	var s1;
	var text;
	var ct;
	var cvillage;
	var data;
	var latetime;
	var w_rare;
	var w_fname;
	var w_gage;
	var w_skill;
	var w_limit;

	// チェックされているラジオボタンの拠点名を取得
	data = document.evaluate('//table[@class="commonTables w174"]//input[@checked]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	cvillage = trim_19(data.snapshotItem(0).nextSibling.textContent);

	// 内政設定済武将がいるかチェック
	var deckrow=-1;
	data = document.evaluate('//table[@class="general"]',document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	for( var i = 0; i < data.snapshotLength; i++ ){if(data.snapshotItem(i).innerHTML.indexOf("内政中") != -1) deckrow=i;}
	if( deckrow > -1 ){
		// 内政武将がいる

		// 武将情報の取得
		data = document.evaluate('//div[@class="cardWrapper2col"]',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);

		text = data.snapshotItem(deckrow).innerHTML;//		text = data.snapshotItem(0).innerHTML;
		if( text.indexOf("card rarerity_ur") != -1 ){
			w_rare = "ur";
		}
		else if( text.indexOf("card rarerity_sr") != -1 ){
			w_rare = "sr";
		}
		else if( text.indexOf("card rarerity_r") != -1 ){
			w_rare = "r";
		}
		else if( text.indexOf("card rarerity_uc") != -1 ){
			w_rare = "uc";
		}
		else if( text.indexOf("card rarerity_c") != -1 ){
			w_rare = "c";
		}

		// 画像ファイル名
		p1 = text.indexOf("<img src=");
		p2 = text.indexOf(".png");
		w_fname = text.substr(p1+10,p2-p1-6);

		// 討伐ゲージ
		data = document.evaluate('//table[@class="general" and @summary="武将" ]',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		text = data.snapshotItem(deckrow).innerHTML;
		p1 = text.indexOf("討:");
		s1 = text.substr(p1);
		p2 = s1.indexOf("</td>");
		w_gage = parseInt(trim_19(s1.substr(2,3)));

		var day = servertime.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/);
		var now = new Date(parseInt(day[1],10),parseInt(day[2],10)-1,parseInt(day[3],10),parseInt(day[4],10),parseInt(day[5],10),parseInt(day[6],10),0);

		// 使用中スキルの取得
		data = document.evaluate('//table[@class="general"]//td[@class="status"]/span[@id="area_timer0"]',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);


		if( data.snapshotLength >= 1 ){
			// area_timer0がいれば、使用中スキルがある

			// 残時間
			latetime = data.snapshotItem(0).textContent;
			var time = latetime.match(/(\d+):(\d+):(\d+)/);
			// リミットを求める
			now.setHours( now.getHours() + parseInt(time[1],10) );
			now.setMinutes( now.getMinutes() + parseInt(time[2],10) );
			now.setSeconds( now.getSeconds() + parseInt(time[3],10) );

			// 終了時刻
			w_limit = formatRightNumber_19(now.getFullYear(), 4) + "-" +
				formatRightNumber_19(now.getMonth()+1, 2) + "-" +
				formatRightNumber_19(now.getDate(), 2) + " " +
				formatRightNumber_19(now.getHours(), 2) + ":" +
				formatRightNumber_19(now.getMinutes(), 2) + ":" +
				formatRightNumber_19(now.getSeconds(), 2);

			// スキル名
			data = document.evaluate('//table[@class="general" and @summary="武将"]/tbody/tr/td[@class="use"]',
				document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
			w_skill = data.snapshotItem(deckrow).textContent;
		}
		else{
			// スキル切れか未使用
			w_limit = "";
			w_skill = "";
		}

		// 内政武将データの更新
		var found;
		found = false;
		var maxpos = 0;
		for( var i = 0; i < 10; i++ ){
			if( vname[i] == "" ){
				maxpos = i;
				break;
			}
			if( vname[i] == cvillage ){
				// 一致した
				found = true;

				// データの更新
				fname[i] = w_fname;	// ファイル名
				rare[i] = w_rare;	// レアリティ
				skill[i] = w_skill;	// スキル名
				limit[i] = w_limit;	// 終了時間
				gage[i] = w_gage;	// 討伐ゲージ

				break;
			}
		}

		if( found == false ){
			// 内政設定されていない拠点だった

			// 取得データを保存
			vname[maxpos] = cvillage;	// 拠点名
			fname[maxpos] = w_fname;	// ファイル名
			rare[maxpos] = w_rare;		// レアリティ
			skill[maxpos] = w_skill;	// スキル名
			limit[maxpos] = w_limit;	// 終了時間
			gage[maxpos] = w_gage;		// 討伐ゲージ
		}
	}
	else{
		// 内政武将がいなくなったかそもそもいない

		// 内政武将データの更新
		var w_vname;;
		found = false;
		for( var i = 0; i < 10; i++ ){
			if( vname[i] == "" ){
				break;
			}
			if( vname[i] == cvillage ){
				// 一致した
				maxpos = i;

				// データをクリア
				vname[maxpos] = "";	// 拠点名
				fname[maxpos] = "";	// ファイル名
				rare[maxpos] = "";	// レアリティ
				skill[maxpos] = "";	// スキル名
				limit[maxpos] = "";	// 終了時間
				gage[maxpos] = "";	// 討伐ゲージ
				break;
			}
		}

	}

	//--------------//
	// データの保存 //
	//--------------//
	// セーブデータの作成
	var savedata = makeSaveData(vname,fname,rare,gage,skill,limit);
	// データの保存
	saveExecFlag_19(location.hostname, "GENE", savedata);	// 保存データ
}

//------------//
// HTMLの生成 //
//------------//
function addHtml_19() {
	//----------------//
	// コンテナの取得 //
	//----------------//
	var container;
	var mapbox = $e_19('//*[@id="mapboxInner"]');
	if (mapbox.snapshotLength == 0) {
		container = document.body;
	} else {
		container = mapbox.snapshotItem(0);
	}

	//----------------------//
	// 武将描画エリアの定義 //
	//----------------------//
	var textArea;

	// データ描画用
	var dv2 = d_19.createElement("div");
	dv2.style.fontSize= "10px";
	textArea = document.createElement("div");
	textArea.id = "generalView";
	textArea.style.width = "66px";
	textArea.style.height = "66px";
	textArea.innerHTML = "";
	textArea.style.color = "black";
	textArea.innerHTML = "";
	textArea.style.marginTop = '12px';
	dv2.appendChild(textArea);
	$_19("basepoint").appendChild(dv2);

	// データ描画用
	dv2 = d_19.createElement("div");
	dv2.style.fontSize= "10px";
	textArea = document.createElement("div");
	textArea.id = "generalView2";
	textArea.innerHTML = "";
	textArea.style.width = "140px";
	textArea.style.color = "black";
	textArea.style.backgroundColor = "white";
	textArea.innerHTML = "";
	textArea.style.marginLeft = '90px';
	textArea.style.marginTop = '-60px';
	dv2.appendChild(textArea);
	$_19("basepoint").appendChild(dv2);

	//------------------------//
	// 内政武将データのロード //
	//------------------------//
	for( var i = 0; i < 10; i++ ){
		vname[i] = "";
		fname[i] = "";
		rare[i] = "";
		skill[i] = "";
		limit[i] = "";
		gage[i] = "";
	}

	//------------------------//
	// Cookie保存データの取得 //
	//------------------------//
	var old_servertime = "";
	var loaddata = loadExecFlag_19(location.hostname, "GENE");
	if( loaddata != "" && loaddata != "undefined" ){
		// ロードデータの個別データへの分割
		splitLoadData(loaddata);
		old_servertime = servertime;
	}
	else{
		return;
	}

	//------------//
	// 拠点名取得 //
	//------------//
	// データ
	var data = document.evaluate('//div[@id="basepoint"]/span[@class="basename"]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	var pos;
	pos = -1;
	for( var i = 0; i < 10; i++ ){
		if( vname[i] == data.snapshotItem(0).textContent ){
			pos = i;
			break;
		}
	}

	//--------------//
	// 武将画像表示 //
	//--------------//
	if( pos >= 0 ){
		// サーバー時間の取得
		var data = document.evaluate('//span[@id="server_time"]',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		var time_text = data.snapshotItem(0).textContent;

		day = time_text.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/);
		servertime = new Date(parseInt(day[1],10),parseInt(day[2],10)-1,parseInt(day[3],10),parseInt(day[4],10),parseInt(day[5],10),parseInt(day[6],10),0);

		// 終了時間の取得
		day = old_servertime.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/);
		var divtime = new Date(parseInt(day[1],10),parseInt(day[2],10)-1,parseInt(day[3],10),parseInt(day[4],10),parseInt(day[5],10),parseInt(day[6],10),0);

		// 討伐ゲージ増分の計算
		var divgage = Math.floor((servertime.getTime() - divtime.getTime()) / 216000);
		var dispgage = parseInt(gage[pos]) + parseInt(divgage);
		if( parseInt(dispgage) > 500 ){
			dispgage = 500;
		}

		// 画像
		var gView = $e_19('//*[@id="generalView"]');
		fname[pos] = fname[pos].replace(/illust/, "deck");
		var gagelen = Math.floor(85 * (parseInt(gage[pos])/500));
		gView.snapshotItem(0).innerHTML = '<div class="illustMini">' +
						  '<a href="/card/domestic_setting.php#ptop">' +
						  /*'<img src="' + fname[pos] + '"/>' + 画像の大きさが鯖により違うのでサイズを指定したfaraway110530*/
						  '<img src="' + fname[pos] + '" width="85" height="120"/>' +
						  '</a>' +
						  '</div>' +
						  '<table bgcolor="white" width="85px">' +
						  '<b><font color="black" style="margin-left:2px">討伐: </font><font color="blue">' + dispgage + '</font></b>' +
						  '<p><img src="' + gage_icon + '" style="position:absolute;clip:rect(auto ' + gagelen + 'px 6px auto);" />' +
						  '</table>';

		// スキル使用時間が切れていたら終了時間をクリア
		if( servertime > limit[pos] ){
			skill[pos] = "";
			limit[pos] = "";
		}

		// スキル表示
		var gView2 = $e_19('//*[@id="generalView2"]');
		var text;
		if( (skill[pos] != "") && (skill[pos] != "undefined") ){
			text = '<b>使用中スキル</b><br><b><font color="blue">' + skill[pos] + '<br>(' + limit[pos] + ')</font></b>';
		}
		else{
			text = '<b>使用中スキル</b><br><b><font color="red">なし</font></b>';
		}
		gView2.snapshotItem(0).innerHTML = text;

		// 終了時間があるばあい、サーバー時間との差分をタイムアウト時間に設定する
		if( limit[pos] != "" ){
			var data;
			var time_text;
			var day;
			var limittime;
			var waittime;

			// サーバー時間の取得
			day = time_text.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/);
			servertime = new Date(parseInt(day[1],10),parseInt(day[2],10)-1,parseInt(day[3],10),parseInt(day[4],10),parseInt(day[5],10),parseInt(day[6],10),0);

			// 終了時間の取得
			time_text = limit[pos];
			day = time_text.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/);
			limittime = new Date(parseInt(day[1],10),parseInt(day[2],10)-1,parseInt(day[3],10),parseInt(day[4],10),parseInt(day[5],10),parseInt(day[6],10),0);

			// 待ち時間の算出
			waittime = limittime.getTime() - servertime.getTime();

			//--------------------------------------------//
			// 完了時刻まで待ってスキル表示を「なし」する //
			//--------------------------------------------//
			window.setTimeout(function() {
				//------------------------//
				// Cookie保存データの取得 //
				//------------------------//
				var loaddata = loadExecFlag_19(location.hostname, "GENE");
				if( loaddata != "" && loaddata != "undefined" ){
					// ロードデータの個別データへの分割
					splitLoadData(loaddata);
				}

				//------------//
				// 拠点名取得 //
				//------------//
				// データ
				var data = document.evaluate('//div[@id="basepoint"]/span[@class="basename"]',
					document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
				var pos;
				pos = -1;
				for( var i = 0; i < 10; i++ ){
					if( vname[i] == data.snapshotItem(0).textContent ){
						pos = i;
						break;
					}
				}

				//------------//
				// スキル表示 //
				//------------//
				if( pos >= 0 ){	// 念のため拠点名マッチチェック
					// スキル表示
					var gView2 = $e_19('//*[@id="generalView2"]');
					var text;
					text = '<b>使用中スキル</b><br><b><font color="red">なし</font></b>';
					gView2.snapshotItem(0).innerHTML = text;
				}
			}, waittime);
		}

		//----------------------------------//
		// 討伐ゲージをインターバル処理する //
		//----------------------------------//
		window.setInterval(function() {
			//------------------//
			// ゲージ差分の計算 //
			//------------------//
			// サーバー時間の取得
			var data = document.evaluate('//span[@id="server_time"]',
				document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
			var time_text = data.snapshotItem(0).textContent;

			day = time_text.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/);
			servertime = new Date(parseInt(day[1],10),parseInt(day[2],10)-1,parseInt(day[3],10),parseInt(day[4],10),parseInt(day[5],10),parseInt(day[6],10),0);

			// 終了時間の取得
			day = old_servertime.match(/(\d+)-(\d+)-(\d+) (\d+):(\d+):(\d+)/);
			var divtime = new Date(parseInt(day[1],10),parseInt(day[2],10)-1,parseInt(day[3],10),parseInt(day[4],10),parseInt(day[5],10),parseInt(day[6],10),0);

			// 討伐ゲージ増分の計算
			var divgage = Math.floor((servertime.getTime() - divtime.getTime()) / 216000);

			//------------------------//
			// Cookie保存データの取得 //
			//------------------------//
			var loaddata = loadExecFlag_19(location.hostname, "GENE");
			if( loaddata != "" && loaddata != "undefined" ){
				// ロードデータの個別データへの分割
				splitLoadData(loaddata);
			}

			//------------//
			// 拠点名取得 //
			//------------//
			// データ
			var data = document.evaluate('//div[@id="basepoint"]/span[@class="basename"]',
				document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
			var pos;
			pos = -1;
			for( var i = 0; i < 10; i++ ){
				if( vname[i] == data.snapshotItem(0).textContent ){
					pos = i;
					break;
				}
			}

			//------------//
			// スキル表示 //
			//------------//
			if( pos >= 0 ){	// 念のため拠点名マッチチェック
				// 討伐ゲージ差分を加算した値を算出
				var dispgage = parseInt(gage[pos]) + parseInt(divgage);
				if( parseInt(dispgage) > 500 ){
					dispgage = 500;
				}

				// 画像
				var gView = $e_19('//*[@id="generalView"]');
				fname[pos] = fname[pos].replace(/illust/, "deck");
				var gagelen = Math.floor(85 * (dispgage/500));
				gView.snapshotItem(0).innerHTML = '<div class="illustMini">' +
								  '<a href="/card/domestic_setting.php#ptop">' +
								  '<img src="' + fname[pos] + '"/>' +
								  '</a>' +
								  '</div>' +
								  '<table bgcolor="white" width="85px">' +
								  '<b><font color="black" style="margin-left:2px">討伐: </font><font color="blue">' + dispgage + '</font></b>' +
								  '<p><img src="' + gage_icon + '" style="position:absolute;clip:rect(auto ' + gagelen + 'px 6px auto);" />' +
								  '</table>';
			}
		}, 216000);  // 216秒ごとに1回まわる
	}
	else{
		// 内政武将なし

		// 画像
		var gView = $e_19('//*[@id="generalView"]');
		gView.snapshotItem(0).innerHTML = '<div>' +
						  '<a href="/card/deck.php#ptop">' +
						  '<img src="' + icon_m_19 + '"/>' +
						  '</a>' +
						  '</div>';
	}
}

//----------------//
// サーバ時間取得 //
//----------------//
function getServerTime(){
	// デッキ参照時のサーバー時間の取得
	servertime_t = document.evaluate('//span[@id="server_time"]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	servertime = servertime_t.snapshotItem(0).textContent;
}

//----------------//
// 保存データ分割 //
//----------------//
function splitLoadData(data){
	//----------------//
	// データの分割１ //
	//----------------//
	var d1 = data.split(DELIMIT1_19);
	servertime = d1[0];

	//----------------//
	// データの分割２ //
	//----------------//
	var ct = 0;
	for( var i = 1; i < d1.length; i++ ){
		var d2 = d1[i].split(DELIMIT2_19);
		vname[ct] = d2[0];
		fname[ct] = d2[1];
		rare[ct] = d2[2];
		gage[ct] = d2[3];
		skill[ct] = d2[4];
		limit[ct] = d2[5];

		ct = ct + 1;
	}

	return;
}

//----------------//
// 保存データ作成 //
//----------------//
function makeSaveData(vname,fname,rare,gage,skill,limit){
	var data;
	var data_d;

	data = "";

	// サーバ時間取得
	getServerTime();
	data = servertime;

	// 武将データ構築
	for( var i = 0; i < vname.length; i++ ){
		data_d = "";
		if( vname[i] != "" ){
			data_d = vname[i] + DELIMIT2_19 + fname[i] + DELIMIT2_19 + rare[i] + DELIMIT2_19 + gage[i] + DELIMIT2_19 + skill[i] + DELIMIT2_19 + limit[i];
			data = data + DELIMIT1_19 + data_d;
		}
	}

	// 作成した保存用データの返却
	return data;
}

//--------------//
// データロード //
//--------------//
function loadExecFlag_19(hostname, key) {
	var datakey = new String();
	datakey = hostname + VERSION_KEY_19 + key;
	var ret = new String();
	var src = CookieRead_19(datakey);
	if (src == "") return ret;

	return src;
}

//--------------//
// データセーブ //
//--------------//
function saveExecFlag_19(hostname, key, data) {

	var datakey = new String();
	datakey = hostname + VERSION_KEY_19 + key;

	CookieWrite_19(datakey, data, 30);
}

//----------------------//
// クッキーへの書き込み //
//----------------------//
function CookieWrite_19(kword, kdata, kday)
{
	if(!navigator.cookieEnabled){	// クッキーが利用可能かどうか
		alert("クッキーへの書き込みができません");
		return;
	}

	sday = new Date();
	sday.setTime(sday.getTime() + (kday * 1000 * 60 * 60 * 24));
	s2day = sday.toGMTString();
	document.cookie = kword + "=" + escape(kdata) + "; path=/;expires=" + s2day;
}

//----------------------//
// クッキーから読み込み //
//----------------------//
function CookieRead_19(kword)
{
	if(typeof(kword) == "undefined"){	// キーワードなし
		return "";	// 何もしないで戻る
	}

	kword = kword + "=";
	kdata = "";
	scookie = document.cookie + ";";	// クッキー情報を読み込む
	start = scookie.indexOf(kword);		// キーワードを検索
	if (start != -1){
		// キーワードと一致するものあり
		end = scookie.indexOf(";", start);	// 情報の末尾位置を検索
		kdata = unescape(scookie.substring(start + kword.length, end));	// データ取り出し
	}

	return kdata;
}

//----------//
// 空白除去 //
//----------//
function trim_19(str) {
	if (str == undefined) return "";
	return str.replace(/^[ 　\t\r\n]+|[ 　\t\r\n]+$/g, "");
}

//----------//
// 桁数整形 //
//----------//
function formatRightNumber_19( num, length ){
	var fix = '000000';
	var str;
	var result = '';

	str = num.toString(10);
	if( str.length < length ){
		result = fix.substr(0,length - str.length) + str;
	}
	else{
		result = str;
	}

	return result;
}
//faraway 19.都市画面内政武将表示ツール(βバージョン)のソース(bro3_display_adm_info.user.js)終了

//-----------------------------------------------------
// 書簡を4人以上の君主に送ることができるツール
//-----------------------------------------------------
function disp_mass_shokan_tool()
{
  if ( location.href.match(/.*\/message\/new\.php.*/) ) {
	process();
  }
}

//fires on user page
function process() {
	var table = document.getElementsByClassName("commonTables")[0];
	var div = document.createElement('div');
	div.align = 'center';
	div.innerHTML = '<a name="analysis"></a><input '
		+' value="&nbsp;複数宛に今すぐ送信&nbsp;"'
		+' type="button" id="mass_send"><span id="mass_send_help"> （←4人以上の君主に送るときはこちらをクリック！）</span>';

	// add button only once
	table.parentNode.appendChild(div);

	document.getElementById("mass_send").addEventListener("click",
		function() {
			var btn = document.getElementById("mass_send");
			btn.disabled = true;
			btn.value='送信中...';
			// trick to reflect change in UI
			setTimeout(function(){
				var to_obj = document.getElementById('to');
				var tos = to_obj.value.split(",");
				var table = document.getElementsByClassName("commonTables")[0];
				var subject_obj = table.getElementsByTagName('input')[1];
				var body_obj = table.getElementsByTagName('textarea')[0];
				var check_obj = document.getElementById('gray02Wrapper').getElementsByTagName('input')[4];
				var body = body_obj.value;
				var body2 = body.replace(/#ptop/g, "");
				sendMessages(tos,subject_obj.value,body2);
				document.getElementById('mass_send_help').innerHTML = '（送信が完了しました。<a href="/message/outbox.php#ptop">送信履歴</a>をご確認ください。）';
				var btn = document.getElementById("mass_send");
				btn.value='送信済み';
				to_obj.disabled = true;
				subject_obj.disabled = true;
				body_obj.disabled = true;
				check_obj.disabled = true;
			}, 10);
		},true
	);
}

function sendMessages(tos,subject_text,body_text) {
	for ( var i=0; i<tos.length; i++ ) {
		send_message(tos[i],subject_text,body_text);
	}
}

function send_message(to,subject_text,body_text) {
	wrapHttpReq("http://" + location.hostname + "/message/new.php",
				"POST",
				"to=" + to + "&subject=" + subject_text + "&body=" + body_text + "&reply_flg=&reply_message_id=&btn_preview=" + escape("確認"),
		function(response) {
			send_message2(response);
		},
		1  // 同期通信
	);
}

function send_message2(request) {
	var RegRowgray		= new RegExp("");
	var RegRowformstart	= new RegExp("");
	var RegRowformend	= new RegExp("");
	var RegRowinput		= new RegExp("");
	var RegRowsubmit	= new RegExp("");
	var RegRowinputbodystart= new RegExp("");
	var RegRowinputbodyend	= new RegExp("");

	RegRowgray.compile		  (/^.*<div [^<>]*id=["']gray02Wrapper["'][^>]*>.*$/);
	RegRowformstart.compile	 (/^.*<form name="message" method="post" action=["']([^"']*)["'][^>]*>.*$/);
	RegRowformend.compile	   (/^.*<\/form[^>]*>.*$/);
	RegRowinput.compile		 (/^.*<input [^<>]*name=["']([^"']*)["'][^>]*value=["']([^"']*)["'][^>]*>.*$/);
	RegRowinputbodystart.compile(/^.*<input type=["']hidden["'] name=["']body["'][^>]*value=["']([^"'>]*)$/);
	RegRowinputbodyend.compile	(/^(.*)["'] +\/>$/);
	RegRowsubmit.compile		(/^.*<input [^<>]*type="submit"[^>]*name=["']([^"']*)["'][^>]*>.*$/);

	var resTexts = request.split("\n");
	var flag_gray=0;
	var flag_form=0;
	var flag_submit=0;
	var flag_body=0;
	var path="";
	var postdatas = new Object();
	for(i in resTexts){
		if (flag_gray==1 || resTexts[i].match(RegRowgray)){
			flag_gray=1;
			if (flag_form==1 || resTexts[i].match(RegRowformstart)){
				if(flag_form==0){path=RegExp.$1;flag_form=1;}
				else if(resTexts[i].match(RegRowsubmit))		{flag_submit=1;break;}
				else if(resTexts[i].match(RegRowinput))		 {postdatas[RegExp.$1]=RegExp.$2;}
				else if(resTexts[i].match(RegRowinputbodystart)){postdatas["body"]	=  RegExp.$1+"\n";flag_body=1;}
				else if(flag_body==1 && resTexts[i].match(RegRowinputbodyend))	{postdatas["body"] += RegExp.$1;flag_body=0;}
				else if(flag_body==1)						   {postdatas["body"] +=  resTexts[i]+"\n";}
				else if(resTexts[i].match(RegRowformend))	   {flag_form=0;break;}
			}
		}
	}

	wrapHttpReq("http://" + location.hostname + "/message/new.php",
				"POST",
				"ssid=" + postdatas["ssid"] + "&to=" + postdatas["to"] + "&subject=" + postdatas["subject"] + "&body=" + postdatas["body"] + "&reply_flg=&reply_message_id=&btn_send=" + escape("送信"),
		function(response) {
		}
	);
}

//faraway 20.書簡を4人以上の君主に送ることができるツールのソース(bro3_mass_shokan_tool.user.js)終了

//----------------------------------------------------------------------------------
// 武将カード分類ツール
//----------------------------------------------------------------------------------
function disp_deck_tool()
{
	jQuery.noConflict();
var d_21 = document;
var $_21 = jQuery;
var $xp_21 = function (xp, dc) { return d_21.evaluate(xp, dc, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); }
var $xp1_21 = function (xp, dc) { return d_21.evaluate(xp, dc, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; }
var location_deckURL = "/card/deck.php";
var location_tradeCardURL = "/card/trade_card.php";
var location_duelURL = "/card/duel_set.php";
var location_unionIndexURL = "/union/index.php";
var location_unionLearnURL = "/union/learn.php";
var location_unionLvupURL = "/union/lvup.php";
var location_unionRemoveURL = "/union/remove.php";
var worldKey_21 = location.hostname;	// GM保存領域ワールドキー
var selectedGroup = "full";			// 分類表示キー
var tableMode = "skill";			// 一覧表示キー
var hrefArray_21 = [];					// ページ読み込みURL
var currentDeckCardList = [];		// デッキ内カードリスト
var fileCardList = [];				// ファイル内カードリスト
var data_index = 1;					//
// 以下、GM変数
var cardGroupArray = [];
var cardGroup1 = [];
var cardGroup2 = [];
var cardGroup3 = [];
var cardGroup4 = [];
var cardGroup5 = [];
var cardGroup6 = [];
var cardGroup7 = [];
var cardGroup8 = [];
var cardGroup9 = [];
var cardGroup10 = [];

////////////////////////////////////////////////////////
// ページ読み込み完了を待たない処理
////////////////////////////////////////////////////////
// 対象ページでない場合処理中断
if (!(location.pathname == location_deckURL
	|| location.pathname == location_tradeCardURL
	|| location.pathname == location_duelURL
	|| location.pathname == location_unionIndexURL
	|| location.pathname == location_unionLearnURL
	|| location.pathname == location_unionLvupURL
	|| location.pathname == location_unionRemoveURL)) {
	return;
}
// 各種チェック
if (!pre_check_21()) {
	// 確認用
	//alert("初期チェックでエラー。要ログ確認")
	return;
}
function pre_check_21() {
	if (!worldKey_21) { console.log("ワールドキー取得エラー"); return false; }

	var time_checker = new Date().toString();
	GM_setValue(worldKey_21 + "time_checker", time_checker.toSource());
	var res_time_checker = eval(GM_getValue(worldKey_21 + "time_checker", ""));
	if (time_checker != res_time_checker) {
		console.log("GM変数の利用エラー");
		console.log("　：" + time_checker);
		console.log("　：" + res_time_checker);
		return false;
	}

	if (!$_21) { console.log("jquery取得エラー"); return false; }
	return true;
}
// GM変数ロード
loadCmValue_21();

// ページ読み込み完了後に本処理開始
window.addEventListener("load", function() { pre_main_21(); }, false);

////////////////////////////////////////////////////////
// デッキ画面、デュエル画面、トレード画面・合成画面で分岐処理
////////////////////////////////////////////////////////
function pre_main_21() {
	// ページリンクがない場合、１ページ目でない場合には処理中断。
	var pagerNode = $xp1_21('//ul[@class="pager"]', d_21);

	addCommonStyle();
	if (location.pathname == location_deckURL) {
		addBtns_deckPage();
	} else if (location.pathname == location_duelURL) {
		addBtns_duelPage();
	} else if (location.pathname == location_tradeCardURL
			|| location.pathname == location_unionIndexURL
			|| location.pathname == location_unionLearnURL
			|| location.pathname == location_unionLvupURL
			|| location.pathname == location_unionRemoveURL){
		addBtns_commonPage();
	}
}

////////////////////////////////////////////////////////
// デッキ画面処理
////////////////////////////////////////////////////////
function addBtns_deckPage() {
	// 上部一覧表示付加
	var targetNode = $xp1_21('//div[@id="gray02Wrapper"]/h2[1]', d_21);
		targetNode.innerHTML = "【" + targetNode.innerHTML + "：一覧表示】";
		targetNode.addEventListener("click", function() {
			createLayout();
			getDeckCardInfo();
		}, false);
	// 下部セレクター付加
	var pagerNode = $xp1_21('//ul[@class="pager"]', d_21);
	var groupViewSelectEL = createGroupSelecter(function() {
		tmp = groupViewSelectEL.options[groupViewSelectEL.selectedIndex].value;
		if (tmp == "") { return; }
		selectedGroup = tmp;
		createLayout();
		$_21("#brotool_baseEL").hide();

		if (hrefArray_21.length <= 0) {
			getFileCardInfo();
		} else {
			viewCardGroup();
		}
	});
	pagerNode.appendChild(groupViewSelectEL);
}
// デッキ内カードの一覧情報を作成
function getDeckCardInfo() {
	if (currentDeckCardList.length <= 0) {
		getDeckCardList();
		var tbodyEL = $xp1_21('//table[@id="brotool_deckTableEL"]/tbody', d_21);
		createTableData(tbodyEL, currentDeckCardList);
		$_21("#brotool_deckTableEL").tablesorter( { headers: {
			9: { sorter:"digit"},
			10: { sorter:"digit"},
			11: { sorter:"digit"},
			12: { sorter:"digit"},
			13: { sorter:"digit"},
			14: { sorter:"digit"},
			15: { sorter:"digit"},
		}} );
	}
	$_21("#brotool_baseEL").slideDown();
}
function getDeckCardList() {
	var deckCardListNodes = $xp_21('//div[@id="cardListDeck"]//div[@class="cardColmn"]', d_21);

	for (var i = 0, len = deckCardListNodes.snapshotLength; i < len; i++) {
		var cardInfo = getCardInfoNormal(deckCardListNodes.snapshotItem(i));
		currentDeckCardList.push(cardInfo);
	}
}
// ファイル内の全ページ読み込み
function getFileCardInfo(){
	if (hrefArray_21.length > 0) { return; }

	// 現ページ
	var tmpFileCardList = getFileCardList();
	var tbodyEL = $xp1_21('//table[@id="brotool_fileTableEL"]/tbody', d_21);
	createTableData(tbodyEL, tmpFileCardList);
	for (var i = 0, len = tmpFileCardList.length; i < len; i++) { fileCardList.push(tmpFileCardList[i]) }
	// 現ページ以降
	var pagerNode = $xp1_21('//ul[@class="pager"]', d_21);
	var lastPageNode = $xp1_21('descendant::a[@title="last page"]', pagerNode);
	if (!lastPageNode) { return; }
	var lastPageHref = lastPageNode.href;
	var lastPageNo = lastPageHref.match(/p=[0-9]+/)[0];
	var len = parseInt(lastPageNo.match(/[0-9]+/)[0]) + 1;

	for (var i = 2; i < len; i++) {
		hrefArray_21.push(lastPageHref.replace(/p=[0-9]+/, "p=" + i));
	}
	loadPage_deck(0);
}
////////////////////////////////////////////////////////
// デュエル画面処理
////////////////////////////////////////////////////////
function addBtns_duelPage() {
	var pagerNode = $xp1_21('//ul[@class="pager"]', d_21);
	var groupViewSelectEL = createGroupSelecter(function() {
		tmp = groupViewSelectEL.options[groupViewSelectEL.selectedIndex].value;
		if (tmp == "") { return; }
		selectedGroup = tmp;

		if (hrefArray_21.length <= 0) {
			d_getFileCardInfo();
		} else {
			viewCardGroup();
		}
	});
	pagerNode.appendChild(groupViewSelectEL);
}
function d_getFileCardInfo(){
	if (hrefArray_21.length > 0) { return; }

	// 現ページ
	d_getFileCardList();
	// 現ページ以降
	var pagerNode = $xp1_21('//ul[@class="pager"]', d_21);
	var lastPageNode = $xp1_21('descendant::a[@title="last page"]', pagerNode);
	if (!lastPageNode) { return; }
	var lastPageHref = lastPageNode.href;
	var lastPageNo = lastPageHref.match(/p=[0-9]+/)[0];
	var len = parseInt(lastPageNo.match(/[0-9]+/)[0]) + 1;

	for (var i = 2; i < len; i++) {
		hrefArray_21.push(lastPageHref.replace(/p=[0-9]+/, "p=" + i));
	}
	d_loadPage(0);
}
function d_loadPage (loadNo) {
	var opt = {
		method: 'get',
		url: hrefArray_21[loadNo],
		onload: function(res) {
			d_addPageElement(loadNo, res);
		}
	}
	GM_xmlhttpRequest(opt);
}
function d_addPageElement(loadNo, res) {
	var targetNode = $xp1_21('//div[@class="rotateInfo bottom clearfix"]', d_21);//ひろ120516

	var fillterEL = d_21.createElement('html');
		fillterEL.innerHTML = res.responseText;
	var pageBarNode = $xp1_21('descendant::div[@class="rotateInfo bottom clearfix"]', fillterEL);//ひろ120516

		targetNode.parentNode.appendChild(pageBarNode);

	d_getFileCardList(fillterEL);
	// つなげて表示
	var cardFileNode = $xp1_21('descendant::div[@id="cardFileList"]', fillterEL);
	if (!!cardFileNode) {
		targetNode.parentNode.appendChild(cardFileNode);
	} else {
		var cardNodes = $xp_21('descendant::div[@class="cardStatusDetail label-setting-mode"]', fillterEL);
		for (var i = 0, len = cardNodes.snapshotLength; i < len; i++) {
			targetNode.parentNode.appendChild(cardNodes.snapshotItem(i));
		}
	}

	if (loadNo + 1 >= hrefArray_21.length) {
		targetNode.parentNode.appendChild(pageBarNode.cloneNode(true));
		return;
	}
	d_loadPage(loadNo + 1);
}
function d_getFileCardList(targetOp) {
	if (!targetOp) { targetOp = d_21 }
	var cardNodes = $xp_21('descendant::div[@class="cardStatusDetail label-setting-mode"]', targetOp);

	// 通常表示
	var normalFileCardListNodes = $xp_21('descendant::div[@id="cardFileList"]//div[@class="cardColmn"]', targetOp);
	for (var i = 0, len = normalFileCardListNodes.snapshotLength; i < len; i++) {
		d_getCardInfoNormal(normalFileCardListNodes.snapshotItem(i));
	}
	// 縮小表示
	var miniFileCardListNodes = $xp_21('descendant::div[@class="cardStatusDetail label-setting-mode"]', targetOp);
	for (var i = 0, len = miniFileCardListNodes.snapshotLength; i < len; i++) {
		d_getCardInfoMini(miniFileCardListNodes.snapshotItem(i));
	}
}
function d_getCardInfoMini(cardStatusDetail) {
	// 分類識別要素付加
	var spanEL = d_21.createElement("span");
		spanEL.id = "brotool_cardGroup" + checkCardGroup(d_getUqId(cardStatusDetail));
		cardStatusDetail.appendChild(spanEL);
	if (selectedGroup != "full" && spanEL.id != "brotool_" + selectedGroup) {
		cardStatusDetail.style.display = "none";
	}
}
function d_getCardInfoNormal(cardColmn) {
	// 分類識別要素付加
	if (cardColmn.parentNode.id == "cardFileList") {
		var spanEL = d_21.createElement("span");
			spanEL.id = "brotool_cardGroup" + checkCardGroup(d_getUqId(cardColmn));
			cardColmn.appendChild(spanEL);
		if (selectedGroup != "full" && spanEL.id != "brotool_" + selectedGroup) {
			cardColmn.style.display = "none";
		}
	}
	// 裏返し処理差し替え
	var exeA = $_21("a[href^=javascript:executeA(]", cardColmn).get(0);
	var exeB = $_21("a[href^=javascript:executeB(]", cardColmn).get(0);
	if (!!exeA && !!exeB) {
		var num = exeA.href.match(/[0-9]+/)[0];
		exeA.href="javascript:void(0)";
		exeA.addEventListener("click", function() {$_21("[id=card_frontback" + num + "-front]").hide();$_21("[id=card_frontback" + num + "-back]").show();}, false);
		exeB.href="javascript:void(0)";
		exeB.addEventListener("click", function() {$_21("[id=card_frontback" + num + "-front]").show();$_21("[id=card_frontback" + num + "-back]").hide();}, false);
	}
}
function d_getUqId (nodes) {
	// ファイル操作イベントからカードIDを取得
	onClickNode = $xp1_21('descendant::img[@class="aboutdeck" and @onClick]', nodes);
	if (!onClickNode) { return null; }
	var splitArray = onClickNode.getAttribute('onClick').split(",");
	var cardId = splitArray[1].replace(/^\s+|\s+$/g, "");
	return cardId;
}
////////////////////////////////////////////////////////
// トレード画面、合成画面での共通処理
////////////////////////////////////////////////////////
function addBtns_commonPage() {
	var naviNode = $xp1_21('//ul[@class="navi"]', d_21);
	if (!naviNode) { return; }
	var groupViewSelectEL = createGroupSelecter(function() {
		tmp = groupViewSelectEL.options[groupViewSelectEL.selectedIndex].value;
		if (tmp == "") { return; }
		selectedGroup = tmp;
		if (hrefArray_21.length <= 0) {
			c_getFullCardView();
		} else {
			viewCardGroup();
		}
	});
	naviNode.appendChild(groupViewSelectEL);
}
function c_getFullCardView(){
	if (hrefArray_21.length > 0) { return; }
	// 現ページ
	c_getFileCardList();
	// 現ページ以降
	var pagerNode = $xp1_21('//ul[@class="pager"]', d_21);
	var lastPageNode = $xp1_21('descendant::a[@title="last page"]', pagerNode);
	if (!lastPageNode) { return; }
	var lastPageHref = lastPageNode.href;
	var lastPageNo = lastPageHref.match(/p=[0-9]+/)[0];
	var len = parseInt(lastPageNo.match(/[0-9]+/)[0]) + 1;

	for (var i = 2; i < len; i++) {
		hrefArray_21.push(lastPageHref.replace(/p=[0-9]+/, "p=" + i));
	}
	c_loadPage(0);
}
function c_loadPage (loadNo) {
	var opt = {
		method: 'get',
		url: hrefArray_21[loadNo],
		onload: function(res) {
			c_addPageElement(loadNo, res);
		}
	}
	GM_xmlhttpRequest(opt);
}
function c_addPageElement(loadNo, res) {
	var targetNode = $xp1_21('//div[@id="cardFileList"]', d_21);
	var fillterEL = d_21.createElement('html');fillterEL.innerHTML = res.responseText;

	// 一覧情報回収
	c_getFileCardList(fillterEL);

	// つなげて表示
	var cardNodes = $xp_21('descendant::div[@id="cardFileList"]//div[@class="cardColmn"]', fillterEL);
	for (var i = 0, len = cardNodes.snapshotLength; i < len; i++) {
		targetNode.appendChild(cardNodes.snapshotItem(i));
	}

	if (loadNo + 1 >= hrefArray_21.length) {
		return;
	}
	c_loadPage(loadNo + 1);
}
function c_getFileCardList(targetOp) {
	if (!targetOp) { targetOp = d_21 }
	var normalFileCardListNodes = $xp_21('descendant::div[@id="cardFileList"]//div[@class="cardColmn"]', targetOp);
	for (var i = 0, len = normalFileCardListNodes.snapshotLength; i < len; i++) {
		var cardColmn = normalFileCardListNodes.snapshotItem(i);
		var uqId = c_getUqId(cardColmn);
		// 分類識別要素付加
		var spanEL = d_21.createElement("span");
			spanEL.id = "brotool_cardGroup" + checkCardGroup(uqId);
			cardColmn.appendChild(spanEL);
		if (selectedGroup != "full" && spanEL.id != "brotool_" + selectedGroup) {
			cardColmn.style.display = "none";
		}
		// 裏返し処理差し替え ※トレード画面のみ、合成画面はそのまま
		if(location.pathname == location_tradeCardURL) {
			var exeA = $_21("a[href^=javascript:executeA(]", cardColmn).get(0);
			var exeB = $_21("a[href^=javascript:executeB(]", cardColmn).get(0);
			if (!!exeA && !!exeB) {
				var num = exeA.href.match(/[0-9]+/)[0];
				exeA.href="javascript:void(0)";
				exeA.addEventListener("click", (function(num) {return function() {$_21("[id=card_frontback" + num + "-front]").hide();$_21("[id=card_frontback" + num + "-back]").show();}})(num), false);
				exeB.href="javascript:void(0)";
				exeB.addEventListener("click", (function(num) {return function() {$_21("[id=card_frontback" + num + "-front]").show();$_21("[id=card_frontback" + num + "-back]").hide();}})(num), false);
			}
		}
	}
}
function c_getUqId (nodes) {
	var onClickNode = $xp1_21('descendant::a[@class="setTrade" or @class="useUnion" or @class="deleteSkillTp"]', nodes);
	if (!!onClickNode) {
		var cardId = onClickNode.getAttribute('onClick').split("(")[1].split(")")[0];return cardId;
	}
	var onClickNode = $xp1_21('descendant::a[@class="skillLvUp" or @class="skillLearn" or @class="skillDelete"]', nodes);
	if (!!onClickNode) {
		var cardId = onClickNode.href.split("=")[1].split("#")[0];return cardId;
	}
	return null;
}
////////////////////////////////////////////////////////
// デッキ画面の基底レイアウト作成関数
////////////////////////////////////////////////////////
function createLayout() {
	var baseEL = $xp1_21('//div[@id="brotool_baseEL"]', d_21);
	if (!baseEL) {
		baseEL =  d_21.createElement("div");baseEL.id = "brotool_baseEL";baseEL.className = "baseDiv";baseEL.style.display = "none";
		var targetNode = $xp1_21('//div[@id="whiteWrapper"]', d_21);targetNode.insertBefore(baseEL, targetNode.firstChild);

		var showBaseEL = d_21.createElement("div");showBaseEL.id = "brotool_showBaseEL";showBaseEL.className = "baseDiv";
		var showDeckEL = d_21.createElement("div");showDeckEL.id = "brotool_showDeckEL";showDeckEL.className = "baseDiv";
		var showbtnsEL = d_21.createElement("div");showbtnsEL.id = "brotool_showbtnEL";	showbtnsEL.className = "baseDiv";
		var showFileEL = d_21.createElement("div");showFileEL.id = "brotool_showFileEL";showFileEL.className = "baseDiv";
		var opBaseEL = d_21.createElement("div");opBaseEL.id = "brotool_opBaseEL";opBaseEL.className = "baseDiv";

		createTopBtnLayout();
		baseEL.appendChild(showBaseEL);baseEL.appendChild(opBaseEL);
		showBaseEL.appendChild(showDeckEL);showBaseEL.appendChild(showbtnsEL);showBaseEL.appendChild(showFileEL);

		createTableLayout();
		createMiddleBtnLayout();
		createOptionLayout();

		showFileEL.style.display = "none";opBaseEL.style.display = "none";
	}
	// 【先頭ボタン】レイアウト
	function createTopBtnLayout() {
		var infoBtnEL = d_21.createElement("input");
			infoBtnEL.type = "button";infoBtnEL.value = "【一覧情報】";infoBtnEL.disabled = true;
			infoBtnEL.addEventListener("click", function() {
				infoBtnEL.disabled = true;opBtnEL.disabled = false;
				$_21("#brotool_showBaseEL").slideDown();$_21("#brotool_opBaseEL").hide();
			}, false);
		var opBtnEL = d_21.createElement("input");
			opBtnEL.type = "button";opBtnEL.value = "【設定情報】";
			opBtnEL.addEventListener("click", function() {infoBtnEL.disabled = false;opBtnEL.disabled = true;$_21("#brotool_showBaseEL").hide();$_21("#brotool_opBaseEL").slideDown();}, false);
		var closeBtnEL = d_21.createElement("input");
			closeBtnEL.type = "button";closeBtnEL.value = "【この一覧を閉じる】";
			closeBtnEL.addEventListener("click", function() {$_21("#brotool_baseEL").slideUp();}, false);
		baseEL.appendChild(infoBtnEL);
		baseEL.appendChild(opBtnEL);
		baseEL.appendChild(closeBtnEL);
	}
	// 【テーブル情報】レイアウト
	function createTableLayout() {
		showDeckEL.appendChild(d_21.createTextNode("【デッキ内カード情報】"))
		var deckTableEL = d_21.createElement("table");deckTableEL.id = "brotool_deckTableEL";deckTableEL.className = "showTable";
		var theadEL	 = d_21.createElement("thead");deckTableEL.appendChild(theadEL);
		var tbodyEL	 = d_21.createElement("tbody");deckTableEL.appendChild(tbodyEL);createTableHead(theadEL);

		showFileEL.appendChild(d_21.createTextNode("【ファイル内カード情報】"));
		var fileTableEL = d_21.createElement("table");fileTableEL.id = "brotool_fileTableEL";fileTableEL.className = "showTable";
		var theadEL = d_21.createElement("thead");fileTableEL.appendChild(theadEL);
		var tbodyEL = d_21.createElement("tbody");fileTableEL.appendChild(tbodyEL);createTableHead(theadEL);

		showDeckEL.appendChild(deckTableEL);
		showFileEL.appendChild(fileTableEL);
	}
	// 【中間ボタン】レイアウト
	function createMiddleBtnLayout() {
		var modeParamBtn = d_21.createElement("input");
			modeParamBtn.type = "button";
			modeParamBtn.id = "brotool_modeParamBtn"
			modeParamBtn.value = "【パラメータ表示】";
			modeParamBtn.addEventListener("click", function() {
				modeParamBtn.disabled = true;
				modeSkillBtn.disabled = false;
				changeTableMode("param");
			}, false);
		var modeSkillBtn = d_21.createElement("input");
			modeSkillBtn.type = "button";
			modeSkillBtn.id = "brotool_modeSkillBtn"
			modeSkillBtn.value = "【スキル表示】";
			modeSkillBtn.addEventListener("click", function() {
				modeParamBtn.disabled = false;
				modeSkillBtn.disabled = true;
				changeTableMode("skill");
			}, false);
		var allShowBtn = d_21.createElement("input");
			allShowBtn.type = "button";
			allShowBtn.id = "brotool_allShowBtn"
			allShowBtn.value = "【ファイル内カード情報表示】";
			allShowBtn.addEventListener("click", function() {
				allShowBtn.disabled = true;
				getFileCardInfo();
				$_21("#brotool_showFileEL").slideDown();
			}, false);
		var setGroupBtn = d_21.createElement("input");
			setGroupBtn.type = "button";
			setGroupBtn.id = "brotool_setGroupBtn";
			setGroupBtn.value = "【カード分類登録】";
			setGroupBtn.addEventListener("click", function() {
				if (confirm("カード分類を登録します。")) {
					saveCmValue_21();
					alert("登録完了。\n新しい分類による絞り込みは次回以降有効化されます。");
				}
			}, false);
		var groupViewSelectEL = createGroupSelecter(function() {
			tmp = groupViewSelectEL.options[groupViewSelectEL.selectedIndex].value;
			if (tmp == "") { return; }
			selectedGroup = tmp;
			viewCardGroup();
		});
		if (tableMode == "param") {
			modeParamBtn.disabled = true;
			modeSkillBtn.disabled = false;
		} else if (tableMode == "skill") {
			modeParamBtn.disabled = false;
			modeSkillBtn.disabled = true;
		} else {
			modeParamBtn.disabled = false;
			modeSkillBtn.disabled = false;
		}

		showbtnsEL.appendChild(modeParamBtn);
		showbtnsEL.appendChild(modeSkillBtn);
		showbtnsEL.appendChild(d_21.createTextNode("　／　"));
		showbtnsEL.appendChild(allShowBtn);
		showbtnsEL.appendChild(setGroupBtn);
		showbtnsEL.appendChild(d_21.createTextNode("　／　"));
		showbtnsEL.appendChild(groupViewSelectEL);
	}
	// 【設定情報】レイアウト
	function createOptionLayout() {
		opBaseEL.appendChild(d_21.createTextNode("【設定等々】"));
		opBaseEL.appendChild(d_21.createElement("br"));
		opBaseEL.appendChild(d_21.createTextNode("　１．カード分類名称を下記に"));
		var renameGroupBtn = d_21.createElement("input");
			renameGroupBtn.type = "button";
			renameGroupBtn.id = "brotool_renameGroupBtn"
			renameGroupBtn.value = "【変更する】";
			renameGroupBtn.addEventListener("click", function() {
				if (confirm("カード分類名称を変更します。")) {
					for (var i = 0, len = cardGroupArray.length; i < len; i++) {
						cardGroupArray[i][1] = $_21("#brotool_renameGroup_" + cardGroupArray[i][0]).val();
					}
					saveCmValue_21();
					alert("変更完了。\n新しい分類名称は次回以降有効化されます。")
				}
			}, false);
		opBaseEL.appendChild(renameGroupBtn);
		opBaseEL.appendChild(d_21.createElement("br"));
		for (var i = 0, len = cardGroupArray.length; i < len; i++) {
			opBaseEL.appendChild(d_21.createElement("br"));
			opBaseEL.appendChild(d_21.createTextNode("　　" + (i+1) + ".【新】"));
			var textEL = d_21.createElement("input");
				textEL.type = "text";
				textEL.size = 10;
				textEL.value = cardGroupArray[i][1];
				textEL.id = "brotool_renameGroup_" + cardGroupArray[i][0];
			opBaseEL.appendChild(textEL);
			opBaseEL.appendChild(d_21.createTextNode("　【旧】" + cardGroupArray[i][1]));
		}

		opBaseEL.appendChild(d_21.createElement("br"));
		opBaseEL.appendChild(d_21.createElement("br"));
		opBaseEL.appendChild(d_21.createTextNode("　２．現ワールドのカード分類情報を"));
	var resetBtn = d_21.createElement("input");
		resetBtn.type = "button";
		resetBtn.id = "brotool_resetBtn";
		resetBtn.value = "【リセットする】";
		resetBtn.addEventListener("click", function() {
			resetBtn.disabled = true;
			if (confirm("保存してある本ワールドのカード分類情報のすべてをクリアします。")) {
				if (confirm("【再確認】本ワールドのカード分類情報のすべてをクリアします。")) {
					resetCmValue();
					alert("リセット完了しました。");
					location.href= "../card/deck.php";
				} else {
					resetBtn.disabled = false;
				}
			} else {
				resetBtn.disabled = false;
			}
		}, false);
		opBaseEL.appendChild(resetBtn);

		opBaseEL.appendChild(d_21.createElement("br"));
		opBaseEL.appendChild(d_21.createElement("br"));
		opBaseEL.appendChild(d_21.createTextNode("　３．本スクリプトの最新版などは→をご確認ください　・ｗ・　"));
		var aEL = d_21.createElement("a");
			aEL.innerHTML = "<font color='blue'><u>Project.殺伐</u></font>";
			aEL.href = "http://aoyamayuuto.blog92.fc2.com/";
			aEL.target = "_blank";
		opBaseEL.appendChild(aEL);
		opBaseEL.appendChild(d_21.createElement("br"));
		opBaseEL.appendChild(d_21.createElement("br"));
	}
}
////////////////////////////////////////////////////////
// ページ読み込み関数
////////////////////////////////////////////////////////
function loadPage_deck (loadNo) {
	var opt = {
		method: 'get',
		url: hrefArray_21[loadNo],
		onload: function(res) {
			addPageElement_deck(loadNo, res);
		}
	}
	GM_xmlhttpRequest(opt);
}
function addPageElement_deck(loadNo, res) {
	var targetNode = $xp1_21('//div[@class="rotateInfo clearfix label-all-color-inner"]', d_21);
	var fillterEL = d_21.createElement('html');
		fillterEL.innerHTML = res.responseText;
	var pageBarNode = $xp1_21('descendant::div[@class="rotateInfo clearfix label-all-color-inner"]', fillterEL);
		targetNode.parentNode.appendChild(pageBarNode);

	// 一覧情報回収
	var tmpFileCardList = getFileCardList(fillterEL);
	var tbodyEL = $xp1_21('//table[@id="brotool_fileTableEL"]/tbody', d_21);
	createTableData(tbodyEL, tmpFileCardList);
	for (var i = 0, len = tmpFileCardList.length; i < len; i++) {
		fileCardList.push(tmpFileCardList[i]);
	}

	// つなげて表示
	var cardFileNode = $xp1_21('descendant::div[@id="cardFileList"]', fillterEL);
	if (!!cardFileNode) {
		targetNode.parentNode.appendChild(cardFileNode);
	} else {
		var cardNodes = $xp_21('descendant::div[@class="cardStatusDetail label-setting-mode"]', fillterEL);
		for (var i = 0, len = cardNodes.snapshotLength; i < len; i++) {
			targetNode.parentNode.appendChild(cardNodes.snapshotItem(i));
		}
	}

	if (loadNo + 1 >= hrefArray_21.length) {
		targetNode.parentNode.appendChild(pageBarNode.cloneNode(true));
		$_21("#brotool_fileTableEL").tablesorter( { headers: {
			9: { sorter:"digit"},
			10: { sorter:"digit"},
			11: { sorter:"digit"},
			12: { sorter:"digit"},
			13: { sorter:"digit"},
			14: { sorter:"digit"},
			15: { sorter:"digit"},
		}} );
		return;
	}
	loadPage_deck(loadNo + 1);
}
////////////////////////////////////////////////////////
// カード情報回収関数
////////////////////////////////////////////////////////
function getFileCardList(targetOp) {
	if (!targetOp) { targetOp = d_21 }
	var cardNodes = $xp_21('descendant::div[@class="cardStatusDetail label-setting-mode"]', targetOp);

	var res_FileCardList = [];
	// 通常表示
	var normalFileCardListNodes = $xp_21('descendant::div[@id="cardFileList"]//div[@class="cardColmn"]', targetOp);
	for (var i = 0, len = normalFileCardListNodes.snapshotLength; i < len; i++) {
		var cardInfo = getCardInfoNormal(normalFileCardListNodes.snapshotItem(i));
		res_FileCardList.push(cardInfo);
	}
	// 縮小表示
	var miniFileCardListNodes = $xp_21('descendant::div[@class="cardStatusDetail label-setting-mode"]', targetOp);
	for (var i = 0, len = miniFileCardListNodes.snapshotLength; i < len; i++) {
		var cardInfo = getCardInfoMini(miniFileCardListNodes.snapshotItem(i));
		res_FileCardList.push(cardInfo);
	}
	return res_FileCardList;
}
function getCardInfoMini(cardStatusDetail) {
console.log("mini");
	var cardInfo = {};
	cardInfo["cardno"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[1]/td[1]', cardStatusDetail).innerHTML;
	cardInfo["status_att"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[1]/td[2]', cardStatusDetail).innerHTML;
	cardInfo["name"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[2]/td[1]', cardStatusDetail).innerHTML;
	cardInfo["status_int"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[2]/td[2]', cardStatusDetail).innerHTML;
	cardInfo["level"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[3]/td[1]', cardStatusDetail).innerHTML;
	cardInfo["status_wdef"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[3]/td[2]', cardStatusDetail).innerHTML;
	cardInfo["cost"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[4]/td[1]', cardStatusDetail).innerHTML;
	cardInfo["status_sdef"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[4]/td[2]', cardStatusDetail).innerHTML;
	cardInfo["soltype"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[5]/td[1]', cardStatusDetail).innerHTML;
	cardInfo["status_bdef"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[5]/td[2]', cardStatusDetail).innerHTML;
	cardInfo["status_hp"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[6]/td[1]', cardStatusDetail).innerHTML;
	cardInfo["status_rdef"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[6]/td[2]', cardStatusDetail).innerHTML;
	cardInfo["para"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[7]/td[1]', cardStatusDetail).innerHTML;
	cardInfo["status_speed"] = $xp1_21('descendant::table[@class="statusParameter1"]/tbody/tr[7]/td[2]', cardStatusDetail).innerHTML;

	var skillName1 = $xp1_21('descendant::table[@class="statusParameter2"]/tbody/tr[3]/td[1]', cardStatusDetail);
	var skillName2 = $xp1_21('descendant::table[@class="statusParameter2"]/tbody/tr[4]/td[1]', cardStatusDetail);
	var skillName3 = $xp1_21('descendant::table[@class="statusParameter2"]/tbody/tr[5]/td[1]', cardStatusDetail);
	var skillName4 = $xp1_21('descendant::table[@class="statusParameter2"]/tbody/tr[6]/td[1]', cardStatusDetail);

	if (skillName1.innerHTML == "") {
		cardInfo["skillName1"] = "-";
	} else {
		if (skillName1.parentNode.className == "used") {
			cardInfo["skillName1"] = "<s>" + skillName1.innerHTML + "</s>";
		} else {
			cardInfo["skillName1"] = skillName1.innerHTML;
		}
	}
	if (skillName2.innerHTML == "") {
		cardInfo["skillName2"] = "-";
	} else {
		if (skillName2.parentNode.className == "used") {
			cardInfo["skillName2"] = "<s>" + skillName2.innerHTML + "</s>";
		} else {
			cardInfo["skillName2"] = skillName2.innerHTML;
		}
	}
	if (skillName3.innerHTML == "") {
		cardInfo["skillName3"] = "-";
	} else {
		if (skillName3.parentNode.className == "used") {
			cardInfo["skillName3"] = "<s>" + skillName3.innerHTML + "</s>";
		} else {
			cardInfo["skillName3"] = skillName3.innerHTML;
		}
	}
	if (skillName4 ==null || !skillName4.innerHTML.replace(/\s+/g, "")) {
		cardInfo["skillName4"] = "-";
	} else {
		if (skillName4.parentNode.className == "used") {
			cardInfo["skillName4"] = "<s>" + skillName4.innerHTML + "</s>";
		} else {
			cardInfo["skillName4"] = skillName4.innerHTML;
		}
	}
	cardInfo["uqId"] = getUqId(cardStatusDetail);

	// 分類識別要素付加
	var spanEL = d_21.createElement("span");
		spanEL.id = "brotool_cardGroup" + checkCardGroup(cardInfo["uqId"]);
		cardStatusDetail.appendChild(spanEL);
	if (selectedGroup != "full" && spanEL.id != "brotool_" + selectedGroup) {
		cardStatusDetail.style.display = "none";
	}

	return cardInfo;
}
function getCardInfoNormal(cardColmn) {
	var cardInfo = {};
	cardInfo["cost"] = $xp1_21('descendant::span[@class="cost"]', cardColmn).innerHTML;
	cardInfo["name"] = $xp1_21('descendant::span[@class="name"]', cardColmn).innerHTML;
	cardInfo["level"] = $xp1_21('descendant::div[@class="level"]/span', cardColmn).innerHTML;
	cardInfo["soltype"] = $xp1_21('descendant::span[@class="soltype"]//img', cardColmn).alt;
	cardInfo["cardno"] = $xp1_21('descendant::span[@class="cardno"]', cardColmn).innerHTML;
	cardInfo["status_hp"] = $xp1_21('descendant::div[@class="status_hp"]/span[@class="value"]', cardColmn).innerHTML.split("/")[0];
	cardInfo["status_att"] = $xp1_21('descendant::ul[@class="status"]/li[@class="status_att"]', cardColmn).innerHTML;
	cardInfo["status_int"] = $xp1_21('descendant::ul[@class="status"]/li[@class="status_int"]', cardColmn).innerHTML;
	cardInfo["status_wdef"] = $xp1_21('descendant::ul[@class="status"]/li[@class="status_wdef"]', cardColmn).innerHTML;
	cardInfo["status_sdef"] = $xp1_21('descendant::ul[@class="status"]/li[@class="status_sdef"]', cardColmn).innerHTML;
	cardInfo["status_bdef"] = $xp1_21('descendant::ul[@class="status"]/li[@class="status_bdef"]', cardColmn).innerHTML;
	cardInfo["status_rdef"] = $xp1_21('descendant::ul[@class="status"]/li[@class="status_rdef"]', cardColmn).innerHTML;
	cardInfo["status_speed"] = $xp1_21('descendant::ul[@class="status"]/li[@class="status_speed"]', cardColmn).innerHTML;
	cardInfo["para"] = $xp1_21('descendant::div[@class="para"]', cardColmn).innerHTML;
	var skillName1 = $xp1_21('descendant::span[@class="skillName1 skill_name" or @class="skillName1 skill_name red"]', cardColmn);
	var skillName2 = $xp1_21('descendant::span[@class="skillName2 skill_name" or @class="skillName2 skill_name red"]', cardColmn);
	var skillName3 = $xp1_21('descendant::span[@class="skillName3 skill_name" or @class="skillName3 skill_name red"]', cardColmn);
	var skillName4 = $xp1_21('descendant::span[@class="skillName4 skill_name" or @class="skillName4 skill_name red"]', cardColmn);

	if (!skillName1.innerHTML.replace(/\s+/g, "")) {
		cardInfo["skillName1"] = "-";
	} else {
		if (!!$xp1_21('descendant::span', skillName1)) {
			cardInfo["skillName1"] = "<s>" + skillName1.innerHTML.split(":")[1] + "</s>";
		} else {
			cardInfo["skillName1"] = skillName1.innerHTML.split(":")[1];
		}

	}
	if (!skillName2.innerHTML.replace(/\s+/g, "")) {
		cardInfo["skillName2"] = "-";
	} else {
		if (!!$xp1_21('descendant::span', skillName2)) {
			cardInfo["skillName2"] = "<s>" + skillName2.innerHTML.split(":")[1] + "</s>";
		} else {
			cardInfo["skillName2"] = skillName2.innerHTML.split(":")[1];
		}
	}
	if (!skillName3.innerHTML.replace(/\s+/g, "")) {
		cardInfo["skillName3"] = "-";
	} else {
		if (!!$xp1_21('descendant::span', skillName3)) {
			cardInfo["skillName3"] = "<s>" + skillName3.innerHTML.split(":")[1] + "</s>";
		} else {
			cardInfo["skillName3"] = skillName3.innerHTML.split(":")[1];
		}

	}
	if (skillName4 ==null || !skillName4.innerHTML.replace(/\s+/g, "")) {
		cardInfo["skillName4"] = "-";
	} else {
		if (!!$xp1_21('descendant::span', skillName4)) {
			cardInfo["skillName4"] = "<s>" + skillName4.innerHTML.split(":")[1] + "</s>";
		} else {
			cardInfo["skillName4"] = skillName4.innerHTML.split(":")[1];
		}

	}
console.log('uqid:');	cardInfo["uqId"] = getUqId(cardColmn);

	// 分類識別要素付加
	if (cardColmn.parentNode.id == "cardFileList") {
		var spanEL = d_21.createElement("span");
			spanEL.id = "brotool_cardGroup" + checkCardGroup(cardInfo["uqId"]);
			cardColmn.appendChild(spanEL);
		if (selectedGroup != "full" && spanEL.id != "brotool_" + selectedGroup) {
			cardColmn.style.display = "none";
		}
	}

	// 裏返し処理差し替え
	var exeA = $_21("a[href^=javascript:executeA(]", cardColmn).get(0);
	var exeB = $_21("a[href^=javascript:executeB(]", cardColmn).get(0);
	if (!!exeA && !!exeB) {
		var num = exeA.href.match(/[0-9]+/)[0];

		exeA.href="javascript:void(0)";
		exeA.addEventListener("click", function() {
			$_21("[id=card_frontback" + num + "-front]").hide();
			$_21("[id=card_frontback" + num + "-back]").show();
		}, false);
		exeB.href="javascript:void(0)";
		exeB.addEventListener("click", function() {
			$_21("[id=card_frontback" + num + "-front]").show();
			$_21("[id=card_frontback" + num + "-back]").hide();
		}, false);
	}

	return cardInfo;
}

function getUqId (nodes) {
//	console.log(nodes.nextSibling.innerHTML);
	// カードIDを取得

	//デッキ外のカード削除ボタンから取得
	var onClickNode = $xp1_21('descendant::a[@class="delete-card-button" and @onClick]', nodes);

	//デッキ内「ファイルに戻す」から取得
	if (!onClickNode) {
		onClickNode = $xp1_21('descendant::img[@class="aboutdeck" and @onClick]', nodes);
		onClickNode = $xp1_21('descendant::img[@class="btn_deck_set" and @onClick]', nodes);

	}
// alt="このカードをデッキから外しファイルに戻します" title="このカードをデッキから外しファイルに戻します" class="btn_deck_set" onClick="return operationExecution('兀突骨', 288791, 'unset')" /></a>


	//デッキ外「カードの保護」から取得
	if (!onClickNode) {
		onClickNode = $xp1_21('descendant::a[@class="set-protection-button" and @onClick]', nodes);
	}
	 //デッキ外「カードの保護の解除」から取得
	if (!onClickNode) {
		onClickNode = $xp1_21('descendant::a[@class="remove-protection-button" and @onClick]', nodes);
		if (onClickNode) {if(onClickNode.getAttribute('onClick').indexOf("alert")!=-1) onClickNode = null;}	 //デュエル対策。
	}
	 //デッキ外「ポイント振りなおし」から取得
	if (!onClickNode) {
		onClickNode = $xp1_21('descendant::a[@class="useCp" and @onClick]', nodes);
	}

	if (!onClickNode) { return null; }

	var splitArray = onClickNode.getAttribute('onClick').split(",");
	if (splitArray.length!=5) { return null; }//alert('ステータスポイントを振り直すには、ステータスポイント振りなおしアイテムかCP800が必要です。')

	var cardId = splitArray[1].replace(/^\s+|\s+$/g, "");
	return cardId;
}
////////////////////////////////////////////////////////
// 一覧テーブル関連の共通関数
////////////////////////////////////////////////////////
// ヘッダ部
function createTableHead(theadEL) {
	var trEL = d_21.createElement("tr");
	var thEL = d_21.createElement("th");thEL.innerHTML = "No";trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");thEL.innerHTML = "兵科";trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");thEL.innerHTML = "武将No";trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");thEL.innerHTML = "名前";trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");thEL.innerHTML = "Lv";trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");thEL.innerHTML = "コスト";trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");thEL.innerHTML = "HP";trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");thEL.innerHTML = "討伐";trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");thEL.innerHTML = "攻撃";thEL.id = "mode_param";thEL.style.display = "none";trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");thEL.innerHTML = "知力";thEL.id = "mode_param";thEL.style.display = "none";trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");thEL.innerHTML = "速度";thEL.id = "mode_param";thEL.style.display = "none";trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");thEL.innerHTML = "歩防";thEL.id = "mode_param";thEL.style.display = "none";trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");thEL.innerHTML = "槍防";thEL.id = "mode_param";thEL.style.display = "none";trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");thEL.innerHTML = "弓防";thEL.id = "mode_param";thEL.style.display = "none";trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");thEL.innerHTML = "騎防";thEL.id = "mode_param";thEL.style.display = "none";trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");thEL.innerHTML = "skill_1";thEL.id = "mode_skill";thEL.style.display = "none";trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");thEL.innerHTML = "skill_2";thEL.id = "mode_skill";thEL.style.display = "none";trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");thEL.innerHTML = "skill_3";thEL.id = "mode_skill";thEL.style.display = "none";trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");thEL.innerHTML = "skill_4";thEL.id = "mode_skill";thEL.style.display = "none";trEL.appendChild(thEL);
	var thEL = d_21.createElement("th");thEL.innerHTML = "分類";trEL.appendChild(thEL);theadEL.appendChild(trEL);
}
// ボディ部
function createTableData(tbodyEL, cardList) {
	for (var i = 0, len = cardList.length; i < len; i++ ) {
		var cardInfo = cardList[i];
		var trEL = d_21.createElement("tr");
		var thEL = d_21.createElement("th");thEL.innerHTML = data_index++;trEL.appendChild(thEL);
		var tdEL = d_21.createElement("td");tdEL.innerHTML = cardInfo["soltype"];trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");tdEL.innerHTML = cardInfo["cardno"];trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");tdEL.innerHTML = cardInfo["name"];trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");tdEL.innerHTML = cardInfo["level"];trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");tdEL.innerHTML = cardInfo["cost"];trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");tdEL.innerHTML = cardInfo["status_hp"];trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");tdEL.innerHTML = cardInfo["para"];trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");tdEL.innerHTML = cardInfo["status_att"];tdEL.id = "mode_param";tdEL.style.display = "none";trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");tdEL.innerHTML = cardInfo["status_int"];  tdEL.id = "mode_param";tdEL.style.display = "none";trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");tdEL.innerHTML = cardInfo["status_speed"];tdEL.id = "mode_param";tdEL.style.display = "none";trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");tdEL.innerHTML = cardInfo["status_wdef"]; tdEL.id = "mode_param";tdEL.style.display = "none";trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");tdEL.innerHTML = cardInfo["status_sdef"]; tdEL.id = "mode_param";tdEL.style.display = "none";trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");tdEL.innerHTML = cardInfo["status_bdef"]; tdEL.id = "mode_param";tdEL.style.display = "none";trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");tdEL.innerHTML = cardInfo["status_rdef"];tdEL.id = "mode_param";tdEL.style.display = "none";trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");tdEL.innerHTML = cardInfo["skillName1"];tdEL.id = "mode_skill";tdEL.style.display = "none";trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");tdEL.innerHTML = cardInfo["skillName2"];tdEL.id = "mode_skill";tdEL.style.display = "none";trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");tdEL.innerHTML = cardInfo["skillName3"];tdEL.id = "mode_skill";tdEL.style.display = "none";trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");tdEL.innerHTML = cardInfo["skillName4"];tdEL.id = "mode_skill";tdEL.style.display = "none";trEL.appendChild(tdEL);
		var tdEL = d_21.createElement("td");
		if (!cardInfo["uqId"]) {
			tdEL.innerHTML = "-";tdEL.id = "brotool_cardGroup0";
		} else {
			var selectEL = d_21.createElement("select");selectEL.id = "card_group_select";selectEL.addEventListener("change", setUqIdToGroups(cardInfo["uqId"], selectEL), false);
			var optionEL = d_21.createElement("option");optionEL.value = "cardGroup0";optionEL.text = "未分類";selectEL.appendChild(optionEL);
			var selopId = checkCardGroup(cardInfo["uqId"]);
			for (var j = 0, jlen = cardGroupArray.length; j < jlen; j++ ) {
				if (cardGroupArray[j][1] != "") {
					var optionEL = d_21.createElement("option");optionEL.value = cardGroupArray[j][0];optionEL.text = cardGroupArray[j][1];selectEL.appendChild(optionEL);
					if (selopId == j + 1) { optionEL.selected = true}
				}
			}
			tdEL.appendChild(selectEL);tdEL.id = "brotool_cardGroup" + selopId;
		}
			trEL.appendChild(tdEL);
			if (selectedGroup != "full" && tdEL.id != "brotool_" + selectedGroup) {
				trEL.style.display = "none";
			}
		tbodyEL.appendChild(trEL);
	}
	changeTableMode();

	// 分類項目変数への該当IDへのセット、既登録があればそれを削除
	function setUqIdToGroups(uqId, select) {
		return function() {
			for (var i = 0, len = cardGroup1.length; i < len; i++) {
				if (cardGroup1[i] == uqId) { cardGroup1.splice(i,1); i--; }
			}
			for (var i = 0, len = cardGroup2.length; i < len; i++) {
				if (cardGroup2[i] == uqId) { cardGroup2.splice(i,1); i--; }
			}
			for (var i = 0, len = cardGroup3.length; i < len; i++) {
				if (cardGroup3[i] == uqId) { cardGroup3.splice(i,1); i--; }
			}
			for (var i = 0, len = cardGroup4.length; i < len; i++) {
				if (cardGroup4[i] == uqId) { cardGroup4.splice(i,1); i--; }
			}
			for (var i = 0, len = cardGroup5.length; i < len; i++) {
				if (cardGroup5[i] == uqId) { cardGroup5.splice(i,1); i--; }
			}
			for (var i = 0, len = cardGroup6.length; i < len; i++) {
				if (cardGroup6[i] == uqId) { cardGroup6.splice(i,1); i--; }
			}
			for (var i = 0, len = cardGroup7.length; i < len; i++) {
				if (cardGroup7[i] == uqId) { cardGroup7.splice(i,1); i--; }
			}
			for (var i = 0, len = cardGroup8.length; i < len; i++) {
				if (cardGroup8[i] == uqId) { cardGroup8.splice(i,1); i--; }
			}
			for (var i = 0, len = cardGroup9.length; i < len; i++) {
				if (cardGroup9[i] == uqId) { cardGroup9.splice(i,1); i--; }
			}
			for (var i = 0, len = cardGroup10.length; i < len; i++) {
				if (cardGroup10[i] == uqId) { cardGroup10.splice(i,1); i--; }
			}

			var setGroup = select.options[select.selectedIndex].value;
			if (setGroup == "cardGroup1") {
				cardGroup1.push(uqId);
			} else if (setGroup == "cardGroup2") {
				cardGroup2.push(uqId);
			} else if (setGroup == "cardGroup3") {
				cardGroup3.push(uqId);
			} else if (setGroup == "cardGroup4") {
				cardGroup4.push(uqId);
			} else if (setGroup == "cardGroup5") {
				cardGroup5.push(uqId);
			} else if (setGroup == "cardGroup6") {
				cardGroup6.push(uqId);
			} else if (setGroup == "cardGroup7") {
				cardGroup7.push(uqId);
			} else if (setGroup == "cardGroup8") {
				cardGroup8.push(uqId);
			} else if (setGroup == "cardGroup9") {
				cardGroup9.push(uqId);
			} else if (setGroup == "cardGroup10") {
				cardGroup10.push(uqId);
			}
		}
	}
}
// 一覧テーブル：パラメータ⇔スキル切替え関数
function changeTableMode(setMode) {
	if (!!setMode) { tableMode = setMode };
	if (tableMode == "param") {
		$_21("[id=mode_param]").show();$_21("[id=mode_skill]").hide();
	} else if (tableMode == "skill") {
		$_21("[id=mode_param]").hide();$_21("[id=mode_skill]").show();
	}
}
////////////////////////////////////////////////////////
// 分類関連の共通関数
////////////////////////////////////////////////////////
// 項目変更時に引数の関数を呼び出す分類セレクターを返す
function createGroupSelecter(func) {
	var groupViewSelectEL = d_21.createElement("select");
		groupViewSelectEL.id = "brotool_groupViewSelectEL";
		groupViewSelectEL.addEventListener("change", func, false);
	var groupViewOptionEL = d_21.createElement("option");
		groupViewOptionEL.value = "";
		groupViewOptionEL.text = "--表示モード選択--";
		groupViewSelectEL.appendChild(groupViewOptionEL);
	var groupViewOptionEL = d_21.createElement("option");
		groupViewOptionEL.value = "full";
		groupViewOptionEL.text = "【全表示】";
		groupViewSelectEL.appendChild(groupViewOptionEL);
	var groupViewOptionEL = d_21.createElement("option");
		groupViewOptionEL.value = "cardGroup0";
		groupViewOptionEL.text = "【未分類】";
		groupViewSelectEL.appendChild(groupViewOptionEL);
	for (var i = 0, len = cardGroupArray.length; i < len; i++ ) {
		if (cardGroupArray[i][1] != "") {
			var groupViewOptionEL = d_21.createElement("option");
				groupViewOptionEL.value = cardGroupArray[i][0];
				groupViewOptionEL.text = cardGroupArray[i][1];
				groupViewSelectEL.appendChild(groupViewOptionEL);
		}
	}
	return groupViewSelectEL;
}
// 分類表示・非表示実行関数
function viewCardGroup() {
	if (selectedGroup == "full") {
		$_21("[id=brotool_cardGroup0]").parent().show();$_21("[id=brotool_cardGroup1]").parent().show();
		$_21("[id=brotool_cardGroup2]").parent().show();$_21("[id=brotool_cardGroup3]").parent().show();
		$_21("[id=brotool_cardGroup4]").parent().show();$_21("[id=brotool_cardGroup5]").parent().show();
		$_21("[id=brotool_cardGroup6]").parent().show();$_21("[id=brotool_cardGroup7]").parent().show();
		$_21("[id=brotool_cardGroup8]").parent().show();$_21("[id=brotool_cardGroup9]").parent().show();
		$_21("[id=brotool_cardGroup10]").parent().show();
	} else {
		$_21("[id=brotool_cardGroup0]").parent().hide();$_21("[id=brotool_cardGroup1]").parent().hide();
		$_21("[id=brotool_cardGroup2]").parent().hide();$_21("[id=brotool_cardGroup3]").parent().hide();
		$_21("[id=brotool_cardGroup4]").parent().hide();$_21("[id=brotool_cardGroup5]").parent().hide();
		$_21("[id=brotool_cardGroup6]").parent().hide();$_21("[id=brotool_cardGroup7]").parent().hide();
		$_21("[id=brotool_cardGroup8]").parent().hide();$_21("[id=brotool_cardGroup9]").parent().hide();
		$_21("[id=brotool_cardGroup10]").parent().hide();
		$_21("[id=brotool_" + selectedGroup + "]").parent().show();
	}
}
// 引数で渡された固有IDが分類に登録されているかをチェック。
// 登録されている場合は、その分類連番を返す。
function checkCardGroup(uqId) {
	if (cardGroup1.indexOf(uqId) != -1) {
		return 1;
	} else if (cardGroup2.indexOf(uqId) != -1) {
		return 2;
	} else if (cardGroup3.indexOf(uqId) != -1) {
		return 3;
	} else if (cardGroup4.indexOf(uqId) != -1) {
		return 4;
	} else if (cardGroup5.indexOf(uqId) != -1) {
		return 5;
	} else if (cardGroup6.indexOf(uqId) != -1) {
		return 6;
	} else if (cardGroup7.indexOf(uqId) != -1) {
		return 7;
	} else if (cardGroup8.indexOf(uqId) != -1) {
		return 8;
	} else if (cardGroup9.indexOf(uqId) != -1) {
		return 9;
	} else if (cardGroup10.indexOf(uqId) != -1) {
		return 10;
	} else {
		return 0;
	}
}
////////////////////////////////////////////////////////
// 共通CSS
////////////////////////////////////////////////////////
function addCommonStyle() {
//faraway110601 GM_addStyle()への引数をString()で囲むFirefox4.0対応
	GM_addStyle("\
		div.baseDiv {\
			margin: 5px;\
		}\
		table.showTable {\
			border: 2px solid black;\
			border-collapse: collapse;\
			margin: 5px;\
		}\
		.showTable th {\
			border: 2px solid black;\
			border-collapse: collapse;\
			color: white;\
			background-color: gray;\
			padding : 4px;\
		}\
		.showTable td {\
			border: 2px solid black;\
			border-collapse: collapse;\
			color: black;\
			background-color: white;\
			padding : 4px;\
		}\
	" );
}

////////////////////////////////////////////////////////
// GM関連の共通関数
////////////////////////////////////////////////////////
function loadCmValue_21 () {
	cardGroupArray = eval(GM_getValue(worldKey_21 + "cardGroupArray", [
		["cardGroup1","分類１"],["cardGroup2","分類２"],["cardGroup3","分類３"],["cardGroup4","分類４"],["cardGroup5","分類５"],
		["cardGroup6",""],["cardGroup7",""],["cardGroup8",""],["cardGroup9",""],["cardGroup10",""],
	]));
	cardGroup1 = eval(GM_getValue(worldKey_21 + "cardGroup1", []));cardGroup2 = eval(GM_getValue(worldKey_21 + "cardGroup2", []));
	cardGroup3 = eval(GM_getValue(worldKey_21 + "cardGroup3", []));cardGroup4 = eval(GM_getValue(worldKey_21 + "cardGroup4", []));
	cardGroup5 = eval(GM_getValue(worldKey_21 + "cardGroup5", []));cardGroup6 = eval(GM_getValue(worldKey_21 + "cardGroup6", []));
	cardGroup7 = eval(GM_getValue(worldKey_21 + "cardGroup7", []));cardGroup8 = eval(GM_getValue(worldKey_21 + "cardGroup8", []));
	cardGroup9 = eval(GM_getValue(worldKey_21 + "cardGroup9", []));cardGroup10 = eval(GM_getValue(worldKey_21 + "cardGroup10", []));
}
function saveCmValue_21 () {
	GM_setValue(worldKey_21 + "cardGroupArray", cardGroupArray.toSource());
	GM_setValue(worldKey_21 + "cardGroup1", cardGroup1.toSource());GM_setValue(worldKey_21 + "cardGroup2", cardGroup2.toSource());
	GM_setValue(worldKey_21 + "cardGroup3", cardGroup3.toSource());GM_setValue(worldKey_21 + "cardGroup4", cardGroup4.toSource());
	GM_setValue(worldKey_21 + "cardGroup5", cardGroup5.toSource());GM_setValue(worldKey_21 + "cardGroup6", cardGroup6.toSource());
	GM_setValue(worldKey_21 + "cardGroup7", cardGroup7.toSource());GM_setValue(worldKey_21 + "cardGroup8", cardGroup8.toSource());
	GM_setValue(worldKey_21 + "cardGroup9", cardGroup9.toSource());GM_setValue(worldKey_21 + "cardGroup10", cardGroup10.toSource());
}
function resetCmValue () {
	GM_deleteValue(worldKey_21 + "cardGroupArray");
	GM_deleteValue(worldKey_21 + "cardGroup1");GM_deleteValue(worldKey_21 + "cardGroup2");
	GM_deleteValue(worldKey_21 + "cardGroup3");GM_deleteValue(worldKey_21 + "cardGroup4");
	GM_deleteValue(worldKey_21 + "cardGroup5");GM_deleteValue(worldKey_21 + "cardGroup6");
	GM_deleteValue(worldKey_21 + "cardGroup7");GM_deleteValue(worldKey_21 + "cardGroup8");
	GM_deleteValue(worldKey_21 + "cardGroup9");GM_deleteValue(worldKey_21 + "cardGroup10");
}

////////////////////////////////////////////////////////
// 下記を使用させていただいております。
// tablesorter
// Author: Christian Bach
// Version: 2.0.3 (changelog)
// Licence: Dual licensed under MIT  or GPL licenses.
////////////////////////////////////////////////////////
(function($_21){$_21.extend({tablesorter:new function(){var parsers=[],widgets=[];this.defaults={cssHeader:"header",cssAsc:"headerSortUp",cssDesc:"headerSortDown",sortInitialOrder:"asc",sortMultiSortKey:"shiftKey",sortForce:null,sortAppend:null,textExtraction:"simple",parsers:{},widgets:[],widgetZebra:{css:["even","odd"]},headers:{},widthFixed:false,cancelSelection:true,sortList:[],headerList:[],dateFormat:"us",decimal:'.',debug:false};function benchmark(s,d){log(s+","+(new Date().getTime()-d_21.getTime())+"ms");}this.benchmark=benchmark;function log(s){if(typeof console!="undefined"&&typeof console.debug!="undefined"){console.log(s);}else{alert(s);}}function buildParserCache(table,$headers){if(table.config.debug){var parsersDebug="";}var rows=table.tBodies[0].rows;if(table.tBodies[0].rows[0]){var list=[],cells=rows[0].cells,l=cells.length;for(var i=0;i<l;i++){var p=false;if($_21.metadata&&($_21($headers[i]).metadata()&&$_21($headers[i]).metadata().sorter)){p=getParserById($_21($headers[i]).metadata().sorter);}else if((table.config.headers[i]&&table.config.headers[i].sorter)){p=getParserById(table.config.headers[i].sorter);}if(!p){p=detectParserForColumn(table,cells[i]);}if(table.config.debug){parsersDebug+="column:"+i+" parser:"+p.id+"\n";}list.push(p);}}if(table.config.debug){log(parsersDebug);}return list;};function detectParserForColumn(table,node){var l=parsers.length;for(var i=1;i<l;i++){if(parsers[i].is($_21.trim(getElementText(table.config,node)),table,node)){return parsers[i];}}return parsers[0];}function getParserById(name){var l=parsers.length;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==name.toLowerCase()){return parsers[i];}}return false;}function buildCache(table){if(table.config.debug){var cacheTime=new Date();}var totalRows=(table.tBodies[0]&&table.tBodies[0].rows.length)||0,totalCells=(table.tBodies[0].rows[0]&&table.tBodies[0].rows[0].cells.length)||0,parsers=table.config.parsers,cache={row:[],normalized:[]};for(var i=0;i<totalRows;++i){var c=table.tBodies[0].rows[i],cols=[];cache.row.push($_21(c));for(var j=0;j<totalCells;++j){cols.push(parsers[j].format(getElementText(table.config,c.cells[j]),table,c.cells[j]));}cols.push(i);cache.normalized.push(cols);cols=null;};if(table.config.debug){benchmark("Building cache for "+totalRows+" rows:",cacheTime);}return cache;};function getElementText(config,node){if(!node)return"";var t="";if(config.textExtraction=="simple"){if(node.childNodes[0]&&node.childNodes[0].hasChildNodes()){t=node.childNodes[0].innerHTML;}else{t=node.innerHTML;}}else{if(typeof(config.textExtraction)=="function"){t=config.textExtraction(node);}else{t=$_21(node).text();}}return t;}function appendToTable(table,cache){if(table.config.debug){var appendTime=new Date()}var c=cache,r=c.row,n=c.normalized,totalRows=n.length,checkCell=(n[0].length-1),tableBody=$_21(table.tBodies[0]),rows=[];for(var i=0;i<totalRows;i++){rows.push(r[n[i][checkCell]]);if(!table.config.appender){var o=r[n[i][checkCell]];var l=o.length;for(var j=0;j<l;j++){tableBody[0].appendChild(o[j]);}}}if(table.config.appender){table.config.appender(table,rows);}rows=null;if(table.config.debug){benchmark("Rebuilt table:",appendTime);}applyWidget(table);setTimeout(function(){$_21(table).trigger("sortEnd");},0);};function buildHeaders(table){if(table.config.debug){var time=new Date();}var meta=($_21.metadata)?true:false,tableHeadersRows=[];for(var i=0;i<table.tHead.rows.length;i++){tableHeadersRows[i]=0;};$tableHeaders=$_21("thead th",table);$tableHeaders.each(function(index){this.count=0;this.column=index;this.order=formatSortingOrder(table.config.sortInitialOrder);if(checkHeaderMetadata(this)||checkHeaderOptions(table,index))this.sortDisabled=true;if(!this.sortDisabled){$_21(this).addClass(table.config.cssHeader);}table.config.headerList[index]=this;});if(table.config.debug){benchmark("Built headers:",time);log($tableHeaders);}return $tableHeaders;};function checkCellColSpan(table,rows,row){var arr=[],r=table.tHead.rows,c=r[row].cells;for(var i=0;i<c.length;i++){var cell=c[i];if(cell.colSpan>1){arr=arr.concat(checkCellColSpan(table,headerArr,row++));}else{if(table.tHead.length==1||(cell.rowSpan>1||!r[row+1])){arr.push(cell);}}}return arr;};function checkHeaderMetadata(cell){if(($_21.metadata)&&($_21(cell).metadata().sorter===false)){return true;};return false;}function checkHeaderOptions(table,i){if((table.config.headers[i])&&(table.config.headers[i].sorter===false)){return true;};return false;}function applyWidget(table){var c=table.config.widgets;var l=c.length;for(var i=0;i<l;i++){getWidgetById(c[i]).format(table);}}function getWidgetById(name){var l=widgets.length;for(var i=0;i<l;i++){if(widgets[i].id.toLowerCase()==name.toLowerCase()){return widgets[i];}}};function formatSortingOrder(v){if(typeof(v)!="Number"){i=(v.toLowerCase()=="desc")?1:0;}else{i=(v==(0||1))?v:0;}return i;}function isValueInArray(v,a){var l=a.length;for(var i=0;i<l;i++){if(a[i][0]==v){return true;}}return false;}function setHeadersCss(table,$headers,list,css){$headers.removeClass(css[0]).removeClass(css[1]);var h=[];$headers.each(function(offset){if(!this.sortDisabled){h[this.column]=$_21(this);}});var l=list.length;for(var i=0;i<l;i++){h[list[i][0]].addClass(css[list[i][1]]);}}function fixColumnWidth(table,$headers){var c=table.config;if(c.widthFixed){var colgroup=$_21('<colgroup>');$_21("tr:first td",table.tBodies[0]).each(function(){colgroup.append($_21('<col>').css('width',$_21(this).width()));});$_21(table).prepend(colgroup);};}function updateHeaderSortCount(table,sortList){var c=table.config,l=sortList.length;for(var i=0;i<l;i++){var s=sortList[i],o=c.headerList[s[0]];o.count=s[1];o.count++;}}function multisort(table,sortList,cache){if(table.config.debug){var sortTime=new Date();}var dynamicExp="var sortWrapper = function(a,b) {",l=sortList.length;for(var i=0;i<l;i++){var c=sortList[i][0];var order=sortList[i][1];var s=(getCachedSortType(table.config.parsers,c)=="text")?((order==0)?"sortText":"sortTextDesc"):((order==0)?"sortNumeric":"sortNumericDesc");var e="e"+i;dynamicExp+="var "+e+" = "+s+"(a["+c+"],b["+c+"]); ";dynamicExp+="if("+e+") { return "+e+"; } ";dynamicExp+="else { ";}var orgOrderCol=cache.normalized[0].length-1;dynamicExp+="return a["+orgOrderCol+"]-b["+orgOrderCol+"];";for(var i=0;i<l;i++){dynamicExp+="}; ";}dynamicExp+="return 0; ";dynamicExp+="}; ";eval(dynamicExp);cache.normalized.sort(sortWrapper);if(table.config.debug){benchmark("Sorting on "+sortList.toString()+" and dir "+order+" time:",sortTime);}return cache;};function sortText(a,b){return((a<b)?-1:((a>b)?1:0));};function sortTextDesc(a,b){return((b<a)?-1:((b>a)?1:0));};function sortNumeric(a,b){return a-b;};function sortNumericDesc(a,b){return b-a;};function getCachedSortType(parsers,i){return parsers[i].type;};this.construct=function(settings){return this.each(function(){if(!this.tHead||!this.tBodies)return;var $this,$document,$headers,cache,config,shiftDown=0,sortOrder;this.config={};config=$_21.extend(this.config,$_21.tablesorter.defaults,settings);$this=$_21(this);$headers=buildHeaders(this);this.config.parsers=buildParserCache(this,$headers);cache=buildCache(this);var sortCSS=[config.cssDesc,config.cssAsc];fixColumnWidth(this);$headers.click(function(e){$this.trigger("sortStart");var totalRows=($this[0].tBodies[0]&&$this[0].tBodies[0].rows.length)||0;if(!this.sortDisabled&&totalRows>0){var $cell=$_21(this);var i=this.column;this.order=this.count++%2;if(!e[config.sortMultiSortKey]){config.sortList=[];if(config.sortForce!=null){var a=config.sortForce;for(var j=0;j<a.length;j++){if(a[j][0]!=i){config.sortList.push(a[j]);}}}config.sortList.push([i,this.order]);}else{if(isValueInArray(i,config.sortList)){for(var j=0;j<config.sortList.length;j++){var s=config.sortList[j],o=config.headerList[s[0]];if(s[0]==i){o.count=s[1];o.count++;s[1]=o.count%2;}}}else{config.sortList.push([i,this.order]);}};setTimeout(function(){setHeadersCss($this[0],$headers,config.sortList,sortCSS);appendToTable($this[0],multisort($this[0],config.sortList,cache));},1);return false;}}).mousedown(function(){if(config.cancelSelection){this.onselectstart=function(){return false};return false;}});$this.bind("update",function(){this.config.parsers=buildParserCache(this,$headers);cache=buildCache(this);}).bind("sorton",function(e,list){$_21(this).trigger("sortStart");config.sortList=list;var sortList=config.sortList;updateHeaderSortCount(this,sortList);setHeadersCss(this,$headers,sortList,sortCSS);appendToTable(this,multisort(this,sortList,cache));}).bind("appendCache",function(){appendToTable(this,cache);}).bind("applyWidgetId",function(e,id){getWidgetById(id).format(this);}).bind("applyWidgets",function(){applyWidget(this);});if($_21.metadata&&($_21(this).metadata()&&$_21(this).metadata().sortlist)){config.sortList=$_21(this).metadata().sortlist;}if(config.sortList.length>0){$this.trigger("sorton",[config.sortList]);}applyWidget(this);});};this.addParser=function(parser){var l=parsers.length,a=true;for(var i=0;i<l;i++){if(parsers[i].id.toLowerCase()==parser.id.toLowerCase()){a=false;}}if(a){parsers.push(parser);};};this.addWidget=function(widget){widgets.push(widget);};this.formatFloat=function(s){var i=parseFloat(s);return(isNaN(i))?0:i;};this.formatInt=function(s){var i=parseInt(s);return(isNaN(i))?0:i;};this.isDigit=function(s,config){var DECIMAL='\\'+config.decimal;var exp='/(^[+]?0('+DECIMAL+'0+)?$)|(^([-+]?[1-9][0-9]*)$)|(^([-+]?((0?|[1-9][0-9]*)'+DECIMAL+'(0*[1-9][0-9]*)))$)|(^[-+]?[1-9]+[0-9]*'+DECIMAL+'0+$)/';return RegExp(exp).test($_21.trim(s));};this.clearTableBody=function(table){if($_21.browser.msie){function empty(){while(this.firstChild)this.removeChild(this.firstChild);}empty.apply(table.tBodies[0]);}else{table.tBodies[0].innerHTML="";}};}});$_21.fn.extend({tablesorter:$_21.tablesorter.construct});var ts=$_21.tablesorter;ts.addParser({id:"text",is:function(s){return true;},format:function(s){return $_21.trim(s.toLowerCase());},type:"text"});ts.addParser({id:"digit",is:function(s,table){var c=table.config;return $_21.tablesorter.isDigit(s,c);},format:function(s){return $_21.tablesorter.formatFloat(s);},type:"numeric"});ts.addParser({id:"currency",is:function(s){return/^[￡$ｬ ?.]/.test(s);},format:function(s){return $_21.tablesorter.formatFloat(s.replace(new RegExp(/[^0-9.]/g),""));},type:"numeric"});ts.addParser({id:"ipAddress",is:function(s){return/^\d{2,3}[\.]\d{2,3}[\.]\d{2,3}[\.]\d{2,3}$/.test(s);},format:function(s){var a=s.split("."),r="",l=a.length;for(var i=0;i<l;i++){var item=a[i];if(item.length==2){r+="0"+item;}else{r+=item;}}return $_21.tablesorter.formatFloat(r);},type:"numeric"});ts.addParser({id:"url",is:function(s){return/^(https?|ftp|file):\/\/$/.test(s);},format:function(s){return $_21.trim(s.replace(new RegExp(/(https?|ftp|file):\/\//),''));},type:"text"});ts.addParser({id:"isoDate",is:function(s){return/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(s);},format:function(s){return $_21.tablesorter.formatFloat((s!="")?new Date(s.replace(new RegExp(/-/g),"/")).getTime():"0");},type:"numeric"});ts.addParser({id:"percent",is:function(s){return/\%$/.test($_21.trim(s));},format:function(s){return $_21.tablesorter.formatFloat(s.replace(new RegExp(/%/g),""));},type:"numeric"});ts.addParser({id:"usLongDate",is:function(s){return s.match(new RegExp(/^[A-Za-z]{3,10}\.? [0-9]{1,2}, ([0-9]{4}|'?[0-9]{2}) (([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(AM|PM)))$/));},format:function(s){return $_21.tablesorter.formatFloat(new Date(s).getTime());},type:"numeric"});ts.addParser({id:"shortDate",is:function(s){return/\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}/.test(s);},format:function(s,table){var c=table.config;s=s.replace(/\-/g,"/");if(c.dateFormat=="us"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$1/$2");}else if(c.dateFormat=="uk"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/,"$3/$2/$1");}else if(c.dateFormat=="dd/mm/yy"||c.dateFormat=="dd-mm-yy"){s=s.replace(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{2})/,"$1/$2/$3");}return $_21.tablesorter.formatFloat(new Date(s).getTime());},type:"numeric"});ts.addParser({id:"time",is:function(s){return/^(([0-2]?[0-9]:[0-5][0-9])|([0-1]?[0-9]:[0-5][0-9]\s(am|pm)))$/.test(s);},format:function(s){return $_21.tablesorter.formatFloat(new Date("2000/01/01 "+s).getTime());},type:"numeric"});ts.addParser({id:"metadata",is:function(s){return false;},format:function(s,table,cell){var c=table.config,p=(!c.parserMetadataName)?'sortValue':c.parserMetadataName;return $_21(cell).metadata()[p];},type:"numeric"});ts.addWidget({id:"zebra",format:function(table){if(table.config.debug){var time=new Date();}$_21("tr:visible",table.tBodies[0]).filter(':even').removeClass(table.config.widgetZebra.css[1]).addClass(table.config.widgetZebra.css[0]).end().filter(':odd').removeClass(table.config.widgetZebra.css[0]).addClass(table.config.widgetZebra.css[1]);if(table.config.debug){$_21.tablesorter.benchmark("Applying Zebra widget",time);}}});})($_21);
}
//faraway 21.武将カード分類ツールのソース(bro3_deck_tool.user.js)終了

//------------------------------------------
// 討伐・空き地 民兵出現 推定機
//------------------------------------------
function disp_calcn()
{
	if( !location.pathname.match("/facility/castle_send_troop.php") ){
		return;
	}

//　バージョン配置用
var ver_rack = "ver1.3.7 (Craford_custom)</b>";
var kino_ver = "1.05a";

//　配布URL
var se_rack = "<b><内蔵版>ブラウザ三国志 領地敵兵算出機 by Craford, BSE ";
var url_rack = "http://dev.3g-ws.com/?tools";
var com_rack = "出現目安です！ 初心者から変態まで御用達の通期版（とりあえず15期までは大丈夫。16期確認中）"	 // 2013/07/12修正
var url_rack2 = "http://chaki.s27.xrea.com/br3/";

var title = document.title;//　ページタイトル
var length;//　出兵距離格納変数
var tile = new Array(0,0,0,0,0,0);//　出兵先のタイル数格納変数（平地、木、岩、鉄、穀、荒地）の順。

//　出兵先のパネル構成ごとの兵数計算パラメータ
//　[剣、盾、槍、弓、騎、大、重、矛、弩、近衛]の順に格納。
//
// 鯖判定用（2011/02/09 Craford）
var sv_seazon = -1;

// 実処理用の変数はこれに統合（2011/02/09 Craford）
var point;


//　兵科に対する各ユニットの防御値
var def = {
	//:[剣,盾,槍,弓,騎,大剣,重盾,矛,弩,近衛],
	"ken":[15,24,50,52,54,85,60,140,145,151],	//剣兵防御
	"yari":[10,108,40,58,28,56,270,100,145,70],	//槍兵防御
	"yumi":[10,104,25,42,60,56,260,63,105,150],	//弓兵防御
	"ki":[10,112,55,26,44,56,280,137,65,110]	//騎兵防御
};

//　各ユニットの攻撃力
var atk = {
	"ken":15,
	"tate":5,
	"yari":40,
	"yumi":42,
	"ki":44,
	"dai":85,
	"jt":10,
	"hoko":100,
	"do":105,
	"kono":110,
	"ram":15,
	"catapult":30
};

//　鍛冶場Lv.
var kaji_lv = {
	"0":0,
	"1":0,
	"2":0.015,
	"3":0.03,
	"4":0.045,
	"5":0.06,
	"6":0.075,
	"7":0.09,
	"8":0.105,
	"9":0.12,
	"10":0.15
};

//　武器強化
var buki_lv = {
	"ken":[0,0.1,0.2,0.3,0.4,0.5,0.6,0.75,0.9,1.1,1.35],
	"tate":[0,0,0,0,0,0,0,0,0,0],
	"yari":[0,0.05,0.1,0.16,0.22,0.3,0.38,0.48,0.58,0.68,0.8],
	"yumi":[0,0.05,0.1,0.16,0.22,0.3,0.38,0.48,0.58,0.68,0.8],
	"ki":[0,0.05,0.1,0.16,0.22,0.3,0.38,0.48,0.58,0.68,0.8],
	"dai":[0,0,0,0,0,0,0,0,0,0],
	"jt":[0,0,0,0,0,0,0,0,0,0],
	"hoko":[0,0.04,0.08,0.12,0.16,0.2,0.24,0.28,0.33,0.38,0.45],
	"do":[0,0.04,0.08,0.12,0.16,0.2,0.24,0.28,0.33,0.38,0.45],
	"kono":[0,0.04,0.08,0.12,0.16,0.2,0.24,0.28,0.33,0.38,0.45],
	"ram":[0,0,0,0,0,0,0,0,0,0],
	"catapult":[0,0,0,0,0,0,0,0,0,0]
};


(function(){
		// 鯖バージョンの判別（2011/02/09 Craford）
		var svname = location.hostname.substr(0,location.hostname.indexOf("."));
		var season = 0;

		var sv_world = [];
		var sv_season = [];
		for(i=0;i<serverTable.length;i++){
			var BRO3_TOBATSU_SV	= 'bro3_tobatsu_sv' + i;
			var BRO3_TOBATSU_SEASON	= 'bro3_tobatsu_season' + i;
			if(GM_getValue(BRO3_TOBATSU_SV)){
				sv_world[i] = GM_getValue(BRO3_TOBATSU_SV);
				sv_season[i] = GM_getValue(BRO3_TOBATSU_SEASON);
			}else{
				sv_world[i] = serverTable[i][0];
				sv_season[i] = serverTable[i][1];
				GM_setValue(BRO3_TOBATSU_SV, sv_world[i]);
				GM_setValue(BRO3_TOBATSU_SEASON, sv_season[i]);
			}
			if( sv_world[i] == svname ){
				season = sv_season[i];
			}
		}

		// パネルテーブル
		var found = false;
		for(var i = 0; i < season_list.length; i++){
			for(var j = 0;j < season_list[i]['seasons'].length; j++){
				if(season == season_list[i]['seasons'][j]){
					point = season_list[i];
					found = true;
					break;
				}
			}
			if( found == true ){
				break;
			}
		}
		if( found == false ){
			alert("現在の期に対応する兵力計算表が見つかりません");
		}

		var world_text = svname + "ワールド 第" + season + "期目";
		com_rack = com_rack + "<br><b><font color='blue'>" + world_text + "</font></b>";

		//　出兵拠点座標の取得
		var areas = document.evaluate('//li[@class="gnavi02"]//a/@href', document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		basecord = areas.snapshotItem(0).textContent;
		basecord = basecord.replace(/^.*x=(-?[0-9]+).*y=(-?[0-9]+)/, "$1,$2");
		bcordx = RegExp.$1;
		bcordy = RegExp.$2;

		//　出兵先座標(x)の取得
		areas = document.evaluate('//input[@name="village_x_value"]/@value',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		tocordx = areas.snapshotItem(0).textContent;

		//　出兵先座標(y)の取得
		areas = document.evaluate('//input[@name="village_y_value"]/@value',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		tocordy = areas.snapshotItem(0).textContent;

		//　距離の計算
		length = Math.sqrt(Math.pow(bcordx-tocordx,2)+Math.pow(bcordy-tocordy,2));

		if(season>0){

			//　出兵先タイルパターン取得のためのHTTP要求　starに★数、tile[]に各タイル数を格納。
			var url = "http://"+location.hostname+"/land.php?x="+tocordx+"&y="+tocordy;
			GM_xmlhttpRequest({
				method:"GET",
				url:url,
				onload:function(x){
				//　読み込み後の処理は関数 getFieldType() 内で行う。
				getFieldType(x.responseText, length);
				}
			});

		}else{
			var msg = "";

			//　サーバー情報が見つからない場合。(登録されていないもの)
			msg = msg + "<br><table border=8><tr><td align=left>\n";
			msg = msg + com_rack + "<br>\n";
			msg = msg + "サーバー情報が登録されていません。<a id='svsetting_btn' href='javascript:void(0)'>サーバー情報を設定してください。</a></td>\n";
			msg = msg + "<td align=left rowspan=2>\n";

			msg = msg + "<table id=svsetting align=center style='text-align:center;background:#FFC;color:#C60;display:none;' width=116>\n";
			msg = msg + "<tr><td align=center><b>Server</b></td><td align=center><b>Season</b></td></tr>\n";
			for(var i = 0; i < serverTable.length; i++){
				var seasontext = "";
				for(var j = 1; j <= 14; j++) {
					seasontext += "<option value=" + j + ">" + j;
				}
				msg = msg + "<tr><td align=center><input type=text size=2 id=s"+i+"></td><td>第<select id=s"+i+"s>" + seasontext + "</select>期</td></tr>\n";
			}
			msg = msg + "<tr><td colspan=2>mapタイプで</td></tr>\n";
			msg = msg + "<tr><td colspan=2>a=1期<br>b=2期<br>c=34期<br>d=5-9期<br>e=10-11期<br>f=12-13期<br>g=14-15期<br>h=16期<br>に相当</td></tr>\n";
			msg = msg + "<tr><td colspan=2><input id=svsave_btn type=button value='保存' size=6>&nbsp;<input id=svreset_btn type=button value='初期化' size=8></td></tr>\n";
			msg = msg + "</table>\n";

			msg = msg + "</td></tr>\n";
			msg = msg + "<tr><td align=left>\n";
			msg = msg + se_rack + ver_rack + "<br>\n";
			msg = msg + "<b>　＋　賊討伐シミュレータ by kino. ver"+kino_ver+"</b><br>\n";

			var insertHtml = "<div align=center>" + msg + "</div>";

			var insertElem = document.createElement('div');
			insertElem.innerHTML = insertHtml;
			insertElem = insertElem.firstChild;
			var containerElem = document.evaluate('//*[@class=\"controlArea\"]', document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
			containerElem.snapshotItem(0).appendChild(insertElem);

			var svsetting_btn = document.getElementById("svsetting_btn");
			svsetting_btn.addEventListener("click", function(){view("svsetting");set_season();}, false);
			var svsave_btn = document.getElementById("svsave_btn");
			svsave_btn.addEventListener("click", function(){sv_save();}, false);
			var svreset_btn = document.getElementById("svreset_btn");
			svreset_btn.addEventListener("click", function(){reset_season();}, false);

		}

})();

//　タイルパターンの取得 及び 兵力計算・表示用関数
function getFieldType(x, length){

	//　ページ内のタイル数をカウントするための変数 初期化
	var panel = {
		"平地":0,
		"森林":0,
		"岩山":0,
		"鉄鉱山":0,
		"穀物":0,
		"荒地":0
	};

	//　GM_xmlhttpRequestの取得データをxml形式に変換
	var responseXML = document.createElement('div');
	responseXML.innerHTML = x;

	//　ソース中のタイルの行からtitleの文字列を取得
	var panels = document.evaluate('.//*[@id="mapOverlayMap"]//area/@title',
	responseXML, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);

	//　1行ずつ対応するタイルの変数を加算していく
	for (var i = 0; i < panels.snapshotLength; i++) {
		panel[panels.snapshotItem(i).textContent]++;
	}

	//　タイル数→キー（"111116"など）の作成
	var key = String(panel["森林"])+String(panel["岩山"])+String(panel["鉄鉱山"])+String(panel["穀物"])+String(panel["平地"]);
	//　兵力パラメータの取得
	var list = point[key];

	var i;
	var tmp = 0;
	var sum = 0;
	var kenk = 0;
	var yarik = 0;
	var yumik = 0;
	var kik = 0;

	var tmp2 = 0;
	var sum2 = 0;
	var kenk2 = 0;
	var yarik2 = 0;
	var yumik2 = 0;
	var kik2 = 0;

	var infantry_count = 0;
	var large_infantry_count = 0;
	var shield_count = 0;
	var heavy_shield_count = 0;
	var spear_count = 0;
	var archer_count = 0;
	var cavalry_count = 0;
	var halbert_count = 0;
	var ram_count = 0;
	var catapult_count = 0;
	var crossbow_count = 0;
	var cavalry_guards_count = 0;

	var soltype = "";

	//表示部分Non
	var msg = "";
	if(list==undefined){
		//　キーに対応するデータが見つからない場合。(データがないもの)
		msg = msg + "<br><table border=8><tr><td align=left>\n";
		msg = msg + com_rack + "　<a id='svsetting_btn' href='javascript:void(0)'>設定</a><br>\n";
		msg = msg + "有効なデータはありません。<br>※本拠地やNPC砦、未知の領地で有る可能性が有ります。</td>\n";
		msg = msg + "<td align=left rowspan=2>\n";

		msg = msg + "<table id=svsetting align=center style='text-align:center;background:#FFC;color:#C60;display:none;' width=116>\n";
		msg = msg + "<tr><td align=center><b>Server</b></td><td align=center><b>Season</b></td></tr>\n";
		for(var i = 0; i < serverTable.length; i++){
			var seasontext = "";
			for(var j = 1; j <= 16; j++) {
				seasontext += "<option value=" + j + ">" + j;
			}
			msg = msg + "<tr><td align=center><input type=text size=2 id=s"+i+"></td><td>第<select id=s"+i+"s>" + seasontext + "</select>期</td></tr>\n";
		}
		msg = msg + "<tr><td colspan=2>mapタイプは下記</td></tr>\n";
		msg = msg + "<tr><td colspan=2>a=1期<br>b=2期<br>c=34期<br>d=5-9期<br>e=10-11期<br>f=12-13期<br>g=14-15期<br>h=16期<br>に相当</td></tr>\n";
		msg = msg + "<tr><td colspan=2><input id=svsave_btn type=button value='保存' size=6>&nbsp;<input id=svreset_btn type=button value='初期化' size=8></td></tr>\n";
		msg = msg + "</table>\n";

		msg = msg + "</td></tr>\n";
		msg = msg + "<tr><td align=left>\n";
		msg = msg + se_rack + ver_rack + "<br>\n";
		msg = msg + "<b>　＋　賊討伐シミュレータ by kino. ver"+kino_ver+"</b><br>\n";


		var insertHtml = "<div align=center>" + msg + "</div>";

		var insertElem = document.createElement('div');
		insertElem.innerHTML = insertHtml;
		insertElem = insertElem.firstChild;
		var containerElem = document.evaluate('//*[@class=\"controlArea\"]', document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
		containerElem.snapshotItem(0).appendChild(insertElem);
	}else{
		//MAX計算用

		//距離最大時乗数
		var hentai = (1+length/10)*3;
		//最大出現数計算
		var kenmax = Math.floor(list[P_NSWD]*hentai);
		var tatemax = Math.floor(list[P_NSLD]*hentai);
		var yarimax = Math.floor(list[P_NSPR]*hentai);
		var yumimax = Math.floor(list[P_NARC]*hentai);
		var kimax = Math.floor(list[P_NKNT]*hentai);
		var daimax = Math.floor(list[P_HSWD]*hentai);
		var jtmax = Math.floor(list[P_HSLD]*hentai);
		var hokomax = Math.floor(list[P_HSPR]*hentai);
		var domax = Math.floor(list[P_HARC]*hentai);
		var konomax = Math.floor(list[P_HKNT]*hentai);
		//最大防御力集計
		var sum = kenmax+(tatemax+yarimax+yumimax+kimax)*2+daimax*3+(jtmax+hokomax+domax+konomax)*4;
		var kenk = kenmax*def["ken"][0]+tatemax*def["ken"][1]+yarimax*def["ken"][2]+yumimax*def["ken"][3]+kimax*def["ken"][4]+daimax*def["ken"][5]+jtmax*def["ken"][6]+hokomax*def["ken"][7]+domax*def["ken"][8]+konomax*def["ken"][9];
		var yarik = kenmax*def["yari"][0]+tatemax*def["yari"][1]+yarimax*def["yari"][2]+yumimax*def["yari"][3]+kimax*def["yari"][4]+daimax*def["yari"][5]+jtmax*def["yari"][6]+hokomax*def["yari"][7]+domax*def["yari"][8]+konomax*def["yari"][9];
		var yumik = kenmax*def["yumi"][0]+tatemax*def["yumi"][1]+yarimax*def["yumi"][2]+yumimax*def["yumi"][3]+kimax*def["yumi"][4]+daimax*def["yumi"][5]+jtmax*def["yumi"][6]+hokomax*def["yumi"][7]+domax*def["yumi"][8]+konomax*def["yumi"][9];
		var kik = kenmax*def["ki"][0]+tatemax*def["ki"][1]+yarimax*def["ki"][2]+yumimax*def["ki"][3]+kimax*def["ki"][4]+daimax*def["ki"][5]+jtmax*def["ki"][6]+hokomax*def["ki"][7]+domax*def["ki"][8]+konomax*def["ki"][9];

		//距離最小時乗数
		var hentai2 = (1+length/10);
		//最小出現数計算
		var kenmin = Math.floor(list[P_NSWD]*hentai2);
		var tatemin = Math.floor(list[P_NSLD]*hentai2);
		var yarimin = Math.floor(list[P_NSPR]*hentai2);
		var yumimin = Math.floor(list[P_NARC]*hentai2);
		var kimin = Math.floor(list[P_NKNT]*hentai2);
		var daimin = Math.floor(list[P_HSWD]*hentai2);
		var jtmin = Math.floor(list[P_HSLD]*hentai2);
		var hokomin = Math.floor(list[P_HSPR]*hentai2);
		var domin = Math.floor(list[P_HARC]*hentai2);
		var konomin = Math.floor(list[P_HKNT]*hentai2);

		//最小防御力集計
		var kenk2 = kenmin*def["ken"][0]+tatemin*def["ken"][1]+yarimin*def["ken"][2]+yumimin*def["ken"][3]+kimin*def["ken"][4]+daimin*def["ken"][5]+jtmin*def["ken"][6]+hokomin*def["ken"][7]+domin*def["ken"][8]+konomin*def["ken"][9];
		var yarik2 = kenmin*def["yari"][0]+tatemin*def["yari"][1]+yarimin*def["yari"][2]+yumimin*def["yari"][3]+kimin*def["yari"][4]+daimin*def["yari"][5]+jtmin*def["yari"][6]+hokomin*def["yari"][7]+domin*def["yari"][8]+konomin*def["yari"][9];
		var yumik2 = kenmin*def["yumi"][0]+tatemin*def["yumi"][1]+yarimin*def["yumi"][2]+yumimin*def["yumi"][3]+kimin*def["yumi"][4]+daimin*def["yumi"][5]+jtmin*def["yumi"][6]+hokomin*def["yumi"][7]+domin*def["yumi"][8]+konomin*def["yumi"][9];
		var kik2 = kenmin*def["ki"][0]+tatemin*def["ki"][1]+yarimin*def["ki"][2]+yumimin*def["ki"][3]+kimin*def["ki"][4]+daimin*def["ki"][5]+jtmin*def["ki"][6]+hokomin*def["ki"][7]+domin*def["ki"][8]+konomin*def["ki"][9];

		//表示部分フォント追加分
		var red_f = "</b></font>\n";
		var red_s = "<font color=red><b>";
		var gre_s = "<font color=blue>";
		if (title.indexOf("出兵(入力)") != -1) {
			var sol_items = document.evaluate("//table[@class='innerTables']//span", document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
			// 剣兵
			infantry_count = document.evaluate("//table[@class='innerTables']//span", document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0).innerHTML.match(/[0-9]+/);
			// 大剣兵
			large_infantry_count = document.evaluate("//table[@class='innerTables']//span", document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(1).innerHTML.match(/[0-9]+/);
			// 盾兵
			shield_count = sol_items.snapshotItem(2).innerHTML.match(/[0-9]+/);
			// 重盾兵
			heavy_shield_count = sol_items.snapshotItem(3).innerHTML.match(/[0-9]+/);
			// 槍兵
			spear_count = sol_items.snapshotItem(4).innerHTML.match(/[0-9]+/);
			// 矛槍兵
			halbert_count = sol_items.snapshotItem(5).innerHTML.match(/[0-9]+/);
			// 弓兵
			archer_count = sol_items.snapshotItem(6).innerHTML.match(/[0-9]+/);
			// 弩兵
			crossbow_count = sol_items.snapshotItem(7).innerHTML.match(/[0-9]+/);
			// 衝車
			ram_count = sol_items.snapshotItem(8).innerHTML.match(/[0-9]+/);
			// 投石機
			catapult_count = sol_items.snapshotItem(9).innerHTML.match(/[0-9]+/);
			// 騎兵
			cavalry_count = sol_items.snapshotItem(10).innerHTML.match(/[0-9]+/);
			// 近衛騎兵
			cavalry_guards_count = sol_items.snapshotItem(11).innerHTML.match(/[0-9]+/);
		} else if (title.indexOf("出兵(確認)") != -1) {
			var sol_items = document.evaluate("//table[@class='fighting_units']//input/@value", document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);

			//　剣兵
			infantry_count = sol_items.snapshotItem(0).textContent;
			//　大剣兵
			large_infantry_count = sol_items.snapshotItem(1).textContent;
			//　盾兵
			shield_count = sol_items.snapshotItem(2).textContent;
			//　重盾兵
			heavy_shield_count = sol_items.snapshotItem(3).textContent;
			//　槍兵
			spear_count = sol_items.snapshotItem(4).textContent;
			//　矛槍兵
			halbert_count = sol_items.snapshotItem(5).textContent;
			//　弓兵
			archer_count = sol_items.snapshotItem(6).textContent;
			//　弩兵
			crossbow_count = sol_items.snapshotItem(7).textContent;
			//　衝車
			ram_count = sol_items.snapshotItem(8).textContent;
			//　投石機
			catapult_count = sol_items.snapshotItem(9).textContent;
			//　騎兵
			cavalry_count = sol_items.snapshotItem(10).textContent;
			//　近衛騎兵
			cavalry_guards_count = sol_items.snapshotItem(11).textContent;

			//　総攻撃力
			var power = 0;
			areas = document.evaluate('//strong[@class="size1"]', document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
			power = areas.snapshotItem(0).textContent;
			power = power.replace(/,/,'');
			power = power.replace(/,/,'');

			//　武将兵科
			areas = document.evaluate('//span[@class="soltype"]//img/@title', document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
			if(areas.snapshotItem(0)) soltype = areas.snapshotItem(0).textContent;
		}

		//表示部分
		msg = msg + "<br><table border=8><tr><td align=left colspan=2>\n";
		msg = msg + com_rack + "　<a id='svsetting_btn' href='javascript:void(0)'>設定</a><br>\n";
		msg = msg + "</td>\n";
		msg = msg + "<td align=left rowspan=3>\n";

		msg = msg + "<table id=svsetting align=center style='text-align:center;background:#FFC;color:#C60;display:none;' width=116>\n";
		msg = msg + "<tr><td align=center><b>Server</b></td><td align=center><b>Season</b></td></tr>\n";
		for(var i = 0; i < serverTable.length; i++){
			var seasontext = "";
			for(var j = 1; j <= 16; j++) {
				seasontext += "<option value=" + j + ">" + j;
			}
			msg = msg + "<tr><td align=center><input type=text size=2 id=s"+i+"></td><td>第<select id=s"+i+"s>" + seasontext + "</select>期</td></tr>\n";
		}

		msg = msg + "<tr><td colspan=2>mapタイプは下記</td></tr>\n";
		msg = msg + "<tr><td colspan=2>a=1期<br>b=2期<br>c=34期<br>d=5-9期<br>e=10-11期<br>f=12-13期<br>g=14-15期<br>h=16期<br>に相当</td></tr>\n";
		msg = msg + "<tr><td colspan=2><input id=svsave_btn type=button value='保存' size=6>&nbsp;<input id=svreset_btn type=button value='初期化' size=8></td></tr>\n";
		msg = msg + "</table>\n";

		msg = msg + "</td></tr><tr><td align=left>\n";
		msg = msg + "<font color=green><b>最大出現兵数総計：" + String(Math.floor(sum))+ "</b></font><br>\n";
		msg = msg + "出兵元：<a href='/map.php?x=" + bcordx +"&y=" + bcordy + "'>(" + bcordx +"," + bcordy + ")</a><br>\n";
		msg = msg + "◆　距離：" + String(Math.floor(length*100+0.5)/100) + "　◆<br>\n";
		msg = msg + "目的地：<a href='/map.php?x=" + tocordx +"&y=" + tocordy + "'>(" + tocordx +"," + tocordy + ")</a>　　地形：" + String(list[0]) + "<br>\n";
		msg = msg + "<font color=red>\n";
		msg = msg + "兵種：最大兵数～最小兵数<br>\n";
		msg = msg + "</font>\n";
		msg = msg + "剣兵：\n"+ red_s + String(kenmax) + red_f;
		msg = msg + "～" + gre_s   + String(kenmin) + red_f + "<br>\n";
//		msg = msg + "&nbsp;大剣兵：\n"+ red_s + String(daimax) + red_f;
//		msg = msg + "～" + gre_s   + String(daimin) + red_f + "<br>\n";
		msg = msg + "盾兵：\n"+ red_s + String(tatemax) + red_f;
		msg = msg + "～" + gre_s   + String(tatemin) + red_f;
		msg = msg + "&nbsp;重盾：\n"+ red_s + String(jtmax) + red_f;
		msg = msg + "～" + gre_s   + String(jtmin) + red_f + "<br>\n";
		msg = msg + "槍兵：\n"+ red_s + String(yarimax) + red_f;
		msg = msg + "～" + gre_s   + String(yarimin) + red_f;
		msg = msg + "&nbsp;矛槍：\n"+ red_s + String(hokomax) + red_f;
		msg = msg + "～" + gre_s   + String(hokomin) + red_f + "<br>\n";
		msg = msg + "弓兵：\n"+ red_s + String(yumimax) + red_f;
		msg = msg + "～" + gre_s   + String(yumimin) + red_f;
		msg = msg + "&nbsp;弩兵：\n"+ red_s + String(domax) + red_f;
		msg = msg + "～" + gre_s   + String(domin) + red_f + "<br>\n";
		msg = msg + "騎兵：\n"+ red_s + String(kimax) + red_f;
		msg = msg + "～" + gre_s   + String(kimin) + red_f;
		msg = msg + "&nbsp;近衛：\n" + red_s  + String(konomax) + red_f;
		msg = msg + "～" + gre_s   + String(konomin) + red_f + "<br>\n";
		msg = msg + "<span id='simple'><font color=red>\n";
		msg = msg + "対兵科：防御力MAX～MIN<br>\n"
		msg = msg + "</font>\n";
		msg = msg + "剣兵科："+ red_s + String(kenk) + red_f + "～"+ gre_s + String(kenk2) + red_f+ "<br>\n";
		msg = msg + "槍兵科："+ red_s + String(yarik) + red_f + "～"+ gre_s + String(yarik2) + red_f+"<br>\n";
		msg = msg + "弓兵科："+ red_s + String(yumik) + red_f + "～"+ gre_s + String(yumik2) + red_f+"<br>\n";
		msg = msg + "騎兵科："+ red_s + String(kik) + red_f + "～"+ gre_s + String(kik2) + red_f+"<br>\n";
		msg = msg + "<font color=red>\n";
		msg = msg + "無強化兵士に単純換算<br>\n";
		msg = msg + "</font>\n";
		msg = msg + "剣：\n"+ red_s + Math.ceil(kenk/atk["ken"]) + red_f + "～" + gre_s   + Math.ceil(kenk2/atk["ken"]) + red_f + "(大剣：\n"+ red_s + Math.ceil(kenk/atk["dai"]) + red_f + "～" + gre_s   + Math.ceil(kenk2/atk["dai"]) + red_f + "）<br>\n"
		msg = msg + "槍：\n"+ red_s + Math.ceil(yarik/atk["yari"]) + red_f + "～" + gre_s + Math.ceil(yarik2/atk["yari"]) + red_f + "(矛槍：\n"+ red_s + Math.ceil(yarik/atk["hoko"]) + red_f + "～" + gre_s   + Math.ceil(yarik2/atk["hoko"]) + red_f + "）<br>\n";
		msg = msg + "弓：\n"+ red_s + Math.ceil(yumik/atk["yumi"]) + red_f + "～" + gre_s + Math.ceil(yumik2/atk["yumi"]) + red_f + "(弩兵：\n"+ red_s + Math.ceil(yumik/atk["do"]) + red_f + "～" + gre_s	 + Math.ceil(yumik2/atk["do"]) + red_f + "）<br>\n";
		msg = msg + "騎：\n"+ red_s + Math.ceil(kik/atk["ki"]) + red_f + "～" + gre_s + Math.ceil(kik2/atk["ki"]) + red_f + "(近衛：\n"+ red_s + Math.ceil(kik/atk["kono"]) + red_f + "～" + gre_s	 + Math.ceil(kik2/atk["kono"]) + red_f + "）<br>\n";

		msg = msg + "</td><td align=center style='text-align:center;background:#FFC;color:#C60;'>\n";

		msg = msg + "<br><b><font size='+1'>賊討伐シミュレータ</font> ver "+kino_ver+"</b><br><br>\n";
		msg = msg + "<form>\n";

		msg = msg + "<div align='right'><input type='button' id='get_kajiba' value='鍛冶場・課金状況取得'></div>\n";
		msg = msg + "<table id='power_tab' border='1' align='center' style='background:white;color:gray;'><tr>\n";
		msg = msg + "<td>武将攻撃力：</td><td><input type='text' value=0 id='b_power' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='b_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武将兵科:<select id='b_type'><option value=0>歩<option value=1>槍<option value=2>弓<option value=3>騎</select>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>スキル：</td><td colspan=3 align=right><select id='skill'><option value=0>武将<option value=1>剣兵・歩兵兵科の武将<option value=2>槍兵・矛槍兵・槍兵兵科の武将<option value=3>弓兵・弩兵・弓兵兵科の武将<option value=4>騎兵・近衛騎兵・騎兵兵科の武将<option value=5>全ての兵士・武将<option value=6>近衛騎兵・矛槍兵・弩兵</select><br>の攻撃力が<input type='text' value=0 id='skill_rate' size=4 style='text-align:right;' />%上昇する</td>\n"
		msg = msg + "</tr><tr>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td></td><td>兵士数</td><td>スキル効果</td><td>鍛冶場Lv:<select id='kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n"
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>剣兵：</td><td><input type='text' value='" + infantry_count + "' id='infantry_count2' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='ken_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武器Lv:<select id='ken_kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>盾兵：</td><td><input type='text' value='" + shield_count + "' id='shield_count2' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='tate_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武器Lv:<select id='tate_kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>槍兵：</td><td><input type='text' value='" + spear_count + "' id='spear_count2' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='yari_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武器Lv:<select id='yari_kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>弓兵：</td><td><input type='text' value='" + archer_count + "' id='archer_count2' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='yumi_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武器Lv:<select id='yumi_kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>騎兵：</td><td><input type='text' value='" + cavalry_count + "' id='cavalry_count2' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='ki_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武器Lv:<select id='ki_kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>大剣兵：</td><td><input type='text' value='" + large_infantry_count + "' id='large_infantry_count2' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='dai_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武器Lv:<select id='dai_kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>重盾兵：</td><td><input type='text' value='" + heavy_shield_count + "' id='heavy_shield_count2' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='jt_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武器Lv:<select id='jt_kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>矛槍兵：</td><td><input type='text' value='" + halbert_count + "' id='halbert_count2' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='hoko_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武器Lv:<select id='hoko_kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>弩兵：</td><td><input type='text' value='" + crossbow_count + "' id='crossbow_count2' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='do_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武器Lv:<select id='do_kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>近衛騎兵：</td><td><input type='text' value='" + cavalry_guards_count + "' id='cavalry_guards_count2' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='konoe_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武器Lv:<select id='konoe_kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>衝車：</td><td><input type='text' value='" + ram_count + "' id='ram_count2' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='ram_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武器Lv:<select id='ram_kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td>投石機：</td><td><input type='text' value='" + catapult_count + "' id='catapult_count2' size=5 style='text-align:right;' /></td><td>+<input type='text' value=0 id='catapult_skill' size=4 style='text-align:right;' />%</td>\n";
		msg = msg + "<td>武器Lv:<select id='catapult_kaji'><option value=0>0<option value=1>1<option value=2>2<option value=3>3<option value=4>4<option value=5>5<option value=6>6<option value=7>7<option value=8>8<option value=9>9<option value=10>10</select></td>\n";
		msg = msg + "</tr><tr>\n";
		msg = msg + "<td colspan='4'>課金(またはヨロズダス)による攻撃力上昇：<select id='cp'><option value=0>無<option value=1>有</select></td>\n";
		msg = msg + "</tr></table><br>\n";
		msg = msg + "<span title='部隊の総攻撃力'>部隊攻撃力：<input type='text' id='power2' size='8' style='color:red;border-width:0;'/></span><br>\n";
		msg = msg + "<span title='部隊の構成比から計算される民兵の防御力の最大値・最小値（乱数の最大・最小）。他同盟の領地の場合、援軍および領地レベルは考慮しない。'>民兵防御力：<input type='text' id='dmax2' size='8' style='color:blue;border-width:0;'/>～<input type='text' id='dmin2' size='8' style='color:blue;border-width:0;'/></span><br>\n";
		msg = msg + "<span title='賊討伐が成功する確率（武将のHPが100に満たない場合はこの限りではない）'>討伐成功率：<input type='text' id='result' size='3' style='background-color:black;color:red;font-size:24px;border-width:0;text-align:right;'/>%</span><br>\n";
		msg = msg + "<span style='font-size:11px;' title='全乱数パターンに対する討伐成功パターン数'>（WIN <input type='text'id='vcnt2' size='3' style='background:#FFC;color:#C60;border-width:0;text-align:center;'/>/ALL <input type='text'id='cnt2' size='3' style='background:#FFC;color:#C60;border-width:0;text-align:center;'/>）</span><br>\n";
		msg = msg + "<input type='button' value=再計算 id='recalc'><br><br>\n";
		msg = msg + "</form>\n";

		msg = msg + "</td></tr>\n";

		msg = msg + "<tr><td align=left colspan=2>\n";
		msg = msg + se_rack + ver_rack + "<br>\n";
		msg = msg + "<b>　＋　賊討伐シミュレータ by kino. ver"+kino_ver+"</b><br>\n";

		var insertHtml = "<div align=center>" + msg + "</div>";

		var insertElem = document.createElement('div');
		insertElem.innerHTML = insertHtml;
		insertElem = insertElem.firstChild;
		var containerElem = document.evaluate('//*[@class=\"controlArea\"]', document, null, XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
		containerElem.snapshotItem(0).appendChild(insertElem);

		if (title.indexOf("出兵(確認)") != -1) {
			sol_index();
			close("simple");
			close("power_tab");
			close("recalc");
			close("get_kajiba");
			rec();
		}

		if (title.indexOf("出兵(入力)") != -1) {
			var get_kajiba = document.getElementById("get_kajiba");
			get_kajiba.addEventListener("click", function(){get_kaji_lv();}, false);
		}

		var skill_sel = document.getElementById("skill");skill_sel.addEventListener("change", function(){changeskill();}, false);
		var skill_rate = document.getElementById("skill_rate");	skill_rate.addEventListener("change", function(){changeskill();}, false);
		var b_type = document.getElementById("b_type");	b_type.addEventListener("change", function(){changeskill();}, false);

		var recalc = document.getElementById("recalc");
		recalc.addEventListener("click", function(){rec();}, false);
	}

	function rec(){
		var power = 0;

		var b_power = document.getElementById("b_power").value;
		var b_skill = document.getElementById("b_skill").value;
		var b_type = document.getElementById("b_type");
		var b_type2 = b_type.options[b_type.selectedIndex].value;
		var kaji = document.getElementById("kaji");
		kaji = kaji.options[kaji.selectedIndex].value;
		kaji = kaji_lv[kaji];
		var cp = document.getElementById("cp");
		cp = cp.options[cp.selectedIndex].value;

		var infantry_count2 = document.getElementById("infantry_count2").value;
		var ken_skill = document.getElementById("ken_skill").value;
		var ken_kaji = document.getElementById("ken_kaji");
		ken_kaji = ken_kaji.options[ken_kaji.selectedIndex].value;

		var large_infantry_count2 = document.getElementById("large_infantry_count2").value;
		var dai_skill = document.getElementById("dai_skill").value;
		var dai_kaji = document.getElementById("dai_kaji");
		dai_kaji = dai_kaji.options[dai_kaji.selectedIndex].value;

		var shield_count2 = document.getElementById("shield_count2").value;
		var tate_skill = document.getElementById("tate_skill").value;
		var tate_kaji = document.getElementById("tate_kaji");
		tate_kaji = tate_kaji.options[tate_kaji.selectedIndex].value;

		var heavy_shield_count2 = document.getElementById("heavy_shield_count2").value;
		var jt_skill = document.getElementById("jt_skill").value;
		var jt_kaji = document.getElementById("jt_kaji");
		jt_kaji = jt_kaji.options[jt_kaji.selectedIndex].value;

		var spear_count2 = document.getElementById("spear_count2").value;
		var yari_skill = document.getElementById("yari_skill").value;
		var yari_kaji = document.getElementById("yari_kaji");
		yari_kaji = yari_kaji.options[yari_kaji.selectedIndex].value;

		var archer_count2 = document.getElementById("archer_count2").value;
		var yumi_skill = document.getElementById("yumi_skill").value;
		var yumi_kaji = document.getElementById("yumi_kaji");
		yumi_kaji = yumi_kaji.options[yumi_kaji.selectedIndex].value;

		var cavalry_count2 = document.getElementById("cavalry_count2").value;
		var ki_skill = document.getElementById("ki_skill").value;
		var ki_kaji = document.getElementById("ki_kaji");
		ki_kaji = ki_kaji.options[ki_kaji.selectedIndex].value;

		var halbert_count2 = document.getElementById("halbert_count2").value;
		var hoko_skill = document.getElementById("hoko_skill").value;
		var hoko_kaji = document.getElementById("hoko_kaji");
		hoko_kaji = hoko_kaji.options[hoko_kaji.selectedIndex].value;

		var crossbow_count2 = document.getElementById("crossbow_count2").value;
		var do_skill = document.getElementById("do_skill").value;
		var do_kaji = document.getElementById("do_kaji");
		do_kaji = do_kaji.options[do_kaji.selectedIndex].value;

		var cavalry_guards_count2 = document.getElementById("cavalry_guards_count2").value;
		var konoe_skill = document.getElementById("konoe_skill").value;
		var konoe_kaji = document.getElementById("konoe_kaji");
		konoe_kaji = konoe_kaji.options[konoe_kaji.selectedIndex].value;

		var ram_count2 = document.getElementById("ram_count2").value;
		var ram_skill = document.getElementById("ram_skill").value;
		var ram_kaji = document.getElementById("ram_kaji");
		ram_kaji = ram_kaji.options[ram_kaji.selectedIndex].value;

		var catapult_count2 = document.getElementById("catapult_count2").value;
		var catapult_skill = document.getElementById("catapult_skill").value;
		var catapult_kaji = document.getElementById("catapult_kaji");
		catapult_kaji = catapult_kaji.options[catapult_kaji.selectedIndex].value;

		//攻撃側総兵数
		attack_count = 1;	// 武将
		attack_count +=   Math.floor(infantry_count2) + Math.floor(shield_count2) + Math.floor(spear_count2) + Math.floor(archer_count2) + Math.floor(cavalry_count2)
						+ Math.floor(halbert_count2) + Math.floor(crossbow_count2) + Math.floor(cavalry_guards_count2)
						+ Math.floor(large_infantry_count2) + Math.floor(heavy_shield_count2)
						+ Math.floor(ram_count2) + Math.floor(catapult_count2);

		//歩兵科
		aken = Math.floor(infantry_count2) + Math.floor(large_infantry_count2) + Math.floor(shield_count2) + Math.floor(heavy_shield_count2) + Math.floor(ram_count2) + Math.floor(catapult_count2);
		if(b_type2=="0") aken+=1;
		aken /= attack_count;

		//槍兵科
		ayari = Math.floor(spear_count2) + Math.floor(halbert_count2);
		if(b_type2=="1") ayari += 1;
		ayari = ayari / attack_count;

		//弓兵科
		ayumi = Math.floor(archer_count2) + Math.floor(crossbow_count2);
		if(b_type2=="2") ayumi+=1;
		ayumi /= attack_count;

		//騎兵科
		aki = Math.floor(cavalry_count2) + Math.floor(cavalry_guards_count2);
		if(b_type2=="3") aki+=1;
		aki /= attack_count;

		//各兵科攻撃力
		b_power = b_power*(1 + b_skill / 100);
		var infantry_power = infantry_count2 * atk["ken"] * ( 1 + ken_skill / 100 + kaji + buki_lv["ken"][ken_kaji]);
		var large_infantry_power = large_infantry_count2 * atk["dai"] * ( 1 + dai_skill / 100 + kaji + buki_lv["dai"][dai_kaji]);
		var shield_power = shield_count2 * atk["tate"] * ( 1 + tate_skill / 100 + kaji + buki_lv["tate"][tate_kaji]);
		var heavy_shield_power = heavy_shield_count2 * atk["jt"] * ( 1 + jt_skill / 100 + kaji + buki_lv["jt"][jt_kaji]);
		var spear_power = spear_count2 * atk["yari"] * ( 1 + yari_skill / 100 + kaji + buki_lv["yari"][yari_kaji]);
		var archer_power = archer_count2 * atk["yumi"] * ( 1 + yumi_skill / 100 + kaji + buki_lv["yumi"][yumi_kaji]);
		var cavalry_power = cavalry_count2 * atk["ki"] * ( 1 + ki_skill / 100 + kaji + buki_lv["ki"][ki_kaji]);
		var halbert_power = halbert_count2 * atk["hoko"] * ( 1 + hoko_skill / 100 + kaji + buki_lv["hoko"][hoko_kaji]);
		var crossbow_power = crossbow_count2 * atk["do"] * ( 1 + do_skill / 100 + kaji + buki_lv["do"][do_kaji]);
		var cavalry_guards_power = cavalry_guards_count2 * atk["kono"] * ( 1 + konoe_skill / 100 + kaji + buki_lv["kono"][konoe_kaji]);
		var ram_power = ram_count2 * atk["ram"] * ( 1 + ram_skill / 100 + kaji + buki_lv["ram"][ram_kaji]);
		var catapult_power = catapult_count2 * atk["catapult"] * ( 1 + catapult_skill / 100 + kaji + buki_lv["catapult"][catapult_kaji]);

		if (title.indexOf("出兵(入力)") != -1) {
			//総攻撃力
			power =   Math.floor((	  Math.floor(b_power) + Math.floor(infantry_power) + Math.floor(large_infantry_power)
									+ Math.floor(shield_power) + Math.floor(heavy_shield_power)
									+ Math.floor(spear_power) + Math.floor(archer_power) + Math.floor(cavalry_power)
									+ Math.floor(halbert_power) + Math.floor(crossbow_power) + Math.floor(cavalry_guards_power)
									+ Math.floor(ram_power) + Math.floor(catapult_power)
								) * ( 1 + 0.1*cp));
		}
		else {
			// 確認画面は運営の出した数字を使う
			var areas = document.evaluate('//strong[@class="size1"]', document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
			power = areas.snapshotItem(0).textContent;
			power = power.replace(/,/,'');
			power = power.replace(/,/,'');
		}

		//相対防御
		var dkenmax = kenmax*(aken*def["ken"][0]+ayari*def["yari"][0]+ayumi*def["yumi"][0]+aki*def["ki"][0]);
		var dtatemax = tatemax*(aken*def["ken"][1]+ayari*def["yari"][1]+ayumi*def["yumi"][1]+aki*def["ki"][1]);
		var dyarimax = yarimax*(aken*def["ken"][2]+ayari*def["yari"][2]+ayumi*def["yumi"][2]+aki*def["ki"][2]);
		var dyumimax = yumimax*(aken*def["ken"][3]+ayari*def["yari"][3]+ayumi*def["yumi"][3]+aki*def["ki"][3]);
		var dkimax = kimax*(aken*def["ken"][4]+ayari*def["yari"][4]+ayumi*def["yumi"][4]+aki*def["ki"][4]);
		var ddaimax = daimax*(aken*def["ken"][5]+ayari*def["yari"][5]+ayumi*def["yumi"][5]+aki*def["ki"][5]);
		var djtmax = jtmax*(aken*def["ken"][6]+ayari*def["yari"][6]+ayumi*def["yumi"][6]+aki*def["ki"][6]);
		var dhokomax = hokomax*(aken*def["ken"][7]+ayari*def["yari"][7]+ayumi*def["yumi"][7]+aki*def["ki"][7]);
		var ddomax = domax*(aken*def["ken"][8]+ayari*def["yari"][8]+ayumi*def["yumi"][8]+aki*def["ki"][8]);
		var dkonomax = konomax*(aken*def["ken"][9]+ayari*def["yari"][9]+ayumi*def["yumi"][9]+aki*def["ki"][9]);

		var dkenmin = kenmin*(aken*def["ken"][0]+ayari*def["yari"][0]+ayumi*def["yumi"][0]+aki*def["ki"][0]);
		var dtatemin = tatemin*(aken*def["ken"][1]+ayari*def["yari"][1]+ayumi*def["yumi"][1]+aki*def["ki"][1]);
		var dyarimin = yarimin*(aken*def["ken"][2]+ayari*def["yari"][2]+ayumi*def["yumi"][2]+aki*def["ki"][2]);
		var dyumimin = yumimin*(aken*def["ken"][3]+ayari*def["yari"][3]+ayumi*def["yumi"][3]+aki*def["ki"][3]);
		var dkimin = kimin*(aken*def["ken"][4]+ayari*def["yari"][4]+ayumi*def["yumi"][4]+aki*def["ki"][4]);
		var ddaimin = daimin*(aken*def["ken"][5]+ayari*def["yari"][5]+ayumi*def["yumi"][5]+aki*def["ki"][5]);
		var djtmin = jtmin*(aken*def["ken"][6]+ayari*def["yari"][6]+ayumi*def["yumi"][6]+aki*def["ki"][6]);
		var dhokomin = hokomin*(aken*def["ken"][7]+ayari*def["yari"][7]+ayumi*def["yumi"][7]+aki*def["ki"][7]);
		var ddomin = domin*(aken*def["ken"][8]+ayari*def["yari"][8]+ayumi*def["yumi"][8]+aki*def["ki"][8]);
		var dkonomin = konomin*(aken*def["ken"][9]+ayari*def["yari"][9]+ayumi*def["yumi"][9]+aki*def["ki"][9]);

		//総防御力
		var dmax = dkenmax + dtatemax + dyumimax + dyarimax + dkimax + ddaimax + djtmax + ddomax + dhokomax + dkonomax ;
		var dmin = dkenmin + dtatemin + dyumimin + dyarimin + dkimin + ddaimin + djtmin + ddomin + dhokomin + dkonomin ;

		//討伐成功率（詳細）
		//　全乱数パターンについて防御力を計算（11通り×3種で1331パターン）
		//　ver.1.03からはこちらを使用
		var cnt = 0;
		var vcnt = 0;

		if(list[P_NSWD] == 0){
			//☆1以外
			for( var j=0; j < 11; j++){
				for( var k=0; k < 11; k++){
					for( var l=0; l < 11; l++){
						cnt += 1;
						var hentai_j = hentai2*(10+j*2)/10;
						var hentai_k = hentai2*(10+k*2)/10;
						var hentai_l = hentai2*(10+l*2)/10;

						var ken_x = Math.floor(list[P_NSWD]*hentai_j);
						var tate_x = Math.floor(list[P_NSLD]*hentai_j);
						var yari_x = Math.floor(list[P_NSPR]*hentai_k);
						var yumi_x = Math.floor(list[P_NARC]*hentai_j);
						var ki_x = Math.floor(list[P_NKNT]*hentai_l);
						var dai_x = Math.floor(list[P_HSWD]*hentai_j);
						var jt_x = Math.floor(list[P_HSLD]*hentai_j);
						var hoko_x = Math.floor(list[P_HSPR]*hentai_k);
						var do_x = Math.floor(list[P_HARC]*hentai_j);
						var kono_x = Math.floor(list[P_HKNT]*hentai_l);

						var dken = ken_x*(aken*def["ken"][0]+ayari*def["yari"][0]+ayumi*def["yumi"][0]+aki*def["ki"][0]);
						var dtate = tate_x*(aken*def["ken"][1]+ayari*def["yari"][1]+ayumi*def["yumi"][1]+aki*def["ki"][1]);
						var dyari = yari_x*(aken*def["ken"][2]+ayari*def["yari"][2]+ayumi*def["yumi"][2]+aki*def["ki"][2]);
						var dyumi = yumi_x*(aken*def["ken"][3]+ayari*def["yari"][3]+ayumi*def["yumi"][3]+aki*def["ki"][3]);
						var dki = ki_x*(aken*def["ken"][4]+ayari*def["yari"][4]+ayumi*def["yumi"][4]+aki*def["ki"][4]);
						var ddai = dai_x*(aken*def["ken"][5]+ayari*def["yari"][5]+ayumi*def["yumi"][5]+aki*def["ki"][5]);
						var djt = jt_x*(aken*def["ken"][6]+ayari*def["yari"][6]+ayumi*def["yumi"][6]+aki*def["ki"][6]);
						var dhoko = hoko_x*(aken*def["ken"][7]+ayari*def["yari"][7]+ayumi*def["yumi"][7]+aki*def["ki"][7]);
						var ddo = do_x*(aken*def["ken"][8]+ayari*def["yari"][8]+ayumi*def["yumi"][8]+aki*def["ki"][8]);
						var dkono = kono_x*(aken*def["ken"][9]+ayari*def["yari"][9]+ayumi*def["yumi"][9]+aki*def["ki"][9]);

						var d = dken + dtate + dyumi + dyari + dki + ddai + djt + ddo + dhoko + dkono ;
						if( power > d ) vcnt += 1;
					}
				}
			}
		}else{
			//☆1
			for( var j=0; j < 11; j++){
				cnt += 1;
				var hentai_j = hentai2*(10+j*2)/10;
				var ken_x = Math.floor(list[P_NSWD]*hentai_j);
				var dken = ken_x*(aken*def["ken"][0]+ayari*def["yari"][0]+ayumi*def["yumi"][0]+aki*def["ki"][0]);
				var d = dken;
				if( power > d ) vcnt += 1;
			};
		}

		var success_rate = vcnt / cnt * 100;
		vcnt2 = document.getElementById("vcnt2");
		vcnt2.value = vcnt ;
		cnt2 = document.getElementById("cnt2");
		cnt2.value = cnt ;
		//成功率計算ここまで
		power2 = document.getElementById("power2");
		power2.value = power;
		dmax2 = document.getElementById("dmax2");
		dmax2.value = dmax.toFixed(0);
		dmin2 = document.getElementById("dmin2");
		dmin2.value = dmin.toFixed(0);
		var result = document.getElementById("result");
		result.value = success_rate.toFixed(1);
	}

	var svsetting_btn = document.getElementById("svsetting_btn");
		svsetting_btn.addEventListener("click", function(){view("svsetting");set_season();}, false);
	var svsave_btn = document.getElementById("svsave_btn");
		svsave_btn.addEventListener("click", function(){sv_save();}, false);
	var svreset_btn = document.getElementById("svreset_btn");
		svreset_btn.addEventListener("click", function(){reset_season();}, false);

	function get_kaji_lv(){

		//鍛冶場Lv・武器強化Lvを自動入力
		var url2 = "http://"+location.hostname+"/village.php";
		GM_xmlhttpRequest({
			method:"GET",
			url:url2,
			onload:function(x){
				var responseXML = document.createElement('div');
				responseXML.innerHTML = x.responseText;

				var panels2 = document.evaluate('.//*[@id="mapOverlayMap"]//area/@title',
				responseXML, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);

				for (var i = 0; i < panels2.snapshotLength; i++) {
					panels3 = panels2.snapshotItem(i).textContent;
					if(panels3.indexOf("鍛冶場") != -1) {
						var kajiba_panel = ".//*[@title='" + panels3+ "']/@href";
						var url3 = document.evaluate(kajiba_panel,responseXML, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
						url3 = url3.snapshotItem(0).textContent;
						kajiba(url3);
					}
				}
			}
		});

		function kajiba(x){
			var url3 = "http://"+location.hostname+"/"+x;
			wrapHttpReq(url3, "GET", null,
				function(response){
					var responseXML = document.createElement('div');
					responseXML.innerHTML = response;
					var kajiba = document.evaluate("//*[@class='mainTtl']/div", responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
					kajiba = kajiba.innerHTML.match(/[0-9]+/);
					var sel_kaji = document.getElementById("kaji").getElementsByTagName("option")[kajiba];
					sel_kaji.selected = 1;

					var num = 1;
					var sysmes = document.evaluate("//*[@id='gray02Wrapper']", responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML;
					if (sysmes.indexOf("現在は下記兵種の武器を強化しています") != -1) num += 1;

					var buki_ken = document.evaluate("//*[@id='gray02Wrapper']/table["+num+"]/tbody/tr[2]/td[2]/b", responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
					buki_ken = buki_ken.innerHTML.match(/[0-9]+/);
					var sel_ken = document.getElementById("ken_kaji").getElementsByTagName("option")[buki_ken];
					sel_ken.selected = 1;
					var trs = document.evaluate('.//*[@id="gray02Wrapper"]//table["+num+"]/tbody/tr', responseXML, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);

					for (var i = 1; i < trs.snapshotLength; i++) {
						var xxx_tr = "//*[@id='gray02Wrapper']/table["+num+"]/tbody/tr["+i+"]";
						xxx_tr = document.evaluate(xxx_tr, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML;

						if(xxx_tr.indexOf("槍兵") != -1 && xxx_tr.indexOf("矛槍兵") == -1) {
							var tr_yari = i+1;
							tr_yari = "//*[@id='gray02Wrapper']/table[" + num + "]/tbody/tr[" + tr_yari + "]/td[2]/b";
							var buki_yari = document.evaluate(tr_yari, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML.match(/[0-9]+/);
							var sel_yari = document.getElementById("yari_kaji").getElementsByTagName("option")[buki_yari];
							sel_yari.selected = 1;
						}
						else if(xxx_tr.indexOf("弓兵") != -1) {
							var tr_yumi = i+1;
							tr_yumi = "//*[@id='gray02Wrapper']/table[" + num + "]/tbody/tr[" + tr_yumi + "]/td[2]/b";
							var buki_yumi = document.evaluate(tr_yumi, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML.match(/[0-9]+/);
							var sel_yumi = document.getElementById("yumi_kaji").getElementsByTagName("option")[buki_yumi];
							sel_yumi.selected = 1;
						}
						else if(xxx_tr.indexOf("騎兵") != -1 && xxx_tr.indexOf("近衛騎兵") == -1 && xxx_tr.indexOf("斥候騎兵") == -1) {
							var tr_ki = i+1;
							tr_ki = "//*[@id='gray02Wrapper']/table[" + num + "]/tbody/tr[" + tr_ki + "]/td[2]/b";
							var buki_ki = document.evaluate(tr_ki, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML.match(/[0-9]+/);
							var sel_ki = document.getElementById("ki_kaji").getElementsByTagName("option")[buki_ki];
							sel_ki.selected = 1;
						}
						else if(xxx_tr.indexOf("矛槍兵") != -1) {
							var tr_hoko = i+1;
							tr_hoko = "//*[@id='gray02Wrapper']/table[" + num + "]/tbody/tr[" + tr_hoko + "]/td[2]/b";
							var buki_hoko = document.evaluate(tr_hoko, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML.match(/[0-9]+/);
							var sel_hoko = document.getElementById("hoko_kaji").getElementsByTagName("option")[buki_hoko];
							sel_hoko.selected = 1;
						}
						else if(xxx_tr.indexOf("弩兵") != -1) {
							var tr_do = i+1;
							tr_do = "//*[@id='gray02Wrapper']/table[" + num + "]/tbody/tr[" + tr_do + "]/td[2]/b";
							var buki_do = document.evaluate(tr_do, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML.match(/[0-9]+/);
							var sel_do = document.getElementById("do_kaji").getElementsByTagName("option")[buki_do];
							sel_do.selected = 1;
						}
						else if(xxx_tr.indexOf("近衛騎兵") != -1) {
							var tr_konoe = i+1;
							tr_konoe = "//*[@id='gray02Wrapper']/table[" + num + "]/tbody/tr[" + tr_konoe + "]/td[2]/b";
							var buki_konoe = document.evaluate(tr_konoe, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML.match(/[0-9]+/);
							var sel_konoe = document.getElementById("konoe_kaji").getElementsByTagName("option")[buki_konoe];
							sel_konoe.selected = 1;
						}
						else if(xxx_tr.indexOf("大剣兵") != -1) {
							var tr_dai = i+1;
							tr_dai = "//*[@id='gray02Wrapper']/table[" + num + "]/tbody/tr[" + tr_dai + "]/td[2]/b";
							var buki_dai = document.evaluate(tr_dai, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML.match(/[0-9]+/);
							var sel_dai = document.getElementById("dai_kaji").getElementsByTagName("option")[buki_dai];
							sel_dai.selected = 1;
						}
						else if(xxx_tr.indexOf("盾兵") != -1 && xxx_tr.indexOf("大盾兵") == -1) {
							var tr_tate = i+1;
							tr_tate = "//*[@id='gray02Wrapper']/table[" + num + "]/tbody/tr[" + tr_tate + "]/td[2]/b";
							var buki_tate = document.evaluate(tr_tate, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML.match(/[0-9]+/);
							var sel_tate = document.getElementById("tate_kaji").getElementsByTagName("option")[buki_tate];
							sel_tate.selected = 1;
						}
						else if(xxx_tr.indexOf("大盾兵") != -1) {
							var tr_dt = i+1;
							tr_dt = "//*[@id='gray02Wrapper']/table[" + num + "]/tbody/tr[" + tr_dt + "]/td[2]/b";
							var buki_dt = document.evaluate(tr_dt, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML.match(/[0-9]+/);
							var sel_dt = document.getElementById("dt_kaji").getElementsByTagName("option")[buki_dt];
							sel_dt.selected = 1;
						}
						else if(xxx_tr.indexOf("衝車") != -1) {
							var tr_ram = i+1;
							tr_ram = "//*[@id='gray02Wrapper']/table[" + num + "]/tbody/tr[" + tr_ram + "]/td[2]/b";
							var buki_ram = document.evaluate(tr_ram, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML.match(/[0-9]+/);
							var sel_ram = document.getElementById("ram_kaji").getElementsByTagName("option")[buki_ram];
							sel_ram.selected = 1;
						}
						else if(xxx_tr.indexOf("投石機") != -1) {
							var tr_catapult = i+1;
							tr_catapult = "//*[@id='gray02Wrapper']/table[" + num + "]/tbody/tr[" + tr_catapult + "]/td[2]/b";
							var buki_catapult = document.evaluate(tr_catapult, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML.match(/[0-9]+/);
							var sel_catapult = document.getElementById("catapult_kaji").getElementsByTagName("option")[buki_catapult];
							sel_catapult.selected = 1;
						}
					}
				}
			);
		}

		var url4 = "http://"+location.hostname+"/cp/item_list.php";
		wrapHttpReq(url4, "GET", null,
			function(response){
				var responseXML = document.createElement('div');
					responseXML.innerHTML = response;

				var tr_cp = "//*[@id='gray02Wrapper']/form/table/tbody/tr[33]/td[4]/p/a";
				var now_cp = document.evaluate(tr_cp, responseXML, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML;
				if(now_cp.indexOf("延長する") != -1){
					var sel_cp = document.getElementById("cp").getElementsByTagName("option")[1];
					sel_cp.selected = 1;
				}
			}
		);
	}

	function changeskill(){
		var skill_type = document.getElementById("skill");
		skill_type = skill_type.options[skill_type.selectedIndex].value;
		var skill_rate = document.getElementById("skill_rate").value;
		var busho = document.getElementById("b_skill");
		var kenpei = document.getElementById("ken_skill");
		var tatehei = document.getElementById("tate_skill");
		var yarihei = document.getElementById("yari_skill");
		var yumihei = document.getElementById("yumi_skill");
		var kihei = document.getElementById("ki_skill");
		var daihei = document.getElementById("dai_skill");
		var jthei = document.getElementById("jt_skill");
		var hokoyarihei = document.getElementById("hoko_skill");
		var dohei = document.getElementById("do_skill");
		var konoekihei = document.getElementById("konoe_skill");
		var ram = document.getElementById("ram_skill");
		var catapult = document.getElementById("catapult_skill");
		var b_type = document.getElementById("b_type");
		var b_type2 = b_type.options[b_type.selectedIndex].value;

		if(skill_type == "0"){	// 武将
			busho.value = skill_rate;
			kenpei.value = 0;
			tatehei.value = 0;
			yarihei.value = 0;
			yumihei.value = 0;
			kihei.value = 0;
			daihei.value = 0;
			jthei.value = 0;
			hokoyarihei.value = 0;
			dohei.value = 0;
			konoekihei.value = 0;
			ram.value = 0;
			catapult.value = 0;
		}
		if(skill_type == "1"){	// 剣兵・歩兵兵科の武将
			if(b_type2 == "0"){busho.value = skill_rate;} else {busho.value = 0;};
			kenpei.value = skill_rate;
			tatehei.value = skill_rate;
			yarihei.value = 0;
			yumihei.value = 0;
			kihei.value = 0;
			daihei.value = skill_rate;
			jthei.value = skill_rate;
			hokoyarihei.value = 0;
			dohei.value = 0;
			konoekihei.value = 0;
			ram.value = skill_rate;
			catapult.value = skill_rate;
		}
		if(skill_type == "2"){	// 槍兵・矛槍兵・槍兵兵科の武将
			if(b_type2 == "1"){busho.value = skill_rate;} else {busho.value = 0;};
			kenpei.value = 0;
			tatehei.value = 0;
			yarihei.value = skill_rate;
			yumihei.value = 0;
			kihei.value = 0;
			daihei.value = 0;
			jthei.value = 0;
			hokoyarihei.value = skill_rate;
			dohei.value = 0;
			konoekihei.value = 0;
			ram.value = 0;
			catapult.value = 0;
		}
		if(skill_type == "3"){	// 弓兵・弩兵・弓兵兵科の武将
			if(b_type2 == "2"){busho.value = skill_rate;} else {busho.value = 0;};
			kenpei.value = 0;
			tatehei.value = 0;
			yarihei.value = 0;
			yumihei.value = skill_rate;
			kihei.value = 0;
			daihei.value = 0;
			jthei.value = 0;
			hokoyarihei.value = 0;
			dohei.value = skill_rate;
			konoekihei.value = 0;
			ram.value = 0;
			catapult.value = 0;
		}
		if(skill_type == "4"){	// 騎兵・近衛騎兵・騎兵兵科の武将
			if(b_type2 == "3"){busho.value = skill_rate;} else {busho.value = 0;};
			kenpei.value = 0;
			tatehei.value = 0;
			yarihei.value = 0;
			yumihei.value = 0;
			kihei.value = skill_rate;
			daihei.value = 0;
			jthei.value = 0;
			hokoyarihei.value = 0;
			dohei.value = 0;
			konoekihei.value = skill_rate;
			ram.value = 0;
			catapult.value = 0;
		}
		if(skill_type == "5"){	// すべての兵士・武将
			busho.value = skill_rate;
			kenpei.value = skill_rate;
			tatehei.value = skill_rate;
			yarihei.value = skill_rate;
			yumihei.value = skill_rate;
			kihei.value = skill_rate;
			daihei.value = skill_rate;
			jthei.value = skill_rate;
			hokoyarihei.value = skill_rate;
			dohei.value = skill_rate;
			konoekihei.value = skill_rate;
			ram.value = skill_rate;
			catapult.value = skill_rate;
		}
		if(skill_type == "6"){	// 近衛騎兵・矛槍兵・弩兵
			busho.value = 0;
			kenpei.value = 0;
			tatehei.value = 0;
			yarihei.value = 0;
			yumihei.value = 0;
			kihei.value = 0;
			daihei.value = 0;
			jthei.value = 0;
			hokoyarihei.value = skill_rate;
			dohei.value = skill_rate;
			konoekihei.value = skill_rate;
			ram.value = 0;
			catapult.value = 0;
		}
	}

	function sol_index(){
		var index = 0;
		if(soltype == "歩兵") index = 0;
		else if(soltype == "槍兵") index = 1;
		else if(soltype == "弓兵") index = 2;
		else if(soltype == "騎兵") index = 3;
		var sel_soltype = document.getElementById("b_type").getElementsByTagName("option")[index];
		sel_soltype.selected = 1;
	}
}

function view(id){
	document.getElementById(id).style.display = "block";
};

function close(id){
	document.getElementById(id).style.display = "none";
}

function chansrc(id){
	document.getElementById(id).src = "../card/deck.php#filetop"
};

var sv_world = [];
var sv_season = [];
function set_season(){
	for(i=0;i<serverTable.length;i++){
		var BRO3_TOBATSU_SV	= 'bro3_tobatsu_sv' + i;
		var BRO3_TOBATSU_SEASON	= 'bro3_tobatsu_season' + i;
		sv_world[i] = document.getElementById("s"+i);
		sv_season[i] = document.getElementById("s"+i+"s");

		sv_world[i].value = GM_getValue(BRO3_TOBATSU_SV);
		if(GM_getValue(BRO3_TOBATSU_SV)=="NN") sv_world[i].value = "";
		var season = GM_getValue(BRO3_TOBATSU_SEASON) -1;
		sv_season[i].getElementsByTagName("option")[season].selected = 1;
	}
}

function sv_save(){
	for(i=0;i<serverTable.length;i++){
		sv_world[i] = document.getElementById("s"+i).value;
		if(sv_world[i]=="") sv_world[i] = "NN";
		sv_season[i] = document.getElementById("s"+i+"s");
		sv_season[i] = sv_season[i].options[sv_season[i].selectedIndex].value;
		var BRO3_TOBATSU_SV	= 'bro3_tobatsu_sv' + i;
		var BRO3_TOBATSU_SEASON	= 'bro3_tobatsu_season' + i;
		GM_setValue(BRO3_TOBATSU_SV, sv_world[i]);
		GM_setValue(BRO3_TOBATSU_SEASON, sv_season[i]);
	}
	alert("保存しました");
}

function reset_season(){
	for(i=0;i<serverTable.length;i++){
		sv_world[i] = document.getElementById("s"+i);
		sv_season[i] = document.getElementById("s"+i+"s");
		sv_world[i].value = serverTable[i][0];
		var season = serverTable[i][1] - 1;
		sv_season[i].getElementsByTagName("option")[season].selected = 1;
	}
}

}

//----------------------------------------------
// JST表示
//----------------------------------------------
function disp_jsttime(){
	var LEAP, NEXT, SL;
	var TZoffset, LocalClock, Start, Timer;
	var Offset, Offset0, Offset1;

	var JSToffset = 9 * 3600000;  // JST = UTC + 9H
	var Nservers = 0, Prev = 99, Loopcount = 20;
	var Jdisable = 0, Interval = 100;  // Refresh every 100ms

	var Server = new Array();
	var Lang = "J";

	var msg = {
		E: [	"<h1>No response from time servers.<\/h1><h2>Please reload after a while.<\/h2>",
			"<h1>Some of time servers didn\'t respond.<\/h1><h2>Displayed time can be incorrect.<\/h2>",
			" correct.",
			" second(s) fast.",
			" second(s) slow." ],
		J: [	"<h1>サーバからの時刻取得に失敗しました。<\/h1><h2>少し時間がたってから再読み込みしてください。<\/h2>",
			"<h2>一部のサーバからの時刻取得に失敗しました。<\/h2><h2>不正確な時刻が表示されている可能性があります。<\/h2>",
			"合っています",
			" 秒 進んでいます",
			" 秒 遅れています" ]
	};
	function jsont(json){
		if( Jdisable ) return;
		var now = new Date();
		if( json["st"] == null || json["it"] == null ) return;
		if( json["leap"] == null || json["next"] == null ) return;
		json["rt"] = now.getTime() / 1000;	// Record Receive time
		Server.push( json );
	}
	function addscript(url) {  // Dynamic loading of JSONP script
		var now = new Date();  // Record Initiation time
		var script	 = document.createElement('script');
		script.type	= 'text/javascript';
		script.charset = 'UTF-8';
		script.src	 = url + "?" + ( now.getTime() / 1000 );
		Nservers++;  // Number of servers
		document.getElementsByTagName('head')[0].appendChild(script);
	}
	function stopclock() {
		if ( Timer != null ) clearInterval(Timer);
	}

	function errmsg(msgnum) {
		var msgbox;
		msgbox = document.getElementById( "ServerStat" );
		if ( null != msgbox )  msgbox.innerHTML = msg[Lang][msgnum];
	}

	function showmsg() {
		var msgbox, msg;
		msg  = '<center><h3>時刻取得結果<\/h3><\/center>';
		if( Server.length > 0 ) {
			msg += 'server0: ' + Server[0]["id"] + ' , RTT = ';
			msg += Math.floor( 1000 * (Server[0]["rt"] - Server[0]["it"]) );
			msg += ' ms , (PC Clock - JST) = ' + Math.floor( - Offset0 ) + ' ms<br>';
		}
		else msg += 'server0: unavailable<br>';

		if( Server.length > 1 ) {
			msg += 'server1: ' + Server[1]["id"] + ' , RTT = ';
			msg += Math.floor( 1000 * (Server[1]["rt"] - Server[1]["it"]) );
			msg += ' ms , (PC Clock - JST) = ' + Math.floor( - Offset1 ) + ' ms<br>';
		}
		else msg += 'server1: unavailable<br>';

		msg += "取得した時刻の誤差は、上記 RTT ＋ 処理系の誤差（通常 30ms 程度）に収まると考えられます。<br>"

		msgbox = document.getElementById( "ServerStat" );
		if ( null != msgbox ) msgbox.innerHTML = msg;
	}
	function ToDateStr(t, flg){
		var h, m, s, YY, MM, DD;
		h = t.getUTCHours();if (h < 10) h = "0" + h;
		m = t.getUTCMinutes();if (m < 10) m = "0" + m;
		s = t.getUTCSeconds();if ( flg != 0 ) s = 60;if (s < 10) s = "0" + s;

		YY = t.getUTCFullYear();
		MM = t.getUTCMonth() + 1;if (MM < 10) MM = "0" + MM;
		DD = t.getUTCDate();	 if (DD < 10) DD = "0" + DD;
		return (MM + "/" + DD + "<BR>" + h + ":" + m + ":" + s);
	}
	function showtime(){
		var now, flg, temp, sec, utcms, utcsec;
		var JST, UTC, TAI, LOC, CMP, CL;
		now = new Date();
		utcms = now.getTime() + Offset + Interval / 2;
		utcsec = Math.floor( utcms / 1000 );
		CL = LEAP;
		if ( utcsec >= NEXT ) CL = CL + 1;	// Current TAI - UTC
		temp = utcms - ( CL - SL ) * 1000;
		flg = 0;
		if ( utcsec == NEXT ) flg = 1;
		JST = new Date( temp + JSToffset );
		j$("#JST").html(ToDateStr(JST, flg));
	}
	jQuery.noConflict();
	var j$ = jQuery;
	j$("<div id=clock>JST <span id=JST></div>").appendTo("#container");
	j$("#clock")
		.css("top", "0")
		.css("left", "0")
		.css("width", "70px")
		.css("height", "35px")
		.css("position", "fixed")
		.css("background-color", "#333")
		.css("color", "#fff")
		.css("opacity", "0.8");

	unsafeWindow.showtime = showtime;
	unsafeWindow.jsont = jsont;
	exportFunction(showtime, unsafeWindow, {defineAs: "showtime"});
	exportFunction(jsont, unsafeWindow, {defineAs: "jsont"});

	startclock();
	function startclock(l) {
		if ( l == "E" ) Lang = "E";
		addscript( "http://ntp-a1.nict.go.jp/cgi-bin/jsont" );
		startc();
	}
	function startc() {
		if ( ( Server.length < Nservers ) && ( Loopcount-- > 0 ) ) {
			setTimeout(startc,100);
			return;
		}
		Jdisable = 1; // No more return packets will be processed
		if ( Server.length == 0 ) {
			errmsg( 0 );
			return;
		}
		Offset0 = 1000 * Server[0]["st"] - 500 * Server[0]["it"] - 500 * Server[0]["rt"];
		Offset = Offset0;
		if ( Server.length >= 2 ) {
			Offset1 = 1000 * Server[1]["st"] - 500 * Server[1]["it"] - 500 * Server[1]["rt"];
			if( Math.abs( Offset0 - Offset1 ) < 200 ) {
				Offset = ( Offset0 + Offset1 ) / 2;
			} else {
				Server.pop();
			}
		}
		if ( Server.length == 1 ) errmsg( 1 );
		LEAP = Server[0]["leap"];  // Total leap seconds before NEXT Leap
		NEXT = Server[0]["next"];  // Next Leap (UNIX TIME)
		LocalClock = new Date();
		Start = Math.floor( ( Offset + LocalClock.getTime() ) / 1000 );
		TZoffset = LocalClock.getTimezoneOffset() * 60000;
		if (TZoffset > 12 * 3600000) TZoffset -= ( 24 * 3600000 );
		SL = LEAP;
		if ( Start >= NEXT ) SL = SL + 1;	// TAI - UTC at startup
		Timer = setInterval(showtime, Interval);
	}
}
//faraway 22.討伐・空き地 民兵出現 推定機のソース(bro3_calcn_craford_custom.user.js)終了

//----------------------------------------------
// 武将ダス履歴抽出分析
//----------------------------------------------
function HistAnalysis(){
	// ブショーダス履歴画面のみ動作
	if (location.pathname != "/busyodas/busyodas_history.php") {
		return;
	}

	//----------------//
	// コンテナの取得 //
	//----------------//
	var container;
	var pager = $e_24('//*[@class="pager"]');
	var bbs = $e_24('//*[@id="gray02Wrapper"]');
	if (pager.snapshotLength == 0) {
		container = bbs.snapshotItem(0);
	} else {
		container = pager.snapshotItem(0);
	}

	//----------------//
	//-- ヘッダー部 --//
	//----------------//
	//-- コントロール配置DIV --//
	var linksDiv = document.createElement("div");
	container.appendChild(linksDiv);

	//-- ツール名称ラベル --//
	var textLabel = document.createElement("span");
	textLabel.id = "toolLabel_01";
	textLabel.style.fontSize = "16px";
	textLabel.innerHTML = "<br><b>ブショーダス履歴抽出 Ver." + VERSION_24 + "</b>";
	textLabel.style.color = "black";
	textLabel.style.width = "725px";
	linksDiv.appendChild(textLabel);

	//-- (改行) --//
	textLabel = document.createElement("span");
	textLabel.innerHTML = "<br>";
	linksDiv.appendChild(textLabel);

	//-- ページ数表示 --//
	var ckLabel = document.createElement("span");
	ckLabel.style.fontSize = "14px";
	ckLabel.style.marginLeft = "16px";
	ckLabel.innerHTML = "履歴ページ数";
	linksDiv.appendChild(ckLabel);

	ckLabel = document.createElement("span");
	ckLabel.style.fontSize = "14px";
	ckLabel.id = "pageNo_01";
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "0";
	linksDiv.appendChild(ckLabel);

	ckLabel = document.createElement("span");
	ckLabel.style.fontSize = "14px";
	ckLabel.style.marginLeft = "4px";
	ckLabel.innerHTML = "/";
	linksDiv.appendChild(ckLabel);

	var data = $e_24('//ul[@class="pager"]/li[@class="last"]//a[@title="last page"]');
	if( data.snapshotLength > 0 ){
		var ref = data.snapshotItem(0).getAttribute("href");
		maxpage = ref.replace(/^.*\?p=/,"");
		urlpath = ref.replace(/\?p=.*$/,"");
	}
	else{
		var data = $e_24('//ul[@class="pager"]/li/b');
		if( data.snapshotLength > 0 ){
			maxpage = data.snapshotItem(0).textContent;

			var data = $e_24('//ul[@class="pager"]/li//a[@title="first page"]');
			var ref = data.snapshotItem(0).getAttribute("href");
			urlpath = ref.replace(/\?p=.*$/,"");
		}
		else{
			maxpage = 1;
		}
	}

	//○ﾍﾟｰｼﾞまで取得ｺﾝﾎﾞﾎﾞｯｸｽ
	var combo1 = document.createElement("select");
	combo1.id = "lastPageNo_01";
	combo1.style.marginLeft = "10px";
	for (i = 1; i <= maxpage; i++) {
		var op = document.createElement("option");
		op.value = i;
		op.text = i;

		combo1.appendChild(op);
	}
	combo1.value = maxpage;
	linksDiv.appendChild(combo1);
	var label99 = document.createElement("span");
	label99.style.fontSize = "12px";
	label99.style.marginLeft = "2px";
	label99.innerHTML = "ページまで出力";
	linksDiv.appendChild(label99);

	//-- 詳細は出さないチェック --//
	var check1 = document.createElement("input");
	check1.type = "checkbox";
	check1.id = "ckcheck1_01";
	check1.style.marginLeft = "16px";
	linksDiv.appendChild(check1);
	var label2 = document.createElement("span");
	label2.style.fontSize = "12px";
	label2.style.marginLeft = "2px";
	label2.innerHTML = "履歴出力";
	linksDiv.appendChild(label2);

	//-- 情報取得ボタン --//
	var button1 = document.createElement("input");
	button1.type = "button";
	button1.id = "ckButton1_01";
	button1.style.fontSize = "12px";
	button1.style.marginLeft = "16px";
	button1.value = "ブショーダス履歴を抽出";
	button1.addEventListener("click", function() {getButtonClicked_01()}, true);
	linksDiv.appendChild(button1);

	//-- 結果全選択ボタン --//
	var button2 = document.createElement("input");
	button2.type = "button";
	button2.id = "ckButton2_01";
	button2.style.fontSize = "12px";
	button2.style.marginLeft = "16px";
	button2.value = "結果全選択";
	button2.addEventListener("click", function() {selectButtonClicked_01()}, true);
	linksDiv.appendChild(button2);

	//-- (改行) --//
	textLabel = document.createElement("span");
	textLabel.innerHTML = "<br>";
	linksDiv.appendChild(textLabel);

	// （ギャップ埋め）
	ckLabel = document.createElement("pre");
	ckLabel.style.height = "6px";
	linksDiv.appendChild(ckLabel);

	//----------------------------//
	// 検索結果のテキスト表示領域 //
	//----------------------------//
	textArea = document.createElement("div");
	textArea.innerHTML = "";
	textArea.style.fontSize = "14px";
	textArea.style.color = "black";
	textArea.style.backgroundColor = "#FFDEAD";
	textArea.style.width = "725px";
	textArea.style.height = "200px";
	textArea.style.overflow = "auto";
	textArea.style.border = "solid 2px";
	textArea.style.padding = "2px";
	textArea.style.marginTop = "-2px";
	textArea.style.textAlign = "left";
	linksDiv.appendChild(textArea);

	ckLabel = document.createElement("pre");
	ckLabel.id = "resultText_01";
	ckLabel.innerHTML = "";
	textArea.appendChild(ckLabel);

	//--------------------------//
	// 他ページ取得情報の設定域 //
	//--------------------------//
	var linksDiv2 = document.createElement("html");
	linksDiv2.id = "hiddenData_01";
	linksDiv2.style.display = "none";
	container.appendChild(linksDiv2);
}


//------------------------//
// 取得ボタン押下処理処理 //
//------------------------//
function getButtonClicked_01() {
	// ハッシュテーブル初期化
	card = new Array();
	rare_count = {}; // ランク別カード数

	// レア枚数の初期化
	t_rare_count['C'] = 0;	t_rare_count['UC'] = 0;  t_rare_count['R']	 = 0;t_rare_count['SR']   = 0;t_rare_count['UR']   = 0;
	g_rare_count['C'] = 0;	g_rare_count['UC'] = 0;  g_rare_count['R']	 = 0;g_rare_count['SR']   = 0;g_rare_count['UR']   = 0;
	s_rare_count['C'] = 0;	s_rare_count['UC'] = 0;  s_rare_count['R']	 = 0;s_rare_count['SR']   = 0;s_rare_count['UR']   = 0;
	sp_rare_count['C'] = 0; sp_rare_count['UC']  = 0;sp_rare_count['R']  = 0;sp_rare_count['SR']  = 0;sp_rare_count['UR']  = 0;
	sho_rare_count['C'] = 0;sho_rare_count['UC'] = 0;sho_rare_count['R'] = 0;sho_rare_count['SR'] = 0;sho_rare_count['UR'] = 0;
	tai_rare_count['C'] = 0;tai_rare_count['UC'] = 0;tai_rare_count['R'] = 0;tai_rare_count['SR'] = 0;tai_rare_count['UR'] = 0;
	stp_rare_count['C'] = 0;stp_rare_count['UC'] = 0;stp_rare_count['R'] = 0;stp_rare_count['SR'] = 0;stp_rare_count['UR'] = 0;
	itm_rare_count['C'] = 0;itm_rare_count['UC'] = 0;itm_rare_count['R'] = 0;itm_rare_count['SR'] = 0;itm_rare_count['UR'] = 0;
	l_rare_count['C'] = 0;	l_rare_count['UC']	 = 0;l_rare_count['R']	 = 0;l_rare_count['SR']   = 0;l_rare_count['UR']   = 0;
	xg_rare_count['C'] = 0; xg_rare_count['UC']  = 0;xg_rare_count['R']  = 0;xg_rare_count['SR']  = 0;xg_rare_count['UR']  = 0;
	xs_rare_count['C'] = 0; xs_rare_count['UC']  = 0;xs_rare_count['R']  = 0;xs_rare_count['SR']  = 0;xs_rare_count['UR']  = 0;

	 // 総カード数
	total_cards = 0;
	g_total_cards = 0;
	s_total_cards = 0;
	l_total_cards = 0;
	sp_total_cards = 0;
	sho_total_cards = 0;
	tai_total_cards = 0;
	stp_total_cards = 0;
	itm_total_cards = 0;

	g_ex_cards = 0;
	s_ex_cards = 0;

	srup_text = "";

	var textBox = $e_24('//*[@id="resultText_01"]');
	textBox.snapshotItem(0).innerHTML = "データ取得中・・・「終了しました」のダイアログが出るまでお待ち下さい";

	var button = $e_24('//*[@id="ckButton1_01"]');
	button.snapshotItem(0).disabled = true;
	button = $e_24('//*[@id="ckButton2_01"]');
	button.snapshotItem(0).disabled = true;
	button = $e_24('//*[@id="lastPageNo_01"]');
	button.snapshotItem(0).disabled = true;

	//最大ﾍﾟｰｼﾞ数をｾｯﾄし直し
	maxpage = document.getElementById("lastPageNo_01").value;

	// 見出し
	putText_24 = "カードNo.\tレアリティ\t名前\tレベル\tカード取得日時\tブショーダスタイプ<br>";
	if( maxpage >= 1 ){
		loadPage_24(1);
	}
	else{
		// 2ページ目以降
		var data = $e_24('//table[@class="commonTables"]//td');
		var text = "";
		for( var i = 0; i < data.snapshotLength/6; i++ ){
			var res = "";
			for( var j = 0; j < 6; j++ ){
				res = res + data.snapshotItem(i*6+j).textContent;
				if( j < 5 ){
					res = res + "\t";
				}
			}
			text = text + res + "<br>";

			var no = data.snapshotItem(i*6+0).textContent;
			var rare = data.snapshotItem(i*6+1).textContent;
			if( (rare == "UR") || (rare == "SR") || (rare == "R") ){
				srup_text = srup_text + res + "<BR>";
			}

			if( card[no] == undefined ){
				card[no] = new Array();
				card[no]['no'] = data.snapshotItem(i*6+0).textContent;
				card[no]['rare'] = data.snapshotItem(i*6+1).textContent;
				card[no]['name'] = data.snapshotItem(i*6+2).textContent;
				card[no]['ct'] = 1;
				card[no]['gld'] = 0;
				card[no]['slv'] = 0;
				card[no]['sho'] = 0;
				card[no]['lgt'] = 0;
			}
			else{
				card[no]['ct'] = card[no]['ct'] + 1;
			}

			t_rare_count[rare] = t_rare_count[rare] + 1;
			total_cards = total_cards + 1;
			if( data.snapshotItem(i*6+5).textContent.indexOf("ゴールド") >= 0 ){
				g_rare_count[rare] = g_rare_count[rare] + 1;
				g_total_cards = g_total_cards + 1;
				card[no]['gld'] = card[no]['gld'] + 1;

				if( data.snapshotItem(i*6+5).textContent.indexOf("EX") >= 0 ){
					xg_rare_count[rare] = xg_rare_count[rare] + 1;
					g_ex_cards = g_ex_cards + 1;
				}
			}
			else if( data.snapshotItem(i*6+5).textContent.indexOf("シルバー") >= 0 ){
				s_rare_count[rare] = s_rare_count[rare] + 1;
				s_total_cards = s_total_cards + 1;
				card[no]['slv'] = card[no]['slv'] + 1;

				if( data.snapshotItem(i*6+5).textContent.indexOf("EX") >= 0 ){
					xs_rare_count[rare] = xs_rare_count[rare] + 1;
					s_ex_cards = s_ex_cards + 1;
				}
			}
			else if( data.snapshotItem(i*6+5).textContent.indexOf("SP") >= 0 ){
				sp_rare_count[rare] = sp_rare_count[rare] + 1;
				sp_total_cards = sp_total_cards + 1;
				card[no]['sp'] = card[no]['sp'] + 1;
			}
			else if( data.snapshotItem(i*6+5).textContent.indexOf("小麗") >= 0 ){
				sho_rare_count[rare] = sho_rare_count[rare] + 1;
				sho_total_cards = sho_total_cards + 1;
				card[no]['sho'] = card[no]['sho'] + 1;
			}
			else if( data.snapshotItem(i*6+5).textContent.indexOf("大鳳") >= 0 ){
				tai_rare_count[rare] = tai_rare_count[rare] + 1;
				tai_total_cards = tai_total_cards + 1;
				card[no]['tai'] = card[no]['tai'] + 1;
			}
			else if( data.snapshotItem(i*6+5).textContent.indexOf("ブショーダスステップアップ") >= 0 ){
				stp_rare_count[rare] = stp_rare_count[rare] + 1;
				stp_total_cards = stp_total_cards + 1;
				card[no]['stp'] = card[no]['stp'] + 1;
			}
			else if( data.snapshotItem(i*6+5).textContent.indexOf("カードアイテム") >= 0 ){
				itm_rare_count[rare] = itm_rare_count[rare] + 1;
				itm_total_cards = itm_total_cards + 1;
				card[no]['itm'] = card[no]['itm'] + 1;
			}

			else{
				l_rare_count[rare] = l_rare_count[rare] + 1;
				l_total_cards = l_total_cards + 1;
				card[no]['lgt'] = card[no]['lgt'] + 1;
			}
		}

		var analyze = makeAnalyzeText();

		var checkBox = $e_24('//*[@id="ckcheck1_01"]');
		var textBox = $e_24('//*[@id="resultText_01"]');
		textBox.snapshotItem(0).innerHTML = analyze + '<BR>ブショーダス履歴<BR>' + putText_24 + text;

		var button = $e_24('//*[@id="ckButton1_01"]');
		button.snapshotItem(0).disabled = false;
		button = $e_24('//*[@id="ckButton2_01"]');
		button.snapshotItem(0).disabled = false;
		button = $e_24('//*[@id="lastPageNo_01"]');
		button.snapshotItem(0).disabled = false;

		alert("終了しました");
	}
}

//----------------------//
// ページのローディング //
//----------------------//
function loadPage_24(targetPageNo) {
	var opt = {
		method: 'get',
		url: urlpath + "?p=" + targetPageNo,
		onload: function(res) {
			addResult(targetPageNo, res);
		}
	}
	GM_xmlhttpRequest(opt);
}

//--------------//
// 取得結果加算 //
//--------------//
function addResult(targetPageNo,res) {
	var pageNo = $e_24('//*[@id="pageNo_01"]');
	pageNo.snapshotItem(0).textContent = targetPageNo;

	var hidden = $e_24('//*[@id="hiddenData_01"]');
	hidden.snapshotItem(0).innerHTML = res.responseText;

	// 2ページ目以降
	var data = $e_24('//*[@id="hiddenData_01"]//table[@class="commonTables"]//td');
	var text = "";
	for( var i = 0; i < data.snapshotLength/6; i++ ){
		var res = "";
		var res2 = "";
		for( var j = 0; j < 6; j++ ){
			res = res + data.snapshotItem(i*6+j).textContent;
			if( j != 3 ){
				res2 = res2 + data.snapshotItem(i*6+j).textContent;
			}
			if( j < 5 ){
				res = res + "\t";
				res2 = res2 + "\t";
			}
		}
		text = text + res + "<br>";

		var no = data.snapshotItem(i*6+0).textContent;
		var rare = data.snapshotItem(i*6+1).textContent;
		if( (rare == "UR") || (rare == "SR") || (rare == "R") ){
			srup_text = srup_text + res2 + "<BR>";
		}

		if( card[no] == undefined ){
			card[no] = new Array();
			card[no]['no'] = data.snapshotItem(i*6+0).textContent;
			card[no]['rare'] = data.snapshotItem(i*6+1).textContent;
			card[no]['name'] = data.snapshotItem(i*6+2).textContent;
			card[no]['ct'] = 1;
			card[no]['gld'] = 0;
			card[no]['slv'] = 0;
			card[no]['sp'] = 0;
			card[no]['sho'] = 0;
			card[no]['tai'] = 0;
			card[no]['stp'] = 0;
			card[no]['itm'] = 0;
			card[no]['lgt'] = 0;
		}
		else{
			card[no]['ct'] = card[no]['ct'] + 1;
		}

		t_rare_count[rare] = t_rare_count[rare] + 1;
		total_cards = total_cards + 1;
		if( data.snapshotItem(i*6+5).textContent.indexOf("ゴールド") >= 0 ){
			g_rare_count[rare] = g_rare_count[rare] + 1;
			g_total_cards = g_total_cards + 1;
			card[no]['gld'] = card[no]['gld'] + 1;

			if( data.snapshotItem(i*6+5).textContent.indexOf("EX") >= 0 ){
				xg_rare_count[rare] = xg_rare_count[rare] + 1;
				g_ex_cards = g_ex_cards + 1;
			}
		}
		else if( data.snapshotItem(i*6+5).textContent.indexOf("シルバー") >= 0 ){
			s_rare_count[rare] = s_rare_count[rare] + 1;
			s_total_cards = s_total_cards + 1;
			card[no]['slv'] = card[no]['slv'] + 1;

			if( data.snapshotItem(i*6+5).textContent.indexOf("EX") >= 0 ){
				xs_rare_count[rare] = xs_rare_count[rare] + 1;
				s_ex_cards = s_ex_cards + 1;
			}
		}
		else if( data.snapshotItem(i*6+5).textContent.indexOf("SP") >= 0 ){
			sp_rare_count[rare] = sp_rare_count[rare] + 1;
			sp_total_cards = sp_total_cards + 1;
			card[no]['sp'] = card[no]['sp'] + 1;
		}
		else if( data.snapshotItem(i*6+5).textContent.indexOf("小麗") >= 0 ){
			sho_rare_count[rare] = sho_rare_count[rare] + 1;
			sho_total_cards = sho_total_cards + 1;
			card[no]['sho'] = card[no]['sho'] + 1;
		}
		else if( data.snapshotItem(i*6+5).textContent.indexOf("大鳳") >= 0 ){
			tai_rare_count[rare] = tai_rare_count[rare] + 1;
			tai_total_cards = tai_total_cards + 1;
			card[no]['tai'] = card[no]['tai'] + 1;
		}
		else if( data.snapshotItem(i*6+5).textContent.indexOf("ステップアップ") >= 0 ){
			stp_rare_count[rare] = stp_rare_count[rare] + 1;
			stp_total_cards = stp_total_cards + 1;
			card[no]['stp'] = card[no]['stp'] + 1;
		}
		else if( data.snapshotItem(i*6+5).textContent.indexOf("カードアイテム") >= 0 ){
			itm_rare_count[rare] = itm_rare_count[rare] + 1;
			itm_total_cards = itm_total_cards + 1;
			card[no]['itm'] = card[no]['itm'] + 1;
		}

		else{
			l_rare_count[rare] = l_rare_count[rare] + 1;
			l_total_cards = l_total_cards + 1;
			card[no]['lgt'] = card[no]['lgt'] + 1;
		}	}


	if(maxpage > targetPageNo ){
		putText_24 = putText_24 + text;
		loadPage_24(parseInt(targetPageNo)+1);
	}
	else{
		var analyze = makeAnalyzeText();

		var checkBox = $e_24('//*[@id="ckcheck1_01"]');
		var textBox = $e_24('//*[@id="resultText_01"]');
		if( checkBox.checked == true ){
			textBox.snapshotItem(0).innerHTML = analyze +
								'<BR>ブショーダス履歴<BR>' +
								'----------------------------------------------------------<BR>' +
								putText_24 + text;
		}
		else{
			textBox.snapshotItem(0).innerHTML = analyze;
		}

		var button = $e_24('//*[@id="ckButton1_01"]');
		button.snapshotItem(0).disabled = false;
		button = $e_24('//*[@id="ckButton2_01"]');
		button.snapshotItem(0).disabled = false;
		button = $e_24('//*[@id="lastPageNo_01"]');
		button.snapshotItem(0).disabled = false;

		alert("終了しました");
	}
}

//--------------//
// 全選択ボタン //
//-------------//
function selectButtonClicked_01() {
	// 構築ルート情報の選択
	var textBox = $x_24('//*[@id="resultText_01"]');
	var objs = textBox.firstChild;var obje = textBox.lastChild;var range = document.createRange();
	range.setStart(objs,0);	range.setEnd(obje,obje.textContent.length);
	var sel = getSelection();
	sel.removeAllRanges();sel.addRange(range);
}


//--------------//
// 分析テキスト //
//-------------//
function makeAnalyzeText(){
	var text = "";

	text = text + "ブショーダス履歴分析結果<BR>";
	text = text + "----------------------------------------------------------<BR>";
	text = text + "【累計】<BR>";
	if( total_cards > 0 ){
		text = text + "　カード枚数：" + total_cards + "枚<BR>";
		text = text + "　　UR・・" + formatRightNumber_24(t_rare_count["UR"],4) + "枚\t" + calc_per(t_rare_count["UR"],total_cards) + "<BR>";
		text = text + "　　SR・・" + formatRightNumber_24(t_rare_count["SR"],4) + "枚\t" + calc_per(t_rare_count["SR"],total_cards) + "<BR>";
		text = text + "　　R ・・" + formatRightNumber_24(t_rare_count["R"],4) + "枚\t" + calc_per(t_rare_count["R"],total_cards) + "<BR>";
		text = text + "　　UC・・" + formatRightNumber_24(t_rare_count["UC"],4) + "枚\t" + calc_per(t_rare_count["UC"],total_cards) + "<BR>";
		text = text + "　　C ・・" + formatRightNumber_24(t_rare_count["C"],4) + "枚\t" + calc_per(t_rare_count["C"],total_cards) + "<BR>";
	}
	else{
		text = text + "　1枚も引いていません<BR>";
	}
	text = text + "----------------------------------------------------------<BR>";
	text = text + "【ブショーダスゴールド】<BR>";
	if( g_total_cards > 0 ){
		text = text + "　カード枚数：" + g_total_cards + "枚（EX：" + g_ex_cards + "枚）<BR>";
		text = text + "　　UR・・" + formatRightNumber_24(g_rare_count["UR"],4) + "枚\t" + calc_per(g_rare_count["UR"],g_total_cards) + "<BR>";
		text = text + "　　SR・・" + formatRightNumber_24(g_rare_count["SR"],4) + "枚\t" + calc_per(g_rare_count["SR"],g_total_cards) + "<BR>";
		text = text + "　　R ・・" + formatRightNumber_24(g_rare_count["R"],4) + "枚\t" + calc_per(g_rare_count["R"],g_total_cards) + "<BR>";
		text = text + "　　UC・・" + formatRightNumber_24(g_rare_count["UC"],4) + "枚\t" + calc_per(g_rare_count["UC"],g_total_cards) + "<BR>";
	}
	else{
		text = text + "　1枚も引いていません<BR>";
	}
	text = text + "----------------------------------------------------------<BR>";
	text = text + "【ブショーダスシルバー】<BR>";
	if( s_total_cards > 0 ){
		text = text + "　カード枚数：" + s_total_cards + "枚（EX：" + s_ex_cards + "枚）<BR>";
		text = text + "　　UR・・" + formatRightNumber_24(s_rare_count["UR"],4) + "枚\t" + calc_per(s_rare_count["UR"],s_total_cards) + "<BR>";
		text = text + "　　SR・・" + formatRightNumber_24(s_rare_count["SR"],4) + "枚\t" + calc_per(s_rare_count["SR"],s_total_cards) + "<BR>";
		text = text + "　　R ・・" + formatRightNumber_24(s_rare_count["R"],4) + "枚\t" + calc_per(s_rare_count["R"],s_total_cards) + "<BR>";
		text = text + "　　UC・・" + formatRightNumber_24(s_rare_count["UC"],4) + "枚\t" + calc_per(s_rare_count["UC"],s_total_cards) + "<BR>";
		text = text + "　　C ・・" + formatRightNumber_24(s_rare_count["C"],4) + "枚\t" + calc_per(s_rare_count["C"],s_total_cards) + "<BR>";
	}
	else{
		text = text + "　1枚も引いていません<BR>";
	}
	text = text + "----------------------------------------------------------<BR>";
	text = text + "【ブショーダスSP】<BR>";
	if( sp_total_cards > 0 ){
		text = text + "　カード枚数：" + sp_total_cards + "枚<BR>";
		text = text + "　　UR・・" + formatRightNumber(sp_rare_count["UR"],5) + "枚\t" + calc_per(sp_rare_count["UR"],sp_total_cards) + "<BR>";
		text = text + "　　SR・・" + formatRightNumber(sp_rare_count["SR"],5) + "枚\t" + calc_per(sp_rare_count["SR"],sp_total_cards) + "<BR>";
		text = text + "　　R ・・" + formatRightNumber(sp_rare_count["R"],5) + "枚\t" + calc_per(sp_rare_count["R"],sp_total_cards) + "<BR>";
		text = text + "　　UC・・" + formatRightNumber(sp_rare_count["UC"],5) + "枚\t" + calc_per(sp_rare_count["UC"],sp_total_cards) + "<BR>";
		text = text + "　　C ・・" + formatRightNumber(sp_rare_count["C"],5) + "枚\t" + calc_per(sp_rare_count["C"],sp_total_cards) + "<BR>";
	}
	else{
		text = text + "　1枚も引いていません<BR>";
	}
	text = text + "----------------------------------------------------------<BR>";
	text = text + "【ブショーダス小麗】<BR>";
	if( sho_total_cards > 0 ){
		text = text + "　カード枚数：" + sho_total_cards + "枚<BR>";
		text = text + "　　UR・・" + formatRightNumber_25(sho_rare_count["UR"],5) + "枚\t" + calc_per(sho_rare_count["UR"],sho_total_cards) + "<BR>";
		text = text + "　　SR・・" + formatRightNumber_25(sho_rare_count["SR"],5) + "枚\t" + calc_per(sho_rare_count["SR"],sho_total_cards) + "<BR>";
		text = text + "　　R ・・" + formatRightNumber_25(sho_rare_count["R"],5) + "枚\t" + calc_per(sho_rare_count["R"],sho_total_cards) + "<BR>";
		text = text + "　　UC・・" + formatRightNumber_25(sho_rare_count["UC"],5) + "枚\t" + calc_per(sho_rare_count["UC"],sho_total_cards) + "<BR>";
		text = text + "　　C ・・" + formatRightNumber_25(sho_rare_count["C"],5) + "枚\t" + calc_per(sho_rare_count["C"],sho_total_cards) + "<BR>";
	}	else{
		text = text + "　1枚も引いていません<BR>";
	}
	text = text + "----------------------------------------------------------<BR>";
	text = text + "【ブショーダス大鳳】<BR>";
	if( tai_total_cards > 0 ){
		text = text + "　カード枚数：" + tai_total_cards + "枚<BR>";
		text = text + "　　UR・・" + formatRightNumber_25(tai_rare_count["UR"],5) + "枚\t" + calc_per(tai_rare_count["UR"],tai_total_cards) + "<BR>";
		text = text + "　　SR・・" + formatRightNumber_25(tai_rare_count["SR"],5) + "枚\t" + calc_per(tai_rare_count["SR"],tai_total_cards) + "<BR>";
		text = text + "　　R ・・" + formatRightNumber_25(tai_rare_count["R"],5) + "枚\t" + calc_per(tai_rare_count["R"],tai_total_cards) + "<BR>";
		text = text + "　　UC・・" + formatRightNumber_25(tai_rare_count["UC"],5) + "枚\t" + calc_per(tai_rare_count["UC"],tai_total_cards) + "<BR>";
		text = text + "　　C ・・" + formatRightNumber_25(tai_rare_count["C"],5) + "枚\t" + calc_per(tai_rare_count["C"],tai_total_cards) + "<BR>";
	}	else{
		text = text + "　1枚も引いていません<BR>";
	}
	text = text + "----------------------------------------------------------<BR>";
	text = text + "【ブショーダスステップアップ】<BR>";
	if( stp_total_cards > 0 ){
		text = text + "　カード枚数：" + stp_total_cards + "枚<BR>";
		text = text + "　　UR・・" + formatRightNumber_25(stp_rare_count["UR"],5) + "枚\t" + calc_per(stp_rare_count["UR"],stp_total_cards) + "<BR>";
		text = text + "　　SR・・" + formatRightNumber_25(stp_rare_count["SR"],5) + "枚\t" + calc_per(stp_rare_count["SR"],stp_total_cards) + "<BR>";
		text = text + "　　R ・・" + formatRightNumber_25(stp_rare_count["R"],5) + "枚\t" + calc_per(stp_rare_count["R"],stp_total_cards) + "<BR>";
		text = text + "　　UC・・" + formatRightNumber_25(stp_rare_count["UC"],5) + "枚\t" + calc_per(stp_rare_count["UC"],stp_total_cards) + "<BR>";
		text = text + "　　C ・・" + formatRightNumber_25(stp_rare_count["C"],5) + "枚\t" + calc_per(stp_rare_count["C"],stp_total_cards) + "<BR>";
	}	else{
		text = text + "　1枚も引いていません<BR>";
	}
	text = text + "----------------------------------------------------------<BR>";
	text = text + "【カードアイテム】<BR>";
	if( itm_total_cards > 0 ){
		text = text + "　カード枚数：" + itm_total_cards + "枚<BR>";
		text = text + "　　UR・・" + formatRightNumber_25(itm_rare_count["UR"],5) + "枚\t" + calc_per(itm_rare_count["UR"],itm_total_cards) + "<BR>";
		text = text + "　　SR・・" + formatRightNumber_25(itm_rare_count["SR"],5) + "枚\t" + calc_per(itm_rare_count["SR"],itm_total_cards) + "<BR>";
		text = text + "　　R ・・" + formatRightNumber_25(itm_rare_count["R"],5) + "枚\t" + calc_per(itm_rare_count["R"],itm_total_cards) + "<BR>";
		text = text + "　　UC・・" + formatRightNumber_25(itm_rare_count["UC"],5) + "枚\t" + calc_per(itm_rare_count["UC"],itm_total_cards) + "<BR>";
		text = text + "　　C ・・" + formatRightNumber_25(itm_rare_count["C"],5) + "枚\t" + calc_per(itm_rare_count["C"],itm_total_cards) + "<BR>";
	}	else{
		text = text + "　1枚も引いていません<BR>";
	}

	text = text + "----------------------------------------------------------<BR>";
	text = text + "【ブショーダスライト】<BR>";
	if( l_total_cards > 0 ){
		text = text + "　カード枚数：" + l_total_cards + "枚<BR>";
		text = text + "　　UR・・" + formatRightNumber_24(l_rare_count["UR"],4) + "枚\t" + calc_per(l_rare_count["UR"],l_total_cards) + "<BR>";
		text = text + "　　SR・・" + formatRightNumber_24(l_rare_count["SR"],4) + "枚\t" + calc_per(l_rare_count["SR"],l_total_cards) + "<BR>";
		text = text + "　　R ・・" + formatRightNumber_24(l_rare_count["R"],4) + "枚\t" + calc_per(l_rare_count["R"],l_total_cards) + "<BR>";
		text = text + "　　UC・・" + formatRightNumber_24(l_rare_count["UC"],4) + "枚\t" + calc_per(l_rare_count["UC"],l_total_cards) + "<BR>";
		text = text + "　　C ・・" + formatRightNumber_24(l_rare_count["C"],4) + "枚\t" + calc_per(l_rare_count["C"],l_total_cards) + "<BR>";
	}
	else{
		text = text + "　1枚も引いていません<BR>";
	}
	text = text + "----------------------------------------------------------<BR>";
	text = text + "<BR>";
	text = text + "UR、SR、R取得詳細<BR>";
	text = text + "----------------------------------------------------------<BR>";
	if( srup_text != "" ){
		text = text + srup_text;
	}
	else{
		text = text + "UR、SR、Rは取得していません<BR>";
	}
	text = text + "----------------------------------------------------------<BR>";
	text = text + "<BR>";
	text = text + "武将カード別取得枚数<BR>";
	text = text + "----------------------------------------------------------<BR>";

	// カードを枚数順でソートする(逆順ソート)
	card.sort(
		function(b1, b2){
			var result = -1;
			if( b1['ct'] < b2['ct'] ){
				result = 1;// 枚数が小→大の順なので交換
			}
			else{
				result = -1;
			}

			return result;
		}
	);

	for( var i in card ){
		if(i == "each") break;	//なぜか最後に"each"が入るのでこのときfor()を抜けるようにした(ｽｸﾘﾌﾟﾄ単体では起きない) faraway111005
		text = text + "　" + card[i]['no'] + "." + card[i]['rare'] + card[i]['name'] + "\t" + formatRightNumber_24(card[i]['ct'],4) + "枚\t("
			+ calc_per(card[i]['ct'],total_cards) + ")\t"
			+ "GL:" + formatRightNumber_25(card[i]['gld'],4) + "枚"
			+ "　SL:" + formatRightNumber_25(card[i]['slv'],4) + "枚"
			+ "　SP:" + formatRightNumber_25(card[i]['sp'],4) + "枚"
			+ "　小:" + formatRightNumber_25(card[i]['sho'],4) + "枚"
			+ "　大:" + formatRightNumber_25(card[i]['tai'],4) + "枚"
			+ "　ST:" + formatRightNumber_25(card[i]['stp'],4) + "枚"
			+ "　ア:" + formatRightNumber_25(card[i]['itm'],4) + "枚"
			+ "　LT:" + formatRightNumber_25(card[i]['lgt'],4) + "枚<BR>";
	}
	text = text + "----------------------------------------------------------<BR>";

	return text;
}

// 小数桁数フォーマッタ
function fm_num(str){
	var temp;temp = String(str);
	if( temp.indexOf(".") < 0 ){	temp = temp + ".00";}
	if( temp.indexOf(".") == 1 ){	temp = "  " + temp;}
	if( temp.indexOf(".") == 2 ){	temp = " " + temp;}
	if( temp.length != 6 ){		temp = temp + "0";}
	return temp;
}

// カード枚数から比率を求める
function calc_per(num,base){
	return fm_num(Math.floor(num/base*10000)/100) + "%";
}

// 桁数整形
function formatRightNumber_24( num, length ){
	var fix = '    ';var str;
	var result = '';str = num.toString(10);
	if( str.length < length ){
		result = fix.substr(0,length - str.length) + str;
	}
	else{
		result = str;
	}
	return result;
}

function formatRightNumber_25( num, length ){
	var fix = ' 	 ';
	var str;
	var result = '';

	str = num.toString(10);
	if( str.length < length ){
		result = fix.substr(0,length - str.length) + str;
	}
	else{
		result = str;
	}

	return result;
}
//faraway 24.武将ダス履歴抽出分析 Ver1.09のソース(bro3_put_busyodas_textuserjs.user.js)終了

//------------------------------------------
// クエスト補助
//------------------------------------------
function QuestAssist(){
	// クエスト画面でのみ動作させる
	if( document.title.indexOf('クエスト') == -1 ) {
		return;
	}

	// クエストリスト
	jQuery.noConflict();
	j$ = jQuery;
	var questlist = new Array();
	if (j$("#questB3_tab").length == 0 ){
		// 現行鯖
		questlist = [
			['ともだちを招待しよう','ともだちをブラウザ三国志に招待しよう','CP+150'], // mixi
			['友達をブラウザ三国志に招待しよう','ともだちをブラウザ三国志に招待しよう','CP+150'], // Y!モバゲー
			['書簡の使い方','誰かに書簡を送り、返事をもらう','全資源+300'],
			['ケータイ設定','ケータイのメールアドレスを登録','BP+50'],
			['チャージポイント','CPを使って便利機能を使う','CP+100'],
			['倉庫の上限を増やそう　其一','容量5k','全資源+500'],
			['倉庫の上限を増やそう　其二','容量10k','TP+100'],
			['倉庫の上限を増やそう　其三','容量50k','全資源+3000'],
			['倉庫の上限を増やそう　其四','容量300k','小麗チケット2枚'],
			['倉庫の上限を増やそう　其五','容量500k','大鳳チケット1枚'],
			['週間ランキングを確認しよう','週間ランキングを確認する','BP+50'],
			['個人ランク','自分の個人ランキング順位を入力しよう','BP+50'],
			['同盟ランク','自分の同盟の順位を入力する','全資源+200'],
			['城のレベルアップ','城をLv5にする','木石糧+1000、鉄+3000'],
			['城のレベルアップ　其二','城をLv8にする','木石+5000、鉄糧+3000'],
			['同盟を組む','5人以上の同盟に所属する','BP+100'],
			['同盟員の領地を討伐しよう','同盟員の領地を討伐する','全資源+500'],
			['同盟掲示板に書き込み','同盟掲示板に書き込む','全資源+800'],
			['不可侵条約を活用しよう','不可侵条約を結ぶ','全資源+500'],
			['同盟のレベルアップ','同盟レベルを2にする','全資源+800'],
			['同盟レベルを5まで上げよう','同盟レベルを5にする','全資源+8000'],
			['役職者を任命しよう','役職者の任命','BP+100'],
			['寄付をしよう　其一','「同盟」に3,000の寄付をする','全資源+700'],
			['寄付をしよう　其二','「同盟」に10,000の寄付をする','全資源+1500'],
			['寄付をしよう　其三','「同盟」に50,000の寄付をする','全資源+10000'],
			['同盟に貢献しよう　其一','同盟貢献ポイント1000','TP+10'],
			['同盟に貢献しよう　其二','同盟貢献ポイント3000','TP+20'],
			['同盟に貢献しよう　其三','同盟貢献ポイント6000','TP+50'],
			['同盟に貢献しよう　其四','同盟貢献ポイント1万','TP+100'],
			['同盟に貢献しよう　其五','同盟貢献ポイント3万','TP+150'],
			['同盟に貢献しよう　其六','同盟貢献ポイント6万','TP+200'],
			['同盟に貢献しよう　其七','同盟貢献ポイント10万','シルバーチケット1枚'],
			['同盟に貢献しよう　其八','同盟貢献ポイント30万','TP+500'],
			['同盟上位への道　其一','同盟ポイント4万','BP+300'],
			['同盟上位への道　其二','同盟ポイント8万','BP+500'],
			['同盟上位への道　其三','同盟ポイント16万','BP+700'],
			['同盟上位への道　其四','同盟ポイント40万','BP+1000'],
			['同盟上位への道　其五','同盟ポイント80万','BP+1500'],
			['同盟上位への道　其六','同盟ポイント160万','BP+2000'],
			['同盟上位への道　其七','同盟ポイント400万','BP+2500'],
			['同盟上位への道　其八','同盟ポイント800万','シルバーチケット1枚'],
			['鉄材研究所を建設しよう','鉄材研究所の建設','全資源+1000'],
			['大練兵所を建設しよう','大練兵所の建設','全資源+1000'],
			['石材研究所を建設しよう','石材研究所の建設','全資源+3000'],
			['大兵舎を建設しよう','大兵舎の建設','全資源+3000'],
			['木材研究所を建設しよう','木材研究所の建設','全資源+5000'],
			['大弓兵舎を建設しよう','大弓兵舎の建設','全資源+5000'],
			['食糧研究所を建設しよう','食糧研究所の建設','全資源+7000'],
			['大厩舎を建設しよう','大厩舎の建設','全資源+7000'],
			['大兵器工房を建設しよう','大兵器工房の建設','全資源+10000'],
			['生産力の強化','本拠地に「畑」「伐採所」「石切り場」「製鉄所」のLv3を3つずつ建設','全資源+1000'],
			['生産施設を増やそう','本拠地に「畑」「伐採所」「石切り場」「製鉄所」を3つずつ建設','全資源+300'],
			['生産力の強化　其の二','本拠地に「畑」「伐採所」「石切り場」「製鉄所」のLv4を建設','名声+1'],
			['木収入強化','木の生産量（基本値）を500以上にする','石鉄糧+1500'],
			['石収入強化','石の生産量（基本値）を500以上にする','木鉄糧+1500'],
			['鉄収入強化','鉄の生産量（基本値）を500以上にする','木石糧+1500'],
			['木収入強化　其二','木の生産量（基本値)を1000以上にする','石鉄糧+3000'],
			['石収入強化　其二','石の生産量（基本値)を1000以上にする','木鉄糧+3000'],
			['鉄収入強化　其二','鉄の生産量（基本値)を1000以上にする','木石糧+3000'],
			['武将のレベルアップ　其二','武将をLv3にする','全資源+800'],
			['武将のレベルアップ　其三','2人の武将をLv4にする','BP+100'],
			['武将のレベルアップ　其四','3人の武将をLv5にする','BP+150'],
			['武将のレベルアップ　其五','武将をLv10にする','名声+1'],　//ac22
			['武将のレベルアップ　其六','武将をレベルを20にする','BP+160'],　//ac22
			['武将のレベルアップ　其七','武将のLVを30にする','BP+200'],
			['武将のレベルアップ　其八','武将のLVを40にする','BP+250'],
			['防御武将を鍛えよう　其一','防御に50ポイント振る','BP+50'],
			['内政武将を鍛えよう　其一','武将の知力に50ポイント振る','BP+50'],
			['移動速度を鍛えよう　其一','武将の移動速度を50ポイント上げる','BP+50'],
			['武将デュエルにエントリーしよう','ブショーデュエルにエントリーする','BP+20'],
			['カード合成','武将カード合成','TP+10'],
			['修行合成してみよう','修行合成','TP+50'],
			['同一スキルでレベルアップ合成しよう','同一スキル所持カード2枚でスキルレベルアップ合成をする','TP+40'],
			['スキルの習得','武将にスキルを2つ持たせよう','TP+40'],
			['スキルの習得　其二','武将にスキルを3つ持たせよう','TP+100'],
			['トレードに出品しよう','トレードで出品する','TP+20'],
			['スキルレベル','武将にLV4以上のスキルを持たせよう','全資源+1500'],
			['スキルレベル　其二','武将にLV6以上のスキルを持たせよう','TP+100'],
			['スキルレベル　其三','一人の武将に二つ以上の「スキル」を持たせて、二つの「スキル」をそれぞれレベル５に上げる','TP+26'],
			['幻のスキルを探せ','奇計百出を持つ武将を配下に加えよう','全資源+2000'],
			['幻のスキルを探せ　其二','八卦の陣を持つ武将を配下に加えよう','名声+1'],
			['幻のスキルを探せ　其三','一騎当千を持つ武将を配下に加えよう','名声+1'],
			['幻のスキルを探せ　其四','神速を持つ武将を配下に加えよう','名声+1'],
			['領地のレベルアップ','領地のレベルを上げよう','名声+1'],
			['領地の取得　其一','☆☆以上の空き地を領地にする','全資源+1000'],
			['領地の取得　其二','☆☆☆以上の空き地を領地にする','全資源+1500'], //ac22
			['領地の取得　其三','☆☆☆☆以上の空き地を領地にする','全資源+2500'], //ac22
			['領地の取得　其四','☆☆☆☆☆以上の空き地を領地にする','全資源+4000'],//ac22
			['領地の取得　其伍','☆☆☆☆☆☆以上の空き地を領地にする','全資源+5000'],//ac22
			['槍兵の研究','槍兵の研究を開始する','木鉄糧+1000、石+2500'],
			['弓兵の研究','弓兵の研究を開始する','石鉄糧+1000、木+2500'],
			['騎兵の研究','騎兵の研究を開始する','木石糧+1000、鉄+2500'],
			['斥候の研究','斥候の研究を開始する','木石鉄+2000、糧+1000'],
			['衝車の研究','衝車の研究を開始する','木石鉄+8000、糧+4000'],
			['斥候騎兵の研究','研究所で斥候騎兵を研究する','BP+180'],
			['矛槍兵の研究','研究所で矛槍兵の研究をする','名声+1'],
			['弩兵の研究','研究所で弩兵の研究をする','名声+1'],
			['近衛騎兵の研究','研究所で近衛騎兵の研究をする','名声+1'],
			['投石機の研究','研究所で投石機の研究をする','名声+1'],
			['人口を増やそう','人口を50以上にする','BP+50'],
			['人口を増やそう　其二','人口を100以上にする','全資源+1000'],
			['人口を増やそう　其三','人口を250以上にする','全資源+2000'],
			['人口を増やそう　其四','人口を600以上にする','全資源+3000'],
			['人口を増やそう　其五','人口を1000以上にする','全資源+5000'],
			['人口を増やそう　其六','人口を2000以上にする','名声+1'],
			['人口を増やそう　其七','人口を3000以上にする','全資源+10000'],
			['人口を増やそう　其八','人口を5000以上にする','全資源+25000'],
			['人口を増やそう　其九','人口を8000以上にする','全資源+40000'],
			['一戦入魂（新米）','撃破スコアを100以上にしよう','BP+80'],
			['一戦入魂（隊士）','撃破スコアを500以上にしよう','TP+50'],
			['一戦入魂（隊長）','撃破スコアを1000以上にしよう','全資源+4000'],
			['一戦入魂（大将）','撃破スコアを3000以上にしよう','全資源+10000'],
			['一戦入魂（名将）','撃破スコアを10000以上にしよう','全資源+30000'],
			['一戦入魂（覇王）','撃破スコアを30000以上にしよう','名声+3'],
			['鍛冶場で強化','鍛冶場で武器を強化する','全資源+1000'],
			['防具工場で強化','防具工場で防具を強化する','全資源+1200'],
			['拠点をつくれ！','拠点をつくる','木石鉄+1500、糧+1000'],
			['拠点をつくれ！　其二','3つ目の拠点をつくる','TP+250'],
			['拠点をつくれ！　其三','5つ目の拠点をつくる','TP+300'],
			['拠点をつくれ！　其四','7つ目の拠点をつくる','TP+500'],
			['拠点をつくれ！　其五','9つ目の拠点をつくる','TP+700'],
			['拠点に名前を付けよう','拠点の名前を変更しよう','TP+33'],
			['拠点に武将をセットしよう','武将を拠点にセットする','BP+50'],
			['施設のいろは','拠点に施設を建設する','CP+100'],
			['同盟員とNPC砦を落とせ','NPC砦を占領する','名声+2'],
			['世界の覇権','敵対勢力がいる座標を報告','名声+1'],
			['難関砦を攻略せよ','★６つ以上のNPC砦を攻略しよう','全資源+30000'],
			['天下統一の足がかり','★８つ以上のNPC城を攻略しよう','全資源+50000']
		];
	} else {
		// 新鯖
		questlist = [
			['チャージポイント','CPを利用する','CP+100'],
			['同盟募集機能を使ってみよう','現在の"同盟への参加状況"を選択する','小麗チケット1枚'],
			['他の君主を探そう','他の君主の拠点座標を調べる','名声+1'],
			['天下統一への第一歩','NPC拠点の座標を調べる','名声+1'],
			['個人ランク','統計の総合ランキングの順位を確認する','糧15％UP(1日)+1'],
			['同盟ランク','現在の同盟ランクを報告する','BP+100'],
			['ステータスポイントを振ろう','ステータスポイントを1以上割り振る','BP+200'],
			['内政設定を活用しよう','内政設定に武将を設定する','BP+200'],
			['カード合成','カード合成','TP+30'],
			['ブショーデュエルにエントリーしよう','ブショーデュエルにエントリーする','BP+100'],
			['本拠地に名前を付けよう','本拠地に名前を付ける','全資源+300'],
			['個人掲示板とは？','個人掲示板にスレッドを立てる','木15％UP(1日)+1'],
			['同盟を組もう','同盟員が5人以上の同盟に加入している','シルバーチケット1枚'],
			['同盟掲示板に書き込み','同盟掲示板にコメントを書く','全資源+500'],
			['不可侵条約を活用しよう','不可侵条約を結ぶ','全資源+500'],
			['役職者を任命しよう','同盟に全ての役職者が赴任されている','BP+300'],
			['書簡の使い方','書簡を送り返信をもらう','鉄15％UP(1日)+1'],
			['アイテムを使おう','アイテムを1つ以上使用する','小麗チケット1枚'],
			['同盟員の領地を賊討伐しよう','同盟員の領地に出兵する','全資源+500'],
			['援軍を送ろう','自分の領地あるいは、拠点に援軍を出兵する','小麗チケット1枚'],
			['偵察兵を送ろう','NPC拠点や敵領地に偵察を行う','小麗チケット1枚'],
			['遠くの領地を強襲しよう','距離10以上の領地に強襲する','小麗チケット1枚'],
			['複数の施設','資源の生産施設を2個ずつを建てる','全資源+300'],
			['施設のレベルアップ　其一','資源の生産施設をLv2にする','全資源+300'],
			['施設のレベルアップ　其二','資源の生産施設をLv3にする','全資源+600'],
			['週間ランキングを確認しよう','週間攻撃ランキングの順位を確認する','石15％UP(1日)+1'],
			['同盟のレベルアップ','同盟レベルをLv2以上にする','全資源+1000'],
			['寄付をしよう　其一','同盟に合計3000以上寄付する','全資源+700'],
			['寄付をしよう　其二','同盟に合計10000以上寄付する','全資源+1500'],
			['寄付をしよう　其三','同盟に合計50000以上寄付する','全資源+10000'],
			['生産力の強化　其一','資源の生産施設を3個ずつ建てる','全資源+300'],
			['生産力の強化　其二','資源の生産施設を3個ずつLv3にする','全資源+1000'],
			['生産力の強化　其三','資源の生産施設を1個ずつLv4にする','名声+1'],
			['宿舎を建設しよう','「宿舎」を建てる','全資源+100'],
			['研究所を建設しよう','「研究所」を建てる','木石鉄+100'],
			['鍛冶場を建設しよう','「鍛冶場」を建てる','全資源+200'],
			['防具工場を建設しよう','「防具工場」を建てる','全資源+200'],
			['市場を建設しよう','「市場」を建てる','全資源+700'],
			['銅雀台を建設しよう','「銅雀台」を建てる','全資源+1500'],
			['訓練所を建設しよう','「訓練所」を建てる','全資源+8000'],
			['大宿舎を建設しよう','「大宿舎」を建てる','全資源+8000'],
			['遠征訓練所を建設しよう','「遠征訓練所」を建てる','全資源+30000'],
			['人口とは？','人口を25以上にする','全資源+300'],
			['人口を増やそう　其一','人口を50以上にする','全資源+500'],
			['人口を増やそう　其二','人口を100以上にする','全資源+1000'],
			['人口を増やそう　其三','人口を250以上にする','全資源+2000'],
			['人口を増やそう　其四','人口を600以上にする','全資源+3000'],
			['人口を増やそう　其伍','人口を1000以上にする','全資源+5000'],
			['人口を増やそう　其六','人口を2000以上にする','名声+1'],
			['人口を増やそう　其七','人口を3000以上にする','全資源+10000'],
			['人口を増やそう　其八','人口を5000以上にする','全資源+25000'],
			['人口を増やそう　其九','人口を8000以上にする','全資源+40000'],
			['鍛冶場で強化','鍛冶場で武器を1つLv1以上にする','全資源+1000'],
			['防具工場で強化','防具工場で防具を1つLv1以上にする','全資源+1200'],
			['トレードに出品しよう','トレードに出品する','TP+50'],
			['武将を育てよう　其一','武将をLv3以上にする','全資源+800'],
			['武将を育てよう　其二','武将をLv10以上にする','名声+1'],
			['武将を育てよう　其三','武将をLv20以上にする','BP+300'],
			['武将を育てよう　其四','武将をLv30以上にする','BP+800'],
			['武将を育てよう　其伍','武将をLv40以上にする','BP+1000'],
			['武将を育てよう　其六','武将をLv50以上にする','BP+1500'],
			['武将を育てよう　其七','武将をLv75以上にする','BP+2000'],
			['武将を育てよう　其八','武将をLv100以上にする','シルバーチケット1枚'],
			['武将を育てよう　其九','武将をLv150以上にする','大鳳チケット1枚'],
			['同一スキルでレベルアップ合成しよう','スキルレベルアップ合成を行う','TP+50'],
			['スキルの習得　其一','武将にスキルを2つ持たせて、デッキにセットする','TP+50'],
			['スキルの習得　其二','武将にスキルを3つ持たせて、デッキにセットする','TP+100'],
			['スキルレベル　其一','武将にLv4以上のスキルを持たせて、デッキにセットする','TP+50'],
			['スキルレベル　其二','武将にLv6以上のスキルを持たせて、デッキにセットする','TP+100'],
			['スキルレベル　其三','武将にLv5以上のスキルを2つ持たせて、デッキにセットする','TP+200'],
			['スキルレベル　其四','武将にLv7以上のスキルを持たせて、デッキにセットする','TP+300'],
			['スキルレベル　其伍','武将にLv8以上のスキルを2つ持たせて、デッキにセットする','TP+400'],
			['スキルレベル　其六','武将にLv9以上のスキルを2つ持たせて、デッキにセットする','TP+500'],
			['複数の武将を育てよう　其一','2人の武将をLv4以上にする','BP+500'],
			['複数の武将を育てよう　其二','3人の武将をLv5以上にする','BP+800'],
			['内政武将を鍛えよう','ステータスポイントを知力に50割り振る','BP+300'],
			['防御武将を鍛えよう','ステータスポイントを防御に50割り振る','BP+300'],
			['移動速度を鍛えよう','ステータスポイントを速度に50割り振る','BP+300'],
			['盾兵の研究','研究所で「盾兵」の研究を行う','木石鉄+1000、糧+500'],
			['槍兵の研究','研究所で「槍兵」の研究を行う','木鉄糧+1000、石+2500'],
			['弓兵の研究','研究所で「弓兵」の研究を行う','木+2500、石鉄糧+2500'],
			['騎兵の研究','研究所で「騎兵」の研究を行う','木石糧+1000、鉄+2500'],
			['斥候の研究','研究所で「斥候」の研究を行う','木石鉄+2000、糧+1000'],
			['衝車の研究','研究所で「衝車」の研究を行う','木石鉄+8000、糧+4000'],
			['斥候騎兵の研究','研究所で「斥候騎兵」の研究を行う','木石鉄+4000、糧+2000'],
			['大剣兵の研究','研究所で「大剣兵」の研究を行う','BP+2000'],
			['重盾兵の研究','研究所で「重盾兵」の研究を行う','木石鉄+25000、糧+10000'],
			['矛槍兵の研究','研究所で「矛槍兵」の研究を行う','名声+1'],
			['弩兵の研究','研究所で「弩兵」の研究を行う','名声+1'],
			['近衛騎兵の研究','研究所で「近衛騎兵」の研究を行う','名声+1'],
			['投石機の研究','研究所で「投石機」の研究を行う','名声+1'],
			['倉庫の上限を増やそう　其一','資源の最大所持量を5000にする','全資源+500'],
			['倉庫の上限を増やそう　其二','資源の最大所持量を10000にする','TP+100'],
			['倉庫の上限を増やそう　其三','資源の最大所持量を50000にする','全資源+3000'],
			['倉庫の上限を増やそう　其四','資源の最大所持量を100000にする','小麗チケット1枚'],
			['倉庫の上限を増やそう　其伍','資源の最大所持量を300000にする','小麗チケット2枚'],
			['倉庫の上限を増やそう　其六','資源の最大所持量を500000にする','大鳳チケット1枚'],
			['木収入強化　其一','「木」の生産量を250以上にする','石鉄糧+1000'],
			['木収入強化　其二','「木」の生産量を500以上にする','石鉄糧+1500'],
			['木収入強化　其三','「木」の生産量を1000以上にする','石鉄糧+3000'],
			['石収入強化　其一','「石」の生産量を250以上にする','木鉄糧+1000'],
			['石収入強化　其二','「石」の生産量を500以上にする','木鉄糧+1500'],
			['石収入強化　其三','「石」の生産量を1000以上にする','木鉄糧+3000'],
			['鉄収入強化　其一','「鉄」の生産量を250以上にする','木石糧+1000'],
			['鉄収入強化　其二','「鉄」の生産量を500以上にする','木石糧+1500'],
			['鉄収入強化　其三','「鉄」の生産量を1000以上にする','木石糧+3000'],
			['領地の取得　其一','★1以上の領地を2つ以上取得する','全資源+500'],
			['領地の取得　其二','★2以上の領地を取得する','全資源+1000'],
			['領地の取得　其三','★3以上の領地を取得する','全資源+1500'],
			['領地の取得　其四','★4以上の領地を取得する','全資源+2500'],
			['領地の取得　其伍','★5以上の領地を取得する','全資源+4000'],
			['領地の取得　其六','★6以上の領地を取得する','全資源+5000'],
			['領地の取得　其七','★7以上の領地を取得する','全資源+10000'],
			['領地の取得　其八','★8以上の領地を取得する','全資源+20000'],
			['領地の取得　其九','★9以上の領地を取得する','全資源+30000'],
			['領地のレベルアップ','領地をLv2以上にする','名声+1'],
			['拠点を作ろう！　其一','拠点（村・砦）を1つ以上作る','木石鉄+1500、糧+1000'],
			['拠点を作ろう！　其二','拠点（村・砦）を3つ以上作る','TP+250'],
			['拠点を作ろう！　其三','拠点（村・砦）を5つ以上作る','TP+300'],
			['拠点を作ろう！　其四','拠点（村・砦）を7つ以上作る','TP+500'],
			['拠点を作ろう！　其伍','拠点（村・砦）を9つ以上作る','TP+700'],
			['拠点に名前を付けよう','拠点（村・砦）に名前を付ける','全資源+1000'],
			['拠点に武将をセットしよう','拠点（村・砦）に武将をセットする','BP+500'],
			['施設のいろは','拠点（村・砦）に施設を建てる','CP+100'],
			['城のレベルアップ　其一','城をLv5以上にする','木石糧+1000、鉄+3000'],
			['城のレベルアップ　其二','城をLv8以上にする','木石+5000、鉄糧+3000'],
			['修行合成をしてみよう','修行合成を行う','TP+200'],
			['一戦入魂（新米）','撃破スコアを100以上にする','BP+500'],
			['一戦入魂（隊士）','撃破スコアを500以上にする','BP+1000'],
			['一戦入魂（隊長）','撃破スコアを1000以上にする','全資源+4000'],
			['一戦入魂（大将）','撃破スコアを3000以上にする','全資源+10000'],
			['一戦入魂（勇将）','撃破スコアを6000以上にする','全資源+20000'],
			['一戦入魂（名将）','撃破スコアを10000以上にする','全資源+30000'],
			['一戦入魂（覇王）','撃破スコアを30000以上にする','名声+3'],
			['同盟に貢献しよう　其一','同盟貢献ポイントを1000以上にする','TP+30'],
			['同盟に貢献しよう　其二','同盟貢献ポイントを3000以上にする','TP+50'],
			['同盟に貢献しよう　其三','同盟貢献ポイントを6000以上にする','TP+70'],
			['同盟に貢献しよう　其四','同盟貢献ポイントを10000以上にする','TP+100'],
			['同盟に貢献しよう　其伍','同盟貢献ポイントを30000以上にする','TP+150'],
			['同盟に貢献しよう　其六','同盟貢献ポイントを60000以上にする','TP+200'],
			['同盟に貢献しよう　其七','同盟貢献ポイントを100000以上にする','TP+500'],
			['同盟に貢献しよう　其八','同盟貢献ポイントを300000以上にする','シルバーチケット1枚'],
			['同盟拠点とは？','同盟レベルをLv5以上にする','全資源+8000'],
			['鉄材研究所を建設しよう','同盟拠点に「鉄材研究所」を建てる','全資源+1000'],
			['石材研究所を建設しよう','同盟拠点に「石材研究所」を建てる','全資源+3000'],
			['木材研究所を建設しよう','同盟拠点に「木材研究所」を建てる','全資源+5000'],
			['食糧研究所を建設しよう','同盟拠点に「食糧研究所」を建てる','全資源+7000'],
			['大練兵所を建設しよう','同盟拠点に「大練兵所」を建てる','全資源+1000'],
			['大兵舎を建設しよう','同盟拠点に「大兵舎」を建てる','全資源+3000'],
			['大弓兵舎を建設しよう','同盟拠点に「大弓兵舎」を建てる','全資源+5000'],
			['大厩舎を建設しよう','同盟拠点に「大厩舎」を建てる','全資源+7000'],
			['大兵器工房を建設しよう','同盟拠点に「大兵器工房」を建てる','全資源+10000'],
			['祈祷所を建設しよう','同盟拠点に「祈祷所」を建てる','全資源+1000'],
			['軍令台・防御を建設しよう','同盟拠点に「軍令台・防御」を建てる','全資源+5000'],
			['軍令台・攻撃を建設しよう','同盟拠点に「軍令台・攻撃」を建てる','全資源+7000'],
			['同盟上位への道　其一','同盟ポイントを40000以上にする','BP+300'],
			['同盟上位への道　其二','同盟ポイントを80000以上にする','BP+500'],
			['同盟上位への道　其三','同盟ポイントを160000以上にする','BP+700'],
			['同盟上位への道　其四','同盟ポイントを400000以上にする','BP+1000'],
			['同盟上位への道　其伍','同盟ポイントを800000以上にする','BP+1500'],
			['同盟上位への道　其六','同盟ポイントを1600000以上にする','BP+2000'],
			['同盟上位への道　其七','同盟ポイントを4000000以上にする','BP+5000'],
			['同盟上位への道　其八','同盟ポイントを8000000以上にする','シルバーチケット1枚'],
			['同盟員とNPC砦を落とそう　其一','★1以上のNPC砦を陥落させる','名声+2'],
			['同盟員とNPC砦を落とそう　其二','★2以上のNPC砦を陥落させる','BP+1000'],
			['同盟員とNPC砦を落とそう　其三','★3以上のNPC砦を陥落させる','小麗チケット1枚'],
			['同盟員とNPC砦を落とそう　其四','★4以上のNPC砦を陥落させる','シルバーチケット1枚'],
			['同盟員とNPC砦を落とそう　其伍','★5以上のNPC砦を陥落させる','大鳳チケット1枚'],
			['難関砦を攻略せよ','★6以上のNPC砦を陥落させる','全資源+50000'],
			['天下統一の足がかり','★8以上のNPC城を陥落させる','全資源+100000'],
			['幻のスキルを探せ　其一','スキル「奇計百出」を持った武将をデッキにセットする','BP+1000'],
			['幻のスキルを探せ　其二','スキル「八卦の陣」を持った武将をデッキにセットする','名声+1'],
			['幻のスキルを探せ　其三','スキル「一騎当千」を持った武将をデッキにセットする','名声+1'],
			['幻のスキルを探せ　其四','スキル「神速」を持った武将をデッキにセットする','名声+1'],
			['幻のスキルを探せ　其伍','スキル「飛将」を持った武将をデッキにセットする','名声+1']
		];
	}
	var quests = document.getElementsByTagName('a');
	for (var l=0; l<quests.length; l++) {
		for (var q=0;q<questlist.length; q++) {
			if (quests[l].innerHTML == questlist[q][0]) {
				quests[l].title=questlist[q][1] + '【報酬】' + questlist[q][2];
				var item = houshu(questlist[q]);
				quests[l].innerHTML += '<br />' + item;
				break;
			}
		}
	}

	// 報酬をHTMLに変換する
	function houshu(list) {
		// 報酬
		var COM_URL = '/img/common';
		var BD_URL = '/img/busyodas';
		var EXBD_URL = '/20141226-01/extend_project/w945/img/busyodas';
		var present = [
			{id:'fame',	key:'名声',  icon:COM_URL + '/ico_fame.gif'},
			{id:'bp',	key:'BP',	icon:COM_URL + '/icon_bp.gif'},
			{id:'stone',	key:'石',	icon:COM_URL + '/ico_stone.gif'},
			{id:'wood',	key:'木',	icon:COM_URL + '/ico_wood.gif'},
			{id:'ingot',	key:'鉄',	icon:COM_URL + '/ico_ingot.gif'},
			{id:'grain',	key:'糧',	icon:COM_URL + '/ico_grain.gif'},
			{id:'tp',	key:'TP',	icon:COM_URL + '/icon_tp.gif'},
			{id:'cp',	key:'CP',	icon:COM_URL + '/icon_cp.gif'},
			{id:'st',	key:'シルバーチケット1枚', icon:EXBD_URL + '/img_background_silverEX.jpg', css:'float:left; overflow:hidden; position:relative; width:111px; height:37px;'},
			{id:'gt',	key:'ゴールドチケット1枚', icon:EXBD_URL + '/img_background_goldEX.jpg', css:'float:left; overflow:hidden; position:relative; width:111px; height:37px;'},
			{id:'kt',	key:'小麗チケット1枚',	 icon:EXBD_URL + '/img_background_syorei.jpg', css:'float:left; overflow:hidden; position:relative; width:111px; height:37px;'},
			{id:'kt2',	key:'小麗チケット2枚',	 icon:EXBD_URL + '/img_background_syorei.jpg', css:'float:left; overflow:hidden; position:relative; width:111px; height:37px;'},
			{id:'tt',	key:'大鳳チケット1枚',	 icon:EXBD_URL + '/img_background_taihou.jpg', css:'float:left; overflow:hidden; position:relative; width:111px; height:37px;'}
		];

		var houshutext = list[2];
		houshutext = houshutext.replace('全資源','木石鉄糧');
		for( var i=0; i < present.length; i++ ) {
			if( houshutext.indexOf( present[i]['key'] ) != -1 ) {
				var is;
				if(present[i]['w']){
					is += ' width="' + present[i]['w'] + '"'
				};
				if(present[i]['h']){
					is += ' height="' + present[i]['h'] +'"'
				};
				var txt;
				if(typeof present[i]['css'] == 'undefined') {
					txt = '<img src="'+ present[i]['icon'] + '" ' + is + '/>';
				} else {
					txt = '<span style="' + present[i]['css'] + '"><img src="'+ present[i]['icon'] + '" ' + is + ' style="position:absolute; top:-14px; left:-524px;" /></span><br><br>';
				}
				houshutext = houshutext.replace(present[i]['key'],txt);
			}
		}
		houshutext = houshutext.replace('、','<br />');
		return houshutext;
	}
}

//-----------------------------------------------
// トレード収入計算 2014/02/02 refactoring
//-----------------------------------------------
// start 途中
function TradeIncome(){
	// トレード出品画面なら実行
	if (location.pathname != "/card/exhibit_list.php") {
		return;
	}

	var income = 0;
	var total = 0;
	var count = 0;
	var sum = 0;

	//----------------------//
	// 結果描画エリアの定義 //
	//----------------------//
	var target = "tradeTables";

	// データ描画用
	textArea = document.createElement("td");
	textArea.style.backgroundColor = "lightYellow";
	textArea.style.textAlign = "center";
	textArea.innerHTML = "収入";
	textArea.style.color = "red";

	var obj = $v_29('//tr[@class="tradeSell"]');
	if (obj.snapshotLength == 0) {
		return;
	}
	obj.snapshotItem(0).appendChild(textArea);

	var notice = $v_29('//span[@class="notice"]');
	if( notice.snapshotLength > 0 ){
		count = notice.snapshotLength - 1;
		for( var i = 0; i < count; i++ ){
			income = -1;
			if( !isNaN(parseInt(notice.snapshotItem(i).textContent)) ){;
				income = parseInt(notice.snapshotItem(i).textContent);
				sum = sum + parseInt(income);

				if ( isNaN(income) ) {
					income = 0
				}

				var income2 = Math.floor(income*0.1);
				if ( income > 500 ) {
					income2 += Math.floor((income-500)*0.1);
				}
				if ( income > 1000 ) {
					income2 += Math.floor((income-1000)*0.1);
				}
				total = total + (income - income2);
			}

			if( income >= 0 ){
				textArea = document.createElement("td");
				textArea.id = "smallmap";
				textArea.className = "trade";
				textArea.innerHTML = income - income2;
				textArea.style.color = "red";
				textArea.style.fontWeight = "bold";
				notice.snapshotItem(i).parentNode.parentNode.appendChild(textArea);
			}
		}
	}

	var notice = $v_29('//td/a/img[@alt="取消"]');
	if( notice.snapshotLength > 0 ){
		for( var i = 0; i < notice.snapshotLength; i++ ){
			textArea = document.createElement("td");
			textArea.id = "smallmap";
			textArea.className = "trade";
			textArea.innerHTML = "-";
			textArea.style.color = "red";
			textArea.style.fontWeight = "bold";
			notice.snapshotItem(i).parentNode.parentNode.parentNode.appendChild(textArea);
		}
	}

	// データ描画用
	textArea = document.createElement("tr");
	textArea.style.backgroundColor = "lightYellow";
	textArea.style.textAlign = "right";
	textArea.style.border = "solid 1px";
	textArea.className = "trade"
	textArea.style.fontWeight = "bold";
	textArea.innerHTML = "<td colspan='10'/><font color='red'>" + count + "</font>件 収入<font color='red'>" + total + "</font>TP 手数料<font color='red'>" + (sum - total) + "</font>TP";

	var obj = $v_29('//tr[@class="tradeSell"]');
	obj.snapshotItem(0).parentNode.appendChild(textArea);

	return;
}
//end

//faraway 31.自動巡回のソース(bro3_auto_map_move.user.js)開始
//================================================================================
//31.自動巡回
//================================================================================
function AutoRound(){
	if( location.pathname != "/map.php" ) {	//全体地図
   		return ;
	}

// ==UserScript==
// @name		 bro3_Auto_Map_Move
// @namespace	http://at-n2.net/
// @description  ブラウザ三国志自動マップ移動 By nottisan
// @include	  http://*.3gokushi.jp/map.php*
// @include	  http://*.1kibaku.jp/*
// ==/UserScript==

// 浮浪プログラマ 様のスクリプトを参考に作成させて頂きました。
// http://blog.livedoor.jp/froo/
// 使い方: 開始＆終了に数値を入れて開始を押すだけ。

//Main
	addOpenLinkHtml_31();
	var host = location.hostname;
	var Move_Flg = GM_getValue(host + "Move_Flg", false);
	if (Move_Flg) {
		openMoveBox();
		MoveCheck();
	}
}
function MoveCheck() {
	var host = location.hostname;
	var Move_Flg = GM_getValue(host + "Move_Flg", false);
	st_x = document.getElementById("st_x").value;
	st_y = document.getElementById("st_y").value;
	en_x = document.getElementById("en_x").value;
	en_y = document.getElementById("en_y").value;
	GM_log("MoveCheck() MoveFlg = " + Move_Flg);
	GM_log("MoveCheck() x = " + document.getElementById("x").value);
	GM_log("MoveCheck() y = " + document.getElementById("y").value);
	if (Move_Flg) {
		var cntdown=0;
		CENTER_X_31 = parseInt(document.getElementById("x").value) -MOVE_CNT;
		if (isNaN(CENTER_X_31)) CENTER_X_31 = 0;
		var temp_x = CENTER_X_31;
		if (CENTER_X_31 < en_x) {
			CENTER_X_31 = st_x;
			cntdown=MOVE_CNT;
		}
		CENTER_Y_31 = parseInt(document.getElementById("y").value) -cntdown;
		if (isNaN(CENTER_Y_31)) CENTER_Y_31 = 0;
		if (temp_x < en_x) {
		if (CENTER_Y_31 < en_y) {
			GM_setValue(host + "Move_Flg", false);
			deleteMoveHtml();
			GM_log("MoveCheck() END x=" + temp_x + "  y=" + CENTER_Y_31);

			//移動開始位置に戻る
			CENTER_X_31 = GM_getValue(host + "now_x", "0");
			CENTER_Y_31 = GM_getValue(host + "now_y", "0");
			var tid=setTimeout(function(){location.href = getMapUrl_31(CENTER_X_31,CENTER_Y_31);},INTERVAL_31);
			return;
		}}

		GM_log("MoveCheck() x = " + document.getElementById("x").value);
		GM_log("MoveCheck() y = " + document.getElementById("y").value);
		var tid=setTimeout(function(){location.href = getMapUrl_31(CENTER_X_31,CENTER_Y_31);},INTERVAL_31);
	}
}

//リンクHTML追加
function addOpenLinkHtml_31() {
	var sidebar = document.evaluate('//*[@id="status"]',
		document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
	if (sidebar.snapshotLength == 0) return;

	//自動移動リンク
	var openLink = document.createElement("a");
	openLink.id = "AutoMoveLink";
	openLink.href = "javascript:void(0);";
	openLink.innerHTML = "自動移動<br>";
	openLink.addEventListener("click", function() {openMoveBox()}, true);
	sidebar.snapshotItem(0).appendChild(openLink);
}
//移動開始
function MoveStart() {
	var host = location.hostname;

	//移動フラグの設定
	GM_setValue(host + "Move_Flg", true);

	//移動開始位置の設定
	GM_setValue(host + "Start_x", document.getElementById("st_x").value);
	GM_setValue(host + "Start_y", document.getElementById("st_y").value);
	GM_setValue(host + "End_x", document.getElementById("en_x").value);
	GM_setValue(host + "End_y", document.getElementById("en_y").value);
	GM_setValue(host + "now_x", document.getElementById("x").value);
	GM_setValue(host + "now_y", document.getElementById("y").value);

	location.href = getMapUrl_31(document.getElementById("st_x").value, document.getElementById("st_y").value);
}

//地図画面URL取得
function getMapUrl_31(x, y) {return "/map.php?x=" + x + "&y=" + y + "&type=" + MAPSIZE;}

//移動表示を開く
function openMoveBox() {closeMoveBox();addMoveHtml(false);}
//移動終了
function MoveEnd() {var host = location.hostname;GM_setValue(host + "Move_Flg", false);}
//移動表示を閉じる
function closeMoveBox() {deleteMoveHtml();}

//移動表示HTML削除
function deleteMoveHtml() {
	var elem = document.getElementById("MoveContainer");
	if (elem == undefined) return;
	document.body.removeChild(document.getElementById("MoveContainer"));
}

//お気に入りの表示＆非表示
function FavoriteLink(Favorite_Flg){
	if (Favorite_Flg == true){closeMoveBox();addMoveHtml(true);
	}else{closeMoveBox();addMoveHtml(false);}
}

//お気に入りの保存
function FavoriteSave(btn_cnt){
	var host = location.hostname;
	st_x = document.getElementById("st_x").value;
	st_y = document.getElementById("st_y").value;
	en_x = document.getElementById("en_x").value;
	en_y = document.getElementById("en_y").value;
	var name = prompt("7文字以内で名前を入力してください。\n空白は登録されません。\n半角コンマ「,」は入力しないでください。","");
	if (name == "" ||name == undefined) return;
	var saveData = st_x + "," + st_y + "," + en_x + "," + en_y + "," + name;
	GM_setValue(host + "Favorite" + btn_cnt, saveData);
	closeMoveBox();
	addMoveHtml(true);
	alert("保存しました。");
}

//お気に入りの読込み
function FavoriteLoad(btn_cnt){
	var host = location.hostname;
	var LoadData = GM_getValue(host + "Favorite"+ btn_cnt, "0,0,0,0,0");
	var st_x = parseInt(LoadData.split(",")[0]);
	var st_y = parseInt(LoadData.split(",")[1]);
	var en_x = parseInt(LoadData.split(",")[2]);
	var en_y = parseInt(LoadData.split(",")[3]);
	document.getElementById("st_x").value = st_x;
	document.getElementById("st_y").value = st_y;
	document.getElementById("en_x").value = en_x;
	document.getElementById("en_y").value = en_y;

}

//地点お気に入りの保存
function FavoriteMoveSave(btn_cnt){
	var host = location.hostname;
	var st_x = document.getElementById("x").value;
	var st_y = document.getElementById("y").value;
	var name ="";
	name = prompt("7文字以内で名前を入力してください。\n空白は登録されません。","");
	if (name == "" || name == null) return;
	var saveData = name + "@@@" + st_x + "@@@" + st_y;
	GM_setValue(host + "FavoriteMove" + btn_cnt, saveData);
	closeMoveBox();
	addMoveHtml(true);
	alert(name + "の座標を保存しました。")
}

//地点お気に入りの読込み
function FavoriteMoveLoad(btn_cnt){
	var host = location.hostname;
	var LoadData = GM_getValue(host + "FavoriteMove"+ btn_cnt, "Move@@@0@@@0");
	var x = parseInt(LoadData.split("@@@")[1]);	//ｘ
	var y = parseInt(LoadData.split("@@@")[2]);	//ｙ
	location.href = getMapUrl_31(x, y);
}

//中心からの画面数座標の計算
function map_Calc(){
	//中心位置の取得
	CENTER_X_31 = parseInt(document.getElementById("x").value);
	if (isNaN(CENTER_X_31)) CENTER_X_31 = 0;
	CENTER_Y_31 = parseInt(document.getElementById("y").value);
	if (isNaN(CENTER_Y_31)) CENTER_Y_31 = 0;
	//画面数取得
	var mapCnt = parseInt(document.getElementById("mapCnt").value);
	//移動量の算出
	var moveCnt = parseInt(MOVE_CNT * mapCnt);
	//値のセット
	document.getElementById("st_x").value = CENTER_X_31 + moveCnt;
	document.getElementById("st_y").value = CENTER_Y_31 + moveCnt;
	document.getElementById("en_x").value = CENTER_X_31 - moveCnt;
	document.getElementById("en_y").value = CENTER_Y_31 - moveCnt;
	//画面数の保存
	var host = location.hostname;
	GM_setValue(host + "mapCnt", document.getElementById("mapCnt").value);
}

//移動表示HTML追加
function addMoveHtml(Favorite_Flg) {

	var host = location.hostname;
	var mapCnt = GM_getValue(host + "mapCnt", 1);

	var popupLeft = GM_getValue("popup_leftm", 575);//ac45a
	var popupTop = GM_getValue("popup_topm", 240);//ac45a
	if (popupLeft < 0) popupLeft = 0;
	if (popupTop < 0) popupTop = 0;

	//表示コンテナ作成
	var MoveContainer = document.createElement("div");
	MoveContainer.id = "MoveContainer";
	MoveContainer.style.position = "absolute";
	MoveContainer.style.backgroundColor = "darkgray";
	MoveContainer.style.border = "outset 2px darkgray";
	MoveContainer.style.left = popupLeft + "px";
	MoveContainer.style.top = popupTop + "px";
	MoveContainer.style.fontSize = "10px";
	MoveContainer.style.padding = "3px";
	MoveContainer.style.zIndex = 999;
	document.body.appendChild(MoveContainer);

	//開始リンク
	var confirmLink = document.createElement("a");
	confirmLink.id = "MoveStartLink";
	confirmLink.href = "javascript:void(0);";
	confirmLink.style.margin = "3px";
	confirmLink.innerHTML = "移動開始";
	confirmLink.addEventListener("click", function() {MoveStart()}, true);
	MoveContainer.appendChild(confirmLink);

	//移動終了リンク
	var endLink = document.createElement("a");
	endLink.id = "MoveEndLink";
	endLink.href = "javascript:void(0);";
	endLink.style.margin = "3px";
	endLink.innerHTML = "移動終了";
	endLink.addEventListener("click", function() {MoveEnd()}, true);
	MoveContainer.appendChild(endLink);

	//閉じるリンク
	var closeLink = document.createElement("a");
	closeLink.id = "timerCloseLink";
	closeLink.href = "javascript:void(0);";
	closeLink.style.margin = "3px";
	closeLink.innerHTML = "閉じる";
	closeLink.addEventListener("click", function() {closeMoveBox()}, true);
	MoveContainer.appendChild(closeLink);

	//バージョン
	var version = document.createElement("span");
	version.style.fontSize = "9px";
	version.style.margin = "3px";
	version.innerHTML = "Ver." + VERSION_31;
	MoveContainer.appendChild(version);

	//入力項目の作成
	var table = document.createElement("div");
	table.innerHTML = "\
	<table style='font-size:11px;border: 2px solid #ff8622;margin-top:5px;'>\
	  <tr>\
		<td id='fld_start' style='padding:3px 4px;'>\
		  開始\
		</td>\
		<td id='fld_st_x' style='padding:3px 4px;'>\
		  X=<input id='st_x' type='text' style='width:40px' />\
		</td>\
		<td id='fld_st_y' style='padding:3px 4px;'>\
		  Y=<input id='st_y' type='text' style='width:40px' />\
		</td>\
	  </tr>\
	  <tr>\
		<td id='fld_end' style='padding:3px 4px;'>\
		  終了\
		</td>\
		<td id='fld_en_x' style='padding:3px 4px;'>\
		  X=<input id='en_x' type='text' style='width:40px' />\
		</td>\
		<td id='fld_en_y' style='padding:3px 4px;'>\
		  Y=<input id='en_y' type='text' style='width:40px' />\
		</td>\
	  </tr>\
	</table>\
	<table id='tbl_mapCnt' style='font-size:11px;margin-bottom:5px;'>\
	  <tr>\
			<td id='fld_mapCnt' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  画面数=<input id='mapCnt' type='text' style='width:20px' />\
		</td>\
   		<td id='fld_calc_' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_Calc' type='button' style='width:40px' value='計算' />\
		</td>\
	  </tr>\
	</table>";
	MoveContainer.appendChild(table);

	//お気に入りリンク
	var Favorite = document.createElement("a");
	Favorite.id = "FavoriteLink";
	Favorite.href = "javascript:void(0);";
	Favorite.style.margin = "3px";
	Favorite.innerHTML = "座標のお気に入り";
	if (Favorite_Flg == true){
		Favorite.addEventListener("click", function() {FavoriteLink(false);}, true);
	}else{
		Favorite.addEventListener("click", function() {FavoriteLink(true);}, true);
	}
	MoveContainer.appendChild(Favorite);

	document.getElementById("mapCnt").value = mapCnt;
	//計算ボタンのイベント登録
	document.getElementById('btn_Calc').addEventListener("click",function() { map_Calc(); }, true);

	if (Favorite_Flg == true){
		var table = document.createElement("div");
		table.innerHTML = "\
		<table id='tbl_Favorite' style='font-size:11px;'>\
		  <tr>\
			<td id='fld_Save1' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_Save1' type='button' style='width:40px' value='Save' /><input id='btn_Load1' type='button' style='width:80px' value='Load'/>\
			</td>\
			<td id='fld_Save2' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_Save2' type='button' style='width:40px' value='Save' /><input id='btn_Load2' type='button' style='width:80px' value='Load'/>\
			</td>\
		  </tr>\
		  <tr>\
			<td id='fld_Save3' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_Save3' type='button' style='width:40px' value='Save' /><input id='btn_Load3' type='button' style='width:80px' value='Load'/>\
			</td>\
			<td id='fld_Save4' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_Save4' type='button' style='width:40px' value='Save' /><input id='btn_Load4' type='button' style='width:80px' value='Load'/>\
			</td>\
		  </tr>\
		  <tr>\
			<td id='fld_Save5' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_Save5' type='button' style='width:40px' value='Save' /><input id='btn_Load5' type='button' style='width:80px' value='Load'/>\
			</td>\
			<td id='fld_Save6' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_Save6' type='button' style='width:40px' value='Save' /><input id='btn_Load6' type='button' style='width:80px' value='Load'/>\
			</td>\
		  </tr>\
		  <tr>\
			<td id='fld_Save7' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_Save7' type='button' style='width:40px' value='Save' /><input id='btn_Load7' type='button' style='width:80px' value='Load'/>\
			</td>\
			<td id='fld_Save8' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_Save8' type='button' style='width:40px' value='Save' /><input id='btn_Load8' type='button' style='width:80px' value='Load'/>\
			</td>\
		  </tr>\
		</table><br />\
		<font Color='blue'>お気に入り地点♪</font>\
		<table id='tbl_MoveFavorite' style='font-size:11px;'>\
		  <tr>\
			<td id='fld_MoveSave1' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_MoveSave1' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad1' type='button' style='width:80px' value='Move'/>\
			</td>\
			<td id='fld_MoveSave2' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_MoveSave2' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad2' type='button' style='width:80px' value='Move'/>\
			</td>\
		  </tr>\
		  <tr>\
			<td id='fld_MoveSave3' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_MoveSave3' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad3' type='button' style='width:80px' value='Move'/>\
			</td>\
			<td id='fld_MoveSave4' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_MoveSave4' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad4' type='button' style='width:80px' value='Move'/>\
			</td>\
		  </tr>\
		  <tr>\
			<td id='fld_MoveSave5' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_MoveSave5' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad5' type='button' style='width:80px' value='Move'/>\
			</td>\
			<td id='fld_MoveSave6' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_MoveSave6' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad6' type='button' style='width:80px' value='Move'/>\
			</td>\
		  </tr>\
		  <tr>\
			<td id='fld_MoveSave7' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_MoveSave7' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad7' type='button' style='width:80px' value='Move'/>\
			</td>\
			<td id='fld_MoveSave8' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_MoveSave8' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad8' type='button' style='width:80px' value='Move'/>\
			</td>\
		  </tr>\
		  <tr>\
			<td id='fld_MoveSave9' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_MoveSave9' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad9' type='button' style='width:80px' value='Move'/>\
			</td>\
			<td id='fld_MoveSave10' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_MoveSave10' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad10' type='button' style='width:80px' value='Move'/>\
			</td>\
		  </tr>\
		  <tr>\
			<td id='fld_MoveSave11' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_MoveSave11' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad11' type='button' style='width:80px' value='Move'/>\
			</td>\
			<td id='fld_MoveSave12' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_MoveSave12' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad12' type='button' style='width:80px' value='Move'/>\
			</td>\
		  </tr>\
		  <tr>\
			<td id='fld_MoveSave13' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_MoveSave13' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad13' type='button' style='width:80px' value='Move'/>\
			</td>\
			<td id='fld_MoveSave14' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_MoveSave14' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad14' type='button' style='width:80px' value='Move'/>\
			</td>\
		  </tr>\
		  <tr>\
			<td id='fld_MoveSave15' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_MoveSave15' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad15' type='button' style='width:80px' value='Move'/>\
			</td>\
			<td id='fld_MoveSave16' style='padding:3px 4px;border: 2px solid #ff8622;'>\
			  <input id='btn_MoveSave16' type='button' style='width:40px' value='Save' /><input id='btn_MoveLoad16' type='button' style='width:80px' value='Move'/>\
			</td>\
		  </tr>\
		</table>";
		MoveContainer.appendChild(table);

		//保存ボタンへのイベント登録
		document.getElementById('btn_Save' + 1).addEventListener("click",function() { FavoriteSave(1); }, true);
		document.getElementById('btn_Save' + 2).addEventListener("click",function() { FavoriteSave(2); }, true);
		document.getElementById('btn_Save' + 3).addEventListener("click",function() { FavoriteSave(3); }, true);
		document.getElementById('btn_Save' + 4).addEventListener("click",function() { FavoriteSave(4); }, true);
		document.getElementById('btn_Save' + 5).addEventListener("click",function() { FavoriteSave(5); }, true);
		document.getElementById('btn_Save' + 6).addEventListener("click",function() { FavoriteSave(6); }, true);
		document.getElementById('btn_Save' + 7).addEventListener("click",function() { FavoriteSave(7); }, true);
		document.getElementById('btn_Save' + 8).addEventListener("click",function() { FavoriteSave(8); }, true);

		//読込みボタンへのイベント登録
		document.getElementById('btn_Load' + 1).addEventListener("click",function() { FavoriteLoad(1); }, true);
		document.getElementById('btn_Load' + 2).addEventListener("click",function() { FavoriteLoad(2); }, true);
		document.getElementById('btn_Load' + 3).addEventListener("click",function() { FavoriteLoad(3); }, true);
		document.getElementById('btn_Load' + 4).addEventListener("click",function() { FavoriteLoad(4); }, true);
		document.getElementById('btn_Load' + 5).addEventListener("click",function() { FavoriteLoad(5); }, true);
		document.getElementById('btn_Load' + 6).addEventListener("click",function() { FavoriteLoad(6); }, true);
		document.getElementById('btn_Load' + 7).addEventListener("click",function() { FavoriteLoad(7); }, true);
		document.getElementById('btn_Load' + 8).addEventListener("click",function() { FavoriteLoad(8); }, true);

		//保存ボタンへのイベント登録
		document.getElementById('btn_MoveSave' + 1).addEventListener("click",function() { FavoriteMoveSave(1); }, true);
		document.getElementById('btn_MoveSave' + 2).addEventListener("click",function() { FavoriteMoveSave(2); }, true);
		document.getElementById('btn_MoveSave' + 3).addEventListener("click",function() { FavoriteMoveSave(3); }, true);
		document.getElementById('btn_MoveSave' + 4).addEventListener("click",function() { FavoriteMoveSave(4); }, true);
		document.getElementById('btn_MoveSave' + 5).addEventListener("click",function() { FavoriteMoveSave(5); }, true);
		document.getElementById('btn_MoveSave' + 6).addEventListener("click",function() { FavoriteMoveSave(6); }, true);
		document.getElementById('btn_MoveSave' + 7).addEventListener("click",function() { FavoriteMoveSave(7); }, true);
		document.getElementById('btn_MoveSave' + 8).addEventListener("click",function() { FavoriteMoveSave(8); }, true);
		document.getElementById('btn_MoveSave' + 9).addEventListener("click",function() { FavoriteMoveSave(9); }, true);
		document.getElementById('btn_MoveSave' + 10).addEventListener("click",function() { FavoriteMoveSave(10); }, true);
		document.getElementById('btn_MoveSave' + 11).addEventListener("click",function() { FavoriteMoveSave(11); }, true);
		document.getElementById('btn_MoveSave' + 12).addEventListener("click",function() { FavoriteMoveSave(12); }, true);
		document.getElementById('btn_MoveSave' + 13).addEventListener("click",function() { FavoriteMoveSave(13); }, true);
		document.getElementById('btn_MoveSave' + 14).addEventListener("click",function() { FavoriteMoveSave(14); }, true);
		document.getElementById('btn_MoveSave' + 15).addEventListener("click",function() { FavoriteMoveSave(15); }, true);
		document.getElementById('btn_MoveSave' + 16).addEventListener("click",function() { FavoriteMoveSave(16); }, true);

		//読込みボタンへのイベント登録
		document.getElementById('btn_MoveLoad' + 1).addEventListener("click",function() { FavoriteMoveLoad(1); }, true);
		document.getElementById('btn_MoveLoad' + 2).addEventListener("click",function() { FavoriteMoveLoad(2); }, true);
		document.getElementById('btn_MoveLoad' + 3).addEventListener("click",function() { FavoriteMoveLoad(3); }, true);
		document.getElementById('btn_MoveLoad' + 4).addEventListener("click",function() { FavoriteMoveLoad(4); }, true);
		document.getElementById('btn_MoveLoad' + 5).addEventListener("click",function() { FavoriteMoveLoad(5); }, true);
		document.getElementById('btn_MoveLoad' + 6).addEventListener("click",function() { FavoriteMoveLoad(6); }, true);
		document.getElementById('btn_MoveLoad' + 7).addEventListener("click",function() { FavoriteMoveLoad(7); }, true);
		document.getElementById('btn_MoveLoad' + 8).addEventListener("click",function() { FavoriteMoveLoad(8); }, true);
		document.getElementById('btn_MoveLoad' + 9).addEventListener("click",function() { FavoriteMoveLoad(9); }, true);
		document.getElementById('btn_MoveLoad' + 10).addEventListener("click",function() { FavoriteMoveLoad(10); }, true);
		document.getElementById('btn_MoveLoad' + 11).addEventListener("click",function() { FavoriteMoveLoad(11); }, true);
		document.getElementById('btn_MoveLoad' + 12).addEventListener("click",function() { FavoriteMoveLoad(12); }, true);
		document.getElementById('btn_MoveLoad' + 13).addEventListener("click",function() { FavoriteMoveLoad(13); }, true);
		document.getElementById('btn_MoveLoad' + 14).addEventListener("click",function() { FavoriteMoveLoad(14); }, true);
		document.getElementById('btn_MoveLoad' + 15).addEventListener("click",function() { FavoriteMoveLoad(15); }, true);
		document.getElementById('btn_MoveLoad' + 16).addEventListener("click",function() { FavoriteMoveLoad(16); }, true);

		for (var i=1; i<=8; i++){
			var LoadData = GM_getValue(host + "Favorite"+ i, "0,0,0,0,Load");
			var name = LoadData.split(",")[4];
			if (name == undefined) name = "Load";
			document.getElementById('btn_Load' + i).value = name;
		}

		for (var i=1; i<=16; i++){
			var LoadData = GM_getValue(host + "FavoriteMove"+ i, "Move@@@0@@@0");
			var name = LoadData.split("@@@")[0];
			document.getElementById('btn_MoveLoad' + i).value = name;
		}



	}//Endif

	var host = location.hostname;
	document.getElementById("st_x").value = GM_getValue(host + "Start_x",600);
	document.getElementById("st_y").value = GM_getValue(host + "Start_y",600);
	document.getElementById("en_x").value = GM_getValue(host + "End_x",-600);
	document.getElementById("en_y").value = GM_getValue(host + "End_y",-600);

}

//faraway 31.自動巡回のソース(bro3_auto_map_move.user.js)終了

//----------------------------------------
// 報告書・同盟ログCSV出力
//----------------------------------------
function ReportLog(){
	//alert("32.報告書・同盟ログCSV出力:"+location.pathname);
	if( location.pathname != "/alliance/alliance_log.php" ) {	//faraway111005 範囲指定
		if( location.pathname != "/report/list.php" ) {
			return ;
		}
	}

	jQuery.noConflict();
var d_32 = document;
var $_32 = jQuery;
var $xp_32 = function (xp, dc) { return d_32.evaluate(xp, dc, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); };
var $xp1_32 = function (xp, dc) { return d_32.evaluate(xp, dc, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
var location_allianceURL = "/alliance/alliance_log.php";
var location_reportURL = "/report/list.php";
var worldKey_32 = location.hostname;
// 以下、GM変数
var reportIdArray = [];			// キャッシュ済みの報告書ログIDの配列
var allianceIdArray = [];		// キャッシュ済みのログIDの配列

// 各種チェック
if (!pre_check_32()) {
	// 確認用
	return;
}
function pre_check_32() {
	if (!worldKey_32) { console.log("ワールドキー取得エラー"); return false; }

	var time_checker = new Date().toString();
	GM_setValue(worldKey_32 + "time_checker", time_checker.toSource());
	var res_time_checker = eval(GM_getValue(worldKey_32 + "time_checker", ""));
	if (time_checker != res_time_checker) {
		console.log("GM変数の利用エラー");
		console.log("　：" + time_checker);
		console.log("　：" + res_time_checker);
		return false;
	}

	if (!$_32) { console.log("jquery取得エラー"); return false; }
	return true;
}
// GM変数ロード
loadOpValues_32();

// ページ読み込み完了後に本処理開始
window.addEventListener("load", function() { pre_main_32(); }, false);

////////////////////////////////////////////////////////
// ページ読み込み完了後に起動する処理
////////////////////////////////////////////////////////
function pre_main_32() {
	addBtn_32();
}
function addBtn_32() {
	var targetNode = $xp1_32('//ul[@id="statMenu"]', d_32);
	var getInfoBtn = d_32.createElement("input");
		getInfoBtn.type = "button";
		getInfoBtn.id = "getInfoBtn";
		getInfoBtn.value = "【CSV出力】";
		getInfoBtn.addEventListener("click", function() {
			getInfoBtn.disabled = true;
			if (!confirm("ログ情報のCSVデータを出力します。")) { getInfoBtn.disabled = false; return; }
			getLogInfoMain();
		}, false);
	targetNode.appendChild(getInfoBtn);
	var resetLogBtn = d_32.createElement("input");
		resetLogBtn.type = "button";
		resetLogBtn.id = "resetLogBtn";
		resetLogBtn.value = "【リセット】";
		resetLogBtn.addEventListener("click", function() {
			resetLogBtn.disabled = true;
			if (!confirm("既出力情報をリセットします")) { resetLogBtn.disabled = false; return; }
			resetIdCash();
			alert("リセット完了しました。")
		}, false);
	targetNode.appendChild(resetLogBtn);
}

var hrefArray_32 = []; // [[ログID,URL,日時,x座標,y座標,見出し文字列]...]
function getLogInfoMain() {
	var linkNodes = $xp_32('//td[@class="brno"]/a', d_32);
	for (var i = 0, len = linkNodes.snapshotLength; i < len; i++ ) {
		// ログURL
		var href = linkNodes.snapshotItem(i).href;
		if (href == null) { continue; }
		// ログID
		var brno = href.match("id=[0-9]+")[0].split("=")[1];
		if (brno == null) { continue; }
		// すでに出力済みならスキップ
		if (checkIdCash_32(brno)) {continue; }
		// 見出しテキスト
		var text = linkNodes.snapshotItem(i).innerHTML;
		if (text == null) { continue; }
			text = text.replace(/<[^>]*>/g, "");
			text = text.replace(/\t/g, "");

		// 親ノード
		var trNode = linkNodes.snapshotItem(i).parentNode.parentNode;
		// 出兵先
		console.log(111);
		var iconNode = $xp1_32('descendant::td[@class="subinfo"]//a', trNode);
		if (iconNode == null) { continue; }
		console.log(222);
		var iconText = iconNode.href;
		var x = iconText.match("x=[0-9]+|x=-[0-9]+")[0].split("=")[1];
		var y = iconText.match("y=[0-9]+|y=-[0-9]+")[0].split("=")[1];
		// 日時
		console.log(333);
		var dateNode = $xp1_32('descendant::td[@class="fs77" or @class="contents center w120 fs85"]', trNode);
		if (dateNode == null) { continue; }
		console.log(444);
		var date = dateNode.innerHTML;
			date = date.replace(/\n/g, "");
		hrefArray_32.push([brno, href, date, x, y, text]);
	}
	if (hrefArray_32.length <= 0) {
		alert("出力対象はありません。");
		return;
	}

	// 実行中表示レイヤー
	var layer = d_32.createElement("div");
		layer.id = "cash_layer";
		layer.style.backgroundColor = "#202020";
		layer.style.position = "fixed";
		layer.style.zIndex = 50000;
		layer.style.width = "100%";
		layer.style.height = "100%";
		layer.style.opacity = 0.9;
	var explain = d_32.createElement("div");
		explain.id = "cash_explain";
		explain.style.backgroundColor = "white";
		explain.style.marginTop  = "100px";
		explain.style.padding  = "20px";
		explain.style.width = "100%";
		explain.innerHTML = "<b>ログ出力実行中</b>　　" + 1 + "/" + hrefArray_32.length;
		layer.appendChild(explain);
	var targetNode = $xp1_32('//body', d_32);
		targetNode.insertBefore(layer, targetNode.firstChild);
	loadPage_32(0);
}
// loadNoにより同期処理させる
function loadPage_32(loadNo) {
	var opt = {
		method: 'get',
		url: hrefArray_32[loadNo][1],
		onload: function(res) {
			getLogInfo(loadNo, res);
		}
	};
	GM_xmlhttpRequest(opt);
}
var copyTxt = "";
function getLogInfo(loadNo, res) {
	var brno = hrefArray_32[loadNo][0];
	var date = hrefArray_32[loadNo][2];
	var x = hrefArray_32[loadNo][3];
	var y = hrefArray_32[loadNo][4];
	var text = hrefArray_32[loadNo][5];

	var fillterEL = d_32.createElement('div');
		fillterEL.innerHTML = res.responseText;

	var tableNodes = $xp_32('//table[@class="tables"]/tbody/tr', fillterEL);
	var resTxt = "\t";
	// 上のテーブルはスキップ
	for (var i = 2, len = tableNodes.snapshotLength; i < len; i++ ) {
		resTxt = resTxt + tableNodes.snapshotItem(i).innerHTML;
	}
	resTxt = resTxt.replace(/\n/g, "");
	resTxt = resTxt.replace(/<[^>]*>/g, "\t");
	resTxt = resTxt.replace(/【|】|&nbsp;| \t|剣兵\t\t槍兵\t\t弓兵\t\t騎兵\t\t矛槍兵\t\t弩兵\t\t近衛騎兵\t\t斥候\t\t斥候騎兵\t\t衝車\t\t投石機\t\t武将/g, "");

	while (resTxt.indexOf("\t\t") != -1) {
		resTxt = resTxt.replace(/\t\t/g, "\t");
	}
	var tmp = brno + "\t";
		tmp = tmp + date + "\t";
		tmp = tmp + x + "\t";
		tmp = tmp + y + "\t";
		tmp = tmp + text;
	copyTxt = copyTxt + tmp + resTxt + "\n";
	addIdCash(brno);

	if (loadNo + 1 >= hrefArray_32.length) {
		var targetNode = $xp1_32('//ul[@id="statMenu"]', d_32);
		var textAreaEL = d_32.createElement("textarea");
			textAreaEL.cols = 95;
			textAreaEL.rows = 25;
			textAreaEL.defaultValue = copyTxt;
		targetNode.appendChild(textAreaEL);

		var layer = $xp1_32('//div[@id="cash_layer"]', d_32);
			layer.parentNode.removeChild(layer);

		saveOpValues_32();
		alert("ログ情報を出力しました。");
		return;
	}
	var layerExplain = $xp1_32('//div[@id="cash_explain"]', d_32);
		layerExplain.innerHTML = "<b>ログ出力実行中</b>　　" + (loadNo + 2) + "/" + hrefArray_32.length;
	loadPage_32(loadNo + 1);
}

// 該当IDがキャッシュ済みならtrueを返す
function checkIdCash_32(logId) {
	if(location.pathname == location_allianceURL) {
		for (var i in allianceIdArray) {
			if (allianceIdArray.hasOwnProperty(i) && allianceIdArray[i] == logId){ return true; }
		}
	} else if (location.pathname == location_reportURL) {
		for (var i in reportIdArray) {
			if (reportIdArray.hasOwnProperty(i) && reportIdArray[i] == logId){ return true; }
		}
	}
	return false;
}
// 該当IDをキャッシュに加える
function addIdCash(logId) {
	if(location.pathname == location_allianceURL) {
		allianceIdArray.push(logId);
	} else if (location.pathname == location_reportURL) {
		reportIdArray.push(logId);
	}
}
// キャッシュIDを削除
function resetIdCash() {
	if(location.pathname == location_allianceURL) {
		allianceIdArray = [];
		GM_deleteValue(worldKey_32 + "allianceIdArray");
	} else if (location.pathname == location_reportURL) {
		reportIdArray = [];
		GM_deleteValue(worldKey_32 + "reportIdArray");
	}
}

////////////////////////////////////////////////////////
// GM関連の共通関数
////////////////////////////////////////////////////////
function loadOpValues_32 () {
	reportIdArray = eval(GM_getValue(worldKey_32 + "reportIdArray", []));
	allianceIdArray = eval(GM_getValue(worldKey_32 + "allianceIdArray", []));
}
function saveOpValues_32 () {
	GM_setValue(worldKey_32 + "reportIdArray", reportIdArray.toSource());
	GM_setValue(worldKey_32 + "allianceIdArray", allianceIdArray.toSource());
}
}


//faraway 32.報告書・同盟ログCSV出力のソース(.user.js)終了

//------------------------------------------------------------
// トレードステータス表示(2014/02/02 refactoring)
//------------------------------------------------------------
function TradeStatus(){
	if (!location.pathname.match("/card/trade.php")) {
		return;
	}

	jQuery.noConflict();
	j$ = jQuery;
	j$("div[class*=cardStatus_rarerity]").each(
		function(){
			var par = [
				['攻撃', 1, 'black', 0], ['知力', 2, 'black', 0], ['歩防', 1, 'black', 0], ['槍防', 1, 'black', 0],
				['弓防', 1, 'black', 0], ['騎防', 1, 'black', 0], ['移速', 3, 'black', 0]
			];

		par[0][3] = j$("li[class=status_att]",this).html();	//	par[0][3] = j$("span[class=status_att]",this).html();
		par[1][3] = j$("li[class=status_int]",this).html();	//	par[1][3] = j$("span[class=status_int]",this).html();
		par[2][3] = j$("li[class=status_wdef]",this).html();	//	par[2][3] = j$("span[class=status_wdef]",this).html();
		par[3][3] = j$("li[class=status_sdef]",this).html();	//	par[3][3] = j$("span[class=status_sdef]",this).html();
		par[4][3] = j$("li[class=status_bdef]",this).html();	//	par[4][3] = j$("span[class=status_bdef]",this).html();
		par[5][3] = j$("li[class=status_rdef]",this).html();	//	par[5][3] = j$("span[class=status_rdef]",this).html();
		par[6][3] = j$("li[class=status_speed]",this).html();	//	par[6][3] = j$("span[class=status_speed]",this).html();

		//console.log("att:"+par[0][3]+"\nint:"+par[1][3]+"\nwdef:"+par[2][3]+"\nsdwf:"+par[3][3]+"\nbdef:"+par[4][3]+"\nrdef:"+par[5][3]+"\nspd:"+par[6][3]);

			var vtext = "";
			for(var i = 0; i < 7; i++){
				if(par[i][1] == 1){
					// 5の倍数と1000超え判定
					if(parseInt(par[i][3] % 5) != 0 || parseInt(par[i][3]) > 1000){
						par[i][2] = 'red';
					}
				}else if(par[i][1] == 2){
					// .00 判定
					if(par[i][3].match(/\.00/) == null){
						par[i][2] = 'red';
					}
				}else{
					// .0 判定
					if(par[i][3].match(/\.0/) == null){
						par[i][2] = 'red';
					}
				}
				vtext += par[i][0] + ": <font color='" + par[i][2] + "'>" + par[i][3] + "</font>";
				if( i != 6 ){
					vtext +="<br>";
				}
			}
			j$(this).parent().parent().parent().parent().append("<div style='font-size:8pt;'>" + vtext + "</div>");
		}
	);
}

//------------------------------------------------------------
// ラベル自動着色(2014/02/02 refactoring)
//------------------------------------------------------------
//start
function label_colorise() {
	if( location.pathname != "/card/labeling.php" ){
		return;
	}

	jQuery.noConflict();
	j$ = jQuery;
	j$("fieldset").each(function(){
		if(j$(this).find("input[checked]").val()==0){
			j$(this).find("label:has('input[checked]')").css("color","white").css("background-color","#707070");
		}else if(j$(this).find("input[checked]").val()==1){
			j$(this).find("label:has('input[checked]')").css("color","white").css("background-color","#0093c7");
		}else if(j$(this).find("input[checked]").val()==2){
			j$(this).find("label:has('input[checked]')").css("color","white").css("background-color","#67bd33");
		}else if(j$(this).find("input[checked]").val()==3){
			j$(this).find("label:has('input[checked]')").css("color","white").css("background-color","#b80102");
		}else if(j$(this).find("input[checked]").val()==4){
			j$(this).find("label:has('input[checked]')").css("color","white").css("background-color","#3130ce");
		}else if(j$(this).find("input[checked]").val()==5){
			j$(this).find("label:has('input[checked]')").css("color","white").css("background-color","#ce8e31");
		}else if(j$(this).find("input[checked]").val()==6){
			j$(this).find("label:has('input[checked]')").css("color","white").css("background-color","#ce30bd");
		}
	});
}
//end

//------------------------------------------------------------
// ブショーダスライトを先頭に複写(2014/01/26 add)
//------------------------------------------------------------
//start
function disp_bushodas_lite(){
	if( !location.pathname.match("/busyodas/busyodas.php") ){
		return;
	}
	jQuery.noConflict();
	j$ = jQuery;
	j$("div.busyodasLite").clone().insertAfter("div.busyodasHeader");
	j$("input[src*='btn_getBushodas']").clone().prependTo("div.cardWrapper").css("margin-left","10px").css("margin-bottom","10px").parent().css("margin","0px");
}
//end

//------------------------------------------------------------
// クエスト報酬自動取得(2014/01/26 add)
//------------------------------------------------------------
function disp_quest_collect() {
	jQuery.noConflict();
	j$ = jQuery;
	j$("#status img[title=名声]").next().append(
		"<span id=quest_receive style='color:white; margin-left:4px; font-size:small; color:cyan; font-weight:bold;'>"
	);
	j$("#quest_receive").hide();
	j$("#quest_receive").text("クエスト報酬受領中");

	if (location.pathname == "/quest/") {
		// 通常クエスト
		if( j$("img[alt=報酬を受け取る]").length > 0 ){
			if( j$("table[summary=報酬]").length > 0 ){
				if( j$("table[summary=報酬]").html().match(/木材|石|鉄|食料/) === null){
					// 資源報酬以外は自動受領
					j$("#quest_receive").show();
					var url = "http://" + HOST + "/quest/index.php?c=1";
					location.href = url;
				}
			}
		}
	}
}
//end

//------------------------------------------------------------
// アイテム自動取得(2014/01/26 add)
//------------------------------------------------------------
//start
function disp_item_collect() {
	jQuery.noConflict();
	j$ = jQuery;
	if (location.pathname == "/item/inbox.php" ) {
		var mode = j$("ul[id=itemInventoryTab] li:not(:has(a))").text();
		if( mode != "受信箱" ){
			return;
		}

		if( HOST.substr(0,1) == 'm' ){
			j$("#itemInventoryLeft").append("<div>" +
											"<span><input type=button id=collectAllItemAndCards value='アイテム＆カード回収'></span>" +
											"</div>");
		}
		else{
			var height = j$("#itemDetailBox").height() + parseInt(30);
			j$("#itemInventoryLeft").append("<div style='position:relative; margin-top:" + height + "px;'>" +
											"<span><input type=button id=collectAllItemAndCards value='アイテム＆カード回収'></span>" +
											"</div>");
		}
		j$("#collectAllItemAndCards").click(function(){collectAllItemAndCards();});
	}
	else if (location.pathname == "/item/index.php" || location.pathname == "/item/" ) {
		var mode = j$("ul[id=itemInventoryTab] li:not(:has(a))").text();
		if( mode != "便利アイテム" ){
			return;
		}

		if( HOST.substr(0,1) == 'm' ){
			j$("#itemInventoryLeft").append("<div>" +
											"<span><input type=button id=useAllBPCoins value='BPコイン一括取得'></span>" +
											"<span><input type=button id=useResources value='資源UP1日分使用'></span>" +
											"</div>");
		}
		else{
			var height = j$("#itemDetailBox").height() + parseInt(30);
			j$("#itemInventoryLeft").append("<div style='position:relative; margin-top:" + height + "px;'>" +
											"<span><input type=button id=useResources value='資源UP1日分使用'></span>" +
											"<span><input type=button id=useAllBPCoins value='BPコイン一括取得'></span>" +
											"</div>");
		}
		j$("#useAllBPCoins").click(function(){useAllBPCoins();});
		j$("#useResources").click(function(){useResources();});
	}

	function collectAllItemAndCards(){
		//------------------//
		// 回収可能チェック //
		//------------------//
		// 回収するカードの数をかぞえる
		var collectCardCount = 0;
		j$("section[class=iu_card] a[class=iu_open]").each(
			function(){
				collectCardCount ++;
			}
		);

		// 回収するアイテムの数をかぞえる
		var collectItemCount = 0;
		j$("#itemInventoryRight div[class^='itemIcon']").each(
			function(){
				// アイテム番号の取得
				var match = j$(this).html().match(/onclick=\"confirmItemSub\(this, *(.*), *([0-9].*),.*\)/);
				if( match != null && match[1] == '2' ){
					collectItemCount ++;
				}
			}
		);

		if( (collectCardCount + collectItemCount) == 0 ){
			alert("回収できるアイテム、武将カードはありません。");
			return;
		}

		//----------------//
		// 武将カード回収 //
		//----------------//
		j$("section[class=iu_card] a[class=iu_open]").each(
			function(){
				// カードの回収
				j$(this).click();
			}
		);
		if( collectItemCount === 0 ){
			alert("全てのアイテムを回収しました。");
			location.href = "http://" + HOST + "/item/index.php#ptop";
		}

		//--------------//
		// アイテム回収 //
		//--------------//
		// セッションID
		var ssid = j$("form[name=purchaseform] input[name=ssid]").attr("value");

		// 回収するアイテム番号
		var itemCount = 0;
		j$("#itemInventoryRight div[class^='itemIcon']").each(
			function(){
				// アイテム番号の取得
				var match = j$(this).html().match(/onclick=\"confirmItemSub\(this, *(.*), *([0-9].*),.*\)/);
				if( match != null && match[1] == '2' ){
					wrapHttpReq("http://" + HOST + "/item/inbox.php", "POST", "ssid=" + ssid + "&item_id_list=" + match[2],
						function(response) {
							itemCount++;
							if( itemCount >= collectItemCount ){
								alert("全てのアイテムを回収しました。");
								location.href = "http://" + HOST + "/item/index.php#ptop";
							}
						}
					);
				}
			}
		);
	}

	function collectAllCards(){
		// 回収するカードの数をかぞえる
		var collectCardCount = 0;
		j$("section[class=iu_card] a[class=iu_open]").each(
			function(){
				collectCardCount ++;
			}
		);
		if( collectCardCount == 0 ){
			alert("回収できる武将カードはありません。");
			return;
		}

		j$("section[class=iu_card] a[class=iu_open]").each(
			function(){
				// カードの回収
				j$(this).click();
			}
		);

		alert("全ての武将カードを回収しました。");
		location.href = "http://" + HOST + "/item/index.php#ptop";
	}

	function useAllBPCoins(){
		//------------------//
		// 取得可能チェック //
		//------------------//
		// 取得するBPコインの数をかぞえる
		var useItemCount = 0;
		j$("#itemInventoryRight div[class^='itemIcon']").each(
			function(){
				// アイテム番号の取得
				var match = j$(this).html().match(/onclick=\"return confirmItemSub\(this, *(.*), *([0-9]*),.*\)/);
				if( match != null && match[1] == '4' && (match[2] == '164' || match[2] == '165' || match[2] == '166') ){
					var match2 = j$(this).html().match(/class="item_icon_stack">([0-9].*)<\/span>/);
					useItemCount += parseInt(match2[1]);
				}
			}
		);

		if( useItemCount == 0 ){
			alert("使用できるBPコインはありません。");
			return;
		}

		//--------------//
		// BPコイン取得 //
		//--------------//
		// セッションID
		var ssid = j$("form[name=purchaseform] input[name=ssid]").attr("value");

		// 取得するアイテム番号
		var itemCount = 0;
		var totalBP = 0;
		j$("#itemInventoryRight div[class^='itemIcon']").each(
			function(){
				// アイテム番号の取得
				var match = j$(this).html().match(/onclick=\"return confirmItemSub\(this, *(.*), *([0-9]*),.*\)/);
				if( match != null && match[1] == '4' && (match[2] == '164' || match[2] == '165' || match[2] == '166') ){
					var match2 = j$(this).html().match(/class="item_icon_stack">([0-9].*)<\/span>/);
					var loopct = match2[1];
					for(var i = 0; i < loopct; i++ ){
						if( match[2] == '164' ) totalBP += 100;
						if( match[2] == '165' ) totalBP += 500;
						if( match[2] == '166' ) totalBP += 1000;
						wrapHttpReq("http://" + HOST + "/item/index.php", "POST", "ssid=" + ssid + "&item_id=" + match[2],
							function(response) {
								itemCount++;
								if( itemCount >= useItemCount ){
									alert("全てのBPコインを取得しました。BPが " + totalBP + " 増加しました。");
									location.href = "http://" + HOST + "/item/";
								}
							}
						);
					}
				}
			}
		);
	}

	function useResources(){
		//------------------//
		// 取得可能チェック //
		//------------------//
		// 使用する資源の数をかぞえる
		var useItemCount = 0;
		j$("#itemInventoryRight div[class^='itemIcon']").each(
			function(){
				// アイテム番号の取得
				var match = j$(this).html().match(/onclick=\"confirmItemSub\(this, *(.*), *([0-9].*),.*\)/);
				if( match != null && match[1] == '2' && (match[2] == '101' || match[2] == '102' || match[2] == '103' || match[2] == '104') ){
					var match2 = j$(this).html().match(/class="item_icon_stack">([0-9].*)<\/span>/);
					useItemCount ++;
				}
			}
		);

		if( useItemCount == 0 ){
			alert("使用できる資源アイテムはありません。");
			return;
		}

		if( !confirm("資源UPアイテムを1日分使いますか？") ){
			return;
		}

		//------------------//
		// 資源アイテム取得 //
		//------------------//
		// セッションID
		var ssid = j$("form[name=purchaseform] input[name=ssid]").attr("value");

		// 取得するアイテム番号
		var itemCount = 0;
		var totalBP = 0;
		j$("#itemInventoryRight div[class^='itemIcon']").each(
			function(){
				// アイテム番号の取得
				var match = j$(this).html().match(/onclick=\"confirmItemSub\(this, *(.*), *([0-9].*),.*\)/);
				if( match != null && match[1] == '2' && (match[2] == '101' || match[2] == '102' || match[2] == '103' || match[2] == '104') ){
					var match2 = j$(this).html().match(/class="item_icon_stack">([0-9].*)<\/span>/);
					wrapHttpReq("http://" + HOST + "/item/index.php", "POST", "ssid=" + ssid + "&item_id=" + match[2],
						function(response) {
							itemCount++;
							if( itemCount >= useItemCount ){
								location.href = "http://" + HOST + "/item/";
							}
						}
					);
				}
			}
		);
	}
}
//end

//------------------------------------------------------------
// 領地一覧からの領地破棄。画面遷移なしの破棄を追加(2014/02/23 add)
//------------------------------------------------------------
//start
function disp_territory_remove() {
	// 領地管理画面なら実行
	if (location.pathname != "/facility/territory_status.php" && location.pathname != "//facility/territory_status.php") {
		return;
	}

	jQuery.noConflict();
	j$ = jQuery;
	// 領地一覧検索
	j$("table[class=commonTables] tr").each(function(){
		var items = j$("th",this);
		if( items.length > 0 ){
			j$(this).append("<th class='territoryTtl'></th>");
		}
		var items = j$("td",this);
		if( items.length > 0 ){
			items.eq(2).attr("width","14px");
			items.eq(3).attr("width","30px");
			items.eq(4).attr("width","50px");
			items.eq(9).attr("width","60px");
			items.eq(10).attr("width","50px");
			var pos = items.eq(1).text().match(/^([-]*\d+),([-]*\d+)/);
			if( pos.length == 3 ){
				if( items.eq(9).text() == "-" ){
					var url = "http://" + document.location.hostname + "/territory_proc.php?x=" + pos[1] + "&y=" + pos[2] + "&mode=remove";
					var td = j$("td:last",j$(this).append("<td class='center'><a href='#'><font color='red'>破棄</font></a></td>"));
					td.bind("click",
						function() {
							wrapHttpReq(url, "GET", null,
								function(response) {
									var rmtime = response.match(/(現在領地を破棄中です)[^\d]*\n*(\d+-\d+-\d+ \d+:\d+:\d+)/ );
									if( rmtime ) {
										if( rmtime[1] == "現在領地を破棄中です" ) {
											addTerritoryList(rmtime[2], 0, pos[1], pos[2] );
										}
									}
									td.html("<font color='blue'><b>完了</b></font>");
									items.eq(9).html("<font color='red'><b>破棄開始</b></font>");
									items.eq(10).html("<font color='red'>破棄中</font>");
								}
							);
						}
					);
				}else if( items.eq(10).text() == "破棄中" ){
					var url = "http://" + document.location.hostname + "/territory_proc.php?x=" + pos[1] + "&y=" + pos[2] + "&mode=cancel";
					var td = j$("td:last",j$(this).append("<td class='center'><a href='#'><font color='red'>取消</font></a></td>"));
					td.bind("click",
						function() {
							wrapHttpReq(url, "GET", null,
								function(response) {
									delTerritoryList(0, pos[1], pos[2]);
									td.html("<font color='blue'><b>完了</b></font>");
									items.eq(9).html("<font color='red'><b>破棄中断</b></font>");
									items.eq(10).html("<font color='red'>-</font>");
								}
							);
						}
					);
				}
			} else {
				j$(this).append("<td class='center'><font color='gray'>-</font></a></td>");
			}
		}
	});
}
//end

//-------------------------------------------
// 3gokushi-etcs 2014/02/23 add
//-------------------------------------------
function disp_bro3_etcs(){
	/*
		グローバル
	*/
	var SCRIPT_VERSION = '0.33.8の抜粋';
	var SERVER_NAME = location.hostname.split('.')[0];
	var GAME_TYPE	 = location.host.split('.')[1];
	var SERVICE_TYPE = 's';									// サービスの種類(s:本鯖 h:ハンゲー m:mixi y:ヤフー f:facebook)
	var SERVER_TYPE = 0;									// サーバーのタイプ 0:[s/h/f] 1:[m/y]
	var SAVE_NAME_HEAD = "3GOKUSHI_ETCS_";
	var SAVE_NAME	= SAVE_NAME_HEAD+SERVER_NAME+"_";
	var SERVER_URI	= 'http://'+location.host;
	var PROFILE_URI = SERVER_URI+'/user/';
	var MAPMOVE_URL = SERVER_URI+'/map.php?';
	var BSYODAS_URI = SERVER_URI+'/busyodas/busyodas.php';
	var TRADE_URI	= SERVER_URI+'/card/trade.php';
	var CPITEM_URI	= SERVER_URI+'/item/shop.php';
	var NAVI_ID 	= 'gnavi';			// P・本鯖UI変更対応(2012/04/23変更)

	var DEBUG_FLG = false;

	// オプション保存
	var ETCS_OPTION = [];

	// ウインドウ関係
	var baseWinList = [];
	var baseWinListCnt = 0;
	var myToolTipList = [];
	var myToolTipListCnt = 0;

	// サーバー時間
	var serverTime = new Date();
	var EXIMG_URL  = '';

	// 保存データのデフォルト設定・使用コントロール
	var saveDefaultData = [
		["AllDelayTime","value",300],
		["MarketStockCalc","checked",true],
		["MarketStockCalcTimer","checked",true],
		["MarketCostView","checked",true],
		["MarketCostViewCalcFullTime","checked",true],
		["MarketCostViewDblClick","checked",true],
		["MarketStockPreset","checked",true],
		["MarketCostViewTimer","checked",true],
		["checkClassCost","checked",true],
		["checkClassCostPer","value",40],
		["MapDragPosMove","checked",true],
		["MapDragPosMovex51","checked",true],
		["InputStrLen_Chat","checked",true],
		["InputStrLen_BBS","checked",true],
		["InputStrLen_PersonBBS","checked",true],
		["InputStrLen_Mail","checked",true],
		["JumpURIFromClickCard","checked",true],
		["JumpURIFromClickCardNoURI","value",""],
		["cardRightClickSkill","checked",true],
		["cardRightClickSkillURL","value",""],
		["cardRightClickSkillCSV","value",""],
		["cardRightClickSkillNewTab","checked",true],
		["viewSellCardFees","checked",true],
		["listViewSellCardFees","checked",true],
		["carDmgCalc","checked",true],
		["retDateOnSendTroop","checked",true],
		["retDateOnSendTroop_ForceServerLoad","checked",false],		// 鯖に負担をかけないようにデフォはOFF
		["deckToDomestic","checked",true],
		["deckPagerUpperClone","checked",true],
		["AlertOfBuyTradeTime_Bid","checked",true],
		["AlertOfBuyTradeTime_List","checked",true],
		["viewDeckCostFree","checked",true],
		["viewDeckCostFreeType","radio","1"],
		["addRTradeSortLink","checked",true],
		["makeDisSolMax","checked",true],
		["AccommodationFree","checked",true],
		["AccommodationFreeType","radio","1"],
		["copyTitleInBBSTitle","checked",true],
		["donationResourceView","checked",true],
	];

	// GAME別用語置き換え
	var gameTermsList = {
		"3gokushi" : {
			"君主"		 : "君主",
			"木"		 : "木",
			"石"		 : "石",
			"鉄"		 : "鉄",
			"糧"		 : "糧",
			"木s"		 : "木",
			"石s"		 : "石",
			"鉄s"		 : "鉄",
			"糧s"		 : "糧",
			"市場"		 : "市場",
			"訓練所"	 : "訓練所",
			"遠征訓練所" : "遠征訓練所",
			"鍛冶場"	 : "鍛冶場",
			"防具工場"	 : "防具工場",
			"研究所"	 : "研究所",
			"練兵所"	 : "練兵所",
			"兵舎"		 : "兵舎",
			"弓兵舎"	 : "弓兵舎",
			"厩舎"		 : "厩舎",
			"兵器工房"	 : "兵器工房",
			"兵士管理"	 : "兵士管理",
			"出兵先"	 : "出兵先",
			"出兵元"	 : "出兵元",
			"衝車"		 : "衝車",
			"投石機"	 : "投石機",
			'剣兵'		 : '剣兵',
			'斥候'		 : '斥候',
			'槍兵'		 : '槍兵',
			'弓兵'		 : '弓兵',
			'騎兵'		 : '騎兵',
			'矛槍兵'	 : '矛槍兵',
			'弩兵'		 : '弩兵',
			'近衛騎兵'	 : '近衛騎兵',
			'斥候騎兵'	 : '斥候騎兵',
			'大剣兵'	 : '大剣兵',
			'盾兵'		 : '盾兵',
			'重盾兵'	 : '重盾兵'
		}
	};
	var GAME_TERMS;


	// ========================
	//		 メイン関数
	// ========================

		Init();
		GM_init();				// Chrome対策

		EtcsSetting_Load();	// 設定ロード
		EtcsSetting_Insert();		// 設定画面(タイマーで呼ばない。タイマーの値が大きくなると再設定が難しくなる)

		setTimeout(function() {
			serverTime = getNowTime();		// 時間取得
			getCommon();			// プロフィール読み込み
			setEvent_chkInputStrLen();												// 文字数表示(ON/OFFは中で)
			if(ETCS_OPTION['MarketStockPreset'])		MarketStockPreset();
			if(ETCS_OPTION['MarketStockCalc'])			initMarketStockCalc();
			initMapDrag();
			if(ETCS_OPTION['JumpURIFromClickCard'] || ETCS_OPTION['cardRightClickSkill'])	jumpURIFromClickCardNo();
			if(ETCS_OPTION['viewSellCardFees'])			initViewSellCardFees();		// カード手数料
			if(ETCS_OPTION['listViewSellCardFees'])		listViewSellCardFees();
			if(ETCS_OPTION['retDateOnSendTroop'])		returnDateOnCastleSendTroop();
			if(ETCS_OPTION['addRTradeSortLink'])		addRTradeSortLink();
			if(ETCS_OPTION['viewDeckCostFree'])			viewDeckCostFree();

			AlertOfBuyTradeTime();													// ON/OFFは中で
			if(ETCS_OPTION['carDmgCalc'])				carDmgCalc();
			if(ETCS_OPTION['deckToDomestic'])			deckToDomestic();
			if(ETCS_OPTION['MarketCostView'])			initMarketCostView();
			if(ETCS_OPTION['checkClassCost'])			checkClassCost();
			if(ETCS_OPTION['copyTitleInBBSTitle'])		copyTitleInBBSTitle();
			if(ETCS_OPTION['makeDisSolMax'])			makeDisSolMax();
			if(ETCS_OPTION['deckPagerUpperClone'])		deckPagerUpperClone();
			if(ETCS_OPTION['donationResourceView'])		donationResourceView();


		},ETCS_OPTION['AllDelayTime']);

		// CSS
		(function() {
			var cssstr =
	// BaseWindow
			'div.etcsBaseWindow { position:absolute; top:3px; left:0px; border:1px solid #000000; color:#000000; background : none repeat scroll 0 0 #ffffff; z-index : 10010; box-shadow : 3px 3px rgba(0,0,0,0.4); border-radius : 9px 9px 9px 9px / 9px 9px 9px 9px; overflow : auto;}'+
			'div.etcsBaseWindow > div:nth-child(1) { position:relative; top:0px; left:0px; width:100%; height:1.4em; margin:0; padding:0; color:#ffffff; background : none repeat scroll 0 0 #0000d6; z-index : 10011; box-shadow : 0px 2px rgba(0,0,0,0.4);text-shadow : 1px 1px rgba(0,0,0,0.4); overflow : hidden; cursor:default; text-align:center; font:bold 1em;  border-radius : 9px 9px 0px 0px / 9px 9px 0px 0px;}'+
			'div.etcsBaseWindow > div:nth-child(2) { margin:0; padding:14px; color:#000000; background : none repeat scroll 0 0 transpaint; z-index : 10011;  overflow : auto; border-radius : 0px 0px 9px 9px / 0px 0px 9px 9px; resize:both; }'+
			'div.etcsBaseWindow a { color:#000000; }'+
			'div.etcsBaseWindow a:hover{ color:#ffffff; background-color:#000000; text-decoration:underline; }'+
			'div.etcsBaseWindow dt { margin-top:0.5em; margin-bottom:0.3em;}'+
			'div.etcsBaseWindow dd { margin-top:0.2em; margin-bottom:0.2em;}'+
			'div.etcsBaseWindow ii { margin-top:0.2em; margin-bottom:0.2em;}'+
			'div.etcsBaseWindow table { border:1px solid #000000;}'+
			'div.etcsBaseWindow table th,div.etcsBaseWindow table td { padding:2px; text-align:center; border:1px solid #000000;}'+
			'div.etcsBaseWindow table th { background:none #fff2bb;}'+
			'div.etcsBaseWindow table td { background:none #ffffff;}'+
	// ToolTip
			'div.etcs_mytooltip {'+
				'position: absolute; background:none repeat scroll #ffffcc; border:1px solid #000000; '+
				'padding: 3px;border-radius:3px; box-shadow:2px 4px rgba(0,0,0,0.4); z-index : 10010;'+
			'}'+

	// 市場で取引状態を仮算出
			'table.etcs_market_table { border:1px solid #000000;min-width:280px; margin:0.5em auto;}'+
			'table.etcs_market_table thead th { border : 1px solid #000000; text-align:center; min-width:50px;}'+
			'table.etcs_market_table tbody th { border : 1px solid #000000; text-align:center; background-color:#000000; color:#ffffff; padding:0.3em;}'+
			'table.etcs_market_table thead th:nth-child(2) {background-color:#ffe683; color:#000000;}'+
			'table.etcs_market_table thead th:nth-child(3) {background-color:#e9e9e9; color:#000000;}'+
			'table.etcs_market_table thead th:nth-child(4) {background-color:#f4c6ff; color:#000000;}'+
			'table.etcs_market_table thead th:nth-child(5) {background-color:#ffffc2; color:#000000;}'+
			'table.etcs_market_table tbody td { border : 1px solid #000000; text-align:center; padding:5px;}'+

	// コストビュー
			'div#etcs_costview	{ border:1px solid #000000; padding:1em;}'+
			'div#etcs_costview > div { margin:0 auto;}'+
			'div#etcs_costview table.etcs_market_table tbody th { min-width:120px; }'+
			'div#etcs_costview table.etcs_market_table tbody th { min-width:120px; }'+
			'div#etcs_sidebar_costview table.etcs_market_table { background-color:#ffffff;}'+
			'div#etcs_sidebar_costview table.etcs_market_table thead th:nth-child(1) { display:none; padding:0;}'+
			'div#etcs_sidebar_costview table.etcs_market_table tbody th { display:none; padding:0;}'+
			'div#etcs_sidebar_costview table.etcs_market_table td { padding:0;}'+

	// 資源プリセット
			'div#etcs_stockPreset {position:absolute; border:1px solid #000000; padding:4px; box-shadow : 3px 3px rgba(0,0,0,0.4); border-radius : 3px;}'+
			'div#etcs_stockPreset h3 { border:1px solid #000000; background:#cccccc; margin:1px; text-align:center;}'+


	// 手数料表示
			'span.etcs_sellcardlistfees { font-size:80%; font-weight:normal; color:#ff6666; display:block;}'+
	// 文字数表示
			'div#comment_str_etcsChkLen { position:absolute; top:4px; left:458px; color:#ffffff; font-size:80%;}'+
			'span.bbsres_view_etcsChkLenCss { font-size:80%; }'+

	// 設定ウインドウ
			'#etcs-setting { padding:1em; background:transparent;}'+
			'#etcs-setting dl > dt { padding:0.1em 0.1em 0.1em 0.5em; font-size:1.1em;font-weight:bold; color:#000000; background-color:#eeeeff;}'+
			'#etcs-setting dl > dd { margin:0.3em 1em; }'+
			'#etcs-setting dl > dd > dl { margin-left:1em;}'+
			'#etcs-setting dl > dd > dl > dd { margin:0.3em 1em; }'+
			'#etcs-setting dl .etcs-setting_sub { margin:0.3em 2em; } '+
			'#etcs-setting dl .etcs-setting_sub2 { margin:0.3em 4em 1em; } '+
			'#etcsopt_tab ul:after { content:""; clear:both; overflow:hidden; display:block; }'+
			'#etcsopt_tab ul { margin: 0px auto; width:425px; }'+
			'#etcsopt_tab li { border:2px solid #000000; text-align:center; padding:auto; float:left; width:100px; height:24px; boder:1px solid #ffffff; line-height:24px;}'+
			'#etcsopt_tab li:hover { border:2px inset #000000;}'+
	// オフィシャルロールオーバー修正
			'#menu_container { z-index : 9801; }'+

			'';

			GM_addStyle(cssstr);
		})();
	// =============================
	//			 初期化
	// =============================
	function Init() {

		// GAME/サーバーチェック
		if(SERVER_NAME.match(/(.)\d+/)) {
			var kindData = {
				"3gokushi" : { 's':0, 'm':1, 'y':1, 'h':0 ,'f':0, 'p':0 }
			};
			SERVICE_TYPE = RegExp.$1;
			SERVER_TYPE  = kindData[GAME_TYPE][SERVICE_TYPE];
			if(typeof SERVER_TYPE == 'undefined') {
				GAME_TYPE = '3gokushi';
				console.log("このゲームは未対応");
			}
			GAME_TERMS	 = gameTermsList[GAME_TYPE];

			if(GAME_TYPE != "3gokushi") {
				SAVE_NAME = SAVE_NAME_HEAD+SERVER_NAME+"_"+GAME_TYPE+"_"		// ブラ三じゃ無いときのセーブデータ先
			}
			if(typeof SERVER_TYPE == 'undefined') SERVER_TYPE = 0;
		}

		// ゲーム画像基本URL取得
		EXIMG_URL = '/20120807-01/extend_project/w945';
		var img   = document.getElementsByTagName('img');
		for(var i = 0;i < img.length; i++ ) {
			if(img[i].getAttribute('src').match(/(.*?\/\d+\-\d+\/extend_project\/.*?\/)/)) {
				EXIMG_URL = RegExp.$1;
				break;
			}
		}

		// 旧タイプチェック
		if(document.getElementById('gNav') != null) {
			NAVI_ID = 'gNav';
		}
	}

	// =============================
	//			 共通取得
	// =============================
	function getCommon() {

		var population,vpos;
		var cnt;
		var saveData;
		var trnode,tdnode;

		/*
			プロフィール画面
		*/
		if(location.pathname == '/user/') {
			// 他君主との区分け
			var node = document.querySelector('#gray02Wrapper h2');
			if(node == null || node.textContent != "プロフィール") return;

			// 自分の情報取得
			saveData = [];
			tdnode = getNodeXPath('id("gray02Wrapper")/table[@class="commonTables"]//tr/td[preceding-sibling::td[contains(text(),GAME_TERMS["君主"])]]');
			saveData['name'] = tdnode[0].textContent.trim();
			tdnode = getNodeXPath('id("gray02Wrapper")/table[@class="commonTables"]//a[contains(text(),"個人掲示板")]');
			saveData['id']	 = tdnode[0].getAttribute('href').replace(/.+user_id=(\d+).*/,"$1");

			// 村リスト取得
			trnode = getNodeXPath('id("gray02Wrapper")/table[@class="commonTables"]//tr[preceding-sibling::tr[th[1]/text() = "名前"] and preceding-sibling::tr[th[1]/text() = "国情報"]]');

			if(trnode.length == 0) { return; }	// 念のため

			cnt = 0;
			for(var i = 0;i < trnode.length;i++) {
				tdnode = trnode[i].getElementsByTagName('td');
				if(tdnode.length == 0) continue;

				saveData = [];

				// 人口を取得し拠点と領地の判別をする
				if(tdnode[2].textContent.match(/(\d+)/)) {
					population = parseInt(RegExp.$1);
				} else {
					break;
				}
				if(isNaN(population)) break;		// 領地

				// 拠点名・拠点ID取得
				node = tdnode[0].getElementsByTagName('a');
				if(!node[0].getAttribute('href').match(/village_id=(\d+)/)) continue;
				saveData[0] = RegExp.$1;
				saveData[3] = node[0].textContent.trim();

				// 座標取得
				vpos = tdnode[1].textContent;
				if(vpos.match(/(\-?\d+)\,(\-?\d+)/)) {
					saveData[1] = RegExp.$1;
					saveData[2] = RegExp.$2;
				} else {
					trnode = trnode.nextSibling;
					continue;	// 取得失敗は保存しない
				}

				GM_setValue(SAVE_NAME+"COMMON_VILLAGEID_"+cnt,saveData.join("\t"));
				cnt++;
			}
			GM_setValue(SAVE_NAME+"COMMON_VILLAGEID_NUM",cnt);
		}
		/*
			拠点画面
		*/

		else if(location.pathname == '/village.php') {
			AccommodationFree();

			var area = document.querySelectorAll('#mapOverlayMap area');
			for(var i = 0;i < area.length;i++) {
				// 遠征・訓練所レベルを保存
				var data = area[i].getAttribute('alt').match(/^\s*(.+?)(?:\s+LV.([0-9]+))?\s*$/);
				if(data == null) continue;

				if(typeof data[2] == 'undefined') data[2] = 0;
				if(data[1] == GAME_TERMS['訓練所']) {
					saveVillageData('trainingScool',parseInt(data[2],10));
				} else if(data[1] == GAME_TERMS['遠征訓練所']) {
					saveVillageData('trainingScoolEx',parseInt(data[2],10));
				} else if(data[1] == GAME_TERMS['鍛冶場']) {
					saveVillageData('Smithery',parseInt(data[2],10));
				} else if(data[1] == GAME_TERMS['防具工場']) {
					saveVillageData('protector',parseInt(data[2],10));
				}
			}
		}
	}
	/*
		保存していた拠点リストからIDを指定して、対象の拠点情報を取得
		(ID未指定時、現在の拠点)

		0:ID 1:X 2:Y 3:拠点名
	*/
	function getVillageDataFromID( vID ) {
		var vIDNum,vIDstr,vID,fx,fy;
		var vxy = [];

		if(typeof vID == 'undefined') {
			vID = getVillageID();
			if(vID == -1) return null;
		}

		vIDNum = GM_getValue(SAVE_NAME+"COMMON_VILLAGEID_NUM");
		for(i = 0; i < vIDNum; i++) {
			vIDstr = GM_getValue(SAVE_NAME+"COMMON_VILLAGEID_"+i).split('\t');
			fvID   = parseInt(vIDstr[0]);
			if(fvID == vID) {
				vxy[0] = fvID;
				vxy[1] = parseInt(vIDstr[1]);
				vxy[2] = parseInt(vIDstr[2]);
				vxy[3] = vIDstr[3];
				return(vxy);
			}
		}

		return(null);
	}


	/*
		拠点の座標から、対象の拠点IDを取得
		(ID未指定時、現在の拠点)
	*/
	function getVillageID( vx, vy ) {

		var vIDNum,base_node,vIDstr,vID,fx,fy,vxy;
		var i,j;

		// 座標が指定されていない時は、現在の拠点を対象に
		if((typeof vx == 'undefined') || (typeof vy == 'undefined')) {
			vxy  = getNowVillagePos();
			if(vxy == null) return -1;
		} else {
			vxy = [ vx, vy ];
		}

		vID    = -1;
		vIDNum = GM_getValue(SAVE_NAME+"COMMON_VILLAGEID_NUM");
		for(i = 0; i < vIDNum; i++) {
			vIDstr = GM_getValue(SAVE_NAME+"COMMON_VILLAGEID_"+i).split('\t');
			fx	   = parseInt(vIDstr[1]);
			fy	   = parseInt(vIDstr[2]);
			if(vxy[0] == fx && vxy[1] == fy) {
				vID = vIDstr[0];
				break;
			}
		}
		return vID;
	}
	/*
		『サイドバーの拠点』から対象の拠点のIDを取得
	*/
	function getVIDFromSidebar( posx, posy ) {

		var base_node,node;
		var i;
		var href,title,vx,vy;

		// 現在の村チェック
		if(SERVER_TYPE == 1) {
			base_node = getNodeXPath('//div[@id="lodgment"]/div[@class="floatInner"]')[0].parentNode;
		} else {
			base_node = getNodeXPath('//div[@class="sideBox"]/div[@class="sideBoxHead"][h3/strong/text()="拠点"]')[0].parentNode;
		}
		node	  = getNodeXPath('*/ul/li/*[1]',base_node);

		for(i = 0;i < node.length;i++) {
			// 拠点座標取得
			title = node[i].getAttribute('title');
			if(title.match(/(.+)\s+\((\-?\d+)\,(\-?\d+)\)/)) {
				vx = parseInt(RegExp.$2);
				vy = parseInt(RegExp.$3);
				if((vx == posx) && (vy == posy)) {
					// ID取得
					href  = node[i].getAttribute('href');
					if(href == null) {
						return -1;
					}
					if(href.match(/village_id=(\d+)/)) {
						return(parseInt(RegExp.$1));
					}
				}
			}
		}
		return(-1);
	}
	/*
		現在の拠点の座標を取得
	*/
	function getNowVillagePos() {

		var base_node,node;
		var i;
		var title,vp = [];

		// mixi
		if(SERVER_TYPE == 1) {
			node = getNodeXPath('//div[@id="lodgment"]/div[@class="floatInner"]');
			if(node.length == 0) {
				// 拠点リストがない(施設画面など)時は、全体地図タブから座標を取得
				base_node = getNodeXPath('//div[@id="'+NAVI_ID+'"]//li[@class="gnavi02"]/a');
				vp		  = getPosFromURI(base_node[0].getAttribute('href'));
				return(vp);

			} else {
				base_node = node[0].parentNode;
				node	  = getNodeXPath('*/ul/li[@class="on"]/*[1]',base_node)[0];
			}
		} else {
			// 本鯖
			base_node = getNodeXPath('//div[@class="sideBox"]/div[@class="sideBoxHead"][h3/strong/text()="拠点"]')[0].parentNode;
			node	  = getNodeXPath('*/ul/li[@class="on"]/*[1]',base_node)[0];
		}

		// 拠点座標取得
		title = node.getAttribute('title');
		if(title.match(/(.+)\s+\((\-?\d+)\,(\-?\d+)\)/)) {
			vp[0] = parseInt(RegExp.$2);
			vp[1] = parseInt(RegExp.$3);
			return(vp);
		}
		return(null);
	}
	/*
		URLから座標を取得 x=??&y=??形式

		uri:URI
		返値: 座標(x,y)の配列 [0]=x [1]=y
	*/
	function getPosFromURI( uri ) {

		var xy = [-1,-1];

		if(uri.match(/x=(\-?\d+)/)) {
			xy[0] = parseInt(RegExp.$1);
		}
		if(uri.match(/y=(\-?\d+)/)) {
			xy[1] = parseInt(RegExp.$1);
		}

		return xy;
	}


	//=================================================
	//	兵数の空き計算表示・取得
	//=================================================
	function AccommodationFree() {

		var solNow	= 0;
		var solMax	= 0;
		var stNode = document.querySelector('#basepoint div.status');

		if(stNode != null) {
			var text = stNode.textContent.replace(/\r|\n/,"");
			if(text.match(/(\d+)\/(\d+)/)) {
				solNow = RegExp.$1;
				solMax = RegExp.$2;
			}
		}

		if((ETCS_OPTION['AccommodationFree']) && (ETCS_OPTION['AccommodationFreeType'] == "1")) {
			var acFreeNode = stNode.parentNode.appendChild(document.createElement('span'));
			acFreeNode.textContent += "("+(solMax-solNow)+")";
			acFreeNode.style.cssText = 'position:absolute; top:0px; left:0px; color:#ffffff; font-size:77%;';
			acFreeNode.style.top  = (stNode.offsetTop +5) + 'px';
			acFreeNode.style.left = (stNode.offsetWidth + stNode.offsetLeft - acFreeNode.offsetWidth - 2) + 'px';

			var width = (acFreeNode.offsetWidth + 4);
			if(solMax >= 10000 || solNow >= 10000) {
				width = width > 30 ? 30 : width;
			}
			stNode.style.paddingLeft  = width + 'px';
			stNode.style.paddingRight = (acFreeNode.offsetWidth + 4) + 'px';
		}

		if((ETCS_OPTION['AccommodationFree']) && (ETCS_OPTION['AccommodationFreeType'] == "0")) {
			stNode.parentNode.setAttribute('title','宿舎空き：'+(solMax-solNow));
		}

		saveVillageData('AccommodationFree',solMax-solNow);

	}

	//=================================================
	//	デッキコストの残りを表示
	//=================================================
	function viewDeckCostFree() {
		var deckcost = document.querySelector('.rightTitle p.deckcost');
		if(deckcost == null) return;

		var size = deckcost.textContent.match(/(\d+(\.\d+)?)\s*\/\s*(\d+(\.\d+)?)/);
		if(size == null) return;

		if(ETCS_OPTION['viewDeckCostFreeType'] == "0") {
			deckcost.setAttribute('title','残り：'+(+size[3] - +size[1]));
		} else {
			var freeview = deckcost.appendChild(document.createElement('span'));
			freeview.textContent   = '('+(+size[3] - +size[1])+')';
			freeview.style.cssText = 'font-size:75%;font-weight:normal;';
			deckcost.style.width   = 'auto';
			deckcost.style.padding = '0 4px';
			deckcost.style.minWidth = '90px';
		}
	}

	//=================================================
	//	カードNo.をクリックしたら、指定URLに飛ぶ
	//=================================================
	/*
		初期化とか
	*/
	function jumpURIFromClickCardNo() {

		var i,j;

		var xPathData = [
			[	// 武将図鑑(リスト)
				1,
				'//div[@id="busyobook-scroll"]//li[@class="busyo-list-item" or @class="busyo-list-item even-number"] ',
				'.',
				'.//span[@class="cardno"]',
				'.//span[@class="name"]',
				null,
			],
			[	// 武将図鑑(単体)
				1,
				'//div[@id="busyobook-scroll"]//div[contains(@class,"busyo-card")]',
				'.',
				'.//span[@class="cardno"]',
				'.//span[@class="name"]/text()',
				'.//span[contains(@class,"skillName")]',	// スキル名
			],
			[	// カード取得
				1,
				'//div[@class="result" and preceding-sibling::h2/text() = "取得したカード"]',
				'.',
				'.//span[@class="cardno"]',
				'.//span[@class="name"]/text()',
				'.//span[contains(@class,"skillName")]',	// スキル名
			],
			[	// トレード
				1,
				'//div[@class="cardWrapper2col" and preceding::h2/text() = "トレード"]',
				'.',
				'.//span[@class="cardno"]',
				'.//span[@class="name"]/text()',
				'.//span[contains(@class,"skillName")]',	// スキル名
			],
			[	// x枚表示
				0,
				'//div[@id="file-1"]//div[contains(@class,"statusDetail")]',
				'.//div[@class="illustMini"]//img | .//tbody/tr/td[preceding-sibling::th[text() = "ID"]][1]',
				'.//tbody/tr/td[preceding-sibling::th[text() = "ID"]][1]',
				'.//tbody/tr/td[preceding-sibling::th[text() = "名前"]][1]/text()',
				'.//tbody/tr/td[preceding-sibling::th[contains(text(),"スキル")]][1]',
			],
			[	// デッキ
				0,
				'//div[@class="cardColmn"]',	// ベースになるノード
				'.',							// 右クリックできるノード
				'.//span[@class="cardno"]',		// カードID番号のノード
				'.//span[@class="name" or @class="card_front_name"]/text() | .//span[@class="name" or @class="card_front_name"]/img/@title', //名前のノード
				'.//span[contains(@class,"skillName")]',	// スキル名
			],
			[	// ウインドウ
				0,
				'//div[@class="cardWrapper2col"]',
				'.',
				'.//span[@class="cardno"]',
				'.//span[@class="name" or @class="card_front_name"]/text() | .//span[@class="name" or @class="card_front_name"]/img/@title',
				'.//span[contains(@class,"skillName")]',	// スキル名
			],
		];
		var clickNode = [];
		var card;

		// クリックするノード設定
		for(i in xPathData) {
			card = getNodeXPath(xPathData[i][1]);
			for(j in card) {
				clickNode.push([ card[j], xPathData[i][2] , xPathData[i][3],xPathData[i][4],xPathData[i][5] ]);
			}
			//console.log("XPATH["+i+"]:"+card.length);
			if(card.length > 0 && xPathData[i][0] > 0) {	// 重複してイベントを付加しないとき
				break;
			}
		}

		// イベント付加
		for(i in clickNode) {
			(function( data ) {
				var rClickNode = getNodeXPath(data[1],data[0]);
				var cardNoNode = getNodeXPath(data[2],data[0])[0];
				if(typeof cardNoNode == 'undefined') return;
				var cardno = cardNoNode.textContent.match(/\d+/);
				var url    = ETCS_OPTION['JumpURIFromClickCardNoURI'].replace(/%%NO%%/,cardno);

				// カードの名前取得
				var name   = getNodeXPath(data[3],data[0]);
				if(name.length > 0) name = name[0].textContent;



				var skill  = null;
				var tmp;
				if(data[4] != null){
					tmp  = getNodeXPath(data[4],data[0]);
					if(tmp.length != 0) {
						skill = [];
						for(j in tmp) {
							if(tmp[j].textContent.match(/^(.+\:)?(.+)LV/))
								skill.push(RegExp.$2);
						}
					}
				}


				// カーソル(in)
				cardNoNode.addEventListener('mouseover', function() {
					cardNoNode.style.cursor = 'help';
				},false);
				// カーソル(out)
				cardNoNode.addEventListener('mouseout', function() {
					cardNoNode.style.cursor = '';
				},false);

				// カードNo.左クリック
				if(ETCS_OPTION['JumpURIFromClickCard'] && url != "") {
					cardNoNode.addEventListener('click', function() {
							window.open(url);
						}, false);
				}

				// 右クリック
				if(ETCS_OPTION['cardRightClickSkill']) {
					for(j in rClickNode) {
						rClickNode[j].addEventListener('contextmenu',function( event ) {
							RightClickCardNo( event , cardno , name , skill);
							event.preventDefault();
						},false);
					}
				}

				cardNoNode.style.zIndex = "20";		// 合成でクリックできない対策
			})( clickNode[i] );
		}
	}
	/*
		右クリックメニュー
	*/
	function RightClickCardNo( event , cardno , name , skill ) {


		var menuName = [
			['カードNo.%%NO%%でURLを開く',ETCS_OPTION['JumpURIFromClickCardNoURI']],
			['カードNo.%%NO%%でトレードを開く',TRADE_URI+'?t=no&k=%%NO%%'],
			['武将名『 %%NAME%% 』でトレードを開く',TRADE_URI+'?t=name&k=%%NAME%%'],
		];

		// CSV分解
		var list = ETCS_OPTION['cardRightClickSkillCSV'].split(/\r\n|\r|\n/);

		// IDリストにあればメニューに追加する
		var skillList = [];
		for(i in list) {
			var tmp = list[i].split(/\t|,/);
			if(tmp.length != 2) continue;
			skillList.push([tmp[0] , tmp[1]]);
		}

		for(i in skill) {
			tmp = "";
			for(j in skillList) {
				if(skillList[j][1] == skill[i]) {
					tmp = skillList[j][0];
					break;
				}
			}
			// SkillをURLで開く
			if(ETCS_OPTION['cardRightClickSkillURL'] != '') {
				var url = ETCS_OPTION['cardRightClickSkillURL'];
				url = url.replace(/%%ID%%/,tmp);
				url = url.replace(/%%SKILL%%/,skill[i]);
				menuName.push( [
					'スキル『 '+skill[i]+' 』をURLで開く',
					url,
				]);
			}
			menuName.push( [
				'スキル『 '+skill[i]+' 』でトレードを開く',
				TRADE_URI+'?t=skill&k='+skill[i],
			]);
		}


		for( i in menuName ){
			menuName[i][1] = menuName[i][1].replace(/%%NAME%%/,name);
			menuName[i][1] = menuName[i][1].replace(/%%NO%%/,cardno);
			menuName[i][0] = menuName[i][0].replace(/%%NAME%%/,name);
			menuName[i][0] = menuName[i][0].replace(/%%NO%%/,cardno);
		}

		var baseWin  =	new baseWindow('','cardrightclick');
		var listNode = document.createElement('ul');
		baseWin.addContent(listNode);


		for(i = 0;i < menuName.length;i++) {
			node = document.createElement('li');

			if(menuName[i][1] == '') continue;
			node.innerHTML = '<a href="'+menuName[i][1]+'"'+(ETCS_OPTION['cardRightClickSkillNewTab'] ? ' target="_blank"' : '')+ '>'+menuName[i][0]+'</a>';
			listNode.appendChild(node);
		}

		baseWin.titleBar.style.display = 'none';
		baseWin.contentNode.style.resize = 'none';
		baseWin.disp(true);
		baseWin.nearPosMouse( event );

		// ウインドウ外をクリックor移動したら閉じる
		var outclick = function ( event ) {
			if(event.type == 'mouseout') {
				var node = event.relatedTarget;
				while(node != null) {
					if(node == event.currentTarget) return;
					node = node.parentNode;
				}
				event.stopPropagation();
			}
			baseWin.close();
		};
		document.addEventListener('click', outclick, false);
		baseWin.winNode.addEventListener('mouseout', outclick,false);

		baseWin.closeProc = function() {
			document.removeEventListener('click', outclick, false);
			baseWin.winNode.addEventListener('mouseout', outclick,false);
			return true;
		}
	}

	// ==============================
	//	   カード出品手数料表示
	// ==============================
	/*
		手数料の計算
	*/
	function calcSellCardFees( price ) {

		var fees = 0;

		price = isNaN(price) ? 0 : parseInt(price,10);	// 数値に変換できないとき対策

		fees += price > 1000 ? (price - 1000) : 0;		// 第二段階
		fees += price >  500 ? (price -  500) : 0;		// 第一段階
		fees += price;									// 基本
		fees  = parseInt(fees / 10,10);

		return fees;
	}
	/*
		出品画面で手数料を表示(初期化)
	*/
	function initViewSellCardFees() {


		/* 出品表示画面 */
		if(location.pathname != '/card/exhibit_confirm.php') return;

		// ノード作成
		var inputnode = getNodeXPath('//form[@name="exec_exhibit_form"]//input[@name="exhibit_price"]')[0];
		var basenode  = getNodeXPath('//form[@name="exec_exhibit_form"]/./following-sibling::*[position()=1]')[0];
		var divnode   = document.createElement('div');
		basenode.parentNode.insertBefore(divnode,basenode);
		with(divnode.style) {
			background = 'none #ffffff';
			textAlign  = 'center';
			color	   = '#666666';
			padding    = '4px';
		}

		// イベント
		inputnode.addEventListener('keyup', function() {
			viewSellCardFees( divnode, inputnode );
		}, false);
		inputnode.addEventListener('change', function() {
			viewSellCardFees( divnode, inputnode );
		}, false);
		viewSellCardFees( divnode, inputnode );
	}
	/*
		出品画面で手数料を表示
	*/
	function viewSellCardFees( node , inputnode ) {

		var price = inputnode.value;
		var fees , result;

		fees	= isNaN(price) || price == '' ? '---' : calcSellCardFees( price );
		result	= isNaN(price - fees)		  ? '---' : price - fees;

		node.innerHTML = '[落札時] 手数料 : <span style="font-weight:bold;">'+(fees+'').replace(/(\d)(?=(\d\d\d)+$)/g,'$1,')+'</span> TP / 受取額 : <span style="font-weight:bold;">'+(result+'').replace(/(\d)(?=(\d\d\d)+$)/g,'$1,')+'</span> TP';
	}
	/*
		出品中のカードで手数料表示
	*/
	function listViewSellCardFees() {

		if(location.pathname != '/card/exhibit_list.php') return;

		var price,fees,node;
		var i;
		var askPriceRow,maxPriceRow;

		// 列探索
		var tnode =getNodeXPath('//table[@class="tradeTables"]//tr[contains(@class,"tradeSell")]/th');
		for(i = 0;i < tnode.length;i++) {
			if(tnode[i].textContent.match(/落札希望価格/)) {
				askPriceRow = i;
				continue;
			}
			if(tnode[i].textContent.match(/最大入札TP/)) {
				maxPriceRow = i;
				continue;
			}
		}

		// 列：出品中のカード
		tnode = getNodeXPath('//table[@class="tradeTables"]//td[@class="tp" or @class="trade"]');
		tnode.forEach(function( nodeptr ) {

			if((nodeptr.getAttribute('class') == 'tp') && (nodeptr.cellIndex == askPriceRow)){

				price = nodeptr.textContent.replace(/^\s+|\s+$/g,'');
				price = price.toString().replace(/,/,'');
				fees  = calcSellCardFees(price);

				nodeptr.setAttribute('title','手数料: '+(fees+'').replace(/(\d)(?=(\d\d\d)+$)/g,'$1,')+
									' TP 受取額: '+((price - fees)+'').replace(/(\d)(?=(\d\d\d)+$)/g,'$1,')+' TP');
				node   = document.createElement('span');
				node   .setAttribute('class','etcs_sellcardlistfees');
				node   .appendChild(document.createTextNode('('+(fees+'').replace(/(\d)(?=(\d\d\d)+$)/g,'$1,')+')'));
				nodeptr.appendChild(node);
				return;
			}
			// 列：最大入札TP
			if((nodeptr.getAttribute('class') == 'trade') && (nodeptr.cellIndex == maxPriceRow)) {

				if(nodeptr.textContent.match(/取消/)) return;		// 未入札
				node   = getNodeXPath('span[contains(@class,"notice")]',nodeptr);	//より厳密にチェック
				if(node.length == 0) return;
				price  = node[0].textContent.replace(/^\s+|\s+$/g,'');
				price  = price.toString().replace(/,/,'');
				if(isNaN(price)) return;
				price  = parseInt(price,10);
				fees   = calcSellCardFees(price);
				nodeptr.setAttribute('title','手数料: '+(fees+'').replace(/(\d)(?=(\d\d\d)+$)/g,'$1,')+
								' TP 受取額: '+((price - fees)+'').replace(/(\d)(?=(\d\d\d)+$)/g,'$1,')+' TP');
				node   = document.createElement('span');
				nodeptr.appendChild(node);

				node.setAttribute('class','etcs_sellcardlistfees');
				node.appendChild(document.createTextNode('('+fees+')'));
			}
		});
	}
	// ==============================
	//		  トレード日時警告
	// ==============================
	/*
		初期化
	*/
	function AlertOfBuyTradeTime() {

		var node,tradeDate,diffTime,newNode;

		if((location.pathname == '/card/trade_bid.php') && ETCS_OPTION['AlertOfBuyTradeTime_Bid']) {

			// 日時分解
			node = getNodeXPath('//div[@class="tradeInfo"]/div[2]/span[@class="notice"]');
			if(node.length == 0) return;		// 即札可

			tradeDate = cnvMDateStrToDate(node[0].textContent);
			diffTime  = tradeDate.getTime() - serverTime.getTime();

			// 24時間以上経過の場合注意喚起
			if(diffTime >= (24*60*60*1000)) {
				node = getNodeXPath('//form[@name="exec_bid_form"]')[0];
				node.style.backgroundColor = '#ffaaaa';

				newNode = document.createElement('div');
				newNode.textContent = '※落札まで、24時間以上かかります！';
				newNode.style.cssText = 'color:#ff0000; background-color:#ffffff';
				node.appendChild(newNode);
			}
		}

		// トレード一覧
		if((location.pathname == '/card/trade.php') && ETCS_OPTION['AlertOfBuyTradeTime_List']) {
			node = getNodeXPath('//table[@class="tradeTables"]//td[@class="limit"]');
			for(var i in node) {
				tradeDate = cnvMDateStrToDate(node[i].textContent.replace(/10\:00/,' 10:00'));
				if(tradeDate == "Invalid Date") continue;
				diffTime  = tradeDate.getTime() - serverTime.getTime();
				// 24時間以上経過の場合注意喚起
				if(diffTime >= (24*60*60*1000)) {
					newNode = getNodeXPath('.//td[@class="trade"]//img',node[i].parentNode);
					if(newNode.length) {
						newNode[0].setAttribute('src','data:image/png;base64,'+
							'iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAYAAABy6+R8AAAAAXNSR0IArs4c6QAAAVVJREFU'+
							'KM9tkj3PAVEQhc9979potiE0JApboSAKodhOoeAHKSUqhUblv+gkolLpiEYkPloF2TvnLTZ7'+
							'7YqTTDLFee7HmVGIRCTkOA4cxwFJvF4vfKmtkoDrugiCAN1uF2EYolKpYLfbYbVa4XA4pEgC'+
							'oOd5XC6XfL/fJMlarcZY+/2ew+GQsddC8/mcImKNhUKBSZ1OJzYajQ/UbDZ5Pp9TpmKxaPv4'+
							'sOl0Sq01/wCgWq2iVCrhl0ja6vf7yGazcAAgl8uBjPJQSgEAbrcbRqMR8vk8RAStVguDwQBa'+
							'6wi63+8pAAAWiwU8z7PRl8tlXK9XGGOiF9TrdR6Px9QfjDEUkVQ/Ho+ptf6kN5lMaIyxUFzJ'+
							'2H3fT0fuui5nsxkfj0fqRhHher1mEAR2Tup7hTqdDnq9Hnzfx/P5xHa7xWazweVysR71a/eU'+
							'UshkMhARhGH4PQX1D731JaF5xmPZAAAAAElFTkSuQmCC');
						newNode[0].parentNode.setAttribute('title','落札まで、24時間以上かかります!');
					}
				}
			}
		}
	}
	//==============================================
	// トレードのソートにレアリティ表示状態を加える
	//===============================================
	function addRTradeSortLink() {
		if(location.pathname != '/card/trade.php')	return;

		var rswitch = ['r_l','r_ur','r_sr','r_r','r_uc','r_c','r_pr','r_hr','r_lr','lim'];	// 付け足す引数
		var labelNode = getNodeXPath('//table[@class="tradeTables"]/tbody/tr[1]//a');
		var i,addstr;
		var rnow_switch = [];

		// 現在の状態を取得
		for(i = 0;i < rswitch.length;i++) {
			reg = new RegExp(rswitch[i]+'=(\\d)?');
			if(location.search.match(reg)) {
				rnow_switch[i] = RegExp.$1;
				continue;
			}
			rnow_switch[i] = 0;	// 表示無し
		}

		labelNode.forEach( function( node ) {
			addstr = [];
			for(i = 0;i < rswitch.length;i++) {
				reg  = new RegExp(rswitch[i]+'=(\d)');
				if(node.getAttribute('href').match(reg)) {
					continue;
				}
				addstr[addstr.length] = rswitch[i] + '=' + rnow_switch[i];
			}
			node.setAttribute('href', node.getAttribute('href') + '&' + addstr.join('&'));
		});
	}

	// ==============================================
	//	 トレードなどでページ切り替えを上部にも表示
	// ===============================================
	function deckPagerUpperClone() {
		var pagerNode = null;
		var baseNode  = null;
		var insNode   = null;

		if(location.pathname.match(/\/card\/trade_card.php/)) {
			pagerNode  = document.querySelector('.pager');
			if(pagerNode == null) return;	// pagerが無ければ終了

			baseNode = pagerNode.parentNode;
			insNode  = baseNode.querySelector('#cardFileListBack , #cardFileList');
			if(insNode == null) {
				insNode = baseNode.firstChild;
			}
		}

		if(location.pathname == '/facility/territory_status.php') {
			pagerNode  = document.querySelector('.pager');
			if(pagerNode == null) return;	// pagerが無ければ終了

			baseNode = pagerNode.parentNode;
			insNode  = baseNode.querySelector('table');
			if(insNode == null) {
				insNode = baseNode.firstChild;
			}
		}

		if(pagerNode != null && baseNode != null && insNode != null) {
			baseNode.insertBefore(pagerNode.cloneNode(true), insNode);
		}

	}

	// ==============================================
	//	 入札時に初期価格を消去
	// ===============================================
	function eraseDefaultBiddingPrice() {
		if(location.pathname != '/card/trade.php')	return;

		var eraseFlag = false;
		var node = document.querySelector('input[name="exhibit_price"]');
		if(node == null) return;

		node.addEventListener('forcus',function() {
			if(!eraseFlag) return;		// 二回目以降は消さない
		},false);
	}


	// ==============================
	//	 市場で取引状態を仮算出
	// ==============================
	/*
		初期化
	*/
	function initMarketStockCalc() {

		var node;

		// 処理する場所かチェック
		if(location.pathname != "/facility/facility.php") return;	// 施設?
		var result = getNodeXPath('//div[@id="gray02Wrapper"]/h2/text()')[0];
		if(result.nodeValue != GAME_TERMS["市場"]) return;

		// 表示物作成
		node = document.createElement('div');
		node.setAttribute('id','etcs_market_calc');
		node.innerHTML = '<table class="etcs_market_table"><thead><tr><th></th><th>'+GAME_TERMS['木']+'</th><th>'+GAME_TERMS['石']+'</th><th>'+GAME_TERMS['鉄']+'</th><th>'+GAME_TERMS['糧']+'</th></thead><tbody>'+
				'<tr><th title="現在の資源の量">現在</th><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>'+
				'<tr><th title="取引する内容(左：売る量 右：買う量)">取引内容</th><td colspan="4">&nbsp;</td></tr>'+
				'<tr><th title="取引後の結果">取引後</th><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>'+
				'</tr></tbody></table>';

		getNodeXPath('//form[@name="form2"]/table//td[table]')[0].appendChild(node);

		// イベントの設定
		addEventByXPath('//input[@id="tc"]', 'keyup', viewMarketStockCalc,false);
		addEventByXPath('//input[@id="tc"] | //select[@id="select" or @id="select2"] | //span[@id="resorce_num"]', 'change',viewMarketStockCalc,false);

		viewMarketStockCalc();
		if(ETCS_OPTION['MarketStockCalcTimer']) {
			setInterval(viewMarketStockCalc,1000);
		}

	}
	/*
		表示更新
	*/
	function viewMarketStockCalc() {
		var trNode,tdNode,node;
		var i,j;
		var cnt;
		var stock	  = {'wood':0, 'stone':0, 'iron':0, 'rice':0 };
		var stockName = {"-1":-1,  "101":0,   "102":1,	"103":2,   "104":3};

		trNode = document.getElementById('etcs_market_calc').getElementsByTagName('tr');

		// 現在の資源の値
		tdNode = trNode[1].getElementsByTagName('td');
		cnt = 0;
		for(i in stock) {
			stock[i] = parseInt(document.getElementById(i).textContent,10);
			tdNode[cnt].firstChild.nodeValue = stock[i];
			cnt++;
		}

		// 取引相場の取得
		var convPer = getMarketConvPer();

		// Inputボックスに入力された値を取得し、取引を表示
		var sellQty,buyQty;
		var selAct = [0,0];
		node = document.getElementById("select");
		if(node != null) {
			// 現在の売買物選択状況を取得
			selAct[0] = parseInt(stockName[document.getElementById("select") .value]);
			selAct[1] = parseInt(stockName[document.getElementById("select2").value]);
			node = document.getElementById("tc");
			sellQty   = parseInt(node.value,10);	//8進数と誤解しないように
		} else {
			// inputボックスなし(確認画面？)
			node = getNodeXPath('//form[@name="form2"]//input[@name="tf_id"]');
			if(node.length == 0) return;		// 表示なし
			selAct[0] = parseInt(stockName[node[0].getAttribute('value')]);
			node = getNodeXPath('//form[@name="form2"]//input[@name="tt_id"]');
			if(node.length == 0) return;		// 表示なし
			selAct[1] = parseInt(stockName[node[0].getAttribute('value')]);
			node = getNodeXPath('//form[@name="form2"]//input[@name="tc"]');
			if(node.length == 0) return;		// 表示なし
			sellQty   = parseInt(node[0].getAttribute('value'),10);	//8進数と誤解しないように
		}

		if(isNaN(sellQty)) {
			sellQty = 0;
		}

		buyQty = parseInt((sellQty * convPer)/100);		// sellqty *(convper/100)だと誤差が出る
		trNode[2].getElementsByTagName('td')[0].firstChild.nodeValue = (sellQty+'').replace(/(\d)(?=(\d\d\d)+$)/g,'$1,') + ' → ' + (buyQty+'').replace(/(\d)(?=(\d\d\d)+$)/g,'$1,');

		// 取引後の資源量を表示
		tdNode = getNodeXPath('td/text()',trNode[3]);
		cnt = 0;
		for(i in stock) {
			var chgStock = stock[i];
			node = tdNode[cnt].parentNode.style;
			node.color = "#000000";
			if(selAct[0] == cnt) {
				chgStock -= sellQty;
				node.color = "#ff0000";
			}
			if(selAct[1] == cnt) {
				chgStock += buyQty;
				node.color = "#0000ff";
			}
			tdNode[cnt].nodeValue = chgStock;
			cnt++;
		}
	}
	/*
		相場の取得(%を返す)
	*/
	function getMarketConvPer() {

		var node;

		// 取引相場の取得
		node = getNodeXPath('//form[@name="form1"]//td[preceding-sibling::th[normalize-space(text()) = "'+GAME_TERMS["市場"]+'の取引相場"]]')[0];
		if(typeof node == 'undefined') return null;
		var percent = node.innerHTML.match(/\d{1,2}%/g);	// 数値取得
		for(i in percent) { percent[i] = percent[i].replace('%',''); }		// %をカット
		var convPer = parseInt(percent[0],10);	// 通常

		if(node.innerHTML.match(/スキル効果/)){
			convPer += parseInt(percent[1],10);	// スキル効果あり(仮)
		}

		return convPer;
	}
	/*
		コストの表示
	*/
		var costView_CostData;
		var marketCostView_CostData = {
			0 : 'select',
			"--- 種類 ---" : {0:'hr'},

			/*
				施設
			*/
			"施設建設" : {
				0 : 'select',

				"--- 資源施設 ---" : {0:'hr'},

				"伐採所" : {0:'select',
					"LV1":	[10,35,40,15],
					"LV2":	[25,88,100,38],
					"LV3":	[58,202,230,86],
					"LV4":	[173,604,690,259],
					"LV5":	[431,1510,1725,647],
					"LV6":	[1466,2847,3019,1294],
					"LV7":	[2493,4839,5132,2200],
					"LV8":	[3490,6775,7186,3080],
					"LV9":	[4537,8807,9341,4003],
					"LV10":	[5898,11450,12144,5204],
					"LV11":	[8119,14434,15787,6766],
					"LV12":	[11366,20207,22101,9472],
					"LV13":	[17050,30311,33152,14208],
					"LV14":	[25575,45467,49729,21312],
					"LV15":	[38362,68199,74593,31968],
				},
				"石切り場" : {0:'select',
					"LV1":	[40,10,35,15],
					"LV2":	[100,25,88,38],
					"LV3":	[230,58,202,86],
					"LV4":	[690,173,604,259],
					"LV5":	[1725,431,1510,647],
					"LV6":	[3019,1466,2847,1294],
					"LV7":	[5132,2493,4839,2200],
					"LV8":	[7186,3490,6775,3080],
					"LV9":	[9341,4537,8807,4003],
					"LV10":	[12144,5898,11450,5204],
					"LV11":	[15787,8119,14434,6766],
					"LV12":	[22101,11366,20207,9472],
					"LV13":	[33152,17050,30311,14208],
					"LV14":	[49729,25575,45467,21312],
					"LV15":	[74593,38362,68199,31968],
				},
				"製鉄所" : {0:'select',
					"LV1":	[35,40,10,15],
					"LV2":	[88,100,25,38],
					"LV3":	[202,230,58,86],
					"LV4":	[604,690,173,259],
					"LV5":	[1510,1725,431,647],
					"LV6":	[2847,3019,1466,1294],
					"LV7":	[4839,5132,2493,2200],
					"LV8":	[6775,7186,3490,3080],
					"LV9":	[8807,9341,4537,4003],
					"LV10":	[11450,12144,5898,5204],
					"LV11":	[14434,15787,8119,6766],
					"LV12":	[20207,22101,11366,9472],
					"LV13":	[30311,33152,17050,14208],
					"LV14":	[45467,49729,25575,21312],
					"LV15":	[68199,74593,38362,31968],
				},
				"畑" : {0:'select',
					"LV1":	[35,35,30,0],
					"LV2":	[88,88,75,0],
					"LV3":	[202,202,173,0],
					"LV4":	[604,604,518,0],
					"LV5":	[1510,1510,1294,0],
					"LV6":	[3019,3019,2588,0],
					"LV7":	[5132,5132,4399,0],
					"LV8":	[7186,7186,6159,0],
					"LV9":	[9341,9341,8007,0],
					"LV10":	[12144,12144,10409,0],
					"LV11":	[15787,15787,13532,0],
					"LV12":	[22101,22101,18944,0],
					"LV13":	[33152,33152,28416,0],
					"LV14":	[49729,49729,42625,0],
					"LV15":	[74593,74593,63937,0],
				},
				"工場" : {0:'select',
					"LV1":	[780,1560,1560,3900],
					"LV2":	[1248,2496,2496,6240],
					"LV3":	[1997,3994,3994,9984],
					"LV4":	[4193,6290,6290,11182],
					"LV5":	[5871,8806,8806,15655],
					"LV6":	[10958,13698,13698,16437],
					"LV7":	[15342,19177,19177,23013],
					"LV8":	[19944,24930,24930,29916],
					"LV9":	[25928,32410,32410,38891],
					"LV10":	[33706,42132,42132,50559],
				},
				"水車" : {0:'select',
					"LV1":	[2940,980,980,4900],
					"LV2":	[4704,1568,1568,7840],
					"LV3":	[7526,2509,2509,12544],
					"LV4":	[10537,5268,5268,14049],
					"LV5":	[14751,7376,7376,19668],
					"LV6":	[20652,13768,13768,20652],
					"LV7":	[28913,19275,19275,28913],
					"LV8":	[37587,25058,25058,37587],
					"LV9":	[48863,32576,32576,48863],
					"LV10":	[63523,42348,42348,63523],
				},

				"--- 軍事施設 ---" : {0:'hr'},

				"練兵所" : {0:'select',
					"LV1":	[112,107,107,122],
					"LV2":	[224,214,214,244],
					"LV3":	[448,428,428,488],
					"LV4":	[759,725,725,826],
					"LV5":	[1214,1160,1160,1322],
					"LV6":	[2209,2110,2110,2406],
					"LV7":	[3331,3182,3182,3627],
					"LV8":	[4958,4736,4736,5400],
					"LV9":	[8091,7729,7729,8813],
					"LV10":	[11130,10632,10632,12122],
				},
				"兵舎" : {0:'select',
					"LV1":	[72,360,72,216],
					"LV2":	[144,720,144,432],
					"LV3":	[228,1440,228,864],
					"LV4":	[648,1728,648,1296],
					"LV5":	[972,2592,972,1944],
					"LV6":	[1409,3758,1409,2819],
					"LV7":	[2725,4088,2725,4088],
					"LV8":	[6744,9810,5518,2453],
					"LV9":	[12140,17658,9933,4415],
					"LV10":	[21852,31784,17879,7946],
					"LV11":	[39333,57212,32182,14303],
					"LV12":	[70800,96545,64364,25745],
					"LV13":	[127440,173781,115854,46342],
					"LV14":	[254879,324392,254879,92683],
					"LV15":	[509759,648784,509759,185367],
				},
				"弓兵舎" : {0:'select',
					"LV1":	[360,72,72,216],
					"LV2":	[720,144,144,432],
					"LV3":	[1440,288,288,864],
					"LV4":	[1728,648,648,1296],
					"LV5":	[2592,972,972,1944],
					"LV6":	[3758,1409,1409,2819],
					"LV7":	[5450,2044,2044,4087],
					"LV8":	[9810,6131,6131,2453],
					"LV9":	[17658,12140,9933,4415],
					"LV10":	[31784,21852,17879,7946],
					"LV11":	[57212,39333,32182,14303],
					"LV12":	[96545,70800,64364,25745],
					"LV13":	[173781,127440,115854,46342],
					"LV14":	[324392,254879,254879,92683],
					"LV15":	[648784,509759,509759,185367],
				},
				"厩舎" : {0:'select',
					"LV1":	[72,72,360,216],
					"LV2":	[144,144,720,432],
					"LV3":	[288,288,1440,864],
					"LV4":	[648,648,1728,1296],
					"LV5":	[972,972,2592,1944],
					"LV6":	[1409,1409,3758,2891],
					"LV7":	[2044,2044,5450,4087],
					"LV8":	[5518,6744,9810,2453],
					"LV9":	[9933,12140,17658,4415],
					"LV10":	[17879,21852,31784,7946],
					"LV11":	[32182,39333,57212,14303],
					"LV12":	[64364,70800,96545,25745],
					"LV13":	[115854,127440,173781,46342],
					"LV14":	[254879,254879,324392,92683],
					"LV15":	[509759,509759,648784,185367],
				},
				"兵器工房" : {0:'select',
					"LV1":	[216,216,216,72],
					"LV2":	[432,432,432,144],
					"LV3":	[864,864,864,288],
					"LV4":	[1224,1224,1224,648],
					"LV5":	[1836,1836,1836,972],
					"LV6":	[2662,2662,2662,1409],
					"LV7":	[3860,3860,3860,2044],
					"LV8":	[7457,7457,7357,2452],
					"LV9":	[13242,13242,13242,4414],
					"LV10":	[23836,23836,23836,7945],
					"LV11":	[42905,42905,42905,14302],
					"LV12":	[77229,77229,77229,25743],
					"LV13":	[139013,139013,139013,46338],
					"LV14":	[278026,278026,278026,92675],
					"LV15":	[556051,556051,556051,185350],
				},
				"宿舎" : {0:'select',
					"LV1":	[35,20,35,80],
					"LV2":	[53,30,53,120],
					"LV3":	[89,51,89,204],
					"LV4":	[147,84,147,337],
					"LV5":	[228,130,228,522],
					"LV6":	[336,192,336,767],
					"LV7":	[476,272,476,1089],
					"LV8":	[653,373,653,1492],
					"LV9":	[868,496,868,1984],
					"LV10":	[1129,645,1129,2580],
					"LV11":	[2032,1161,2032,4644],
					"LV12":	[3658,2090,3658,4644],
					"LV13":	[6951,3971,6950,15882],
					"LV14":	[13205,7544,13205,30177],
					"LV15":	[25090,14334,25090,57336],
				},
				"大宿舎" : {0:'select',
					"LV1":	[200,114,200,438],
					"LV2":	[320,183,320,701],
					"LV3":	[512,293,512,1121],
					"LV4":	[768,439,768,1682],
					"LV5":	[1152,658,1152,2523],
					"LV6":	[1728,987,1728,3784],
					"LV7":	[2419,1382,2419,5298],
					"LV8":	[3387,1935,3387,7418],
					"LV9":	[4741,2709,4741,10385],
					"LV10":	[6637,3793,6637,14538],
					"LV11":	[8628,4930,8628,18900],
					"LV12":	[11217,6409,11217,24570],
					"LV13":	[14582,8332,14582,31941],
					"LV14":	[18956,11735,18956,40620],
					"LV15":	[25817,16429,25817,49286],
					"LV16":	[32271,22003,32271,60141],
					"LV17":	[42172,29337,42172,69675],
					"LV18":	[52715,38963,52715,84803],
					"LV19":	[66009,49506,66009,93512],
					"LV20":	[79211,62708,79211,108914],
				},
				"訓練所" : {0:'select',
					"LV1":	[1500,1600,2500,3300],
					"LV2":	[2100,2240,3500,3300],
					"LV3":	[2940,3136,4900,6468],
					"LV4":	[6629,7326,13955,6978],
					"LV5":	[13257,14653,27910,13955],
					"LV6":	[32097,37679,55821,13955],
					"LV7":	[64194,75358,111642,27910],
					"LV8":	[128388,150716,223283,55821],
					"LV9":	[256776,301432,446566,111642],
					"LV10":	[513551,602865,893133,223283],
				},
				"遠征訓練所" : {0:'select',
					"LV1":	[2884,4486,5977,2723],
					"LV2":	[4614,7177,9484,4357],
					"LV3":	[7382,11483,15174,6972],
					"LV4":	[11811,18373,24279,11155],
					"LV5":	[18898,29397,38846,17848],
					"LV6":	[28347,44096,58269,26772],
					"LV7":	[42521,66143,87404,40158],
					"LV8":	[63781,99215,131105,60238],
					"LV9":	[89294,138901,183548,84333],
					"LV10":	[125011,194461,256967,118066],
					"LV11":	[175015,272246,359754,165292],
					"LV12":	[227520,353920,467680,214880],
					"LV13":	[295776,460096,607984,279344],
					"LV14":	[384509,598125,790379,363147],
					"LV15":	[512678,692116,897187,461410],
					"LV16":	[645974,830539,1045863,553692],
					"LV17":	[812082,959734,1218123,701344],
					"LV18":	[1018794,1151680,1417453,841613],
					"LV19":	[1275708,1382016,1647789,1009935],
					"LV20":	[1594635,1658420,1913561,1211922],
				},
				"鍛冶場" : {0:'select',
					"LV1":	[200,150,340,170],
					"LV2":	[400,300,680,340],
					"LV3":	[780,585,1326,663],
					"LV4":	[1482,1112,2519,1290],
					"LV5":	[2742,2056,4661,2330],
					"LV6":	[4935,3701,8390,4195],
					"LV7":	[8636,6477,14682,7341],
					"LV8":	[17640,14112,28223,10584],
					"LV9":	[31566,25253,50506,18940],
					"LV10":	[50506,40404,80809,30303],
				},
				"防具工場" : {0:'select',
					"LV1":	[150,200,340,170],
					"LV2":	[300,400,680,340],
					"LV3":	[585,780,1326,663],
					"LV4":	[1112,1482,2519,1260],
					"LV5":	[2056,2742,4661,2330],
					"LV6":	[3701,4935,8390,4195],
					"LV7":	[6477,8636,14682,7341],
					"LV8":	[14112,17640,28223,10584],
					"LV9":	[25253,31566,50506,18940],
					"LV10":	[40404,50506,80809,30303],
				},
				"見張り台" : {0:'select',
					"LV1":	[600,840,600,360],
					"LV2":	[960,1344,960,576],
					"LV3":	[1536,2150,1536,922],
					"LV4":	[2458,3441,2458,1475],
					"LV5":	[3932,5505,3932,2359],
					"LV6":	[6291,8808,6291,3775],
					"LV7":	[9437,13212,9437,5662],
					"LV8":	[14156,19818,14156,8493],
					"LV9":	[21233,29727,21233,12740],
					"LV10":	[31850,44590,31850,19110],
					"LV11":	[44590,62426,44590,26754],
					"LV12":	[62426,87396,62426,37456],
					"LV13":	[87397,122355,87397,52438],
					"LV14":	[122355,171297,122355,73413],
					"LV15":	[159062,222686,159062,95437],
					"LV16":	[206780,289492,206780,124068],
					"LV17":	[268814,376340,268814,161288],
					"LV18":	[349458,489242,349458,209675],
					"LV19":	[419350,587090,419350,251610],
					"LV20":	[503220,704508,503220,301932],
				},

				"--- 一般施設 ---" : {0:'hr'},

				"倉庫" : {0:'select',
					"LV1":	[83,141,83,63],
					"LV2":	[167,281,167,126],
					"LV3":	[300,506,300,226],
					"LV4":	[479,810,479,362],
					"LV5":	[671,1134,671,507],
					"LV6":	[1044,1253,1044,835],
					"LV7":	[1462,1754,1462,1169],
					"LV8":	[1973,2368,1973,1578],
					"LV9":	[2664,3196,2664,2131],
					"LV10":	[3596,4315,3596,2877],
					"LV11":	[4854,5825,4854,3883],
					"LV12":	[6311,7573,6311,5048],
					"LV13":	[8204,9845,8204,6563],
					"LV14":	[10255,12306,10255,8204],
					"LV15":	[12819,15382,12816,10255],
					"LV16":	[15382,18459,15382,12306],
					"LV17":	[18459,22151,18459,14767],
					"LV18":	[21228,21228,25473,16982],
					"LV19":	[24412,29294,24412,19529],
					"LV20":	[28074,33688,28074,22459],
				},
				"研究所" : {0:'select',
					"LV1":	[275,110,110,55],
					"LV2":	[413,165,165,83],
					"LV3":	[619,248,248,124],
					"LV4":	[1486,836,836,557],
					"LV5":	[2228,1253,1253,836],
					"LV6":	[7521,6267,6267,5015],
					"LV7":	[13538,11282,11282,9025],
					"LV8":	[21436,17862,17862,14290],
					"LV9":	[44675,37228,37228,29784],
					"LV10":	[87725,73104,73104,58483],
				},
				"市場" : {0:'select',
					"LV1":	[100,100,50,50],
					"LV2":	[334,334,191,191],
					"LV3":	[1035,1035,592,592],
					"LV4":	[2795,2795,1600,1600],
					"LV5":	[6328,6328,4218,4218],
					"LV6":	[13288,13288,8859,8859],
					"LV7":	[25248,25248,16832,16832],
					"LV8":	[42921,42921,28614,28614],
					"LV9":	[64381,64381,42921,42921],
					"LV10":	[90134,90134,60089,60089],
				},
				"銅雀台" : {0:'select',
					"LV1":	[700,3500,2100,700],
					"LV2":	[1120,5600,3360,1120],
					"LV3":	[1792,8960,5376,1792],
					"LV4":	[3763,10035,7526,3763],
					"LV5":	[5263,14049,10537,5268],
					"LV6":	[9834,14752,14752,9834],
					"LV7":	[13768,20652,20652,13768],
					"LV8":	[17899,26848,26848,17899],
					"LV9":	[23268,34902,34902,23268],
					"LV10":	[30249,45373,45373,30249],
				},

				"--- 拠点 ---" : {0:'hr'},

				"城" : {0:'select',
					"LV1(初期建設済)":	[0,0,0,0],
					"LV2":	[1404,546,390,780],
					"LV3":	[2570,1000,714,1428],
					"LV4":	[4161,2081,2081,2081],
					"LV5":	[7102,3552,3552,3552],
					"LV6":	[9056,9056,6037,6037],
					"LV7":	[14384,14384,9589,9589],
					"LV8":	[22773,22773,15183,15183],
					"LV9":	[33562,33562,22374,22374],
					"LV10":	[44402,57559,32890,29602],
					"LV11":	[65122,84418,48239,43415],
					"LV12":	[95317,123558,70605,63544],
					"LV13":	[113458,154716,154716,92830],
					"LV14":	[150418,150418,315878,135375],
					"LV15":	[219008,219008,492770,164258],
					"LV16":	[294820,294820,663345,221115],
					"LV17":	[488220,488220,827854,318406],
					"LV18":	[839130,839130,915414,457707],
					"LV19":	[1307581,1307581,1354280,700491],
					"LV20":	[1901938,1901938,1969864,1018896],
				},
				"砦" : {0:'select',
					"LV1":	[104,400,136,160],
					"LV2":	[243,936,319,374],
					"LV3":	[438,1685,573,673],
					"LV4":	[1110,2467,1357,1233],
					"LV5":	[1887,4194,2307,2097],
					"LV6":	[3236,7191,3954,3596],
					"LV7":	[5177,11505,6327,5753],
					"LV8":	[10430,18776,13560,9387],
					"LV9":	[18839,33912,24492,16956],
					"LV10":	[33914,61043,44087,30523],
					"LV11":	[66939,106495,85196,45640],
					"LV12":	[119786,190570,152456,81672],
					"LV13":	[213820,340166,272133,145786],
					"LV14":	[423566,505021,456148,244365],
					"LV15":	[708513,844765,763014,408756],
				},
				"村" : {0:'select',
					"LV1":	[400,136,104,160],
					"LV2":	[936,319,243,374],
					"LV3":	[1685,573,438,673],
					"LV4":	[2467,1357,1110,1233],
					"LV5":	[4194,2307,1887,2097],
					"LV6":	[7191,3954,3236,3596],
					"LV7":	[11505,6327,5177,5753],
					"LV8":	[18776,13560,10430,9387],
					"LV9":	[33912,24492,18839,16956],
					"LV10":	[61043,44087,33914,30523],
					"LV11":	[106495,85196,66939,45640],
					"LV12":	[190570,152456,119786,81672],
					"LV13":	[340166,272133,213820,145786],
					"LV14":	[505021,456148,423566,244365],
					"LV15":	[844765,763014,708513,408756],
				},

				"--- 廃止 ---" : {0:'hr'},

				"修行場" : {0:'select',
					"LV1":	[1600,1200,600,600],
					"LV2":	[2240,1680,840,840],
					"LV3":	[3136,2352,1176,1176],
					"LV4":	[4390,3293,1646,1646],
					"LV5":	[6146,4610,2305,2305],
					"LV6":	[8605,6454,3227,3227],
					"LV7":	[11186,8390,4195,4195],
					"LV8":	[14542,10907,5453,5453],
					"LV9":	[18905,14179,7089,7089],
					"LV10":	[24577,18433,9216,9216],
					"LV11":	[31950,23963,11981,11981],
					"LV12":	[38340,28755,14378,14378],
					"LV13":	[46008,34506,17253,17253],
					"LV14":	[55210,41407,20704,20704],
					"LV15":	[66252,49689,24844,24844],
					"LV16":	[72877,54658,27329,27329],
					"LV17":	[80164,60123,30062,30062],
					"LV18":	[88181,66136,33068,33068],
					"LV19":	[96999,72749,36375,36375],
					"LV20":	[106699,80024,40012,40012],
				},
			},
			/*
				兵士作成
			*/
			"兵士作成" : {
				0 : 'select',
				'剣兵'	  :['num',[ 10,  0, 10, 60]],
				'大剣兵'  :['num',[ 85,  0, 85,430]],
				'盾兵'	  :['num',[ 70, 70, 70, 20]],
				'重盾兵'  :['num',[210,210,210, 60]],
				'斥候'	  :['num',[150,150,150, 10]],
				'槍兵'	  :['num',[ 88,132,  0, 20]],
				'弓兵'	  :['num',[144,  0, 96, 35]],
				'騎兵'	  :['num',[  0,128,192, 40]],
				'衝車'	  :['num',[500,  0,500,  0]],
				'矛槍兵'  :['num',[264,396,  0, 60]],
				'弩兵'	  :['num',[432,  0,288,105]],
				'近衛騎兵':['num',[  0,384,576,120]],
				'斥候騎兵':['num',[450,450,450, 30]],
				'投石機'  :['num',[  0,1500,1500, 0]],
			},
			/*
				研究
			*/
			"研究" : {
				0 : 'select',

				"--- 研究 ---" : {0:'hr'},
				"[研究] 大剣兵" :	[273600,273600,273600,456000],
				"[研究] 盾兵" :	[ 1300,1300,1300, 450],
				"[研究] 重盾兵" :	[357200,357200,357200,205200],
				"[研究] 槍兵" :	[ 500,2500,1000, 350],
				"[研究] 弓兵" :	[2500, 500,1000, 350],
				"[研究] 騎兵" :	[ 500, 350,2500,2500],
				"[研究] 斥候" :	[3000,3000,3000, 500],
				"[研究] 衝車" :	[28000,12000,28000,4000],
				"[研究] 斥候騎兵":	[12000,12000,12000,2000],
				"[研究] 矛槍兵" :	[205200,456000,319200,296400],
				"[研究] 弩兵" :	[456000,205200,319200,296400],
				"[研究] 近衛騎兵":	[205200,319200,456000,296400],
				"[研究] 投石機" :	[414960,592800,414960,385320],

				"--- 武器研究 ---" : {0:'hr'},

				"[武器] 剣兵" : {0:'select',
					"LV1 粗末な銅剣":	[165,135,0,0],
					"LV2 訓練兵の銅剣":	[251,319,0,0],
					"LV3 青銅の剣":	[184,596,0,303],
					"LV4 青銅の長剣":	[351,994,0,604],
					"LV5 鉄の長剣":	[431,828,2054,0],
					"LV6 蒲元の長剣":	[159,848,4294,0],
					"LV7 鉄剣「玄」":	[1397,2301,4519,0],
					"LV8 鉄剣「玄武」":	[1019,4458,7260,0],
					"LV9 鉄剣「黒玄武」":	[0,11558,3572,5884],
					"LV10 剛剣「玄武切」":	[0,19648,6073,10003],
				},
				"[武器] 大剣兵" : {0:'select',
					"LV1 銅の大剣":[24775,20270,0,0],
					"LV2 鋼の大剣":[29082,94199,0,47890],
					"LV3 斬馬刀":[55488,157137,0,95483],
					"LV4 斬馬刀「烈」":[68141,130906,324736,0],
					"LV5 斬馬刀「破」":[68141,130906,324736,0],
					"LV6 大剣「玄」":[25137,134063,678854,0],
					"LV7 大剣「玄天」":[213721,352019,691341,0],
					"LV8 大剣「玄天上帝」":[140799,615977,1003138,0],
					"LV9 七星大剣":[0,1258370,388899,640617],
					"LV10 皇大剣「四世三公」":[0,1870636,578195,952360],
				},
				"[武器] 重盾兵" : {0:'select',
					"LV1 銅の狼牙棒":[15576,15576,15576,0],
					"LV2 鉄の狼牙棒":[31153,31153,31153,0],
					"LV3 鋼の狼牙棒":[59190,59190,59190,0],
					"LV4 武将の狼牙棒":[106542,106542,106542,0],
					"LV5 剛将の狼牙棒":[181121,181121,181121,0],
					"LV6 地砕狼牙":[289794,289794,289794,0],
					"LV7 鋼の狼牙棒":[434692,434692,434692,0],
					"LV8 鋭牙「麒」":[608568,608568,608568,0],
					"LV9 鋭牙「麒王」":[791138,791138,791138,0],
					"LV10 皇牙「武帝」":[1186708,1186708,1186708,0],
				},
				"[武器] 槍兵" : {0:'select',
					"LV1 石の槍":[1820,3575,0,1105],
					"LV2 青銅の槍":[3640,7150,0,2210],
					"LV3 鉄の槍":[0,12870,6552,3978],
					"LV4 鉄の鋭槍":[0,21879,11138,6763],
					"LV5 羽林の槍":[10820,35006,17821,0],
					"LV6 羽林の鋭槍":[16230,52510,26732,0],
					"LV7 鉄槍「青」":[22722,73514,37425,0],
					"LV8 鉄槍「青龍」":[30675,99243,50524,0],
					"LV9 鉄槍「青龍牙」":[39878,129016,65681,0],
					"LV10 剛槍「応龍」":[51841,167721,85385,0],
				},
				"[武器] 弓兵" : {0:'select',
					"LV1 竹製の弓":	[3795,0,1173,1932],
					"LV2 木製の弓":	[7590,0,2346,3864],
					"LV3 木製の大弓":	[13662,0,6995,4223],
					"LV4 堅木の大弓":	[23225,0,11824,7179],
					"LV5 補強大弓":	[37161,11486,18918,0],
					"LV6 強化弓":	[55741,17229,28377,0],
					"LV7 強弓「朱」":	[78038,39728,24121,0],
					"LV8 強弓「朱雀」":	[105351,53633,32563,0],
					"LV9 強弓「鳳凰」":	[122015,49802,77193,0],
					"LV10 剛弓「落鳳」":	[178043,55031,90640,0],
				},
				"[武器] 騎兵" : {0:'select',
					"LV1 青銅の直刀":	[1241,2044,4015,0],
					"LV2 青銅の大刀":	[2482,4088,8030,0],
					"LV3 鉄の直刀":	[4468,0,14454,7358],
					"LV4 黒鉄の刀":	[7595,0,24572,12509],
					"LV5 虎賁の鉄刀":	[12152,0,39315,20015],
					"LV6 百辟刀":	[0,18228,58973,30022],
					"LV7 鉄刀「白」":	[0,42031,82562,25519],
					"LV8 鉄刀「白虎」":	[0,56742,111458,34451],
					"LV9 鉄刀「白虎爪」":	[0,73765,144895,44786],
					"LV10 剛刀「虎殺し」":	[0,95894,188364,58222],
				},
				"[武器] 衝車" : {0:'select',
					"LV1 削り出した丸太":	[6600,2040,3360,0],
					"LV2 古木の槌":	[13200,4080,6720,0],
					"LV3 木の槌":	[23760,7344,12096,0],
					"LV4 改良木槌":	[40392,12485,20536,0],
					"LV5 補強木槌":	[64627,19976,32901,0],
					"LV6 鉄の鎚":	[96941,29964,49352,0],
					"LV7 鉄鎚「黄」":	[135717,41949,69092,0],
					"LV8 鉄鎚「麒麟」":	[183218,56631,93274,0],
					"LV9 鉄鎚「霊亀」":	[238183,73620,121257,0],
					"LV10 鉄鎚「山崩」":	[359657,111167,183098,0],
				},
				"[武器] 矛槍兵" : {0:'select',
					"LV1 銅の矛":	[14000,27500,0,8500],
					"LV2 鉄の矛":	[28000,55000,0,17000],
					"LV3 鉄戟":	[0,104500,53200,32300],
					"LV4 方天戟":	[0,188100,95760,58140],
					"LV5 方天画戟":	[98838,319770,162792,0],
					"LV6 燕国の戟":	[158141,511632,260467,0],
					"LV7 名将の戟":	[237211,767448,390701,0],
					"LV8 楽毅の戟":	[332096,1074427,546981,0],
					"LV9 楽毅の戦戟":	[431724,1396755,711075,0],
					"LV10 皇戟「昭烈」":	[647587,2095133,1066613,0],
				},
				"[武器] 弩兵" : {0:'select',
					"LV1 弩":	[30250,0,9350,15400],
					"LV2 補強弩":	[60500,0,18700,30800],
					"LV3 改良弩":	[114950,0,58520,35530],
					"LV4 改良弩「貫」":	[206910,0,105336,63954],
					"LV5 改良弩「墨式」":	[351747,108722,179071,0],
					"LV6 改良弩「飛」":	[562795,173955,286514,0],
					"LV7 改良弩「飛」弐式":	[844193,429771,260932,0],
					"LV8 改良弩「飛将軍」":	[1181870,601679,365305,0],
					"LV9 強弩「李広」":	[1368820,558702,865988,0],
					"LV10 皇弩「大皇」":	[2320010,717094,1181096,0],
				},
				"[武器] 近衛騎兵" : {0:'select',
					"LV1 鉄の手戟":	[10200,16800,33000,0],
					"LV2 馬上用鉄槍":	[20400,33600,66000,0],
					"LV3 西涼馬上槍":	[38760,0,125400,63840],
					"LV4 虎豹騎の槍":	[69768,0,225720,114912],
					"LV5 虎豹騎の戦槍":	[76745,0,488376,132559],
					"LV6 戦槍「百虎」":	[0,189769,613958,312561],
					"LV7 戦槍「虎王」":	[0,468841,920938,284653],
					"LV8 白起の槍":	[0,656377,1289313,398515],
					"LV9 白起の剛槍":	[0,853291,1676107,518069],
					"LV10 皇槍「魏武」":	[0,1279936,2514161,777104],
				},
				"[武器] 投石機" : {0:'select',
					"LV1 切り出した石":	[11050,35750,18200,0],
					"LV2 投石用岩石":	[22100,71500,36400,0],
					"LV3 巨岩弾":	[41990,135850,69160,0],
					"LV4 霹靂弾":	[75582,244530,124488,0],
					"LV5 発火弾":	[128489,415701,211630,0],
					"LV6 火炎弾":	[205583,665122,338607,0],
					"LV7 火炎連弾":	[308375,997682,507911,0],
					"LV8 呂尚式・火炎弾":	[431724,1396755,711075,0],
					"LV9 呂尚式・二連炎弾":	[561242,1815782,924398,0],
					"LV10 呂尚式・多段炎弾":	[729614,2360517,1201718,0],
				},

				"--- 防具研究 ---" : {0:'hr'},

				"[防具] 剣兵" : {0:'select',
					"LV1 間に合わせの鎧" : [149,122,0,0],
					"LV2 木の軽鎧" : [228,285,0,0],
					"LV3 古びた銅鎧" : [168,534,0,273],
					"LV4 青銅の軽鎧" : [310,900,0,544],
					"LV5 鉄の古式鎧" : [373,745,1864,0],
					"LV6 鉄の軽鎧" : [539,1431,2801,0],
					"LV7 鉄重ねの軽鎧" : [1265,2063,4067,0],
					"LV8 軽鎧「緑鱗造り」" : [1949,6304,3209,0],
					"LV9 軽鎧「山式」" : [0,10288,3253,5371],
					"LV10 軽鎧「泰山」" : [0,17683,5466,9002],
				},
				"[防具] 大剣兵" : {0:'select',
					"LV1 風化した軽甲":[22290,18251,0,0],
					"LV2 鉄の軽甲":[36036,45045,0,0],
					"LV3 鉄の紅甲":[26545,84374,0,43135],
					"LV4 戦士の軽甲":[49009,142285,0,86003],
					"LV5 漢軍の軽甲":[58965,117772,294668,0],
					"LV6 剣聖の軽甲":[85211,226227,442811,0],
					"LV7 劉邦の軽甲":[193534,315622,622217,0],
					"LV8 ?王の軽甲":[269330,871143,443448,0],
					"LV9 ?王の紅甲":[0,1120136,354180,584783],
					"LV10 盤古の真紅甲":[0,1683585,520414,857073],
				},
				"[防具] 盾兵" : {0:'select',
					"LV1 革の戦盾":	[1840,1840,1840,0],
					"LV2 木の戦盾":	[3679,3679,3679,0],
					"LV3 青銅の戦盾":	[6623,6623,6623,0],
					"LV4 鉄の戦盾":	[11258,11258,11258,0],
					"LV5 鋼鉄の戦盾":	[18014,18014,18014,0],
					"LV6 正規兵の戦盾":	[27020,27020,27020,0],
					"LV7 護君の戦盾":	[37829,37829,37829,0],
					"LV8 護国の戦盾":	[51069,51069,51069,0],
					"LV9 戦盾「剛式」":	[66389,66389,66389,0],
					"LV10 戦盾「剛堅」":	[86306,86306,86306,0],
				},
				"[防具] 重盾兵" : {0:'select',
					"LV1 ひび割れた重盾":	[14019,14019,14019,0],
					"LV2 鉄の重盾":	[28037,28037,28037,0],
					"LV3 鉄の黒盾":	[53271,53271,53271,0],
					"LV4 親衛隊の重盾":	[95888,95888,95888,0],
					"LV5 漢軍の黒盾":	[163009,163009,163009,0],
					"LV6 守将の重盾":	[260814,260814,260814,0],
					"LV7 管夷吾の重盾":	[391221,391221,391221,0],
					"LV8 黄帝の重盾":	[547711,547711,547711,0],
					"LV9 黄帝の重盾":	[712025,712025,712025,0],
					"LV10 ??の黒鉄盾":	[854430,854430,854430,0],
				},
				"[防具] 槍兵" : {0:'select',
					"LV1 魚鱗の鎧" : [1638,3218,0,995],
					"LV2 青銅の重鎧" : [3276,6435,0,1989],
					"LV3 鉄の鎧" : [0,11583,5897,3580],
					"LV4 鉄の重鎧" : [0,19691,10025,6086],
					"LV5 正規兵の鉄鎧" : [9738,31506,16039,0],
					"LV6 正規兵の重鎧" : [14607,47259,24059,0],
					"LV7 劉軍の重鎧" : [20450,66162,33683,0],
					"LV8 蜀漢式重鎧" : [27608,89319,45471,0],
					"LV9 重鎧 「震式」" : [35890,116115,59113,0],
					"LV10 重鎧「震天」" : [46657,150949,76847,0],
				},
				"[防具] 矛槍兵" : {0:'select',
					"LV1 鉄の重鎧" : [12600,24750,0,7650],
					"LV2 勇士の重鎧" : [25200,49500,0,15300],
					"LV3 白塗りの鉄鎧" : [0,94050,47880,29070],
					"LV4 漢軍の重鎧" : [0,169290,86184,52326],
					"LV5 漢軍の白鎧" : [88954,287793,146513,0],
					"LV6 軍神の重鎧" : [142327,460469,234420,0],
					"LV7 英布の重鎧" : [213490,690703,351631,0],
					"LV8 堯王の重鎧" : [298886,966984,492283,0],
					"LV9 堯王の白鎧" : [388552,1257080,639968,0],
					"LV10 伏羲の白銀鎧" : [545116,1762197,1121087,0],
				},
				"[防具] 弓兵" : {0:'select',
					"LV1 堅木の甲冑" : [3416,0,1056,1739],
					"LV2 桃木の甲冑" : [6831,0,2111,3478],
					"LV3 革の甲冑" : [12296,0,6260,3801],
					"LV4 青銅の甲冑" : [20903,0,10641,6461],
					"LV5 鉄の甲冑" : [33445,10337,17026,0],
					"LV6 正規兵の甲冑" : [50167,15506,25540,0],
					"LV7 孫呉式甲冑" : [70234,35756,21709,0],
					"LV8 小覇王の甲冑" : [94816,48270,29307,0],
					"LV9 甲冑「火式」" : [108917,44822,70371,0],
					"LV10 甲冑「雲火」" : [160238,49528,81576,0],
				},
				"[防具] 弩兵" : {0:'select',
					"LV1 青銅の軽鎧" : [27225,0,8415,13860],
					"LV2 鉄の軽鎧" : [54450,0,16830,27720],
					"LV3 鉄の青鎧" : [103455,0,52668,31977],
					"LV4 漢軍の軽鎧" : [186219,0,94802,57559],
					"LV5 漢軍の青鎧" : [316572,97850,161164,0],
					"LV6 弓聖の軽鎧" : [506516,156559,257863,0],
					"LV7 王翦の軽鎧" : [759774,386794,234839,0],
					"LV8 舜王の軽鎧" : [1063683,541511,328775,0],
					"LV9 舜王の青鎧" : [1221881,502832,789446,0],
					"LV10 女?の紺青鎧" : [2088009,645385,1062986,0],
				},
				"[防具] 騎兵" : {0:'select',
					"LV1 青銅の軽鎧" : [1117,1840,3614,0],
					"LV2 鉄の軽鎧" : [2234,3679,7227,0],
					"LV3 黒鉄の軽鎧" : [4021,0,13009,6623],
					"LV4 異民族の軽鎧" : [6835,0,22115,11258],
					"LV5 西涼式軽鎧" : [10937,0,35384,18013],
					"LV6 魏軍の軽鎧" : [0,16405,53075,27020],
					"LV7 魏将の軽鎧" : [0,37828,74305,22967],
					"LV8 虎豹騎の軽鎧" : [0,51068,100312,31006],
					"LV9 軽鎧「風式」" : [0,66388,130406,40307],
					"LV10 軽鎧「風裂」" : [0,86305,169528,52399],
				},
				"[防具] 近衛騎兵" : {0:'select',
					"LV1 西涼式軽鎧" : [9180,15120,29700,0],
					"LV2 虎豹騎の鎧" : [18360,30240,59400,0],
					"LV3 金染めの鉄鎧" : [34884,0,112860,57456],
					"LV4 漢軍の近衛鎧" : [62791,0,203148,103421],
					"LV5 漢軍の金鎧" : [106745,0,345352,175815],
					"LV6 覇王の軽鎧" : [0,170792,552563,281305],
					"LV7 霍去病の鎧" : [0,421957,828844,256188],
					"LV8 禹王の軽鎧" : [0,590740,1160381,358663],
					"LV9 禹王の金鎧" : [0,767962,1508496,466262],
					"LV10 炎帝の黄金鎧" : [0,1151943,2262744,699394],
				},
				"[防具] 斥候" : {0:'select',
					"LV1 木の手甲" : [1638,995,0,3218],
					"LV2 青銅の手甲" : [3276,1989,0,6435],
					"LV3 漆染めの革手甲" : [6224,3779,0,12227],
					"LV4 鉄の手甲" : [0,6802,11204,22008],
					"LV5 間者の手甲" : [0,11564,19047,37413],
					"LV6 間者の黒手甲" : [0,18502,30475,59861],
					"LV7 軽量鉄手甲" : [27754,0,45712,89791],
					"LV8 孫子式手甲" : [38855,0,63997,125708],
					"LV9 手甲「陰式」" : [50512,0,83916,163420],
					"LV10 手甲「陰隠」" : [65665,0,108154,212446],
				},
				"[防具] 斥候騎兵" : {0:'select',
					"LV1 魚鱗の甲冑" : [2240,1360,0,4400],
					"LV2 青銅の甲冑" : [4480,2720,0,8800],
					"LV3 騎兵用甲冑" : [8512,5168,0,16720],
					"LV4 鉄の軽量甲冑" : [0,9302,15322,30096],
					"LV5 西涼式甲冑" : [0,15814,26047,51163],
					"LV6 上級兵の甲冑" : [0,25302,41675,81861],
					"LV7 漢軍の甲冑" : [37954,0,62512,122791],
					"LV8 甲冑「疾駆」" : [53135,0,87517,171908],
					"LV9 甲冑「林式」" : [69076,0,113772,223480],
					"LV10 甲冑「静林」" : [104304,0,171795,337455],
				},
				"[防具] 衝車" : {0:'select',
					"LV1 古木造り" : [5940,1836,3024,0],
					"LV2 石造り" : [11880,3672,6048,0],
					"LV3 鉄造り" : [21384,6610,10886,0],
					"LV4 強化鉄造り" : [36353,11236,18507,0],
					"LV5 墨家造り" : [58164,17978,29611,0],
					"LV6 孔明式木造り" : [87247,26967,44417,0],
					"LV7 孔明式鉄造り" : [122145,37754,62183,0],
					"LV8 秘伝鉄造り" : [164896,50968,83947,0],
					"LV9 鉄製「雷」造り" : [214365,66258,109131,0],
					"LV10 鉄製「雷公」造り" : [63561,198334,326634,0],
				},
				"[防具] 投石機" : {0:'select',
					"LV1 堅木の砲台" : [9945,32175,16380,0],
					"LV2 赤石の砲台" : [19890,64350,32760,0],
					"LV3 硬玉の砲台" : [37791,122265,62244,0],
					"LV4 鉄製砲台" : [68024,220077,112039,0],
					"LV5 発火弾" : [115640,374131,190467,0],
					"LV6 特製砲台「流星」" : [185025,598609,304747,0],
					"LV7 仙術砲台" : [277537,897914,457120,0],
					"LV8 特製砲台「崑崙山」" : [388552,1257080,639968,0],
					"LV9 特製砲台「八卦」" : [505118,1634204,831958,0],
					"LV10 特製砲台「太極」" : [656653,2124465,1081546,0],
				},
			}
		};
	/*
		初期化
	*/
	function initMarketCostView() {

		/*
			施設名とレベルの一部から正式名を探し、データ作成
		*/
		var func = function( kind1, kind2, lv ) {
			for(var i in marketCostView_CostData[kind1]) {
				var reg = new RegExp(kind2,'');
				if(i.match(reg)) {
					if(typeof lv == 'undefined') 	return [kind1,i]
					var lastlv = 0;
					for(var j in marketCostView_CostData[kind1][i]) {
						if(j.match(/LV(\d+)/)) {
							if(parseInt(RegExp.$1,10) == lv) {
								return [kind1,i,j];
							}
							lastlv = [kind1,i,j];
						}
					}
					return lastlv;
				}
			}
			return null;
		};

		// コストをダブルクリックすると、登録
		if(ETCS_OPTION['MarketCostViewDblClick']) {
		var costnode = getNodeXPath('//*[contains(@class,"cost")]');
		if(costnode.length > 0) {
			for(var k = 0;k < costnode.length;k++) {
				var node = costnode[k];

				(function( lnode ) {
					lnode.addEventListener('dblclick',function( event ) {
						var tnode = getNodeXPath('preceding::th[contains(@class,"mainTtl")]',lnode);	//自分より前のタイトル検索
						if(tnode.length > 0) {
							var save = [];
							if(tnode[tnode.length-1].textContent.match(/^\s*(.+?)\s+レベル(\d+)(\s|$)/m)) {
								// 施設の時
								var node = getNodeXPath('preceding-sibling::th[contains(text(),"建設にかかるコスト")]',lnode);
								var name = RegExp.$1;
								if(node[0].textContent.match(/レベル.+?(\d+)/)) {
									save = func('施設建設',name,parseInt(RegExp.$1,10));
								}
							} else if(tnode[tnode.length-1].textContent.match(/^\s*(.+?)(\s|$)/m)) {
								var sol    = RegExp.$1;
								var h2node = document.getElementsByTagName('h2');
								if(typeof h2node != 'undefined') {
									if(h2node[0].textContent.match(new RegExp(GAME_TERMS['鍛冶場']))) {
										//武器研究
										var node = getNodeXPath('preceding::td[preceding-sibling::th[contains(text(),"現在の武器")]]',lnode);
										if(node[node.length-1].textContent.match(/.*?レベル\s*(\d+)\s*(.+?)(\s|$)/)) {

											save = func('研究','武器.+'+sol,(parseInt(RegExp.$1,10)+1));
										}
									} else if(h2node[0].textContent.match(new RegExp(GAME_TERMS['防具工場']))) {
										//防具研究
										var node = getNodeXPath('preceding::td[preceding-sibling::th[contains(text(),"現在の防具")]]',lnode);
										if(node[node.length-1].textContent.match(/.*?レベル\s*(\d+)\s*(.+?)(\s|$)/)) {
											save = func('研究','防具.+'+sol,(parseInt(RegExp.$1,10)+1));
										}
									} else if(h2node[0].textContent.match(new RegExp(GAME_TERMS['研究所']))) {
										// 兵種研究
										save = func('研究','研究.+'+sol);
									} else if(h2node[0].textContent.match(/施設を選ぶ/)) {
										// 施設の新規建設
										save = func('施設建設',sol,1);
									} else {
										// 兵士作成
										save = func('兵士作成',sol);
										var node = getNodeXPath('following::td[preceding-sibling::th[contains(text(),"作成する")]]/form/input[contains(@id,"unit_value")]',lnode);
										var num = parseInt(node[0].value,10);
										if(isNaN(num)) num = 1;
										save[save.length] = num;

									}
								}
							}
							if(save != null && save.length > 0) {
								var text = save[0] + "『"+save[1] + (typeof save[2] != 'undefined' ? save[2] : '')+"』";
								if(confirm(text+'をコストビューに設定しますがよろしいですか？')) {
									GM_setValue(SAVE_NAME+'MarketCostViewSelect',save.join('\t'));
								}
							} else {
								alert("3gokushi-etcsに、この武器・施設・兵士の種類などのデータは登録されていません");
							}
						} else if(location.pathname == '/facility/unit_confirm.php') {
							// 兵士作成確認画面
							var num = 0,name = '';
							var node = getNodeXPath('preceding-sibling::th',lnode);
							if(node.length > 0) {
								if(node[0].textContent.match(/(\d+)((体当たりの)|(体作成に))/)) {
									num = parseInt(RegExp.$1,10)
								}
							}
							node = getNodeXPath('//form[@name="dataForm"]/div',lnode);
							if(node.length > 0) {
								if(node[0].textContent.match(/^\s*(.+)を\d+体作成/)) {
									name = RegExp.$1;
								}
							}
							var save = func('兵士作成',name);
							save[save.length] = num;
							if(save.length > 0) {
								var text = save[0] + "『"+save[1] + (typeof save[2] != 'undefined' ? save[2] : '')+"』";
								if(confirm(text+'をコストビューに設定しますがよろしいですか？')) {
									GM_setValue(SAVE_NAME+'MarketCostViewSelect',save.join('\t'));
								}
							}

						}
					},false);
				})(node)
			}
		}
		}
		if(location.pathname != "/facility/facility.php") return;	// 施設でない

		// 制御用変数
		var procArg = {
			'event'   : [],		// イベントリスナ等を格納
			'timerID' : -1,		// 更新タイマー
			'need'	  : null,	// 必要な資源量の基本ノード
			'excess'  : null,	// 過不足の基本ノード
			'excessall':null,	// 過不足の合計
			'buy'	  : null,	// 不足量を購入するための必要な他資源の量
			'buyall'  : null,	// 必要な他資源の合計
		};
		var baseID = 'etcs_costview';

		var node = document.querySelector('#gray02Wrapper h2');
		if(node == null) return;		// h2が無い
		if(node.textContent.indexOf(GAME_TERMS["市場"]) == -1) return;	// 市場で無い

		var baseNode  = document.createElement('div');	// base
		baseNode.setAttribute('id',baseID);
		baseNode.style.cssText = 'padding:0;';

		node = baseNode.appendChild(document.createElement('div'));
		node.style.cssText = 'background: none repeat scroll 0 0 #cccccc;'+
			'border-bottom:1px solid #000000; color:#000000; padding:5px; word-wrap:break-word; text-align:center; margin-bottom:1em;';
		node.appendChild(document.createTextNode('コストビュー'));


		var deep = 0;	// 階層
		procArg['event'][procArg['event'].length] = null;	// イベントリスナリスト初期化

		// カテゴリの中身を表示部分
		var costViewNode = document.createElement('div');
		costViewNode.setAttribute('id',baseID+'_cate');
		costViewNode.style.width  = '100%';
		costViewNode.style.margin = '0 150px';
		costViewNode.textContent = '種類を選択　';
		baseNode.appendChild(costViewNode);


		// 表の作成
			var textNode = baseNode.appendChild(document.createElement('div'));
			textNode.setAttribute('id',baseID+'_table');
			textNode.innerHTML =
				'<table class="etcs_market_table"><thead>'+
				'<tr><th></th><th>'+GAME_TERMS['木']+'</th><th>'+GAME_TERMS['石']+'</th><th>'+GAME_TERMS['鉄']+'</th><th>'+GAME_TERMS['糧']+'</th></tr>'+
				'</thead><tbody>'+
				'<tr><th>必要な資源の量</th><td>---</td><td>---</td><td>---</td><td>---</td></tr>'+
				'<tr><th>過不足<br/><span style="font-size:80%">(現在量－必要量)</span></th><td>---</td><td>---</td><td>---</td><td>---</td></tr>'+
				'<tr><th>過分・不足合計</th><td colspan="4">---</td></tr>'+
				'<tr><th>不足量を購入するための<br/>必要な他資源の量</th><td>---</td><td>---</td><td>---</td><td>---</td></tr>'+
				'<tr><th>必要な他資源の合計<br/><span style="font-size:80%;">(購入に必要な資源量)</span></th><td colspan="4">---</td></tr>'+
				(ETCS_OPTION['MarketCostViewCalcFullTime'] ? '<tr><th>貯蓄完了予想時間</th><td colspan="4">--</td></tr>' : '') +
				'</tbody></table>';

		// 作成した物をHTMLに追加
		node = document.querySelector('#gray02Wrapper');
		node.appendChild(baseNode);

		var trNode = document.getElementById(baseID+'_table').getElementsByTagName('tr');
		procArg['need'] 	 = trNode[1];
		procArg['excess']	 = trNode[2];
		procArg['excessall'] = trNode[3];
		procArg['buy']		 = trNode[4];
		procArg['buyall']	 = trNode[5];

		makeMarketCostView(baseID, marketCostView_CostData, deep, procArg);
	}
	/*
		選択肢を作成し表示
	*/
	function makeMarketCostView( baseID, data , deep , procArg) {

		var i;
		var insposNode = document.getElementById(baseID+'_cate');
		var node	   = document.getElementById(baseID+'_select'+deep);

		// 自分より階層の深いノードとイベントリスナを削除
		if(node != null) {

			// 更新タイマーを停止(念のため)
			if(procArg['timerID'] != -1) {
				clearTimeout( procArg['timerID'] );
				procArg['timerID'] = -1;
			}

			// イベントリスナを削除
			for(i = procArg['event'].length - 1;i >= deep ; i--) {
				if(typeof procArg['event'][i] != 'undefined') {
					for(j = 0;j < procArg['event'][i].length; j++) {
						procArg['event'][i][j][1].removeEventListener(
									procArg['event'][i][j][0],procArg['event'][i][j][2],false);
						delete(procArg['event'][i][j]);
					}
				}
				delete(procArg['event'][i]);
			}
			// ノードを削除
			var range = document.createRange();
			range.selectNodeContents(insposNode);
			range.setStartBefore(node);
			range.deleteContents();
			range.detach();
		}

		// 内容物を指示に従って生成
		procArg['event'][deep] = [];	// 現在の階層のイベントリスと初期化
		var nowSelect = retSaveMarketCostView(deep);
		// ドロップダウンで選択する
		if(data[0] == 'select') {

			// select/option要素作成
			var selectNode = insposNode.appendChild(document.createElement('select'));
			selectNode.setAttribute('id',baseID+'_select' + deep);
			for(j in data) {
				if(j == 0) continue;	// 識別は無視

				node = document.createElement('option');
				node.appendChild(document.createTextNode(j));
				selectNode.appendChild(node);
				if(j == nowSelect) {
					selectNode.selectedIndex = selectNode.length - 1;
				}
			}
			selSaveMarketCostView(deep,selectNode.options[selectNode.options.selectedIndex].text);

			// イベント発生時
			(function( lselectNode, ldeep ){
				var func = function() {
					var select = lselectNode.options[lselectNode.options.selectedIndex].text;

					selSaveMarketCostView(ldeep, select);			// 現在の階層を保存
					delSaveMarketCostView(baseID, deep + 1);				// 次の階層以下の未使用を削除

					// 更新タイマーを停止
					if(procArg['timerID'] != -1) {
						clearTimeout( procArg['timerID'] );
						procArg['timerID'] = -1;
					}
					node = document.querySelectorAll('#'+baseID+'_table table tbody td');
					for(i = 0;i < node.length;i++) {
						node[i].textContent = '---';
						node[i].style.color = '#000000';
					}
					makeMarketCostView(baseID, data[select] , (ldeep + 1), procArg);
				}
				procArg['event'][deep][procArg['event'][ldeep].length] = ['change',selectNode,func];	// 保存
				selectNode.addEventListener('change',func,false);	// 選択されたとき
				func();					// 作成されたとき(load)

			})(selectNode,deep);

		}
		// 区切り線
		else if(data[0] == 'hr') {
		}
		// 人数入力
		else if(data[0] == 'num') {

			// 人数入力欄作成
			var inputNode = insposNode.appendChild(document.createElement('input'));
			inputNode.setAttribute('id',baseID+'_select'+deep);
			inputNode.setAttribute('type','text');
			inputNode.setAttribute('size','5');
			inputNode.setAttribute('maxlength','5');
			if(typeof nowSelect != 'undefined' && !isNaN(nowSelect)) {
				inputNode.value = nowSelect;
			} else {
				inputNode.value = 1;
			}
			insposNode.appendChild(document.createTextNode('人'));

			viewSolderMarketCostView( baseID+'_table', data[1], parseInt(inputNode.value,10), procArg);

			// イベント発生時
			(function( lNode ){

				var func = function() {
					// タイマー止める
					if(procArg['timerID'] != -1) {
						clearTimeout(procArg['timerID']);
						procArg['timerID'] = -1;
					}
					// 数値を保存
					selSaveMarketCostView(deep,parseInt(lNode.value,10));
					// 数値から計算結果を表示
					viewSolderMarketCostView( baseID+'_table', data[1], parseInt(lNode.value,10) , procArg);
				}
				// イベントを付加・保存
				procArg['event'][deep][procArg['event'][deep].length] = ['keyup',lNode,func];	// 保存
				inputNode.addEventListener('keyup',func,false);
				if(typeof nowSelect != 'undefined')  func();		// 作成されたとき(load)
			})(inputNode);

		// 数値を表示
		} else if(typeof data[0] == 'number') {
			viewSolderMarketCostView( baseID+'_table', data, 1 , procArg);
		}
	}
	/*
		必要資源量などの数値の表示
	*/
	function viewMarketCostView( id, data ,procArg) {

		var trNode = document.getElementById(id).getElementsByTagName('tr');
		if(trNode.length == 0) return;

		var stockName = ['wood', 'stone', 'iron', 'rice' ];
		var stock	  = [];
		// 現在の資源の値
		for(i =0;i < stockName.length;i++) {
			stock[i] = parseInt(document.getElementById(stockName[i]).textContent,10);
		}
		var convPer = getMarketConvPer();

		var shortage = 0;	// 不足
		var generous = 0;	// 過分
		var short_cv = 0;	// 不足変換後
		// 必要量
		var tdNode = trNode[1].getElementsByTagName('td');
		for(i = 0;i < 4;i++) {
			tdNode[i].textContent = parseInt(data[i],10);
		}
		// 過不足
		tdNode = trNode[2].getElementsByTagName('td');
		for(i = 0;i < 4;i++) {
			tdNode[i].textContent = stock[i] - parseInt(data[i],10);
			tdNode[i].style.color = stock[i] >= parseInt(data[i],10) ? "#000000" : "#ff0000";
		}
		// 不足の合計
		tdNode = trNode[3].getElementsByTagName('td');
		for(i = 0;i < 4;i++) {
			if(stock[i] < parseInt(data[i],10)) {
				shortage += stock[i] - parseInt(data[i],10);
			} else {
				generous += stock[i] - parseInt(data[i],10);
			}
		}
		tdNode[0].textContent = '過分:'+ generous +'　不足:'+ shortage;

		// 不足分を売り出す量
		tdNode = trNode[4].getElementsByTagName('td');
		for(i = 0;i < 4;i++) {
			tdNode[i].textContent = stock[i] >= parseInt(data[i],10) ? "---"
										: Math.ceil(((parseInt(data[i],10) - stock[i]) * 100 )/ convPer);
		}

		// 不足分を売り出す量の合計
		tdNode = trNode[5].getElementsByTagName('td');
		for(i = 0;i < 4;i++) {
			if(stock[i] < parseInt(data[i],10)) {
				short_cv += Math.ceil(((parseInt(data[i],10) - stock[i]) * 100 )/ convPer);
			}
		}
		if(short_cv > generous) {
			tdNode[0].textContent = short_cv +' (あと'+ (short_cv - generous) + '必要)';
		} else {
			if(short_cv == 0 && shortage == 0) {
				tdNode[0].textContent = short_cv +' (そのままで研究・作成できます)';
			} else {
				tdNode[0].textContent = short_cv +' (売買で研究・作成できます)';
			}
		}

		if(ETCS_OPTION['MarketCostViewCalcFullTime']) {
			tdNode = trNode[6].getElementsByTagName('td');
			var endTime = calcFullTime(
				stock, [
					parseInt(document.getElementById('output_wood') .textContent,10),
					parseInt(document.getElementById('output_stone').textContent,10),
					parseInt(document.getElementById('output_iron') .textContent,10),
					parseInt(document.getElementById('output_rice') .textContent,10)
				], data
			);
			tdNode[0].textContent = makeDateString(new Date(getNowTime().getTime() + endTime))+ "頃";
		}

		if(procArg['timerID'] != -1) {
			clearTimeout(procArg['timerID']);
			procArg['timerID'] = -1;
		}
		if(ETCS_OPTION['MarketCostViewTimer']) {
			procArg['timerID'] = setTimeout(function() {
				viewMarketCostView( id, data, procArg );
			},500);
		}
	}
	/*
		兵士の必要資源量の表示
	*/
	function viewSolderMarketCostView( id, data, solNum, procArg) {
		var trNode = document.getElementById(id).getElementsByTagName('tr');
		if(trNode.length == 0) return;

		var stockName = ['wood', 'stone', 'iron', 'rice' ];
		var stock	  = [];
		var price	  = [];
		var discount  = solNum < 5 ? 100 :
						solNum < 10 ? 98 :
						solNum < 20 ? 96 :
						solNum < 50 ? 94 :
						solNum < 100 ? 92 : 90;		// 割引後率
		var shortage = 0;	// 不足
		var generous = 0;	// 過分
		var short_cv = 0;	// 不足変換後

		var convPer = getMarketConvPer();

		// 現在の資源の値
		for(i =0;i < 4;i++) {
			stock[i] = parseInt(document.getElementById(stockName[i]).textContent,10);
			price[i] = Math.round((parseInt(data[i],10) * discount) / 100) * solNum;
		}

		// 必要量
		var tdNode = trNode[1].getElementsByTagName('td');
		for(i = 0;i < 4;i++) {
			tdNode[i].textContent = price[i];
		}
		// 過不足
		tdNode = trNode[2].getElementsByTagName('td');
		for(i = 0;i < 4;i++) {
			tdNode[i].textContent = stock[i] - price[i];
			tdNode[i].style.color = stock[i] >= price[i] ? "#000000" : "#ff0000";
		}
		// 不足合計
		tdNode = trNode[3].getElementsByTagName('td');
		for(i = 0;i < 4;i++) {
			if(stock[i] < price[i]) {
				shortage += stock[i] - price[i];
			} else {
				generous += stock[i] - price[i];
			}
		}
		tdNode[0].textContent = '過分:'+ generous +'　不足:'+ shortage;


		// 売り出す量
		tdNode = trNode[4].getElementsByTagName('td');
		for(i = 0;i < 4;i++) {
			tdNode[i].textContent = stock[i] >= price[i] ? "---" : Math.ceil(((price[i] - stock[i]) * 100)/convPer);
		}
		// 不足分を売り出す量の合計
		tdNode = trNode[5].getElementsByTagName('td');
		for(i = 0;i < 4;i++) {
			if(stock[i] < price[i]) {
				short_cv += Math.ceil(((price[i] - stock[i]) * 100 )/ convPer);
			}
		}
		if(short_cv > generous) {
			tdNode[0].textContent = short_cv +' (あと'+ (short_cv - generous) + '必要)';
		} else {
			if(short_cv == 0 && shortage == 0) {
				tdNode[0].textContent = short_cv + '(そのままで研究・作成できます)';
			} else {
				tdNode[0].textContent = short_cv +' (売買で研究・作成できます)';
			}
		}

		if(ETCS_OPTION['MarketCostViewCalcFullTime']) {
			tdNode = trNode[6].getElementsByTagName('td');
			var endTime = calcFullTime(
				stock, [
					parseInt(document.getElementById('output_wood') .textContent,10),
					parseInt(document.getElementById('output_stone').textContent,10),
					parseInt(document.getElementById('output_iron') .textContent,10),
					parseInt(document.getElementById('output_rice') .textContent,10)
				], price , convPer
			);
			if(endTime > 0) {
				tdNode[0].textContent = makeDateString(new Date(getNowTime().getTime() + endTime))+ "頃";
			} else {
				tdNode[0].textContent = "必要量が貯まっています"
			}
		}

		if(procArg['timerID'] != -1) {
			clearTimeout(procArg['timerID']);
			procArg['timerID'] = -1;
		}

		if(ETCS_OPTION['MarketCostViewTimer']) {
			procArg['timerID'] = setTimeout(function() {
				viewSolderMarketCostView( id, data, solNum, procArg);
			},500);
		}
	}
	/*
		現在選択中を保存
	*/
	function selSaveMarketCostView( deep , selectText ) {

		var selSave = GM_getValue(SAVE_NAME+'MarketCostViewSelect','').split(/\t/);

		if(selSave.length == 1 && selSave[0] == '') selSave = [];		// 空の時は初期化

		selSave[deep] = selectText;

		GM_setValue(SAVE_NAME+'MarketCostViewSelect',selSave.join('\t'));
	}
	/*
		現在より深い階層を削除
	*/
	function delSaveMarketCostView(baseID, deep) {

		// 現在より深い階層のIDが無ければ削除しない(LOAD)
		var node = document.getElementById(baseID+'_select' + deep);
		if(node == null) return;

		var selSave = GM_getValue(SAVE_NAME+'MarketCostViewSelect','').split(/\t/);
		var selNew	= [];
		// 現在以下の階層は削除
		for(i = 0;i < deep;i++) {
			selNew[selNew.length] = selSave[i];
		}
		GM_setValue(SAVE_NAME+'MarketCostViewSelect',selNew.join('\t'));
	}


	/*
		保存した選択中を返す
	*/
	function retSaveMarketCostView( deep ) {
		var selSave = GM_getValue(SAVE_NAME+'MarketCostViewSelect','').split(/\t/);
		if(selSave.length == 1 && selSave[0] == '') selSave = [];		// 空の時は初期化

		return(selSave[deep]);
	}

	/*
		現在資源量・増加量・目標値から、時間を計算
	*/
	function calcFullTime( now, inc, target , convPer) {
		var i,j,k;
		var data   = [{},{},{},{}];
		var time   = 0;

		for(i = 0;i < 4;i++) {
			data[i]['no']	  = i;
			data[i]['now']	  = now[i];
			data[i]['inc']	  = inc[i];
			data[i]['incOrg'] = inc[i];
			data[i]['target'] = target[i];
			data[i]['time']   = ((target[i] - now[i])) / inc[i];
		}

		for(i = 0;i < 4;i++) {
			var yojou	  = 0;
			var yojou_inc = 0;
			var fusoku	  = 0;

			// 貯まる順番に並び替え
			data = data.sort(function( a, b ) {
				return(a['time'] - b['time']);
			});

			// 次に貯まる時間まで移動
			if(data[i]['time'] > 0) {
				for(j = 0;j < 4;j++) {
					data[j]['now'] += (data[j]['inc'] * data[i]['time']);
				}
				time += data[i]['time'];
			}

			// 貯まっていたら余剰を算出
			for(j = 0;j < 4;j++) {
				if((data[j]['now'] - data[j]['target']) >= 0) {
					yojou		  += data[j]['now'] - data[j]['target'];
					yojou_inc	  += (data[j]['incOrg'] * convPer)/100;
					data[j]['now'] = data[j]['target'];
					data[j]['inc'] = 0;
				} else {
					fusoku += data[j]['target'] - data[j]['now'];
				}
			}

			// 余剰を不足しているところに、時間を基準に平均的に資源割り振り
			yojou	  = (yojou	   * convPer)/100;
			for(j = 0;j < 4;j++){
				if(data[j]['now'] - data[j]['target'] < 0) {
					data[j]['now'] += yojou 	* ((data[j]['target'] - data[j]['now']) / fusoku);
					data[j]['inc']	= yojou_inc * ((data[j]['target'] - data[j]['now']) / fusoku) + data[j]['incOrg'];
				}
				data[j]['time'] = data[j]['inc'] == 0 ? 0 : (data[j]['target'] - data[j]['now']) / data[j]['inc'];
			}

		}

		return time*60*60*1000;
	}

	//======================================
	//	class=costにtooltipで足りるか表示
	//======================================
	function checkClassCost() {

		// ツールチップ表示部分
		var costnode = document.querySelectorAll('.cost');
		for(var i = 0;i < costnode.length; i++) {
			(function(lnode) {
				lnode.addEventListener('mouseover',function(event) {
					// 表示
					var text = lnode.textContent.replace(/\r|\n/gm,'');
					if(text.match(new RegExp(GAME_TERMS['木']+'\\s+(\\d+).+?'+GAME_TERMS['石']+'\\s+(\\d+).+?'+GAME_TERMS['鉄']+'\\s+(\\d+).+?'+GAME_TERMS['糧']+'\\s+(\\d+)'))) {
						var idlist	 = ['wood','stone','iron','rice'];
						var iconList = ['/img/common/ico_wood.gif','/img/common/ico_stone.gif','/img/common/ico_ingot.gif','/img/common/ico_grain.gif'];
						var namelist = [GAME_TERMS['木s'],GAME_TERMS['石s'],GAME_TERMS['鉄s'],GAME_TERMS['糧s']];

						// 必要
						var need  = [RegExp.$1,RegExp.$2,RegExp.$3,RegExp.$4];
						var stock = [];
						var stockAll = 0;
						for(var i = 0;i < 4;i++) {
							stock[i] = parseInt(document.getElementById(idlist[i]) .textContent,10);
						}

						var convPer = ETCS_OPTION['checkClassCostPer'];
						var chk 	= [];
						var nStock	= 0;
						for(var i = 0;i < 4;i++) {
							chk[i]	= Math.ceil(((need[i] - stock[i]) * 100 )/ convPer);
						}
						var str = '';
						var cnt = 0;
						for(var i = 0;i < 4;i++) {
							if(need[i] > stock[i]) {
								str    += '<img src="'+EXIMG_URL+iconList[i]+'" style="width:20px;height:16px;position:relative;top:2px;">' + namelist[i] + '：<span style="color:#ff0000;">不足' +(need[i]-stock[i])+'('+chk[i]+')</span><br />';
								nStock += chk[i];
							} else {
								str 	 += '<img src="'+EXIMG_URL+iconList[i]+'" style="width:20px;height:16px;position:relative;top:2px;">' + namelist[i] + '：余り'+(stock[i]-need[i])+'<br />';
								stockAll += stock[i] - need[i];
								cnt++;
							}
						}

						str = (cnt == 4 ? '【実行可能】': (stockAll >= nStock ? "【売買必要】" : '【不足】')+ '(相場 '+convPer+'%)') +'<br />'+str;

						var endTime = calcFullTime(
							stock, [
								parseInt(document.getElementById('output_wood') .textContent,10),
								parseInt(document.getElementById('output_stone').textContent,10),
								parseInt(document.getElementById('output_iron') .textContent,10),
								parseInt(document.getElementById('output_rice') .textContent,10)
							], need, convPer
						);
						setToolTipCore(event, lnode,str);
					}
				}
				,false);
			})(costnode[i])
		}

		// 市場簡易登録部分
		if(location.pathname == '/facility/facility.php') {

				var node = document.querySelector('#gray02Wrapper h2');
				if(node == null || node.textContent.indexOf(GAME_TERMS["市場"]) == -1) return;	// 市場で無い
				var tdnode = getNodeXPath('//form[@name="form1"]//td[preceding-sibling::th[normalize-space(text()) = "'+GAME_TERMS["市場"]+'の取引相場"]]')[0];
				if(typeof tdnode == 'undefined') return;

				node = tdnode.appendChild(document.createElement('a'));
				node.setAttribute('title','コスト欄のツールチップで使用する相場を登録します');
				node.textContent = '登録';
				node.setAttribute('href','javascript:void(0);');

				node.style.cssText = 'float:right; margin:0;padding:0; border:none;'+
									' background:none; cursor:pointer;text-decoration:underline; color:blue;font-size:12px;';
				node.addEventListener('click', function() {

					var percent = getMarketConvPer();
					if(percent == null) return;

					GM_setValue(SAVE_NAME+"SETTING_checkClassCostPer",percent);
					ETCS_OPTION['checkClassCostPer'] = percent;
					alert('コスト欄のツールチップで使用する相場を'+percent+'%で登録しました');
				},false);
		}
	}
	//================================
	//	 資源プリセット
	//================================
	function MarketStockPreset() {

		// 処理する場所かチェック
		if(location.pathname != "/facility/facility.php") return;	// 施設?
		var result = getNodeXPath('//div[@id="gray02Wrapper"]/h2/text()')[0];
		if(result.nodeValue != GAME_TERMS["市場"]) return;
		result = document.querySelector('input[name="confirm_btn"]');
		if(result == null) return;


		// 資源の名前変換表
		var StockName = {101:GAME_TERMS["木"],102:GAME_TERMS["石"],103:GAME_TERMS["鉄"],104:GAME_TERMS["糧"]};
		var StockId   = {101:"wood",102:"stone",103:"iron",104:"rice"};
		var StockNo   = {101:0,102:1,103:2,104:3};

		// デフォルト定義
		// 種類(0:通常 1:拡張),0プリセット/1ユーザー定義,売り資源, 買い資源,量
		var defaultData = [
			[0,1,104,101,10000],	// 糧　木 10,000
			[0,1,104,102,10000],	// 糧　石 10,000
			[0,1,104,103,10000],	// 糧　鉄 10,000
			[0,1,104,101,30000],	// 糧　木 30,000
			[0,1,104,102,30000],	// 糧　石 30,000
			[0,1,104,103,30000],	// 糧　鉄 30,000
			[0,1,104,101,50000],	// 糧　木 50,000
			[0,1,104,102,50000],	// 糧　石 50,000
			[0,1,104,103,50000],	// 糧　鉄 50,000
			[0,1,104,101,100000],	// 糧　木 100,000
			[0,1,104,102,100000],	// 糧　石 100,000
			[0,1,104,103,100000],	// 糧　鉄 100,000
			[0,1,104,101,-50000],	// 糧　木
			[0,1,104,102,-50000],	// 糧　石
			[0,1,104,103,-50000],	// 糧　鉄
			[0,1,104,101,"ALL"],	// 糧　木 MAX
			[0,1,104,102,"ALL"],	// 糧　石 MAX
			[0,1,104,103,"ALL"],	// 糧　鉄 MAX
		];

		// データ格納先
		var defData = [
			[ 0, 0, -1, -1,"---未選択---"],
		];

		// OPTIONの登録関数
		var makeOptFunc = function( node, data ) {

			if(data[2] == -1 && data[3] == -1 && data[1] == 0) {
				node.appendChild(document.createTextNode((data[4]).toString()));
			} else {
				var num = data[4];
				if(num < 0) num = Math.abs(num)+"を残す";
				else if(num == 'ALL') num = "全て";

				node.appendChild(document.createTextNode(
					(data[2] == -1 ? '未設定' : StockName[data[2]])
					+"→"+
					(data[3] == -1 ? '未設定' : StockName[data[3]])
					+"("+ num +")"));
			}
		}

		// 配列に挿入
		var saveBuf = loadArray('defSellButton');
		if(saveBuf != null) {
			var tmp = defData.concat();	// コピー
			defData = tmp.slice(0,1);
			defData = defData.concat(saveBuf);
			defData = defData.concat(tmp.slice(1));
		} else {
			// ユーザー定義が保存されていなかったら、デフォルト
			defData = defData.concat(defaultData);
		}

		// 基本作成
		var baseNode = document.getElementById('gray02Wrapper').appendChild(document.createElement('div'));
		baseNode.setAttribute('id',"etcs_stockPreset");
		var node	 = baseNode.appendChild(document.createElement('h3'));
		node.textContent = '資源プリセット';

		// セレクト作成
		var selectNode = baseNode.appendChild(document.createElement('select'));
		// 登録
		for(var i = 0;i < defData.length; i++) {
			var optionNode = document.createElement('option');
			makeOptFunc( optionNode, defData[i] );
			optionNode.value = i;
			selectNode.add(optionNode);
		}
		// セレクト選択時動作
		selectNode.addEventListener('change',function() {

			var selIdx		= selectNode.selectedIndex;
			var formSelNode = getNodeXPath('//form[@name="form2"]/table//td[table]//select');
			var formInpNode = getNodeXPath('//form[@name="form2"]/table//td[table]//input')[0];

			for(var j = 0;j < 2; j++) {
				for(var k = 0;k < formSelNode[j].options.length; k++) {
					if(formSelNode[j].options[k].value == defData[selIdx][j+2]) {
						formSelNode[j].selectedIndex = k;

						// 最大値を表示させるために、イベントを送出
						if(j == 2) {
							var event = document.createEvent("MouseEvents");
							event.initEvent("change",false,true);
							formSelNode[j].dispatchEvent(event);
						}
					}
				}
			}

			//数値入力
			if(defData[selIdx][4] == 'ALL' && defData[selIdx][2] != -1) {	// 全て
				formInpNode.value = document.getElementById(StockId[defData[selIdx][2]]).textContent;

			} else	if(defData[selIdx][4] < 0 && defData[selIdx][2] != -1) {	// 残す
				var num = parseInt(document.getElementById(StockId[defData[selIdx][2]]).textContent,10) + parseInt(defData[selIdx][4],10);
				num = num < 0 ? 0 : num;
				formInpNode.value = num;

			} else	if(!isNaN(defData[selIdx][4])) {
				formInpNode.value = defData[selIdx][4];	// 通常
			} else {
				formInpNode.value = '';	// 無効
			}
		},false);

		// ユーザー定義登録
		node = baseNode.appendChild(document.createElement('br'));
		node = baseNode.appendChild(document.createElement('input'));
		node.setAttribute('type','button');
		node.setAttribute('value','登録');
		node.setAttribute('title','現在の内容を登録します');

		node.addEventListener('click', function() {
			var formSelNode = getNodeXPath('//form[@name="form2"]/table//td[table]//select');
			var formInpNode = getNodeXPath('//form[@name="form2"]/table//td[table]//input')[0];

			var selId  = formSelNode[0].options[formSelNode[0].selectedIndex].value;
			var buyId  = formSelNode[1].options[formSelNode[1].selectedIndex].value;
			var selNum = formInpNode.value;

			// 数値で無いので空白で登録
			if(selNum.match(/all/i)) {	// 全て
				selNum = 'ALL';
			} else if(selNum != '' && isNaN(selNum)) {	// 不正
				selNum = '';
			} else if(selNum == '') {
				selNum = '';
			} else if(selNum > 10000000 || selNum < -10000000) {// 多すぎる値なので空白(1000万)
				selNum = '';
			} else {
				selNum = parseInt(selNum,10);
			}

			// 配列に挿入
			var tmp = defData.concat();	// コピー
			defData = tmp.slice(0,1);
			defData[defData.length] = [0, 1, selId, buyId, selNum];
			defData = defData.concat(tmp.slice(1));

			// ノードに挿入
			var optionNode = document.createElement('option');
			makeOptFunc( optionNode, defData[1] );
			selectNode.add(optionNode,1);

			// 保存
			var saveBuf = [];
			for(var i = 0;i < defData.length; i++) {
				if(defData[i][1] == 1) saveBuf[saveBuf.length] = defData[i];
			}
			saveArray('defSellButton', saveBuf)

		},false);


		// ユーザー定義削除
		node = baseNode.appendChild(document.createElement('input'));
		node.setAttribute('type','button');
		node.setAttribute('value','削除');
		node.setAttribute('title','現在選択されている物を削除します');
		node.addEventListener('click', function() {
			var num = selectNode.selectedIndex;
			if(defData[num][1] == 1) {
				defData.splice(num,1);
				selectNode.remove(selectNode.selectedIndex);
			} else {
				alert("これは削除できません");
			}

			// 保存
			var saveBuf = [];
			for(var i = 0;i < defData.length; i++) {
				if(defData[i][1] == 1) saveBuf[saveBuf.length] = defData[i];
			}
			saveArray('defSellButton', saveBuf)

		},false);

		// 表示位置の変更
		var tblNode = getNodeXPath('//form[@name="form2"]/table')[0];
		baseNode.style.cssText = 'z-index:100; background:#ffffff;';
		baseNode.style.left = tblNode.offsetLeft+ 515 + 'px';
		baseNode.style.top	= tblNode.offsetTop +  50 + 'px';

	}

	//================================
	//	 兵士数割引後の最大値表示
	//================================
	function makeDisSolMax() {

		if(location.pathname != '/facility/facility.php') return;
		var i,j,k;

		var node = document.querySelector('#gray02Wrapper h2');
		if((node == null) || !node.textContent.match(new RegExp(GAME_TERMS['練兵所']+"|"+GAME_TERMS['兵舎']+"|"+GAME_TERMS['弓兵舎']+"|"+GAME_TERMS['厩舎']+"|"+GAME_TERMS['兵器工房']))) return;	// 対象の施設で無い

		var idlist	 = ['wood','stone','iron','rice'];
		var stock = [];
		for(i = 0;i < 4;i++) {
			stock[i] = parseInt(document.getElementById(idlist[i]).textContent,10);
		}

		var formNode = getNodeXPath('//form[@name="createUnitForm"]/input[contains(@id,"unit_value")]');
		if(formNode.length == 0) return;


		var maxFlag = false;
		for(i in formNode) {
			var id	   = parseInt(formNode[i].getAttribute('id').replace(/.*unit_value\[(\d+)\].*/,'$1'),10);
			var normalMax = 0;
			var min = 9999999;

			// 最大兵士作成数を計算する(solID:兵士ID,flag:true->ディスカウント有り)
			var solCalcFunc = function( solID , flag ) {
				var disData = [[1,100],[5,98],[10,96],[20,94],[50,92],[100,90]];
				var cnvData = {	301:'剣兵',
								303:'槍兵',
								304:'矛槍兵',
								305:'騎兵',
								307:'近衛騎兵',
								308:'弓兵',
								309:'弩兵',
								310:'斥候',
								311:'斥候騎兵',
								312:'衝車',
								313:'投石機',
								316:'盾兵',
								317:'重盾兵',
								315:'大剣兵'
							};
				var cost,allcost,discost;
				var min = 9999999;
				try {
				for(j = 0;j < 4;j++) {
					cost = marketCostView_CostData['兵士作成'][cnvData[solID]][1][j];
					if(cost == 0) continue;		// コスト0はスキップ
					for(k = disData.length - 1; k >= 0;k--) {
						discost = flag ? Math.round((cost * disData[k][1]) / 100) : cost;
						if(stock[j] >= discost * disData[k][0]) {
							var sol = parseInt(stock[j] / discost,10);
							if(min > sol) min = sol;
							break;
						}
					}
				}
				} catch(e) {
				console.log(e);
					return null;
				}
				return min;
			};

			// 割引無しの最大兵士数から、最大兵士数を算出
			node   = formNode[i].parentNode.getElementsByTagName('span');
			if(node.length == 0) continue;		// 無いと思うが
			if(node[0].getAttribute('onclick').match(/\'(\d+)'.*?\)/)) {
				normalMax = parseInt(RegExp.$1,10);
			}
			var tmp = solCalcFunc(id,false);
			if(tmp == null) return;
			if(normalMax < tmp) {
				min = normalMax;									// 割引無しから算出した最大兵士数を使用
			} else {
				min = solCalcFunc(id,true);	// 割引有り
				var save = loadVillageData('AccommodationFree');	// 保存していた最大兵士数を使用
				if(save != null) {
					save = parseInt(save,10);
					if(save < min) min = save;
				}
			}

			// 表示
			var overfunc = function(event) { event.target.style.color = '#ffffff'; event.target.style.backgroundColor='#0000ff'; }
			var outfunc  = function(event) { event.target.style.color = '#0000ff'; event.target.style.backgroundColor=''; }
			var orgnode = formNode[i].parentNode.getElementsByTagName('span')[0];
			orgnode.setAttribute('title','割引なしのコストで作成できる兵の最大数');
			orgnode.addEventListener('mouseover',overfunc,false);
			orgnode.addEventListener('mouseout' ,outfunc ,false);
			node = formNode[i].parentNode.insertBefore( orgnode.cloneNode(true), orgnode.nextSibling);


			node.textContent = '[割:'+min+']';
			node.setAttribute('onclick',node.getAttribute('onclick').replace(/(\,\s+\')(\d+)(\'\))/,'$1'+min+'$3'));
			node.setAttribute('title','割引後のコストで作成できる兵の最大数');
			node.addEventListener('mouseover',overfunc,false);
			node.addEventListener('mouseout' ,outfunc ,false);

		}
	}
	//================================
	//		  入力文字数表示
	//================================
	/*
		イベントセット
	*/
	function setEvent_chkInputStrLen() {

		var node,baseNode;

		// ひとこと
		if(ETCS_OPTION['InputStrLen_Chat']) {
			addEventByXPath('//input[@id="comment_str"]','keyup',  chkInputStrLen_hitokoto,true);
			addEventByXPath('//input[@id="comment_str"]','change', chkInputStrLen_hitokoto,true);
			node = document.createElement('div');
			node.setAttribute('id','comment_str_etcsChkLen');
			getNodeXPath('//input[@id="comment_str"]')[0].parentNode.appendChild(node);

			chkInputStrLen_hitokoto();
		}

		var pathdata = [
		// 書簡
		['InputStrLen_Mail','/message/new.php','//form[@name="message"]//textarea[@name="body"]','th','bbsres_view_etcsChkLen'],
		// 同盟掲示板レス
		['InputStrLen_BBS','/bbs/res_view.php','//form[@name="input_form"]//textarea[@name="comment"]','td','bbsres_view_etcsChkLen'],
		// 同盟掲示板レス(新規スレッド)
		['InputStrLen_BBS','/bbs/topic_add.php','//form[@name="input_form"]//textarea[@name="comment"]','td','bbsres_view_etcsChkLen'],
		['InputStrLen_BBS','/bbs/topic_add.php','//form[@name="input_form"]//input[@name="title"]','td','bbsres_view_etcsChkLenTitle'],
		// 個人掲示板新規(本文)
		['InputStrLen_PersonBBS','/bbs/personal_topic_add.php','//form[@name="input_form"]//textarea[@name="comment"]','td','bbsres_view_etcsChkLen'],
		// 個人掲示板新規(タイトル)
		['InputStrLen_PersonBBS','/bbs/personal_topic_add.php','//form[@name="input_form"]//input[@name="title"]','td','bbsres_view_etcsChkLenTitle'],
		// 個人掲示板レス(本文)
		['InputStrLen_PersonBBS','/bbs/personal_res_view.php','//form[@name="input_form"]//textarea[@name="comment"]','td','bbsres_view_etcsChkLen'],
		];

		for(i in pathdata) {
			if(!(ETCS_OPTION[pathdata[i][0]] && (location.pathname == pathdata[i][1]))) continue;

			baseNode = getNodeXPath(pathdata[i][2]);
			if(baseNode.length == 0) continue;

			(function( lbaseNode , idstr ) {
				lbaseNode.addEventListener('keyup',  function(){
							chkInputStrLen_res_view(idstr,lbaseNode);},true);
				lbaseNode.addEventListener('change', function(){
							chkInputStrLen_res_view(idstr,lbaseNode);},true);
			})(baseNode[0],pathdata[i][4]);

			node = baseNode[0].parentNode.parentNode.getElementsByTagName(pathdata[i][3])[0];
			node.innerHTML += '<br><span class="bbsres_view_etcsChkLenCss" id="'+pathdata[i][4]+'"></span>';

			chkInputStrLen_res_view(pathdata[i][4],baseNode[0]);

		}
	}
	/*
		ひとことの文字数表示(改行なし)
	*/
	function chkInputStrLen_hitokoto() {
		document.getElementById('comment_str_etcsChkLen').innerHTML =
						 '入力文字数:'+document.getElementById('comment_str').value.length+'/30';
	}
	/*
		掲示板スレッド・書簡の文字数表示
	*/
	function chkInputStrLen_res_view( id, node ) {

		var encstr = node.value;
		encstr	   = encstr.replace(/\r\n|\r|\n/g,'\r\n');	// 改行は2バイト(OS依存？)

		document.getElementById(id).innerHTML = '入力文字数:'+encstr.length;
	}

	// ========================
	//	  マップドラッグ
	// ========================
	/*
		マップドラッグ初期化(イベント設定)
	*/
	function initMapDrag() {

		var mapNode = document.getElementById("mapsAll");
		if(ETCS_OPTION['MapDragPosMove'] != true || mapNode == null) {
			mapNode = document.getElementById("map51-content");
			if(ETCS_OPTION['MapDragPosMovex51'] != true || mapNode == null) return;
		}

		mapNode.addEventListener( "mousedown", StartMapDrag, false);
		mapNode.addEventListener( "click", MapDrag_LinkCancel, false);


	}
	/*
		マウスドラッグ開始
	*/
	function StartMapDrag(event) {

		var flagx51 = false;
		var mapNode = document.getElementById("mapsAll");
		if(mapNode == null) {
			mapNode = document.getElementById("map51-content");
			flagx51 = true;
			if(mapNode == null) return;
		}

		if(event.button != 0) return;

		mapsall_initX = mapNode.offsetLeft;
		mapsall_initY = mapNode.offsetTop;

		dragStartPosX = event.clientX + window.pageXOffset;
		dragStartPosY = event.clientY + window.pageYOffset;

		document.addEventListener( "mousemove", MapDrag,	  false);
		document.addEventListener( "mouseup",	EndMapDrag,   false);

		// ダミーを作成
		if(flagx51 && document.getElementById('etcs_mapdrag_51xdummy') == null) {
			var style = document.defaultView.getComputedStyle(mapNode,'');
			var dummy = document.createElement('table');
			var node  = dummy;
			dummy.setAttribute('id','etcs_mapdrag_51xdummy');
			for(var y = 0;y < 51;y++) {
				node = dummy.appendChild(document.createElement('tr'));
				for(var x = 0;x < 51;x++) {
					var node2 = node.appendChild(document.createElement('td'));
					node2.textContent = '';
					node2.style.cssText = 'border:1px dotted #888888;';
				}
			}
			mapNode.parentNode.insertBefore(dummy,mapNode.nextSibling);
			dummy.style.width  = style.width;
			dummy.style.height = style.height;
			dummy.style.left   = mapNode.offsetLeft + 'px';
			dummy.style.position = 'relative';
			dummy.style.border = '1px solid #888888';
			mapNode.style.position = "absolute";
			mapNode.style.zIndex = '10';
		}



		event.preventDefault();

	}
	/*
		マウスドラッグ終了
	*/
	function EndMapDrag(event) {
		var pos;
		var flagx51 = false;
		var mapNode = document.getElementById("mapsAll");
		if(mapNode == null) {
			mapNode = document.getElementById("map51-content");
			if(mapNode == null) return;
			flagx51 = true;
		}
		document.removeEventListener( "mousemove", MapDrag,    false);
		document.removeEventListener( "mouseup",   EndMapDrag, false);

		// 移動量によって決める
		if(MapDragCalcRange((event.clientX + window.pageXOffset),(event.clientY + window.pageYOffset),
																			dragStartPosX,dragStartPosY) >= 5) {
			if(flagx51) {
				var sxy = getNowPos();
				if(sxy == null) return;
				var mx = (event.clientX + window.pageXOffset) - dragStartPosX;
				var my = (event.clientY + window.pageYOffset) - dragStartPosY;
				mx += (mx == 0 ? 0 : (mx > 0 ? 1 : -1) * 5);
				my += (my == 0 ? 0 : (my > 0 ? 1 : -1) * 5);
				pos = [
					sxy[0] - parseInt(mx / 14),
					sxy[1] + parseInt(my / 14),
					sxy[0],
					sxy[1]
				];
			} else {
				pos = MapDragPosConv( event );
			}
			if(pos[0] != pos[2] || pos[1] != pos[3]) {
				location.href = MAPMOVE_URL+'x='+ pos[0] + '&y=' + pos[1];
			} else {
				mapNode.style.left = mapsall_initX+"px";
				mapNode.style.top  = mapsall_initY+"px";
			}
		} else {
			mapNode.style.left = mapsall_initX+"px";
			mapNode.style.top  = mapsall_initY+"px";
			if(flagx51) {
				var node = document.getElementById('etcs_mapdrag_51xdummy');	// 使い終わったダミーを片付け
				node.parentNode.removeChild(node);
				mapNode.style.opacity = '';
			}
		}
		event.preventDefault();
	}
	/*
		マウスドラッグ中(移動中)
	*/
	function MapDrag(event) {

		var elx,ely;
		var mapNode = document.getElementById("mapsAll");
		var flagx51 = false;
		if(mapNode == null) {
			mapNode = document.getElementById("map51-content");
			if(mapNode == null) return;
			flagx51 = true;
		}


		var scaleNode = getNodeXPath('//div[@id="change-map-scale"]/ul/li');

		// マウス移動量
		elx = (event.clientX + window.pageXOffset) - dragStartPosX + mapsall_initX;
		ely = (event.clientY + window.pageYOffset) - dragStartPosY + mapsall_initY;

		mapNode.style.position = "absolute";
		mapNode.style.left = elx+"px";
		mapNode.style.top  = ely+"px";


		if(flagx51 && MapDragCalcRange((event.clientX + window.pageXOffset),(event.clientY + window.pageYOffset),
																			dragStartPosX,dragStartPosY) >= 5) {
			mapNode.style.opacity = 0.5;
		}


		event.preventDefault();
	}
	/*
		マップドラッグ　リンクキャンセル
	*/
	function MapDrag_LinkCancel( event ) {

		// 移動量によって決める
		if(MapDragCalcRange((event.clientX + window.pageXOffset),(event.clientY + window.pageYOffset),
																			dragStartPosX,dragStartPosY) >= 5) {
			event.preventDefault();
		}

	}
	/*
		移動量計算
	*/
	function MapDragCalcRange( x1, y1, x2, y2 ) {
		return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
	}
	/*
		座標変換
	*/
	function MapDragPosConv( event ) {

		var ret = [];
		var mx,my;
		var px,py,nx,ny;
		var psin,pcos;
		var nowX,nowY,scale;
					//	W,H,遊びW,遊びH
		var scaleSize = [[42.9,42.7,0.4,0.4],[31.3,31.3,0.5,0.5],[22.7,22.7,0.3,0.3],[12,12,0.3,0.3]];
		var scaleNode = getNodeXPath('//div[@id="change-map-scale"]/ul/li');
		for(scale = 0;scale < scaleNode.length; scale++) {
			if(scaleNode[scale].getAttribute('class').match(/now/)) {
				break;
			}
		}

		mx = (event.clientX + window.pageXOffset) - dragStartPosX;
		my = (event.clientY + window.pageYOffset) - dragStartPosY;
		px = (mx * -1);
		py = (my * -2);

		// 回転 mx = x * sin(rad)
		psin = Math.sin(Math.PI*(45/180));
		pcos = Math.cos(Math.PI*(45/180));

		nx = (Math.floor(px * psin + py * pcos)) / scaleSize[scale][0];
		ny = (Math.floor(px * pcos - py * psin)) / scaleSize[scale][1];

		nx = nx + (nx == 0 ? 0 : (nx > 0 ? 1 : -1) * scaleSize[scale][2]);
		ny = ny + (ny == 0 ? 0 : (ny > 0 ? 1 : -1) * scaleSize[scale][3]);

		nowX = parseInt(getNodeXPath('//div[@id="datas"]/input[@id="x"]')[0].value);
		nowY = parseInt(getNodeXPath('//div[@id="datas"]/input[@id="y"]')[0].value);

		ret[0] = nowX + parseInt(nx);
		ret[1] = nowY + parseInt(ny);
		ret[2] = nowX;
		ret[3] = nowY;

		return ret;
	}
	/*
		現在地を取得(map.php / big_map.php)
	*/
	function getNowPos() {

		var node = document.querySelector("#change-map-scale .sort11 a");
		if(node == null) return null;
		var pos  = getPosFromURI(node.getAttribute('href'));

		return pos;
	}

	// ========================
	//		車ダメージ計算
	// ========================
	function carDmgCalc() {
		// 鍛冶場を開いたときに自動保存
		if(location.pathname == '/facility/facility.php') {

			var result = getNodeXPath('//div[@id="gray02Wrapper"]/h2/text()')[0].textContent;
			if(result.indexOf(GAME_TERMS['鍛冶場']) == -1) return;	// 鍛冶場で無ければ終了

			var vData = getVillageDataFromID();
			if(vData == null) {
				console.log('carDmgCalc:拠点情報が取得できませんでした');
				return;
			}

			var smithyLv = 0;
			var ramLv	 = 0;
			var catLv	 = 0;

			result = getNodeXPath('id("gray02Wrapper")//table[contains(@class,"commonTables")]//th[contains(@class,"mainTtl")]/div[contains(@class,"th_ttl")]');
			if(result.length > 0) {
				smithyLv = parseInt(result[0].textContent.replace(/^.+レベル\s*(\d+).*$/,"$1"),10);	// 鍛冶場レベル
			}

			result = getNodeXPath('id("gray02Wrapper")//table[contains(@class,"commonTables")]//tr[preceding-sibling::tr/th[contains(@class,"mainTtl6") and (text() = "'+GAME_TERMS['衝車']+'")]]/td[contains(@class,"contents")]');
			if(result.length > 0) {
				ramLv = result[0].textContent.replace(/\r|\n/gm,"")
				ramLv = parseInt(ramLv.replace(/^.*?レベル\s*(\d+).+$/m,"$1"));
			}

			result = getNodeXPath('id("gray02Wrapper")//table[contains(@class,"commonTables")]//tr[preceding-sibling::tr/th[contains(@class,"mainTtl6") and (text() = "'+GAME_TERMS['投石機']+'")]]/td[contains(@class,"contents")]');
			if(result.length > 0) {
				catLv = result[0].textContent.replace(/\r|\n/gm,"")
				catLv = parseInt(catLv.replace(/^.*?レベル\s*(\d+).+$/m,"$1"));
			}
			var savestr = new Date() + '\t' + smithyLv + '\t' + ramLv + '\t' + catLv;

			GM_setValue(SAVE_NAME+'carDmgCalc_Setting_'+vData[0], savestr);

			return;
		}

		if(location.pathname != '/facility/castle_send_troop.php') return;
		var skillData = {
			 active : {
			"兵器の進撃": {reg : /.*城・砦・村への攻撃力が(\d+(\.\d+)?)%上昇する.*/,base:'$1',add:'',dist:'', distif:'' },
			"兵器の強撃": {reg : /.*城・砦・村への攻撃力が(\d+(\.\d+)?)%上昇する.*/,base:'$1',add:'',dist:'', distif:'' },
			"兵器の猛撃": {reg : /.*城・砦・村への攻撃力が(\d+(\.\d+)?)%上昇する.*/,base:'$1',add:'',dist:'', distif:'' },
			"兵器の極撃": {reg : /.*城・砦・村への攻撃力が(\d+(\.\d+)?)%上昇する.*/,base:'$1',add:'',dist:'', distif:'' },
			"兵器突撃"	: {reg : /.*城・砦・村への攻撃力が(\d+(\.\d+)?)%.*/,base:'$1',add:'',dist:'', distif:'' },
			"兵器突覇"	: {reg : /.*城・砦・村への攻撃力が(\d+(\.\d+)?)%.*/,base:'$1',add:'',dist:'', distif:'' },
			"智将器撃"	: {reg : /.*城・砦・村への攻撃力が(\d+(\.\d+)?)%.*/,base:'$1',add:'',dist:'', distif:'' },
			"苦肉の計"	: {reg : /.*兵器の攻撃力が(\d+(\.\d+)?)%.*ダメージを(\d+(\.\d+)?)追加.*/,base:'$1',add:'$3',dist:'',distif:'' },
			"皇叔の号令": {reg : /.*兵器の攻撃力が(\d+(\.\d+)?)%.*ダメージを(\d+(\.\d+)?)追加.*/,base:'$1',add:'$3',dist:'',distif:'' },
			"陥陣営の侵攻":{reg : /.*城・砦・村への攻撃力(\d+(\.\d+)?)%.*/,base:'$1',add:'',dist:'',distif:'' },
			"智将砕器":{reg : /.*城・砦・村への攻撃力(\d+(\.\d+)?)%.*/,base:'$1',add:'',dist:'',distif:'' },
			"隣地攻城"	: {reg : /.*出兵距離が(\d+)以下.+兵器の城・砦・村への攻撃力が(\d+(\.\d+)?)%上昇する.*/,base:'$2',add:'',dist:'$1', distif:'<=' },
			"攻城戦の極砕"	: {reg : /.*兵器の拠点への攻撃力が(\d+(\.\d+)?)%.*ダメージを(\d+(\.\d+)?)追加.*/,base:'$1',add:'$3',dist:'',distif:'' },
			},
			passive : {
			"兵器の進攻": {reg : /.*城・砦・村への攻撃力(\d+(\.\d+)?)%.*/,base:'$1',add:'',dist:'', distif:'' },
			"兵器の強攻": {reg : /.*城・砦・村への攻撃力(\d+(\.\d+)?)%.*/,base:'$1',add:'',dist:'', distif:'' },
			"兵器の猛攻": {reg : /.*城・砦・村への攻撃力(\d+(\.\d+)?)%.*/,base:'$1',add:'',dist:'', distif:'' },
			"兵器の極攻": {reg : /.*城・砦・村への攻撃力(\d+(\.\d+)?)%.*/,base:'$1',add:'',dist:'', distif:'' },
			}
		};

		var baseNode = document.getElementById('gray02Wrapper');	// 追加先

		// 出兵画面で拠点ごとの設定
		var carDmgNode = document.createElement('div');
		carDmgNode.setAttribute('id','etcs_cardmg');

		var vData = getVillageDataFromID();
		if(vData == null) {
			return;
		}

		var node,selNode,cntNode,smithNode,ramNode,catNode;
		var savedata;

		// 自動保存
		var savefunc = function() {

			var smithLv = parseInt(smithNode.value,10);
			var ramLv	= parseInt(  ramNode.value,10);
			var catLv	= parseInt(  catNode.value,10);
			var savestr = new Date() + '\t' + smithLv + '\t' + ramLv + '\t' + catLv;

			GM_setValue(SAVE_NAME+'carDmgCalc_Setting_'+vData[0], savestr);
		}

		savedata = GM_getValue(SAVE_NAME+'carDmgCalc_Setting_'+vData[0],'未保存\t0\t0\t0').split(/\t/);


		// タイトル
		node = document.createElement('div');
		node.textContent = vData[3] + ' の'+GAME_TERMS['鍛冶場']+'設定';
		node.style.cssText = 'padding:4px 1em; color:#ffffff; background-color:#000000; font-weight:bold;';
		carDmgNode.appendChild(node);
		// 選択
		cntNode   = document.createElement('div');
		cntNode    .appendChild(document.createTextNode(GAME_TERMS['鍛冶場']+'レベル'));
		smithNode = cntNode.appendChild(document.createElement('select'));
		for(i = 0;i < 11;i++) {
			node	= smithNode.appendChild(document.createElement('option'));
			node.textContent = 'LV'+i;
			node.setAttribute('value',i);
		}
		smithNode.selectedIndex = savedata[1];
		smithNode.addEventListener('change', savefunc, false);

		cntNode.appendChild(document.createTextNode(' '+GAME_TERMS['衝車']+'武器レベル'));
		ramNode = cntNode.appendChild(document.createElement('select'));
		for(i = 0;i < 11;i++) {
			node	= ramNode.appendChild(document.createElement('option'));
			node.textContent = 'LV'+i;
			node.setAttribute('value',i);
		}
		ramNode.selectedIndex = savedata[2];
		ramNode.addEventListener('change', savefunc, false);

		cntNode.appendChild(document.createTextNode(' '+GAME_TERMS['投石機']+'武器レベル'));
		catNode = cntNode.appendChild(document.createElement('select'));
		for(i = 0;i < 11;i++) {
			node	= catNode.appendChild(document.createElement('option'));
			node.textContent = 'LV'+i;
			node.setAttribute('value',i);
		}
		catNode.selectedIndex = savedata[3];
		catNode.addEventListener('change', savefunc, false);

		carDmgNode.appendChild(cntNode);
		baseNode.appendChild(carDmgNode);

		// ここから先は出兵確認画面のみ
		var basenode = getNodeXPath('//table[@class="fighting_about"]/tbody/tr/th')[0];
		if(typeof basenode == 'undefined') return;
		if(basenode.getAttribute('class') == 'suport') return;	// 援軍は表示しない


		//
		// 算出
		//

		// 台数取得
		var ram_cnt = parseInt(getNodeXPath('//input[@name = "ram_count"]'	   )[0].value,10);	// 衝車
		var cat_cnt = parseInt(getNodeXPath('//input[@name = "catapult_count"]')[0].value,10);	// 投石機

		ram_cnt 	= isNaN(ram_cnt) ? 0 : ram_cnt;
		cat_cnt 	= isNaN(cat_cnt) ? 0 : cat_cnt;

		if(ram_cnt == 0 && cat_cnt == 0) return;		// 車が無しの時表示しない
	// 計算して表示
	var func = function() {
	var ram_cnt = parseInt(getNodeXPath('//input[@name = "ram_count"]'	   )[0].value,10);	// 衝車
	var cat_cnt = parseInt(getNodeXPath('//input[@name = "catapult_count"]')[0].value,10);	// 投石機

	ram_cnt 	= isNaN(ram_cnt) ? 0 : ram_cnt;
	cat_cnt 	= isNaN(cat_cnt) ? 0 : cat_cnt;

	// スキル取得
	var skillper = 0;	// スキルでの増加[率]
	var skilladd = 0;	// スキルでの加算数(苦肉用)
	var per,add,name;
	var startPos = getNowVillagePos();		// 現在の位置
	// 到着地点の場所から距離を算出
	var dist	 = 0;
	node = document.querySelector('table.fighting_about td strong');
	if(node !== null) {
		endPos = node.textContent.match(/\(\s*(-?\d+)\s*,\s*(-?\d+)\s*\)\s*$/);
		dist   = MapDragCalcRange(startPos[0], startPos[1], endPos[1], endPos[2]);	// 距離計算
		dist   = Math.round(dist*100)/100; //丸め
	}
	// 使用アクティブスキル
	node = getNodeXPath('//div[@class = "useSkill"]/p[@class="skillTitle"]');
	if(node.length > 0) {
		name = node[0].textContent.replace(/\s|\r|\n/gm,'');
		name = name.replace(/(.+?)LV.+/,'$1');
		if(typeof skillData.active[name] != 'undefined') {
			node = getNodeXPath('//div[@class = "useSkill"]/p[@class="skillInfo"]');
			var useFlag = true;
			if(skillData.active[name]['dist'] !== "") {
				useFlag = false;
				skillDist = parseFloat(node[0].textContent.replace(skillData.active[name]['reg'],skillData.active[name]['dist']));
				if(skillData.active[name]['distif'] === "<=") {//以下
					if(dist <= skillDist) useFlag = true;
				} else if(skillData.active[name]['distif'] === "<") {//未満
					if(dist < skillDist) useFlag = true;
				} else if(skillData.active[name]['distif'] === ">") {//より大きい
					if(dist > skillDist) useFlag = true;
				} else if(skillData.active[name]['distif'] === ">=") {//以上
					if(dist >= skillDist) useFlag = true;
				}
			}
			per = 0;
			add = 0;
			if(useFlag) {

				per = parseFloat(node[0].textContent.replace(skillData.active[name]['reg'],skillData.active[name]['base']));
				add = parseFloat(node[0].textContent.replace(skillData.active[name]['reg'],skillData.active[name]['add']));
			}
			skillper += isNaN(per) ? 0 : per;	// 無いときは0
			skilladd += isNaN(add) ? 0 : add;	// 無いときは0
		}
	}
	// パッシブスキル
	for(i = 1;i <= 3;i++) {
		node = document.querySelector('div[id^="cardWindow_"] .back_skill span.skillName'+i+'.red');
		if(node === null) continue;

		name = node.textContent.replace(/\s|\r|\n/gm,'');
		name = name.replace(/.*?[:：](.+?)LV.+/,'$1');
		if(typeof skillData.passive[name] != 'undefined') {
			node = document.querySelector('div[id^="cardWindow_"] .back_skill div.skill'+i+'');
			if(node === null) continue;
			var useFlag = true;
			if(skillData.passive[name]['dist'] !== "") {
				useFlag = false;
				skillDist = parseFloat(node.textContent.replace(skillData.passive[name]['reg'],skillData.passive[name]['dist']));
				if(skillData.passive[name]['distif'] === "<=") {//以下
					if(dist <= skillDist) useFlag = true;
				} else if(skillData.passive[name]['distif'] === "<") {//未満
					if(dist < skillDist) useFlag = true;
				} else if(skillData.passive[name]['distif'] === ">") {//より大きい
					if(dist > skillDist) useFlag = true;
				} else if(skillData.passive[name]['distif'] === ">=") {//以上
					if(dist >= skillDist) useFlag = true;
				}
			}
			per = 0;
			add = 0;
			if(useFlag) {
				per = parseFloat(node.textContent.replace(skillData.passive[name]['reg'],skillData.passive[name]['base']));
				add = parseFloat(node.textContent.replace(skillData.passive[name]['reg'],skillData.passive[name]['add']));
			}
			skillper += isNaN(per) ? 0 : per;	// 無いときは0
			skilladd += isNaN(add) ? 0 : add;	// 無いときは0
		}
	}


			var smithyData = [0,0,1.5,3,4.5,6,7.5,9,10.5,12,15];	//鍛冶場+ATK%
			var ramData    = [0,3, 6, 9,12,15,18,21,25,29,35];	//衝車+ATK%
			var catData    = [0,5,10,15,21,28,36,45,56,69,85];	//投石+ATK%

			var smithLv = parseInt(smithNode.value,10);
			var ramLv	= parseInt(  ramNode.value,10);
			var catLv	= parseInt(  catNode.value,10);
			var domsPer = document.getElementById('etcs_cardmg_input').value;
			domsPer 	= isNaN(domsPer) ? 0 : +domsPer;

			var addper	= skillper + smithyData[smithLv] + domsPer;

			var dmg = parseInt((ram_cnt * (100 + addper  + ramData[ramLv])
					+ cat_cnt * (100 + addper + catData[catLv]))/100,10)
					+ skilladd;

			// ダメージ追加
			var node = getNodeXPath('//form[@name="input_troop"]//div[contains(@class,"fightingpower")]/dl/dd[preceding-sibling::dt[contains(text(),"拠点ダメージ")]]/*');
			if(node.length > 0) {
				node[0].textContent = dmg;
				node[1].textContent = '技:'+skillper+'%';
				node[2].textContent = ' 鍛:'+smithyData[smithLv]+'%';
				node[3].textContent = ' 車:'+ramData[ramLv] 	+'%';
				node[4].textContent = ' 投:'+catData[catLv] 	+'%';
			}
		}

		// ダメージの項目追加
		var dlnode = getNodeXPath('//form[@name="input_troop"]//div[contains(@class,"fightingpower")]/dl');
		if(dlnode.length > 0) {
			node = dlnode[0].appendChild(document.createElement('dt'));
			node.textContent = '拠点ダメージ';
			node.setAttribute('class','type2');
			node.style.background ='url("data:image/png;base64,'+
					'iVBORw0KGgoAAAANSUhEUgAAAG0AAAAoCAYAAAD0bXSJAAAAAXNSR0IArs4c6QAABUJJREFU'+
					'eNrtmt9LFF0Yx79nZnZWN3Vi1bFy88KISJIFBYPACoLwQkiN6CIiSCgQvOkigjTf7voXuqmb'+
					'uukqWSKCSgghsBIvggqjlCz8tem67ujsnpnvexHOq69v9Sa4q3C+8CzDOTtz8f3wPOc5Z0bg'+
					'HxFKW10i+NkIsNLSUoTDYZSUlGBsbEzZmUdwxkYzbNeuXdB1He/fv1c25lcUG4VmGAZM0wQA'+
					'OI6jrMxzjfwjaJqmwfd9CCEghICmaZBSKicLBU2tU9tDxp+uU42NjaisrMTExATevn2rHCw0'+
					'tM+fP8M0TUQikTXrlBAC5I+E3LdvHxzHga7ryr0CSQfwl6ZpIAmSkFLC932QRFNTE75//45c'+
					'LhfcUFVVheXlZQgh0NnZCSGEKqWFaCF/FkVFRT+de/bsGUlyYGBgzXgoFGJRURENw+Cvnq1i'+
					'46HZto379+9jaGgI7e3ta2guLy//sov8L+VyOYRCIViWpdJhsxSPxzk3N0cpJR8/fryGqGEY'+
					'jEQiPHr06DraTU1NvH79Oo8fPx6MDQwM8MWLF0HGqazYpIjFYkwkEpyammJvb++aSV3XqWka'+
					'Dxw48NsH3bhxgyT55csXHjt2TBm7maHrOmOxGOPxOG3bXpdpQgiWl5evu1EIEVzH43Gu6PLl'+
					'y9y9e7cydnPj55MHDx5cN7a6BK7E69evSZKfPn1ShhYa2q9KoGVZBMC+vr4gy27duhVkqDJ2'+
					'C0BraGgI4HR0dATjo6Oj9DyPd+7cUWZuNWhv3rxZVwJHRkbo+z7T6TSbm5uVmVsJ2uoS2N3d'+
					'zdOnT7O3tzcYu3jxojIyj/G/Xs1MTU3Btm3cvXsXpmmira0NkUgEQggkk0lUVFSoDW8epf3u'+
					'D+Pj47BtG4uLi7h37x4aGhqQSqUgxI8vFW7fvq1cLOQp/4p27tyJEydO4NChQ6ipqQEAnDt3'+
					'Ds3NzcGh8YquXr2KbDaLmzdvKjcLeWA8ODjIxcVF+r5PkpydneWZM2f46tUrjo+PkyRzuRzn'+
					'5+dJktPT0+zr61PrTb4OjP9NsLq6GrZtI5PJBCXw/PnzKC4uRlVVFaLRKCYnJyGlRDKZBABU'+
					'Vlbi2rVruHTpkkqBfL1PWz1w5coV1NXVYe/evcFJ/tmzZ7GwsID9+/djbGwMuq6jtLQUmqbh'+
					'6dOniEajsCwLJ0+eRG1tLXRdx7t375S7+WhEbNtGa2srqquroes6pJRIpVIwDAOtra1IJBKQ'+
					'UuLJkyeYnZ2F4ziQUuLhw4cYHh5GOBxGR0cH6uvrlbP5gFZcXIyWlhbEYjGUlJQgk8msK4EX'+
					'LlzAhw8fsLS0BN/3kc1m4Xkeampq8PLlS0xMTMCyLPT09KCnp0e5u9mNSDgc5vPnz5lKpTg3'+
					'N8d0Ok3HcTgzM8P+/n5OT0+TJF3Xped5TKfTdF2XrusGDYvruiTJTCZD/vioRMUmRNDyR6NR'+
					'RKNRlJWVYWZmBg8ePEB7ezuWlpaCEtjY2Bjs07q7uzE5OYny8nLs2LEDIyMj+Pr1K/bs2QMA'+
				'GB4eVumwSRIVFRVMJpMYGhpCXV0dTNPEo0ePQBJHjhyB53kYHBxEWVkZPn78iFOnTiEWi0FK'+
				'ia6uLiQSCZimiYWFBczPzytH8wGtvr6ebW1t6Orqwrdv34KJ/v5+tLS0BB3k4cOHAQDZbBam'+
				'acJxnOAoSynP0ACwtrYWlmVhdHQUnudBSgnDMCClhKZpMAwDmUwGpmnC8zx4nqecKzS0UCgE'+
				'TdMghIDrusGHqUpbGJqyYRtvrpUUNCUFTUlB2+aNCFQzsr2Yrd4ZK3DbJMn+Bur9z6UTRXFv'+
				'AAAAAElFTkSuQmCC")';

		var ddnode = dlnode[0].appendChild(document.createElement('dd'));
		ddnode.setAttribute('title','この部隊が拠点に与える予想ダメージです');

		node  = ddnode.appendChild(document.createElement('strong'));
		node.textContent = "計算中...";
		node.setAttribute('class','size1');

		node  = ddnode.appendChild(document.createElement('span'));
		node.setAttribute('title','スキルによるダメージアップ率');
		node.textContent = "--";
		node  = ddnode.appendChild(document.createElement('span'));
		node.setAttribute('title','鍛冶場によるダメージアップ率');
		node.textContent = "--";
		node  = ddnode.appendChild(document.createElement('span'));
		node.setAttribute('title','衝車のダメージアップ率');
		node.textContent = "--";
		node  = ddnode.appendChild(document.createElement('span'));
		node.setAttribute('title','投石機のダメージアップ率');
		node.textContent = "--";
		node  = ddnode.appendChild(document.createElement('span'));
		node.setAttribute('title','内政スキルのダメージアップ率');
		node.textContent = " 内：";
		var box  = node.appendChild(document.createElement('input'));
			box.setAttribute('type','text');
			box.setAttribute('id','etcs_cardmg_input');
			box.style.cssText = 'width:36px;';
			box.addEventListener('keyup', func,false);
			box.addEventListener('change',func,false);
		node.appendChild(document.createTextNode('%'));
	}


		func();

		// 再計算用イベント
		smithNode.addEventListener('change', func, false);
		ramNode  .addEventListener('change', func, false);
		catNode  .addEventListener('change', func, false);
	}

	//================================
	//	  デッキで内政へ飛ぶ
	//================================
	function deckToDomestic() {
		if(location.pathname != '/card/deck.php')  return;
		var phpData = [
			[/内政セット済/ ,"%2Fcard%2Fdomestic_setting.php"],
			[/待機中/ ,"%2Fcard%2Fdomestic_setting.php"],
		];

		var setinfo = getNodeXPath('id("cardListDeck")//*[contains(@class,"cardColmn")]//dd[preceding-sibling::dt[contains(text(),"セット状態") and position()=1]]');

		for(var i = 0;i < setinfo.length; i++) {
			// カードの所属拠点から拠点ID取得
			var node = getNodeXPath('../dd[preceding-sibling::dt[contains(text(),"所属拠点") and position()=1]]//a',setinfo[i]);
			if(node.length == 0) continue;
			var villageID = node[0].getAttribute('href').replace(/^.+village_id=(\d+).*?$/,"$1");
			var range = document.createRange();
			range.selectNodeContents(setinfo[i]);

			// 追加/置き換え
			if(setinfo[i].textContent.match(/出兵中/)) {
				setinfo[i].innerHTML = setinfo[i].innerHTML.replace(/出兵中/,'<a href="/village_change.php?village_id='+villageID+'&from=menu&page=%2Ffacility%2Funit_status.php">出兵中</a>');
			} else {
				var oldNode   = range.extractContents();
				node = setinfo[i].appendChild(document.createElement('a'));
				node.appendChild(oldNode);
				node.setAttribute('href','/village_change.php?village_id='+villageID+'&from=menu&page=%2Fcard%2Fdomestic_setting.php');
			}
			range.detach();
		}
	}

	// ==============================
	//		  帰還予定日時表示
	// ==============================
	function returnDateOnCastleSendTroop() {

		if(location.pathname != '/facility/castle_send_troop.php') return;	// 出兵確認画面のみ表示

		// 攻撃タイプ判定
		var basenode = getNodeXPath('//table[@class="fighting_about"]/tbody/tr/th')[0];
		if(typeof basenode == 'undefined') return;
		var movetype = basenode.getAttribute('class');
		if(movetype == 'suport') return;	// 援軍は表示しない

		// ***兵士速度データ ***
		var solSpeedData = {
			"infantry" : 6, "large_infantry" : 8,		// 剣兵種
			"shield"   : 4, "heavy_shield" : 7,			// 盾兵種
			"spear"    : 7, "halbert"  : 10,			// 槍兵種
			"cavalry"  : 12, "cavalry_guards" : 15,		// 騎兵種
			"archer"   : 5, "crossbow" : 9,				// 弓兵種
			"scout"    : 9, "cavalry_scout"  : 20,		// 斥候種
			"ram"	   : 3, "catapult" : 6				// 攻城兵種
		};

		//*** 帰還時刻表示 ****
		var func = function(  ) {

			var retnode  = document.querySelector('#etcs_returnDate span');
			retnode.parentNode.parentNode.textContent.match(/到着まで:\s*(\d+)\:(\d{1,2})\:(\d{1,2})\s*到達時間:\s*(\d{1,4}\-\d{1,2}\-\d{1,2}\s+\d{1,2}\:\d{1,2}\:\d{1,2})/);
			var arrivaltime = new Date((RegExp.$4).replace(/-/g,'/'));
			var returntime	= new Date(arrivaltime.getTime() + movetime);
			if(moveload) {
				retnode.textContent = '予測帰還日時: 読み込んでいます.... ';
			} else {
				retnode.textContent = '予測帰還日時: '+ makeDateString(returntime) + makeRestTimeString(" (%%hours:%%minuts:%%sec) ",movetime);
			}

		};
		//*** サーバーから読み込みボタン ****
		var loadFightingTime = function() {

			var node  = document.querySelector('#etcs_returnDate a');
			if(node != null) {
				node.removeEventListener('click',loadFightingTime);
				node.parentNode.removeChild(node);
			}

			// 送信データの作成
			var sendData   = [];
			var solderNode = getNodeXPath('//form[@name = "input_troop"]//input[contains(@name,"_count")]');
			for(var i = 0;i < solderNode.length; i++) {
				for(var key in solSpeedData) {
					if(solderNode[i].getAttribute('name').match(new RegExp(key + "_count"))) {
						sendData[sendData.length] = key+"_count="+solderNode[i].value;							// 送信用データに再利用
					}
				}
			}
			var sendName = {
				// ****_count=
				"radio_move_type" : 302,
				"village_x_value" : null,
				"village_y_value" : null,
				"radio_reserve_type" : 0,
				"unit_assign_card_id" : null,
				// use_skill_id[???]=at????
				"btn_preview" : "次へ",
				'x':'',
				'y':'',
			};
			for(var key in sendName) {
				if(sendName[key] == null) {
					var tmp = document.querySelector('input[name="'+key+'"]');
					if(tmp != null) {
						sendData[sendData.length] = key + "=" + tmp.value;
					}
				} else {
					sendData[sendData.length] = key + "=" + sendName[key];
				}
			}

			// skill
			var tmp = document.querySelector('input[name ^= "use_skill_id"]');
			if(tmp != null) {
				var key  = tmp.getAttribute('name');
				sendData[sendData.length] = key + "=" + tmp.value;

			}

			// POSTデータ生成
			tmp 	 = sendData.join('&');
			moveload = true;				// ロード中開始

			// 殲滅の確認画面を裏でチェック
			GM_xmlhttpRequest({
				method:"POST",
				url    : SERVER_URI+'/facility/castle_send_troop.php',
				data   : tmp,
				headers: {
					"Content-type":"application/x-www-form-urlencoded",
				},
				onload:function(x){
					var htmdoc = parseHTML(x.responseText);

					var node   = getNodeXPath('//table[@class="fighting_about"]/tbody/tr/td',htmdoc,htmdoc);
					if(node[0].parentNode.textContent.match(/到着まで:\s*(\d+)\:(\d{1,2})\:(\d{1,2})\s*到達時間:\s*(\d{1,4}\-\d{1,2}\-\d{1,2}\s+\d{1,2}\:\d{1,2}\:\d{1,2})/)) {
						movetime = (parseInt(RegExp.$1,10) * 3600 + parseInt(RegExp.$2,10) * 60 + parseInt(RegExp.$3,10))*1000;		// 移動時間
					}
					moveload = false;				// ロード中終わり
				},
				onerror : function(x) {
					moveload = false;				// ロード中終わり
				},
			});
		};

		// 移動時間の取得と計算
		var movetime = 0;
		var returnSkill = 0;
		var moveload = false;
		var node	  = getNodeXPath('//table[@class="fighting_about"]/tbody/tr/td')[0];
		if(node.parentNode.textContent.match(/到着まで:\s*(\d+)\:(\d{1,2})\:(\d{1,2})\s*到達時間:\s*(\d{1,4}\-\d{1,2}\-\d{1,2}\s+\d{1,2}\:\d{1,2}\:\d{1,2})/)) {
			movetime = (parseInt(RegExp.$1,10) * 3600 + parseInt(RegExp.$2,10) * 60 + parseInt(RegExp.$3,10))*1000;		// 移動時間(殲滅)
		}


		// 強襲・帰還時速度アップスキル用計算
		var node	 = getNodeXPath('//div[contains(@class,"fightingpower")]//dd[preceding-sibling::dt[contains(text(),"部隊移動速度") and position()=1]]');
		var endSpeed = parseFloat(node[0].textContent);

		// 武将・兵から一番足の遅い物を基準にする
		node	   = getNodeXPath('//div[contains(@id,"cardWindow_")]//li[contains(@class,"status_speed")]');	// 武将スピード
		var speed  = parseFloat(node[0].textContent);
		var solderNode = getNodeXPath('//table[@name="input_troop"]//input[contains(@name,"_count")]');
		for(var i = 0;i < solderNode.length; i++) {
			for(var key in solSpeedData) {
				if(solderNode[i].getAttribute('name').match(new RegExp(key + "_count"))) {
					if(solderNode[i].value != '' && speed > solSpeedData[key]) {
						speed = solSpeedData[key];
					}
				}
			}
		}

		// 殲滅速度 再計算
		var traning    = loadVillageData("trainingScool");		// 保存してある訓練所
		var traningex  = loadVillageData("trainingScoolEx");	// 保存してある遠征訓練所
		traning   = (traning   == null) ? 0 : traning;
		traningex = (traningex == null) ? 0 : traningex;

		var startPos = getNowVillagePos();
		var endPos_x = +document.querySelector('input[name="village_x_value"]').value;
		var endPos_y = +document.querySelector('input[name="village_y_value"]').value;
		endPos_x	 = isNaN(endPos_x) ? 0 : endPos_x;
		endPos_y	 = isNaN(endPos_y) ? 0 : endPos_y;

		var normal = calcMoveTime(startPos[0],startPos[1],endPos_x,endPos_y,speed,0,0,0,false) * 1000;
		var node   = getNodeXPath('//div[@class = "useSkill"]/p[@class="skillInfo"]');		// スキル説明

		if(node.length != 0) {
			// スキルの中に帰還時の速度アップがあるか？
			if(node[0].textContent.match(/帰還.*?速度.*?(\d+(\.\d+)?)%/)) {
				returnSkill = parseFloat(RegExp.$1) / 100;
			}


			// 強襲時は計算する
			if(movetype == 'forceattack') {

				if(node[0].textContent.match(/強襲[時|選択]/)) {
					// 強襲スキルの時
					movetime = calcMoveTime(startPos[0],startPos[1],endPos_x,endPos_y,speed,traning,traningex,0,false) * 1000;
				} else {
					// 通常スキル(計算から算出)
					movetime = calcMoveTime(startPos[0],startPos[1],endPos_x,endPos_y,speed,0,0,(normal / movetime) - 1.2 + returnSkill,false) * 1000;	//スキル込み殲滅
				}

				// 殲滅での時間を裏で自動取得
				if(ETCS_OPTION['retDateOnSendTroop_ForceServerLoad']) {
					loadFightingTime();
				}
			} else {
				// 帰還スキルあり
				if(returnSkill != 0) {
					console.log(normal + "/" + movetime + "/"+ returnSkill);
					movetime = calcMoveTime(startPos[0],startPos[1],endPos_x,endPos_y,speed,0,0,(normal / movetime) - 1.0 + returnSkill,false) * 1000;	//スキル込み殲滅
				}
			}
		} else {
			// スキル無し

			// 強襲時は計算する
			if(movetype == 'forceattack') {
				movetime = calcMoveTime(startPos[0],startPos[1],endPos_x,endPos_y,speed,0,0,(normal / movetime) - 1.2 + returnSkill,false) * 1000;	//スキル込み殲滅
				// 殲滅での時間を裏で自動取得
				if(ETCS_OPTION['retDateOnSendTroop_ForceServerLoad']) {
					loadFightingTime();
				}
			}
		}



		// 表示部分作成
		basenode = getNodeXPath('//table[@class="fighting_about"]/tbody/tr/td')[0];
		node	 = basenode.appendChild(document.createElement('div'));
		node.setAttribute('id','etcs_returnDate');
		node.appendChild(document.createElement('span'));				// 時刻表示部分

		if((movetype == 'forceattack') && !ETCS_OPTION['retDateOnSendTroop_ForceServerLoad']) {
			node	= node.appendChild(document.createElement('a'));	// ロードボタン
			node.setAttribute('href','javascript:void(0);');
			node.textContent = '(読み込む)';
			node.addEventListener('click',loadFightingTime);
		}

		func();
		setInterval(function() { func(); } , 100);
	}
	/*
		移動量計算
	*/
	function MapDragCalcRange( x1, y1, x2, y2 ) {
		return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
	}
	/*
		移動時間の計算
		sx/sy:開始座標 ex/ey:終点座標 basespeed:基本速度 training/trainingEx:訓練所・遠征訓練所LV skillUp:スキルアップ率(%/100) forceFlag:強襲(BOOL)
		返値：秒数(float)
	*/
	function calcMoveTime( sx, sy, ex, ey, baseSpeed , training, trainingEx, skillUp, forceFlag ) {

		var dist   = MapDragCalcRange(sx, sy, ex, ey);	// 距離計算
		var upper  = 1 + training / 20 + ((trainingEx * dist) / 1000) + (forceFlag ? 0.2 : 0) + skillUp;		// 速度アップ率
		var speed  = baseSpeed * upper;
		return( (dist / speed) * 60 * 60 );
	}

	// =========================================================
	//	 掲示板のスレを開いた時、タイトルバーにタイトルを表示
	// =========================================================
	function copyTitleInBBSTitle() {

		if(location.pathname != '/bbs/res_view.php') return;

		var title = document.getElementsByTagName('title');
		if(title != null) {
			var node = getNodeXPath('//table[@summary="件名"]//th[contains(@class,"mainTtl")]/div[contains(@class,"threadTtl")]');
			var text = node[0].textContent;
			if(text.length > 20) {
				text = text.substring(0,20) + "...";
			}
			if(title[0].textContent.match(/(.*?)\s+(\-\s+ブラウザ三国志.*?)$/)) {
				title[0].textContent = text + " " + RegExp.$1 +" "+ RegExp.$2;
			}
		}
	}
	//========================================================
	//	同盟画面で寄付にフォーカスが当たったら、資源量を表示
	//========================================================
	function donationResourceView() {

		if(location.pathname != '/alliance/info.php') return;

		var form = document.querySelectorAll('form[name="contributionForm"] input[type="text"]');
		if(form == null) return;

		var viewMake = function( ) {
			var form  = document.querySelectorAll('#etcs_donationResourceView span');
			var stockID = ['wood','stone','iron','rice'];
			for(var i = 0;i < form.length;i++) {
				var now = document.getElementById(stockID[i]).textContent;
				var max = document.getElementById(stockID[i]+"_max").textContent;
				form[i].textContent = now.replace(/(\d)(?=(\d\d\d)+$)/g,'$1,') + " / " + max.replace(/(\d)(?=(\d\d\d)+$)/g,'$1,');
			}
			var base = document.getElementById('etcs_donationResourceView');
			var rect = document.activeElement.getBoundingClientRect();
			var x = (window.scrollX + rect.left) - base.offsetWidth / 2;
			x = x < 36 ? 36 : x;
			base.style.top = (window.scrollY + rect.top  - 84) + 'px';
			base.style.left = x + 'px';

			return;
		};
		var timeID = null;

		for(var i = 0;i < form.length;i++) {
			(function(li) {
			form[li].addEventListener('focus',function() {
				if(document.getElementById('etcs_donationResourceView') != null) return;
				var stock = document.body.appendChild(document.createElement('div'));
				stock.id = 'etcs_donationResourceView';
				var node;
				node	   = stock.appendChild(document.createElement('img'));
				node.src  = EXIMG_URL+'/img/common/ico_wood.gif';
				node	  = stock.appendChild(document.createElement('span'));
				node.textContent = '0';
				node	  = stock.appendChild(document.createElement('img'));
				node.src  = EXIMG_URL+'/img/common/ico_stone.gif';
				node	  = stock.appendChild(document.createElement('span'));
				node.textContent = '0';
				node	  = stock.appendChild(document.createElement('img'));
				node.src  = EXIMG_URL+'/img/common/ico_ingot.gif';
				node	  = stock.appendChild(document.createElement('span'));
				node.textContent = '0';
				node	  = stock.appendChild(document.createElement('img'));
				node.src  = EXIMG_URL+'/img/common/ico_grain.gif';
				node	  = stock.appendChild(document.createElement('span'));
				node.textContent = '0';

				stock.style.cssText = 'position:absolute; background:#000000 none; color:#ffffff;padding:6px;border:1px solid #ffffff;border-radius:6px;font-size:10px;box-shadow:5px 5px 2px rgba(0,0,0,4)';

				viewMake();
				timeID = setInterval(viewMake,500);
			},false);
			form[i].addEventListener('blur',function() {
				if(document.getElementById('etcs_donationResourceView') != null) {
					document.body.removeChild(document.getElementById('etcs_donationResourceView'));
				}
				clearInterval(timeID);
			},false);
			})(i);
		}
	}
	//================================
	//			設定画面
	//================================
	/*
		入り口挿入
	*/
	function EtcsSetting_Insert() {

		var linode,anode;

		// プロフィールのみ
		if(location.pathname != "/user/") {
			return;
		}
		try {
			if(getNodeXPath('//div[@id="gray02Wrapper"]/h2/text()')[0].nodeValue != "プロフィール")	return;
		}catch(e) {
			return;
		}

		// メニューの最後に追加
		getNodeXPath('//ul[@id="statMenu"]/li[contains(@class,"last") or normalize-space(@class)=""]').forEach(function( hasNode ) {
			hasNode.removeAttribute('class');
		});

		linode = document.createElement('li');
		linode.setAttribute('class','last');
		document.getElementById('statMenu').appendChild(linode);

		anode  = document.createElement('a');
		anode.setAttribute('href','javascript:void(0);');
		anode.appendChild(document.createTextNode('3gokushi-etcsの設定'));
		linode.appendChild(anode);
		anode.addEventListener('click',EtcsSettingWindow,false);



	}
	/*
		設定画面表示
	*/
	function EtcsSettingWindow() {
		var insHtml = "";

		if(searchBaseWindow('etcssetting') != null) return;	// 既に開いていたら表示しない
		EtcsSetting_Load();	// もう一度設定を読み直し

		insHtml +=

		'<div id="etcsopt_contant01">'+
		'<dl>'+
		'<dt>全体設定</dt>'+
		'<dd><label title="このスクリプトを遅延して実行する時間をミリ秒(1秒は1000ミリ秒)で指定します。">遅延実行時間<input type="text" name="AllDelayTime" size="6" />ミリ秒</label>'+makeDisServiceStr()+'</dd>'+

		'<dt>入力文字数の表示</dt>'+
		'<dd>'+CreateInputCheckBoxOption('InputStrLen_Chat',"ひとことの入力文字数表示","ひとことの文字入力欄の文字数を表示します")+makeDisServiceStr()+'</dd>'+
		'<dd>'+CreateInputCheckBoxOption('InputStrLen_BBS',"同盟掲示板の入力文字数表示","同盟掲示板の本文入力欄の文字数を表示します")+makeDisServiceStr()+'</dd>'+
		'<dd>'+CreateInputCheckBoxOption('InputStrLen_PersonBBS',"個人掲示板の入力文字数表示","個人掲示板の本文入力欄の文字数を表示します")+makeDisServiceStr()+'</dd>'+
		'<dd>'+CreateInputCheckBoxOption('InputStrLen_Mail',"書簡の入力文字数表示","書簡の本文入力欄の文字数を表示します")+makeDisServiceStr()+'</dd>'+

		'<dt>掲示板関係</dt>'+
		'<dd>'+CreateInputCheckBoxOption('copyTitleInBBSTitle',"掲示板スレッドのタイトルをブラウザのタイトルバーに表示","掲示板スレッドのタイトルを、ブラウザのタイトルバーに表示します")+makeDisServiceStr()+'</dd>'+

		'<dt>全体地図ドラッグ移動</dt>'+
		'<dd>'+CreateInputCheckBoxOption('MapDragPosMove',"全体地図をドラッグで移動出来るようにする","全体地図をドラッグして移動できるようになります。ニコ鯖であった機能の真似です")+makeDisServiceStr()+'</dd>'+
		'<dd class="etcs-setting_sub">'+CreateInputCheckBoxOption('MapDragPosMovex51',"51x51地図でもドラッグで移動できるようにする","51×51の全体地図でもドラッグして移動できるようにします")+makeDisServiceStr()+'</dd>'+

		'</dl>'+
		'</div>'+
		'<div id="etcsopt_contant02">'+
		'<dl>'+
		'<dt>市場取引</dt>'+
		'<dd>'+CreateInputCheckBoxOption('MarketStockCalc',"市場で取引状態を仮算出","市場画面で売る資源量を入れると、取引ボタンを押なくても取引後の資源量を表示してくれます。")+makeDisServiceStr()+'</dd>'+
		'<dd class="etcs-setting_sub">'+CreateInputCheckBoxOption('MarketStockCalcTimer',"タイマーで自動更新","資源量の表示をタイマーで自動的に更新します")+'</dd>'+
		'<dd>'+CreateInputCheckBoxOption('MarketCostView',"市場でコストビュー(各必要資源量)を表示","市場画面で、研究や作成に必要な資源量を表示します")+makeDisServiceStr()+'</dd>'+
		'<dd class="etcs-setting_sub">'+CreateInputCheckBoxOption('MarketCostViewTimer',"コストビューをタイマーで自動更新する","市場画面で、研究や作成に必要な資源量を表示するコストビューをタイマーで自動更新します")+makeDisServiceStr()+'</dd>'+
		'<dd class="etcs-setting_sub">'+CreateInputCheckBoxOption('MarketCostViewCalcFullTime',"コストビューに貯蓄完了の予想時間を表示","コストビューにその資源が貯まると思われる予想時間を表示します。現在未完成。")+makeDisServiceStr()+'</dd>'+
		'<dd>'+CreateInputCheckBoxOption('MarketCostViewDblClick',"コスト欄をダブルクリックで、コストビューの設定をする","コスト欄をダブルクリックすると、コストビューにそのコストを設定します")+makeDisServiceStr()+'</dd>'+
		'<dd>'+CreateInputCheckBoxOption('checkClassCost',"コスト欄にツールチップで資源が足りているか表示","コストが表示されている欄のツールチップで、現在の資源量で建設できるか表示します")+makeDisServiceStr()+'</dd>'+
		'<dd class="etcs-setting_sub"><label title="不足分を他の資源で埋めるときに必要な量を計算するときの、市場の取引相場を入力します">他資源の量の計算に使う取引相場<input type="text" size="7" name="checkClassCostPer" />%</label>'+makeDisServiceStr()+'</dd>'+
		'<dd>'+CreateInputCheckBoxOption('MarketStockPreset',"資源売買のプリセットリストを表示","資源売買のプリセットを表示します")+'</dd>'+

		'<dt>カードクリックで開く</dt>'+
		'<dd>'+CreateInputCheckBoxOption('JumpURIFromClickCard',"カードNo.をクリックすると、指定のURLを開く","カードNo.をクリックすると、指定のURLを開きます。合成表が記載されているページを指定すると良いでしょう")+makeDisServiceStr()+'</dd>'+
		'<dd>'+CreateInputCheckBoxOption('cardRightClickSkill',"カード右クリックを使用する","カードを右クリックすると指定のURLを開いたり、トレードを開けるメニューを出します")+makeDisServiceStr()+'</dd>'+
		'<dd class="etcs-setting_sub"><label title="カードNo.をクリック/右クリックのカードNo.でURLを開くを使用したとき、ここで指定のURLを開きます">カードNo.で開くURL <span style="font-size:80%;">(半角で%%NO%%の文字列は、カードNo.に置き換わります)</span><br /><input type="text" size="50" name="JumpURIFromClickCardNoURI" /></label><span style="font-size:80%;"></span>'+makeDisServiceStr()+'</dd>'+
		'<dd class="etcs-setting_sub"><label title="カードを右クリックしてスキル名で開く時、ここで指定のURLを開きます">カード右クリックの時、スキルで開くURL <span style="font-size:80%;">(半角で%%ID%%の文字列は、CSV指定のIDに置き換わります)</span><br /><input type="text" size="50" name="cardRightClickSkillURL" /></label>'+makeDisServiceStr()+'</dd>'+
		'<dd class="etcs-setting_sub"><label title="URLを開く時に使用するIDなどをスキル名から検索するためのデータをCSVで入力します。詳しくは説明書をご覧ください">スキルCSV入力欄 <span style="font-size:80%;">(書式：No[TAB]スキル名)</span><br /><textarea style="width:80%;" rows="6" name="cardRightClickSkillCSV"></textarea></label>'+makeDisServiceStr()+'</dd>'+
		'<dd>'+CreateInputCheckBoxOption('cardRightClickSkillNewTab',"常に新しいウインドウ(タブ)で開く","URLやトレード画面などを開くときに、常に新しいウインドウやタブで開くようにします")+makeDisServiceStr()+'</dd>'+

		'<dt>トレード関係</dt>'+
		'<dd>'+CreateInputCheckBoxOption('viewSellCardFees',"カード出品時に手数料を表示する","カードを出品するときに、希望落札価格に対する手数料を表示します")+makeDisServiceStr()+'</dd>'+
		'<dd>'+CreateInputCheckBoxOption('listViewSellCardFees',"出品中のカードで手数料を表示する","トレードの出品中のカードで、希望落札価格と最大入札TPに手数料を表示します")+makeDisServiceStr()+'</dd>'+
		'<dd>'+CreateInputCheckBoxOption('AlertOfBuyTradeTime_Bid',"入札時に落札まで24時間以上かかるなら警告する","落札処理が次の10時ではない(落札まで24時間以上)の場合、警告します")+makeDisServiceStr()+'</dd>'+
		'<dd>'+CreateInputCheckBoxOption('AlertOfBuyTradeTime_List',"トレードのリストで、落札まで24時間以上かかるの物はアイコンを変える","トレードのリストで、落札が次の10時で無い(落札まで24時間以上)物のアイコンを変更します")+makeDisServiceStr()+'</dd>'+
		'<dd>'+CreateInputCheckBoxOption('addRTradeSortLink',"トレードリストのソート機能で、レアリティの表示非表示を維持する","トレードのリスト表示の時に、ソートするとレアリティの表示・非表示が解除されるのを防ぐよう修正します")+makeDisServiceStr()+'</dd>'+

		'<dt>デッキ関係</dt>'+
		'<dd>'+CreateInputCheckBoxOption('deckToDomestic',"デッキにセットされているカードのセット状態にリンクを付ける","デッキにセットされているカードのセット状態に、リンクを付けます")+makeDisServiceStr()+'</dd>'+
		'<dd>'+CreateInputCheckBoxOption('deckPagerUpperClone',"カード合成やカード出品で、ページ切り替えを上部にも付ける","カードの各種合成の画面やカードの出品の画面で、ページ切り替えのリンクをカード上部にも表示するようにします")+makeDisServiceStr()+'</dd>'+
		'<dd>'+CreateInputCheckBoxOption('viewDeckCostFree',"デッキコストの残り表示","デッキ画面で、デッキコストの残りを表示します")+makeDisServiceStr()+'</dd>'+
		'<dd class="etcs-setting_sub">デッキコストの表示の仕方<ul class="etcs-setting_sub"><li><label><input type="radio" name="viewDeckCostFreeType" value="0" title="ツールチップで表示します">ツールチップで表示</label></li><li><label><input type="radio" name="viewDeckCostFreeType" value="1" title="デッキコストの欄に表示します">デッキコストの欄に表示</label></li></ul></dd>'+

		'<dt>同盟トップ関係</dt>'+
		'<dd>'+CreateInputCheckBoxOption('donationResourceView',"資源の寄付欄にフォーカスを合わせたとき、資源量を表示","同盟トップの資源の寄付欄にフォーカスを合わせたとき、現在の資源量を表示します")+makeDisServiceStr()+'</dd>'+

		'</dl>'+
		'</div>'+
		'<div id="etcsopt_contant03">'+
		'<dl>'+

		'<dt>出兵時関連</dt>'+
		'<dd>'+CreateInputCheckBoxOption('retDateOnSendTroop',"出兵時に帰還日時表示","出兵時に帰還する日時を計算して表示します(援軍除く)")+makeDisServiceStr()+'</dd>'+
		'<dd class="etcs-setting_sub" style="margin-top:0em;margin-bottom:1em;">'+CreateInputCheckBoxOption('retDateOnSendTroop_ForceServerLoad',"強襲時、サーバーから移動時間を自動で取得する","強襲時に、帰還の時間(殲滅の時間)を取得して表示します。鯖に少し負担が掛かります")+makeDisServiceStr()+'<span style="font-size:75%;">(読み込まない時は内政スキルの速度UPは考慮しない簡易計算となります)</span></dd>'+

		'<dd>'+CreateInputCheckBoxOption('carDmgCalc',"出兵時に予測の拠点ダメージを表示","出兵時に、拠点に与えるダメージを予測して表示します")+makeDisServiceStr()+'</dd>'+

		'<dt>兵作成</dt>'+
		'<dd>'+CreateInputCheckBoxOption('makeDisSolMax',"兵の最大作成数リンク表示","兵を作るときに、割引後の価格で作成できる最大数を入力するリンクを表示します")+makeDisServiceStr()+'</dd>'+
		'<dd>'+CreateInputCheckBoxOption('AccommodationFree',"拠点画面の空き宿舎数を表示","拠点画面で、宿舎の空き数を表示します")+makeDisServiceStr()+'</dd>'+
		'<dd class="etcs-setting_sub">空き宿舎数の表示の仕方<ul class="etcs-setting_sub"><li><label><input type="radio" name="AccommodationFreeType" value="0" title="ツールチップで表示します">ツールチップで表示</label></li><li><label><input type="radio" name="AccommodationFreeType" value="1" title="兵数の欄に表示します">兵数の欄に表示</label></li></ul></dd>'+

		'</dl></div><input type="button" value="設定を保存" title="3gokushi-etcsの設定を保存します"/>'+
		'<hr style="display:block; border:none; border-top:1px dashed #000000; margin:1em 0em;"/><input type="button" value="他のサーバーの設定を読み込み" title="他のサーバーの3gokushi-etcsの設定を読み込みます" />'+
		'<hr style="display:block; border:none; border-top:1px dashed #000000; margin:1em 0em;"/><input type="button" value="指定サーバーの設定を全て削除" title="3gokushi-etcsのデータを削除します" />';

		var close = function() {};

		var optWin = new baseWindow('3gokushi-etcs ver.'+SCRIPT_VERSION+'の設定','etcssetting');

		node = document.createElement('div');
		node.innerHTML = insHtml;
		node.setAttribute('id','etcs-setting');
		node.style.width   = '100%';
		node.style.margin  = '0px';
		node.style.padding = '0px';

		optWin.addContent(node);
		optWin.disp(true);

		if(SERVER_TYPE == 1) optWin.center(undefined,30);	//mixi
		else	optWin.center();

		// 保存ボタンへのイベント
		node = getNodeXPath('//div[@id="etcs-setting"]//input[@type="button"]')[0];
		node.addEventListener('click',EtcsSetting_Save,false);
		node.style.textAlign = 'center';

		// 削除ボタンへのイベント
		node = getNodeXPath('//div[@id="etcs-setting"]//input[@type="button"]')[1];
		node.addEventListener('click',getServerSaveData,false);
		node.style.textAlign = 'center';

		// 削除ボタンへのイベント
		node = getNodeXPath('//div[@id="etcs-setting"]//input[@type="button"]')[2];
		node.addEventListener('click',allClearServerSaveData,false);
		node.style.textAlign = 'center';

		// 各種設定にチェックを付ける
		ETCSSetting_CheckFunc(function(list,node) {
			switch(list[1]) {
				case 'radio' :
					if(node.value == ETCS_OPTION[list[0]]) {
						node.checked = true;
					}
				break;
				case 'value' :
					node.value	 = ETCS_OPTION[list[0]];
				break;
				case "checked" :
					node.checked = ETCS_OPTION[list[0]];
				break;
			}

		});
	}

	/*
		チェックボックス生成(設定用)
	*/
	function CreateInputCheckBoxOption( name, title, description ) {
		return('<label title="'+description+'"><input type="checkbox" name="'+name+'" />'+title+'</label>');
	}
	/*
		チェックボックス生成
	*/
	function CreateInputCheckBox( state, title, description ) {
		return('<label title="'+description+'"><input type="checkbox"'+(state ? ' checked="checked"' : '') + ' />'+title+'</label>');
	}
	/*
		無効鯖文字列生成
		(無効にする鯖を文字列で列挙： 'ymh'= yahoo/mixi/hangeを無効
	*/
	function makeDisServiceStr( flag ) {

		flag = typeof flag == 'undefined' ?  '' : flag;

		for(i = 0;i < flag.length;i++) {
			if(flag.charAt(i) == SERVICE_TYPE) {
				return('(<strong style="color:red;">※このサーバーでは使えません</strong>)');
			}
		}
		return '';
	}



	/*
		設定(呼び出される)
	*/
	function ETCSSetting_CheckFunc( func ) {

		var inputNode = getNodeXPath('id("etcs-setting") //input | //textarea | //select');
		for(i in inputNode) {
			var name = inputNode[i].getAttribute('name');

			for(j in saveDefaultData) {
				if(saveDefaultData[j][0] == name) {
					func(saveDefaultData[j],inputNode[i]);
				}
			}
		}
	}
	/*
		設定保存(ボタンクリックで呼ばれる)
	*/
	function EtcsSetting_Save( event ) {

		ETCSSetting_CheckFunc(function(list,node) {
			var saveData = null;

			switch(list[1]) {
				case "radio" :
					if(node.checked) {
						saveData = node.value;
					}
				break;
				case 'value' :
					saveData = node.value;
				break;
				case "checked" :
					saveData = node.checked;
				break;
			}
			if(saveData != null)	GM_setValue(SAVE_NAME+"SETTING_"+list[0],saveData);
		});


		alert("設定を保存しました。リロードするかページを移動すると有効になります。");
	}
	/*
		設定読み込み
	*/
	function EtcsSetting_Load( savename ) {

		savename = typeof savename == 'undefined' ? SAVE_NAME : SAVE_NAME_HEAD+savename+"_";

		var i,j;
		var data;

		ETCS_OPTION = [];
		// default設定
		for(i = 0;i < saveDefaultData.length;i++) {
			ETCS_OPTION[saveDefaultData[i][0]] = saveDefaultData[i][2];
		}

		// 設定読み込み
		for(i = 0;i < saveDefaultData.length;i++) {
			data = GM_getValue(savename+"SETTING_"+saveDefaultData[i][0]);
			if(data != null) {
				ETCS_OPTION[saveDefaultData[i][0]] = data;
			}
		}


	}

	/*
		指定サーバーのデータを読み込み
	*/
	function getServerSaveData() {
		var server = prompt("設定を読み込むサーバーの接頭語(s**やm**など)を入力してください。",SERVER_NAME);
		if(server == null) return;

		var opt = [];

		// backup
		for(var i in ETCS_OPTION) {
			opt[i] = ETCS_OPTION[i];
		}

		EtcsSetting_Load(server);

		// 各種設定にチェックを付ける
		ETCSSetting_CheckFunc(function(list,node) {
			switch(list[1]) {
				case 'radio' :
					if(node.value == ETCS_OPTION[list[0]]) {
						node.checked = true;
					}
				break;
				case 'value' :
					node.value	 = ETCS_OPTION[list[0]];
				break;
				case "checked" :
					node.checked = ETCS_OPTION[list[0]];
				break;
			}

		});

		// restore
		for(var i in ETCS_OPTION) {
			ETCS_OPTION[i] = opt[i];
		}

	}
	/*
		指定サーバーの記録を全て削除
	*/
	function allClearServerSaveData() {

		var server = prompt("削除するサーバーの接頭語(s**やm**など)を入力してください。\n\n【！！警告！！】\nOKを押すと、指定サーバーの3gokushi-etcsの設定が 『全て』 削除されます。\n取り扱いには十分注意してください！",SERVER_NAME);
		if(server == null) return;

		var name = "3GOKUSHI_ETCS_"+server+"_";
		var keys	 = GM_listValues();
		for (var i in keys) {
			if (keys[i].indexOf(name, 0) == 0) {
				GM_deleteValue(keys[i]);
			}
		}

		alert("指定サーバー("+server+")のデータを全て削除しました");
	}
	// ========================
	//	   拠点別データSAVE
	// ========================
	function saveVillageData( name, data, vID ) {

	//console.log(JSON.stringify(data));

		vID = (typeof vID == 'undefined') ? getVillageID() : vID;

		var save = GM_getValue(SAVE_NAME+'VillageData'+vID,null);

		if(save != null) {
			save = JSON.parse(save);	// JSON形式で保存していたのを復元
		} else {
			save = {};	// 無しの時は空
		}

		save[name] = data;

		GM_setValue(SAVE_NAME+'VillageData'+vID,JSON.stringify(save));
	}
	// ========================
	//	   拠点別データGET
	// ========================
	function loadVillageData( name, vID ) {

	//console.log(JSON.stringify(data));

		vID = (typeof vID == 'undefined') ? getVillageID() : vID;

		var save = GM_getValue(SAVE_NAME+'VillageData'+vID,null);

		if(save != null) {
			save = JSON.parse(save);	// JSON形式で保存していたのを復元
		} else {
			save = {};	// 無しの時は空
		}

		if(typeof save[name] != 'undefined') return(save[name]);
		return null;
	}
	// ========================
	//	   JSON SAVE
	// ========================
	function saveDataJSON( id, name, data ) {


		var save = GM_getValue(SAVE_NAME+id,null);

		if(save != null) {
			save = JSON.parse(save);	// JSON形式で保存していたのを復元
		} else {
			save = {};	// 無しの時は空
		}
		save[name] = data;

		GM_setValue(SAVE_NAME+id,JSON.stringify(save));
	}
	// ========================
	//	   JSON LOAD
	// ========================
	function loadDataJSON( id, name ) {


		var save = GM_getValue(SAVE_NAME+id,null);

		if(save != null) {
			save = JSON.parse(save);	// JSON形式で保存していたのを復元
		} else {
			save = {};	// 無しの時は空
		}

		if(typeof save[name] != 'undefined') return(save[name]);
		return null;
	}


	// ========================
	//		基本ウインドウ
	// ========================
	function baseWindow( title , winid, minBtn, maxBtn ){

		minBtn = typeof minBtn == 'undefined' ? false : minBtn;
		maxBtn = typeof maxBtn == 'undefined' ? false : maxBtn;


		// 基本ウインドウ
		this.winNode  = document.createElement('div');
		this.winNode.setAttribute('class','etcsBaseWindow');

		this.hStart = eventBridgeFunc(this,'dragStart');
		this.hNow	= eventBridgeFunc(this,'dragNow');
		this.hEnd	= eventBridgeFunc(this,'dragEnd');


		// タイトルバー
		this.titleBar = document.createElement('div');

		node = document.createElement('span');
		node.textContent = title;
		this.titleBar.appendChild(node);
		this.titleBar.addEventListener('mousedown', this.hStart, false);

		// ボタン領域
		this.btnArea = document.createElement('div');
		with(this.btnArea.style) {
			position = 'absolute';
			top 	 = '0.2em';
			right	 = '4px';
			height	 = '1em';
			margin	 = '0';
			padding  = '0';
			boxShadow= '1px 1px rgba(0,0,0,0.4)';
			zIndex	 = '10012';
		}

		// 閉じるボタン
		this.closeBtnNode = document.createElement('img');
		this.closeBtnNode.setAttribute('src','data:image/png;base64,'+		// ×ボタン画像
			'iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAAGuEPsmAAAAAXNSR0IArs4c6QAAAThJREFU'+
			'GNNNkD2uwjAQhGcNFhBxAQo4ACVCQiEnCLWRaOBoFKR0WpQLhNBAS2cXRIgThBQrsa8wDzHl'+
			'7N83S8xc1zW8903TwHvfmc1m5L0XkbIsyXsPQES6p9NJRPb7vWqa5v1+AyDv/Wg0yvNcRF6v'+
			'V5ZlCoC1VkTSNO33+1prcs7tdjutNQAA5/OZnHNEhH+Nx+PO9XodDofP57Ou68Vi8Xg8lNZ6'+
			'MBgAWC6XeZ4DUAEmTdOA87HW6/XxeAwQAKjX68VxHHYz8+FwIOfcdDqdz+dfjq+Y+XK53G63'+
			'LhHFcbzZbLbbbUgFgIiMMVmWaa2JqBuGoiiy1iqlVqsVgKIorLVRFIXqp4mIiChJkqIoACRJ'+
			'UpblN7gKt40xbdtWVRXcqqratjXGMDMAYub7/f77rV+JyGQy+QMV16krWAPknAAAAABJRU5E'+
			'rkJggg==');
		this.closeBtnNode.setAttribute('title','閉じる');
		with(this.closeBtnNode.style) {
			float	 = 'right';
			width	 = '1em';
			height	 = '1em';
			margin	 = '0';
			padding  = '0';
			boxShadow= '1px 1px rgba(0,0,0,0.4)';
			zIndex	 = '10012';
		}

		(function(lthis) {
			lthis.closeBtnNode.addEventListener('mouseover',function(){lthis.closeBtnNode.style.cursor = 'pointer';},false);
			lthis.closeBtnNode.addEventListener('mouseout', function(){lthis.closeBtnNode.style.cursor = '';}		,false);
		})(this);
		this.closeBtnHdl = eventBridgeFunc(this,'closeBtn');
		this.closeBtnNode.addEventListener('click', this.closeBtnHdl, false);	// 動作

		// 最小化ボタン
		this.minBtnNode = document.createElement('img');
		this.minBtnNode.setAttribute('src','data:image/png;base64,'+		// ボタン画像
			'iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAAXNSR0IArs4c6QAAAEBJREFU'+
			'GNNj/P//PwNBQFDR////WSCshQsXYlURHx/PwMDAxEAEGIyKoL6Li4tDFl20aBG5JjEyMuJR'+
			'xEhMtAAAZ+cSEp980xYAAAAASUVORK5CYII=');
		this.minBtnNode.setAttribute('title','最小化');
		with(this.minBtnNode.style) {
			float	 = 'right';
			width	 = '1em';
			height	 = '1em';
			margin	 = '0';
			padding  = '0';
			boxShadow= '1px 1px rgba(0,0,0,0.4)';
			zIndex	 = '10012';
		}
		if(!minBtn) this.minBtnNode.style.display = 'none';
		(function(lthis) {
			lthis.minBtnNode.addEventListener('mouseover',function(){lthis.minBtnNode.style.cursor = 'pointer';},false);
			lthis.minBtnNode.addEventListener('mouseout', function(){lthis.minBtnNode.style.cursor = '';}		,false);
		})(this);
		this.minBtnHdl = eventBridgeFunc(this,'minBtn');
		this.minBtnNode.addEventListener('click', this.minBtnHdl, false);	// 動作

		// 最大化ボタン
		this.maxBtnNode = document.createElement('img');
		this.maxBtnNode.setAttribute('src','data:image/png;base64,'+		// ボタン画像
			'iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAAXNSR0IArs4c6QAAAEVJREFU'+
			'GNOtkMEJwDAMA6WQOT2cF708Ai30YacQvQQ+ZDgDatNCwKxR25KGDnIEzadl5ucWET+W7kEG'+
			'bBcKXk/bR7XUvlsughsOe4iR0AAAAABJRU5ErkJggg==');
		this.maxBtnNode.setAttribute('title','最大化');
		with(this.maxBtnNode.style) {
			float	 = 'right';
			width	 = '1em';
			height	 = '1em';
			margin	 = '0';
			padding  = '0';
			boxShadow= '1px 1px rgba(0,0,0,0.4)';
			zIndex	 = '10012';
		}
		if(!maxBtn) this.maxBtnNode.style.display = 'none';
		(function(lthis) {
			lthis.maxBtnNode.addEventListener('mouseover',function(){lthis.maxBtnNode.style.cursor = 'pointer';},false);
			lthis.maxBtnNode.addEventListener('mouseout', function(){lthis.maxBtnNode.style.cursor = '';}		,false);
		})(this);
		this.maxBtnHdl = eventBridgeFunc(this,'maxBtn');
		this.maxBtnNode.addEventListener('click', this.maxBtnHdl, false);	// 動作

		// 内容部分
		this.contentNode = document.createElement('div');

		// 追加
		this.pareNode = document.getElementsByTagName('body')[0];
		this.pareNode.appendChild(this.winNode);
		this.winNode .appendChild(this.titleBar);
		this.titleBar.appendChild(this.btnArea);
		this.btnArea .appendChild(this.minBtnNode);
		this.btnArea .appendChild(this.maxBtnNode);
		this.btnArea .appendChild(this.closeBtnNode);
		this.winNode .appendChild(this.contentNode);

		this.winID = winid;
		baseWinList.push(this);

		this.listNo = baseWinList.length - 1;

		this.disp(false);	//off
	}
	baseWindow.prototype = {

		common	 : [],			// 汎用
		listNo	 : 0,
		winID	 : null,		// ウインドウのID
		pareNode : null,		// ウインドウの親ノード
		winNode  : null,		// ウインドウ自体のノード
		titleBar : null,		// タイトルバー
		btnArea  : null,		// ボタン系エリア(追加分)
		iconArea : null,		// アイコンエリア(追加分)
		closeBtnNode : null,		// 閉じるボタン
		minBtnNode	 : null,		// 最小化　〃
		MaxBtnNode	 : null,		// 最大化　〃
		closeProc: null,		// 閉じる時呼び出される関数
		minProc  : null,		// 最小化時 	 〃
		MaxProc  : null,		// 最大化時 	 〃
		closeBtnHdl : null,		// 閉じるボタン、イベントハンドラ
		minBtnHdl	: null,		// 最小化ボタン 	   〃
		maxBtnHdl	: null,		// 最大化ボタン 	   〃
		contentArea : null,		// 内容部分
		contentNode  : null,	// 内容のノード
		dragFlag : false,		// ドラッグ中
		win_x	 : 0,			// ウインドウ座標X
		win_y	 : 0,			//				 Y
		hStart	 : null,		// ドラッグ用 mousedownハンドラ
		hNow	 : null,		// ドラッグ用 mousemoveハンドラ
		hEnd	 : null,		// ドラッグ用 mouseup  ハンドラ
		drag_x	 : 0,
		drag_y	 : 0,

		// クローズ(終了処理)
		close : function() {
			 if(!((this.closeProc != null) ? this.closeProc() : true)) return;	// falseでキャンセル

			this.closeBtnNode.removeEventListener('click', this.closeBtnHdl, false);	// 閉じる
			this.minBtnNode  .removeEventListener('click', this.minBtnHdl  , false);	// 最小
			this.maxBtnNode  .removeEventListener('click', this.maxBtnHdl  , false);	// 最大

			this.pareNode.removeChild(this.winNode);
			delete baseWinList[this.listNo];

		},
		// 最小化
		min : function() {
			if(this.minProc != null) this.minProc();
		},
		// 最大化
		max : function() {
			if(this.maxProc != null) this.maxProc();
		},

		// 閉じるボタン
		closeBtn : function( event ) {
			this.close();
			event.preventDefault();
		},
		// 最小化ボタン
		minBtn : function( event ) {
			this.min();
			event.preventDefault();
		},
		// 最大化ボタン
		maxBtn : function( event ) {
			this.max();
			event.preventDefault();
		},

		// ドラッグ開始
		dragStart: function( event ) {
			if((event.currentTarget != this.titleBar) || (event.target == this.closeBtnNode)
					 || (event.target == this.maxBtnNode)  || (event.target == this.minBtnNode)){
				 return true;	// タイトルバーじゃない
			}
			this.drag_x = event.layerX;
			this.drag_y = event.layerY;

			document.addEventListener('mousemove', this.hNow, false);
			document.addEventListener('mouseup',   this.hEnd, false);
			this.winNode.style.opacity = '0.8';
			event.preventDefault();
			return false;
		},
		// ドラッグ中
		dragNow : function( event ) {

			this.winNode.style.left = (event.pageX-this.drag_x)+'px';
			this.winNode.style.top	= (event.pageY-this.drag_y)+'px';

		},
		// ドラッグ終了
		dragEnd : function( ) {
			document.removeEventListener('mousemove', this.hNow, false);
			document.removeEventListener('mouseup',   this.hEnd, false);
			this.winNode.style.opacity = '1.0';
		},

		// ウインドウサイズの調整
		fixSize : function () {
			var containerNode = document.getElementById('container');
			var rect = this.winNode.getBoundingClientRect();

			// window全体
			var winw = rect.width;
			var winh = rect.height;

			try {
				winw = (winw > window.top.innerWidth  - 48) ? window.top.innerWidth  - 48 : winw;
				winh = (winh > window.top.innerHeight - 48) ? window.top.innerHeight - 48 : winh;
			} catch(e) {
				// mixi(frame)
				winw = (winw > containerNode.offsetWidth  - 48) ? containerNode.offsetWidth  - 48 : winw;
				winh = (winh > containerNode.offsetHeight - 48) ? containerNode.offsetHeight - 48 : winh;
			}
			var w	= parseInt(document.defaultView.getComputedStyle(this.contentNode,'').width);
			var h	= parseInt(document.defaultView.getComputedStyle(this.contentNode,'').height);

			this.contentNode.style.width  = winw - (rect.width	- w)  + 'px'
			this.contentNode.style.height = winh - (rect.height - h)  + 'px'
		},

		// ON/OFF
		disp : function( flag ) {
			if(flag == true) {
				this.winNode.style.display = 'block';
				this.fixSize();
				this.contentNode.style.minWidth = (this.titleBar.getElementsByTagName('span')[0].offsetWidth + 12) + 'px';
				this.winNode.style.opacity = '1.0';


			} else if(flag == false){
				this.winNode.style.opacity = '0.0';
				this.winNode.style.display = 'none';
			}
		},

		// 指定位置に表示
		pos : function( x, y ) {
			this.winNode.style.left = x + 'px';
			this.winNode.style.top	= y + 'px';
		},
		// ブラウザ真ん中に表示
		// 引数指定時、センタリングしない
		center : function( posx, posy ) {

			var x;
			var y;

			try {
				// 本鯖
				x = ((window.top.innerWidth  - this.winNode.offsetWidth)  / 2 + window.scrollX);
				y = ((window.top.innerHeight - this.winNode.offsetHeight) / 2 + window.scrollY);
			} catch(e) {
				// mixi(frame)
				// 子frameから親のwindowはpermissionエラーなので、containerを使う(仮)
				var containerNode = document.getElementById('container');
				x = (containerNode.offsetWidth	-  this.winNode.offsetWidth) / 2;
				y = (containerNode.offsetHeight -  this.winNode.offsetWidth) / 2;
			}

			// 引数指定時はそれを使う
			x = typeof posy != 'undefined' ? posx : x;
			y = typeof posy != 'undefined' ? posy : y;

			this.winNode.style.left = (x < 0 ? 0 : x) + 'px';
			this.winNode.style.top	= (y < 0 ? 0 : y) + 'px';

		},

		// 座標近くに表示
		nearPos : function( x, y ) {

			var rect		= this.winNode.getBoundingClientRect();

			x = x - 12;
			y = y - 12;
			if(x < 0) x = 0;
			if(y < 0) y = 0;
			try {
				// 本鯖
				if((x + rect.width) > window.top.innerWidth - 16) {
					x = window.top.innerWidth  - rect.width;
				}
				if((y + rect.height) > window.top.innerHeight - 16) {
					y = window.top.innerHeight - rect.height;
				}
			} catch(e) {
				// mixi(frame)
				var containerNode = document.getElementById('container');
				if((x + rect.width) > containerNode.offsetWidth - 16) {
					x = containerNode.offsetWidth - rect.width;
				}
				if((y + rect.height) > containerNode.offsetHeight - 16) {
					y = containerNode.offsetHeight - rect.height;
				}
			}

			this.winNode.style.left = x + window.scrollX + "px";
			this.winNode.style.top	= y + window.scrollY + "px";

		},
		// ノード近くに表示
		nearPosNode : function( node ) {
			var x;
			var y;

			var rect = node.getBoundingClientRect();
			x = rect.left;
			y = rect.top;

			this.nearPos(x,y);

		},

		// マウス近くに表示
		nearPosMouse : function ( event ) {
			this.nearPos(event.clientX,event.clientY);

		},

		// 内容を追加
		addContent : function( addNode ) {
			this.contentNode.appendChild( addNode );
		},

	};
	// ========================
	//		自前ツールチップ
	// ========================
	/*
		ノードにツールチップをセットする
	*/
	function setToolTip( targetNode , str ) {

		targetNode.addEventListener('mouseover',function( event ) {
			setToolTipCore(event, targetNode,str);
		},false);

	};
	/*
		既にそのノードでセットされているツールチップを返す
	*/
	function getToolTip( targetNode ) {
		for(var i = 0;i < myToolTipList.length; i++) {
			if(typeof myToolTipList[i] == 'undefined') continue;
			if(myToolTipList[i].targetNode == targetNode) return myToolTipList[i];
		}

		return null;
	}
	/*
		自前のツールチップを呼ぶ
	*/
	function setToolTipCore( event, targetNode , str ) {

		var strnode;

		switch(typeof str) {
			case 'string':				// 文字列
				strnode = document.createElement('p');
				strnode.innerHTML = str;
			break;
			case 'object':				// オブジェクト
				try {
					str.nodeType == str.nodeType;
					strnode = str;
				} catch(e) {
					console.log("ERROR:setToolTip > not node or string");
					return;
				}
			break;
		}

		var tooltip = new MyToolTip(event, targetNode,strnode);
		targetNode.addEventListener('mouseout', tooltip.closeHdl, false);

	}
	/*
		自前のツールチップ
	*/
	function MyToolTip( event, targetNode , contentNode ) {

		this.pareNode = document.getElementsByTagName('body')[0];

		if(typeof targetNode  == 'undefined') {console.log("MyToolTip:none TargetNode");  return; }
		if(typeof contentNode == 'undefined') {console.log("MyToolTip:none contentNode"); return; }

		this.addContent(contentNode);
		this.targetNode  = targetNode;
		this.closeHdl	 = eventBridgeFunc(this,'close');
		this.waitHdl	 = eventBridgeFunc(this,'wait');
		this.mouseChkHdl = eventBridgeFunc(this,'mousecheck');


		this.wait(event);
		myToolTipList[myToolTipList.length] = this;
		this.listNo = myToolTipList.length - 1;

	}
	MyToolTip.prototype = {

		listNo		: 0,
		targetNode	: null,		// ターゲット
		frameNode	: null,		// 吹き出しベース
		contentNode : null,
		pareNode	: null,		// 追加元
		closeHdl	: null,		// 閉じる時の関数
		waitHdl 	: null,		// ウエイト開始の関数
		mouseChkHdl : null,		//
		timerID 	: -1,
		mouseX		: -1,
		mouseY		: -1,
		dispInfo	: false,
		nodeList	: null,

		// コンテンツ追加
		addContent : function( contentNode ) {
			this.contentNode = contentNode;
		},

		// 吹き出し表示まち開始
		wait : function( event ) {

			this.mouseX = event.clientX;
			this.mouseY = event.clientY;

			this.targetNode.addEventListener('mousemove',this.mouseChkHdl, false);	// 動いたら消す
			this.disp_off();
			if(this.timerID != -1) { clearTimeout(this.timerID); this.timerID = -1; }
			this.timerID = setTimeout(eventBridgeFunc(this,'disp'), 1000);

		},
		// マウスチェック
		mousecheck : function( event ) {
			this.mouseX = event.clientX;
			this.mouseY = event.clientY;

			this.disp_off();
			if(this.timerID != -1) { clearTimeout(this.timerID); this.timerID = -1; }
			this.timerID = setTimeout(eventBridgeFunc(this,'disp'), 1000);
		},


		// 終了時
		close : function() {
			if(this.timerID != -1) { clearTimeout(this.timerID); this.timerID = -1; }
			this.targetNode.removeEventListener('mousemove', this.mouseChkHdl ,    false);
			this.disp_off();

			delete myToolTipList[this.listNo];

		},

		// 吹き出しの表示
		disp : function() {

			this.timerID = -1;
			this.dispInfo = true;
			this.frameNode = document.createElement('div');
			this.frameNode.setAttribute('class','etcs_mytooltip');
			this.frameNode.appendChild(this.contentNode);
			this.pareNode.appendChild(this.frameNode);


			this.nearPos(this.mouseX,this.mouseY);

		},
		disp_off : function() {
			if(this.dispInfo) {
				this.dispInfo = false;
				this.pareNode.removeChild(this.frameNode);
			}
		},

		// 座標近くに表示
		nearPos : function( x, y ) {

			var rect		= this.frameNode.getBoundingClientRect();

			try {
				// 本鯖
				if((x + rect.width) > window.top.innerWidth - 36) {
					x = x - rect.width + window.scrollX;
				} else {
					x = x + 12 + window.scrollX;
				}
				if((y + rect.height) > window.top.innerHeight - 36) {
					y = y - rect.height + window.scrollY;
				} else {
					y = y + 12 + window.scrollY;
				}
			} catch(e) {
				// mixi(frame)
				var containerNode = document.getElementById('container');
				if((x + rect.width) > containerNode.offsetWidth - 36) {
					x = x - rect.width + window.scrollX;
				} else {
					x = x + 12 + window.scrollX;
				}
				if((y + rect.height) > containerNode.offsetHeight - 36) {
					y = y - rect.height + window.scrollY;
				} else {
					y = y + 12 + window.scrollY;
				}
			}

			this.frameNode.style.left = x + "px";
			this.frameNode.style.top  = y + "px";

		},
	};

	/*
		既にウインドウが登録されていたら返す
	*/
	function searchBaseWindow( winid ) {

		for(i in baseWinList) {
			if(baseWinList[i].winID == winid) return baseWinList[i];
		}
		return null;
	}
	// ========================
	//		  ツール類
	// ========================
	/*
	   クラスのメンバにイベントで飛ぶときに、thisがクラスを指すようにするブリッジ
	   inst :
	   func : 関数名(文字列)
	*/
	function eventBridgeFunc( inst, func ) {
		return function( event ) {
			eval("inst."+func+'( event )');
		}
	}

	/*
		XPATHでノードを取得(返値：取得したノードの配列)
	*/
	function getNodeXPath( xpath , base , doc ) {
		base = (typeof base == "undefined" ? document : base);
		doc  = (typeof doc	== "undefined" ? document : doc);

		var result = doc.evaluate(xpath,base,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);
		var ret    = [];


		for(var i = 0;i < result.snapshotLength;i++) {
			ret.push(result.snapshotItem(i));
		}
		return(ret);
	}
	/*
		XPATHでノードを選択し、イベントを付加
	*/
	function addEventByXPath( xpath, event, func ,flag) {
		flag = typeof flag == 'undefined' ? true : flag;
		var result = document.evaluate(xpath,document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);
		var ret;

		for(var i = 0;i < result.snapshotLength;i++) {
			ret = result.snapshotItem(i);
			ret.addEventListener(event,func,flag)
		}
	}
	/*
		DateObjから文字列(yyyy-mm-dd hh:mm:ss)生成
	*/
	function makeDateString( date ) {

		return(date.getFullYear() + '-' +
				 ('00'+(date.getMonth()+1)).substr(-2) + '-' +
				 ('00'+date.getDate())	 .substr(-2) + ' '+
				 ('00'+date.getHours())  .substr(-2) + ':' +
				 ('00'+date.getMinutes()).substr(-2) + ':' +
				 ('00'+date.getSeconds()).substr(-2)
		);
	}
	/*
		文字列(yyyy-mm-dd hh:mm:ss)から時間Objに変換
	*/
	function cnvMDateStrToDate( dateString ) {

		return (new Date(dateString.replace(/.*(\d{4}-\d{1,2}-\d{1,2}\s+\d{1,2}\:\d{1,2}(\:\d{1,2})?).*/,'$1').replace(/-/g,'/')));

	}
	/*
		時間文字列(hh:mm:ss)から時間msに変換
	*/
	function cnvMTimeStrToTime( dateString ) {

		var time = -1;
		if(dateString.match(/.*?((\d{1,2})\:(\d{1,2})\:(\d{1,2})).*/)) {
			time = parseInt(RegExp.$2,10)*3600 + parseInt(RegExp.$3,10)*60 + parseInt(RegExp.$4,10);
			return time * 1000;
		}
		return -1;
	}

	/*
		現在の時間を取得
	*/
	function getNowTime() {


		// サーバー時間を取得
		var timedate = cnvMDateStrToDate(document.getElementById('server_time').textContent);

		if(timedate == 'Invalid Date') {
			console.log("ERROR:サーバー時間取得失敗");
			return new Date();
		}
		return timedate;

	}
	/*
		何時間何分を表示
	*/
	function makeRestTimeString( fmt , rest )
	{
		var str = "";
		var day,hour,hours,minuts,sec,tmp;

		hours = parseInt((rest / (	 60*60*1000))		,10);

		str = fmt;
		str = str.replace("%%day",	 parseInt((rest / (24*60*60*1000))		 ,10));
		str = str.replace("%%hours", hours < 100 ? ("00"+hours).substr(-2) : hours);
		str = str.replace("%%hour",  ('00'+parseInt((rest / (	60*60*1000)) % 24  ,10)).substr(-2));
		str = str.replace("%%minuts",('00'+parseInt((rest / (	   60*1000)) % 60  ,10)).substr(-2));
		str = str.replace("%%sec",	 ('00'+parseInt((rest % (	   60*1000)) / 1000,10)).substr(-2));

		return str;
	}
	/*
		Ajaxで読み込んだHTMLをノードとして使えるようにする
	*/
	function parseHTML( htmlText ) {

		// パース
		var htmldoc;
		if(document.implementation.createHTMLDocument) {
			htmldoc = document.implementation.createHTMLDocument('');
		} else {
			var docType = document.implementation.createDocumentType('html',
					'-//W3C//DTD HTML 4.01 Transitional//EN',
					'http://www.w3.org/TR/html4/loose.dtd'
			);
			htmldoc = document.implementation.createDocument(null,'html',docType);
		}

		var htmlData = htmlText;

		var range = htmldoc.createRange();
		range.selectNodeContents( document.documentElement );
		range.createContextualFragment( htmlData );
		node  = htmldoc.adoptNode(range.createContextualFragment( htmlData ));
		htmldoc.documentElement.appendChild( node );

		return htmldoc;
	}
	/*
		配列をセーブ
	*/
	function saveArray( saveID , saveArray , separator ) {

		separator = typeof separator == 'undefined' ? ['\t','##','**','!!'] : separator;	//区切り指定無しはタブ

		//配列,セパレータ...
		var joinarray = function(array,separator) {
			var arrybuf = [];
			var sepa	= typeof separator == 'object' ? separator[0] : separator;
			for(var i = 0;i < array.length;i++) {
				arrybuf[arrybuf.length] = typeof array[i] == "object" ? joinarray(array[i],separator.slice(1)) : array[i];
			}
			return arrybuf.join(sepa);
		}
		var saveStr = joinarray(saveArray , separator);
		GM_setValue( SAVE_NAME+saveID, saveStr);
	}
	/*
		ロードして配列へ
	*/
	function loadArray( saveID, separator ) {

		separator = typeof separator == 'undefined' ? ['\t','##','**','!!'] : separator;	//区切り指定無しはタブ

		var splitarray = function( str , separator ) {

			var sepa	= typeof separator == 'object' ? separator[0] : separator;
			var ret = [];

			ret = str.split(sepa);
			for(var i = 0;i < ret.length;i++) {
				for(var j = separator.length - 1; j >= 0; j--) {
					if(ret[i].indexOf(separator[j]) != -1) {
						ret[i] = splitarray(ret[i],separator.slice(1));
						break;
					}
				}
			}
			return ret;
		}

		var ret =  GM_getValue( SAVE_NAME+saveID );
		if(ret == null) return null;
		if(ret == '')	return null;

		return splitarray(ret,separator);
	}

	/*
		GM系対策
	*/
	function GM_init() {
	///////////////////////////////////////////////
	//Chrome用GM_関数
	// @copyright 2009, James Campos
	// @license cc-by-3.0; http://creativecommons.org/licenses/by/3.0/
		if ((typeof GM_getValue != 'undefined') && (GM_getValue('a', 'b') != undefined)) {
			return;
		}
		GM_addStyle = function(css) {
			var style = document.createElement('style');
			style.textContent = css;
			document.getElementsByTagName('head')[0].appendChild(style);
		};

		GM_deleteValue = function(name) {
			localStorage.removeItem(name);
		};

		GM_getValue = function(name, defaultValue) {
			var value = localStorage.getItem(name);
			if (!value)
			return defaultValue;
			var type = value[0];
			value = value.substring(1);
				switch (type) {
					case 'b':
					return value == 'true';
					case 'n':
					return Number(value);
					default:
					return value;
				}
		};

		GM_setValue = function(name, value) {
			value = (typeof value)[0] + value;
			localStorage.removeItem(name);	// pkzn追加 ChromeのERROR:22対策
			localStorage.setItem(name, value);
		};

		// beyondより
		GM_xmlhttpRequest = function(requestParam) {
			var xhr;
			if (typeof XMLHttpRequest == 'function') {
				xhr = XMLHttpRequest;
			} else {
				return;
			}
			var req = new xhr();
		   ['onload', 'onerror', 'onreadystatechange'].forEach(function (event) {
				if ((event in requestParam) == false) {
					return;
				}
				req[event] = function () {
					var isComplete = (req.readyState == 4);
					var responseState = {
							responseText: req.responseText,
							readyState: req.readyState,
							responseHeaders: isComplete ? req.getAllResponseHeaders() : '',
							status: isComplete ? req.status : 0,
							statusText: isComplete ? req.statusText : '',
							finalUrl: isComplete ? requestParam.url : ''
					};
					requestParam[event](responseState);
				};
			});

			try {
				req.open(requestParam.method ? requestParam.method : 'GET', requestParam.url, true);
			} catch(e) {
				if (requestParam.onerror) {
					requestParam.onerror({readyState:4, responseHeaders:'', responseText:'', status:403, statusText:'Forbidden', finalUrl:''});
				}
				return;
			}

			if ('headers' in requestParam && typeof requestParam.headers == 'object') {
				for (var name in requestParam.headers) {
					req.setRequestHeader(name, requestParam.headers[name]);
				}
			}

			req.send(('data' in requestParam) ? requestParam.data : null);
			return req;
		};


		if(typeof GM_listValues == 'undefined')	{
			GM_listValues = function() {
				list = [];
				for(i = 0;i < localStorage.length;i++) {
					list.push(localStorage.key(i));
				}
				return list;
			};
		}
	}
}

//---------------------------------------------
// 領地画面から領地名変更 2014/02/23 add
//---------------------------------------------
function disp_territory_name_change(){
	if( location.pathname != "/land.php" ) {
		return;
	}
	var host = location.hostname;
	var path = location.pathname;

	var tMenu = document.getElementById("tMenu_btnif");
	var xy = document.getElementsByClassName("xy");
	xy.item(0).innerHTML.match(/\(([\S]*),([\S]*)\)/);
	var x = RegExp.$1
	var y = RegExp.$2
	var basename = document.getElementsByClassName("basename").item(0).innerHTML;

	if( (tMenu.innerHTML.indexOf("レベルアップ")!=-1) || (tMenu.innerHTML.indexOf("拠点")!=-1) || (tMenu.innerHTML.indexOf("破棄")!=-1) ){
		var chgnmlnk = document.createElement("a");
		chgnmlnk.className = "easy";
		chgnmlnk.href = "javascript:void(0);";
		chgnmlnk.innerHTML = "領地名の変更";
		chgnmlnk.addEventListener("click",function(){show_btn();},false);

		var chgnmtbx = document.createElement("input");
		chgnmtbx.id = "chgnm_txt";
		chgnmtbx.value = basename;
		chgnmtbx.type = "hidden";

		var chgnmbtn = document.createElement("input");
		chgnmbtn.type = "hidden";

		var area = document.createElement("div");
		tMenu.appendChild(area);

		area.appendChild(chgnmlnk);
		area.appendChild(chgnmtbx);
		area.appendChild(chgnmbtn);
	}

	function show_btn(){
		chgnmlnk.style.display = "none";
		chgnmtbx.type = "text";
		chgnmtbx.size = "15";
		chgnmbtn.type = "button";
		chgnmbtn.value = "変更";
		chgnmbtn.addEventListener("click",function(){chgname();},false);

		var profile = document.createElement("div");
		wrapHttpReq("http://"+host+"/user/change/change.php#ptop", "GET", null,
			function(response){
				profile.innerHTML = response;
			}
		);
		profile.id = "TempDOM01";
		profile.style.display = "none";
		document.body.appendChild(profile);

		var deck = document.createElement("div")
		var url02 = "http://"+host+"/card/deck.php";
		wrapHttpReq("http://"+host+"/card/deck.php", "GET", null,
			function(response){
				deck.innerHTML = response;
			}
		);
		deck.id = "TempDOM02";
		deck.style.display = "none";
		document.body.appendChild(deck);
	}

	function chgname(){
		var new_name = document.getElementById("chgnm_txt").value;
		var position = "<td>"+x+","+y+"</td>";

		var table = '//*[@id="TempDOM01"]//*[@id="gray02Wrapper"]//*[@class="commonTables"]//tr';
		var tr = document.evaluate(table,document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);

		var input_name = "";
		for( var i=0; i < tr.snapshotLength; i++ ){
			if( tr.snapshotItem(i).innerHTML.indexOf(position) != -1 ){
				var input = document.evaluate(table+"["+(i+1)+"]//input",document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
				input_name = input.name;
				break;
			}
		}

		if( input_name.length > 0 ){
			var add00 = '//*[@id="TempDOM01"]//*[@id="gray02Wrapper"]//form[@name="input_user_profile"]//input';
			var add01 = '//*[@id="TempDOM01"]//*[@id="gray02Wrapper"]//form[@name="input_user_profile"]//textarea';
			var add02 = '//*[@id="TempDOM02"]//*[@id="gray02Wrapper"]//*[@name="ssid"]';
			var input = document.evaluate(add00,document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
			var textarea = document.evaluate(add01,document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
			var ssid = document.evaluate(add02,document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);

			var data = "ssid="+ssid.snapshotItem(0).value;
			for( var i = 0; i < textarea.snapshotLength; i++ ){
				data += "&" + textarea.snapshotItem(i).name + "=" + textarea.snapshotItem(i).innerHTML
			}
			for( var i = 0; i < input.snapshotLength; i++ ){
				if( (input.snapshotItem(i).type == "radio") && (input.snapshotItem(i).checked == false) ){
					continue;
				}
				data += "&";
				if( input.snapshotItem(i).name == input_name ){
					data += input_name + "=" + new_name;
				}else if( input.snapshotItem(i).name == "btn_preview"){
					data += "btn_send=更新"
				}else{
					data += input.snapshotItem(i).name + "=" + input.snapshotItem(i).value
				}
			}
			//alert(data)
			wrapHttpReq("http://" + host + "/user/change/change.php#ptop", "POST", data,
				function(response) {
					document.location.reload();
				}
			);
		}
	}
}
// end

//---------------------------------
// 時間表示 2014/02/23 add
//---------------------------------
function disp_showtime(){
	var ret = xpath('//div[@class="useCpReturn"]', document);
	if (ret.snapshotLength) {
		ret.snapshotItem(0).style.display = "none";
		var url = xpath('//div[@class="useCpReturn"]/a', document).snapshotItem(0).href;
	}

	var action1 = xpath('//div[@id="action"]/div[@class="floatInner"]/ul/li', document);
	var action2 = xpath('//div[@id="action"]/div[@class="floatInner"]/ul/li/span', document);
	var action3 = xpath('//div[@id="action"]/div[@class="floatInner"]/ul/li/a', document);
	var len = action1.snapshotLength;

	for (var i=0;i<len;i++){
		action1.snapshotItem(i).innerHTML = action1.snapshotItem(i).innerHTML.replace("%0A","");
		if (action3.snapshotItem(i).innerHTML == "帰還") {
			action1.snapshotItem(i).innerHTML = action1.snapshotItem(i).innerHTML + '<br><span>　　(<a href="' + url + '">' + generateDateString2(computeTime(action2.snapshotItem(i).innerHTML)) + '</a>)</span>';
		} else {
			action1.snapshotItem(i).innerHTML = action1.snapshotItem(i).innerHTML + "<br><span>　　(" + generateDateString2(computeTime(action2.snapshotItem(i).innerHTML)) + ")</span>";
		}
	}

	function xpath(query,targetDoc) {
		return document.evaluate(query, targetDoc, null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	}

	function computeTime(clock) {
		var hour = parseInt(trimZero(
			clock.replace(/^([0-9]{2}):([0-9]{2}):([0-9]{2})$/, "$1")));
		if (isNaN(hour)) hour = 0;
		var min = parseInt(trimZero(
			clock.replace(/^([0-9]{2}):([0-9]{2}):([0-9]{2})$/, "$2")));
		if (isNaN(min)) min = 0;
		var sec = parseInt(trimZero(
			clock.replace(/^([0-9]{2}):([0-9]{2}):([0-9]{2})$/, "$3")));
		if (isNaN(sec)) sec = 0;

		var stime = xpath('//*[@id="server_time"]', document);
		var server_year  = parseInt(stime.snapshotItem(0).innerHTML.replace(/^([0-9]{4})-([0-9]{2})-([0-9]{2}) ([0-9]{2}):([0-9]{2}):([0-9]{2})$/, "$1"));
		var server_month = parseInt(stime.snapshotItem(0).innerHTML.replace(/^([0-9]{4})-([0-9]{2})-([0-9]{2}) ([0-9]{2}):([0-9]{2}):([0-9]{2})$/, "$2"));
		var server_day	 = parseInt(stime.snapshotItem(0).innerHTML.replace(/^([0-9]{4})-([0-9]{2})-([0-9]{2}) ([0-9]{2}):([0-9]{2}):([0-9]{2})$/, "$3"));
		var server_hour  = parseInt(stime.snapshotItem(0).innerHTML.replace(/^([0-9]{4})-([0-9]{2})-([0-9]{2}) ([0-9]{2}):([0-9]{2}):([0-9]{2})$/, "$4"));
		var server_min	 = parseInt(stime.snapshotItem(0).innerHTML.replace(/^([0-9]{4})-([0-9]{2})-([0-9]{2}) ([0-9]{2}):([0-9]{2}):([0-9]{2})$/, "$5"));
		var server_src	 = parseInt(stime.snapshotItem(0).innerHTML.replace(/^([0-9]{4})-([0-9]{2})-([0-9]{2}) ([0-9]{2}):([0-9]{2}):([0-9]{2})$/, "$6"));

		var now = new Date(server_year,server_month,server_day,server_hour,server_min,server_src,0);
		var resTime = new Date();
		resTime.setHours(now.getHours() + hour);
		resTime.setMinutes(now.getMinutes() + min);
		resTime.setSeconds(now.getSeconds() + sec);

		return resTime;
	}

	//日時文字列編集（yyyy/mm/dd hh:mm:ss）
	function generateDateString(date) {
		var res = "" + date.getFullYear() + "/" + padZero(date.getMonth() + 1) +
			"/" + padZero(date.getDate()) + " " + padZero(date.getHours()) + ":" +
			padZero(date.getMinutes()) + ":" + padZero(date.getSeconds());
		return res;
	}

	//日時文字列編集2（mm/dd hh:mm:ss）
	function generateDateString2(date) {
		var res = "" + padZero(date.getMonth() + 1) + "/" + padZero(date.getDate()) +
			" " + padZero(date.getHours()) + ":" + padZero(date.getMinutes()) +
			":" + padZero(date.getSeconds());;
		return res;
	}

	//先頭ゼロ除去
	function trimZero(str) {
		var res = str.replace(/^0*/, "");
		if (res == "") { res = "0"; }
		return res;
	}
	//先頭ゼロ付加
	function padZero(num) {
		var result;
		if (num < 10) { result = "0" + num;
			   } else { result = ""  + num; }
		return result;
	}
}
//end

//-------------------------------------
// クエスト全部表示 2014/02/23 add
//-------------------------------------
//start
function disp_quest_all(){

	var VERSION = 1.111;

	var QUEST_ID_USER_RANKING	 = 123;
	var QUEST_ID_WEEKLY_RANKING   = 166;
	var QUEST_ID_ALLIANCE_RANKING = 106;
	var QUEST_ID_WORLD			= 111;
	var QUEST_ID_ALLIANCE_STATUS  = 249;

	var QUEST_ID_RETRY_1  = 254;
	var QUEST_ID_RETRY_2  = 255;
	var QUEST_ID_RETRY_3  = 256;

	var d = document;
	var $ = function (id, pd) {return pd ? pd.getElementById(id) : document.getElementById(id);};

	/**
	 * $x
	 * @description 以前の$a xpathを評価し結果を配列で返す
	 * @param {String} xp
	 * @param {HTMLElement|HTMLDocument} dc
	 * @returns {Array}
	 * @throws
	 * @function
	 */
	var $x = function(xp, dc) {function c(f) {var g = ''; if (typeof f === 'string') {g = f;} var h = function(a) {var b = document.implementation.createHTMLDocument(''); var c = b.createRange(); c.selectNodeContents(b.documentElement); c.deleteContents(); b.documentElement.appendChild(c.createContextualFragment(a)); return b;}; if (0 <= navigator.userAgent.toLowerCase().indexOf('firefox')) {h = function(a) {var b = document.implementation.createDocumentType('html', '-//W3C//DTD HTML 4.01//EN', 'http://www.w3.org/TR/html4/strict.dtd'); var c = document.implementation.createDocument(null, 'html', b); var d = document.createRange(); d.selectNodeContents(document.documentElement); var e = c.adoptNode(d.createContextualFragment(a)); c.documentElement.appendChild(e); return c;};} return h(g);} var m = [], r = null, n = null; var o = dc || document.documentElement; var p = o.ownerDocument; if (typeof dc === 'object' && typeof dc.nodeType === 'number') {if (dc.nodeType === 1 && dc.nodeName.toUpperCase() === 'HTML') {o = c(dc.innerHTML); p = o;} else if (dc.nodeType === 9) {o = dc.documentElement; p = dc;}} else if (typeof dc === 'string') {o = c(dc); p = o;} try {r = p.evaluate(xp, o, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); for (var i = 0, l = r.snapshotLength; i < l; i++) m.push(r.snapshotItem(i));} catch (e) {try {var q = p.evaluate(xp, o, null, XPathResult.ANY_TYPE, null); while (n = q.iterateNext()) m.push(n);} catch (e) {throw new Error(e.message);}} return m;};

	/**
	 * $s
	 * @description 以前の$x xpathを評価し1つの結果を返す
	 * @param {String} xp
	 * @param {HTMLElement|HTMLDocument} dc
	 * @returns {Node}
	 * @throws
	 * @see $x
	 * @function
	 */
	var $s = function(xp, dc) {return $x(xp, dc).shift();};

	/**
	 * $e
	 * @param {HTMLElement|HTMLDocument|Window} doc
	 * @param {String|Object} event string or event.click=f or event.click=[f, f, f]
	 * @param {Function} event handler
	 * @param {Boolean} [useCapture=false]
	 * @function
	 */
	var $e = function(doc, event, func, useCapture) {var eventList = event; var eType = null; var capture = useCapture || false; if (typeof event == 'string') {eventList = new Object(); eventList[event] = new Array(func);} else {for (eType in eventList) {if (typeof eventList[eType] == 'object'&& eventList[eType] instanceof Array) {continue;} eventList[eType] = [ event[eType] ];}} for (eType in eventList) {var eventName = eType; for (var i = 0; i < eventList[eType].length; i++) {doc.addEventListener(eventName, eventList[eType][i], capture);}}};

	// ページ読み込み完了後に本処理開始
	window.addEventListener("load", function() { main(); }, false);

	function main()
	{
		addQuestLink();

		if( $s('//div[@id=\"questB3_tab\"]') ){
			// 新形式クエストだと大変なので一旦やらない
		} else {
			var elem = $s('//p[@id=\"questB3_fukidashi\"]');
			if (elem){
				ncreateLink(elem, undefined, undefined, "未クリア"	, "未クリア"  , function(){ showQuest(0) } );
				ncreateLink(elem, undefined, undefined, "クリア済"	, "クリア済"  , function(){ showQuest(1) } );
				ncreateLink(elem, undefined, undefined, "全部"	  , "全部"	  , function(){ showQuest(2) } );
				ncreateLink(elem, undefined, undefined, "受理中"	, "受理中"	, function(){ showQuest(3) } );
				ncreateLink(elem, undefined, undefined, "チェック"	, "チェック"  , function(){ showQuest(0); checkFlag = true } );
			}
		}
	}

	var checkList = undefined;
	var checkFlag = false;

	function createCheckList()
	{
		if (checkList) return;

		checkList = $x('//a[contains(@id, "quest_id")]');
		checkQuestAll();
	}

	function checkQuestAll()
	{
		var elem = $s('//p[@id=\"questB3_fukidashi\"]');
		if (!checkList || checkList.length == 0){
			if (elem){
				elem.innerHTML = "終了";
				checkList = undefined;
				return;
			}
		}

		if (elem){
			elem.innerHTML = "残り " + checkList.length;
		}

		var elem_id = checkList[0].id;
		var quest_id = elem_id.match(/quest_id_([0-9]+)/)[1];
		checkList.shift();

		checkQuestASync(quest_id, elem_id);
	}

	function showQuest(mode)
	{
		var list = $s('//div[@id=\"questB3_table\"]/table/tbody');
		if (list){
			var list_item = $x('tr', list);
			for (i=1;i<list_item.length;i++){
				list.removeChild(list_item[i]);
			}
			var page_item = $s('//div[@id=\"questB3_pager\"]/ul');
			if (page_item){
				page_item.parentNode.removeChild(page_item);
			}
		}

		showQuestASync(mode, 1, 0);
	}

	function addQuestLinkSub(elem)
	{
		{
			var quest = $s('td[@class=\"quest_btn\"]/a', elem);
			if (quest){
				var cancel = quest.getAttribute("href").match(/cancelQuest/);
				//var quest_id = quest.getAttribute("href").match(/\(([0-9]+)\)/)[1];
				var quest_id = quest.getAttribute("href").match(/\(([0-9]+)[\s\,]+([0-9]+)[\s\,]+([0-9]+)\)/)[1];
				var elem_id = "quest_id_" + quest_id;
				if (!cancel){
					var linkElem = ncreateLink(quest.parentNode, elem_id, undefined, "チェック", "チェック");
					(function(a, b) {
						$e(linkElem, 'click', function() {
							checkQuestASync(a, b);
						}, true);
					})(quest_id, elem_id);
				}
				else{
					var linkElem = ncreateLink(quest.parentNode, elem_id, undefined, "キャンセル", "キャンセル");
					(function(a, b) {
						$e(linkElem, 'click', function() {
							cancelQuestASync(a, b, false);
						}, true);
					})(quest_id, elem_id);
				}
			}
		}

		{//繰り返し
			var quest = $s('td[@class=\"quest_btn\ attention_row_05\"]/a', elem);
			if (quest){
				var cancel = quest.getAttribute("href").match(/cancelQuest/);
				//console.log(quest.getAttribute('href'));//javascript:cancelQuest(254, 1, 1);
				//var quest_id = quest.getAttribute("href").match(/\(([0-9]+)\)/)[1];
				var quest_id = quest.getAttribute("href").match(/\(([0-9]+)[\s\,]+([0-9]+)[\s\,]+([0-9]+)\)/)[1];

				var elem_id = "quest_id_" + quest_id;
				if (!cancel){
					var linkElem = ncreateLink(quest.parentNode, elem_id, undefined, "チェック", "チェック");
					(function(a, b) {
						$e(linkElem, 'click', function() {
							checkQuestASync(a, b);
						}, true);
					})(quest_id, elem_id);
				}
				else{
					var linkElem = ncreateLink(quest.parentNode, elem_id, undefined, "キャンセル", "キャンセル");
					(function(a, b) {
						$e(linkElem, 'click', function() {
							cancelQuestASync(a, b, false);
						}, true);
					})(quest_id, elem_id);
				}
			}
		}
	}

	function addQuestLink()
	{
		var list = $s('//div[@id=\"questB3_table\"]/table/tbody');
		if (list){
			var list_item = $x('tr', list);
			for (var i=1;i<list_item.length;i++){
				addQuestLinkSub(list_item[i]);
			}
		}
	}

	function cancelQuestASync(quest_id, elem_id, flag)
	{
		var url = "http://" + location.host + "/quest/index.php"

		var func_success = function(req, param) {
			var elem = $(elem_id);
			if (elem){
				if (flag){
					elem.innerHTML = "未達成";
					elem.style.color = "#CC0000";
				}
				else{
					elem.innerHTML = "キャンセル成功";
					elem.style.color = "#0000CC";
				}
			}
			checkQuestAll();
		};

		var func_fail = function(req, param) {
			var elem = $(elem_id);
			if (elem){
				elem.innerHTML = "通信失敗";
				elem.style.color = "#CC0000";
			}
		};

		var elem = $(elem_id);
		if (elem){
			var parent = elem.parentNode;
			newElem = d.createElement('span');
			newElem.innerHTML = "通信中";
			newElem.id = elem_id;
			newElem.style.color = "black";
			parent.replaceChild(newElem, elem);
		}

		var param = [];
		var ex_param = [];

		param['cancel_id'] = quest_id;
		param['action'] = "cancel_quest";

		najaxRequest(url, "GET", param, ex_param, func_success, func_fail);

	}

	function getRewardASync(elem_id)
	{
		var url = "http://" + location.host + "/quest/index.php"

		var func_success = function(req, param) {
			var elem = $(elem_id);
			if (elem){
				elem.innerHTML = "達成";
				elem.style.color = "#0000CC";
			}
			checkQuestAll();
		};
		var func_fail = function(req, param) {
			var elem = $(param['elem_id']);
			if (elem){
				elem.innerHTML = "通信失敗";
				elem.style.color = "#CC0000";
			}
		};
		var param = [];
		var ex_param = [];

		param['c'] = 1;

		najaxRequest(url, "GET", param, ex_param, func_success, func_fail);

	}

	function checkQuestASyncInput(quest_id, elem_id, param)
	{
		var url = "http://" + location.hostname + "/quest/index.php";
		var elem = $(elem_id);

		var func_success = function(req, param) {
			var dom = d.createElement('html');
			dom.innerHTML = req.responseText;
			var tmp = $s('//*[@class=\"gnavi_questnew\"]', dom);
			if (tmp){
				getRewardASync(elem_id);
			}
			else{
				cancelQuestASync(quest_id, elem_id, true);
			}
		};
		var func_fail = function(req, param) {
			if (elem){
				elem.innerHTML = "通信失敗";
				elem.style.color = "#CC0000";
			}
		};

		var ex_param = [];

		param['disp_id'] = quest_id;

		najaxRequest(url, "POST", param, ex_param, func_success, func_fail);
	}

	function checkQuestASyncSub(quest_id, elem_id)
	{
		url = "";
		if (quest_id == QUEST_ID_USER_RANKING){
			url = "http://" + location.hostname + "/user/ranking.php";
		}
		else if (quest_id == QUEST_ID_WEEKLY_RANKING){
			url = "http://" + location.hostname + "/user/weekly_ranking.php";
		}
		else if(quest_id == QUEST_ID_ALLIANCE_RANKING){
			url = "http://" + location.hostname + "/alliance/list.php";
		}
		else{
			return;
		}
		var elem = $(elem_id);

		var func_success = function(req, param) {
			var dom = d.createElement('html');
			dom.innerHTML = req.responseText;
			var tmp = [];
			if (quest_id == QUEST_ID_USER_RANKING){
				var t = $x('//td[@class=\"rankNum\"]', dom);
				if (t){
					for (var i=0;i<t.length;i++){
						var tt = t[i].innerHTML.match(/→\ ([0-9]+)/);
						if (tt){
							tmp['tuto_p_ranking'] = tt[1];
							break;
						}
					}
				}
			}
			else if (quest_id == QUEST_ID_WEEKLY_RANKING){
				var t = $x('//div[@class=\"leftfloat\"]/table/tbody/tr/td', dom);
				if (t){
					for (var i=0;i<t.length;i++){
						var tt = t[i].innerHTML.match(/→\ ([0-9]+)/);
						if (tt){
							tmp['attack_rank'] = tt[1];
							break;
						}
					}
				}
			}
			else if(quest_id == QUEST_ID_ALLIANCE_RANKING){
				var t = $x('//td[@class=\"rankNum\"]', dom);
				if (t){
					for (var i=0;i<t.length;i++){
						var tt = t[i].innerHTML.match(/→\ ([0-9]+)/);
						if (tt){
							tmp['alliance_rank'] = tt[1];
							break;
						}
					}
				}
			}

			checkQuestASyncInput(quest_id, elem_id, tmp);
		};
		var func_fail = function(req, param) {
			if (elem){
				elem.innerHTML = "通信失敗";
				elem.style.color = "#CC0000";
			}
		};

		if (elem){
			var parent = elem.parentNode;
			newElem = d.createElement('span');
			newElem.innerHTML = "通信中";
			newElem.id = elem_id;
			newElem.style.color = "black";
			parent.replaceChild(newElem, elem);
		}

		var param = [];
		var ex_param = [];

		najaxRequest(url, "GET", param, ex_param, func_success, func_fail);

	}

	function checkQuestASync(quest_id, elem_id)
	{
		var url = "http://" + location.hostname + "/quest/index.php";

		var func_success = function(req, param) {
			var dom = d.createElement('html');
			dom.innerHTML = req.responseText;
			var tmp = $s('//*[@class=\"gnavi_questnew\"]', dom);
			if (tmp){
				getRewardASync(elem_id);
			}
			else{
				if (quest_id == QUEST_ID_USER_RANKING ||
					quest_id == QUEST_ID_WEEKLY_RANKING ||
					quest_id == QUEST_ID_ALLIANCE_RANKING ){
					checkQuestASyncSub(quest_id, elem_id);
				}
				else if(quest_id == QUEST_ID_WORLD ){
					param = [];
					param['x'] = 0;
					param['y'] = 0;
					checkQuestASyncInput(quest_id, elem_id, param);
				}
				else if(quest_id == QUEST_ID_ALLIANCE_STATUS ){
					param['que_alliance'] = 3;
					checkQuestASyncInput(quest_id, elem_id, param);
				}
				else if(quest_id == QUEST_ID_RETRY_1 ||
						quest_id == QUEST_ID_RETRY_2 ||
						quest_id == QUEST_ID_RETRY_3 ){
					var elem = $(elem_id);
					if (elem){
						elem.innerHTML = "受付中";
						elem.style.color = "#0000CC";
					}
					checkQuestAll();
				}
				else{
					cancelQuestASync(quest_id, elem_id, true);
				}
			}
		};
		var func_fail = function(req, param) {
			var elem = $(elem_id);
			if (elem){
				elem.innerHTML = "通信失敗";
				elem.style.color = "#CC0000";
			}
		};

		var elem = $(elem_id);
		if (elem){
			var parent = elem.parentNode;
			newElem = d.createElement('span');
			newElem.innerHTML = "通信中";
			newElem.id = elem_id;
			newElem.style.color = "black";
			parent.replaceChild(newElem, elem);
		}

		var param = [];
		var ex_param = [];

		param['id'] = quest_id;
		param['action'] = "take_quest";

		najaxRequest(url, "GET", param, ex_param, func_success, func_fail);
	}

	function addQuestItem(dom)
	{
		var res = $s('//div[@id=\"questB3_table\"]/table/tbody', dom);
		var list = $s('//div[@id=\"questB3_table\"]/table/tbody');
		if (list){
			var list_item = $x('tr', res);
			for (var i=1;i<list_item.length;i++){
				list_item[i].className = null;
				list.appendChild(list_item[i]);

				addQuestLinkSub(list_item[i]);
			}
		}
	}

	function showQuestASync(mode, p, page_max)
	{
		var elem = $s('//p[@id=\"questB3_fukidashi\"]');

		if (page_max != 0 && p > page_max){
			if (elem){
				elem.innerHTML = "終了";
			}
			if (checkFlag){
				checkFlag = false;
				createCheckList();
			}
		 	return;
		}

		if (elem){
			if (page_max == 0){
				elem.innerHTML = "ページ " + p;
			}
			else{
				elem.innerHTML = "ページ " + p + " / " + page_max;
			}
		}

		var url = "http://" + location.hostname + "/quest/index.php";

		var func_success = function(req, param) {
			var dom = d.createElement('html');
			dom.innerHTML = req.responseText;
			if (page_max == 0){
				var res = $s('//a[@title=\"last\ page\"]', dom);
				if (res){
					page_max = res.name.match(/p=([0-9]+)/)[1];
				}
				else{
					page_max = 1;
				}
			}
			addQuestItem(dom);
			var page = p + 1;
			showQuestASync(mode, page, page_max);
		};
		var func_fail = function(req, param) {
		};

		var param = [];
		var ex_param = [];

		param['mode'] = mode;
		param['action'] = "change_page";
		param['p'] = p;

		param['list'] = document.getElementsByName("list").item(0).value;

		param['sort_1st_item']	= document.getElementsByName("sort_1st_item").item(0).value;
		param['sort_1st_order']   = document.getElementsByName("sort_1st_order").item(0).value;
		param['sort_2nd_item']	= document.getElementsByName("sort_2nd_item").item(0).value;
		param['sort_2nd_order']   = document.getElementsByName("sort_2nd_order").item(0).value;
		param['sort_3rd_item']	= document.getElementsByName("sort_3rd_item").item(0).value;
		param['sort_3rd_order']   = document.getElementsByName("sort_3rd_order").item(0).value;
		param['filter_difficult'] = document.getElementsByName("filter_difficult").item(0).value;
		param['filter_category']  = document.getElementsByName("filter_category").item(0).value;
		param['filter_reward']	= document.getElementsByName("filter_reward").item(0).value;

		najaxRequest(url, "GET", param, ex_param, func_success, func_fail, true);
	}

	function ncreateLink(parent, id, def, text, title, func)
	{
		if (!def) def = "javascript:void(0);";

		var aElem = document.createElement("a");
			aElem.title = title;
			if (id) aElem.id = id;
			aElem.href = def;
			aElem.style.margin = "3px";
			aElem.innerHTML = text;
			parent.appendChild(aElem);

		if (func){
			$e(aElem, 'click', func);
		}
		return aElem;
	}

	function najaxRequest(url, method, param, ex_param, func_success, func_fail, sync)
	{
		if (sync == undefined) sync = true;

		var req = new XMLHttpRequest();

		req.onreadystatechange = function() {
			if (req.readyState == 4 && req.status == 200) {
				if (func_success){
					func_success(req, ex_param);
				}
			} else if (req.readyState == 4 && req.status != 200) {
				if (func_fail){
					func_fail(req, ex_param);
				}
			}
		};

		var senddata = "";
		for (name in param) {
			if (senddata != "") senddata += "&";
			senddata += name + "=" + escape(param[name]);
		}

		if (method == 'POST') {
			req.open(method, url, sync);
			req.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
			req.send(senddata);			   // Sending Request
		}
		else{
			if (senddata != "") url += "?" + senddata;
			req.open(method, url, sync);
			req.send(null);
		}
	}
};
//end

//-----------------------------------
// favorite trade 2014/02/23 add
//-----------------------------------
function disp_favorite_trade(){
	var version = "2.51";

	var default_value = 1999;

	///////////////////////////////////////////////
	//Chrome用GM_関数
	// @copyright 2009, James Campos
	// @license cc-by-3.0; http://creativecommons.org/licenses/by/3.0/
	if ((typeof GM_getValue == 'undefined') || (GM_getValue('a', 'b') == undefined)) {
		GM_addStyle = function(css) {
			var style = document.createElement('style');
			style.textContent = css;
			document.getElementsByTagName('head')[0].appendChild(style);
		};

		GM_deleteValue = function(name) {
			localStorage.removeItem(name);
		};

		GM_getValue = function(name, defaultValue) {
			var value = localStorage.getItem(name);
			if (!value)
			return defaultValue;
			var type = value[0];
			value = value.substring(1);
				switch (type) {
					case 'b':
					return value == 'true';
					case 'n':
					return Number(value);
					default:
					return value;
				}
		};

		GM_log = function(message) {
			if (window.opera) {
				opera.postError(message);
			return;
			}
	//	  console.log(message);
		};

		GM_registerMenuCommand = function(name, funk) {
		//todo
		};

		GM_setValue = function(name, value) {
			value = (typeof value)[0] + value;
			localStorage.setItem(name, value);
		};
	}
	///////////////////////////////////////////////

	var AH_list = ["仁君","弓腰姫の愛","神医の術式","神医の施術","文姫の慈愛","皇后の慈愛","傾国","優雅な調べ","城壁補強","熊猫の麺匠","酔吟吐息","勇姫督励","才女の瞳","桃色吐息","劉備の契り"];
	var host = location.hostname;
	var path = location.pathname;

	// お気に入りトレード初期設定値(現在のリスト個数を超える初期値は無視されます)
	// 初期化ボタンを押した時に再設定されます。
	var trade_search_default = [
		// 1つめには name, lv, no, skill のいずれかをセット。変なのいれたら武将名に自動的になります
		// 3つめからは TP不足表示、L表示, UR表示, SR表示、R表示、UC表示、C表示のフラグ
		['no',2146,1,0,1,1,1,1,1],
		['no',4094,1,0,1,1,1,1,1],
		['no',4040,1,0,1,1,1,1,1],
		['no',4024,1,0,1,1,1,1,1],
		['no',4269,1,0,1,1,1,1,1],
		['no',4049,1,0,1,1,1,1,1],
		['no',4030,1,0,1,1,1,1,1],
		['no',1198,1,0,1,1,1,1,1],
		['no',2072,1,0,1,1,1,1,1],
		['no',2048,1,0,1,1,1,1,1],
		['no',2082,1,0,1,1,1,1,1],
		['no',2090,1,0,1,1,1,1,1],
		['no',4203,1,0,1,1,1,1,1],
		['no',4211,1,0,1,1,1,1,1],
		['no',4265,1,0,1,1,1,1,1],
		['no',1071,1,0,1,1,1,1,1],
		['no',1187,1,0,1,1,1,1,1],
		['no',3122,1,0,1,1,1,1,1],
		['no',3189,1,0,1,1,1,1,1],
		['no',4143,1,0,1,1,1,1,1],
		['no',2087,1,0,1,1,1,1,1],
		['no',2177,1,0,1,1,1,1,1],
		['no',2143,1,0,1,1,1,1,1],
		['no',3140,1,0,1,1,1,1,1],
		['no',3107,1,0,1,1,1,1,1],
		['no',3056,1,0,1,1,1,1,1],
		['no',2112,1,0,1,1,1,1,1],
		['no',3057,1,0,1,1,1,1,1],
		['no',3032,1,0,1,1,1,1,1],
		['no',3105,1,0,1,1,1,1,1],
		['no',3192,1,0,1,1,1,1,1],
		['no',3077,1,0,1,1,1,1,1],
		['no',3098,1,0,1,1,1,1,1],
		['no',4268,1,0,1,1,1,1,1],
		['no',4061,1,0,1,1,1,1,1],
		['no',1077,1,0,1,1,1,1,1],
		['no',1054,1,0,1,1,1,1,1],
		['no',4115,1,0,1,1,1,1,1],
		['no',1201,1,0,1,1,1,1,1],
		['no',1104,1,0,1,1,1,1,1],
		['no',4118,1,0,1,1,1,1,1],
		['no',1115,1,0,1,1,1,1,1],
		['no',1053,1,0,1,1,1,1,1],
		['no',4216,1,0,1,1,1,1,1],
		['name','黄月英',0,1,1,1,1,1,1],
		['name','何皇后',0,1,1,1,1,1,1],
		['name','夏侯氏',0,1,1,1,1,1,1],
		['name','華佗',0,1,1,1,1,1,1],
		['name','郭汜',0,1,1,1,0,0,0],
		['name','甘夫人',0,1,1,1,1,0,0],
		['name','敬哀皇后',0,1,1,1,1,1,1],
		['name','献帝',0,1,1,1,1,1,1],
		['name','厳氏',0,1,1,1,1,1,1],
		['name','呉国太',0,1,1,1,1,1,1],
		['name','呉夫人',0,1,1,1,1,1,1],
		['name','徐氏',0,1,1,1,1,1,1],
		['name','小喬',0,1,1,1,1,1,1],
		['name','辛憲英',0,1,1,1,1,1,1],
		['name','大喬',0,1,1,1,1,1,1],
		['name','大虎',0,1,1,1,1,1,1],
		['name','丁夫人',0,1,1,1,1,1,1],
		['name','張春華',0,1,1,1,1,1,1],
		['name','董白',0,1,1,1,1,1,1],
		['name','歩夫人',0,1,1,1,1,1,1],
		['name','劉禅',0,1,1,1,1,0,0],
		['name','劉封',0,1,1,1,0,1,0],
		['name','劉焉',0,1,1,0,0,0,0],
		['name','劉璋',0,1,1,1,1,0,0],
		['name','霊帝',0,1,1,1,1,1,1],
		['name','卞夫人',0,1,1,1,1,1,1],
		['name','甄姫',0,1,1,1,1,1,1],
		['name','糜夫人',0,1,1,1,1,1,1],
		['name','蔡?',0,1,1,1,1,1,1],
		['name','貂蝉',0,1,1,1,1,1,1],
		['name','鄒氏',0,1,1,1,1,1,1],
		['name','鄧艾',0,0,0,0,0,1,0],
		['skill','暴姫の命',0,0,0,0,1,1,1],
		['skill','守護聖陣',0,0,1,1,1,1,1],
		['skill','守護方陣',0,0,1,1,1,1,1],
		['skill','全軍の極攻令',0,0,1,1,1,1,1],
		['skill','全軍の猛攻令',0,0,1,1,1,1,1],
		['skill','全軍の強攻令',0,0,1,1,1,1,1],
		['skill','水鏡鑑定',0,0,1,1,1,1,1],
		['skill','水鏡眼識',0,0,1,1,1,1,1],
		['skill','水鏡評論',0,0,1,1,1,1,1],
		['skill','鬼神の鹵獲',0,0,1,1,1,1,1],
		['skill','猛将の鹵獲',0,0,1,1,1,1,1],
		['skill','鬼神の極意',0,0,1,1,1,1,1],
		['skill','猛将の極意',0,0,1,1,1,1,1],
		['skill','桃色吐息',0,0,1,1,1,1,1],
		['skill','弓腰姫の愛',0,0,1,1,1,1,1],
		['skill','皇后の慈愛',0,0,1,1,1,1,1],
		['skill','神医の施術',0,0,1,1,1,1,1],
		['skill','神医の術式',0,0,1,1,1,1,1],
	//	['name','劉備',0,0,1,1,1,1,1],
	//	['no',1001,1,0,1,1,1,1,1],
	//	['lv',0,0,1,1,1,1,1,1],
	//	['skill','飛将',0,0,0,0,0,0,0],
	];

	var d = document;
	var $ = function(id) { return d.getElementById(id); };
	var $x = function(xp,dc) { return d.evaluate(xp, dc||d, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
	var $a = function(xp,dc) { var r = d.evaluate(xp, dc||d, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); var a=[]; for(var i=0; i<r.snapshotLength; i++){ a.push(r.snapshotItem(i)); } return a; };
	var $e = function(e,t,f) { if (!e) return; e.addEventListener(t, f, false); };

	jQuery.noConflict();
	j$ = jQuery;


	var BRO3_FAVORITE_TRADE_FLG = 'bro3_favavorite_trade_flg' + host;
	var BRO3_SHOW_CARD_ID_FLG	= 'bro3_show_card_id_flg' + host;
	var BRO3_APPEND_LINK_FLG	= 'bro3_append_link_flg' + host;
	var BRO3_SCORE_VIEW_FLG	 = 'bro3_score_view_flg' + host;
	var BRO3_IMMEDIATE_BID_FLG	= 'bro3_immediate_bid_flg' + host;
	var BRO3_TRADING_SUPPORT_FLG	= 'bro3_trading_support_flg' + host;
	var BRO3_ADD_DEL_COMMAND_FLG	= 'bro3_add_del_command_flg' + host;
	var BRO3_OVER_MOUSE_FLG	 = 'bro3_over_mouse_flg' + host;
	var BRO3_AUTO_DELETE_FLG	= 'bro3_auto_delete_flg' + host;
	var BRO3_AUTO_DELETE_CNO	= 'bro3_auto_delete_cno' + host;
	var BRO3_AUTO_BUSHODASU_MODE	= 'bro3_auto_bushodasu_mode' + host;
	var BRO3_DEL_TRADE_REPORT_FLG	= 'bro3_del_trade_report_flg' + host;
	var BRO3_AUTO_HEAL_FLG	  = 'bro3_auto_heal_flg' + host;
	var BRO3_AUTO_HEAL_B_ID	 = 'bro3_auto_heal_b_id' + host;
	var BRO3_AUTO_HEAL_S_NO	 = 'bro3_auto_heal_s_no' + host;
	var BRO3_AUTO_HEAL_V_ID	 = 'bro3_auto_heal_v_id' + host;
	var BRO3_CARD_COLLECT_FLG	= 'bro3_card_collect_flg' + host;
	var BRO3_10TP_COLLECT_FLG	= 'bro3_10tp_collect_flg' + host;
	var BRO3_MISC_FLG	   = 'bro3_misc_flg' + host;
	var BRO3_BULK_SET_FLG	   = 'bro3_bulk_set_flg' + host;

	var favorite_trade_flg	= 1;
	var show_card_id_flg	= 1;
	var append_link_flg = 1;
	var score_view_flg	= 1;
	var immediate_bid_flg	= 1;
	var trading_support_flg = 1;
	var add_del_command_flg = 1;
	var over_mouse_flg	= 1;
	var auto_delete_flg = 0;
	var auto_delete_cno = "";
	var auto_bushodasu_mode = 0;
	var del_trade_report_flg= 1;
	var auto_heal_flg	= 1;
	var card_collect_flg	= 1;
	var tp10_collect_flg	= 1;
	var bro3_misc_flg	= 1;
	var bulk_set_flg	= 1;

	if(GM_getValue(BRO3_FAVORITE_TRADE_FLG))	favorite_trade_flg	= GM_getValue(BRO3_FAVORITE_TRADE_FLG);
	if(GM_getValue(BRO3_SHOW_CARD_ID_FLG))	  show_card_id_flg	= GM_getValue(BRO3_SHOW_CARD_ID_FLG);
	if(GM_getValue(BRO3_APPEND_LINK_FLG))	   append_link_flg	 = GM_getValue(BRO3_APPEND_LINK_FLG);
	if(GM_getValue(BRO3_SCORE_VIEW_FLG))		score_view_flg	  = GM_getValue(BRO3_SCORE_VIEW_FLG);
	if(GM_getValue(BRO3_IMMEDIATE_BID_FLG))	 immediate_bid_flg	 = GM_getValue(BRO3_IMMEDIATE_BID_FLG);
	if(GM_getValue(BRO3_TRADING_SUPPORT_FLG))	trading_support_flg = GM_getValue(BRO3_TRADING_SUPPORT_FLG);
	if(GM_getValue(BRO3_ADD_DEL_COMMAND_FLG))	add_del_command_flg = GM_getValue(BRO3_ADD_DEL_COMMAND_FLG);
	if(GM_getValue(BRO3_OVER_MOUSE_FLG))		over_mouse_flg	  = GM_getValue(BRO3_OVER_MOUSE_FLG);
	if(GM_getValue(BRO3_AUTO_DELETE_FLG))	   auto_delete_flg	 = GM_getValue(BRO3_AUTO_DELETE_FLG);
	if(GM_getValue(BRO3_AUTO_DELETE_CNO))	   auto_delete_cno	 = GM_getValue(BRO3_AUTO_DELETE_CNO);
	if(GM_getValue(BRO3_AUTO_BUSHODASU_MODE))	auto_bushodasu_mode = GM_getValue(BRO3_AUTO_BUSHODASU_MODE);
	if(GM_getValue(BRO3_DEL_TRADE_REPORT_FLG))	del_trade_report_flg	= GM_getValue(BRO3_DEL_TRADE_REPORT_FLG);
	if(GM_getValue(BRO3_AUTO_HEAL_FLG))	 auto_heal_flg	   = GM_getValue(BRO3_AUTO_HEAL_FLG);
	if(GM_getValue(BRO3_CARD_COLLECT_FLG))	  card_collect_flg	= GM_getValue(BRO3_CARD_COLLECT_FLG);
	if(GM_getValue(BRO3_10TP_COLLECT_FLG))	  tp10_collect_flg	= GM_getValue(BRO3_10TP_COLLECT_FLG);
	if(GM_getValue(BRO3_MISC_FLG))		  bro3_misc_flg	   = GM_getValue(BRO3_MISC_FLG);
	if(GM_getValue(BRO3_BULK_SET_FLG))	  bulk_set_flg		= GM_getValue(BRO3_BULK_SET_FLG);


	//「トレード」で実行
	if(path.indexOf("/card/trade.php") != -1){
		favorite_trade();
		if(show_card_id_flg == 1)	showCardIdMain();
		if(append_link_flg == 1)	append_hyperlink_to_card_number_trade();
		if(score_view_flg == 1)	 BRO3_SCORE_view();
		if(immediate_bid_flg == 1)	ImmBid();
		if(over_mouse_flg == 1)	 OverMouse();
		if(tp10_collect_flg == 1)	TP10Collect();
	}
	//「一覧」で実行
	if(path.indexOf("card/trade_card_list.php") != -1){
		favorite_trade();
	}
	//「出品中」「入札中」で実行
	if(path.indexOf("/card/exhibit_list.php") != -1 || path.indexOf("/card/bid_list.php") != -1){
		favorite_trade();
		if(show_card_id_flg == 1)	showCardIdMain();
		if(append_link_flg == 1)	append_hyperlink_to_card_number_trade();
		if(over_mouse_flg == 1)	 OverMouse();
		if(bro3_misc_flg == 1)	  bro3_misc();
	}
	//デッキで実行
	if(path.indexOf("/card/deck.php") != -1){
		if(auto_heal_flg > 0)	   AH_STEP1();
		if(append_link_flg == 1)	append_hyperlink_to_card_number_deck();
		if(bulk_set_flg == 1)	   bulk_set();
		display_drop_cards();
	}
	//カード出品画面で実行
	if(path.indexOf("/card/trade_card.php") != -1){
		favorite_trade();
		if(trading_support_flg == 1)	{ TradingSupport();ExhibitSupport(); }
	}
	//ブショーダス結果画面で表示
	if(path.indexOf("/busyodas/busyodas_result.php") != -1){
		if(add_del_command_flg == 1)	AddDelCommand();
		if(trading_support_flg == 1)	{ TradingSupport();ExhibitSupport(); }
		if(auto_delete_flg == 1)	AutoDelete();
	}
	//武将図鑑で表示
	if(path.indexOf("/card/busyobook_picture.php") != -1){
		if(trading_support_flg == 1)	TradingSupport();
	}
	if(path.indexOf("/card/busyobook_card.php") != -1){
		if(trading_support_flg == 1)	TradingSupport();
	}
	if(path.indexOf("/card/busyobook.php") != -1){
		if(card_collect_flg == 1)	CardCollect();
	}
	//書簡で表示
	if(path.indexOf("/message/inbox.php") != -1){
		if(del_trade_report_flg == 1)	DeleteTradeReport();
	}

	// @name		   bro3_favoritetrade
	// @namespace	  http://chaki.s27.xrea.com/br3/
	// @description	ブラウザ三国志 お気に入りトレード一覧表示 by きの。

	function favorite_trade(){
		var l_length = 44;//リスト個数の初期値
		var l_length2 = 30;
		var l_length2 = 100;

		var BRO3_FAV_TRADE_LENGTH	= 'bro3_fav_trade_length' + host;
		var BRO3_AUTO_DELETE_LENGTH = 'bro3_auto_delete_length' + host;
		if(GM_getValue(BRO3_FAV_TRADE_LENGTH)) l_length = GM_getValue(BRO3_FAV_TRADE_LENGTH);
		if(GM_getValue(BRO3_AUTO_DELETE_LENGTH)) l_length2 = GM_getValue(BRO3_AUTO_DELETE_LENGTH);
		var ul = document.getElementsByClassName("ui-tabs-nav").item(0);

		if(favorite_trade_flg == 1 && location.pathname == '/card/trade.php'){
			// お気に入り検索を行う
			jQuery.noConflict();
			j$ = jQuery;

			j$("div[class=left-box]").before(
				"<div id='favoriteSearchProgress' style='float:right; position:relative; top:10px;'>" +
					"<input id='favoriteSearch' type='button' value='設定した条件でお気に入り検索を実施'>" +
				"</div>"
			);
			j$("#favoriteSearch").bind('click', function(){
				seach_trade();
			});
		}

		var li2 = document.createElement("li");
		var set = document.createElement("a");
		set.href = "javascript:void(0)";
		set.id = "setting";
		set.innerHTML = "<span>設定</span>"
		set.addEventListener("click",function(){set_favorite();},false)
		ul.appendChild(li2);
		li2.appendChild(set);

		function set_favorite(){
			if(GM_getValue(BRO3_FAV_TRADE_LENGTH)) l_length = GM_getValue(BRO3_FAV_TRADE_LENGTH);
			if(GM_getValue(BRO3_AUTO_DELETE_LENGTH)) l_length2 = GM_getValue(BRO3_AUTO_DELETE_LENGTH);

			var link = document.evaluate('//li[@class=\"ui-tabs-selected\"]/a',document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(0);
			link.addEventListener("click",function(){location.reload();},false);

			var table = document.getElementsByClassName("ui-tabs-panel").item(0);
			var html = "";

			html += "<table class='tradeTables'><tr><td>"
			html += "<b>Bro3　FavoriteTrade　ver." + version + "</b><br>"
			html += "<b>～使い方～</b><br>"
			html += "<br>"
			html += "　このツールは以下のツールの機能を統合しています。<br>"
			html += "　下記のツールとは競合する可能性がありますので、利用の際にはGreasemonkeyの設定で無効にしてください。<br>"
			html += "　　・bro3_tradecardidview<br>"
			html += "　　・3gokushijpzourijp_cardnolink<br>"
			html += "　　・bro3_score_price<br>"
			html += "　　・bro3_bushodasu_AddDelCommand<br>"
			html += "　　・bro3_Trading_support<br>"
			html += "<br>"
			html += "　このツールを使って意図しない動作をしたとしても、作者は一切責任を負いません。<br>"
			html += "　ご利用は自己責任で♪<br>"
			html += "　<br>"
			html += "　要望・質問などは　skype名=s_hasekun　まで<br>"
			html += "<br></td></tr></table>"


			html += "<table class='tradeTables'><tr><td>"
			html += "<b>利用機能設定</b><br>"
			html += "<br>"
			html += "　<input type=checkbox id=cb_flg1>【トレード】お気に入りトレード一覧表示<br>"
			html += "　<input type=checkbox id=cb_flg2>【トレード】カードID表示<br>"
			html += "　<input type=checkbox id=cb_flg4>【トレード】単位スコア/修行合成獲得経験値表示<br>"
			html += "　<input type=checkbox id=cb_flg8>【トレード】カード画像をマウスオーバー表示<br>"
			html += "　<input type=checkbox id=cb_flg5>【トレード】即落札ボタン追加<br>"
			html += "　<input type=checkbox id=cb_flg14>【トレード】即落札トレード検索<br>"
			html += "　<input type=checkbox id=cb_flg15>【トレード】トレード入札カードリスト<br>　　　※bro3_misc（byいかりや長介さん）に含まれている機能です。<br>　　　　bro3_miscをインストールしている場合はOFFにしてください<br>"
			html += "　<input type=checkbox id=cb_flg3>【トレード/デッキ】トレードリンク追加<br>"
			html += "　<input type=checkbox id=cb_flg6>【トレード/ブショーダス/武将図鑑】トレード価格調査・出品補助<br>"
			html += "　<input type=checkbox id=cb_flg7>【ブショーダス】ブショーダス結果画面に「このカードを破棄」ボタン追加<br>"
			html += "　<input type=checkbox id=cb_flg9>【ブショーダス】ブショーダスライトで特定のカードを自動破棄<br>"
			html += "　　　┃<input type=radio name=bushodasu value=0>破棄リストにないカードを取得したら止める（半自動ブショーダス）<br>"
			html += "　　　┃<input type=radio name=bushodasu value=1>破棄リストにないカードを取得しても引くのを止めない（全自動ブショーダス）<br>"
			html += "　　　┗<input type=radio name=bushodasu value=2>R以上のカードが出たら止める<br>"
			html += "　<input type=checkbox id=cb_flg10>【書簡】未読トレード報告書簡の削除ボタン表示<br>"
			html += "　<input type=checkbox id=cb_flg11>【デッキ】回復スキル自動化ボタン<br>　　　　使用対象：　"
			for (var i=0; i<AH_list.length;i++){
				html += AH_list[i] + ",";
			}
			html += "<br>"
			html += "　<input type=checkbox id=cb_flg16>【デッキ】軍極一括デッキセットボタン<br>"
			html += "　<input type=checkbox id=cb_flg12>【武将図鑑】未取得カード収集ボタン<br>"
			html += "<br>　　　<input type=button id=save_set value=設定を保存 /><br>\n"
			html += "<br></td></tr></table>"

			html += "<table class='tradeTables'><tr><td>"
			html += "<b>自動破棄カードリスト設定</b><br>"
			html += "<br>"
			html += "リスト個数　<input type=text id=num2 size=2 value="+l_length2+" maxlength=3 />個"
			html += "<input type=button id=save_num2 value=変更 />&nbsp;&nbsp;"
			html += "<input type=button id=ad_C value='C全部' />"
			html += "<input type=button id=ad_2 value='2コス以下全部' />"
			html += "<input type=button id=ad_2C value='2コス以下&C全部' />"
			html += "<input type=button id=clear value='入力全消去' /><br>"

			var a_cnt = 0;
			var cno = auto_delete_cno.split(",");
			for(var i=0;i<l_length2;i++){

				html += "<input type='text' name='a"+i+"' id='a"+i+"' class='text' value='";
				if( i < cno.length )	html += cno[i];
				html += "' size=4 maxlength=4 />";
				a_cnt += 1;
				if( a_cnt == 10 ){
					html += "<br />\n";
					a_cnt = 0;
				}

			}

			html += "<br>※ここにカードNoを入力したカードをブショーダスライトで引くと自動的に破棄してもう一枚引きます。<br />\n"
			html += "<center><input type=button id=save_list2 value=リストを保存 /></center>\n"
			html += "</td></tr></table>\n"


			html += "<table class='tradeTables'><tr><td>"
			html += "<b>お気に入りトレード検索条件設定</b><br>"
			html += "<br>"
			html += "リスト個数　<input type=text id=num size=2 value="+l_length+" maxlength=2 />個"
			html += "<input type=button id=save_num value=変更 /><br>\n"
			html += "<input type=button id=init_num value=初期化 />\n"
			html += "<input type=button id=clear_num value=クリア /><br>\n"

			for(var i=0;i<l_length;i++){

				html += "No."+Math.floor(i+1)+"&nbsp;:&nbsp;";
				html += "<img src='/20111003-04/extend_project/w760/img/trade/hd_search.gif' alt='フリーワード検索' title='フリーワード検索' />"
				html += "<select name='t"+i+"' id='t"+i+"' class='combo'><option value='name'>武将名</option><option value='lv'>レベル</option><option value='no'>カードNo</option><option value='skill'>所持スキル</option></select>&nbsp;";
				html += "<input type='text' name='k"+i+"' id='k"+i+"' class='text' value='' size=15 />&nbsp;"
				html += "<input type=checkbox id='c"+i+"1'>TP不足&nbsp;"
				html += "<input type=checkbox id='c"+i+"7'>L&nbsp;"
				html += "<input type=checkbox id='c"+i+"2'>UR&nbsp;"
				html += "<input type=checkbox id='c"+i+"3'>SR&nbsp;"
				html += "<input type=checkbox id='c"+i+"4'>R&nbsp;"
				html += "<input type=checkbox id='c"+i+"5'>UC&nbsp;"
				html += "<input type=checkbox id='c"+i+"6'>C&nbsp;<br>\n"

			}

			html += "<center><input type=button id=save_list value=リストを保存 /></center>\n"
			html += "</td></tr></table>\n"

			table.innerHTML = html;

			var a_mode = document.getElementsByName("bushodasu");
			for ( var i = 0; i < a_mode.length; i++ ){
				if(a_mode[i].value == auto_bushodasu_mode){
					a_mode[i].checked = "checked";
				}
			}

			document.getElementById("ad_C").addEventListener("click",function(){chg_select("C");},false)
			document.getElementById("ad_2").addEventListener("click",function(){chg_select("2");},false)
			document.getElementById("ad_2C").addEventListener("click",function(){chg_select("2C");},false)
			document.getElementById("clear").addEventListener("click",function(){all_clear();},false)

			function chg_select(a){
				if( a == "C"){
					auto_delete_cno = "1013,1018,1020,1024,1026,1028,1030,1032,1034,1040,1058,1059,,,,,,,,,2011,2015,2018,2021,2023,2025,2028,2030,2032,2034,2036,2038,2046,2056,,,,,,,,,,,,,,,,,3012,3016,3018,3020,3022,3024,3026,3028,3030,3039,,,,,,,,,,,4007,4009,4011,4013,4015,4017,4019,4021,4023,,,,,,,,,,,";
				}
				if( a == "2"){
					auto_delete_cno = "1017,1018,1021,1022,1023,1024,1025,1026,1028,1029,1030,1033,1034,1039,1040,1058,1059,,,,2017,2018,2020,2021,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2037,2038,2046,2056,2070,2076,,,,,,,,,,3015,3016,3017,3018,3019,3020,3022,3023,3024,3025,3026,3027,3028,3029,3030,3035,,,,,4008,4009,4010,4011,4012,4013,4014,4015,4016,4017,4018,4019,4022,4023,4038,,";
				}
				if( a == "2C"){
					auto_delete_cno = "1013,1017,1018,1020,1021,1022,1023,1024,1025,1026,1028,1029,1030,1032,1033,1034,1039,1040,1058,1059,2011,2015,2017,2018,2020,2021,2023,2024,2025,2026,2027,2028,2029,2030,2031,2032,2033,2034,2036,2037,2038,2046,2056,2070,2076,,,,,,3012,3015,3016,3017,3018,3019,3020,3022,3023,3024,3025,3026,3027,3028,3029,3030,3035,3039,,,4007,4008,4009,4010,4011,4012,4013,4014,4015,4016,4017,4018,4019,4021,4022,4023,4038";
				}
				var cno = auto_delete_cno.split(",");
				var k = l_length2;
				if( k > 100 ) k = 100
				for(var i=0;i<k;i++){
					if( i < cno.length ){
						document.getElementById("a"+i).value = cno[i] ;
					}
				}
			}
			function all_clear(){
				for(var i=0;i<l_length2;i++){
					document.getElementById("a"+i).value = "" ;
				}
			}

			if( favorite_trade_flg	== 1 ) document.getElementById('cb_flg1').checked = true ;
			if( show_card_id_flg	== 1 ) document.getElementById('cb_flg2').checked = true ;
			if( append_link_flg == 1 ) document.getElementById('cb_flg3').checked = true ;
			if( score_view_flg	== 1 ) document.getElementById('cb_flg4').checked = true ;
			if( immediate_bid_flg	== 1 ) document.getElementById('cb_flg5').checked = true ;
			if( trading_support_flg == 1 ) document.getElementById('cb_flg6').checked = true ;
			if( add_del_command_flg == 1 ) document.getElementById('cb_flg7').checked = true ;
			if( over_mouse_flg	== 1 ) document.getElementById('cb_flg8').checked = true ;
			if( auto_delete_flg == 1 ) document.getElementById('cb_flg9').checked = true ;
			if( del_trade_report_flg== 1 ) document.getElementById('cb_flg10').checked = true ;
			if( auto_heal_flg	>= 1 ) document.getElementById('cb_flg11').checked = true ;
			if( card_collect_flg	== 1 ) document.getElementById('cb_flg12').checked = true ;
			if( tp10_collect_flg	== 1 ) document.getElementById('cb_flg14').checked = true ;
			if( bro3_misc_flg	== 1 ) document.getElementById('cb_flg15').checked = true ;
			if( bulk_set_flg	== 1 ) document.getElementById('cb_flg16').checked = true ;
			document.getElementById("save_set").addEventListener("click",function(){save_setting();},false)

			function save_setting(){
				var t = 1;
				var f = 0;
				if( document.getElementById('cb_flg1').checked == true ){ GM_setValue(BRO3_FAVORITE_TRADE_FLG, "1") }	else { GM_setValue(BRO3_FAVORITE_TRADE_FLG, "0") };
				if( document.getElementById('cb_flg2').checked == true ){ GM_setValue(BRO3_SHOW_CARD_ID_FLG, "1") }  else { GM_setValue(BRO3_SHOW_CARD_ID_FLG, "0") };
				if( document.getElementById('cb_flg3').checked == true ){ GM_setValue(BRO3_APPEND_LINK_FLG, "1") }	 else { GM_setValue(BRO3_APPEND_LINK_FLG, "0") };
				if( document.getElementById('cb_flg4').checked == true ){ GM_setValue(BRO3_SCORE_VIEW_FLG, "1") }		else { GM_setValue(BRO3_SCORE_VIEW_FLG, "0") };
				if( document.getElementById('cb_flg5').checked == true ){ GM_setValue(BRO3_IMMEDIATE_BID_FLG, "1") }	 else { GM_setValue(BRO3_IMMEDIATE_BID_FLG, "0") };
				if( document.getElementById('cb_flg6').checked == true ){ GM_setValue(BRO3_TRADING_SUPPORT_FLG, "1") }	 else { GM_setValue(BRO3_TRADING_SUPPORT_FLG, "0") };
				if( document.getElementById('cb_flg7').checked == true ){ GM_setValue(BRO3_ADD_DEL_COMMAND_FLG, "1") }	 else { GM_setValue(BRO3_ADD_DEL_COMMAND_FLG, "0") };
				if( document.getElementById('cb_flg8').checked == true ){ GM_setValue(BRO3_OVER_MOUSE_FLG, "1") }	else { GM_setValue(BRO3_OVER_MOUSE_FLG, "0") };
				if( document.getElementById('cb_flg9').checked == true ){ GM_setValue(BRO3_AUTO_DELETE_FLG, "1") }	 else { GM_setValue(BRO3_AUTO_DELETE_FLG, "0") };
				if( document.getElementById('cb_flg10').checked == true ){ GM_setValue(BRO3_DEL_TRADE_REPORT_FLG, "1") } else { GM_setValue(BRO3_DEL_TRADE_REPORT_FLG, "0") };
				if( document.getElementById('cb_flg11').checked == true ){ GM_setValue(BRO3_AUTO_HEAL_FLG, "1") }	else { GM_setValue(BRO3_AUTO_HEAL_FLG, "0") };
				if( document.getElementById('cb_flg12').checked == true ){ GM_setValue(BRO3_CARD_COLLECT_FLG, "1") }	 else { GM_setValue(BRO3_CARD_COLLECT_FLG, "0") };
				if( document.getElementById('cb_flg14').checked == true ){ GM_setValue(BRO3_10TP_COLLECT_FLG, "1") }	 else { GM_setValue(BRO3_10TP_COLLECT_FLG, "0") };
				if( document.getElementById('cb_flg15').checked == true ){ GM_setValue(BRO3_MISC_FLG, "1") }		 else { GM_setValue(BRO3_MISC_FLG, "0") };
				if( document.getElementById('cb_flg16').checked == true ){ GM_setValue(BRO3_BULK_SET_FLG, "1") }	 else { GM_setValue(BRO3_BULK_SET_FLG, "0") };
				var a_mode = document.getElementsByName("bushodasu");
				for ( var i = 0; i < a_mode.length ; i++ ){
					if(a_mode[i].checked){
						auto_bushodasu_mode = a_mode[i].value;
						GM_setValue(BRO3_AUTO_BUSHODASU_MODE, auto_bushodasu_mode)
						break;
					}
				}
				alert("保存しました");
			}

			for(var i=0;i<l_length;i++){

				var BRO3_FAV_TRADE_T	=  'bro3_fav_trade_t' + i + host;
				var BRO3_FAV_TRADE_K	=  'bro3_fav_trade_k' + i + host;
				var BRO3_FAV_TRADE_TL	=  'bro3_fav_trade_tl' + i + host;
				var BRO3_FAV_TRADE_L	=  'bro3_fav_trade_l' + i + host;
				var BRO3_FAV_TRADE_UR	=  'bro3_fav_trade_ur' + i + host;
				var BRO3_FAV_TRADE_SR	=  'bro3_fav_trade_sr' + i + host;
				var BRO3_FAV_TRADE_R	=  'bro3_fav_trade_r' + i + host;
				var BRO3_FAV_TRADE_UC	=  'bro3_fav_trade_uc' + i + host;
				var BRO3_FAV_TRADE_C	=  'bro3_fav_trade_c' + i + host;

				var list_t	= "";
				var list_k	= "";
				var list_tl	 = 0;
				var list_l	  = 0;
				var list_ur	 = 0;
				var list_sr	 = 0;
				var list_r	= 0;
				var list_uc	 = 0;
				var list_c	= 0;

				if(GM_getValue(BRO3_FAV_TRADE_T))	list_t	= GM_getValue(BRO3_FAV_TRADE_T);
				if(GM_getValue(BRO3_FAV_TRADE_K))	list_k	= GM_getValue(BRO3_FAV_TRADE_K);
				if(GM_getValue(BRO3_FAV_TRADE_TL))	list_tl = GM_getValue(BRO3_FAV_TRADE_TL);
				if(GM_getValue(BRO3_FAV_TRADE_L))	list_l	= GM_getValue(BRO3_FAV_TRADE_L);
				if(GM_getValue(BRO3_FAV_TRADE_UR))	list_ur = GM_getValue(BRO3_FAV_TRADE_UR);
				if(GM_getValue(BRO3_FAV_TRADE_SR))	list_sr = GM_getValue(BRO3_FAV_TRADE_SR);
				if(GM_getValue(BRO3_FAV_TRADE_R))	list_r	= GM_getValue(BRO3_FAV_TRADE_R);
				if(GM_getValue(BRO3_FAV_TRADE_UC))	list_uc = GM_getValue(BRO3_FAV_TRADE_UC);
				if(GM_getValue(BRO3_FAV_TRADE_C))	list_c	= GM_getValue(BRO3_FAV_TRADE_C);

				if(list_t != ""){
					var sel = document.getElementById("t"+i);
					for(var j=0; j<4; j++){
						if( sel.options[j].value == list_t ) sel.options[j].selected = 1 ;
					}
				}
				document.getElementById("k"+i).value= list_k;
				if(list_tl == 0) document.getElementById("c"+i+"1").checked = true;
				if(list_l == 0)  document.getElementById("c"+i+"7").checked = true;
				if(list_ur == 0) document.getElementById("c"+i+"2").checked = true;
				if(list_sr == 0) document.getElementById("c"+i+"3").checked = true;
				if(list_r == 0)  document.getElementById("c"+i+"4").checked = true;
				if(list_uc == 0) document.getElementById("c"+i+"5").checked = true;
				if(list_c == 0)  document.getElementById("c"+i+"6").checked = true;

			}

			document.getElementById("save_num").addEventListener("click",function(){save_num();set_favorite();},false)
			document.getElementById("init_num").addEventListener("click",function(){init_num();},false)
			document.getElementById("clear_num").addEventListener("click",function(){clear_num();},false)
			document.getElementById("save_list").addEventListener("click",function(){save_list();set_favorite();},false)
			document.getElementById("save_num2").addEventListener("click",function(){save_num();set_favorite();},false)
			document.getElementById("save_list2").addEventListener("click",function(){save_list();set_favorite();},false)

			function save_num(){
				var num = document.getElementById("num").value
				var num2 = document.getElementById("num2").value
				GM_setValue(BRO3_FAV_TRADE_LENGTH, num)
				GM_setValue(BRO3_AUTO_DELETE_LENGTH, num2)
			}

			function init_num() {
				var init_len = trade_search_default.length;
				for(var i=0; i < l_length; i++){
					if( i < init_len ){
						if ( trade_search_default[i][0] != 'name' && trade_search_default[i][0] != 'lv' && trade_search_default[i][0] != 'no' && trade_search_default[i][0] != 'skill'){
							// 変なのいれてたら武将名にする
							document.getElementById("t"+i).value = "name";
						} else {
							document.getElementById("t"+i).value = trade_search_default[i][0];
						}
						document.getElementById("k"+i).value = trade_search_default[i][1];
						document.getElementById("c"+i+"1").checked = trade_search_default[i][2];
						document.getElementById("c"+i+"7").checked = trade_search_default[i][3];
						document.getElementById("c"+i+"2").checked = trade_search_default[i][4];
						document.getElementById("c"+i+"3").checked = trade_search_default[i][5];
						document.getElementById("c"+i+"4").checked = trade_search_default[i][6];
						document.getElementById("c"+i+"5").checked = trade_search_default[i][7];
						document.getElementById("c"+i+"6").checked = trade_search_default[i][8];
					} else {
						document.getElementById("t"+i).value = "name";
						document.getElementById("k"+i).value = "";
						document.getElementById("c"+i+"1").checked = 1;
						document.getElementById("c"+i+"7").checked = 1;
						document.getElementById("c"+i+"2").checked = 1;
						document.getElementById("c"+i+"3").checked = 1;
						document.getElementById("c"+i+"4").checked = 1;
						document.getElementById("c"+i+"5").checked = 1;
						document.getElementById("c"+i+"6").checked = 1;
					}
				}
			}

			function clear_num() {
				for(var i=0; i < l_length; i++){
					document.getElementById("t"+i).value = "name";
					document.getElementById("k"+i).value = "";
					document.getElementById("c"+i+"1").checked = 1;
					document.getElementById("c"+i+"7").checked = 1;
					document.getElementById("c"+i+"2").checked = 1;
					document.getElementById("c"+i+"3").checked = 1;
					document.getElementById("c"+i+"4").checked = 1;
					document.getElementById("c"+i+"5").checked = 1;
					document.getElementById("c"+i+"6").checked = 1;
				}
			}

			function save_list(){
				for(var i=0;i<l_length;i++){
					var sel	 = document.getElementById("t"+i);
					var list_t	= sel.options[sel.selectedIndex].value ;
					var list_k	= document.getElementById("k"+i).value;
					if(document.getElementById("c"+i+"1").checked == true) { var list_tl = 0 } else { var list_tl = 1 };
					if(document.getElementById("c"+i+"7").checked == true) { var list_l = 0 } else { var list_l = 1 };
					if(document.getElementById("c"+i+"2").checked == true) { var list_ur = 0 } else { var list_ur = 1 };
					if(document.getElementById("c"+i+"3").checked == true) { var list_sr = 0 } else { var list_sr = 1 };
					if(document.getElementById("c"+i+"4").checked == true) { var list_r = 0 } else { var list_r = 1 };
					if(document.getElementById("c"+i+"5").checked == true) { var list_uc = 0 } else { var list_uc = 1 };
					if(document.getElementById("c"+i+"6").checked == true) { var list_c = 0 } else { var list_c = 1 };

					//alert("T="+list_t+",K="+list_k+",TL="+list_tl+",UR="+list_ur+",SR="+list_sr+",R="+list_r+",UC="+list_uc+",C="+list_c)

					var BRO3_FAV_TRADE_T	=  'bro3_fav_trade_t' + i + host;
					var BRO3_FAV_TRADE_K	=  'bro3_fav_trade_k' + i + host;
					var BRO3_FAV_TRADE_TL	=  'bro3_fav_trade_tl' + i + host;
					var BRO3_FAV_TRADE_L	=  'bro3_fav_trade_l' + i + host;
					var BRO3_FAV_TRADE_UR	=  'bro3_fav_trade_ur' + i + host;
					var BRO3_FAV_TRADE_SR	=  'bro3_fav_trade_sr' + i + host;
					var BRO3_FAV_TRADE_R	=  'bro3_fav_trade_r' + i + host;
					var BRO3_FAV_TRADE_UC	=  'bro3_fav_trade_uc' + i + host;
					var BRO3_FAV_TRADE_C	=  'bro3_fav_trade_c' + i + host;

					GM_setValue(BRO3_FAV_TRADE_T, list_t);
					GM_setValue(BRO3_FAV_TRADE_K, list_k);
					GM_setValue(BRO3_FAV_TRADE_TL, list_tl);
					GM_setValue(BRO3_FAV_TRADE_L, list_l);
					GM_setValue(BRO3_FAV_TRADE_UR, list_ur);
					GM_setValue(BRO3_FAV_TRADE_SR, list_sr);
					GM_setValue(BRO3_FAV_TRADE_R, list_r);
					GM_setValue(BRO3_FAV_TRADE_UC, list_uc);
					GM_setValue(BRO3_FAV_TRADE_C, list_c);
				}

				auto_delete_cno = "";

				for ( var i = 0; i < l_length2; i++ ){
					auto_delete_cno += document.getElementById("a"+i).value + ",";
				}
				GM_setValue(BRO3_AUTO_DELETE_CNO, auto_delete_cno);
				//alert(auto_delete_cno)
				alert("保存しました");
			}

		}

		// お気に入り検索
		function seach_trade(){
			if(GM_getValue(BRO3_FAV_TRADE_LENGTH)) l_length = GM_getValue(BRO3_FAV_TRADE_LENGTH);

			jQuery.noConflict();
			j$ = jQuery;

			j$("table[class=tradeTables] tr").each(function(index){
				if(index != 0){
					j$(this).remove();
				} else {
					j$("a", this).remove();
					j$("br", this).remove();
					j$("th", this).css("cursor","");
				}
			});
			j$("ul[class=pager]").remove();

			var cnt = 0;
			var searchCount = 0;
			for(var i=0; i <= l_length; i++){
				j$("#favoriteSearchProgress").html("<span>お気に入り検索実施中・・・" + parseInt(i+1) + "/" + parseInt(l_length) + "</span>");

				var BRO3_FAV_TRADE_T	=  'bro3_fav_trade_t' + i + host;
				var BRO3_FAV_TRADE_K	=  'bro3_fav_trade_k' + i + host;
				var BRO3_FAV_TRADE_TL	=  'bro3_fav_trade_tl' + i + host;
				var BRO3_FAV_TRADE_L	=  'bro3_fav_trade_l' + i + host;
				var BRO3_FAV_TRADE_UR	=  'bro3_fav_trade_ur' + i + host;
				var BRO3_FAV_TRADE_SR	=  'bro3_fav_trade_sr' + i + host;
				var BRO3_FAV_TRADE_R	=  'bro3_fav_trade_r' + i + host;
				var BRO3_FAV_TRADE_UC	=  'bro3_fav_trade_uc' + i + host;
				var BRO3_FAV_TRADE_C	=  'bro3_fav_trade_c' + i + host;

				var list_t	= "";
				var list_k	= "";
				var list_tl	 = 1;
				var list_l	 = 1;
				var list_ur	 = 1;
				var list_sr	 = 1;
				var list_r	= 1;
				var list_uc	 = 1;
				var list_c	= 1;

				if(GM_getValue(BRO3_FAV_TRADE_T))	list_t	= GM_getValue(BRO3_FAV_TRADE_T);
				if(GM_getValue(BRO3_FAV_TRADE_K))	list_k	= GM_getValue(BRO3_FAV_TRADE_K);
				if(GM_getValue(BRO3_FAV_TRADE_TL))	list_tl = 1 - GM_getValue(BRO3_FAV_TRADE_TL);
				if(GM_getValue(BRO3_FAV_TRADE_L))	list_l	= 1 - GM_getValue(BRO3_FAV_TRADE_L);
				if(GM_getValue(BRO3_FAV_TRADE_UR))	list_ur = 1 - GM_getValue(BRO3_FAV_TRADE_UR);
				if(GM_getValue(BRO3_FAV_TRADE_SR))	list_sr = 1 - GM_getValue(BRO3_FAV_TRADE_SR);
				if(GM_getValue(BRO3_FAV_TRADE_R))	list_r	= 1 - GM_getValue(BRO3_FAV_TRADE_R);
				if(GM_getValue(BRO3_FAV_TRADE_UC))	list_uc = 1 - GM_getValue(BRO3_FAV_TRADE_UC);
				if(GM_getValue(BRO3_FAV_TRADE_C))	list_c	= 1 - GM_getValue(BRO3_FAV_TRADE_C);

				if(list_k != ""){
					var conditions = "t="+list_t+"&k="+list_k+"&tl="+list_tl+"&r_l="+list_l+"&r_ur="+list_ur+"&r_sr="+list_sr+"&r_r="+list_r+"&r_uc="+list_uc+"&r_c="+list_c+"&lim=0";
					searchCount += searchTradeAndDrawResult(conditions, 1000000);
				}
				cnt += 1;
			}
			if (searchCount == 0) {
				j$("table[class=tradeTables]").append("<tr'><td colspan=12 style='color:red;'><b>指定条件に一致する即時落札可能な武将カードは出品されていません。</td></tr>");
			}
			j$("#favoriteSearchProgress").text("お気に入り検索終了");
		}

	}

	// @name		   bro3_tradecardidview
	// @version		1.00
	// @namespace	  http://twitter.com/utoutouuto
	// @description	ブラウザ三国志：トレード画面でカードＩＤを表示させる

	function showCardIdMain() {
		var $xp = function (xp, dc) { return d.evaluate(xp, dc, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); };

		var IdNodes = $xp('//div[starts-with(@id, "cardWindow_")]', d);

		for (var i = 0, len = IdNodes.snapshotLength; i < len; i++ ) {
			var targetNode = IdNodes.snapshotItem(i);
			var cardId = targetNode.id.match(/[0-9]+/);
			var cardIdEL = d.createElement("div");
				cardIdEL.style.paddingTop = "5px";
				cardIdEL.style.fontSize = "12px";
				cardIdEL.innerHTML = "ID:" + cardId;
			targetNode.parentNode.appendChild(cardIdEL);
		}
	}

	// @name		   3gokushijpzourijp_cardnolink
	// @namespace	  http://3gokushijp.zouri.jp/cardnolink
	// @description	カードNo欄,スキル欄にトレードへのリンクを追加します。Ver0.0.2

	function append_hyperlink_to_card_number_trade(){
		var busho_no_es=$a('//table[@class="tradeTables"]/tbody/tr[position()>1]/td[ position() = 1]');
		for (var i = 0;i < busho_no_es.length;i++) {
			busho_no_es[i].innerHTML=addtradelink4cardnotext(busho_no_es[i].innerHTML);
		}
		var skill_es=$a('//table[@class="tradeTables"]//td[@class="skill"]/div');
		for (var i = 0;i < skill_es.length;i++) {
			skill_es[i].innerHTML=addtradelink4skilltext(skill_es[i].innerHTML);
		}
	}

	function append_hyperlink_to_card_number_deck(){
			var busho_no_es=$a('//table[@class="statusParameter1"]//th[text() = "ID"]/following-sibling::*[1]');
		for (var i = 0;i < busho_no_es.length;i++) {
			busho_no_es[i].innerHTML=addtradelink4cardnotext(busho_no_es[i].innerHTML);
		}
		var skilltext_es=$a('//table[@class="statusParameter2"]//th[contains(text(),"スキル")]/following-sibling::*[1][contains(text(),"LV")]');
		for (var i = 0;i < skilltext_es.length;i++) {
			skilltext_es[i].innerHTML=addtradelink4skilltext(skilltext_es[i].innerHTML);
		}
		//よくわからない空白gifファイルが邪魔なので、その対応
		var spimg_es=$a('//img[@title = "ファイル"]/following::img[@class="aboutdeck" and contains(@src,"img/card/sp.gif")]');
		//alert(spimg_es.length);
		for (var i = 0;i < spimg_es.length;i++) {
			spimg_es[i].width="85";
		}
	}

	function addtradelink4cardnotext(cardnotext){
		if(cardnotext.search('(T)')>=0){
		return cardnotext;
		}
		var t=cardnotext.match(/(\d{5}|\d{4})/);
		if(t==null || t.length<2){
		return cardnotext;
		}
		return cardnotext+'<a href="/card/trade.php?s=price&o=a&t=no&k='+t[1]+'">(T)</a>';
	}
	//リンク無し {スキル名}{LV} テキストを リンク付きにする
	function addtradelink4skilltext(skilltext){
		if(skilltext.search('(T)')>=0){
		return skilltext;
		}
		var t;
		if( skilltext.match(/>/)) {
			t=skilltext.match(/(.*>)(.*)(LV.*)/);
		}else if(skilltext.match(/:/)){
			t=skilltext.match(/(.*:)(.*)(LV.*)/);
		}else{
			t=skilltext.match(/()(.*)(LV.*)/);
		}
		if(t==null || t.length<4){
		return skilltext;
		}
		return t[1]+'<a href="/card/trade.php?s=price&o=a&t=skill&k='+t[2]+'">'+t[2]+'</a>'+t[3]+'<a href="/card/trade.php?s=price&o=a&t=skill&k='+t[2]+t[3]+'">(T)</a>';
	}


	// @name		   bro3_score_price
	// @namespace	  http://359.blog-sim.com/
	// @description	ブラウザ三国志　スコア単価計算　（修行合成対応改造）

	function BRO3_SCORE_view() {
		var area = document.getElementsByClassName("left-box").item(0);
		var dom1 = document.createElement("div")
		dom1.innerHTML = "<table><tr>"
		dom1.innerHTML += "<td><input type=checkbox id=chk1>修行合成表示</td>"
		dom1.innerHTML += "<td>｜<input type=radio name=nation value=gi checked>魏 <input type=radio name=nation value=go>呉 <input type=radio name=nation value=shoku>蜀 <input type=radio name=nation value=hoka>他</td>"
		dom1.innerHTML += "<td>｜<input type=radio name=rarity value=UR checked>UR <input type=radio name=rarity value=SR>SR <input type=radio name=rarity value=R>R <input type=radio name=rarity value=UC>UC <input type=radio name=rarity value=C>C｜</td>"
		dom1.innerHTML += "</tr></table>";
		area.appendChild(dom1)

		var txt = document.getElementsByClassName("tradeTables").item(0).innerHTML;
		var regexp = /経験値\:([0-9]*)[\s\S]*?<td class=\"right\">([0-9]*)<\/td>\r?\n?[\t\s]*?<td class=\"right\"><strong>([0-9,]*?)<\/strong><\/td>/gm;
		var matched = txt.match(regexp);

		if (!matched) {
			var len2 = 0;
		}else{
			var len2 = matched.length;
		}

		var exp = [];
		var score = [];
		var price = [];

		for (var i = 0; i < len2; i++) {
			matched[i].match(regexp);
			exp[i] = parseInt(RegExp.$1);
			score[i] = parseInt(RegExp.$2);
			price[i] = parseInt(RegExp.$3.replace(",", ""));

			document.getElementsByTagName("strong").item(i+1).innerHTML += "<br><small>score</small>\n";
		}

		document.getElementById("chk1").addEventListener("change",function(){SelectView();},false);
		for(var i=0;i<4;i++){
			document.getElementsByName("nation").item(i).addEventListener("change",function(){SelectView();},false);
		}
		for(var i=0;i<5;i++){
			document.getElementsByName("rarity").item(i).addEventListener("change",function(){SelectView();},false);
		}

		function SelectView(){
			if( document.getElementById("chk1").checked == true ) { ViewExp(); }
			else { ViewScore(); }
		}

		function ViewScore(){
			for (var i = 0; i < len2; i++) {
				document.getElementsByTagName("small").item(i).innerHTML = "sc: " + parseInt(score[i] / price[i]) + " /TP";
			}
		}

		function ViewExp(){
			var b_nation = "";
			var nation = document.getElementsByName("nation");
			for(var i=0;i<4;i++){
				if(nation[i].checked) b_nation = nation[i].value;
			}

			var b_rarity = "";
			var rarity = document.getElementsByName("rarity");
			for(var i=0;i<5;i++){
				if(rarity[i].checked) b_rarity = rarity[i].value;
			}

			var point = [];
			var bonus = [];
			var getexp = [];

			for (var i = 0; i < len2; i++) {
				point[i] = 40;
				var k = i*2+1;
				var t_rarity = document.getElementsByClassName("center").item(k).childNodes[0].innerHTML;
				var t_nation = document.evaluate('//td[@class=\"busho\"]//div[contains(@class, "cardStatus_rarerity")]',document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(i).className;
				var t_skill3 = document.evaluate('//td[@class=\"skill\"]/div[3]',document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(i).innerHTML;
				var t_skill2 = document.evaluate('//td[@class=\"skill\"]/div[2]',document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(i).innerHTML;

				if(t_rarity == "UR")		{ point[i] += 40;	bonus[i] = 15000; }
				else if(t_rarity == "SR")	{ point[i] += 30;	bonus[i] = 6000; }
				else if(t_rarity == "R")	{ point[i] += 20;	bonus[i] = 1000; }
				else if(t_rarity == "UC")	{ point[i] += 10;	bonus[i] = 25; }
				else if(t_rarity == "C")	{ point[i] += 5;	bonus[i] = 10; }

				if(b_rarity == t_rarity) { point[i] += 4;}
				if(t_nation.indexOf(b_nation) > 0) { point[i] += 4;}

				if(t_skill2.indexOf("--") == -1){ point[i] += 4;}
				if(t_skill3.indexOf("--") == -1){ point[i] += 6;}

				getexp[i] = parseInt( exp[i] * point[i] / 100 ) + bonus[i];

				document.getElementsByTagName("small").item(i).innerHTML = "+" + getexp[i] + "<br>exp: " + parseInt(getexp[i]/price[i]) + " /TP";
			}
		}

		SelectView();
	}

	// @name		   bro3_bushodasu_AddDelCommand
	// @namespace	  http://chaki.s27.xrea.com/br3/
	// @description	mixi版ブラウザ三国志　ブショーダスに「破棄」メニュー追加

	function AddDelCommand(){

		var hrf = location.href;
		var cord = hrf.replace(/^.*card=(-?[0-9]+)/, "$1");
		var card = RegExp.$1;
		//alert(card);

		var id = document.evaluate("//*[@id='gray02Wrapper']//*[@name='ssid']", document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.value;

		var footBtn = document.getElementsByClassName('center').item(1);
		var nakami = "　<a href=javascript:void(0) id='haki'><img id='image' alt='このカードを破棄' width=184 height=52 class='fade' /></a>";
		var t = document.createElement("span");
		t.innerHTML = nakami;
		footBtn.appendChild(t);
		var link = document.getElementById("haki");
		link.addEventListener("click",function(){if(confirm('このカードを破棄してよろしいですか？\n※破棄すると、BP30を獲得します。')){Del_Card(card,id)};},false)

		var image = document.getElementById("image");
	image.src = "data:image/pjpeg,%FF%D8%FF%E0%00%10JFIF%00%01%01%01%00%60%00%60%00%00%FF%E1%00ZExif%00%00MM%00*%00%00%00%08%00%05%03%01%00%05%00%00%00%01%00%00%00J%03%03%00%01%00%00%00%01%00%00%00%00Q%10%00%01%00%00%00%01%01%00%00%00Q%11%00%04%00%00%00%01%00%00%0B%13Q%12%00%04%00%00%00%01%00%00%0B%13%00%00%00%00%00%01%86%A0%00%00%B1%8F%FF%DB%00C%00%02%01%01%02%01%01%02%02%02%02%02%02%02%02%03%05%03%03%03%03%03%06%04%04%03%05%07%06%07%07%07%06%07%07%08%09%0B%09%08%08%0A%08%07%07%0A%0D%0A%0A%0B%0C%0C%0C%0C%07%09%0E%0F%0D%0C%0E%0B%0C%0C%0C%FF%DB%00C%01%02%02%02%03%03%03%06%03%03%06%0C%08%07%08%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%0C%FF%C0%00%11%08%007%00%B9%03%01%22%00%02%11%01%03%11%01%FF%C4%00%1F%00%00%01%05%01%01%01%01%01%01%00%00%00%00%00%00%00%00%01%02%03%04%05%06%07%08%09%0A%0B%FF%C4%00%B5%10%00%02%01%03%03%02%04%03%05%05%04%04%00%00%01%7D%01%02%03%00%04%11%05%12!1A%06%13Qa%07%22q%142%81%91%A1%08%23B%B1%C1%15R%D1%F0%243br%82%09%0A%16%17%18%19%1A%25%26'()*456789%3ACDEFGHIJSTUVWXYZcdefghijstuvwxyz%83%84%85%86%87%88%89%8A%92%93%94%95%96%97%98%99%9A%A2%A3%A4%A5%A6%A7%A8%A9%AA%B2%B3%B4%B5%B6%B7%B8%B9%BA%C2%C3%C4%C5%C6%C7%C8%C9%CA%D2%D3%D4%D5%D6%D7%D8%D9%DA%E1%E2%E3%E4%E5%E6%E7%E8%E9%EA%F1%F2%F3%F4%F5%F6%F7%F8%F9%FA%FF%C4%00%1F%01%00%03%01%01%01%01%01%01%01%01%01%00%00%00%00%00%00%01%02%03%04%05%06%07%08%09%0A%0B%FF%C4%00%B5%11%00%02%01%02%04%04%03%04%07%05%04%04%00%01%02w%00%01%02%03%11%04%05!1%06%12AQ%07aq%13%222%81%08%14B%91%A1%B1%C1%09%233R%F0%15br%D1%0A%16%244%E1%25%F1%17%18%19%1A%26'()*56789%3ACDEFGHIJSTUVWXYZcdefghijstuvwxyz%82%83%84%85%86%87%88%89%8A%92%93%94%95%96%97%98%99%9A%A2%A3%A4%A5%A6%A7%A8%A9%AA%B2%B3%B4%B5%B6%B7%B8%B9%BA%C2%C3%C4%C5%C6%C7%C8%C9%CA%D2%D3%D4%D5%D6%D7%D8%D9%DA%E2%E3%E4%E5%E6%E7%E8%E9%EA%F2%F3%F4%F5%F6%F7%F8%F9%FA%FF%DA%00%0C%03%01%00%02%11%03%11%00%3F%00%FD%EA%D4%F55%B5V%CB%60%2FR%2B%E5%0F%DA%FB%FE%0A%81%E1%7F%D9%A7_o%0Di%D6%F7%9E1%F1%DC%B1%89%13B%D3%A4U%FB%1A%91%95%92%EEf%F9-%A2%20%82%0Be%DB%23j05%C3%FF%00%C1f%FF%00%E0%A3%AD%FB%10%FC0%8BL%D0o-b%F1%FF%00%8D%E7%93O%D0%C4%E5Z%3B%15A%FB%FB%D7V%E1%84JW%0Ar%19%D9%06%0F%CC%2B%F0%F3P%FD%B3%ED%BE%1Ex%AE%3B%1F%F8H%26M__%BBi%EF%F5%1DH5%C0%BA%9D%DB%F7%97%17%0F%92%CEK%12s%9C%F2q%81_%1F%9Ef%F5%A0%FE%AF%84W%9E%FE%87%EC%1C%0D%C0%B41t%16e%9A%3BRn%D1W%B73%F3%7D%15%F4%D3V%FA%ABk%FA%E1%A7~%DB%3F%1C%FE0%A4%177%9E%3E%D1%3C%03g%E7L%82%C7%C2%FA%247r%600*%AFs~%B3%09%1C)%03)%0Cc%3C%E0t%AC%DF%1C%FE%D0%DF%14%BC%2B~!%B0%F8%D7%F1%1A%5B%EBC%E6%5D%99t%ED%12%EE(I%FB%A9%24md%A0%1E%9F*%ED%23%D8%F0%3E%18%F0G%C6%0B%9B%AF%05%EB%D7z%FF%00%C5%CDZ%D6%C2%C5dX%22%D1%26%8E%C2%D2%F0%86%18%20D%BEi%8C%A6I%20%EE%E3%15%F3%E7%C6%AF%DB%D6%3F%1Fx%FE_%07x%0B_%3E%0C%F8q%60b%8E%EF_q2%1DN%60%7F%7B3I%CB%B9w%60%A39%E1%07%AE%0F%C1%E1e%9Abk%C9%CE%A3%B2%D7F%F4%FC%B5%EC%91%FA%8E%23%872%DC%24%A2%A7N%9CS%D1.H%BB%F5%D5%B5%AA%5D%DD%FC%D9%FB%25%E0%3F%F8%2B%A7%C4%1F%85W%F0%C1%E3%DD%23L%F1%A6%85%18D%9BS%D0%AD%1FM%D5%A1Q%D5%E4%B3vx%A6%E7%A9%85%D0%F5%DB%1Bt%1Ft%FC%17%FD%A3%FC%2F%FBBx%22%CF%C4%DE%0F%D5%ED%B5%8D%0E%F57Gu%13%15%C1%18%DC%8C%84n%8EE%CF%CC%8E%03%03%C1%00%8A%FE~%FF%00gO%8Av%DA%8D%DE%9B%A1%5B%DFj%1E*%BD%91%18K%A9%B5%C1o1%1B%3C%BAm%1BW%A62%03q%92Mo%DBx%D7%C4%3E%0B%F1%87%88-t%7F%15%F8%C7%C1%FA%A0h%DE%ED%7C%3D%E2%0B%BD%25uE%04%ACr%C8%B0%3A%2B%BA%83%B7q%04%E3%15%EAa8%9A%AE%0A~%CE%B3r%8F%9E%EB%FE%07%AE%A7%91%9Bx%5D%85%CC%23%CF%86Q%A5%3E%EB%E1k%CE%3D%1Fn%5B%2F.%AB%FA)%B3%9B%CE%81N%08%E0u95%23%0C%F4%AF%E7%5D%3Fh%FF%00%1D%2B%7C%BF%1A~9%AA%82G%CB%F1%13WQ%F9y%F5%A9%A1%FCe%F8%8D%AF%A4%AF%17%C6%CF%8EQ%C7%18%C0i~%24j%E8%B27%F7%14%F9%FF%00x%FE%9D%2B%DD%FF%00%5E%F0%91%8F%C1%2F%C3%FC%CF%9B%97%81x%F5%EF%7Df%1F%F8%0C%8F%E8Tt%A2%BF%9D%B9%FF%00h%8F%1F%DANc%97%E3_%C7%84%962C%23%7CD%D5%C1%1F%F9%1E%ADh_%1C%BE%22k%B7%AB%0C%3F%1A%BE%3Ad%02Y%9F%E2%3E%AE%11%07l%9F%3E%87%C7x%3B%5D%D3%97%E1%FEa%FF%00%10%2F0J%FF%00Y%87%FE%03%23%FA%1A%A2%BF%9D%EDS%E3%FF%00%C4-%22%F1%A0%9F%E3W%C7uu8%DD%FF%00%0B%17W*%DE%E0%F9%FD(%D3%BE%3F%FCB%D5.R%0B%7F%8D%3F%1D%E4%95%CF%03%FE%166%AE%06%3B%92%7C%FE1B%E3%BC%25%AF%C9%2B%7C%BF%CC%7F%F1%02%B1%F6%BF%D6a%FF%00%80%C8%FE%88h%AF%E7%9F_%F8%DD%F1%13%C3%D7%1Bd%F8%DB%F1%CEDp%0AJ%9F%11%B5vF%F6%FF%00_%D6%A9C%FBF%F8%FAy%02%A7%C6%BF%8E%ECI%DA%02%FCD%D5%C9c%E9%FE%BE%85%C7xK%5E0%95%BE_%E6%0B%C0%AC%7BW%FA%CC%3F%F0%19%1F%D1-%15%FC%F6k%1F%18%FE%23%E8v%D0%CB%3F%C6%AF%8EL%8F%F7%DE%3F%88%FA%BB%08%8F%A3%0F%3F%83Yg%F6%92%F1%DA%E0%9F%8D%9F%1D%D7%DB%FE%16.%AEs%FF%00%91%E9G%8E%F0RWT%E5%F8%7F%991%F0%2F0z%ACL%3F%F0%19%1F%D1)L%9E%ADN%03%03%B9%AF%E7%B2_%8B%FF%00%12%93F%5B%C1%F1%A7%E3%A3%827%18%97%E26%B1%E6%AA%FF%00x%AF%DA%3E%EDe%8F%DAG%C7G%A7%C6%EF%8E%C4z%8F%88%9A%BE%0F%FEG%AA%5Cy%84kHK%F0%FF%001%AF%02%F3%07%FF%0010%FF%00%C0d%7FD%DB%7D%CD(%18%AF%E7%AFM%F8%C3%F1%2BU%D3%9A%EA%2F%8D%3F%1D6%0C%F9h%DF%125%60%F3%E3%AE%D1%E7%F3%8A%CC%FF%00%86%8E%F1%E0%EB%F1%B3%E3%B8%FA%FCE%D5%F3%FF%00%A3%E9%7F%AF%987%A2%84%BF%0F%F3%12%F0%2B%1F%7B%7Df%1F%F8%0C%8F%E8%9Bf%0Er%7F%3A%5E%B5%FC%F4%E8%3F%1A%BE!%EB%EC%FEW%C6%DF%8EQ%C7%18%24%C9'%C4%7D%5DU%8F%F7G%EF%FA%D1%A2~%D7%3F%16%BE%1Ak%CB%7B%A3%FCp%F8%C1g%ABY%12%17%FBS%C4%F3%EBv%DB%BB%06%B7%BDi%60q%D4a%90%9FB%0DTx%F3%06%E5%CB%C9%2F%C3%FC%C4%FC%0B%CC%5D%D4q0%BF%A4%8F%E8Z%8A%FC%F7%FF%00%82%5B%7F%C1a%EE%BFi%CF%19%C7%F0%C7%E2%8F%F6V%97%F1%01%E02h%DA%9E%9E%AD%15%8F%89%91T%97%026-%E4%5C%A8%1B%8C%7B%CA%B8%0EW%EE%E0~%80%E2%7Fo%FB%EC%7F%F15%F58%2C%C2%86.%9F%B5%A2%EE%8F%CAs%FE%1C%C7d%D8%B7%82%C7G%96K_%26%BA4%FA%AF%F8gf%7F1_%F0%5E%AF%8Aw%3F%B5%97%FC%15%83%C5ZLWbM%3F%C1%B7k%E1-8m8%89%A1%2C%D3%82%A3%A9%FBKJ7u%DB%C7N%2B%C9%FC9%FB%24k%DF%1C%B4%5D%5B%C3%96Kaeyd%F1%24%0B%3E%9D%1C%C9r%B9%05%CB%CB%86x%86%CE%01%00rrkG%F6%F3%9E%F7%C2%DF%F0U%1F%8Dmt%869%A2%F8%9F%AC%CF%1E%F1%C8%8E%5B%D9J%1E%7Bmd%20%F7%CDz%9F%87%3Fm%0DK%C3%7F%0C%BF%B1t%3B%1BK%7D%5Ex%1A%19.%8C%01%A6%3E%8C%1B%D7%1C%0A%FC%EF3%C5b!Z%F4%F5w%DF%CF%B9%FDg%90%E5te%94%C2%8C%15%97*O%5B%5DZ%DA%DB%CB%E6%CC%DF%D9o%F6%40%D2%FE%14%7CS%9F%C2%9A%EE%B1k%AB%E9%9A%7D%8B%DC%88-%1D%99!%94%AB%E22q%CE%0A%82Tq%D2%BE%91%FD%9F~%12%7C(%D6%BC5%A8h%1A%D2%DA%E8%AF%A9%22Aqg%A8%5B%C3%25%8D%F2%872%20Et%C2%80%FD%BB%15S_%14%7C%25%FD%AA%BCg%F0%DF%E2%86%AF6%89q%FD%97%A9%DDB%D1%FD%B2%EA%0F8%DC%0D%8C%18)%3Fu%B6%92%3D%3F%1A%ED%FE%1D%FCw%F1'%8C.u%3D%2B%E2O%8A%B4%9B%7F%0Ca%04%3AT%C1%FE%D7%1B%2B%0C0%00%02%AD%DF%E5%3D%0F%E3%5EN%22%96%25%CD%D5%94%B5%B2%DBw%7FC%D6%A9%87%A5*K%0FOHh%97%95%AF%7D%1A%B5%B6%B7%7F%2B%1Fn%F8%E7%C3%9E%11%F8K%A6%5E%DCi%B7vW%B7%D70G%09%7Bo*%2F%B0%A2%E0%00%15%14%02F%00%C9%C9%DA00%2B%E2%BF%8E%9F%10%DFO%F1%16%97%AB%DB%19%DC%19%DFO%95%D8%E0%9D%D8h%C9%FA8%FD%2B%8B%F1o%ED%09%E0%AF%86%5E%24%BC%84x%AEMJ%CA%DEW6%D1a%9E%E9%D3%1C%02%07%00%E4%E3%24%8C%E2%B9%8F%1A%FClO%1F%FC%13%D5%2F%925%89d%BD%85%EC%AD%D5A%956n%3Ed%8D%D0%13%C6%10s%8EOj%E7%A7%96%D5sR%A8%9BOK%BF%3D%0E%9C-L%3D%18%3At%EAs%CE%DF%97%92%D8%EB%AC%BE.h~'%D7%23%97S%96%E7E%8Ay%7F%D3%9E8L%F2%5B%C2%1B%E6%9E8%D5%86%E3%9C%82%A6%BDc%C1%D1%FC%1B%F8%9Fi%A8O%17%C6%7DJ%CBC%F0%E5%B8%9Ey.%B4e%B3%8E%02~%E2%A8%92%5D%F2%BB%11%FC*O%3F%40%DE%05%F0%03%C1%DE%11%F8%CF%FBB%E9%D6%3E%22%D4N%83gu%1E%E0%D0%DD-%AA%DC7%95%BA%20%25%7C%AA%12%C4%03%91%C9%26%AEj%DF%F0O%2F%8D%9E%2C%D5%A1%B2%7F%05A%0D%9Cg%CCi%AD%EF%ED%16%0B%83%C9%F3w%99%009%C9%23%D3%3D%05q%E2%B0%D8U%3Fe%3A%CE%93I%3D%5CR%B3%ED%CC%B5%DB%A3%D3C%D4%96*n%0B%F7%9C%AE%DAm%D7%AD%E4%9D%AD%D7%FE%09%DF%FC'%D7m%3Fh%AB%FDv%E2%0DZ%C3O%F0%F7%84%8E%2F%BCK%A9%B3%C1jaf%D9%19u%1F1%99%88%CA%A0%24%92px%15%E9~(%F8%07%A6%DD%8Bo%0A%F8%2F%E2%86%9B%AA%F8%96%F7I%8B%5E%83G%BE%B0%7D%3D%B5kwB%EA%EB%2B9%1B%8A%8C%88%8E%1B%9Cq%F7%8F%8B%FC%3B%F8w%A6%F8%B7%E0%7F%8A~%0B%EA%9A%FF%00%86%BE%1Ex%9FD%F1%8C%1A%95%EB%EAz%82%247%B6b%01%0B%20%91IY%1E7%25%F6%82O%3Cr%2B%D1%AE%3C)y%F1%03%F6%B1%D2%FE%2F%3C%D6%FE%12%F8%3B%E0%E9!%8FN%D6onV7%D4%A0%B2B%82(cf%F3%18I*%90%06%DECr%09%F9O%9B%8B%5C%B5d%E9%CF%95E6%93I%A7%A2%E5%E9%EF9%B6%EC%A3%D1y%15%3CUd%EF%CDkvJ%CD%FC%D3%7D%EDf%B4VZ%98%7F%0A%F4o%10~%D0%3A%3BZ%E8%F0%D9%CFo%A1%5E%25%95%D5%E5%EE%AB%05%A5%C4r%F0Y%3C%B9%189%402%07%07%18%C5z%2F%C6%0F%D9%3F%C7%1E%13%F8%85%AEh%FF%00%0Fl%A1%D5t%87%F2%E4%B7%92%7Db%D8j3%A7%92%1D%E3T%DC%AF%C3%17%E83%B5A%AF%9E%BE%0E%FC.%B6%FD%A2%BFh%1F%13x%BE%FBN%B6%F0%F7%814mrm%7F%5D%D5%EE%DCD-%91%E6y%96%D9W'%3B%D7%0A%14g%1Cu%3F%7B%D4%3Ffc%E2%DF%8A_%B6%E5%FF%00%C6%FDSC%9A%CB%C0%02mOP%83W%BA%C6%D8%AD%23%B7%96%DA8%C9%CEK%00P%7F%BD%D2%9E6%15)Ns%84%E2%A3%18%5D%C5%AF%B4%EC%D4o%CC%AE%DD%9E%DB.%9A%97_%19Z2r%8D%B4MZ%CD%AB%E8%D2n%EB%5D%1D%AD%DF%AD%D1%E6p%7C%7D%D3%7C9%A7.%8D%A8%CEo%84%CD%9B%92%AD%81b%FE%89%FE%D0%3C7%D2%A7%D6%BE4%D9x%12%CE%2B%8B9%22%BA%BD%BC%8C-%BD%C4d%BC1%260Xg%AC%AD%D4%8F%E1%CF%15%C2%7C9%FD%A0%E3%F8%01%A6%FD%82%F7%E1%EF%C3%9F%15%9DZ%E5%B5%09%2Fu%FD%04_M%10a%B7%CB%8EB%C3(%0A%E7%03%BB%1FZ%EA%7CM%FBl%5DhI%1A'%C1%EF%80%B7%167%00%BD%A4%F0%F8L%85%24%F1%B8fC%B5%C7%A1%19%CD%7B%13%C0%CF%DA%25%0AwO%FB%C9'%F2%E9%E9%D8%E8%A9%8C%9C%5C%97%25%ED%E7%F9%AB%7FOC%D0%FC%24%B2%A7%EC%B9%E2o%1F%5CK%A9_%EA6%9A%C4%3A%7B%D8%A3%07%81%E1%920%EF%23%80%0B%07%1B%81%04%9A%E6uO%8B~%09%D0%BE%19%E9%FA%C6%9D%AA_%EA%5E%25y%11%9E%CEX%80%B5%84%EF%942H%7D%40%10%B8%20%F2%09%18%AB%BF%00%BE-%F8%AF%F6l%FD%83%7Cg%E2m%1A%EDlu%D6%F1%9D%B0m%D1%24%B8W%80e%19_%23%04.1%D6%BC%8B%E3%97%C7%7B%AF%8B%D1i%DE%22_%0Dx%5BN%DB%03%C1%A9%CF%A5Z%1BQ%A81%20%83r%83*%24%5C%1C%3A%A8%CEk%9B%09%83%A9W%11R2W%82%9BI%A7m%92%7C%AD%5Bmti%DC%98bd%E5%255k%3B%F9%A5e%BA%B6%DE%8E%E7%D6%FF%00%00%BE%09%D9x%DF%C2%F7~9%D7%BE%26%F8li%87O%1B~%C7z%D1%BD%B5%E4%A8%A6(.7%C6T*n%C3%A2%8E0k%C8%3E%26%F8%93A%F0V%BB46%9E%25%D1%7CIo%02Gqqq%A34%CF%1A9b%AD%02%97%0A%0F%F7%B3%806%E3%06%BD%5B%F6U%F8%E9%AB%F8%8B%E1.%A1%ABx%5B%C3%1A%CE%93%E1o%04%CFl%20%F0g%87dV%D55%A9%DC%02%F7ws%B2%F9%86%1E%0E%161%F3%60%83%80%A2%BC%B3%F6%EA%F8%A3%E3%BB%1F%11%DE%B5%B7%82%C7%85%FE%1C%EA%3A%AA%5C-%94%FE%1F%8FM%9BWx%CA%BC%8F%3B%01%E6%B6%F6%DCO%23%20%E4%80I%AF%2B%03%1CD%F3%19%D0%ABktW%8A%B6%DAh%B5%95%9D%F4v%F3%D1%91G%15R5e)6%E3%DBM%16%9D-%7B%D9%DFGku%D0%F5o%17%FC3%F0%F6%A3%F1'F%D1%F4%BF%1C%EB%96w%DF%D8%AB%E2%1B%C9%2F%F4%C5H4%DB%0F%B2%99%F6%81%13%163*%85%060%A7%BF'%ADG%FBD%7C.%F0%AF%83%FE%1F%DCx%AF%40%F1%9CZ%A8%87F%D2%F5%0B%ABY%AD%26%8EI%FE%DB%92%B3%C4%CC%15F%F0%B28%88%E5%95P%EE%20%D7%B5%F8%B6%F3%5Cd%D5%7Cf%DAm%AD%DF%F6D7W%BA%0CPZ%2B%BD%DD%B4%9A-%AA%24%11%84%05%E4%0Dy%2C%88%03%12r%07%25q%5E%2B%FF%00%05%1E%9B%C4%83%F6t%BD%BB%B8y%F5H%FCE%ACX%CF%A7%AB%E9Q%C4%DE%0D%B3HD%DFg%99%E2%8Fz%CD%E6L%AB%B5%89%F9W%D4%D7%93%97c*%D7%C5Q%A3%CDet%9E%AB%7B%A6%D7%C3%D1y%ABt%BB%DF%96%962%ABt%E4%A4%DD%96%ABMZz%AF%87%B7%9A%B7%E7%DAx3%F6s%F0_%8B%3C3%A3%DF%C9%E2_%12Ocz%19%EC%F4%98%AF%B4%88%A6%BD%01%19%9A%E1%1B%EDEH%8C%8F%9Fq%DC%08%23%02%B8%EF%DA7%E1%FF%00%84%BE%1E%7C%1A%B1%F1f%9F%E2%FB%CF%12O%3C%A2%CA%12%B3%D9M%12%C8%1B%05ghg'%A6%E2%0An%FE%10q%5E%E5%FB9k%9E(%8F%C1%3E%18%FF%00%84%A7%C5%91%EA%12B.%D2%3B%E6k%8D-%F5%60c%96A%FE%8D%3D%A2%B4%86%25%07%E6F%DB%85%04%83%8A%F0%AF%F8(%F6%A1%E2%8DW%F6l%B66%5E%2C%86_%0C%3A%06%93%EC%F2O%A9%A6%BB%E6%CE%85%3C%CB%B4%B6Hb%08W%20nRFyn%2B%9F.%C5bj%E6%91%C3N~%EF5%AF%D1%AB%BF%2B%EBo%2F%3B-%A6%9E'%10%AB%FB%CE%E9%3D%B4%DB%5D6%F2%5E%7D%DD%B6%F9%1A%1F%DA%CF%C6%5E%0E%F8%9B%E1%7F%12%F8zf%B4o%01%EB%16%FA%AD%9E%20P%EB2L%9F%3B%9E%1B%E78%1Bs%F7I%07%AD%7F%60~%5B%FA%A7%E4%7F%C6%BF%8B%EF%19x%B3U%F1%0E%8B%F6Y-V%11%0C%A8%D7%868%82%19%E4%DE%06_%DF%1D%BB%90M%7Fh%3EY%F5O%CA%BF%A18j%92%84%26%A3%14%B6%EB%EA%7F%3F%F8%E9g%88%C2Mku%3D%D5%BA%C7E%E9%F9%DF%B9%FC%E1%7F%C1%CC%FF%00%B3%25%F7%C1o%DB%EA%E3%E2%24%10%CB%FD%85%F1J%DDX%DC%05%C2%5B%EA%16%AA%B1%3C%7Cp3%1A%C2%E0%F7%2C%DE%86%BE%03%D7%FF%00i%8Dk%C3%D76%A9ega%2C%7Bs%F6%88bfx%8E%3E%60I%18%1E%DE%D5%FDN%7F%C1J%BFa%9F%0D~%DE%1F%B3%FE%BB%E0%AF%10A%10%92%E3u%CE%99%7B%B3t%BAm%EA%AB%F9S%A7%B8%25%81%1D%D4%B2%F7%AF%E6%13%E3%CF%EC%C1%F1%07%F6%18%F8%B5y%E1O%88%1AL%BA%7D%FD%84%8C-.%D1%0BXkP%82v%CD%13t*%40%CE%09%CA%E7%AEA%15%96a%81P%AA%EAIs'v%BE%7F%E5%F9%7C%CFG%82%B8%96X%EC%BA%9E%02%9DOgV%09'%A7%D9VK%EF%5D%7B%AF5w~%CD%D6%9A%B7%C6%3D~f%8F%C4z7%87%EC%25%2C.%AF%EF%99%D9%A3%5Cg%00%20.%06F%3Bd%9A%F6%CF%89%FF%00%B3%0F%85t%8F%0B%CCt%CF%19x%A7%C5%FA%8BD%85%5E%1D6%05%B3%90%90%84%FC%E6Y%5C%8F%99%B2%5Bo*8%19%E3%CA%7C1%17%87%26%8E%1DoIkM%3E%FA%40d%90%CA%01%8E7%1C%93%F2%8C%F5%FF%00g%9A%F5%DF%D9%D7%F6%8B%BC%F1%EE%B5w%17%8E%BE!Z%7D%8E%DA%5D%B1%99m%E5%98L%8B%D0m%3BW%23%03%19%FE%95%F3%D8%9CKW%9D8m%BD%EF%7F%C1j~%97%87%C3T%8F-%3A%F5%1B%BD%F6Z%3F%CF%EE%3Eq%F8%8F%FB'%EA%1F%0D%7C7q%AEj%F6%B3%AC%97%93%ED%D3%ED%C2%22%B8%88%B6%03%C8%00%F9K%1C%E0zv%AD%8F%14%F8%A7I%B2%F0%25%B6%85c%0Cv%F2%C7%0A%861%9C%FE%F0cvO%7C%F1%CDw_%B7W%EDQc%F1SQ%8E%C3D%0E%9At%5B%227%1F%F2%D6%E7o%DD%3BG%DD8%EC2z%D7%B1%7F%C17%7F%E0%81%DF%10%BFo%3F%06%3F%8B%7CC%AE%5E%7C5%F0%CD%ECA%F4i.%B4%A6%B9%BE%D4%09%E4J%23%2F%1E%D8%8A%90C%9C%93%9E%01%CEGf%12%9D%7C%5C%23*%AA%CE%F7H%F2qx%FC%06K)T%9D%A3%16%95%DB%F9%DF%CD%B7%7B%24%AE%FC%AC%9D%BEU%B0%8A%C3%C6%3A%7CW%86%F6%1D%26k%1C%7D%B5%1B%81%B4r%1E0%3A%9C%F1%B7%A7J%CA%D7%BC%7D-%E5%F4%8Bh%D3Ac%86T%85%98%F3%9F%E3%23%A6%EC%F3_%B0%96%3F%F0g%5D%BC%F1)%FF%00%86%84%D4b!%40%23%FE%10%E0~%BF%F2%FDR%9F%F83j%CC%FF%00%CD%C5%EAc%B7%1E%0E%1F%FC%9D%5D%B1%C8%AB%DE%EE-%AE%9Bi%F8%9C%7F%F1%16%F2(AF%15%D2%7Dm%1A%9A%FF%00%E4%9F%F0%E7%E3%FD%95%8D%97%C4%3BT%8Bu%BD%96%B3%02%E1%99%B0%B1%5D%A0%00%12%7D%18%01%CF%AD%1E%26%F1%7C6%DFg%B2%B1%2Bu%0D%8A%AA%3C%F3%A0e%BA%23%FD%93%FC%1C%F4%EF%D4%D7%EC%0F%FCA%BBh%A3%03%F6%89%D4%88%F7%F0h%3F%FB%7DH%DF%F0g%05%A3%F2%DF%B4V%A3%9C%E7%FED%D1%D7%FF%00%03%A9%3C%8F%10%9D%E5%1D%3A%2B%AF%F3%2F%FE%22%E6B%A2%F9k%25'%BB%E5%A9%AF%FEI%FF%00%0E~%3Eh%3A%E4Z%F5%8C%9AM%FD%E4%F6~y_%22%60%C4G%95%CE%D8%E4Q%C1%5EN%18%F2%B9%C0%ABZ%EF%89f%F0%9F%87%7F%B0m5%09%EE%25g%CD%D6%C9O%90%87%FEy%A8%CE%0F%3C%93_%AFI%FF%00%06pZ%A2%E0~%D1Z%97%FE%11%A3%FF%00%93%A9%5B%FE%0C%E0%B5%DB%CF%ED%15%A8%E0%F5%FF%00%8A4%7F%F2u%0F%22%AE%E5%ACt%DE%DAo%F7%84%7C%5D%C8%94%2C%AB%FB%DB_%96%A6%DF%F8%07%E2~%3B%E9%BE4%87XY%2Cux%E2%1Au%C1%CCF(%C2%FD%85%CFFA%FD%D3%FCK%DF%ADj%FD%B9%3E%19i3%40.%AD%B5%2B%CB%96%0Fn%83%12Cl%3F%86c%9E%92%10x%03%D6%BF%5CO%FC%19%BFh%1B%3F%F0%D1Z%91'%9E%7C%1C%3F%F9%3A%9D%FF%00%10qZ%E7%8F%DA'Q%E9%8E%3C%1A%07%FE%DFT%CF%24%AC%DD%B9t%EA%B4%FF%00%3F%F8p%A7%E2%E6D%95%DDu%CD%D1%F2%D4%FF%00%E4%3E%EE%C7%E3%C6%9D%F1OP%8E%D6K%0B%AB%9B%8B%8D%16%EEa5%ED%80%99%96%0B%A9%008%99%D782%80N%1C%8C%F3%D6%B5%B4%B3%A7%F8%05f%D4%E0%BEMF%D2%F16%5BY%60%131%F4%98%1E%06%DF%D6%BF%5C%3F%E2%0D%FBF%CB%1F%DA%2FS%DD%9F%FA%13%87%FF%00'R%8F%F83z%D4%A8%FF%00%8C%8A%D4q%FF%00bh%FF%00%E4%EA%A9d5%DB%E5%8Cm%DDi%AF%E2M%3F%172%18%EB*%C9%BE%8F%96%A6%9F%F9!%F8%EB%A5%7CZ%D74Ms%FBF%C3Q%B8%B2%BC%25%B35%A4%86%DEGS%81%B3*A%D81%C0%ED%81%5D6%A9%E29%FCaqo%E2%0DC%C5%1A%AD%FD%8D%88%C7%91%7Dy%25%CD%C4%12%1E%B0%A6%F2~V%E7%07%D0%F3_%AC%3F%F1%06%E5%98'%FE2%2FR%CF%FD%89%C3%FF%00%93%A9%EB%FF%00%06n%DA%A1%E3%F6%8A%D4y%FF%00%A94%7F%F2uL%F8~%AB%7C%D1%85%9E%DFgn%DB%8E%9F%8B%99%1Aw%A9%5D%3F%FBv%A6%9F%F9!%F8%F7%07%C5%FDkA%D5%EE%AE4%3B%EB%BD%03%ED%0C%9B%05%85%C3%5B%98%D69%04%882%84tuV%1F%ED(%3DEl%D9x%9A%EF%C5%F6%17%F2%C5%E2%7DKH7%EE%B2%EB%B1%3D%EC%9E%5D%F6%D6%0E%B2%95%CF%EF%1C8%07%0D%9EFk%F5%9C%7F%C1%9BVa%8F%FCdV%A7%92%7F%E8N%1F%FC%9DO_%F83v%D06%7F%E1%A2%B5%2C%FF%00%D8%9A%0F%FE%DFUO%87%EA%EF%18Y%F7%F7%7F%CC%98x%B7%916%FD%ADt%D3%FE%EDO%97%D8%3F%23%BCO%FBA%F8%A3V%F1%C4z%D4~%23%D7%A4%D4%EC%E3x%60%BF%B9%BE%96K%B0%1D%0ClK%96%DC7%2B0%C0%3D%18%8E%95%1F%86%BCM%A8x%83%C1%3A%8E%81%0E%BD%A8ipK%1A%CBuh%2F%9E%2B%3DI%10%86%FD%ECa%82%B3%AE%01%1C%1F%BB%9E%B5%FA%E8%BF%F0f%DD%A2%F1%FF%00%0D%15%A9%F1%FF%00Rp%FF%00%E4%EA%E8%3E%1B%7F%C1%9E%DE%09%D2%3CI%1C%9E%2F%F8%D7%E2%CF%11i%09%91%25%9E%9B%A2%C5%A6K!%E3%FEZ%BC%D3%E0%10H%23g%7C%821%CC%BC%82%A4b%94!k%5B%F9z%7C%C5%FF%00%11k%22%D5%CA%B2k%B7-O%92%5E%E6%9EG%E7%0F%FC%13%BB%F6O%D6%BF%E0%A5%FF%00%B6W%85%7C%0D%A4%D8%5D%5Cx'F%BD%83Q%F1v%A8%B1%EC%02%CE%23%99%1AW%03%01%E5%03b%0EN%5B%9E%99%1F%D5~%0F%F7%A4%FC%87%F8W%93~%C8%7F%B1%8F%C3%1F%D8k%E1%BF%FC%22_%0C%BC%2Fa%E1%BD%2F%22%5B%99%23%0D%25%D6%A3%20%FF%00%96%D3%CC%FF%00%3C%AC2pI!w%1Cm%07%15%EB%99%3F%DDo%CCW%D2%E58%18%60%E9%F2%DA%ED%FF%00_%D7%DD%D0%FC%1F%8F%F8%CE%7CA%8D%8DT%AD%08_%96%FB%EBk%BE%B6%D9i~%97%DD%D8%AF%A8i%91%DD%82J)c%DF%1C%FF%00%9E%07%E5%5E%11%FBV~%C3%DE%01%FD%AC%7C%11q%A1x%EF%C3%3AO%88t%D9%5C%C9%1F%DA%A2%06%5Bw%23%1EdN%00h%DCp7)%07%D4%D1Ez%B5)BK%96J%E8%F8%9C.*%B5%09%AA%94d%E3%25%B3N%CC%FC%B8%F8%EF%FF%00%06%A7%E8%8F%A9%DC%DC%FC8%F8%9D%ADx%5E%CERY4%FDR%D1u%18%94%93%C2%2C%81%E3eA%D0e%5C%E0%0C%96%3C%D7%99x_%FE%0DJ%F8%81s~%23%D5%FE0%E8V%B6Hs%E6YiRO3%F6%CE%19%E3%03%3E%C6%8A%2B%CC%96WB%F7W%FE%BDO%B6%C3q%DEs%1A%7C%9E%D2%F6%DBE%A7%DDd%FEi%9Fg~%C4%DF%F0n%0F%C1%AF%D9%C3R%B4%D7u%C4%BC%F8%91%E2%5B%7D%AC%B3%EB%BB%0D%942%0EK%C7l%01Q%C9%24%072c%8Ex%CD~%91%F8%3F%C1%16%BE%1E%B4%8D%22%868%F6%00%00P%068%C7%F2%A2%8A%ED%A1%86%A5O%E0G%CDf%B9%C63%1D%25%2CT%DC%BF%04%BD%12%D1%7C%91%D1%C7%18%89%00%00%00%3D)%D8%1E%94Q%5Dg%86%14%9BG%A0%A2%8AV%40%2FJ%3A%D1E0%13h%3D%85(%18%14Q%40%06(%A2%8A%000%3D%05%18%A2%8AV%40%14QE0%0A0(%A2%8B%00%81%15I%20%00O%24%E3%AD.%07%A0%A2%8A%2C%07%FF%D9";

	}

	function Del_Card(card_id,id) {
		var data = "deck_file=&target_card="+card_id+"&mode=del&p=1&ssid="+id;
		GM_xmlhttpRequest({
			method:"POST",
			url:"http://" + host + "/card/deck.php",
			headers:{"Content-type":"application/x-www-form-urlencoded"},
			data: data,
			onload:function(x){location.href="http://" + host + "/busyodas/busyodas.php";}
		});
	}

	// @name		   bro3_Trading_support
	// @namespace	  3gokushi-elmore
	// @description	bro3_Trading_supportと同機能改造版

	function TradingSupport(){
		jQuery.noConflict();
		j$ = jQuery;

		var cardList;
		if(location.pathname == "/card/trade_card.php") {
			// デッキ表示方式
			var deckType = j$("select[class=sortTotal] option[selected=selected]").eq(0).val();
			if (deckType == 101 || deckType == 102) {
				cardList = j$("div[id=cardFileList] div[class=cardColmn]");
			} else {
				return;
			}
		}else if(location.pathname == "/card/busyobook_card.php") {
			cardList = j$("div[class=busyo-card clearfix] div[class=front]");
		}else if(location.pathname == "/card/busyobook_picture.php") {
			cardList = j$("ul[class=busyo-list clearfix] li[class*=busyo-list-item]");
		}else if(location.pathname == "/busyodas/busyodas_result.php") {
			cardList = j$("div[class=cardWrapper]");
		}else{
			return;
		}

		var tradeUrl = "http://"+host+"/card/trade.php?s=price&o=a&t=no&k=";
		cardList.each(
			function(){
				var cardId = j$("span[class=cardno]", this).text();
				var linkHtml = j$(
					"<div style='text-align:center; position:relative; zIndex=10; background-color:white;'>" +
						"<a href='" + tradeUrl + cardId + "' target='_blank'>トレード画面を表示</a>" +
						"<div id='searchPrice' style='height:23px;'>" +
							"<input type='button' value='即落札価格を検索'>" +
						"</div>" +
					"</div>"
				);
				j$(this).append(linkHtml);
				j$("#searchPrice", this).bind('click',
					function(){
						j$(this).html(
							'<div style="height:23px !important"><b><font color="blue">検索中..</font></b></div>'
						);
						var result = searchImmediateTradeCards("t=no&k=" + cardId, 1000000, 1, "tp");
						if (result == null) {
							j$(this).html(
								'<div style="height:23px !important"><b><font color="red">出品なし</font></b></div>'
							);
						} else if (result.length == 0) {
							j$(this).html(
								'<div style="height:23px !important"><b><font color="red">即落なし</font></b></div>'
							);
						} else {
							j$(this).html(
								'<div style="height:23px !important"><b><font color="blue">' + result[0][1] + '</font></b></div>'
							);
						}
					}
				);
			}
		);
	}

	function ExhibitSupport(){
		var area = "";
		if(path.indexOf("/card/trade_card.php") != -1) area = "cardColmn";
		else if(path.indexOf("/busyodas/busyodas_result.php") != -1) area = "back";
		var cards = document.evaluate('//*[@class=\"'+area+'\"]',document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);

		for (var i = 0; i < cards.snapshotLength; i++){
			var card = cards.snapshotItem(i);
			var target = "";

			var cardid;
			var rarerity;
			if(path.indexOf("/card/trade_card.php") != -1){
				target = document.evaluate('//*[@class=\"control\"]',document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null).snapshotItem(i).innerHTML;
				target.match(/go_exhibit_confirm\(([0-9]*)\,1\)/);
				cardid = parseInt(RegExp.$1);
			}
			else if(path.indexOf("/busyodas/busyodas_result.php") != -1){
				jQuery.noConflict();
				j$ = jQuery;

				j$("div[class=getCardInfoArea] div[id*=cardWindow_]").each(
					function(){
						var cardidInfo = j$(this).attr("id").match(/_(\d+)/);
						cardid = RegExp.$1;
						rarerity = j$("span[class=rarerity] img").attr("src");
					}
				);
			}

			var html = document.createElement("div")
			html.align = "center";
			html.style.position = "relative";
			html.style.zIndex = "10";

			var div01 = document.createElement("div")
			div01.id = "DIV01"+i;
			var child5 = document.createElement("input")
			child5.type = "text";
			child5.size = "10";
			child5.value = default_value;
			child5.id = "TXT"+i;
			child5.style.textAlign = "right";
			div01.appendChild(child5);
			var child6 = document.createElement("input")
			child6.type = "button";
			child6.value = "出品する"
			child6.id = "BT2"+i;
			child6.addEventListener("click",ExhibitCard(cardid,i,-1,"BT2"),false)
			div01.appendChild(child6);
			var child7 = document.createElement("input")
			child7.type = "button";
			child7.value = "手数料"
			child7.id = "BT3"+i;
			child7.addEventListener("click",simu(i),false)
			div01.appendChild(child7);

			// 499TP出品
			var div03 = document.createElement("div")
			div03.id = "DIV03"+i;
			var child62 = document.createElement("input")
			child62.type = "button";
			child62.value = "499TP出品"
			child62.id = "BT2_499"+i;
			child62.addEventListener("click",ExhibitCard(cardid,i,499,"BT2_499"),false)
			div03.appendChild(child62);
			// 999TP出品
			var child61 = document.createElement("input")
			child61.type = "button";
			child61.value = "999TP出品"
			child61.id = "BT2_999"+i;
			child61.addEventListener("click",ExhibitCard(cardid,i,999,"BT2_999"),false)
			div03.appendChild(child61);
			// 4999TP出品
			var child61 = document.createElement("input")
			child61.type = "button";
			child61.value = "4999TP出品"
			child61.id = "BT2_4999"+i;
			child61.addEventListener("click",ExhibitCard(cardid,i,4999,"BT2_4999"),false)
			div03.appendChild(child61);
			var div02 = document.createElement("div")
			div02.id = "DIV02"+i;
			var child8 = document.createElement("input")
			child8.type = "button";
			if(path.indexOf("/busyodas/busyodas_result.php") != -1){
				child8.value = "保護を解除"
				child8.addEventListener("click",Deprotect(cardid,i),false)
			}else{
				child8.value = "出品不可"
			}
			child8.id = "BT2b"+i;
			child8.style.color = "red"
			div02.appendChild(child8);
			html.appendChild(div01);
			html.appendChild(div02);
			html.appendChild(div03);
			card.appendChild(html);

			if(path.indexOf("/card/trade_card.php") != -1 ){
				if(target.indexOf("このカードを出品する") != -1){
					div01.style.display = "block";
					div02.style.display = "none";
					div03.style.display = "block";
				}else{
					div01.style.display = "none";
					div02.style.display = "block";
					div03.style.display = "block";
				}
			}
			else if(path.indexOf("/busyodas/busyodas_result.php") != -1){
				if(rarerity.indexOf("rarerity_c.png") >= 0 || rarerity.indexOf("rarerity_uc.png") >= 0) {
					div01.style.display = "block";
					div02.style.display = "none";
					div03.style.display = "block";
				}else{
					div01.style.display = "none";
					div02.style.display = "block";
					div03.style.display = "none";
				}
			}
		}

		function ExhibitCard(n,i,price,btnid) {
			return function() {
				var txt = document.getElementById("TXT"+i);
				var pricevalue;
				if ( price != -1 ){
					pricevalue = price;
				} else {
					pricevalue = txt.value;
				}
				var bt2 = document.getElementById(btnid+i);
				var ssid = document.evaluate("//*[@id='gray02Wrapper']//*[@name='ssid']", document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
				if(ssid.snapshotLength == 0){
					var ex_dom = document.createElement("div");
					var url = "http://"+host+"/card/deck.php";
					ex_dom.innerHTML = getContentFromURL(url);
					ex_dom.id = "ex_dom";
					ex_dom.style.display = "none";
					document.body.appendChild(ex_dom)

					ssid = document.evaluate("//*[@id='ex_dom']//*[@id='gray02Wrapper']//*[@name='ssid']", document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
				}
				var id = ssid.snapshotItem(0).value;
//				var id = j$.cookie('SSID');
				var data = "exhibit_cid="+n+"&exhibit_price="+pricevalue+"&ssid="+id+"&exhibit_btn=出品する";
				GM_xmlhttpRequest({
					method:"POST",
					url:"http://" + host + "/card/exhibit_confirm.php",
					headers:{"Content-type":"application/x-www-form-urlencoded"},
					data: data,
					onload:function(x){change_mes();}
				});

				function change_mes(){
					var dom = document.createElement("div");
					var url = "http://"+host+"/card/exhibit_list.php";
					dom.innerHTML = getContentFromURL(url);
					if(dom.innerHTML.indexOf("cardWindow_"+n) != -1){
						bt2.value = "出品成功";
						bt2.style.color = "blue";
					}else{
						bt2.value = "出品失敗";
						bt2.style.color = "red";
					}
				}
			}
		}

		function Deprotect(n,i){
			return function() {
				var id = document.evaluate("//*[@id='gray02Wrapper']//*[@name='ssid']", document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.value;
//				var id = j$.cookie('SSID');
				var data = "deck_file=&target_card="+n+"&mode=deprotect&p=1&btn_change_flg=&ssid="+id;
				GM_xmlhttpRequest({
					method:"POST",
					url:"http://" + host + "/card/deck.php",
					headers:{"Content-type":"application/x-www-form-urlencoded"},
					data: data,
					onload:function(x){change_btn();}
				});

				function change_btn(){
					var div01 = document.getElementById("DIV01"+i);
					var div02 = document.getElementById("DIV02"+i);
					var div03 = document.getElementById("DIV03"+i);

					div01.style.display = "block";
					div02.style.display = "none";
					div03.style.display = "block";
				}
			}
		}

		function simu(i){
			return function() {
				var price = document.getElementById('TXT'+i).value;
				var commission = Math.floor(price * 0.1);
				if( price >= 500) commission += Math.floor((price-500) * 0.1);
				if( price >= 1000) commission += Math.floor((price-1000) * 0.1);
				var value = price - commission;
				alert("出品価格："+price+"\n手数料："+commission+"\n受取価格："+value);
			}
		}

	}


	// @name		   ----
	// @namespace	  http://chaki.s27.xrea.com/br3/
	// @description	即落札補助　ｂｙきの。

	function ImmBid(){
		var table = document.evaluate('//*[@class=\"tradeTables\"]//tr',document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		var exhibit_cid = [];
		var exhibit_id = [];
		var address = [];

		for(var i=0; i < table.snapshotLength; i++){
			var td = document.createElement("TD");
			td.innerHTML = "";
			td.className = "buy";
			if(table.snapshotItem(i).innerHTML.indexOf("---") != -1 && table.snapshotItem(i).innerHTML.indexOf("入札") != -1){
				var regexp = /inlineId=cardWindow_([0-9]*)[\s\S]*?trade_bid.php\?id=([0-9]*)(\S*)"\>/
				table.snapshotItem(i).innerHTML.match(regexp);
				exhibit_cid[i] = parseInt(RegExp.$1);
				exhibit_id[i] = parseInt(RegExp.$2);
				address[i] = RegExp.$3.replace(/\&amp;/g, "&");


				var btn = document.createElement("INPUT");
				btn.type = "button";
				btn.value = "落札";
				btn.id = "IB_BT"+i;
				btn.addEventListener("click",ImmBidSend(exhibit_cid[i],exhibit_id[i],address[i],i),false);
				td.appendChild(btn);
			}
			table.snapshotItem(i).appendChild(td);
		}

		function ImmBidSend(cid,id,add,i) {
			return function() {
				var data = "exhibit_cid="+cid+"&exhibit_id="+id+add+"&buy_btn=落札する";
				GM_xmlhttpRequest({
					method:"POST",
					url:"http://" + host + "/card/trade_bid.php",
					headers:{"Content-type":"application/x-www-form-urlencoded"},
					data: data,
					onload:function(x){change_mes();}
				});

				function change_mes(){
					document.getElementById("IB_BT"+i).value = "完了";
					document.getElementById("IB_BT"+i).style.backgroundColor = "blue";
					document.getElementById("IB_BT"+i).style.color = "white";
				}
			}
		}
	}

	// @name		   ----
	// @namespace	  http://chaki.s27.xrea.com/br3/
	// @description	カード画面マウスオーバー表示　ｂｙきの。

	function OverMouse(){
			var dtt = document.getElementsByClassName("thickbox");
			var card_id = [];
			for (var i = 0; i < dtt.length ; i++ ){
				var regexp = /inlineId=cardWindow_([0-9]*)/
				dtt.item(i).href.match(regexp);
				card_id[i] = parseInt(RegExp.$1);

				dtt.item(i).addEventListener("mouseover",popup(card_id[i],i),false);
				dtt.item(i).addEventListener("mouseout",popdown(card_id[i],i),false);
			}
	}

	function popup(cid,i) {
		return function(e) {
			var x, y;
			if(document.all){
				x = document.body.scrollLeft + window.event.clientX;
				y =document.body.scrollTop+window.event.clientY;
			}else if(document.layers || document.getElementById){
				x = e.pageX;
				y = e.pageY;
			}
			var box = document.getElementById("cardWindow_"+cid);
			box.style.display="block";
			box.style.position="fixed";
			box.style.top= parseInt(y - 350) + "px";
			box.style.left= parseInt(x + 70) + "px";
			box.style.zIndex="8100";
		}
	}
	function popdown(cid,i) {
		return function() {
			var box = document.getElementById("cardWindow_"+cid);
			box.style.display="none";
		}
	}


	// @name		   ----
	// @namespace	  http://chaki.s27.xrea.com/br3/
	// @description	ブショーダスライトで特定のカードを自動破棄　ｂｙきの。

	function AutoDelete(){
		var type = document.evaluate('//*[@id=\"gray02Wrapper\"]//h3', document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML;
		if( type.indexOf("ブショーダスライト") != -1 ){
			var cardno = document.getElementsByClassName("cardno").item(0).innerHTML;
			// alert(cardno);
			var bp_btn = document.evaluate('//*[@class=\"first_bpbtn\"]', document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML;
			var regexp = /<span>([0-9]*)<\/span>/
			bp_btn.match(regexp);
			bp = parseInt(RegExp.$1);
			// alert(bp);

			if( auto_delete_cno.indexOf(cardno) != -1 ){
				var hrf = location.href;
				var cord = hrf.replace(/^.*card=(-?[0-9]+)/, "$1");
				var card = RegExp.$1;

				if( bp >= 70 ){
					//破棄してもう一枚
					document.getElementsByName("del_card_id").item(0).value = card ;
					document.getElementsByName("busyodas").item(0).submit();
				}else{
					//ただ破棄
//					var id = j$.cookie('SSID');
					var id = document.evaluate("//*[@id='gray02Wrapper']//*[@name='ssid']", document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.value;
					Del_Card(card,id);

				}
			}else{
				if( auto_bushodasu_mode == "2"){
					var result = document.getElementsByClassName("result").item(0).innerHTML;
					if( result.indexOf("rarerity_uc")!=-1 || result.indexOf("rarerity_c")!=-1 ){
						//破棄せずブショーダス
						NewBushodasu(bp);
					}
				}else if( auto_bushodasu_mode == "1"){
					//破棄せずブショーダス
					NewBushodasu(bp);
				}else{
					var result = document.getElementsByClassName("result").item(0).innerHTML;
					if( result.indexOf("rarerity_uc")!=-1 || result.indexOf("rarerity_c")!=-1 ){
						var card2 = document.evaluate('//*[@class=\"center\"]',document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
						var div = document.createElement("div")
						var child10 = document.createElement("input")
						child10.type = "button";
						child10.value = "このカードを自動破棄リストに追加";
						child10.style.color = "darkred";
						child10.addEventListener("click",function(){addDelList(cardno)},false)
						div.appendChild(child10);
						card2.appendChild(div);
					}
				}

			}

		}
	}

	function NewBushodasu(bp){
		if( bp >= 100 ){
			document.getElementsByName("del_card_id").item(0).value = 0 ;
			document.getElementsByName("busyodas").item(0).submit();
		}else{
			var tID_bd = setTimeout(function(){bd_jump()},1000);
		}
	}
	function bd_jump(){
			location.href = "http://" + host + "/busyodas/busyodas.php";
	}
	function addDelList(n){
		if(window.confirm("カードNo."+n+"を自動破棄リストに追加します")){
			var BRO3_AUTO_DELETE_LENGTH = 'bro3_auto_delete_length' + host;
			var l_length2 = 100;
			if(GM_getValue(BRO3_AUTO_DELETE_LENGTH)) l_length2 = GM_getValue(BRO3_AUTO_DELETE_LENGTH);
			auto_delete_cno += n + ",";
			GM_setValue(BRO3_AUTO_DELETE_CNO, auto_delete_cno);
			GM_setValue(BRO3_AUTO_DELETE_LENGTH, Math.floor(l_length2) + 1 )
		}
	}

	// @name		   ----
	// @namespace	  http://chaki.s27.xrea.com/br3/
	// @description	トレード報告書簡を削除　ｂｙきの。

	function DeleteTradeReport(){
		var area = document.getElementsByName("message_form").item(0);
		var ul = document.createElement("ul");
		ul.innerHTML = "<a href='javascript:void(0)' id='btn1'>「落札しました」書簡を削除</a>｜"
		ul.innerHTML += "<a href='javascript:void(0)' id='btn2'>「落札されました」書簡を削除</a>　"
		ul.innerHTML += "<input type='checkbox' id='chkflg1'>既読書簡も削除<br>"
		ul.innerHTML += "<p id=a1 style='display:none'> 未読運営書簡を削除しています... <span id=a2>0</span> / <span id=a3>0</span> </p>";
		area.appendChild(ul);

		document.getElementById("btn1").addEventListener("click",function(){DelMessage("0");},false)
		document.getElementById("btn2").addEventListener("click",function(){DelMessage("1");},false)
	}

	function DelMessage(x){
		if(x == 0) var title="カードを落札しました";
		if(x == 1) var title="出品したカードが落札されました";
		var sender = '\n<span class="notice">ブラウザ三国志運営チーム</span>\n';

		var s = '//table[@class=\"commonTables\"]//tr[@class=\"unread\"]';
		var s2 = '//table[@class=\"commonTables\"]//tr';
		var t = "";
		var cnt = 0;
		var address = [];
		var id = [];
		var p = document.getElementsByName("p").item(0).value;

		document.getElementById("a1").style.display = "block";

		var table = document.evaluate(s, document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		for( var i = 1; i < table.snapshotLength + 1 ; i++){
			if( i > 1 ) t = "[" + i + "]";
			var title_r = document.evaluate( s + t + "/td[2]",document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML;
			var sender_r = document.evaluate( s + t + "/td[3]",document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML;


			if( title_r.indexOf(title)!=-1 && sender_r == sender ){
				id[cnt] = document.evaluate( s + t + "/td/input",document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.value;
				address[cnt] = document.evaluate( s + t + "/td[2]/a",document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.href;
				cnt += 1;
			}
		}

		document.getElementById("a3").innerHTML = id.length;

		for( var i = 0; i < id.length; i++){
			var dom = document.createElement("div");
			dom.innerHTML = getContentFromURL(address[i]);

			var data = "mode=inbox&p="+p+"&chk[]="+id[i];
			GM_xmlhttpRequest({
				method:"POST",
				url:"http://" + host + "/message/delete.php",
				headers:{"Content-type":"application/x-www-form-urlencoded"},
				data: data,
				onload:function(x){}
			});

			document.getElementById("a2").innerHTML = i+1;
		}

		if( document.getElementById("chkflg1").checked == true ){
			var table2 = document.evaluate(s2, document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
			for( var i = 3; i < table2.snapshotLength + 1 ; i++){
				if( i > 1 ) t = "[" + i + "]";
				var tr2 = document.evaluate( s2 + t ,document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;
				var title_r2 = document.evaluate( s2 + t + "/td[2]",document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML;
				var sender_r2 = document.evaluate( s2 + t + "/td[3]",document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.innerHTML;

				if( tr2.className.indexOf("unread") == -1 && title_r2.indexOf(title)!=-1 && sender_r2 == sender ){
					document.evaluate( s2 + t + "/td/input",document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.checked = true;
				}
			}
			document.getElementById("a1").style.display = "none";
			document.getElementsByName("message").item(0).submit();
		}else{
			document.getElementById("a1").style.display = "none";
			//alert("完了");
			location.reload();
		}
	}



	// @name		   ----
	// @namespace	  http://chaki.s27.xrea.com/br3/
	// @description	自動治癒スキル発動　ｂｙきの。

	function AH_STEP1(){
		jQuery.noConflict();
		j$ = jQuery;

		// デッキ表示方式
		var deckType = j$("select[class=sortTotal] option[selected=selected]").eq(0).val();
		if(deckType == 101 || deckType == 102) {
			return;
		}

		// カードリスト
		j$("#cardFileList div[class=cardStatusDetail label-setting-mode]").each(function(){
			var card = j$("div[id*=cardWindow_]", this).attr("id").match(/cardWindow_(\d+)/);
			var cardNo = RegExp.$1;
			var skillList = [];
			j$("div[id*=cardWindow_] ul[class=back_skill] span", this).each(function(){
				skillList.push(j$(this).text());
			});
			j$("table[class=statusParameter2] tr td", this).each(function(){
				if(j$(this).parent().attr("class") == "used") {
					return;
				}
				// スキル番号
				var colText = j$(this).parent().children("th").text();
				if(!colText.match(/スキル(\d)/)) {
					return;
				}
				var skillNo = RegExp.$1;
				// 内政スキル判定
				if(!skillList[skillNo-1].match(/防:/)){
					return;
				}
				// スキル名
				var value = j$(this).text();
				if(!value.match(/(.*)LV/)) {
					return;
				}
				// 回復系スキルは赤、通常内政スキルは黒
				var obj;
				var id = "skill" + skillNo + "use_" + cardNo;

				var color;
				if( j$.inArray(RegExp.$1, AH_list) != -1) {
					color = "red";
				} else {
					color = "#09C";
				}
				var a = j$('<a id="' + id + '" style="color:' + color + ';" href="#">使用</a>').bind("click", function() {
					var vid = j$("#village_list_" + cardNo + " select[name=selected_village]").val();
					var vname = j$("#village_list_" + cardNo + " select[name=selected_village] option:selected").text();
					if (confirm(vname + "でスキル[" + value + "]を使用します。よろしいですか？")) {
						AH_setDeck(cardNo, skillNo, vid);
					}
				});
				j$(this).parent().children("th").append(a);
			});
		});
	}

	function AH_setDeck(b_id, skillNo, v_id){
		GM_setValue(BRO3_AUTO_HEAL_B_ID, b_id);
		GM_setValue(BRO3_AUTO_HEAL_S_NO, skillNo);
		GM_setValue(BRO3_AUTO_HEAL_V_ID, v_id);

		auto_heal_flg = 3;

		GM_setValue(BRO3_AUTO_HEAL_FLG, auto_heal_flg);

		var deckset = AH_setDeck0(b_id,v_id);
	}

	function AH_setDeck0(n,m){
			var ssid = document.getElementsByName("ssid").item(0).value;
			var data = "mode=set&target_card="+n+"&wild_card_flg=&inc_point=&btn_change_flg=&p=1&l=&ssid="+ssid+"&selected_village["+n+"]="+m;
			GM_xmlhttpRequest({
				method:"POST",
				url:"http://" + host + "/card/deck.php",
				headers:{"Content-type":"application/x-www-form-urlencoded"},
				data: data,
				onload:function(x){
					location.href = "http://"+host+"/village_change.php?village_id="+v_id+"&from=menu&page=/card/domestic_setting.php" ;
				}
			});
			return;
	}

	if(GM_getValue(BRO3_AUTO_HEAL_B_ID))	var b_id	= GM_getValue(BRO3_AUTO_HEAL_B_ID);
	if(GM_getValue(BRO3_AUTO_HEAL_V_ID))	var v_id	= GM_getValue(BRO3_AUTO_HEAL_V_ID);

	if(auto_heal_flg == 2){var tID = setTimeout(function(){AH_STEP2()},500);};
	if(auto_heal_flg == 3){var tID = setTimeout(function(){AH_STEP3()},500);};
	if(auto_heal_flg == 4){var tID = setTimeout(function(){AH_STEP4()},500);};
	if(auto_heal_flg == 5){var tID = setTimeout(function(){AH_STEP5()},500);};
	if(auto_heal_flg == 6){var tID = setTimeout(function(){AH_STEP6()},500);};
	if(auto_heal_flg == 7){var tID = setTimeout(function(){AH_STEP7()},500);};
	if(auto_heal_flg == 8){var tID = setTimeout(function(){AH_STEP8()},500);};
	if(auto_heal_flg > 30){var tID = setTimeout(function(){AH_STEP31()},500);};

	if(auto_heal_flg >= 2 && path.indexOf("/card/")!=-1){
		var prtElm = document.getElementById("gray02Wrapper");
		var chdElm = document.getElementsByTagName("h2").item(0);
		var newElm = document.createElement("div");
		if( auto_heal_flg > 30){
			newElm.innerHTML = "　自動スキル動作中　　STEP " + (auto_heal_flg/10) + " / 8";
		}else{
			newElm.innerHTML = "　自動スキル動作中　　STEP " + auto_heal_flg + " / 8";
		}
		newElm.style.backgroundColor ="red";
		newElm.style.height ="24px";
		newElm.id = "ah_text";
		prtElm.insertBefore(newElm, chdElm);
	}

	if(path.indexOf("/card/domestic_setting.php")!=-1 && document.body.innerHTML.indexOf("設定されている武将を解除する")!=-1){
		var id = document.evaluate('//form[@method="get"]/input[@name="id"]/@value',document, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue.textContent;
		var btn = document.createElement("input");
		btn.value = "設定されている武将をデッキから下ろす";
		btn.type = "button";
		btn.addEventListener("click",function(){AH_STEP9(id)},false);
		document.getElementsByTagName("form").item(2).appendChild(btn);
	}
	function AH_STEP9(b_id){
		if(window.confirm("内政武将をデッキから下ろします。よろしいですか？")){
			GM_setValue(BRO3_AUTO_HEAL_B_ID, b_id);
			AH_STEP5();
		}
	}

	function AH_STEP2(){
		auto_heal_flg = 3;
		GM_setValue(BRO3_AUTO_HEAL_FLG, auto_heal_flg);
		location.href = "http://"+host+"/village_change.php?village_id="+v_id+"&from=menu&page=/card/domestic_setting.php" ;
	}

	function AH_STEP3(){
		if( path.indexOf("domestic_setting.php") != -1){
			if(document.body.innerHTML.indexOf("設定されている武将を解除する")!=-1){
				auto_heal_flg = 8;
				GM_setValue(BRO3_AUTO_HEAL_FLG, auto_heal_flg);
				location.href = "http://"+host+"/card/deck.php";
			}else{
				var chkbox = document.evaluate('//*[@id="card_radio_'+b_id+'"]',document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
				if( chkbox.snapshotLength > 0 ){
					chkbox.snapshotItem(0).checked = true;
					auto_heal_flg = 4;
					GM_setValue(BRO3_AUTO_HEAL_FLG, auto_heal_flg);
					document.getElementsByName("input_domestic").item(0).submit();
				}else{
					auto_heal_flg = 31;
					GM_setValue(BRO3_AUTO_HEAL_FLG, auto_heal_flg);
					var AH_st3t = setTimeout(function(){location.reload()},2000);
				}
			}
		}else{
			location.href = "http://"+host+"/village_change.php?village_id="+v_id+"&from=menu&page=/card/domestic_setting.php" ;
		}
	}

	function AH_STEP31(){
		if( path.indexOf("domestic_setting.php") != -1){
			var chkbox = document.evaluate('//*[@id="card_radio_'+b_id+'"]',document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
			if( chkbox.snapshotLength > 0 ){
				chkbox.snapshotItem(0).checked = true;
				auto_heal_flg = 4;
				GM_setValue(BRO3_AUTO_HEAL_FLG, auto_heal_flg);
				document.getElementsByName("input_domestic").item(0).submit();
			}else if( auto_heal_flg < 36 ){
				auto_heal_flg += 1;
				GM_setValue(BRO3_AUTO_HEAL_FLG, auto_heal_flg);
				var AH_st3t = setTimeout(function(){location.reload()},2000);
			}else{
				auto_heal_flg = 1;
				document.getElementById("ah_text").innerHTML = "　自動スキル：　<b>武将がセットできなかったため動作を停止しました</b>"

				GM_setValue(BRO3_AUTO_HEAL_FLG, auto_heal_flg);
				GM_setValue(BRO3_AUTO_HEAL_B_ID, 0);
				GM_setValue(BRO3_AUTO_HEAL_S_NO, 0);
				GM_setValue(BRO3_AUTO_HEAL_V_ID, 0);
			}
		}else{
			location.href = "http://"+host+"/village_change.php?village_id="+v_id+"&from=menu&page=/card/domestic_setting.php" ;
		}
	}

	function AH_STEP4(){
		var b_tbl = document.evaluate('//*[@class="general"]',document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);

		for(var i = 0; i < b_tbl.snapshotLength; i++){
			if( b_tbl.snapshotItem(i).innerHTML.indexOf("内政中") == -1 ){
				continue;
			}else{
				var s_no = parseInt(GM_getValue(BRO3_AUTO_HEAL_S_NO)) + 3;		// 2014.06.25

				var target = '//*[@class="general"]['+(i+1)+']//td';	// 2014.06.25
				var skl_num = document.evaluate(target,document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
				for(var k = 0; k < AH_list.length; k++){
					if(skl_num.snapshotItem(s_no).innerHTML.indexOf( AH_list[k] ) != -1){
						auto_heal_flg = 5;
						GM_setValue(BRO3_AUTO_HEAL_FLG, auto_heal_flg);
						break;
					}else{
						auto_heal_flg = 1;
					}
				}
				if(auto_heal_flg == 1){
					GM_setValue(BRO3_AUTO_HEAL_FLG, auto_heal_flg);
					GM_setValue(BRO3_AUTO_HEAL_B_ID, 0);
					GM_setValue(BRO3_AUTO_HEAL_S_NO, 0);
					GM_setValue(BRO3_AUTO_HEAL_V_ID, 0);
				}
				location.href = skl_num.snapshotItem(s_no).childNodes.item(0).href;
			}
		}
	}

	function AH_STEP5(){
		auto_heal_flg = 6;
		GM_setValue(BRO3_AUTO_HEAL_FLG, auto_heal_flg);
		document.getElementsByTagName("form").item(2).submit();
	}

	function AH_STEP6(){
		auto_heal_flg = 1;

		var ssid = getSSID();
		var data = "mode=unset&target_card="+b_id+"&wild_card_flg=&inc_point=&btn_change_flg=&l=&ssid="+ssid;
		GM_xmlhttpRequest({
			method:"POST",
			url:"http://" + host + "/card/deck.php",
			headers:{"Content-type":"application/x-www-form-urlencoded"},
			data: data,
			onload:function(x){

				// 2014.06.25 追加
				GM_setValue(BRO3_AUTO_HEAL_FLG, auto_heal_flg);
				GM_setValue(BRO3_AUTO_HEAL_B_ID, 0);
				GM_setValue(BRO3_AUTO_HEAL_S_NO, 0);
				GM_setValue(BRO3_AUTO_HEAL_V_ID, 0);

				location.href = "http://"+host+"/card/deck.php";
			}

		});
	}

	function AH_STEP7(){
		auto_heal_flg = 1;

		GM_setValue(BRO3_AUTO_HEAL_FLG, auto_heal_flg);
		GM_setValue(BRO3_AUTO_HEAL_B_ID, 0);
		GM_setValue(BRO3_AUTO_HEAL_S_NO, 0);
		GM_setValue(BRO3_AUTO_HEAL_V_ID, 0);

		document.getElementById("target_card").value = b_id;
		document.getElementById("mode").value='unset';
		document.getElementById("deck_file").submit();
	}

	function AH_STEP8(){
		auto_heal_flg = 1;
		document.getElementById("ah_text").innerHTML = "　自動スキル：　<b>内政武将がセットされていたため動作を停止しました</b>"

		GM_setValue(BRO3_AUTO_HEAL_FLG, auto_heal_flg);
		GM_setValue(BRO3_AUTO_HEAL_B_ID, 0);
		GM_setValue(BRO3_AUTO_HEAL_S_NO, 0);
		GM_setValue(BRO3_AUTO_HEAL_V_ID, 0);
	}

	function getSSID(){
		jQuery.noConflict();
		j$ = jQuery;
		var ssid = j$("input[name=ssid]").eq(0).attr("value");
		return ssid;
	}

	//AUTO_HEALここまで//


	// @name		   ----
	// @namespace	  http://chaki.s27.xrea.com/br3/
	// @description	未取得カード自動収集　ｂｙきの。

	function CardCollect(){
		jQuery.noConflict();
		j$ = jQuery;

		var doc = j$("div[class=progress-bars]").before(
			"<div style='border: 4px double black;'>" +
				"<span id='searchCheckBoxes' style='vertical-align:bottom; margin-left:8px;'>" +
					"<b>" +
					"<input type='checkbox' id='searchL'>L&nbsp;" +
					"<input type='checkbox' id='searchUR'>UR&nbsp;" +
					"<input type='checkbox' id='searchSR'>SR&nbsp;" +
					"<input type='checkbox' id='searchR'>R&nbsp;" +
					"<input type='checkbox' id='searchUC'>UC&nbsp;" +
					"<input type='checkbox' id='searchC'>C&nbsp;" +
					"</b><br>" +
				"</span>" +
				"<div id='search'><input type='button' id='collectList' style='margin-left:8px;' value='未収集カードの最低落札価格を検索'></div>" +
			"</div>" +
			"<table id='result'></table>"
		);
		j$("#collectList").bind('click',
			function(){
				searchUnCollectCards();
			}
		);
	}

	// 武将図鑑の未取得カードを検索
	function searchUnCollectCards(){
		var filters = [];
		if (j$("#searchL:checked").val() == "on") {
			filters.push(["L", "green", 0]);
		}
		if (j$("#searchUR:checked").val() == "on") {
			filters.push(["UR", "pink", 1]);
		}
		if (j$("#searchSR:checked").val() == "on") {
			filters.push(["SR", "red", 2]);
		}
		if (j$("#searchR:checked").val() == "on") {
			filters.push(["R", "blue", 3]);
		}
		if (j$("#searchUC:checked").val() == "on") {
			filters.push(["UC", "orange", 4]);
		}
		if (j$("#searchC:checked").val() == "on") {
			filters.push(["C", "black", 5]);
		}
		if (filters.length == 0) {
			alert("検索対象が指定されていません。");
		}

		j$("#searchCheckBoxes").css('display', 'none');
		j$("#search").html("<span style='margin-left:8px;'><b>カード検索準備中...</b></span>");

		// 所持TPを手に入れる
		var tpInfo = j$("#status_point").html().match(/>&nbsp;\d+&nbsp;\n.*>&nbsp;(\d+)&nbsp;/);
		var hasTp = RegExp.$1;

		// 指定された未収集カードを検索する
		var tradeUrl = "http://" + location.hostname + "/card/trade.php?s=price&o=a&t=no&k=";
		var targetUrl = "http://" + location.hostname + "/card/busyobook_picture.php?";
		for(var i = 0; i < filters.length; i++) {
			// 1ページ目を取得
			var firstPage = j$("<dim>").html(loadRequestPage(targetUrl + "filter=" + filters[i][2] + "&status=2", ""));

			// 最大ページ番号を取得
			var maxPageNo = 1;
			j$("div[id=busyobook-scroll] div[class=busyo-ezu] ul[class=pager] li", firstPage).each(
				function(){
					var title;
					if(j$("a", this).length > 0) {
						title = j$("a", this).attr("title");
					} else {
						title = j$(this).text();
					}
					if(title != "" && parseInt(title) > 0) {
						maxPageNo = parseInt(title);
					}
				}
			);

			// カードを検索
			for(j = 1; j <= maxPageNo; j++) {
				var page = j$("<dim>").html(loadRequestPage(targetUrl + "filter=" + filters[i][2] + "&status=2&p=" + j, ""));
				var cards = j$("ul[class=busyo-list clearfix] li[class*=busyo-list-item]", page);
				var count = 0;
				j$(cards).each(
					function(){
						j$("#search").html(
							"<b><span style='margin-left:8px; color:" + filters[i][1] + ";'>" + filters[i][0] + "カード " + j + "/" + maxPageNo + " ページ落札額検索中..." + count + "/" + cards.length + "</span></b>"
						);
						var countryInfo = j$("div[class*=omote_4sk cardStatus_rarerity_]", this).attr("class").match(/rarerity_(.*)_/);
						var country = countryInfo[1];
						var ccolor = "black";
						if (country == 'shoku') {
							ccolor = "green";
						} else if (country == 'gi') {
							ccolor = "blue";
						} else if (country == 'go') {
							ccolor = "red";
						} else if (country == 'ha') {
							ccolor = "orange";
						}
						var rarerity = j$("span[class=rarerity] img", this).attr("title");
						var name = j$("span[class=name]", this).text();
						var cardId = j$("span[class=cardno]", this).text();
						var cost = j$("span[class=cost]", this).text();
						var result = searchImmediateTradeCards("t=no&k=" + cardId, 1000000, 1, "tp");
						var tpText;
						var color;
						var buyEnabled = false;
						var buyButton = "<td></td>";
						if (result == null) {
							tpText = "出品なし";
						}else if(result.length == 0) {
							tpText = "即落なし";
						}else{
							if (parseInt(hasTp) > parseInt(result[0][2])) {
								color = "blue";
								buyButton = "<td id='buyCell_" + result[0][0] + "'>&nbsp;<input id='buy_" + result[0][0] + "' type='button' value='落札'></td>";
								buyEnabled = true;
							} else {
								color = "red";
								buyButton = "<td>&nbsp;<b><span style='color:red;'>TPが足りません</span></b></td>";
							}
							tpText = result[0][1];
						}
						j$("#result").append(
							"<tr style='height:23px;'>" +
								"<td><a href='" + tradeUrl + cardId + "'>" + cardId + "</td>" +
								"<td style='color:" + filters[i][1] + ";'>&nbsp;<b>" + rarerity + "</b></td>" +
								"<td>&nbsp;<b style='color:" + ccolor + ";'>" + name + "</b></td>" +
								"<td>&nbsp;<b>" + cost + "</b></td>" +
								"<td style='color:" + color + "; text-align:right;'>&nbsp;<b>" + tpText + "</b></td>" +
								buyButton +
							"</tr>"
						);

						// 落札ボタンにイベントをつける
						if( buyEnabled == true ){
							j$("#buy_" + result[0][0]).bind('click', result[0], function(v){
								// カードを購入する(#1=カード連番、#2=トレード番号)
								buyCard(v.data[0], v.data[3]);
								j$("#buyCell_" + v.data[0]).html("<b><span style='color:blue; margin-left:8px;'>完了</span></b>");
							});
						}

						count = count + 1;
					}
				);
			}
		}
		j$("#search").html("<span style='margin-left:8px; color:black;'><b>検索終了</b></span>");
	}
	//CARD COLLECTここまで//

	// @name		   ----
	// @namespace	  http://chaki.s27.xrea.com/br3/
	// @description	即落札カードリスト　ｂｙきの。
	function TP10Collect(){
		jQuery.noConflict();
		j$ = jQuery;

		j$("div[class=left-box]").append(
			"<div id='searchBox'>" +
				"<b>即落札検索(Max20件)：</b>" +
				"<input id='searchL' type='button' value='Ｌ' style='font-size:11px; font-weight:bold; color:green;'>" +
				"<input id='searchUR' type='button' value='ＵＲ' style='font-size:11px; font-weight:bold; color:violet;'>" +
				"<input id='searchSR' type='button' value='ＳＲ' style='font-size:11px; font-weight:bold; color:red;'>" +
				"<input id='searchR' type='button' value='Ｒ' style='font-size:11px; font-weight:bold; color:blue;'>" +
				"<input id='searchUC' type='button' value='ＵＣ' style='font-size:11px; font-weight:bold; color:orange;'>" +
				"<input id='searchC' type='button' value='Ｃ' style='font-size:11px; font-weight:bold; color:black;'>" +
				"<input id='searchANY' type='button' value='指定条件' style='font-size:11px; font-weight:bold; color:black;'>" +
				"<input id='tp10only' type='checkbox' style='margin-left:4px; position:relative;top:2px;'><label for='tp10only'>10TPのみを検索</label></input>" +
			"</div>"
		);

		j$("#searchL").bind('click',function(){
			searchTrade("tl=0&r_l=1&r_ur=0&r_sr=0&r_r=0&r_uc=0&r_c=0&r_pr=&r_hr=&r_lr=&lim=0");
		});
		j$("#searchUR").bind('click',function(){
			searchTrade("tl=0&r_l=0&r_ur=1&r_sr=0&r_r=0&r_uc=0&r_c=0&r_pr=&r_hr=&r_lr=&lim=0");
		});
		j$("#searchSR").bind('click',function(){
			searchTrade("tl=0&r_l=0&r_ur=0&r_sr=1&r_r=0&r_uc=0&r_c=0&r_pr=&r_hr=&r_lr=&lim=0");
		});
		j$("#searchR").bind('click',function(){
			searchTrade("tl=0&r_l=0&r_ur=0&r_sr=0&r_r=1&r_uc=0&r_c=0&r_pr=&r_hr=&r_lr=&lim=0");
		});
		j$("#searchUC").bind('click',function(){
			searchTrade("tl=0&r_l=0&r_ur=0&r_sr=0&r_r=0&r_uc=1&r_c=0&r_pr=&r_hr=&r_lr=&lim=0");
		});
		j$("#searchC").bind('click',function(){
			searchTrade("tl=0&r_l=0&r_ur=0&r_sr=0&r_r=0&r_uc=0&r_c=1&r_pr=&r_hr=&r_lr=&lim=0");
		});
		j$("#searchANY").bind('click',function(){
			var conditions =
				"&t=" + j$("#t").val() +
				"&k=" + j$("#k").val() +
				"&tl=" + j$("#tl").val() +
				"&r_l=" + j$("#r_l").val() +
				"&r_ur=" + j$("#r_ur").val() +
				"&r_sr=" + j$("#r_sr").val() +
				"&r_r=" + j$("#r_r").val() +
				"&r_uc=" + j$("#r_uc").val() +
				"&r_c=" + j$("#r_c").val() +
				"&r_hr=" + j$("#r_hr").val() +
				"&r_lr=" + j$("#r_lr").val() +
				"&lim=" + j$("#lim").val();
			searchTrade(conditions);
		});
	}

	// トレード検索し、結果を表示
	function searchTrade(conditions) {
		j$("table[class=tradeTables] tr").each(function(index){
			if(index != 0){
				j$(this).remove();
			} else {
				j$("a", this).remove();
				j$("br", this).remove();
				j$("th", this).css("cursor","");
			}
		});
		j$("ul[class=pager]").remove();

		var tp10onlyFlag = j$("#tp10only:checked").val();
		if (tp10onlyFlag == "on") {
			limitTp = 10;
		} else {
			limitTp = 1000000;
		}

		var count = searchTradeAndDrawResult(conditions, limitTp);
		if( count == 0){
			j$("table[class=tradeTables]").append("<tr'><td colspan=12 style='color:red;'><b>指定条件に一致する即時落札可能な武将カードは出品されていません。</td></tr>");
		} else {
			addStyle('@import "/20141224-01/extend_project/w945/css/popup.css";');
		}
	}

	// トレードを指定条件で検索し、トレード検索結果ページに結果を描画する
	// 戻り値として、ヒット件数を返す（通常検索と、お気に入り検索で使用）
	function searchTradeAndDrawResult(conditions, limitTp) {
		var searchResult = searchImmediateTradeCards(conditions, limitTp, 20, "html");
		if (searchResult == null || searchResult.length == 0) {
			return 0;
		}
		for(var i = 0; i < searchResult.length; i++) {
			var obj = j$("<div>").append(searchResult[i][1]);
			// 落札ボタンありのときは追加
			if (immediate_bid_flg == 1) {
				var buyButton = "";
				var buyEnabled = false;
				if (parseInt(searchResult[i][3]) > 0) {
					buyButton = "<span id='buyCell_" + searchResult[i][0] + "'><input id='buy_" + searchResult[i][0] + "' type='button' value='落札'></span>";
					buyEnabled = true;
				}
				j$("tr", obj).append("<td>" + buyButton + "</td>");
			}
			j$("table[class=tradeTables]").append(obj.html());
			if (buyEnabled == true) {
				j$("#buy_" + searchResult[i][0]).bind('click', searchResult[i], function(v){
					// カードを購入する(#1=カード連番、#2=トレード番号)
					buyCard(v.data[0], v.data[3]);
					j$("#buyCell_" + v.data[0]).html("<b><span style='color:blue; margin-left:8px;'>完了</span></b>");
				});
			}
		}

		return searchResult.length;
	}


	// ==UserScript==
	// @name		   bro3_misc
	// @namespace	  Miscellaneous Tool
	// @description	トレードカードリスト by いかりや長介@一決
	function bro3_misc(){

		if(location.pathname=="/card/exhibit_list.php"){
			var m="";
			if (document.getElementsByClassName("trade_commission_info").item(0) == null) {
				return;
			}
			var s = document.getElementsByClassName("trade_commission_info").item(0);
			var t = document.createElement("div");
			t.id = "trade_direct_link";
			t.style.marginTop = "10px";
			t.style.marginBottom = "5px";
			t.style.fontSize = "12px";
			t.innerHTML = "出品中カードへのダイレクトリンク<br><textarea id=direct_link_lists rows=11 cols=93></textarea>";
			s.parentNode.insertBefore(t, s);

			var target = "//*[@id='gray02Wrapper']//*[@class='trade']/a/@href";
			var link = document.evaluate(target, document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
			for (var i = 0; i< link.snapshotLength; i++){
				link.snapshotItem(i).textContent.match(/del_id=(\d+)/);
				m += "http://"+host+"/card/trade_bid.php?id=" + RegExp.$1 + "\n";
			}
			document.getElementById("direct_link_lists").value = m;
		}
		if(location.pathname=="/card/bid_list.php"){
			var m="";
			j$("div[class=ui-tabs-panel]").append("<div id=direct_trade>");
			j$("#direct_trade").css({"margin-top":"10px","margin-bottom":"5px","font-size":"12pt"});
			j$("#direct_trade").append("リスト一括入札 <span id=notice_msg></span>");
			j$("#direct_trade").append("<textarea id=direct_link_lists rows=11 cols=93>");
			j$("#direct_trade").append("<div id=control_area><input type=button id=auto_bid value=自動入札></div>");
			j$("#control_area").css({"text-align":"right"});
			j$("#auto_bid").bind('click',function(){
				var a=j$("#direct_link_lists").val().split("\n");
				j$("#auto_bid").attr("disabled","disabled");
				AutoBid(a)
			})
		}
	}

	function AutoBid(b){
		if(b.length==0){
			j$("#direct_link_lists").val("");
			j$("#auto_bid").removeAttr("disabled");
			return
		}
		var c=b[0].trim();
		var d=new RegExp("http:\\/\\/"+host+"\\/card\\/trade_bid.php\\?id=\\d+");
		b.shift();
		if(c.match(d)){
			j$(document.body).append("<div id=AjaxTempDOM>");
			j$("#AjaxTempDOM").hide();
			j$("#AjaxTempDOM").load(c+" #gray02Wrapper",function(){
				var a={};
				if(j$("input[name=exhibit_cid]").length!=0){
					a['t']=j$("input[name=t]").val();
					a['k']=j$("input[name=k]").val();
					a['p']=j$("input[name=p]").val();
					a['s']=j$("input[name=s]").val();
					a['o']=j$("input[name=o]").val();
					a['exhibit_cid']=j$("input[name=exhibit_cid]").val();
					a['exhibit_id']=j$("input[name=exhibit_id]").val();
					a['buy_btn']="落札する"
				}else{
					a['ssid']=j$("input[name=ssid]").val();
					a['t']=j$("input[name=t]").val();
					a['k']=j$("input[name=k]").val();
					a['p']=j$("input[name=p]").val();
					a['s']=j$("input[name=s]").val();
					a['o']=j$("input[name=o]").val();
					a['exhibit_price']=j$("input[name=exhibit_price]").val();
					a['exhibit_id']=j$("input[name=exhibit_id]").val();
					a['bid_btn']="入札する"
				}
				j$("#notice_msg").text("(トレードID "+j$("input[name=exhibit_id]").val()+" を入札中)");
				j$.post("http://"+host+"/card/trade_bid.php",a,function(){setTimeout(function(){AutoBid(b)},500)})
			})
		}else{
			j$("#notice_msg").text("(有効なトレードリンクではありませんでした)");
			setTimeout(function(){AutoBid(b)},500)
		}
	}

	// @name		   ----
	// @namespace	  http://chaki.s27.xrea.com/br3/
	// @description	軍極セット　ｂｙきの。

	function bulk_set(){
		jQuery.noConflict();
		j$ = jQuery;

		// デッキ表示方式
		var deckType = j$("select[class=sortTotal] option[selected=selected]").eq(0).val();

		// 現在の拠点の取得
		var currentVillageName = j$("div[class=sideBoxInner basename] li[class=on] span").eq(0).text();

		var selectBox = j$("div[class=attention_detail] select[id=deck_add_selected_village]");
		if (selectBox.length == 0) {
			return;
		}
		var selectedValue = 0;
		j$("option", selectBox).each(function(){
			if(j$(this).text() == currentVillageName) {
				selectedValue = j$(this).val();
			}
		});
		var selectBoxHtml = j$("<div>").append(selectBox.clone()).html();

		// 一括セットコントロールを作る
		var block = j$("<div>").css({"text-align":"left", "background-color":"#C8C8FF"});
		j$(block).append('<span>一括デッキセット：　</span>' +
					'<select id="B_set_type">' +
						'<option value=1>連環セット\n' +
						'<option value=2>蜀軍セット\n' +
						'<option value=3>魏軍セット\n' +
						'<option value=4>呉軍セット\n' +
						'<option value=5>群雄セット\n' +
						'<option value=6>低コストセット\n' +
						'<option value=7>リスト表示\n' +
					'</select>\n' +
					'<span id="bulkSetVillage">セット先：' + selectBoxHtml + '</span>&nbsp;' +
					'<input id="group_deck_set" type="button" value="セット">'
		);

		// 画面描画
		j$("div[class=sortSystem]").append(block);
		j$("div[class=sortSystem]").append('<div id="B_set_textarea"></div>')

		j$("#group_deck_set").bind('click',
			function(){
				file_set(deckType);
			}
		);
	}

	// デッキから一括で落とす設定を分離
	function display_drop_cards(){
		jQuery.noConflict();
		j$ = jQuery;

		// デッキの待機武将をすべてファイルに下げる
		j$("div[id=deck-head]").append(
			"<span id='dropCardInfo'><input id='dropCards' type='button' value='デッキで待機中の武将をすべてファイルに戻す' style='position:relative; top: -4px;'></span>"
		);
		j$("div[id=deck-head] img").css({"position":"relative", "top":"7px"});
		j$("#dropCards").bind('click', function(){
			file_unset();
		});
	}

	function file_set(deckType){
		var tbl = j$('<table id="B_set_tbl" border="1" bgcolor="#FFFFFF">').css(
			{"border-collapse":"separate;"}
		);
		tbl.append(
			"<tr id='B_set_tbl_head'>" +
				"<th style='text-align:center !important;'>No.</th>" +
				"<th style='text-align:center !important;'>レア</th>" +
				"<th style='text-align:center !important;'>武将名</th>" +
				"<th style='text-align:center !important;'>Lv</th>" +
				"<th style='text-align:center !important;'>勢力</th>" +
				"<th style='text-align:center !important;'>コスト</th>" +
				"<th style='text-align:center !important;'>兵科</th>" +
				"<th style='text-align:center !important;'>攻撃</th>" +
				"<th style='text-align:center !important;'>知力</th>" +
				"<th style='text-align:center !important;'>歩防</th>" +
				"<th style='text-align:center !important;'>槍防</th>" +
				"<th style='text-align:center !important;'>弓防</th>" +
				"<th style='text-align:center !important;'>騎防</th>" +
				"<th style='text-align:center !important;'>速度</th>" +
				"<th style='text-align:center !important;'>知力/コスト</th>" +
				"<th style='text-align:center !important;'>デッキセット</th>" +
				"<th id='card_id' style='display:none;'>カードID</th>" +
			"</tr>"
		);
		j$("div[class=sortSystem]").append(tbl);

		// 検索するデッキセットタイプを判定
		var searchType = j$("#B_set_type").val();

		// タブ番号取得
		var labels = j$("#tab-labels a[class*=cur]").attr("href").match(/l=(\d+)#/);
		var labelNo = -1;
		if (labels != null) {
			labelNo = RegExp.$1;
		}

		// 最大ページ番号を取得
		var maxPageNo = 1;
		var pages = j$("div[class=rotateInfo clearfix] ul[class=pager] li").each(
			function(){
				var title;
				if(j$("a", this).length > 0) {
					title = j$("a", this).attr("title");
				} else {
					title = j$(this).text();
				}
				if(title != "" && parseInt(title) > 0) {
					maxPageNo = parseInt(title);
				}
			}
		);

		// status view
		j$("#B_set_textarea").html('&nbsp;ファイルを取得中です...&nbsp;&nbsp;<span id="nowp">0</span>&nbsp;/&nbsp;<span id="lastp">' + maxPageNo + '</span>');

		// デッキページの探索（かなり辛いが今と同様の力技処理）
		var deckCardList = [];
		for (var pageNo = 1; pageNo <= maxPageNo; pageNo++) {
			// 進捗表示
			j$("#nowp").text(pageNo);

			// デッキのhtmlを手に入れる
			var obj = null;
			getDeckList(labelNo, pageNo,
				function(responseText){
					obj = j$("<div>").append(responseText);
				}
			);

			// デッキ表示状態により分岐
			var wDeckCardList = [];
			if (deckType == 101 || deckType == 102) {
				// 大カード表示
				var statuses = j$("#cardFileList div[class=cardColmn]", obj);
				for( var i = 0; i < statuses.length; i++ ) {
					var cardInfo = [];

					// ステータス
					var target = j$("div[class*=omote_4sk]", statuses.eq(i));
					cardInfo['id'] = parseInt(j$("span[class=cardno]", target).text());
					cardInfo['name'] = j$("div[class=name] span[class=name]", target).text();
					cardInfo['level'] = parseInt(j$("div[class=level] span", target).text());
					cardInfo['cost'] = parseFloat(j$("span[class=cost]", target).text());
					cardInfo['type'] = j$("span[class=soltype] img", target).attr("title");
					cardInfo['atk'] = parseFloat(j$("ul[class=status] li[class=status_att]", target).text());
					cardInfo['int'] = parseFloat(j$("ul[class=status] li[class=status_int]", target).text());
					cardInfo['wdef'] = parseFloat(j$("ul[class=status] li[class=status_wdef]", target).text());
					cardInfo['sdef'] = parseFloat(j$("ul[class=status] li[class=status_sdef]", target).text());
					cardInfo['bdef'] = parseFloat(j$("ul[class=status] li[class=status_sdef]", target).text());
					cardInfo['rdef'] = parseFloat(j$("ul[class=status] li[class=status_sdef]", target).text());
					cardInfo['speed'] = parseFloat(j$("ul[class=status] li[class=status_speed]", target).text());
					cardInfo['perf'] = parseFloat(parseInt(cardInfo['int']/cardInfo['cost']*100)/100);

					// デッキセット用の内部ID
					var cardIdInfo = j$("div[class=control]", statuses.eq(i));
					if( cardIdInfo.length > 0) {
						var idInfo = cardIdInfo.html().match(/Cardset_master',(\d+)/);
						cardInfo['onDeckId'] = RegExp.$1;
					} else {
						cardInfo['onDeckId'] = 0;
					}

					// リストに貯める
					wDeckCardList.push(cardInfo);
				}
			} else {
				// 小カード表示
				var statuses = j$("#cardFileList div[class=statusDetail clearfix]", obj);
				for( var i = 0; i < statuses.length; i++ ) {
					var cardInfo = [];

					// ステータス
					var target = j$("div[class=right] td", statuses.eq(i));
					cardInfo['id'] = parseInt(target.eq(0).text());
					cardInfo['atk'] = parseFloat(target.eq(1).text());
					cardInfo['name'] = target.eq(2).text();
					cardInfo['int'] = parseFloat(target.eq(3).text());
					cardInfo['level'] = parseInt(target.eq(4).text());
					cardInfo['wdef'] = parseFloat(target.eq(5).text());    // 歩兵防御
					cardInfo['cost'] = parseFloat(target.eq(6).text());
					cardInfo['sdef'] = parseFloat(target.eq(7).text());    // 槍兵防御
					cardInfo['type'] = target.eq(8).text();
					cardInfo['bdef'] = parseFloat(target.eq(9).text());    // 弓兵防御
					cardInfo['rdef'] = parseFloat(target.eq(11).text());   // 騎兵防御
					cardInfo['speed'] = parseFloat(target.eq(13).text());
					cardInfo['perf'] = parseFloat(parseInt(cardInfo['int']/cardInfo['cost']*100)/100);

					// デッキセット用の内部ID
					var cardIdInfo = j$("div[class=set]", statuses.eq(i));
					if( cardIdInfo.length > 0) {
						var idInfo = cardIdInfo.html().match(/Cardset_master',(\d+)/);
						cardInfo['onDeckId'] = RegExp.$1;
					} else {
						cardInfo['onDeckId'] = 0;
					}

					// リストに貯める
					wDeckCardList.push(cardInfo);
				}
			}

			for( var i = 0; i < wDeckCardList.length; i++ ){
				// レアリティを設定。小表示ではレアリティがとれないため、内部テーブルを見る
				if (typeof card_list[wDeckCardList[i]['id']] != 'undefined') {
					wDeckCardList[i]['rarerity'] = card_list[wDeckCardList[i]['id']]['r'];
				} else {
					wDeckCardList[i]['rarerity'] = '--';
				}
				// 所属を設定
				if(wDeckCardList[i]['id'] < 2000) {
					wDeckCardList[i]['country'] = '蜀';
					wDeckCardList[i]['color'] = 'color:white; background-color:green;';
					if (searchType == 3 || searchType == 4 || searchType == 5) {
						wDeckCardList[i]['onDeckId'] = 0;
					}
				} else if(wDeckCardList[i]['id'] < 3000) {
					wDeckCardList[i]['country'] = '魏';
					wDeckCardList[i]['color'] = 'color:white; background-color:blue;';
					if (searchType == 2 || searchType == 4 || searchType == 5) {
						wDeckCardList[i]['onDeckId'] = 0;
					}
				} else if(wDeckCardList[i]['id'] < 4000) {
					wDeckCardList[i]['country'] = '呉';
					wDeckCardList[i]['color'] = 'color:white; background-color:red;';
					if (searchType == 2 || searchType == 3 || searchType == 5) {
						wDeckCardList[i]['onDeckId'] = 0;
					}
				} else if(wDeckCardList[i]['id'] < 5000) {
					wDeckCardList[i]['country'] = '他';
					wDeckCardList[i]['color'] = 'color:black; background-color:#D3D3D3';
					if (searchType == 2 || searchType == 3 || searchType == 4) {
						wDeckCardList[i]['onDeckId'] = 0;
					}
				} else if(wDeckCardList[i]['id'] < 6000) {
					wDeckCardList[i]['country'] = '覇';
					wDeckCardList[i]['color'] = 'color:black; background-color:gold;';
				} else {
					wDeckCardList[i]['country'] = '特';
					wDeckCardList[i]['onDeckId'] = 0;
				}

				// デッキセットフラグを設定
				wDeckCardList[i]['onDeck'] = 0;
			}

			// 非表示カードを除外
			var drawCardList = [];
			for( var i = 0; i < wDeckCardList.length; i++ ) {
				if (wDeckCardList[i]['onDeckId'] > 0) {
					drawCardList.push(wDeckCardList[i]);
					deckCardList.push(wDeckCardList[i]);
				}
			}
			wDeckCardList = [];

			// カードリストを画面に描画
			for( var i = 0; i < drawCardList.length; i++ ){
				var deckset;
				if( searchType == 7 ){
					deckset = "<input id='deck_set_" + drawCardList[i]['onDeckId'] + "' type='button' value='セット'>";
				} else {
					deckset = "<span>--</span>";
				}
				j$("#B_set_tbl").append(
					"<tr style='text-align:center;' id='card_" + drawCardList[i]['onDeckId'] + "'>" +
						"<td style='" + drawCardList[i]['color'] + "'>" + drawCardList[i]['id'] + "</td>" +
						"<td style='" + drawCardList[i]['color'] + "'>" + drawCardList[i]['rarerity'] + "</td>" +
						"<td style='" + drawCardList[i]['color'] + "'>" + drawCardList[i]['name'] + "</td>" +
						"<td style='" + drawCardList[i]['color'] + "'>" + drawCardList[i]['level'] + "</td>" +
						"<td style='" + drawCardList[i]['color'] + "'>" + drawCardList[i]['country'] + "</td>" +
						"<td style='" + drawCardList[i]['color'] + "'>" + drawCardList[i]['cost'] + "</td>" +
						"<td style='" + drawCardList[i]['color'] + "'>" + drawCardList[i]['type'] + "</td>" +
						"<td style='" + drawCardList[i]['color'] + "'>" + drawCardList[i]['atk'] + "</td>" +
						"<td style='" + drawCardList[i]['color'] + "'>" + drawCardList[i]['int'] + "</td>" +
						"<td style='" + drawCardList[i]['color'] + "'>" + drawCardList[i]['wdef'] + "</td>" +
						"<td style='" + drawCardList[i]['color'] + "'>" + drawCardList[i]['sdef'] + "</td>" +
						"<td style='" + drawCardList[i]['color'] + "'>" + drawCardList[i]['bdef'] + "</td>" +
						"<td style='" + drawCardList[i]['color'] + "'>" + drawCardList[i]['rdef'] + "</td>" +
						"<td style='" + drawCardList[i]['color'] + "'>" + drawCardList[i]['speed'] + "</td>" +
						"<td style='" + drawCardList[i]['color'] + "'>" + drawCardList[i]['perf'] + "</td>" +
						"<td id='onDeck' style='" + drawCardList[i]['color'] + "'>" + deckset + "</td>" +
					"</tr>"
				);
			}
		}
		if(deckCardList.length == 0) {
			j$("#B_set_tbl").append(
				"<tr style='text-align:center; background-color:red; color:white;'><td>対象となる武将カードがみつかりませんでした。</td></tr>"
			);
			j$("#B_set_tbl_head").css("display", "none");
			j$("#B_set_textarea").html("");
			return;
		}

		// デッキコストの取得
		var costs = j$("div[class=number cost clearfix] div[class=state] span[class=volume]").text().match(/([\S]*) \/ ([\S]*)/);
		var now_cost = RegExp.$1;
		var max_cost = RegExp.$2;
		var rest_cost = max_cost - now_cost;

		// status view
		j$("#B_set_textarea").html("&nbsp;<span>デッキ設定対象選定中です...&nbsp;&nbsp;</span><b>残りコスト：</b>&nbsp;<span id=rc>" + rest_cost + "</span>");

		// 候補検索
		var onDeckIndexList = [];
		var maxCards = parseInt(rest_cost);		// 最大セット枚数は残コスト÷1枚
		if (searchType == 1) {
			// 連環
			var selectedCardNameList = [];
			var selectedCardIdList = [];
			for(var i = 0; i < maxCards; i++ ) {
				var maxCpf = 0;
				var targetIndex = -1;
				for(var j = 0; j < deckCardList.length; j++) {
					var found = 0;
					for(var k = 0; k < selectedCardNameList.length; k++ ){
						if (selectedCardIdList[k] == deckCardList[j]['id'] || selectedCardNameList[k] == deckCardList[j]['name']) {
							found = 1;
							break;
						}
					}
					if( deckCardList[j]['cost'] > rest_cost || deckCardList[j]['onDeck'] == 1 || found == 1) {
						// コストが超えているかセット済みの武将は無視
						continue;
					}
					if (maxCpf < deckCardList[j]['perf']) {
						targetIndex = j;
						maxCpf = deckCardList[j]['perf'];
					}
				}
				if (targetIndex >= 0) {
					onDeckIndexList.push(targetIndex);
					selectedCardIdList.push(deckCardList[targetIndex]['id']);
					selectedCardNameList.push(deckCardList[targetIndex]['name']);
					j$("#card_" + deckCardList[targetIndex]['onDeckId'] + " td[id=onDeck]").html("待機中");
					deckCardList[targetIndex]['onDeck'] = 1;
					rest_cost = rest_cost - parseInt(deckCardList[targetIndex]['cost']);
					j$("#rc").text(rest_cost);
					if (rest_cost < 1) {
						break;
					}
				}
			}
		} else if (searchType == 6) {
			// 低コスト順
			var selectedCardNameList = [];
			var selectedCardIdList = [];
			for(var i = 0; i < maxCards; i++ ) {
				var minCost = 99;
				var targetIndex = -1;
				for(var j = 0; j < deckCardList.length; j++) {
					var found = 0;
					for(var k = 0; k < selectedCardNameList.length; k++ ){
						if (selectedCardIdList[k] == deckCardList[j]['id'] || selectedCardNameList[k] == deckCardList[j]['name']) {
							found = 1;
							break;
						}
					}
					if( deckCardList[j]['cost'] > rest_cost || deckCardList[j]['onDeck'] == 1 || found == 1) {
						// コストが超えているかセット済みの武将は無視
						continue;
					}
					if (minCost > deckCardList[j]['cost']) {
						targetIndex = j;
						minCost = deckCardList[j]['cost'];
					}
				}
				if (targetIndex >= 0) {
					onDeckIndexList.push(targetIndex);
					selectedCardIdList.push(deckCardList[targetIndex]['id']);
					selectedCardNameList.push(deckCardList[targetIndex]['name']);
					j$("#card_" + deckCardList[targetIndex]['onDeckId'] + " td[id=onDeck]").html("待機中");
					deckCardList[targetIndex]['onDeck'] = 1;
					rest_cost = rest_cost - parseInt(deckCardList[targetIndex]['cost']);
					j$("#rc").text(rest_cost);
					if (rest_cost < 1) {
						break;
					}
				}
			}
		} else if(searchType == 7) {
			// リスト表示
			for(var i = 0; i < deckCardList.length; i++) {
				j$("#deck_set_" + deckCardList[i]['onDeckId']).bind('click',
					function(){
						// カードID取得
						var id = j$(this).attr("id").match(/deck_set_(\d+)/);

						// 設定先の拠点IDを取得
						var villageId = j$("#bulkSetVillage select").val();

						// デッキに設定
						setDeck(labelNo, villageId, RegExp.$1,
							function(){
							}
						);

						j$("#card_" + RegExp.$1 + " td[id=onDeck]").html("完了");
					}
				);
			}

			j$("#B_set_type").css("display","none");
			j$("#B_set_textarea").css("display","none");
			j$("#group_deck_set").css("display","none");
			return;
		} else {
			// 軍極系
			var selectedCardNameList = [];
			var selectedCardIdList = [];
			for(var i = 0; i < maxCards; i++ ) {
				var maxCost = 5;
				var targetIndex = -1;
				for(var j = 0; j < deckCardList.length; j++) {
					var found = 0;
					for(var k = 0; k < selectedCardNameList.length; k++ ){
						if (selectedCardIdList[k] == deckCardList[j]['id'] || selectedCardNameList[k] == deckCardList[j]['name']) {
							found = 1;
							break;
						}
					}
					if( deckCardList[j]['cost'] > rest_cost || deckCardList[j]['onDeck'] == 1 || found == 1) {
						// コストが超えているかセット済みの武将は無視
						continue;
					}
					if (maxCost > deckCardList[j]['cost']) {
						targetIndex = j;
						maxCost = deckCardList[j]['cost'];
					}
				}
				if (targetIndex >= 0) {
					onDeckIndexList.push(targetIndex);
					selectedCardIdList.push(deckCardList[targetIndex]['id']);
					selectedCardNameList.push(deckCardList[targetIndex]['name']);
					j$("#card_" + deckCardList[targetIndex]['onDeckId'] + " td[id=onDeck]").html("待機中");
					deckCardList[targetIndex]['onDeck'] = 1;
					rest_cost = parseFloat(rest_cost) - parseFloat(deckCardList[targetIndex]['cost']);
					j$("#rc").text(rest_cost);
					if (rest_cost < 1) {
						break;
					}
				}
			}
		}

		// デッキ上げ候補から外れたカードを一覧から消す
		for(var i = 0; i < deckCardList.length; i++) {
			if(deckCardList[i]['onDeck'] == 0) {
				j$("#card_" + deckCardList[i]['onDeckId']).css("display", "none");
			}
		}

		// status view
		j$("#B_set_textarea").html("&nbsp;<span>デッキ設定中です...</span>");

		// 設定先の拠点IDを取得
		var villageId = j$("#bulkSetVillage select").val();

		// デッキにセットする
		for(var i = 0; i < onDeckIndexList.length; i++) {
			j$("#card_" + deckCardList[onDeckIndexList[i]]['onDeckId'] + " td[id=onDeck]").html("設定中");
			setDeck(labelNo, villageId, deckCardList[onDeckIndexList[i]]['onDeckId'],
				function(){
				}
			);
			j$("#card_" + deckCardList[onDeckIndexList[i]]['onDeckId'] + " td[id=onDeck]").html("設定済");
		}

		// デッキセットがおわったら戻る
		location.href = "http://" + location.hostname + "/card/deck.php?l=" + labelNo + "&p=1";

		// 指定タブの指定ページのカードリストを取得
		function getDeckList(labelNo, pageNo, callback) {
			var url;
			if( labelNo > 0 ) {
				url = "/card/deck.php?l=" + labelNo + "&p=" + pageNo;
			} else {
				url = "/card/deck.php?p=" + pageNo;
			}

			// 同期通信
			var xh = new XMLHttpRequest();
			xh.open("GET", url, false);
			xh.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;charset=UTF-8");
			xh.onreadystatechange = function() {
				if( xh.readyState == 4 && xh.status == 200 ){
					callback(xh.responseText);
				}
			}
			xh.send();
		}

		// デッキセット処理（同期通信）
		function setDeck(labelNo, vid, cardNo, callback) {
			var ssid = j$("input[name=ssid]").eq(0).attr("value");
			var data = "ssid=" + ssid + "&target_card=" + cardNo + "&mode=set&selected_village[" + cardNo + "]=" + vid + "&p=1";
			if( labelNo > 0 ) {
				data = data + "&l=" + labelNo;
			}
			var xh = new XMLHttpRequest();
			xh.open("POST", "http://" + HOST + "/card/deck.php", false);
			xh.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;charset=UTF-8");
			xh.onreadystatechange = function() {
				if( xh.readyState == 4 && xh.status == 200 ){
					callback();
				}
			}
			xh.send(data);
		}
	}

	// デッキから待機武将をすべてファイルに下ろす
	function file_unset(){
		var ssid = j$("input[name=ssid]").eq(0).attr("value");
		var cards = j$("div[id=cardListDeck] div[class=cardColmn] img[class*=set_release]");
		j$("#dropCardInfo").html("&nbsp;待機武将カードをデッキから落としています・・・<span id='dropMsg'>0</span> / " + cards.length);
		j$(cards).each(
			function(index){
				var cardIdInfo = j$(this).parent().html().match(/, (\d+),/);
				dropDeck(RegExp.$1, function(){});
				j$("#dropMsg").text(index+1);
			}
		);

		// デッキからのカードおろしがおわったら戻る
		location.href = "http://" + location.hostname + "/card/deck.php?l=&p=1";

		// デッキドロップ処理（同期通信）
		function dropDeck(cardNo, callback) {
			var ssid = j$("input[name=ssid]").eq(0).attr("value");
			var data = "mode=unset&target_card=" + cardNo + "&wild_card_flg=&inc_point=&btn_change_flg=&l=&ssid=" + ssid;
			var xh = new XMLHttpRequest();
			xh.open("POST", "http://" + HOST + "/card/deck.php", false);
			xh.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;charset=UTF-8");
			xh.onreadystatechange = function() {
				if( xh.readyState == 4 && xh.status == 200 ){
					callback();
				}
			}
			xh.send(data);
		}
	}

	//getContentFromURL関数
	function getContentFromURL(url) {
		var xmlhttp = new XMLHttpRequest();
		xmlhttp.open('GET', url, false);
		xmlhttp.send();

		if (xmlhttp.status == 200){
			return xmlhttp.responseText;
		}
		else {
			return "";
		}
	}
}
//end

//--------------------------------------------
// ルート表示 2014/02/24 add
//--------------------------------------------
function disp_route_view(){
//start
	////////////////////////////////////////////////////////
	// 変数定義
	////////////////////////////////////////////////////////
	jQuery.noConflict();
	var d = document;
	var $ = jQuery;
	var $xp = function (xp, dc) { return d.evaluate(xp, dc, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); };
	var $xp1 = function (xp, dc) { return d.evaluate(xp, dc, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
	var worldKey = location.hostname;
	var location_map = "/map.php";
	var location_bigmap = "/big_map.php";

	if(location.pathname !=location_map && location.pathname !=location_bigmap) return;

	// GM変数
	var ROUTESET = [];
	var WKROUTE = [];
	function saveValue () {
		GM_setValue(worldKey + "ROUTESET", ROUTESET.toSource());
		console.log("ROUTESET登録内容：" + ROUTESET);
	}
	function loadValue () {
		ROUTESET = eval(GM_getValue(worldKey + "ROUTESET", []));
	}
	// GM変数ロード
	loadValue();

	// ページ読み込み完了後に本処理開始
	window.addEventListener("load", function() { pre_main(); }, false);

	////////////////////////////////////////////////////////
	// １．地図上にルート情報を表示
	// ２．ルート登録用の設定表示追加
	////////////////////////////////////////////////////////
	function pre_main() {
		if (location.pathname == location_map) {
			createRouteImg();
		} else if (location.pathname == location_bigmap) {
			createRouteBig();
		}
		addBtn();
	}

	// ボタン付加
	function addBtn() {
		var div = d.createElement("div");
			div.id = "routeDiv";
			div.style.paddingBottom = "2px";
		var tgnd = $xp1('//div[@id="change-map-scale"]/h4', d);
		tgnd.parentNode.replaceChild(div , tgnd);

		var routeBtn = d.createElement("input");
			routeBtn.type = "button"
			routeBtn.id = "routeBtn";
		div.appendChild(routeBtn);
		routeBtn.value = "ルート記入欄の開閉"
		routeBtn.addEventListener("click", function() {
			addRouteArea();
		}, false);

		var showBtn = d.createElement("input");
			showBtn.type = "button"
			showBtn.id = "showBtn";
		div.appendChild(showBtn);
		showBtn.value = "表示/非表示"
		showBtn.addEventListener("click", function() {
			onOffRoute();
		}, false);
	}

	var routeShowFlg = true;
	// 表示／非表示切り変え
	function onOffRoute() {
		if (routeShowFlg) {
			if (location.pathname == location_map) {
				$("[id=routeImg]").remove();
			} else if (location.pathname == location_bigmap) {
				$(".routeOp").removeClass("routeOp");
			}
			routeShowFlg = false;
		} else {
			if (location.pathname == location_map) {
				createRouteImg();
			} else if (location.pathname == location_bigmap) {
				createRouteBig();
			}
			routeShowFlg = true;
		}
	}

	// 座標がルートと一致していればtrueを返す
	function chkRouteXY(x, y) {
		var xy = "(XXX,YYY)";
			xy = xy.replace("XXX", x);
			xy = xy.replace("YYY", y);
		/*for (var i in ROUTESET) {
			if (ROUTESET[i] == xy){ return true; }
		}*/
		for (var i in WKROUTE) {
			if (WKROUTE[i] == xy){ return true; }
		}
		return false;
	}

	// 全体地図に画像を表示させる
	// 11×11～21×21表示時
	function createRouteImg() {
		// 地図情報探索
		var mapScale = getMapScale();
		var centerX = parseInt(getParameter("x"));
		var centerY = parseInt(getParameter("y"));
		if (isNaN(centerX)) { centerX = 0; }
		else if (centerX > 600) { centerX = 600; }
		else if (centerX < -600) { centerX = -600; }
		if (isNaN(centerY)) { centerY = 0; }
		else if (centerY > 600) { centerY = 600; }
		else if (centerY > 600) { centerY = 600; }

		var topX = centerX - parseInt((mapScale - 1) / 2);
		var topY = centerY + parseInt((mapScale - 1) / 2);

		for (var i = 0, len = Math.pow(mapScale, 2); i < len; i++) {
			var x = topX + parseInt(i / mapScale);
			var y = topY - parseInt(i % mapScale);
			if (chkRouteXY(x, y)) {
				setRouteImg(i + 1, x, y);
			}
		}
		function setRouteImg(no, x, y) {
			if (no < 10) { no = "0" + no; } else { no = "" + no; }
			var img = document.createElement("img");
				img.id = "routeImg";
				img.className = "mapAll" + no;
				img.src = icon001 ;
			$xp1('//div[@id="mapsAll"]', d).appendChild(img);
		}
	}

	//地図幅の取得
	function getMapScale() {
		var sort15 = document.evaluate('//*[@id="change-map-scale"]/ul/li[@class="sort15 now"]',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		if (sort15.snapshotLength != 0) {
			return 15;
		}

		var sort21 = document.evaluate('//*[@id="change-map-scale"]/ul/li[@class="sort21 now"]',
			document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
		if (sort21.snapshotLength != 0) {
			return 21;
		}

		return 11;
	}
	//URLパラメータ取得
	function getParameter(key) {
		var str = location.search.split("?");
		if (str.length < 2) {
			return "";
		}

		var params = str[1].split("&");
		for (var i = 0; i < params.length; i++) {
			var keyVal = params[i].split("=");
			if (keyVal[0] == key && keyVal.length == 2) {
				return decodeURIComponent(keyVal[1]);
			}
		}
		return "";
	}

	// 全体地図にルートを表示する
	// 51×51表示時
	function createRouteBig() {
		var css = "div#map51-content div ul li.routeOp div { background:purple; opacity: 0.6; }";
		GM_addStyle(css);

		var areaArray = $xp('//div[@id="map51-content"]/div/ul/li/div/a', d);
		for (var i = 0, len = areaArray.snapshotLength; i < len; i++ ) {
			areaArray.snapshotItem(i).href.match(/x=([-0-9]+).+?y=([-0-9]+)/);
			var x = RegExp.$1;
			var y = RegExp.$2;
			if (chkRouteXY(x, y)) {
				var li = areaArray.snapshotItem(i).parentNode.parentNode;
					li.className = li.className + " routeOp";
			}
		}
	}

	// 設定表示
	var routeOpShowFlg = false;
	function addRouteArea(){
		if (routeOpShowFlg) { $("#route_opbase").remove(); routeOpShowFlg = false; return; }
		routeOpShowFlg = true;

		var css = "table.route_op { border: 2px solid black; border-collapse: collapse; margin: 5px; }" +
				".route_op th { border: 2px solid black; border-collapse: collapse; color: white; background-color: gray; padding : 0px; }" +
				".route_op td { border: 2px solid black; border-collapse: collapse; color: black; background-color: white; padding : 2px; } ";
		GM_addStyle(css);

		var baseEL = d.createElement("div");
			baseEL.id = "route_opbase";
		var tableEL = d.createElement("table");
			tableEL.className = "route_op";

		var trEL2 = d.createElement("tr");
		var tdEL2 = d.createElement("td");
			tdEL2.colSpan = 2;
		var textAreaEL = d.createElement("textarea");
			textAreaEL.id = "routeArea";
			textAreaEL.cols = 72;
			textAreaEL.rows = 5;
		for (var i = 0, len = ROUTESET.length; i < len; i++ ) {
			textAreaEL.defaultValue = textAreaEL.defaultValue + ROUTESET[i] + "\n";
		}
			tdEL2.appendChild(textAreaEL);
			trEL2.appendChild(tdEL2);
			tableEL.appendChild(trEL2);

		var trEL = d.createElement("tr");
		var thEL = d.createElement("th");
		var btnEL = d.createElement("input");
			btnEL.type = "button";
			btnEL.value = "【ルート登録・更新】";
			btnEL.addEventListener("click", setRoute, false);
			thEL.appendChild(btnEL);
			trEL.appendChild(thEL);
		var tdEL = d.createElement("td");
			tdEL.innerHTML = "※１行ごとに(x座標,y座標)とコメントが含まれる形式で記入";
			trEL.appendChild(tdEL);
			tableEL.appendChild(trEL);

			baseEL.appendChild(tableEL);
		var tgnd = $xp1('//div[@id="mapboxInner"]', d);
			tgnd.insertBefore(baseEL, tgnd.firstChild);
	}

	// ルート登録
	function setRoute() {
		if (!confirm("ルート情報を上書き更新します。\n※入力規則に沿わない行は無視されます。")) { return; }
		var textAreaEL = $xp1('//textarea[@id="routeArea"]', d);
		var inputArray = textAreaEL.value.split("\n");
		var routeSet = [];
		for (var i = 0, len = inputArray.length; i < len; i++ ) {
			if (inputArray[i]) {
				if (location.pathname == location_map) {
					var xy = inputArray[i].match(/\([-0-9]+,[-0-9]+\)/);
					var xy1 = inputArray[i].match(/[-0-9]+,[-0-9]+/);

					//if (!!xy) { routeSet.push(xy); }
					if (!!xy && !!xy1) {
						//title＆alt変更
						var xy2 = '"空き地 ' + xy1 + '"';
						var xy3 = '"新領地' + xy1 + '"';
						var txt = $("#mapOverlayMap").html();
						var reg1 = new RegExp(xy2, "gi");
						var reg2 = new RegExp(xy3, "gi");
						var m1 = txt.match(reg1);
						if (!!m1) {
							$("#mapOverlayMap").html(txt.replace("空き地 " + xy1, inputArray[i]));
						} else {
							var m2 = txt.match(reg2);
							if (!!m2) {
								$("#mapOverlayMap").html(txt.replace("新領地" + xy1, inputArray[i]));
							}
						}

						routeSet.push(inputArray[i]);
						WKROUTE.push(xy);
					}
				} else {
					var xy = inputArray[i].match(/\([-0-9]+,[-0-9]+\)/);
					routeSet.push(inputArray[i]);
					WKROUTE.push(xy);
				}
			}
		}
		ROUTESET = routeSet;
		saveValue();
		var textAreaEL = $xp1('//textarea[@id="routeArea"]', d);
			textAreaEL.value = "";
		for (var i = 0, len = ROUTESET.length; i < len; i++ ) {
			if (i > 0) {
				textAreaEL.value = textAreaEL.value + "\n";
			}
			textAreaEL.value = textAreaEL.value + ROUTESET[i];
		}
		// 表示更新
		onOffRoute();
		onOffRoute();
	}

	var icon001 = "data:image/png;base64," +
	"iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAYAAAA6/NlyAAAKSUlEQVRo3u3b2ZJj2VXG8f/a+0ipeUpJOc/ZVVlNV7TbjR2GHsB2t4ngCiK44QkIbngF4Im45AG4JAyY6HbXlJWZVVmZqXmetffiQqrqrslRo4Gwtu4l/XT22etbK3REP/k1f0jL8Ae2FuAFeAFegBfgBXgBXoAX4AV4AV6AF+AFeAFegBfgBXgBXoAX4AV4AV6AF+A3XsHv/RNl/gKDlRBWLQBTmeJ1jMf//wcLAmIIEyEiKUIsEZEEYUkAHlXFMaHrq3SpM9Xh+4IH7x1qCAhJlKQUyJttUrJF3n5K0ewz0Bpdfw/HiAkjWnpFzZ9S9+f0tIHT0buGB+8NGhAmLAmSpkBedlm1H7EbfMmmuUGMJGJmW3ukA2rujC6P6Ps6ddmjJPeo+lOaek5PWzgdoej/PbDBYCRMXNIkZYW82WXNfsKe/YJNe40ocRBhTJ++7xCVFDFJkghuMuWIpr8krSdk3SZ1/4CSv0fVn9D0F/S1iWPytnB5J/8AMBhCEiVGhqzdYNnssGp+wmHwGatml7BEMQhTHdKlxsDXmTLCqycsGXJmi6jEMQgTxtT8JTV/j4Y/ewZ+yVDbbwN/O7DBECZG3CyTkXUKdo91+zMO7Z9SMBuEJYKijOkz1BZOB0wYMdQ2fW3hdALAksRJmy2ysklEYsgc3tASZXeHhj+h5h9Q9nepuBPaXDHwHTzT14W/2ZYWsUSIkZAiebNNzmyzaT/nwP6MnF0hRAhVz1A7DLXFlAFTHTHWAX1t0KZE3Z0zpIMgpGSFrq/Rto9IyQYZ2SAqcYqyRdau0jTXKesdcm6LvJxS8nepyiltf8VQuyjuVeHBa0OjJEmbFZbNDsuyz5b9gsPgJ6RNDkuAV0efJiNt4Rgz0SFj7dOjTtuXqPkHVP0pNX9KR2tYArJmg6I5oKD7ZEyVjlySNGukZZ2IxCnIJhldoSnXKdnb5NwWNT+DV9wJHS0x0sGrwF9tS4tYYqRIyxp5u0vR3GAn+IJd8zEJSWHF4pnS1yZDbeN1woQBQ+3S1zpNvZxDT6i6U1p6SZ82qu7J/Z+SIjmzPYObfbJmk4TkSZgV0maNCAksholOaFHlyn9Hxd2i6k4p+TtU/QltLTNmiKp7M7AhICppcmaTojmgaD9iz3zOZnBEVGZfYMqYvjaYaAenE0YMGGmXrlZp+ktq/oyanlJ1p7S1zIDOC7+QwbAkcRJSIG92KZpD8maXrN0gzjIJUyRl1oiSfAJvU+PSfUfJfUNNT7lyd6j4E7paZaKDF13tF4MNAXHJkjNbFO0hq/IJB8HnrAZ7s9ICTHU0g9LFMWGsfQbaoeMrNPXRfNueUfMP6WqZIf3f9cs/tZuWiJOSIgW7R0EOKNh9MrJGwiwTkzxJWSEqKQIsE6Z0tMaF+y1X7jdU/SlX/g41d0qb6rM1/HlwQJiC3WPNfMh28AXX7JdPTlyAiQ4YaJPxD6B9bdL2ZRp6TtXNoHU9p+/rjOm/UVqaHYyJGdwcULQHFGSPtFkjIctEJUvCrBCT9A/gdc7dN5Tcb6j6Ey78Lar+lJ6v4Zg8DzYYls0OfxT6Wz4N/TWrZouoxFA8o/nBM9U+Ux0z0i59mrR9ibo+fAJt6CP62nxnefgxPGNWZ/D5Vk+bVeIsE5UMCVMkJhkCLFMcXW1y5W9Rmn5DTc+4dLe48L+l7ctPgzPyS/4i8g/cCN0kLSksliljpjpgTI+R9uj7Jh2t0PKX1HR+EPlT2r5En/Z763geV4iMrM+utjmgYPZImRXi5IhImoQpkpRZtVBgSI+yu89D9++cuV9ze/pv35elo+Af+VX4b8iaJKoTutQIEyKQMFYCxFtG2qOhj7jyt7lw31J2x7S5YuR7TBm/q7z7wqXzcjegQ2t6SdWcUJUDVoIPyMseObOFeBAzJSbLRCROkgxx+zF5s0tE1mn50tN12IhBEDwep2OQAFHBi0fmmCkjBtqip41Zvf09YJ+F92jQ921alOhoBR84liRO0uQRLOCY6ABLCJGAJGmuB5/RU/0efGv6zzT9f/P10t9zPTgibpYRYMIAryOmTDFYklJgzRwRlhhxl6Mq7yTjvvb2XiJOXLLETY6AMAaLoijuSaWxEsKjDBgw0C6A/ae1v/v+jSY8pOL/i5EGZGSdqIkTJoYXy0SHIJ6wxIiQImGyJCRPXJZZkiiCQcXhdArvCW0wRCRBRjbYCm6yY3/MdvAjiuaQpBSJSJqY5IhIEiOP422PK3+P2+5f+W7yL8+f0jGTYVl2WDU3uRb8JYfBH5MyGcDMS1KdifZxTOYndYOGv5gnnrtU9Y0y7it1YwnJs2y2KZpDiuaArNkkKQXipkBqnsYen9RDujT8Q6r+LhV3n0fuW87cfz59D3s8fd9kIiM6WqOhJ5z6jzg0X7MX+hFJ0oRknYkZMPANLCGWiBOzGdKySk7fOOO+FGpliQQ5snaLFXNI0RySlQ1SpkjSbJCWNSISf5K+qpS5cN9Qdt/S8BfU9QF1/4CWL9HTxsuj5bMZd9V+zAf2a3btTeKSBGBMj6E2v7/idOn4Kg199LoZ97mJiZUlYqTImi2Kdp8Vc42c2SQlK2TMDhnZYGneZ48Z0/JlLh/naz3h0t2i6uYxk9GrNw/PZtw1+2OuBV+xbT98EjNHdBloA6dDpowZaJseNeru/FUz7lMzsKiZ1duCHLBqr5Ez22TMOlmzT9ZsECEy/9wRDX9Fxd+m5u9T9SdcudtU/H3aWn5R+Hn1AcCzGXfVfsp1+ys2gw+IagyAIR2G2pzDR7NsrZX5vfTyjDubblnCEiNr1sjLPqv2OnmzQ9Zss2wOyZp1whJBVBkynG1Xf0zdn1HzDyj5O5T9fVr+kpH2XnYbvf7E49mMux78lCP7FRv2gLBEgceNfxOnIyYMGWh7Dj9/LuMqjkAi8/d7DN1j2exTtEfkZJVAlhCdlZeGP6fpT2n6i/n45y5lf0zDX8xa0989BXnzEc+zGXfD/glHwS/nM6wI4BloezYI0BFTRvS1RUfL1P1Dyv6Yqj9lqB1ikqFoDimYfYr2BqvmiIysEJgwqrMc39BzWv6ctpaezLnK7vh1J5tvP8R7NuNu2M84Cn7BitkiJEsInr42GWl7fsVnSW2Wx0t4pgSyxLK5zpr9kAx5AhPGq2OoPZr6iK6/pKOV+Q91j4o7oebP6FJ/3dm1vLPnlh5PRbJmg4IcsB36M67bP6dg1gnLEo7prK3UDlNmY5+R9ghJmozZJEGWQAI8niFdWu6CnlboaIWmf0TZH1P2x9T8GR2tvGk3Ju/8QS0RS1zSZGSDFXONLfslN4JfsGyLhAijOFq+jGcW8mcpTfC42emuVQZao+NrNPWCijumovcpu/t0tcxIe2/Tjcl7ezLth+OhFfMB28HP+TD4OVlTIE4CFWGofaY6oq1lelqet6F9mv6CijuhosdU/DENf8mI3ivX8f8V8A/hMcmwbLZYMdfYCb7ip6G/wmA4cf/BUK+Y6pAJQ0b06GiF8vQeFT2m7s9fOgN7w/U/gJwikcN63vMAAAAASUVORK5CYII=";

}
//end

//-----------------------------------------------------------------
// トレード画面スキル名右クリックで合成スキル表示 add 201403/02
//-----------------------------------------------------------------
function disp_gousei_skill() {
	jQuery.noConflict();
	$ = jQuery;
	$("body").append('<div id="gousei_menu_div"><div id="gousei_menu_div_title"></div><div id="gousei_menu_div_main"></div></div>');
	$("#gousei_menu_div").css({"border":"1px solid black","background":"#fcf8f8","display":"none","position":"absolute","width":"250px","height":"86px"});
	$("#gousei_menu_div_title").css({"width":"100%","height":"15px","text-align":"left","border-bottom":"1px solid black","background":"#f1dada"}).html('<span><b id=\'gousei_main_skill\'></b></span><a style=\'float:right;\' href="javascript:void(0)" id="gousei_close">x 閉じる</a>');
	$("#gousei_close").css({"color":"#333"}).click(function(){$("#gousei_menu_div").css({"display":"none"});});
	var title_val = {"title1":"中：","title2":"低：","title3":"稀：","title4":"隠："};

	$("tr.tradeTop").parent().find("tr").not(".tradeTop").each(function(){
		var main_skill_div = $(this).find("td.skill div").get(0);

		if(!$(main_skill_div)[0].innerHTML) return;

		var main_skill = $(main_skill_div).html().replace(/\n/g,"");
		var main_skill_name;
		if(main_skill.match(/^.*[:：](.*)LV.*$/)){
			main_skill_name = RegExp.$1.replace(/ /g,"");
		}
		$(this).bind("contextmenu",function(e){
			jQuery.noConflict();
			$ = jQuery;
			var x_pos = e.pageX;
			var y_pos = e.pageY;
			$("#gousei_menu_div").css({"display":"block","top":y_pos,"left":x_pos});
			$("#gousei_main_skill").html(main_skill_name);
			if(gousei_skill[main_skill_name] == undefined){
				$("#gousei_menu_div_main").html('未登録');
			} else {
				$("#gousei_menu_div_main").html('<ul><li id="get_skill1"></li><li id="get_skill2"></li><li id="get_skill3"></li><li id="get_skill4"></li></ul>');
				for(var i = 1;i <= 4;i++){
					var t_val = title_val["title" + i];
					$("#get_skill" + i).html(t_val + gousei_skill[main_skill_name][i-1]);
				}
			}
		return false;
		});
	});
}

//--------------------------------------------------------
// カード表示拡張と自動ブショーダス 2014/03/03 add
//--------------------------------------------------------
function disp_bro3_dasu(){
	jQuery.noConflict();
	j$ = jQuery;
	var PGNAME = "_Auto_Busho_Das_5zen_2014.05.24";	//グリモン領域への保存時のPGの名前
	var VERSION = "2014.07.11";						 // バージョン情報
	var HOST = location.hostname;					   //アクセスURLホスト
	var OPT_SEASON = "DF";							  // 標準は変更しない

	var SukesukeFlg;									//自動ダス設定画面での設定

	// 画像リソース配列
	var bg_waku		 = [];						   // 枠なし
	var bg_waku_d	   = [];						   // １段
	var bg_waku_w	   = [];						   // ２段

	var d = document;
	//								1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3 3 3 4 4 4 4 4 4 4 4 4 4 5
	//	  1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0
	var OPT_DOME = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
	//																																																					   1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
	//								   1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3 3 3 4 4 4 4 4 4 4 4 4 4 5 5 5 5 5 5 5 5 5 5 6 6 6 6 6 6 6 6 6 6 7 7 7 7 7 7 7 7 7 7 8 8 8 8 8 8 8 8 8 8 9 9 9 9 9 9 9 9 9 9 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3 3 3 4 4 4 4 4 4 4 4 4 4 5
	//			   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0
	var OPT_OTHER = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
	var DrawResult = ["","","","","","","","","",""];

	var g_MD="";

	// 保存データデリミタ
	var DELIMIT1 = "#$%";
	var DELIMIT2 = "&?@";
	var DELIMIT3 = "{=]";
	var DELIMIT4 = "|-/";

	var Skill_List = [
		[ "剣兵の進撃",	  1 ],	 [ "騎兵の進撃",	  2 ],	 [ "槍兵の進撃",	  3 ],	 [ "弓兵の進撃",	  4 ],	 [ "兵器の進撃",	  5 ],
		[ "剣兵の強撃",	  6 ],	 [ "騎兵の強撃",	  7 ],	 [ "槍兵の強撃",	  8 ],	 [ "弓兵の強撃",	  9 ],	 [ "兵器の強撃",	 10 ],
		[ "剣兵の猛撃",	 11 ],	 [ "騎兵の猛撃",	 12 ],	 [ "槍兵の猛撃",	 13 ],	 [ "弓兵の猛撃",	 14 ],	 [ "兵器の猛撃",	 15 ],
		[ "剣兵の極撃",	 16 ],	 [ "騎兵の極撃",	 17 ],	 [ "槍兵の極撃",	 18 ],	 [ "弓兵の極撃",	 19 ],	 [ "兵器の極撃",	 20 ],
		[ "剣兵突撃",	   21 ],   [ "騎兵突撃",	   22 ],   [ "槍兵突撃",	   23 ],   [ "弓兵突撃",	   24 ],   [ "兵器突撃",	   25 ],
		[ "剣兵突覇",	   26 ],   [ "騎兵突覇",	   27 ],   [ "槍兵突覇",	   28 ],   [ "弓兵突覇",	   29 ],   [ "兵器突覇",	   30 ],
		[ "騎兵の進攻",	 32 ],	 [ "槍兵の進攻",	 33 ],	 [ "弓兵の進攻",	 34 ],
		[ "奇計百出",	   36 ],   [ "英雄",		   37 ],   [ "覇道",		   38 ],   [ "豪傑",		   39 ],   [ "一騎当千",	   40 ],
		[ "蛮族の襲撃",	 41 ],	 [ "蛮王の襲撃",	 42 ],	 [ "趁火打劫",	   43 ],

		[ "剣兵防御",	   51 ],   [ "騎兵防御",	   52 ],   [ "槍兵防御",	   53 ],   [ "弓兵防御",	   54 ],   [ "兵器防御",	   55 ],
		[ "剣兵方陣",	   56 ],   [ "騎兵方陣",	   57 ],   [ "槍兵方陣",	   58 ],   [ "弓兵方陣",	   59 ],   [ "兵器方陣",	   60 ],
		[ "騎兵の聖域",	 62 ],	 [ "槍兵の聖域",	 63 ],	 [ "弓兵の聖域",	 64 ],
		[ "騎兵堅守",	   67 ],   [ "槍兵堅守",	   68 ],   [ "弓兵堅守",	   69 ],
		[ "八卦の陣",	   71 ],   [ "鉄壁",		   72 ],   [ "守護神",		 73 ],

		[ "剣兵行軍",	   81 ],   [ "騎兵行軍",	   82 ],   [ "槍兵行軍",	   83 ],   [ "弓兵行軍",	   84 ],   [ "兵器行軍",	   85 ],
		[ "剣兵強行",	   86 ],   [ "騎兵強行",	   87 ],   [ "槍兵強行",	   88 ],   [ "弓兵強行",	   89 ],   [ "兵器強行",	   90 ],
		[ "急速援護",	   91 ],   [ "千里行",		 92 ],	 [ "神速",		   93 ],

		[ "伐採知識",	   101 ],  [ "石切知識",	   102 ],  [ "製鉄知識",	   103 ],  [ "食糧知識",	   104 ],
		[ "伐採技術",	   106 ],  [ "石切技術",	   107 ],  [ "製鉄技術",	   101 ],  [ "食糧技術",	   109 ],

		[ "練兵訓練",	   111 ],  [ "厩舎訓練",	   112 ],  [ "兵舎訓練",	   113 ],  [ "弓兵訓練",	   114 ],  [ "兵器訓練",	   115 ],
		[ "練兵修練",	   116 ],  [ "厩舎修練",	   117 ],  [ "兵舎修練",	   118 ],  [ "弓兵修練",	   119 ],  [ "兵器修練",	   120 ],
		[ "呉の治世",	   121 ],  [ "王佐の才",	   122 ],  [ "仁君",	   123 ],

		[ "加工知識",	   126 ],  [ "加工技術",	   127 ],  [ "農林技術",	   129 ]
	];
	var $ = function(id) { return d.getElementById(id); };
	var $x = function(xp,dc) { return d.evaluate(xp, dc||d, null, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue; };
	var $a = function(xp,dc) { var r = d.evaluate(xp, dc||d, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); var a=[]; for(var i=0; i<r.snapshotLength; i++){ a.push(r.snapshotItem(i)); } return a; };
	var $e = function(e,t,f) { if (!e) return; e.addEventListener(t, f, false); };

	// 色設定
	var COLOR_FRAME = "#333333";	// 枠背景色
	var COLOR_BASE	= "#654634";	// 拠点リンク色
	var COLOR_TITLE = "#FFCC00";	// 各BOXタイトル背景色
	var COLOR_BACK	= "#FFF2BB";	// 各BOX背景色

	var lv_list = [
		[	14	 ,	 80  ,	 16  ,	 03  ,	1 ] ,
		[	40	 ,	 71  ,	 21  ,	 06  ,	2 ] ,
		[	66	 ,	 62  ,	 25  ,	 10  ,	3 ] ,
		[	92	 ,	 53  ,	 27  ,	 13  ,	7 ] ,
		[	118	 ,	 46  ,	 28  ,	 17  ,	9 ] ,
		[	144	 ,	 39  ,	 28  ,	 19  ,	 14 ] ,
		[	170	 ,	 34  ,	 27  ,	 22  ,	 17 ] ,
		[	196	 ,	 29  ,	 26  ,	 24  ,	 21 ] ,
		[	224	 ,	 26  ,	 24  ,	 21  ,	 29 ] ,
		[	250	 ,	 24  ,	 22  ,	 20  ,	 34 ] ,
		[	276	 ,	 23  ,	 20  ,	 18  ,	 39 ] ,
		[	302	 ,	 20  ,	 18  ,	 16  ,	 46 ] ,
		[	328	 ,	 17  ,	 16  ,	 14  ,	 53 ] ,
		[	999	 ,	0  ,	0  ,	0  ,	0 ]
	];

	var scr_list = [
		[		25 , 66.67	 ],  [	   225 , 66.56	 ],  [	   625 , 66.44	 ],  [	  1225 , 66.33	 ],  [	  2025 , 66.22	 ],  [	  3025 , 66.10	 ],  [	  4225 , 65.99	 ],  [	  5625 , 65.87	 ],
		[	  7225 , 65.75	 ],  [	  9025 , 65.64	 ],  [	 11025 , 65.52	 ],  [	 13225 , 65.40	 ],  [	 15625 , 65.28	 ],  [	 18225 , 65.16	 ],  [	 21025 , 65.03	 ],  [	 24025 , 64.91	 ],
		[	 27225 , 64.79	 ],  [	 30625 , 64.66	 ],  [	 34225 , 64.54	 ],  [	 38025 , 64.41	 ],  [	 42025 , 64.29	 ],  [	 46225 , 64.16	 ],  [	 50625 , 64.03	 ],  [	 55225 , 63.90	 ],
		[	 60025 , 63.77	 ],  [	 65025 , 63.64	 ],  [	 70225 , 63.50	 ],  [	 75625 , 63.37	 ],  [	 81225 , 63.24	 ],  [	 87025 , 63.10	 ],  [	 93025 , 62.96	 ],  [	 99225 , 62.83	 ],
		[	105625 , 62.69	 ],  [	112225 , 62.55	 ],  [	119025 , 62.41	 ],  [	126025 , 62.26	 ],  [	133225 , 62.12	 ],  [	140625 , 61.98	 ],  [	148225 , 61.83	 ],  [	156025 , 61.69	 ],
		[	164025 , 61.54	 ],  [	172225 , 61.39	 ],  [	180625 , 61.24	 ],  [	189225 , 61.09	 ],  [	198025 , 60.94	 ],  [	207025 , 60.78	 ],  [	216225 , 60.63	 ],  [	225625 , 60.48	 ],
		[	235225 , 60.32	 ],  [	245025 , 60.16	 ],  [	255025 , 60.00	 ],  [	265225 , 59.84	 ],  [	275625 , 59.68	 ],  [	286225 , 59.51	 ],  [	297025 , 59.35	 ],  [	308025 , 59.19	 ],
		[	319225 , 59.02	 ],  [	330625 , 58.85	 ],  [	342225 , 58.68	 ],  [	354025 , 58.51	 ],  [	366025 , 58.33	 ],  [	378225 , 58.16	 ],  [	390625 , 57.98	 ],  [	403225 , 57.81	 ],
		[	416025 , 57.63	 ],  [	429025 , 57.45	 ],  [	442225 , 57.26	 ],  [	455625 , 57.08	 ],  [	469225 , 56.90	 ],  [	483025 , 56.71	 ],  [	497025 , 56.52	 ],  [	511225 , 56.33	 ],
		[	525625 , 56.14	 ],  [	540225 , 55.95	 ],  [	555025 , 55.76	 ],  [	570025 , 55.56	 ],  [	585225 , 55.36	 ],  [	600625 , 55.16	 ],  [	616225 , 54.95	 ],  [	632025 , 54.75	 ],
		[	648025 , 54.55	 ],  [	664225 , 54.34	 ],  [	680625 , 54.13	 ],  [	697225 , 53.92	 ],  [	714025 , 53.71	 ],  [	731025 , 53.49	 ],  [	748225 , 53.27	 ],  [	765625 , 53.05	 ],
		[	783225 , 52.83	 ],  [	801025 , 52.61	 ],  [	819025 , 52.38	 ],  [	837225 , 52.15	 ],  [	855625 , 51.92	 ],  [	874225 , 51.69	 ],  [	893025 , 51.46	 ],  [	912025 , 51.22	 ],
		[	931225 , 50.98	 ],  [	950625 , 50.74	 ],  [	970225 , 50.50	 ],  [	990025 , 50.25	 ],  [	 1010025 , 50.00	 ],  [	 1030225 , 49.75	 ],  [	 1050625 , 49.49	 ],  [	 1071225 , 49.23	 ],
		[	1092025 , 48.97	 ],  [	 1113025 , 48.71	 ],  [	 1134225 , 48.45	 ],  [	 1155625 , 48.18	 ],  [	 1177225 , 47.91	 ],  [	 1199025 , 47.64	 ],  [	 1221025 , 47.36	 ],  [	 1243225 , 47.08	 ],
		[	1265625 , 46.80	 ],  [	 1288225 , 46.52	 ],  [	 1311025 , 46.23	 ],  [	 1334025 , 45.93	 ],  [	 1357225 , 45.62	 ],  [	 1380625 , 45.31	 ],  [	 1404225 , 45.00	 ],  [	 1428025 , 44.68	 ],
		[	1452025 , 44.36	 ],  [	 1476225 , 44.03	 ],  [	 1500625 , 43.70	 ],  [	 1525225 , 43.36	 ],  [	 1550025 , 43.02	 ],  [	 1575025 , 42.68	 ],  [	 1600225 , 42.33	 ],  [	 1625625 , 41.98	 ],
		[	1651225 , 41.62	 ],  [	 1677025 , 41.26	 ],  [	 1703025 , 40.89	 ],  [	 1729225 , 40.52	 ],  [	 1755625 , 40.14	 ],  [	 1782225 , 39.76	 ],  [	 1809025 , 39.37	 ],  [	 1836025 , 38.98	 ],
		[	1863225 , 38.58	 ],  [	 1890625 , 38.18	 ],  [	 1918225 , 37.77	 ],  [	 1946025 , 37.36	 ],  [	 1974025 , 36.94	 ],  [	 2002225 , 36.51	 ],  [	 2030625 , 36.09	 ],  [	 2059225 , 35.65	 ],
		[	2088025 , 35.21	 ],  [	 2117025 , 34.77	 ],  [	 2146225 , 34.32	 ],  [	 2175625 , 33.86	 ],  [	 2205225 , 33.40	 ],  [	 2235025 , 32.93	 ],  [	 2265025 , 32.46	 ],  [	 2295225 , 31.98	 ],
		[	2325625 , 31.50	 ],  [	 2356225 , 31.01	 ],  [	 2387025 , 30.52	 ],  [	 2418025 , 30.02	 ],  [	 2449225 , 29.52	 ],  [	 2480625 , 29.01	 ],  [	 2512225 , 28.49	 ],  [	 2544025 , 27.97	 ],
		[	2576025 , 27.45	 ],  [	 2608225 , 26.92	 ],  [	 2640625 , 26.38	 ],  [	 2673225 , 25.84	 ],  [	 2706025 , 25.30	 ],  [	 2739025 , 24.74	 ],  [	 2772225 , 24.19	 ],  [	 2805625 , 23.63	 ],
		[	2839225 , 23.07	 ],  [	 2873025 , 22.50	 ],  [	 2907025 , 21.92	 ],  [	 2941225 , 21.35	 ],  [	 2975625 , 20.77	 ],  [	 3010225 , 20.18	 ],  [	 3045025 , 19.59	 ],  [	 3080025 , 19.00	 ],
		[	3115225 , 18.40	 ],  [	 3150625 , 17.80	 ],  [	 3186225 , 17.20	 ],  [	 3222025 , 16.60	 ],  [	 3258025 , 15.99	 ],  [	 3294225 , 15.38	 ],  [	 3330625 , 14.76	 ],  [	 3367225 , 14.15	 ],
		[	3404025 , 13.53	 ],  [	 3441025 , 12.91	 ],  [	 3478225 , 12.28	 ],  [	 3515625 , 11.65	 ],  [	 3553225 , 11.01	 ],  [	 3591025 , 10.37	 ],  [	 3629025 ,	9.73	 ],  [	 3667225 ,	9.09	 ],
		[	3705625 ,  9.09	 ],  [	 3744225 ,	9.09	 ],  [	 3783025 ,	9.09	 ],  [	 3822025 ,	9.09	 ],  [	 3861225 ,	9.09	 ],  [	 3900625 ,	9.09	 ],  [	 3940225 ,	9.09	 ],  [	 3980025 ,	9.09	 ],
		[	4020025 ,  9.09	 ],  [	 4060225 ,	9.09	 ],  [	 4100625 ,	9.09	 ],  [	 4141225 ,	9.09	 ],  [	 4182025 ,	9.09	 ],  [	 4223025 ,	9.09	 ],  [	 4264225 ,	9.09	 ],  [	 4305625 ,	9.09	 ],
		[	4347225 ,  9.09	 ],  [	 4389025 ,	9.09	 ],  [	 4431025 ,	9.09	 ],  [	 4473225 ,	9.09	 ],  [	 4515625 ,	9.09	 ],  [	 4558225 ,	9.09	 ],  [	 4601025 ,	9.09	 ],  [	 4644025 ,	9.09	 ],
		[	4687225 ,  9.09	 ],  [	 4730625 ,	9.09	 ],  [	 4774225 ,	9.09	 ],  [	 4818025 ,	9.09	 ],  [	 4862025 ,	9.09	 ],  [	 4906225 ,	9.09	 ],  [	 4950625 ,	9.09	 ],  [	 4995225 ,	9.09	 ],
		[	5040025 ,  9.09	 ],  [	 999999999 ,  0.00	 ]
	];

	( function() {

		console.log("*** Start bro3_dasu ***");

		LoadSettingBox();

		// Lvup時のポイント振り分け画面
		if (location.pathname == "/card/status_info.php") {
			// Lvup処理のためのCardIDとCardNoを呼び出し
			var LvupCardList = cloadData("LvupCardidList", "[]", true, true);

			// CardID の抽出
			var CardID = location.search.match(/\d+/)[0];
			for (var i=0;i<LvupCardList.length;i++){
				if (LvupCardList[i].cardid == CardID) {
					var CardNo = parseInt(LvupCardList[i].cardno);
					break;
				}
			}

			j$("#levelupWindow").append(
				"<br><center>" +
					"<table border=1>" +
						"<tr bgcolor=#FFCC00>" +
							"<td width=100 align=center>攻撃</td>" +
							"<td width=100 align=center>防御</td>" +
							"<td width=100 align=center>知力</td>" +
							"<td width=100 align=center>隠し</td>" +
						"</tr>" +
						"<tr>" +
							"<td width=100 align=center>" + gousei_skill[card_list[CardNo].bs][0] + "</td>" +
							"<td width=100 align=center>" + gousei_skill[card_list[CardNo].bs][1] + "</td>" +
							"<td width=100 align=center>" + gousei_skill[card_list[CardNo].bs][2] + "</td>" +
							"<td width=100 align=center>" + gousei_skill[card_list[CardNo].bs][3] + "</td>" +
						"</tr>" +
					"</table>" +
				"</center>"
			);
		}

		jQuery.noConflict();
		j$ = jQuery;

		// 都市、土地の季節固定化
		if (((location.pathname == "/village.php") || (location.pathname == "/land.php")) && (OPT_SEASON != "DF")) {
			bro3dasuDrawSeason();
		}

		// 所持スキル表示
		if(    location.pathname == "/user/"
			|| location.pathname == "/card/deck.php"
			|| location.pathname == "/card/trade_card.php"
			|| location.pathname.match(/union/)) {
			bro3dasuDrawSkill();
		}

		// 合成スキル表示
		if(    location.pathname == "/union/learn.php"
			|| location.pathname == "/busyodas/busyodas_continuty_result.php"
			|| location.pathname == "/busyodas/busyodas_result.php"
			|| location.pathname == "/card/trade.php"
			|| location.pathname == "/card/trade_card.php"){
			bro3dasuDrawCompositionSkill();
		}

		// ステータスアップ可能カードの情報を記録
		if(location.pathname == "/card/deck.php") {
			var LvupCardList = [];

			// 大カード用
			j$("#wrapper div[class=cardColmn] div[class*=omote]").each(
				function(){
					if(j$("span[class=status_levelup]", this).length == 0){
						return;
					}
					var cardNo = j$("span[class=cardno]", this).text();
					var cardIdInfo = j$("span[class=status_levelup]", this).html().match(/cid=(\d+)&/);
					if( cardIdInfo == null) {
						return;
					}
					LvupCardList.push({"cardno":cardNo, "cardid":RegExp.$1});
				}
			);

			// 小カード用
			j$("div[class=statusDetail clearfix]").each(
				function(){
					if(j$("div[class=levelup]", this).length == 0){
						return;
					}
					var cardNo = j$("table[class=statusParameter1] td", this).eq(0).text();
					var cardIdInfo = j$("div[class=levelup]", this).html().match(/cid=(\d+)&/);
					if( cardIdInfo == null) {
						return;
					}
					LvupCardList.push({"cardno":parseInt(cardNo), "cardid":RegExp.$1});
				}
			);

			csaveData( "LvupCardidList", LvupCardList, true, true );
		}

		if (location.pathname == "/busyodas/busyodas.php") {
			// bro3_dasu設定画面
			addOpenSettingHtml();

			j$("#busyodasTabContent:has(div[class='sysMes busyodasCardInfo']) div[class='busyodasHeader clearfix']").before("<div id=AutoBushodasLite>");		   // ノーマルタブ
			j$("#AutoBushodasLite").append("<div id=AutoBushodasControls>");
			j$("#AutoBushodasLite").append("<div id=CardInfo>");
			j$("#CardInfo").css({
				"width": "680px",
				"font-size": "14px",
				"text-align": "center",
				"margin-top": "10px",
				"margin-bottom": "5px"
			});

			j$("#busyodasTenTabContent:has(div[class='sysMes busyodasCardInfo']) div[class='busyodasHeader clearfix']").before("<div id=AutoBushodasLite>");	// 小麗大鳳タブ
			j$("#AutoBushodasLite").append("<div id=AutoBushodasControls>");
			j$("#AutoBushodasLite").append("<div id=CardInfo>");
			j$("#CardInfo").css({
				"width": "680px",
				"font-size": "14px",
				"text-align": "center",
				"margin-top": "10px",
				"margin-bottom": "5px"
			});
		}

		// 自動ブショーダスの破棄チェック
		if (location.pathname == "/busyodas/busyodas_continuty_result.php" || location.pathname == "/busyodas/busyodas_result.php") {
			bro3dasuBusyodasDestructionCheck();
		}

		// 一括破棄画面の破棄チェック
		if (location.pathname == "/card/allcard_delete.php") {
			// 経験値・スコアともに０の保持対象外カードのみ破棄
			bro3dasuDropListDestructionCheck();
		}
	})();

	//--------------------------------------
	// 都市画面背景変更
	//--------------------------------------
	function bro3dasuDrawSeason() {
		// 背景画像の差替
		switch (OPT_SEASON) {
			case "OL":
				GM_addStyle("div#villageSpring  { background:url('" + GM_getResourceURL("old_village") + "') no-repeat scroll left top transparent}");	// 本拠地
				GM_addStyle("div#villageSummer  { background:url('" + GM_getResourceURL("old_village") + "') no-repeat scroll left top transparent}");
				GM_addStyle("div#villageAutumn  { background:url('" + GM_getResourceURL("old_village") + "') no-repeat scroll left top transparent}");
				GM_addStyle("div#villageWinter  { background:url('" + GM_getResourceURL("old_village") + "') no-repeat scroll left top transparent}");
				GM_addStyle("div#mapSpring	  { background:url('" + GM_getResourceURL("old_map") + "')	 no-repeat scroll left top transparent}");	// 拠点
				GM_addStyle("div#mapSummer	  { background:url('" + GM_getResourceURL("old_map") + "')	 no-repeat scroll left top transparent}");
				GM_addStyle("div#mapAutumn	  { background:url('" + GM_getResourceURL("old_map") + "')	 no-repeat scroll left top transparent}");
				GM_addStyle("div#mapWinter	  { background:url('" + GM_getResourceURL("old_map") + "')	 no-repeat scroll left top transparent}");
				break;
			case "SP":
				GM_addStyle("div#villageSummer  { background:url('" + GM_getResourceURL("Spring_village") + "') no-repeat scroll left top transparent}");
				GM_addStyle("div#villageAutumn  { background:url('" + GM_getResourceURL("Spring_village") + "') no-repeat scroll left top transparent}");
				GM_addStyle("div#villageWinter  { background:url('" + GM_getResourceURL("Spring_village") + "') no-repeat scroll left top transparent}");
				GM_addStyle("div#mapSummer	  { background:url('" + GM_getResourceURL("Spring_map") + "')	 no-repeat scroll left top transparent}");
				GM_addStyle("div#mapAutumn	  { background:url('" + GM_getResourceURL("Spring_map") + "')	 no-repeat scroll left top transparent}");
				GM_addStyle("div#mapWinter	  { background:url('" + GM_getResourceURL("Spring_map") + "')	 no-repeat scroll left top transparent}");
				break;
			case "SU":
				GM_addStyle("div#villageSpring  { background:url('" + GM_getResourceURL("Summer_village") + "') no-repeat scroll left top transparent}");	// 本拠地
				GM_addStyle("div#villageAutumn  { background:url('" + GM_getResourceURL("Summer_village") + "') no-repeat scroll left top transparent}");
				GM_addStyle("div#villageWinter  { background:url('" + GM_getResourceURL("Summer_village") + "') no-repeat scroll left top transparent}");
				GM_addStyle("div#mapSpring	  { background:url('" + GM_getResourceURL("Summer_map") + "')	 no-repeat scroll left top transparent}");	 // 拠点
				GM_addStyle("div#mapAutumn	  { background:url('" + GM_getResourceURL("Summer_map") + "')	 no-repeat scroll left top transparent}");
				GM_addStyle("div#mapWinter	  { background:url('" + GM_getResourceURL("Summer_map") + "')	 no-repeat scroll left top transparent}");
				break;
			case "AU":
				GM_addStyle("div#villageSpring  { background:url('" + GM_getResourceURL("Autumn_village") + "') no-repeat scroll left top transparent}");	// 本拠地
				GM_addStyle("div#villageSummer  { background:url('" + GM_getResourceURL("Autumn_village") + "') no-repeat scroll left top transparent}");
				GM_addStyle("div#villageWinter  { background:url('" + GM_getResourceURL("Autumn_village") + "') no-repeat scroll left top transparent}");
				GM_addStyle("div#mapSpring	  { background:url('" + GM_getResourceURL("Autumn_map") + "')	 no-repeat scroll left top transparent}");	 // 拠点
				GM_addStyle("div#mapSummer	  { background:url('" + GM_getResourceURL("Autumn_map") + "')	 no-repeat scroll left top transparent}");
				GM_addStyle("div#mapWinter	  { background:url('" + GM_getResourceURL("Autumn_map") + "')	 no-repeat scroll left top transparent}");
				break;
			case "WI":
				GM_addStyle("div#villageSpring  { background:url('" + GM_getResourceURL("Winter_village") + "') no-repeat scroll left top transparent}");	// 本拠地
				GM_addStyle("div#villageSummer  { background:url('" + GM_getResourceURL("Winter_village") + "') no-repeat scroll left top transparent}");
				GM_addStyle("div#villageAutumn  { background:url('" + GM_getResourceURL("Winter_village") + "') no-repeat scroll left top transparent}");
				GM_addStyle("div#mapSpring	  { background:url('" + GM_getResourceURL("Winter_map") + "')	 no-repeat scroll left top transparent}");	 // 拠点
				GM_addStyle("div#mapSummer	  { background:url('" + GM_getResourceURL("Winter_map") + "')	 no-repeat scroll left top transparent}");
				GM_addStyle("div#mapAutumn	  { background:url('" + GM_getResourceURL("Winter_map") + "')	 no-repeat scroll left top transparent}");
				break;
			default:
				break;
			}

		var elements = document.getElementsByTagName('img');
		var season_tag = "";
		var change_flg = false;
		for (i = 0; i < elements.length; i++) {
			change_flg = false;
			if (elements[i].nodeName == 'IMG') {
				switch (OPT_SEASON) {
					case "OL" : season_tag = "";		break;
					case "SP" : season_tag = "_spring";	 break;
					case "SU" : season_tag = "_summer";	 break;
					case "AU" : season_tag = "_autumn";	 break;
					case "WI" : season_tag = "_winter";	 break;
					default:	season_tag = "err";	 break;
				}
				if (season_tag == "err") { break; }

				if (elements[i].src.match("facility/facility_")){
					switch (elements[i].src.substring(elements[i].src.lastIndexOf("_") - 3).substring(0, 3)) {
						case "216"	:	change_flg = true;	  break;	  // 雀
						case "205"	:	change_flg = true;	  break;	  // 城
						case "220"	:	change_flg = true;	  break;	  // 村
						case "222"	:	change_flg = true;	  break;	  // 砦
						case "101"	:	change_flg = true;	  break;	  // 森
						default	 :	 change_flg = false;	 break;
					}
				}
				// チップ画像の差替
				if (change_flg) {
					if (OPT_SEASON == "OL") {
						elements[i].src = elements[i].src.replace("_spring",season_tag);
						elements[i].src = elements[i].src.replace("_summer",season_tag);
						elements[i].src = elements[i].src.replace("_autumn",season_tag);
						elements[i].src = elements[i].src.replace("_winter",season_tag);
					} else {
						if (season_tag != "_spring")	{	elements[i].src = elements[i].src.replace("_spring",season_tag);	}
						if (season_tag != "_summer")	{	elements[i].src = elements[i].src.replace("_summer",season_tag);	}
						if (season_tag != "_autumn")	{	elements[i].src = elements[i].src.replace("_autumn",season_tag);	}
						if (season_tag != "_winter")	{	elements[i].src = elements[i].src.replace("_winter",season_tag);	}
					}
				}
			}
		}
	}

	//--------------------------------------
	// 武将スキル表示
	//--------------------------------------
	function bro3dasuDrawSkill() {
		if (location.pathname.match(/union/) == null) {
			// スキル枠
			if (location.pathname == "/card/trade_card.php") {
				j$("div[class*=card rarerity] span[class=status_frontback]").parent().after(
					'<span style="position:relative; top:-297px;">' +
						'<img src="http://' + location.hostname + '/20141224-01/extend_project/w945/img/card/common/bg_card_skill.png" style="position:relative; left:6px; z-index:-1">' +
						'<ul id="skillFrame" style="position:relative; top:-82px; left:14px; font-size:12px;"></ul>' +
					'</span>'
				);
			} else {
				j$("div[class*=card rarerity] span[class=status_frontback]").parent().after(
					'<span style="position:relative; top:-125px;">' +
						'<img src="http://' + location.hostname + '/20141224-01/extend_project/w945/img/card/common/bg_card_skill.png" style="position:relative; left:6px; z-index:-1">' +
						'<ul id="skillFrame" style="position:relative; top:-82px; left:14px; font-size:12px;"></ul>' +
					'</span>'
				);
			}
		}

		// デッキ特別処理
		var SukesukeFlg = OPT_OTHER[107];
		if( location.pathname == "/card/deck.php"){
			// ステータス強化ボタンの位置を移動
			j$("img[class=levelup]").css({"position":"relative", "top":"-80px", "left":"6px"});

			// スケスケ指定時はステータス強化ボタンを透明化
			if(SukesukeFlg == 1){
				j$("img[class=levelup]").css("opacity", "0.5");
			}
		}

		// 所持スキルを表示
		if( location.pathname == "/user/" || location.pathname == "/card/deck.php"	|| location.pathname == "/card/trade_card.php"){
			// プロフィール画面、デッキ画面
			j$("div[class*=cardWrapper]").each(
				function(){
					var skillText = "";
					j$("ul[class=back_skill] span[class*=skillName]", this).each(
						function(){
							skillText = skillText + "<li style='margin-top:3px !important;'>" + j$(this).text() + "</li>";
						}
					);
					j$("#skillFrame", this).html(skillText);
				}
			);
		} else if(location.pathname.match(/union/)) {
			// 合成画面
			if(location.pathname == "/union/learn.php") {
				j$("div[class*=cardWrapper] ul[class=front_skill]").remove();
			}
		}
	}

	//----------------------------------
	// 合成スキル表示
	//----------------------------------
	function bro3dasuDrawCompositionSkill() {
		// 合成スキル枠
		if (location.pathname == "/union/learn.php") {
			j$("div[id=card_uraomote] div[class*=card rarerity] span[class=status_frontback]").parent().after(
				'<span style="position:relative; top:-194px;">' +
					'<img src="http://' + location.hostname + '/20141224-01/extend_project/w945/img/card/common/bg_card_skill.png" style="position:relative; top:70px; left:6px; z-index:-1">' +
					'<ul id="compositFrame" style="position:relative; top:-10px; left:14px; font-size:12px;"></ul>' +
				'</span>'
			);
		} else if (location.pathname == "/busyodas/busyodas_result.php" || location.pathname == "/busyodas/busyodas_continuty_result.php"){
			j$("div[class=getCardInfoArea] div[class*=card rarerity] span[class=status_frontback]").parent().after(
				'<span style="position:relative; top:-125px;">' +
					'<img src="http://' + location.hostname + '/20141224-01/extend_project/w945/img/card/common/bg_card_skill.png" style="position:relative; left:6px; z-index:-1">' +
					'<ul id="compositFrame" style="position:relative; top:-82px; left:14px; font-size:12px;"></ul>' +
				'</span>'
			);
		} else if (location.pathname == "/card/trade.php"){
			j$("div[class*=card rarerity] span[class=status_frontback]").parent().after(
				'<span style="position:relative; top:-125px;">' +
					'<img src="http://' + location.hostname + '/20141224-01/extend_project/w945/img/card/common/bg_card_skill.png" style="position:relative; left:6px; z-index:-1">' +
					'<ul id="compositFrame" style="position:relative; top:-82px; left:14px; font-size:12px;"></ul>' +
				'</span>'
			);
		} else if (location.pathname == "/card/trade_card.php"){
			j$("div[class*=card rarerity] span[class=status_frontback]").parent().after(
				'<span style="position:relative; top:-227px;">' +
					'<img src="http://' + location.hostname + '/20141224-01/extend_project/w945/img/card/common/bg_card_skill.png" style="position:relative; left:6px; z-index:-1">' +
					'<ul id="compositFrame" style="position:relative; top:-82px; left:14px; font-size:12px;"></ul>' +
				'</span>'
			);
		} else {
			j$("div[class*=card rarerity] span[class=status_frontback]").parent().after(
				'<span style="position:relative; top:-211px;">' +
					'<img src="http://' + location.hostname + '/20141224-01/extend_project/w945/img/card/common/bg_card_skill.png" style="position:relative; left:6px; z-index:-1">' +
					'<ul id="compositFrame" style="position:relative; top:-82px; left:14px; font-size:12px;"></ul>' +
				'</span>'
			);
		}

		// 合成スキル算出
		if (location.pathname != "/union/learn.php") {
			j$("div[class*=cardWrapper]").each(
				function(){
					var skill1NameInfo = j$("ul[class=back_skill] span[class*=skillName1 skill_name]", this);
					var cardName = j$("div[class*=omote_4sk] div[class=name] span[class=name]", this).text();
					if (skill1NameInfo.length != 0) {
						var compositionText = "";
						var skill1Info = skill1NameInfo.text().match(/[:：](.*)LV/);
						if (skill1Info == null) {
							compositionText = "<li style='margin-top:3px !important;'>合成表なし</li><li style='margin-top:3px !important;'>　</li><li style='margin-top:3px !important;'>　</li><li style='margin-top:3px !important;'>　</li>";
						} else {
							var skill1 = RegExp.$1.replace(/(^\s+)|(\s+$)/g, "");;
							if (typeof gousei_skill[skill1] != 'undefined') {
								for(var i = 0; i <=3; i++){
									var compSkill = gousei_skill[skill1][i];
									compositionText = compositionText + "<li style='margin-top:3px !important;'>" + gousei_skill[skill1][i] + "</li>";
								}
							} else {
								compositionText = "<li style='margin-top:3px !important;'>合成表なし</li><li style='margin-top:3px !important;'>　</li><li style='margin-top:3px !important;'>　</li><li style='margin-top:3px !important;'>　</li>";
							}

							if (cardName.indexOf("パンダ") > 0) {
								compositionText = "<li style='margin-top:3px !important;'>" + skill1 + "</li><li style='margin-top:3px !important;'>　</li><li style='margin-top:3px !important;'>　</li><li style='margin-top:3px !important;'>　</li>";
							}
						}
						j$("#compositFrame", this).html(compositionText);
					}
				}
			);
		} else {
			// 付与合成

			// ベースカードの情報取得
			var baseLv = j$("#bacecard div[class=level] span").text();
			var baseScoreInfo = j$("#bacecard span[class=score]").text().match(/スコア:(\d+)$/);
			var baseScore = RegExp.$1;
			var baseSkill = [];
			j$("#bacecard ul[class=back_skill] span[class*=skillName]").each(
				function(){
					var skillText = j$(this).text().match(/[：:](.*)LV/);
					if(skillText != null){
						baseSkill.push(RegExp.$1.replace(/(^\s+)|(\s+$)/g, ""));
					}
				}
			);

			// 素材カードの情報取得
			j$("#cardFileList div[class=cardColmn]").each(
				function() {
					var cardNo = j$("span[class=cardno]", this).text();
					var cardName = j$("span[class=name]", this).text();
					var level = j$("div[class=level] span", this).text();
					var scoreInfo = j$("span[class=score]", this).text().match(/スコア:(\d+)$/);
					var score = RegExp.$1;
					var att = parseFloat(j$("li[class=status_att]", this).text());
					var wdef = parseFloat(j$("li[class=status_wdef]", this).text());
					var int = parseFloat(j$("li[class=status_int]", this).text());

					// 合成確率算出
					var compositionText = "";
					var result = calcCompositionSkillRate(baseLv, baseScore, baseSkill, cardNo, cardName, level, score, att, wdef, int);
					if(result == null) {
						compositionText = "<li style='margin-top:3px !important;'>合成表なし</li><li style='margin-top:3px !important;'></li><li style='margin-top:3px !important;'></li><li style='margin-top:3px !important;'></li>";
					} else {
						for(var i = 0; i < result.length; i++) {
							compositionText = compositionText + "<li style='margin-top:3px !important; font-size:8pt;'>" + result[i].n + ":" + result[i].skill + "&nbsp;" + result[i].probability + "%</li>";
						}
					}

					// 画面描画
					j$("#compositFrame", this).html(compositionText);
					j$("div[class=control]", this).css("z-index", "5000");
				}
			);
		}
	}

	//----------------------------------
	// 合成スキル確率算出
	//----------------------------------
	function calcCompositionSkillRate(baseLv, baseScore, baseSkills, useCardNo, useCardName, useLv, useScore, useAtk, useDef, useInt) {
		// 基礎確率の算出
		if (typeof card_list[useCardNo] == 'undefined') {
			return null;
		}

		// 合計LV・スコアの計算
		var total_lv	= parseInt(baseLv) + parseInt(useLv);
		var total_score = parseInt(baseScore) + parseInt(useScore);

		var score_table = 0;
		var lv_table	= 0;
		for (var x = 0; x < scr_list.length; x++) {
			if (scr_list[x][0] > total_score) {
				break;
			}
		}
		score_table = x;

		for (var x = 0; x < lv_list.length; x++) {
			if (lv_list[x][0] > total_lv) {
				break;
			}
		}

		lv_table = x;
		var probability = [ 0.00, 0.00, 0.00 ,0.00 ];
		probability[0] = (parseFloat( (1 - parseFloat(scr_list[score_table][1] / 100)) * parseFloat(lv_list[lv_table][1] / 100)) * 100).toFixed(2);	// 大
		probability[1] = (parseFloat( (1 - parseFloat(scr_list[score_table][1] / 100)) * parseFloat(lv_list[lv_table][2] / 100)) * 100).toFixed(2);	// 中
		probability[2] = (parseFloat( (1 - parseFloat(scr_list[score_table][1] / 100)) * parseFloat(lv_list[lv_table][3] / 100)) * 100).toFixed(2);	// 小
		probability[3] = (parseFloat( (1 - parseFloat(scr_list[score_table][1] / 100)) * parseFloat(lv_list[lv_table][4] / 100)) * 100).toFixed(2);	// 隠

		// 1ポイントあたりのステータス増分計算
		var pointAtk = parseFloat(card_list[useCardNo].a)  * 0.094;		// 攻撃
		var pointDef = parseFloat(card_list[useCardNo].d1) * 0.094;		// 防御
		var pointInt = parseFloat(card_list[useCardNo].i)  * 0.0016;		// 知力

		// 実際に割り振ったポイント数の計算
		var AlloPointAtk = parseInt((useAtk - parseFloat(card_list[useCardNo].a))  / pointAtk + 0.5);		// 攻撃
		var AlloPointDef = parseInt((useDef - parseFloat(card_list[useCardNo].d1)) / pointDef + 0.5);		// 防御
		var AlloPointInt = parseInt((useInt - parseFloat(card_list[useCardNo].i))  / pointInt + 0.5);		// 知力

		// 合成レシピ並び替え用配列
		var SkillArray = [];

		// 合成レシピと割り当てポイント数を配列に入れる
		if (useCardNo > 9000) {
			var panda_probability = 100;
			if (useCardName.indexOf("中指南") >= 0) {
				panda_probability = 50;
			} else if(useCardName.indexOf("小指南") >= 0) {
				panda_probability = 25;
			}
			for (var k = 0; k < 4; k++ ){
				probability[k] = panda_probability;
			}

			SkillArray.push( {"point":0, "n":"攻", "skill": card_list[useCardNo].bs, "probability":0.00, "flg":3 });		// 攻撃
			SkillArray.push( {"point":0, "n":"防", "skill": card_list[useCardNo].bs, "probability":0.00, "flg":2 });		// 防御
			SkillArray.push( {"point":0, "n":"知", "skill": card_list[useCardNo].bs, "probability":0.00, "flg":1 });		// 知力
			SkillArray.push( {"point":0, "n":"隠", "skill": card_list[useCardNo].bs, "probability":0.00, "flg":0 });		//
		}
		else {
			SkillArray.push( {"point":AlloPointAtk, "n":"攻", "skill": gousei_skill[card_list[useCardNo].bs][0], "probability":0.00, "flg":3 });		// 攻撃
			SkillArray.push( {"point":AlloPointDef, "n":"防", "skill": gousei_skill[card_list[useCardNo].bs][1], "probability":0.00, "flg":2 });		// 防御
			SkillArray.push( {"point":AlloPointInt, "n":"知", "skill": gousei_skill[card_list[useCardNo].bs][2], "probability":0.00, "flg":1 });		// 知力
			SkillArray.push( {"point":0,			"n":"隠", "skill": gousei_skill[card_list[useCardNo].bs][3], "probability":0.00, "flg":0 });		//
		}

		SkillArray.sort(
			function(a,b){
				if(a.point < b.point) return 1;
				if(a.point > b.point) return -1;
				if(a.flg   < b.flg	) return 1;
				if(a.flg   > b.flg	) return -1;
				return 0;
			}
		);

		// 合成確率を代入
		for (var x = 0; x < 3; x++) {
			SkillArray[x].probability = parseFloat(probability[x]);
		}
		// 合成確率でソート
		SkillArray.sort(
			function(a,b){
				if(a.probability < b.probability) return 1;
				if(a.probability > b.probability) return -1;
				return 0;
			}
		);
		// 隠しの合成確率は最後に代入 2013.01.18 追加
		SkillArray[3].probability = parseFloat(probability[3]);

		// 合成元カードに存在するスキルは表示しない
		var result = [];
		for (var x = 0; x < 4; x++) {
			var found = false;
			for (var j = 0; j < baseSkills.length; j++) {
				if(SkillArray[x].skill == baseSkills[j]) {
					found = true;
					break;
				}
			}
			if(found == false){
				result.push(SkillArray[x]);
			}
		}

		return result;
	}

	//---------------------------------------
	// 自動ブショーダス破棄チェック
	//---------------------------------------
	function bro3dasuBusyodasDestructionCheck(){
		if(location.pathname == "/busyodas/busyodas_continuty_result.php"){
			j$("div[class=getCardInfoArea] div[id*=cardWindow_]").each(
				function(){
					var cardNo = j$("span[class=cardno]", this).text();
					if(checkDestruction(cardNo) == 1) {
						j$("input[class=delete]", j$(this).parent().parent()).attr("checked", true);
					}
				}
			);
		} else {
			j$("div[class=getCardInfoArea] div[id*=cardWindow_]").each(
				function(){
					var cardNo = j$("span[class=cardno]", this).text();
					if(checkDestruction(cardNo) == 1) {
						j$("div[class=getCardInfoArea] input[class=delete]").attr("checked", true);
					}
				}
			);
		}
	}

	//---------------------------------------
	// 一括破棄画面破棄チェック
	//---------------------------------------
	function bro3dasuDropListDestructionCheck(){
		j$("table[class=tradeTables] td[class=busho]").each(
			function(){
				var cardNo = j$("span[class=cardno]", this).text();
				var expText = j$("div[class=ex] span[class=ex_now]", this).text();
				var scoreText = j$("span[class=score]", this).text();
				var expInfo = expText.match(/:(\d+)$/);
				if(expInfo == null) {
					return;
				}
				var exp = RegExp.$1;
				var scoreInfo = scoreText.match(/:(\d+)$/);
				if(scoreInfo == null) {
					return;
				}
				var score = RegExp.$1;
				if(parseInt(score) == 0 && parseInt(exp) ==0 && checkDestruction(cardNo) == 1) {
					j$("input[name*=card_id]", j$(this).parent()).attr("checked", true);
				}
			}
		);
	}

	// =================================================================================================================================================================================
	// サブルーチン
	// =================================================================================================================================================================================

	function addOpenSettingHtml() {


		var sidebar = d.evaluate('//*[@id="busyodasTab"]',d, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);


		//自動ダス設定リンク
		var addOpenSetting = d.createElement("input");
		addOpenSetting.id = "OpenSetting";

		addOpenSetting.type = "button";
		addOpenSetting.value = "自動ダス設定";
		addOpenSetting.href = "javascript:void(0);";
		addOpenSetting.style.marginTop = "5px";
		addOpenSetting.style.marginLeft = "0px";
		addOpenSetting.style.marginLeft = "200px";	  // 2014.06.25
		addOpenSetting.style.marginBottom = "5px";
		addOpenSetting.style.color = "#000000";
		addOpenSetting.style.cursor = "pointer";

		addOpenSetting.addEventListener("click", function() {

			LoadSettingBox();	   // 設定をロード

			closeSettingBox();
			openSettingBilderBox();
		}, true);

		sidebar.snapshotItem(0).appendChild(addOpenSetting);

		//ノーマル実行リンク
		if ( d.body.innerHTML.match(/busyodasNormalTabCurrent/) ) {
			var addStart1 = d.createElement("input");
			addStart1.id = "OpenSetting";
			addStart1.type = "button";
			addStart1.value = "　自動ダス実行　";
			addStart1.href = "javascript:void(0);";
			addStart1.style.marginTop = "0px";
			addStart1.style.marginLeft = "10px";
			addStart1.style.color = "#000000";
			addStart1.style.cursor = "pointer";

			addStart1.addEventListener("click", function() {

				LoadSettingBox();	   // 設定をロード

				var p = parseInt(j$("div[class=busyodasCurrency] dd").eq(0).text());
				j$("div[class=sysMes busyodasCardInfo]").text().match(/残り(\d+)枚/);	   // 2013.01.17 修正
				var q = parseInt(RegExp.$1);

				DrawResult = ["","","","","","","","","",""];
				autoDasu(p, q, "0", "0", 0);
			}, true);

			sidebar.snapshotItem(0).appendChild(addStart1);
		}

		//ブショーダス小麗・大鳳実行リンク
		if ( d.body.innerHTML.match(/busyodasTenTabCurrent/) ) {
			var addStart1 = d.createElement("input");
			addStart1.id = "OpenSetting";
			addStart1.type = "button";
			addStart1.value = "　自動ダス実行（小麗）　";
			addStart1.href = "javascript:void(0);";
			addStart1.style.marginTop = "0px";
			addStart1.style.marginLeft = "10px";
			addStart1.style.color = "#000000";
			addStart1.style.cursor = "pointer";

			addStart1.addEventListener("click", function() {

				LoadSettingBox();	   // 設定をロード

				var p = parseInt(j$("div[class=busyodasCurrency] dd").eq(2).text());   // 2が小麗, 1が大鳳
				j$("div[class=sysMes busyodasCardInfo]").text().match(/残り(\d+)枚/);	   // 2013.01.17 修正
				var q = parseInt(RegExp.$1);

				DrawResult = ["","","","","","","","","",""];
				autoDasu(p, q, "0", "0", 700);	 // got_type 700は小麗
			}, true);

			sidebar.snapshotItem(0).appendChild(addStart1);

			var assStart2 = d.createElement("input");
			assStart2.id = "OpenSetting";
			assStart2.type = "button";
			assStart2.value = "　自動ダス実行（大鳳）　";
			assStart2.href = "javascript:void(0);";
			assStart2.style.marginTop = "0px";
			assStart2.style.marginLeft = "10px";
			assStart2.style.color = "#000000";
			assStart2.style.cursor = "pointer";

			assStart2.addEventListener("click", function() {

				LoadSettingBox();	   // 設定をロード

				var p = parseInt(j$("div[class=busyodasCurrency] dd").eq(1).text());   // 2が小麗, 1が大鳳
				j$("div[class=sysMes busyodasCardInfo]").text().match(/残り(\d+)枚/);	   // 2013.01.17 修正
				var q = parseInt(RegExp.$1);

				DrawResult = ["","","","","","","","","",""];
				autoDasu(p, q, "0", "0", 600);	 // got_type 600は大鳳
			}, true);

			sidebar.snapshotItem(0).appendChild(assStart2);
		}
	}


	function autoDasu(total_bp, zan_maisu, hakiid, oldcardno, got_type){

		var maisu;
		if (got_type == 0) {
			if (total_bp / 100 >= zan_maisu) {
				maisu = zan_maisu;
			} else {
					maisu = parseInt(total_bp / 100)
			}
		} else {
			// 小麗、大鳳はtotal_bpに枚数がはいる
			if (total_bp > zan_maisu) {
				maisu = zan_maisu;
			} else {
				maisu = parseInt(total_bp)
			}
		}

		j$("input[name=送信]").attr("onClick").split(",")[2].match(/\'([a-z0-9]+)\'/);
		var ssid = RegExp.$1;

		// 引ける枚数が０枚で破棄カードがある場合
		if (maisu <= 0) {
			// 履歴をインクリメント
			for (i=9;i>0;i--){	DrawResult[i] = DrawResult[i-1];	}
			DrawResult[0] = "自動ブショーダスを終了しました。<br>";
			var ViewDrawResult = "";
			// 表示データを作成
			for (i=0;i<10;i++){ ViewDrawResult += DrawResult[i];	}
				j$("#CardInfo").html(ViewDrawResult);
			if (hakiid != 0 && got_type == 0) {
				var c = {};
				c['label['	+ hakiid + ']']		 = "";
				c['delete[' + hakiid + ']']		 = hakiid;
				c['ssid']						   = ssid;
				c['send']						   = "send";
				if (got_type == 600 || got_type == 700) {
					c['tab']					= "ten";
				} else {
					c['tab']					= "normal";
				}
				c['mode']						   = "delete";
				c['card']						   = hakiid;
				c['got_type']					   = got_type;
				j$.post("http://" + HOST + "/busyodas/busyodas.php", c, function () {
					location.href = "http://" + HOST + "/busyodas/busyodas.php";
					return;
				})
			} else {
				if( got_type == 0 ) {
					location.href = "http://" + HOST + "/busyodas/busyodas.php";
				}
				return;
			}
		}

		// カードを１枚引く
		var c={};
		c['ssid'] = ssid;
		c['send'] = 'send';
		c['got_type'] = got_type;
		if (got_type == 600 || got_type == 700) {
			c['tab'] = "ten";
		} else {
			c['tab'] = "normal";
		}

		if (hakiid > 0) {
			c['label['	+ hakiid + ']'] = "";
			c['delete[' + hakiid + ']'] = hakiid;
			c['card']		   = hakiid;
		}
		// ここまで

		j$(document.body).append("<div id=AjaxTempDOM>");
		j$("#AjaxTempDOM").hide();
		j$("#AjaxTempDOM").load("http://" + HOST + "/busyodas/busyodas.php #gray02Wrapper", c, function () {

			// 2013.01.17 修正
			var a = j$("input[class=delete]", this).attr("value");
			var cardno = j$("span[class=cardno]", this).eq(0).text();
			var rate = j$("span[class=rarerity] img", this).eq(0).attr("title");
			var name = j$("span[class=name]", this).eq(0).text();
			var cost = parseFloat(j$("span[class=cost]", this).eq(0).text());
			var intelligence = parseFloat(j$("ul[class=status] li[class=status_int]").eq(0).text());

			// 2013.01.17 ここまで
				var h = " が当たりました!";

				var j = 0;			  // 破棄カード
				var l = 0;			  // 減少BP
				var m = 0;			  // カード増加枚数

			if (checkDestruction(cardno) == 0) {
				if (got_type == 0) {
					l = 100;			// 減少BP
				} else {
					l = 1;				// 減るチケット
				}
				m = 1;			  // カード増加枚数
				h = " が当たりました！";
			} else {
				j = a;
				if (got_type == 0) {
					l = 70;			// 減少BP（破棄するために30BPは増える)
				} else {
					l = 1;			// チケは破棄しても枚数は増えない
				}
				m = 0;			  // カード増加枚数（破棄するから0枚増加)
				h = " を自動削除しました！";

			}

			if ( got_type == 0 ){
				h += "</td><td width=300>  保持BP:" + total_bp + " 残" + zan_maisu + "枚 破棄ID:" + hakiid; // 2013.01.17 修正
			} else {
				h += "</td><td width=300>  保持チケット:" + total_bp + " 残" + zan_maisu + "枚 破棄ID:" + hakiid; // 2013.01.17 修正
			}
			for (i=9;i>0;i--){
				DrawResult[i] = DrawResult[i-1];
			}
			// 2013.01.17 修正
				if (rate == "C")			{	DrawResult[0] = "<center><table><tr><td width=30><span id=card_rarityC>"  + '<font style="color:#000000; font-weight: bold;">' + rate + "</font></span></td><td width=140>" + name + " (No." + cardno + ")</td><td width=180><span id=result_msg>" + h + "</span></td></tr></table></center>";
				} else if (rate == "UC")	{	DrawResult[0] = "<center><table><tr><td width=30><span id=card_rarityUC>" + '<font style="color:#ffa200; font-weight: bold;">' + rate + "</font></span></td><td width=140>" + name + " (No." + cardno + ")</td><td width=180><span id=result_msg>" + h + "</span></td></tr></table></center>";
				} else if (rate == "R")	 {	 DrawResult[0] = "<center><table><tr><td width=30><span id=card_rarityR>"  + '<font style="color:#00c5ff; font-weight: bold;">' + rate + "</font></span></td><td width=140>" + name + " (No." + cardno + ")</td><td width=180><span id=result_msg>" + h + "</span></td></tr></table></center>";
				} else if (rate == "SR")	{	DrawResult[0] = "<center><table><tr><td width=30><span id=card_raritySR>" + '<font style="color:#ff4242; font-weight: bold;">' + rate + "</font></span></td><td width=140>" + name + " (No." + cardno + ")</td><td width=180><span id=result_msg>" + h + "</span></td></tr></table></center>";
				} else {						DrawResult[0] = "<center><table><tr><td width=30><span id=card_rarity>"   + '<font style="color:#f236fe; font-weight: bold;">' + rate + "</font></span></td><td width=140>" + name + " (No." + cardno + ")</td><td width=180><span id=result_msg>" + h + "</span></td></tr></table></center>";
				}
			// ここまで
			var ViewDrawResult = "";
			for (i=0;i<10;i++){
				ViewDrawResult += DrawResult[i];
			}

				j$("#CardInfo").html(ViewDrawResult);
				setTimeout(function () {
				autoDasu(total_bp - l, zan_maisu - m, j, cardno, got_type)
			}, 1000)

		});
	}

	function addSettingHtml(vId) {

		var popupLeft = GM_getValue(location.hostname + PGNAME + "_popup_left", 10);
		var popupTop  = GM_getValue(location.hostname + PGNAME + "_popup_top", 10);
		if (popupLeft < 0) popupLeft = 0;
		if (popupTop < 0) popupTop = 0;


		//表示コンテナ作成
		var SettingContainer = d.createElement("div");
		SettingContainer.id = "SettingContainer";
		SettingContainer.style.position = "absolute";
		SettingContainer.style.color = COLOR_BASE;
		SettingContainer.style.backgroundColor = COLOR_FRAME;
		SettingContainer.style.opacity= 1.0;
		SettingContainer.style.border = "solid 2px black";
		SettingContainer.style.left = popupLeft + "px";
		SettingContainer.style.top = popupTop + "px";
		SettingContainer.style.fontSize = "10px";
		SettingContainer.style.fontFamily = "ＭＳ ゴシック";
		SettingContainer.style.padding = "2px";
		SettingContainer.style.MozBorderRadius = "4px";
		SettingContainer.style.zIndex = 50000;


		SettingContainer.setAttribute('vId', vId);
		d.body.appendChild(SettingContainer);

		$e(SettingContainer, "mousedown", function(event){
			if( event.target != $("SettingContainer")) {return false;}
			g_MD="SettingContainer";
			g_MX=event.pageX-parseInt(this.style.left,10);
			g_MY=event.pageY-parseInt(this.style.top,10);
			event.preventDefault();
		});

		$e(d, "mousemove", function(event){
			if(g_MD != "SettingContainer") return true;
			var SettingContainer = $("SettingContainer");
			if( !SettingContainer ) return true;
			var popupLeft = event.pageX - g_MX;
			var popupTop = event.pageY - g_MY;
			SettingContainer.style.left = popupLeft + "px";
			SettingContainer.style.top = popupTop + "px";
			//ポップアップ位置を永続保存
			GM_setValue(location.hostname + PGNAME + "_popup_left", popupLeft);
			GM_setValue(location.hostname + PGNAME + "_popup_top", popupTop);
		});

		$e(d, "mouseup", function(event){ g_MD=""; });

		var title = d.createElement("span");
		title.style.color = "#FFFFFF";
		title.style.font = 'bold 120% "ＭＳ ゴシック"';
		title.style.margin = "2px";
		title.innerHTML = "Auto Bushou Das ";

		var version = d.createElement("span");
		version.style.color = COLOR_TITLE;
		version.style.font = '96% "ＭＳ ゴシック"';
		version.style.margin = "2px";
		version.innerHTML = " Ver." + VERSION;

		var storageLimit = d.createElement("span");
		storageLimit.style.color = "#FFFFFF";
		storageLimit.style.font = '110% "ＭＳ Ｐゴシック"';
		storageLimit.style.margin = "2px";

		SettingContainer.appendChild(title);
		SettingContainer.appendChild(version);

		// ===== 攻撃系 =====
		var Attack_Box = d.createElement("table");
			Attack_Box.style.border = "solid 2px black";
			Attack_Box.style.margin = "0px 4px 4px 0px";
			Attack_Box.style.width = "100%";

		var tr1 = d.createElement("tr");
		var td1 = d.createElement("td");	td1.colSpan = 5;	td1.style.backgroundColor = COLOR_TITLE;	ccreateText(td1, "dummy", "■ 攻撃系 ■", 0 );
		var tr2 = d.createElement("tr");	tr2.style.backgroundColor = COLOR_BACK;	 tr2.style.border = "solid 1px black";
		var td21 = d.createElement("td");	td21.style.padding = "3px";		 td21.style.verticalAlign = "top";	 td21.style.width = "120px";
		var td22 = d.createElement("td");	td22.style.padding = "3px";		 td22.style.verticalAlign = "top";	 td22.style.width = "120px";
		var td23 = d.createElement("td");	td23.style.padding = "3px";		 td23.style.verticalAlign = "top";	 td23.style.width = "120px";
		var td24 = d.createElement("td");	td24.style.padding = "3px";		 td24.style.verticalAlign = "top";	 td24.style.width = "120px";
		var td25 = d.createElement("td");	td25.style.padding = "3px";		 td25.style.verticalAlign = "top";	 td25.style.width = "120px";

		Attack_Box.appendChild(tr1);
		tr1.appendChild(td1);
		Attack_Box.appendChild(tr2);
		tr2.appendChild(td21);
		tr2.appendChild(td22);
		tr2.appendChild(td23);
		tr2.appendChild(td24);
		tr2.appendChild(td25);

		ccreateCheckBox(td21, "OPT_DOME1" , OPT_DOME[1] , " 剣兵の進撃 ", "剣兵の進撃を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME2" , OPT_DOME[2] , " 騎兵の進撃 ", "騎兵の進撃を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME3" , OPT_DOME[3] , " 槍兵の進撃 ", "槍兵の進撃を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME4" , OPT_DOME[4] , " 弓兵の進撃 ", "弓兵の進撃を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td25, "OPT_DOME5" , OPT_DOME[5] , " 兵器の進撃 ", "兵器の進撃を付与・LVUPできる武将を残します。", 0);

		ccreateCheckBox(td21, "OPT_DOME6"  , OPT_DOME[6]  , " 剣兵の強撃 ", "剣兵の強撃を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME7"  , OPT_DOME[7]  , " 騎兵の強撃 ", "騎兵の強撃を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME8"  , OPT_DOME[8]  , " 槍兵の強撃 ", "槍兵の強撃を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME9"  , OPT_DOME[9]  , " 弓兵の強撃 ", "弓兵の強撃を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td25, "OPT_DOME10" , OPT_DOME[10] , " 兵器の強撃 ", "兵器の強撃を付与・LVUPできる武将を残します。", 0);

		ccreateCheckBox(td21, "OPT_DOME11" , OPT_DOME[11] , " 剣兵の猛撃 ", "剣兵の猛撃を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME12" , OPT_DOME[12] , " 騎兵の猛撃 ", "騎兵の猛撃を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME13" , OPT_DOME[13] , " 槍兵の猛撃 ", "槍兵の猛撃を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME14" , OPT_DOME[14] , " 弓兵の猛撃 ", "弓兵の猛撃を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td25, "OPT_DOME15" , OPT_DOME[15] , " 兵器の猛撃 ", "兵器の猛撃を付与・LVUPできる武将を残します。", 0);

		ccreateCheckBox(td21, "OPT_DOME16" , OPT_DOME[16] , " 剣兵の極撃 ", "剣兵の極撃を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME17" , OPT_DOME[17] , " 騎兵の極撃 ", "騎兵の極撃を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME18" , OPT_DOME[18] , " 槍兵の極撃 ", "槍兵の極撃を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME19" , OPT_DOME[19] , " 弓兵の極撃 ", "弓兵の極撃を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td25, "OPT_DOME20" , OPT_DOME[20] , " 兵器の極撃 ", "兵器の極撃を付与・LVUPできる武将を残します。", 0);

		ccreateCheckBox(td21, "OPT_DOME21" , OPT_DOME[21] , " 剣兵突撃 ", "剣兵突撃を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME22" , OPT_DOME[22] , " 騎兵突撃 ", "騎兵突撃を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME23" , OPT_DOME[23] , " 槍兵突撃 ", "槍兵突撃を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME24" , OPT_DOME[24] , " 弓兵突撃 ", "弓兵突撃を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td25, "OPT_DOME25" , OPT_DOME[25] , " 兵器突撃 ", "兵器突撃を付与・LVUPできる武将を残します。", 0);

		ccreateCheckBox(td21, "OPT_DOME26" , OPT_DOME[26] , " 剣兵突覇 ", "剣兵突覇を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME27" , OPT_DOME[27] , " 騎兵突覇 ", "騎兵突覇を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME28" , OPT_DOME[28] , " 槍兵突覇 ", "槍兵突覇を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME29" , OPT_DOME[29] , " 弓兵突覇 ", "弓兵突覇を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td25, "OPT_DOME30" , OPT_DOME[30] , " 兵器突覇 ", "兵器突覇を付与・LVUPできる武将を残します。", 0);

		ccreateCheckBox(td21, "OPT_DOME31" , OPT_DOME[31] , " 剣兵の進攻 ", "剣兵の進攻を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME32" , OPT_DOME[32] , " 騎兵の進攻 "	, "騎兵の進攻を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME33" , OPT_DOME[33] , " 槍兵の進攻 "	, "槍兵の進攻を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME34" , OPT_DOME[34] , " 弓兵の進攻 "	, "弓兵の進攻を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td25, "OPT_DOME35" , OPT_DOME[35] , " 兵器の進攻 "	, "兵器の進攻を付与・LVUPできる武将を残します。", 0);

		ccreateCheckBox(td21, "OPT_DOME36" , OPT_DOME[36] , " 剣兵速攻 ", "剣兵速攻を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME37" , OPT_DOME[37] , " 騎兵速攻 "  , "騎兵速攻を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME38" , OPT_DOME[38] , " 槍兵速攻 "  , "槍兵速攻を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME39" , OPT_DOME[39] , " 弓兵速攻 "  , "弓兵速攻を付与・LVUPできる武将を残します。", 0);
			ccreateText(td25, "OPT_DOME40" , " 　 "		 , "", 0);

		ccreateCheckBox(td21, "OPT_DOME41" , OPT_DOME[41] , " 奇計百出 "	, "奇計百出を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME42" , OPT_DOME[42] , " 英雄 "		, "英雄を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME43" , OPT_DOME[43] , " 覇道 "		, "覇道を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME44" , OPT_DOME[44] , " 豪傑 "		, "豪傑を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td25, "OPT_DOME45" , OPT_DOME[45] , " 一騎当千 "	, "一騎当千を付与・LVUPできる武将を残します。", 0);

		ccreateCheckBox(td21, "OPT_DOME46" , OPT_DOME[46] , " 蛮族の襲撃 "	, "蛮族の襲撃を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME47" , OPT_DOME[47] , " 蛮王の襲撃 "	, "蛮王の襲撃を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME48" , OPT_DOME[48] , " 趁火打劫 "	, "趁火打劫を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME49" , OPT_DOME[49] , " 闘将突貫 "  , "闘将突貫を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td25, "OPT_DOME50" , OPT_DOME[50] , " 謀反の進攻 "	, "謀反の進攻を付与・LVUPできる武将を残します。", 0);

		// ===== 防御系 =====
		var Defense_Box = d.createElement("table");
			Defense_Box.style.border = "solid 2px black";
			Defense_Box.style.margin = "0px 4px 4px 0px";
			Defense_Box.style.width = "100%";

		var tr1 = d.createElement("tr");
		var td1 = d.createElement("td");	td1.colSpan = 5;	td1.style.backgroundColor = COLOR_TITLE;	ccreateText(td1, "dummy", "■ 防御系 ■", 0 );
		var tr2 = d.createElement("tr");	tr2.style.backgroundColor = COLOR_BACK;	 tr2.style.border = "solid 1px black";
		var td21 = d.createElement("td");	td21.style.padding = "3px";	 td21.style.verticalAlign = "top";	 td21.style.width = "120px";
		var td22 = d.createElement("td");	td22.style.padding = "3px";	 td22.style.verticalAlign = "top";	 td22.style.width = "120px";
		var td23 = d.createElement("td");	td23.style.padding = "3px";	 td23.style.verticalAlign = "top";	 td23.style.width = "120px";
		var td24 = d.createElement("td");	td24.style.padding = "3px";	 td24.style.verticalAlign = "top";	 td24.style.width = "120px";
		var td25 = d.createElement("td");	td25.style.padding = "3px";	 td25.style.verticalAlign = "top";	 td25.style.width = "120px";

		Defense_Box.appendChild(tr1);
		tr1.appendChild(td1);
		Defense_Box.appendChild(tr2);
		tr2.appendChild(td21);
		tr2.appendChild(td22);
		tr2.appendChild(td23);
		tr2.appendChild(td24);
		tr2.appendChild(td25);

		ccreateCheckBox(td21, "OPT_DOME61" , OPT_DOME[61] , " 剣兵防御 ", "剣兵防御を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME62" , OPT_DOME[62] , " 騎兵防御 ", "騎兵防御を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME63" , OPT_DOME[63] , " 槍兵防御 ", "槍兵防御を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME64" , OPT_DOME[64] , " 弓兵防御 ", "弓兵防御を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td25, "OPT_DOME65" , OPT_DOME[65] , " 兵器防御 ", "兵器防御を付与・LVUPできる武将を残します。", 0);

		ccreateCheckBox(td21, "OPT_DOME66" , OPT_DOME[66] , " 剣兵方陣 ", "剣兵方陣を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME67" , OPT_DOME[67] , " 騎兵方陣 ", "騎兵方陣を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME68" , OPT_DOME[68] , " 槍兵方陣 ", "槍兵方陣を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME69" , OPT_DOME[69] , " 弓兵方陣 ", "弓兵方陣を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td25, "OPT_DOME70" , OPT_DOME[70] , " 兵器方陣 ", "兵器方陣を付与・LVUPできる武将を残します。", 0);

		ccreateCheckBox(td21, "OPT_DOME71" , OPT_DOME[71] , " 剣兵の聖域 ", "剣兵の聖域を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME72" , OPT_DOME[72] , " 騎兵の聖域 ", "騎兵の聖域を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME73" , OPT_DOME[73] , " 槍兵の聖域 ", "槍兵の聖域を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME74" , OPT_DOME[74] , " 弓兵の聖域 ", "弓兵の聖域を付与・LVUPできる武将を残します。", 0);
			ccreateText(td25, "OPT_DOME75" , " 　 "		 , "", 0);

		ccreateCheckBox(td21, "OPT_DOME76" , OPT_DOME[76] , " 剣兵堅守 ", "剣兵堅守を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME77" , OPT_DOME[77] , " 騎兵堅守 ", "騎兵堅守を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME78" , OPT_DOME[78] , " 槍兵堅守 ", "槍兵堅守を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME79" , OPT_DOME[79] , " 弓兵堅守 ", "弓兵堅守を付与・LVUPできる武将を残します。", 0);
			ccreateText(td25, "OPT_DOME80" , " 　 "		 , "", 0);

		ccreateCheckBox(td21, "OPT_DOME81" , OPT_DOME[81] , " 八卦の陣 ", "八卦の陣を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME82" , OPT_DOME[82] , " 鉄壁 "	, "鉄壁を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME83" , OPT_DOME[83] , " 守護神 "	, "守護神を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME84" , OPT_DOME[84] , " 守護防陣 "  , "守護防陣を付与・LVUPできる武将を残します。", 0);
			ccreateText(td25, "OPT_DOME85" , " 　 "		 , "", 0);

		// ===== 進軍系 =====
		var Anabasis_Box = d.createElement("table");
			Anabasis_Box.style.border = "solid 2px black";
			Anabasis_Box.style.margin = "0px 4px 4px 0px";
			Anabasis_Box.style.width = "100%";

		var tr1 = d.createElement("tr");
		var td1 = d.createElement("td");	td1.colSpan = 5;	td1.style.backgroundColor = COLOR_TITLE;	ccreateText(td1, "dummy", "■ 進軍系 ■", 0 );
		var tr2 = d.createElement("tr");	tr2.style.backgroundColor = COLOR_BACK;	 tr2.style.border = "solid 1px black";
		var td21 = d.createElement("td");	td21.style.padding = "3px";	 td21.style.verticalAlign = "top";	 td21.style.width = "120px";
		var td22 = d.createElement("td");	td22.style.padding = "3px";	 td22.style.verticalAlign = "top";	 td22.style.width = "120px";
		var td23 = d.createElement("td");	td23.style.padding = "3px";	 td23.style.verticalAlign = "top";	 td23.style.width = "120px";
		var td24 = d.createElement("td");	td24.style.padding = "3px";	 td24.style.verticalAlign = "top";	 td24.style.width = "120px";
		var td25 = d.createElement("td");	td25.style.padding = "3px";	 td25.style.verticalAlign = "top";	 td25.style.width = "120px";

		Anabasis_Box.appendChild(tr1);
		tr1.appendChild(td1);
		Anabasis_Box.appendChild(tr2);
		tr2.appendChild(td21);
		tr2.appendChild(td22);
		tr2.appendChild(td23);
		tr2.appendChild(td24);
		tr2.appendChild(td25);

		ccreateCheckBox(td21, "OPT_DOME91" , OPT_DOME[91] , " 剣兵行軍 ", "剣兵行軍を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME92" , OPT_DOME[92] , " 騎兵行軍 ", "騎兵行軍を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME93" , OPT_DOME[93] , " 槍兵行軍 ", "槍兵行軍を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME94" , OPT_DOME[94] , " 弓兵行軍 ", "弓兵行軍を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td25, "OPT_DOME95" , OPT_DOME[95] , " 兵器行軍 ", "兵器行軍を付与・LVUPできる武将を残します。", 0);

		ccreateCheckBox(td21, "OPT_DOME96" , OPT_DOME[96] , " 剣兵強行 ", "剣兵強行を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME97" , OPT_DOME[97] , " 騎兵強行 ", "騎兵強行を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME98" , OPT_DOME[98] , " 槍兵強行 ", "槍兵強行を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME99" , OPT_DOME[99] , " 弓兵強行 ", "弓兵強行を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td25, "OPT_DOME100" , OPT_DOME[100] , " 兵器強行 ", "兵器強行を付与・LVUPできる武将を残します。", 0);

		ccreateCheckBox(td21, "OPT_DOME101" , OPT_DOME[101] , " 急速援護 ", "急速援護を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME102" , OPT_DOME[102] , " 千里行 "  , "千里行を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME103" , OPT_DOME[103] , " 神速 "	, "神速を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME104" , OPT_DOME[104] , " 烈速 "	, "烈速を付与・LVUPできる武将を残します。", 0);

		// ===== 内政系 =====
		var Politics_Box = d.createElement("table");
			Politics_Box.style.border = "solid 2px black";
			Politics_Box.style.margin = "0px 4px 4px 0px";
			Politics_Box.style.width = "100%";

		var tr1 = d.createElement("tr");
		var td1 = d.createElement("td");	td1.colSpan = 5;	td1.style.backgroundColor = COLOR_TITLE;	ccreateText(td1, "dummy", "■ 内政系 ■", 0 );
		var tr2 = d.createElement("tr");	tr2.style.backgroundColor = COLOR_BACK;	 tr2.style.border = "solid 1px black";
		var td21 = d.createElement("td");	td21.style.padding = "3px";	 td21.style.verticalAlign = "top";	 td21.style.width = "120px";
		var td22 = d.createElement("td");	td22.style.padding = "3px";	 td22.style.verticalAlign = "top";	 td22.style.width = "120px";
		var td23 = d.createElement("td");	td23.style.padding = "3px";	 td23.style.verticalAlign = "top";	 td23.style.width = "120px";
		var td24 = d.createElement("td");	td24.style.padding = "3px";	 td24.style.verticalAlign = "top";	 td24.style.width = "120px";
		var td25 = d.createElement("td");	td25.style.padding = "3px";	 td25.style.verticalAlign = "top";	 td25.style.width = "120px";

		Politics_Box.appendChild(tr1);
		tr1.appendChild(td1);
		Politics_Box.appendChild(tr2);
		tr2.appendChild(td21);
		tr2.appendChild(td22);
		tr2.appendChild(td23);
		tr2.appendChild(td24);
		tr2.appendChild(td25);

		ccreateCheckBox(td21, "OPT_DOME111" , OPT_DOME[111] , " 伐採知識 "	, "伐採知識を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME112" , OPT_DOME[112] , " 石切知識 "	, "石切知識を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME113" , OPT_DOME[113] , " 製鉄知識 "	, "製鉄知識を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME114" , OPT_DOME[114] , " 食糧知識 "	, "食糧知識を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td25, "OPT_DOME115" , OPT_DOME[115] , " 農林知識 "	, "農林知識を付与・LVUPできる武将を残します。", 0);

		ccreateCheckBox(td21, "OPT_DOME116" , OPT_DOME[116] , " 伐採技術 "	, "伐採知識を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME117" , OPT_DOME[117] , " 石切技術 "	, "石切知識を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME118" , OPT_DOME[118] , " 製鉄技術 "	, "製鉄知識を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME119" , OPT_DOME[119] , " 食糧技術 "	, "食糧知識を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td25, "OPT_DOME120" , OPT_DOME[120] , " 農林技術 "	, "農林技術を付与・LVUPできる武将を残します。", 0);

		ccreateCheckBox(td21, "OPT_DOME121" , OPT_DOME[121] , " 練兵訓練 "	, "練兵訓練を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME122" , OPT_DOME[122] , " 厩舎訓練 "	, "厩舎訓練を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME123" , OPT_DOME[123] , " 兵舎訓練 "	, "兵舎修練を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME124" , OPT_DOME[124] , " 弓兵訓練 "	, "弓兵訓練を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td25, "OPT_DOME125" , OPT_DOME[125] , " 兵器訓練 "	, "兵器訓練を付与・LVUPできる武将を残します。", 0);

		ccreateCheckBox(td21, "OPT_DOME126" , OPT_DOME[126] , " 練兵修練 "	, "練兵修練を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME127" , OPT_DOME[127] , " 厩舎修練 "	, "厩舎修練を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME128" , OPT_DOME[128] , " 兵舎修練 "	, "兵舎修練を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME129" , OPT_DOME[129] , " 弓兵修練 "	, "弓兵修練を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td25, "OPT_DOME130" , OPT_DOME[130] , " 兵器修練 "	, "兵器修練を付与・LVUPできる武将を残します。", 0);

		ccreateCheckBox(td21, "OPT_DOME131" , OPT_DOME[131] , " 呉の治世 "	, "呉の治世を付与・LVUPできる武将を残します。", 5);
		ccreateCheckBox(td22, "OPT_DOME132" , OPT_DOME[132] , " 王佐の才 "	, "王佐の才を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td23, "OPT_DOME133" , OPT_DOME[133] , " 仁君 "	  , "仁君を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td24, "OPT_DOME134" , OPT_DOME[134] , " 加工知識 "	, "加工知識を付与・LVUPできる武将を残します。", 0);
		ccreateCheckBox(td25, "OPT_DOME135" , OPT_DOME[135] , " 加工技術 "	, "加工技術を付与・LVUPできる武将を残します。", 0);

		// ===== チェック範囲 ====
		var Other_Box2 = d.createElement("table");
			Other_Box2.style.border = "solid 2px black";
			Other_Box2.style.margin = "0px 4px 4px 0px";
			Other_Box2.style.width = "100%";

		var tr1 = d.createElement("tr");
		var td1 = d.createElement("td");	td1.colSpan = 11;	td1.style.backgroundColor = COLOR_TITLE;	ccreateText(td1, "dummy", "■ チェック範囲 ■", 0 );
		var tr2 = d.createElement("tr");	tr2.style.backgroundColor = COLOR_BACK;	 tr2.style.border = "solid 1px black";
		var td21 = d.createElement("td");	td21.style.padding = "3px";	 td21.style.verticalAlign = "top";	 td21.style.width = "120px";
		var td22 = d.createElement("td");	td22.style.padding = "3px";	 td22.style.verticalAlign = "top";	 td22.style.width = "120px";
		var td23 = d.createElement("td");	td23.style.padding = "3px";	 td23.style.verticalAlign = "top";	 td23.style.width = "120px";
		var td24 = d.createElement("td");	td24.style.padding = "3px";	 td24.style.verticalAlign = "top";	 td24.style.width = "120px";
		var td25 = d.createElement("td");	td25.style.padding = "3px";	 td25.style.verticalAlign = "top";	 td25.style.width = "120px";

		Other_Box2.appendChild(tr1);
		tr1.appendChild(td1);
		Other_Box2.appendChild(tr2);
		tr2.appendChild(td21);
		tr2.appendChild(td22);
		tr2.appendChild(td23);
		tr2.appendChild(td24);
		tr2.appendChild(td25);

		ccreateCheckBox(td21, "OPT_OTHER101" , OPT_OTHER[101] , " 初期スキル "		, "初期スキルのチェックを行います。"		, 5);
		ccreateCheckBox(td22, "OPT_OTHER102" , OPT_OTHER[102] , " 攻撃振り "	  , "攻撃振りレシピのチェックを行います。"	, 1);
		ccreateCheckBox(td23, "OPT_OTHER103" , OPT_OTHER[103] , " 防御振り "	  , "防御合成レシピのチェックを行います。"	, 1);
		ccreateCheckBox(td24, "OPT_OTHER104" , OPT_OTHER[104] , " 知力振り "	  , "知力合成レシピのチェックを行います。"	, 1);
		ccreateCheckBox(td25, "OPT_OTHER105" , OPT_OTHER[105] , " 隠し "		  , "隠し合成レシピのチェックを行います。"	, 1);
		ccreateCheckBox(td21, "OPT_OTHER106" , OPT_OTHER[106] , " コモン強制破棄 "	, "レアリティが「Ｃ」のカードは破棄します。"	, 5);

		// ===== 画面表示系 ====
		var Other_Box3 = d.createElement("table");
			Other_Box3.style.border = "solid 2px black";
			Other_Box3.style.margin = "0px 4px 4px 0px";
			Other_Box3.style.width = "100%";

		var tr1 = d.createElement("tr");
		var td1 = d.createElement("td");	td1.colSpan = 11;	td1.style.backgroundColor = COLOR_TITLE;	ccreateText(td1, "dummy", "■ 画面表示系 ■", 0 );
		var tr2 = d.createElement("tr");	tr2.style.backgroundColor = COLOR_BACK;	 tr2.style.border = "solid 1px black";
		var td21 = d.createElement("td");	td21.style.padding = "3px";		 td21.style.verticalAlign = "top";
		var td22 = d.createElement("td");	td22.style.padding = "3px";		 td22.style.verticalAlign = "top";
		var td23 = d.createElement("td");	td23.style.padding = "3px";		 td23.style.verticalAlign = "top";
		var td24 = d.createElement("td");	td24.style.padding = "3px";		 td24.style.verticalAlign = "top";
		var td25 = d.createElement("td");	td25.style.padding = "3px";		 td25.style.verticalAlign = "top";
		var td26 = d.createElement("td");	td26.style.padding = "3px";		 td26.style.verticalAlign = "top";

		Other_Box3.appendChild(tr1);
		tr1.appendChild(td1);
		Other_Box3.appendChild(tr2);
		tr2.appendChild(td21);
		tr2.appendChild(td22);
		tr2.appendChild(td23);
		tr2.appendChild(td24);
		tr2.appendChild(td25);
		tr2.appendChild(td26);

		td21.appendChild( createRadioBtn ( 'DF', '変更しない' ) );
		td22.appendChild( createRadioBtn ( 'OL', '旧モード' ) );
		td23.appendChild( createRadioBtn ( 'SP', '春に変更' ) );
		td24.appendChild( createRadioBtn ( 'SU', '夏に変更' ) );
		td25.appendChild( createRadioBtn ( 'AU', '秋に変更' ) );
		td26.appendChild( createRadioBtn ( 'WI', '冬に変更' ) );

		ccreateCheckBox(td21, "OPT_OTHER107" , OPT_OTHER[107] , " すけすけモード "	, "カード枠を半透明にします。"			  , 5);

		// ===== その他 =====
		var Other_Box = d.createElement("table");
			Other_Box.style.border = "solid 2px black";
			Other_Box.style.margin = "0px 4px 4px 0px";
			Other_Box.style.width = "100%";
	//	  Other_Box.style.width = "420px";

		var tr1 = d.createElement("tr");
		var td1 = d.createElement("td");	td1.colSpan = 11;	td1.style.backgroundColor = COLOR_TITLE;	ccreateText(td1, "dummy", "■ その他の設定 ■", 0 );
		var tr2 = d.createElement("tr");	tr2.style.backgroundColor = COLOR_BACK;	 tr2.style.borderStyle = "solid solid none  solid"; tr2.style.borderColor = "black"; tr2.style.borderWidth = "1px";
		var tr3 = d.createElement("tr");	tr3.style.backgroundColor = COLOR_BACK;	 tr3.style.borderStyle = "none  solid none  solid"; tr3.style.borderColor = "black"; tr3.style.borderWidth = "1px";
		var tr4 = d.createElement("tr");	tr4.style.backgroundColor = COLOR_BACK;	 tr4.style.borderStyle = "none  solid none  solid"; tr4.style.borderColor = "black"; tr4.style.borderWidth = "1px";
		var tr5 = d.createElement("tr");	tr5.style.backgroundColor = COLOR_BACK;	 tr5.style.borderStyle = "none  solid none  solid"; tr5.style.borderColor = "black"; tr5.style.borderWidth = "1px";
		var tr6 = d.createElement("tr");	tr6.style.backgroundColor = COLOR_BACK;	 tr6.style.borderStyle = "none  solid none  solid"; tr6.style.borderColor = "black"; tr6.style.borderWidth = "1px";
		var tr9 = d.createElement("tr");	tr9.style.backgroundColor = COLOR_BACK;	 tr9.style.borderStyle = "none  solid solid solid"; tr9.style.borderColor = "black"; tr9.style.borderWidth = "1px";

		var td021 = d.createElement("td");	 td021.style.padding = "2px";	 td021.style.verticalAlign = "top";
		var td022 = d.createElement("td");	 td022.style.padding = "2px";	 td022.style.verticalAlign = "top";
		var td023 = d.createElement("td");	 td023.style.padding = "2px";	 td023.style.verticalAlign = "top";
		var td024 = d.createElement("td");	 td024.style.padding = "2px";	 td024.style.verticalAlign = "top";
		var td025 = d.createElement("td");	 td025.style.padding = "2px";	 td025.style.verticalAlign = "top";
		var td026 = d.createElement("td");	 td026.style.padding = "2px";	 td026.style.verticalAlign = "top";
		var td027 = d.createElement("td");	 td027.style.padding = "2px";	 td027.style.verticalAlign = "top";
		var td028 = d.createElement("td");	 td028.style.padding = "2px";	 td028.style.verticalAlign = "top";
		var td029 = d.createElement("td");	 td029.style.padding = "2px";	 td029.style.verticalAlign = "top";
		var td030 = d.createElement("td");	 td030.style.padding = "2px";	 td030.style.verticalAlign = "top";
		var td031 = d.createElement("td");	 td031.style.padding = "2px";	 td031.style.verticalAlign = "top";

		var td121 = d.createElement("td");	 td121.style.padding = "2px";	 td121.style.verticalAlign = "top";
		var td122 = d.createElement("td");	 td122.style.padding = "2px";	 td122.style.verticalAlign = "top";
		var td123 = d.createElement("td");	 td123.style.padding = "2px";	 td123.style.verticalAlign = "top";
		var td124 = d.createElement("td");	 td124.style.padding = "2px";	 td124.style.verticalAlign = "top";
		var td125 = d.createElement("td");	 td125.style.padding = "2px";	 td125.style.verticalAlign = "top";
		var td126 = d.createElement("td");	 td126.style.padding = "2px";	 td126.style.verticalAlign = "top";
		var td127 = d.createElement("td");	 td127.style.padding = "2px";	 td127.style.verticalAlign = "top";
		var td128 = d.createElement("td");	 td128.style.padding = "2px";	 td128.style.verticalAlign = "top";
		var td129 = d.createElement("td");	 td129.style.padding = "2px";	 td129.style.verticalAlign = "top";
		var td130 = d.createElement("td");	 td130.style.padding = "2px";	 td130.style.verticalAlign = "top";
		var td131 = d.createElement("td");	 td131.style.padding = "2px";	 td131.style.verticalAlign = "top";

		var td221 = d.createElement("td");	 td221.style.padding = "2px";	 td221.style.verticalAlign = "top";
		var td222 = d.createElement("td");	 td222.style.padding = "2px";	 td222.style.verticalAlign = "top";
		var td223 = d.createElement("td");	 td223.style.padding = "2px";	 td223.style.verticalAlign = "top";
		var td224 = d.createElement("td");	 td224.style.padding = "2px";	 td224.style.verticalAlign = "top";
		var td225 = d.createElement("td");	 td225.style.padding = "2px";	 td225.style.verticalAlign = "top";
		var td226 = d.createElement("td");	 td226.style.padding = "2px";	 td226.style.verticalAlign = "top";
		var td227 = d.createElement("td");	 td227.style.padding = "2px";	 td227.style.verticalAlign = "top";
		var td228 = d.createElement("td");	 td228.style.padding = "2px";	 td228.style.verticalAlign = "top";
		var td229 = d.createElement("td");	 td229.style.padding = "2px";	 td229.style.verticalAlign = "top";
		var td230 = d.createElement("td");	 td230.style.padding = "2px";	 td230.style.verticalAlign = "top";
		var td231 = d.createElement("td");	 td231.style.padding = "2px";	 td231.style.verticalAlign = "top";

		var td321 = d.createElement("td");	 td321.style.padding = "2px";	 td321.style.verticalAlign = "top";
		var td322 = d.createElement("td");	 td322.style.padding = "2px";	 td322.style.verticalAlign = "top";
		var td323 = d.createElement("td");	 td323.style.padding = "2px";	 td323.style.verticalAlign = "top";
		var td324 = d.createElement("td");	 td324.style.padding = "2px";	 td324.style.verticalAlign = "top";
		var td325 = d.createElement("td");	 td325.style.padding = "2px";	 td325.style.verticalAlign = "top";
		var td326 = d.createElement("td");	 td326.style.padding = "2px";	 td326.style.verticalAlign = "top";
		var td327 = d.createElement("td");	 td327.style.padding = "2px";	 td327.style.verticalAlign = "top";
		var td328 = d.createElement("td");	 td328.style.padding = "2px";	 td328.style.verticalAlign = "top";
		var td329 = d.createElement("td");	 td329.style.padding = "2px";	 td329.style.verticalAlign = "top";
		var td330 = d.createElement("td");	 td330.style.padding = "2px";	 td330.style.verticalAlign = "top";
		var td331 = d.createElement("td");	 td331.style.padding = "2px";	 td331.style.verticalAlign = "top";

		var td421 = d.createElement("td");	 td421.style.padding = "2px";	 td421.style.verticalAlign = "top";
		var td422 = d.createElement("td");	 td422.style.padding = "2px";	 td422.style.verticalAlign = "top";
		var td423 = d.createElement("td");	 td423.style.padding = "2px";	 td423.style.verticalAlign = "top";
		var td424 = d.createElement("td");	 td424.style.padding = "2px";	 td424.style.verticalAlign = "top";
		var td425 = d.createElement("td");	 td425.style.padding = "2px";	 td425.style.verticalAlign = "top";
		var td426 = d.createElement("td");	 td426.style.padding = "2px";	 td426.style.verticalAlign = "top";
		var td427 = d.createElement("td");	 td427.style.padding = "2px";	 td427.style.verticalAlign = "top";
		var td428 = d.createElement("td");	 td428.style.padding = "2px";	 td428.style.verticalAlign = "top";
		var td429 = d.createElement("td");	 td429.style.padding = "2px";	 td429.style.verticalAlign = "top";
		var td430 = d.createElement("td");	 td430.style.padding = "2px";	 td430.style.verticalAlign = "top";
		var td431 = d.createElement("td");	 td431.style.padding = "2px";	 td431.style.verticalAlign = "top";


		Other_Box.appendChild(tr1);
		tr1.appendChild(td1);

		Other_Box.appendChild(tr2);
		tr2.appendChild(td021);
		tr2.appendChild(td022);
		tr2.appendChild(td023);
		tr2.appendChild(td024);
		tr2.appendChild(td025);
		tr2.appendChild(td026);
		tr2.appendChild(td027);
		tr2.appendChild(td028);
		tr2.appendChild(td029);
		tr2.appendChild(td030);
		tr2.appendChild(td031);

		Other_Box.appendChild(tr3);
		tr3.appendChild(td121);
		tr3.appendChild(td122);
		tr3.appendChild(td123);
		tr3.appendChild(td124);
		tr3.appendChild(td125);
		tr3.appendChild(td126);
		tr3.appendChild(td127);
		tr3.appendChild(td128);
		tr3.appendChild(td129);
		tr3.appendChild(td130);
		tr3.appendChild(td131);

		Other_Box.appendChild(tr4);
		tr4.appendChild(td221);
		tr4.appendChild(td222);
		tr4.appendChild(td223);
		tr4.appendChild(td224);
		tr4.appendChild(td225);
		tr4.appendChild(td226);
		tr4.appendChild(td227);
		tr4.appendChild(td228);
		tr4.appendChild(td229);
		tr4.appendChild(td230);
		tr4.appendChild(td231);

		Other_Box.appendChild(tr5);
		tr5.appendChild(td321);
		tr5.appendChild(td322);
		tr5.appendChild(td323);
		tr5.appendChild(td324);
		tr5.appendChild(td325);
		tr5.appendChild(td326);
		tr5.appendChild(td327);
		tr5.appendChild(td328);
		tr5.appendChild(td329);
		tr5.appendChild(td330);
		tr5.appendChild(td331);

		Other_Box.appendChild(tr6);
		tr6.appendChild(td421);
		tr6.appendChild(td422);
		tr6.appendChild(td423);
		tr6.appendChild(td424);
		tr6.appendChild(td425);
		tr6.appendChild(td426);
		tr6.appendChild(td427);
		tr6.appendChild(td428);
		tr6.appendChild(td429);
		tr6.appendChild(td430);
		tr6.appendChild(td431);

		ccreateText(td021, "dummy", "破棄除外カード№", 0 );
		ccreateTextBox(td022,"OPT_OTHER0", OPT_OTHER[0],"","",6,0);
		ccreateTextBox(td023,"OPT_OTHER1", OPT_OTHER[1],"","",6,0);
		ccreateTextBox(td024,"OPT_OTHER2", OPT_OTHER[2],"","",6,0);
		ccreateTextBox(td025,"OPT_OTHER3", OPT_OTHER[3],"","",6,0);
		ccreateTextBox(td026,"OPT_OTHER4", OPT_OTHER[4],"","",6,0);
		ccreateTextBox(td027,"OPT_OTHER5", OPT_OTHER[5],"","",6,0);
		ccreateTextBox(td028,"OPT_OTHER6", OPT_OTHER[6],"","",6,0);
		ccreateTextBox(td029,"OPT_OTHER7", OPT_OTHER[7],"","",6,0);
		ccreateTextBox(td030,"OPT_OTHER8", OPT_OTHER[8],"","",6,0);
		ccreateTextBox(td031,"OPT_OTHER9", OPT_OTHER[9],"","",6,0);

		ccreateText(td121, "dummy", "　", 0 );
		ccreateTextBox(td122,"OPT_OTHER10", OPT_OTHER[10],"","",6,0);
		ccreateTextBox(td123,"OPT_OTHER11", OPT_OTHER[11],"","",6,0);
		ccreateTextBox(td124,"OPT_OTHER12", OPT_OTHER[12],"","",6,0);
		ccreateTextBox(td125,"OPT_OTHER13", OPT_OTHER[13],"","",6,0);
		ccreateTextBox(td126,"OPT_OTHER14", OPT_OTHER[14],"","",6,0);
		ccreateTextBox(td127,"OPT_OTHER15", OPT_OTHER[15],"","",6,0);
		ccreateTextBox(td128,"OPT_OTHER16", OPT_OTHER[16],"","",6,0);
		ccreateTextBox(td129,"OPT_OTHER17", OPT_OTHER[17],"","",6,0);
		ccreateTextBox(td130,"OPT_OTHER18", OPT_OTHER[18],"","",6,0);
		ccreateTextBox(td131,"OPT_OTHER19", OPT_OTHER[19],"","",6,0);

		ccreateText(td221, "dummy", "　", 0 );
		ccreateTextBox(td222,"OPT_OTHER20", OPT_OTHER[20],"","",6,0);
		ccreateTextBox(td223,"OPT_OTHER21", OPT_OTHER[21],"","",6,0);
		ccreateTextBox(td224,"OPT_OTHER22", OPT_OTHER[22],"","",6,0);
		ccreateTextBox(td225,"OPT_OTHER23", OPT_OTHER[23],"","",6,0);
		ccreateTextBox(td226,"OPT_OTHER24", OPT_OTHER[24],"","",6,0);
		ccreateTextBox(td227,"OPT_OTHER25", OPT_OTHER[25],"","",6,0);
		ccreateTextBox(td228,"OPT_OTHER26", OPT_OTHER[26],"","",6,0);
		ccreateTextBox(td229,"OPT_OTHER27", OPT_OTHER[27],"","",6,0);
		ccreateTextBox(td230,"OPT_OTHER28", OPT_OTHER[28],"","",6,0);
		ccreateTextBox(td231,"OPT_OTHER29", OPT_OTHER[29],"","",6,0);

		ccreateText(td321, "dummy", "　", 0 );
		ccreateTextBox(td322,"OPT_OTHER30", OPT_OTHER[30],"","",6,0);
		ccreateTextBox(td323,"OPT_OTHER31", OPT_OTHER[31],"","",6,0);
		ccreateTextBox(td324,"OPT_OTHER32", OPT_OTHER[32],"","",6,0);
		ccreateTextBox(td325,"OPT_OTHER33", OPT_OTHER[33],"","",6,0);
		ccreateTextBox(td326,"OPT_OTHER34", OPT_OTHER[34],"","",6,0);
		ccreateTextBox(td327,"OPT_OTHER35", OPT_OTHER[35],"","",6,0);
		ccreateTextBox(td328,"OPT_OTHER36", OPT_OTHER[36],"","",6,0);
		ccreateTextBox(td329,"OPT_OTHER37", OPT_OTHER[37],"","",6,0);
		ccreateTextBox(td330,"OPT_OTHER38", OPT_OTHER[38],"","",6,0);
		ccreateTextBox(td331,"OPT_OTHER39", OPT_OTHER[39],"","",6,0);

		ccreateText(td421, "dummy", "　", 0 );
		ccreateTextBox(td422,"OPT_OTHER40", OPT_OTHER[40],"","",6,0);
		ccreateTextBox(td423,"OPT_OTHER41", OPT_OTHER[41],"","",6,0);
		ccreateTextBox(td424,"OPT_OTHER42", OPT_OTHER[42],"","",6,0);
		ccreateTextBox(td425,"OPT_OTHER43", OPT_OTHER[43],"","",6,0);
		ccreateTextBox(td426,"OPT_OTHER44", OPT_OTHER[44],"","",6,0);
		ccreateTextBox(td427,"OPT_OTHER45", OPT_OTHER[45],"","",6,0);
		ccreateTextBox(td428,"OPT_OTHER46", OPT_OTHER[46],"","",6,0);
		ccreateTextBox(td429,"OPT_OTHER47", OPT_OTHER[47],"","",6,0);
		ccreateTextBox(td430,"OPT_OTHER48", OPT_OTHER[48],"","",6,0);
		ccreateTextBox(td431,"OPT_OTHER49", OPT_OTHER[49],"","",6,0);


		var Operation_Box = d.createElement("table");
			Operation_Box.style.border ="solid 0px gray";
			Operation_Box.style.fontFamily = "ＭＳ ゴシック";

		var tr711 = d.createElement("tr");
		var td711 = d.createElement("td");
			td711.style.padding = "3px";
			td711.style.verticalAlign = "top";

		Operation_Box.appendChild(tr711);
			tr711.appendChild(td711);

		ccreateButton(td711, "保存", "設定内容を保存します", function() {
			SaveSettingBox()
			alert("保存しました");
		});
		ccreateButton(td711, "閉じる", "設定内容を保存せず閉じます", function() {
			closeSettingBox();
		});

		// == コンテナ設定 ==
		// 上段
		var tbl000 = d.createElement("table");	// 全体
			tbl000.style.border = "solid 0px lime";

		var tr000 = d.createElement("tr");
		var td001 = d.createElement("td");	// 左枠
			td001.style.verticalAlign = "top";
			td001.appendChild(Attack_Box);
			td001.appendChild(Defense_Box);

			td001.appendChild(Politics_Box);
			td001.appendChild(Anabasis_Box);
			td001.appendChild(Other_Box2);
			td001.appendChild(Other_Box3);
			td001.appendChild(Other_Box);

		//	レイアウト

		SettingContainer.appendChild(tbl000);
			tbl000.appendChild(tr000);
			tr000.appendChild(td001);


		SettingContainer.appendChild(Operation_Box);

	}

	// セーブ ==========================================================================================================================================================================
	function SaveSettingBox(){

		strSave = "";
		for (i = 0; i < 201; i++){
			try {
				strSave += cgetCheckBoxValue($("OPT_DOME" + i))   + DELIMIT2;
			} catch(e) {
				strSave += "0" + DELIMIT2;
			}
		}

		for (i = 0; i < 150; i++){
			try {
				if (i < 101) {
					strSave += cgetTextBoxValue($("OPT_OTHER" + i)) + DELIMIT2;
				} else {
					strSave += cgetCheckBoxValue($("OPT_OTHER" + i)) + DELIMIT2;
				}
			} catch(e) {
				strSave += "0" + DELIMIT2;
			}
		}
		strSave += OPT_SEASON;
		GM_setValue(HOST+PGNAME, strSave);
	}

	// ロード ==========================================================================================================================================================================
	function LoadSettingBox(){

		var defOther = [];
		var src = GM_getValue(HOST+PGNAME, "");

		if (src == "") {
			OPT_OTHER[101] = 1;  // 通常
			OPT_OTHER[102] = 1;  // 攻撃
			OPT_OTHER[103] = 1;  // 防御
			OPT_OTHER[104] = 1;  // 知力
			OPT_OTHER[105] = 1;  // 隠し
			OPT_OTHER[107] = 1;  // スケスケ
			OPT_OTHER[106] = 0;  // コモン強制破棄
			OPT_SEASON = "DF";
			for (var i=0;i<100;i++){
				try {
					if (defOther[i] == undefined){
						OPT_OTHER[i] = 0;
					} else {
						OPT_OTHER[i] = defOther[i];
					}
				} catch(e) {
					OPT_OTHER[i] = 0;
				}
			}
			return;
		}
		var Temp = src.split(DELIMIT2);
		for (i = 0; i < 201; i++){
			OPT_DOME[i]  = parseInt(Temp[i]);
		}
		for (i = 0; i < 150; i++){
			if (isNaN(parseInt(Temp[201 + i]))) {
				OPT_OTHER[i] = 0;
			} else {
				OPT_OTHER[i] = parseInt(Temp[201 + i]);
			}
		}

		if ((Temp[351] == undefined) || (Temp[351] == "")) {
			OPT_SEASON = "DF";
		} else {
			OPT_SEASON = Temp[351];
		}
	}

	// 破棄チェック ====================================================================================================================================================================
	function checkDestruction(cardno) {


		try {
			// 特定番号の除外
			for (i=0;i<30;i++) {
				if (cardno == OPT_OTHER[i]) {
					return 0;
				}
			}
			// レアリティが R・SR・UR の場合は破棄しない
			if (card_list[cardno].r == "R" || card_list[cardno].r == "SR" || card_list[cardno].r == "UR") {
				return 0;
			}

			// 2013.01.18 追加
			if (
				( cardno == 4079 ) || // 水鏡
				( cardno == 4080 ) || // 水鏡
				( cardno == 4081 ) || // 水鏡
				( cardno == 4082 ) || // UC水鏡
				( cardno == 3084 ) || // UC太史慈
				( cardno == 4090 ) || // UC張角
				( cardno == 4098 ) || // UC水鏡娘
				( cardno == 4102 )	// UC水鏡娘
			) {
				return 0;
			}
			// 2013.01.18 ここまで

			// 上記条件以外のコモンカードの強制破棄処理
			if (card_list[cardno].r == "C" && OPT_OTHER[42] == 1) {
				return 1;
			}

			// 保持スキルのチェック
			if (OPT_OTHER[101] == 1) {
				for (i=0;i<Skill_List.length;i++){	if (card_list[cardno].bs == Skill_List[i][0]) {		if (OPT_DOME[Skill_List[i][1]] == 1) {	return 0;	}	}	}
			}	// LVUP 可能
			if (OPT_OTHER[102] == 1) {
				for (i=0;i<Skill_List.length;i++){	if (gousei_skill[card_list[cardno].bs][0] == Skill_List[i][0]) {	if (OPT_DOME[Skill_List[i][1]] == 1) {	return 0;	}	}	}
			}	// 合成：攻撃
			if (OPT_OTHER[103] == 1) {
				for (i=0;i<Skill_List.length;i++){	if (gousei_skill[card_list[cardno].bs][1] == Skill_List[i][0]) {	if (OPT_DOME[Skill_List[i][1]] == 1) {	return 0;	}	}	}
			}	// 合成：防御
			if (OPT_OTHER[104] == 1) {
				for (i=0;i<Skill_List.length;i++){	if (gousei_skill[card_list[cardno].bs][2] == Skill_List[i][0]) {	if (OPT_DOME[Skill_List[i][1]] == 1) {	return 0;	}	}	}
			}	// 合成：知力
			if (OPT_OTHER[105] == 1) {
				for (i=0;i<Skill_List.length;i++){	if (gousei_skill[card_list[cardno].bs][3] == Skill_List[i][0]) {	if (OPT_DOME[Skill_List[i][1]] == 1) {	return 0;	}	}	}
			}	// 合成：隠し

			// 全部のチェック抜けたら破棄する
			return 1;

		} catch(e) {
			// 未知のカード番号だった
			return 0;
		}
	}

	// チェックボックスの状態取得
	function cgetCheckBoxValue(id)
	{
		var c = id;
		if( !c ) return 0;
		if( !c.checked ) return 0;
		return 1;
	}

	function cgetTextBoxValue(id)
	{
		var c = id;
		if( !c ) return "";
		return c.value;
	}

	// 設定画面表示
	function openSettingBilderBox() {
		addSettingHtml();
	}

	// 設定画面クローズ
	function closeSettingBox() {
		deleteSettingHtml();
		deleteSettingFrameHtml();
	}

	// 設定画面削除
	function deleteSettingHtml() {
		var elem = d.getElementById("SettingContainer");
		if (elem == undefined) return;
		d.body.removeChild(d.getElementById("SettingContainer"));
	}

	function deleteSettingFrameHtml() {
		var elem = d.getElementById("SettingContainer");
		if (elem == undefined) return;
		d.body.removeChild(document.getElementById("SettingContainer"));
	}

	function ccreateText(container, id, text, left )
	{
		left += 2;
		var dv = d.createElement("div");
		dv.style.padding = "1px";
		dv.style.paddingLeft= left + "px";
		dv.style.paddingBottom = "3px";

		var lb = d.createElement("label");
		lb.htmlFor = id;
		lb.style.verticalAlign = "middle";
		var tx = d.createTextNode(text);
		tx.fontsize = "10px";
		lb.appendChild( tx );

		dv.appendChild(lb);
		container.appendChild(dv);
	}

	function ccreateCheckBox(container, id, def, text, title, left )
	{
		left += 2;
		var dv = d.createElement("div");
		dv.style.padding = "1px";
		dv.style.paddingLeft= left + "px";
		dv.title = title;
		var cb = d.createElement("input");
		cb.type = "checkbox";
		cb.style.verticalAlign = "middle";
		cb.id = id;
		cb.value = 1;
		if( def ) cb.checked = true;

		var lb = d.createElement("label");
		lb.htmlFor = id;
		lb.style.verticalAlign = "middle";

		var tx = d.createTextNode(text);

		lb.appendChild( tx );

		dv.appendChild(cb);
		dv.appendChild(lb);
		container.appendChild(dv);
		return cb;
	}

	function ccreateButton(container, text, title, func, width)
	{
		var btn = d.createElement("input");
		btn.style.padding = "0px";
		btn.type = "button";
		btn.value = text;
		if (width == undefined) {
			btn.style.width = "54px";
		} else {
			btn.style.width = width + "px";
		}
		btn.style.height = "22px";
		btn.style.verticalAlign = "middle";
		btn.title = title;
		container.appendChild(d.createTextNode(" "));
		container.appendChild(btn);
		container.appendChild(d.createTextNode(" "));
		$e(btn, "click", func);
		return btn;
	}

	function ccreateTextBox(container, id, def, text, title, size, left )
	{
		left += 2;
		var dv = d.createElement("div");
		dv.style.padding = "1px";
		dv.style.paddingLeft= left + "px";
		dv.title = title;
		var tb = d.createElement("input");
		tb.type = "text";
		tb.id = id;
		tb.value = def;
		tb.size = size;
		tb.style.verticalAlign = "middle";
		tb.style.textAlign = "right";
		tb.style.paddingRight = "3px";

		var tx = d.createTextNode(text);
		tx.title = title;

		dv.appendChild(tx);
		dv.appendChild(tb);
		container.appendChild(dv);
		return tb;
	}

	//3桁カンマ区切り
	function addFigure(str) {
	　var num = new String(str).replace(/,/g, "");
	　while(num != (num = num.replace(/^(-?\d+)(\d{3})/, "$1,$2")));
	　return num;
	}

	function xpath(query,targetDoc) {
		return document.evaluate(query, targetDoc, null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE, null);
	}

	function cloadData(key, value, local, ev)
	{
		if( local ) key = location.hostname + key  + PGNAME;
		var ret = GM_getValue(key, value);
		return ev ? eval('ret='+ret) : ret;
	}

	function csaveData(key, value, local, ev)
	{
		if( local ) key = location.hostname + key  + PGNAME;
		if( ev ) {
			if (window.opera || typeof JSON != 'object') {
				value = toJSON(value);
			}
			else {
				value = JSON.stringify( value );
			}
		}
		GM_setValue(key, value );
	}

	// ラジオボタン生成 @@@@ add 2011.09.06
	function createRadioBtn ( value, txt ) {
		var radioLabel = document.createElement('label');
		radioLabel.style.display = 'inline-block';
		radioLabel.style.margin = '2px 0px 2px 2px';
		radioLabel.style.padding = '5px';
		radioLabel.addEventListener ( 'click', function(){ OPT_SEASON = value;}, true );
		var radioLabelText = document.createTextNode(" " + txt);
		var radioButton = document.createElement('input');
		radioButton.type = 'radio';
		radioButton.name = 'tweetOpt';
		radioButton.value = value;
		radioButton.style.verticalAlign = "top";
		if ( OPT_SEASON == value ) radioButton.checked = true;
		radioLabel.appendChild( radioButton );
		radioLabel.appendChild( radioLabelText );
		return radioLabel;
	}
}
//end

//-----------------------------------------------------------
// bro3_misc 2014/03/03 add
//-----------------------------------------------------------
//add
function disp_bro3_misc() {
	var logtitle = 'bro3_misc';

	if(typeof GM_getMetadata != 'undefined') {
		if(typeof GM_getMetadata('name') != 'undefined') {
			logtitle = GM_getMetadata('name');
			if(typeof logtitle != 'string') { logtitle = logtitle[0]; }
		}
	} else
	if(typeof GM_info != 'undefined') {
		if(typeof GM_info.script != 'undefined') {
			logtitle = GM_info.script.name;
		}
	}

	logtitle = logtitle.toLowerCase();
	var debug_log = function(msg) { console.log(logtitle + ':' + location.host + ':' + msg); };

	jQuery.noConflict();
	j$ = jQuery;
	HOST = location.hostname;
	KEY = "BRO3MISC_" + HOST + "_";
	GLOBAL_KEY = "BRO3MISC__";
	MARGIN = 2500;

	debug_log('Enter')
	if (j$("#container").length == 0) {
		return
	}

	var tmp = {};
	if (j$("#AjaxTempDOM").length != 0) {
		j$("#AjaxTempDOM").empty()
	}
	if (location.pathname == "/alliance/alliance_log.php") {
		debug_log('同盟ログ検索');
		j$("table.commonTables.tables").before("<div id=log_search><div id=search_controls></div></div><div id=search_header></div><div id=search_result_area></div>");
		j$("#search_controls").append("<div id=query_field><input type=text id=search_query /> <input type=button id=do_search value=検索><input type=hidden id=total_counts value=0></div>");
		j$("#search_controls").append("<div id=date_field>検索期間 : <select id=from_y></select>年<select id=from_m></select>月<select id=from_d></select>日 <select id=from_h></select>時 ～ <select id=to_y></select>年<select id=to_m></select>月<select id=to_d></select>日 <select id=to_h></select>時</div>");
		j$("#log_search").css({
			"width": "710px"
		});
		j$("#search_controls").css({
			"width": "710px",
			"float": "right",
			"text-align": "right"
		});
		j$("#date_field").css({
			"margin-top": "3px"
		});
		j$("#search_result_area").css({
			"clear": "both",
			"background-color": "white",
			"width": "710px",
			"margine-top": "10px",
			"overflow": "auto"
		});
		if (location.href.match(/m=(.+)/)) {
			j$("#search_controls").show()
		} else {
			j$("#search_controls").hide();
			debug_log('同盟ログ検索 not m')
			return
		}
		var f = new Date();
		var g = new Date(f.getTime() - 5 * 3600 * 1000);
		for (i = f.getFullYear() - 1; i <= f.getFullYear(); i++) {
			j$("#from_y").append("<option value=" + i + ">" + i + "</option>");
			j$("#to_y").append("<option value=" + i + ">" + i + "</option>")
		}
		j$("#from_y").val(g.getFullYear());
		j$("#to_y").val(f.getFullYear());
		for (i = 1; i <= 12; i++) {
			j$("#from_m").append("<option value=" + i + ">" + i + "</option>");
			j$("#to_m").append("<option value=" + i + ">" + i + "</option>")
		}
		j$("#from_m").val(g.getMonth() + 1);
		j$("#to_m").val(f.getMonth() + 1);
		for (i = 1; i <= 31; i++) {
			j$("#from_d").append("<option value=" + i + ">" + i + "</option>");
			j$("#to_d").append("<option value=" + i + ">" + i + "</option>")
		}
		j$("#from_d").val(g.getDate());
		j$("#to_d").val(f.getDate());
		for (i = 0; i <= 23; i++) {
			j$("#from_h").append("<option value=" + i + ">" + i + "</option>");
			j$("#to_h").append("<option value=" + i + ">" + i + "</option>")
		}
		j$("#from_h").val(g.getHours());
		j$("#to_h").val(f.getHours());
		j$("#do_search").bind("click", function () {
			if (j$("#search_query").val().trim() == "") {
				return
			}
			j$("#do_search").attr("disabled", "disabled");
			j$("#search_result_area").html("");
			j$("#search_header").html("[検索結果]<br /><span id=process_msg></span>");
			j$("#search_result_area").append("<ol id=search_result></ol>");
			j$("#search_result_area").css({
				"height": "300px"
			});
			j$("#total_counts").val(0);
			Search(1)
		})
	}
	if (location.pathname == "/card/deck.php") {
		debug_log('カード一括破棄ボタンを100枚版デフォルト化');
		with(j$("img[src*='btn_delete.']").parent()) {
		  attr('href', attr('href') + '?sz=100')
		}
	}
	if (location.pathname == "/facility/castle_send_troop.php") {
		var o = new Date();
		j$("select[name='res_y']").val(o.getYear());
		j$("select[name='res_m']").val(o.getMonth() + 1);
		j$("select[name='res_d']").val(o.getDate());
		j$("select[name='res_h']").val(o.getHours());
		j$("select[name='res_i1']").val(("0" + o.getMinutes()).slice(-2, -1));
		j$("select[name='res_i2']").val(("0" + o.getMinutes()).slice(-1));
		j$("select[name='res_s1']").val(("0" + o.getSeconds()).slice(-2, -1));
		j$("select[name='res_s2']").val(("0" + o.getSeconds()).slice(-1))
	}
	if (location.pathname == "/reward_vendor/reward_vendor.php" || location.pathname == "/busyodas/b3kuji.php") {
		debug_log('自動ヨロズダス');
		j$("div.sysMes").text().match(/残り(\d+)回/);
		var s = parseInt(RegExp.$1);
		j$("div.sysMes").before("<div id=AutoYodozudas>");
		j$("#AutoYodozudas").append("<div id=AutoYodozudasControls>");
		j$("#AutoYodozudas").append("<div id=DrawResult>");
		j$("#AutoYodozudasControls").append("<input type=button id=AutoDrawYorozudas value=自動ヨロズダス>");
		j$("#AutoYodozudas").css({
			"width": "740px"
		});
		j$("#DrawResult").css({
			"width": "740px",
			"font-size": "20px",
			"text-align": "center"
		});
		j$("#AutoYodozudasControls").css({
			"width": "740px",
			"margine-left": "auto",
			"margine-right": "5px",
			"text-align": "right"
		});
		j$("#AutoDrawYorozudas").bind('click', function () {
			j$("#AutoDrawYorozudas").attr("disabled", "disabled");
			AutoYorozudas(s)
		});
		if (s == 0) {
			j$("#AutoDrawYorozudas").removeAttr("disabled")
		}
	}
	if (location.pathname == "/message/inbox.php") {
		var t = new Array();
		j$("#statMenu").append("<li class=last><input type=button id=del_trade_msg value=トレード書簡開封削除></li>");
		j$("#gray02Wrapper h2").append("<div id=notice_msg></div>");
		j$("#notice_msg").css({
			"float": "right"
		});
		j$("#del_trade_msg").bind('click', function () {
			j$("tr.unread:has(span.notice)").each(function () {
				if (j$("a[href*='detail.php']", this).text().match(/カード.*落札/) != null) {
					t.push(j$("a[href*='detail.php']", this).attr("href"))
				}
			});
			j$("#del_trade_msg").attr("disabled", "disabled");
			DeleteMsgs(t, new Array())
		})
	}
	function BuildFacility(e) {
		j$(document.body).append("<div id=AjaxTempDOM>");
		j$("#AjaxTempDOM").hide();
		if (e.length == 0) {
			j$("#AjaxTempDOM").load("http://" + HOST + "/village.php #wrapper", function () {
				var a = 0;
				var b;
				if (j$("span.buildClock:last").length != 0) {
					b = j$("span.buildClock:last").text();
					b.match(/(\d\d):(\d\d):(\d\d)/);
					a = parseInt(RegExp.$1, 10) * 60 * 60 * 1000 + parseInt(RegExp.$2, 10) * 60 * 1000 + parseInt(RegExp.$3, 10) * 1000
				}
				if (b != undefined) {
					j$("#AutoTutorialMsg").text("(施設建設中" + b + "後に完成)")
				}
				setTimeout(function () {
					location.href = "http://" + HOST + "/tutorial/"
				}, a)
			});
			return
		}
		j$("#AjaxTempDOM").load("http://" + HOST + "/facility/select_facility.php?x=" + e[0].x + "&y=" + e[0].y + " #whiteWrapper", function () {
			var a = {};
			a['x'] = e[0].x;
			a['y'] = e[0].y;
			a['village_id'] = j$("input[name='village_id']:eq(0)").val();
			a['ssid'] = j$("input[name='ssid']:eq(0)").val();
			var b = 0;
			var c = e[0].lv;
			var d;
			if (j$("div.th_ttl").length != 0) {
				j$("div.th_ttl").text().match(/レベル(\d+)/);
				b = RegExp.$1
			}
			if (j$("div.sysMes:contains(建設中)").length != 0) {
				b++
			}
			if (j$("table:has(img[src*='facility_" + e[0].id + ".png']) tr:has(th:contains('所要時間')) td").length > 0) {
				BuildTimeStr = j$("table:has(img[src*='facility_" + e[0].id + ".png']) tr:has(th:contains('所要時間')) td").html().trim();
				Pos = BuildTimeStr.indexOf("<span>", 0);
				if (Pos > 0) {
					BuildTimeStr = BuildTimeStr.substr(0, Pos - 1)
				}
				BuildTimeStr.match(/(\d\d):(\d\d):(\d\d)/);
				d = parseInt(RegExp.$1, 10) * 60 * 60 * 1000 + parseInt(RegExp.$2, 10) * 60 * 1000 + parseInt(RegExp.$3, 10) * 1000
			} else {
				d = 0
			}
			if (b == 0) {
				a['id'] = e[0].id
			}
			e.shift();
			if (b >= c) {
				BuildFacility(e)
			} else {
				j$("#AutoTutorialMsg").text("(施設建設中" + BuildTimeStr + "後に完成)");
				j$.post("http://" + HOST + "/facility/build.php", a, function () {
					setTimeout(function () {
						BuildFacility(e)
					}, d + MARGIN)
				})
			}
		})
	}

	function AutoBid(b) {
		if (b.length == 0) {
			j$("#direct_link_lists").val("");
			j$("#auto_bid").removeAttr("disabled");
			return
		}
		var c = b[0].trim();
		var d = new RegExp("http:\\/\\/" + HOST + "\\/card\\/trade_bid.php\\?id=\\d+");
		b.shift();
		if (c.match(d)) {
			j$(document.body).append("<div id=AjaxTempDOM>");
			j$("#AjaxTempDOM").hide();
			j$("#AjaxTempDOM").load(c + " #gray02Wrapper", function () {
				var a = {};
				if (j$("input[name='exhibit_cid']").length != 0) {
					a['t'] = j$("input[name='t']").val();
					a['k'] = j$("input[name='k']").val();
					a['p'] = j$("input[name='p']").val();
					a['s'] = j$("input[name='s']").val();
					a['o'] = j$("input[name='o']").val();
					a['exhibit_cid'] = j$("input[name='exhibit_cid']").val();
					a['exhibit_id'] = j$("input[name='exhibit_id']").val();
					a['buy_btn'] = "落札する"
				} else {
					a['ssid'] = j$("input[name='ssid']").val();
					a['t'] = j$("input[name='t']").val();
					a['k'] = j$("input[name='k']").val();
					a['p'] = j$("input[name='p']").val();
					a['s'] = j$("input[name='s']").val();
					a['o'] = j$("input[name='o']").val();
					a['exhibit_price'] = j$("input[name='exhibit_price']").val();
					a['exhibit_id'] = j$("input[name='exhibit_id']").val();
					a['bid_btn'] = "入札する"
				}
				j$("#notice_msg").text("(トレードID " + j$("input[name=exhibit_id]").val() + " を入札中)");
				j$.post("http://" + HOST + "/card/trade_bid.php", a, function () {
					setTimeout(function () {
						AutoBid(b)
					}, 500)
				})
			})
		} else {
			j$("#notice_msg").text("(有効なトレードリンクではありませんでした)");
			setTimeout(function () {
				AutoBid(b)
			}, 500)
		}
	}
	function AutoYorozudas(b) {
		j$(document.body).append("<div id=AjaxTempDOM>");
		j$("#AjaxTempDOM").hide();
		if (b == 0) {
			setTimeout(function () {
				location.reload(true);
			}, 1000);
			return
		}
		var c = {};
		var d = Math.floor(Math.random() * 500 + 1000);
		c['got_type'] = "0";
		c['send'] = "send";
		j$("#AjaxTempDOM").load(j$('form').attr('action') + " #gray02Wrapper", c, function () {
			if (j$("p:contains('が当たりました')").length != 0) {
				//j$("p:contains('が当たりました')").html().match(/<strong>(.+)&nbsp;/);
				//var a = "<strong>" + RegExp.$1 + "</strong>";
				var a = j$("p:contains('が当たりました') strong").text().replace("\xA0", '', 'g');
				j$("#DrawResult").html(a + "が当たりました!")
			} else {
				j$("#DrawResult").html("<strong>はずれ</strong>を引いてしまいました")
			}
			setTimeout(function () {
				j$("#DrawResult").html("&nbsp;");
				AutoYorozudas(b - 1)
			}, d)
		})
	}
	function Search(l) {
		var m = 1;
		if (j$("a[title='last page']:first").length != 0) {
			j$("a[title='last page']:first").attr("href").match(/p=(\d+)/);
			m = parseInt(RegExp.$1)
		}
		if (l > m) {
			j$("#do_search").removeAttr("disabled");
			j$("#process_msg").text("検索完了( " + l + "/" + m + " )" + j$("#total_counts").val() + " 件見つかりました");
			return
		}
		var n = new Date(j$("#from_y").val(), j$("#from_m").val() - 1, j$("#from_d").val(), j$("#from_h").val());
		var o = new Date(j$("#to_y").val(), j$("#to_m").val() - 1, j$("#to_d").val(), j$("#to_h").val());
		if (n.getTime() > o.getTime()) {
			var p = new Date(n);
			n.setTime(o.getTime());
			o.setTime(p.getTime())
		}
		j$("#process_msg").text("検索中 ( " + l + "/" + m + " )");
		if (j$("#AjaxTempDOM").length == 0) {
			j$(document.body).append("<div id=AjaxTempDOM>");
			j$("#AjaxTempDOM").hide()
		}
		j$("#AjaxTempDOM").load(location.href + "&p=" + l + " #gray02Wrapper", function () {
			var i = new Date(j$("td[class*='contents']:first", this).text().replace(/-/g, "/"));
			var j = new Date(j$("td[class*='contents']:last", this).text().replace(/-/g, "/"));
			var k = false;
			if (n.getTime() - o.getTime() != 0) {
				if (i.getTime() <= n.getTime()) {
					j$("#do_search").removeAttr("disabled");
					j$("#process_msg").text("検索完了( " + l + "/" + m + " )" + j$("#total_counts").val() + " 件見つかりました");
					return
				}
				if (j.getTime() > o.getTime()) {
					k = true
				}
			}
			if (k == false) {
				j$("a[href*='detail.php?id=']:contains('" + j$("#search_query").val().trim() + "')", this).each(function () {
					var a = j$(this).text();
					var b = j$("img", j$(this).parent()).attr("src");
					var c = j$(this).attr("href");
					var d = j$("td[class*='contents']", j$(this).parent().parent()).text();
					var e = j$("a[href*='/facility/castle_send_troop.php']", j$(this).parent().parent()).attr("href");
					var f = j$("img[src*='icon_go.gif']", j$(this).parent().parent()).attr("src");
					var g = true;
					if (n.getTime() - o.getTime() != 0) {
						var h = new Date(d.replace(/-/g, "/"));
						if (n.getTime() > h.getTime() || h.getTime() > o.getTime()) {
							g = false
						}
					}
					if (g == true) {
						j$("#total_counts").val(parseInt(j$("#total_counts").val(), 10) + 1);
						j$("#search_result").append("<li><img src=" + b + " /><a target=_blank href=" + c + ">" + a + "</a>&nbsp;&nbsp;<a target=_blank href=" + e + "><img src=" + f + " /></a>&nbsp;&nbsp;(" + d + ")</li>")
					}
				})
			}
			l++;
			j$.get(location.href + "&p=" + l, function () {
				Search(l)
			})
		})
	}
	function DeleteMsgs(b, c) {
		if (b.length == 0) {
			j$("#notice_msg").text("削除作業中");
			var data = "mode=" + j$("input[name='mode']").val() + "&p=" + j$("form[name='message'] input[name='p']").val();
			for( var i = 0; i < c.length; i++){
				data = data + "&chk[]=" + c[i];
			}
			wrapHttpReq("http://" + HOST + "/message/delete.php", "POST", data,
				function(response) {
					j$("#del_trade_msg").removeAttr("disabled");
					j$("#notice_msg").text("");
					document.location.reload();
				}
			);
		} else {
			var e = b[0].trim();
			e.match(/id=(\d+)/);
			c.push(RegExp.$1);
			b.shift();
			j$.get(e, function () {
				j$("#notice_msg").text("開封作業:残り" + b.length + "件");
				var a = Math.floor(Math.random() * 500);
				setTimeout(function () {
					DeleteMsgs(b, c)
				}, a)
			})
		}
	}
	function Facility(a, b, x, y) {
		this.id = a;
		this.lv = b;
		this.x = x;
		this.y = y
	}
	function addFigure(a) {
		var b = new String(a).replace(/,/g, "");
		while (b != (b = b.replace(/^(-?\d+)(\d{3})/, "$1,$2")));
		return b
	}
}
//end

//--------------------------------------------
// 兵士誤発注回避 2014/03/20 add
//--------------------------------------------
function disp_create_unit_mask() {
	if( location.pathname != "/facility/facility.php" ){
		return;
	}

	jQuery.noConflict();
	$ = jQuery;
	var infantrySkill = new RegExp("(練兵訓練|練兵修練|攻城の檄文|剣兵増強|剣将の采配|老巧の政令|富国強兵|娘々強兵|師君強兵)");
	var spearSkill	  = new RegExp("(兵舎訓練|兵舎修練|強兵の檄文|槍兵増強|槍将の采配|老巧の政令|富国強兵|娘々強兵|師君強兵)");
	var archerSkill   = new RegExp("(弓兵訓練|弓兵修練|強兵の檄文|弓兵増強|弓将の采配|老巧の政令|富国強兵|娘々強兵|師君強兵)");
	var cavalrySkill  = new RegExp("(厩舎訓練|厩舎修練|強兵の檄文|騎兵増強|騎将の采配|老巧の政令|富国強兵|娘々強兵|師君強兵)");
	var ramSkill	  = new RegExp("(兵器訓練|兵器修練|攻城の檄文|老巧の政令|富国強兵|娘々強兵|師君強兵)");
	var scoutSkill	  = new RegExp("(密偵召集|老巧の政令|富国強兵|娘々強兵|師君強兵)");

	if ($("form[name='createUnitForm']").length) {
		$("form[name='createUnitForm']").css("display", "none").before("<div class='usedSkillDislay'>");
		$(".usedSkillDislay").css("padding", "2px").css("background-color", "gray").css("color", "white").css("font-weight", "bold").css("text-decoration", "line-through").text("-");
		$("th:contains('作成する')").wrapInner("<button>").children("button").click(function () {
			jQuery.noConflict();
			$ = jQuery;
			$(this).parent("th").parent("tr").find("form").css("display", "");
		});
		$.get("/village.php", function (a) {
			jQuery.noConflict();
			$ = jQuery;
			var skill = a.match(/basepoint[\s\S]*?domestic_setting[\s\S]*?>([\s\S]*?)\(/)[1];
			$(".usedSkillDislay").text(skill);
			$("form[name='createUnitForm']").css("display", "none");
			if ($("h2").text().match(/練兵所/)) {
				if ($(".usedSkillDislay").text().match(infantrySkill)) {
					$("tr:contains('[剣兵]')").nextAll("tr:has('.usedSkillDislay')").find(".usedSkillDislay").css("background-color", "red");
					$("tr:contains('[剣兵]')").nextAll("tr:has('.usedSkillDislay')").find("form[name='createUnitForm']").css("display", "none");
					$("tr:contains('[盾兵]')").nextAll("tr:has('.usedSkillDislay')").find(".usedSkillDislay").css("background-color", "red");
					$("tr:contains('[盾兵]')").nextAll("tr:has('.usedSkillDislay')").find("form[name='createUnitForm']").css("display", "none");
					$("tr:contains('[大剣兵]')").nextAll("tr:has('.usedSkillDislay')").find(".usedSkillDislay").css("background-color", "red");
					$("tr:contains('[大剣兵]')").nextAll("tr:has('.usedSkillDislay')").find("form[name='createUnitForm']").css("display", "none");
					$("tr:contains('[重盾兵]')").nextAll("tr:has('.usedSkillDislay')").find(".usedSkillDislay").css("background-color", "red");
					$("tr:contains('[重盾兵]')").nextAll("tr:has('.usedSkillDislay')").find("form[name='createUnitForm']").css("display", "none");
				}
				if ($(".usedSkillDislay").text().match(scoutSkill)) {
					$("tr:contains('[斥候]')").nextAll("tr:has('.usedSkillDislay')").find(".usedSkillDislay").css("background-color", "red").css("text-decoration", "none");
					$("tr:contains('[斥候]')").nextAll("tr:has('.usedSkillDislay')").find("form[name='createUnitForm']").css("display", "none");
				}
			}
			if ($("h2").text().match(/^兵舎/)) {
				if ($(".usedSkillDislay").text().match(spearSkill)) {
					$(".usedSkillDislay").css("background-color", "red").css("text-decoration", "none");
					$("form[name='createUnitForm']").css("display", "none");
				}
			}
			if ($("h2").text().match(/弓兵舎/)) {
				if ($(".usedSkillDislay").text().match(archerSkill)) {
					$(".usedSkillDislay").css("background-color", "red").css("text-decoration", "none");
					$("form[name='createUnitForm']").css("display", "none");
				}
			}
			if ($("h2").text().match(/厩舎/)) {
				if ($(".usedSkillDislay").text().match(cavalrySkill)) {
					$(".usedSkillDislay").css("background-color", "red").css("text-decoration", "none");
					$("form[name='createUnitForm']").css("display", "none");
				}
				if ($(".usedSkillDislay").text().match(scoutSkill)) {
					$("tr:contains('[斥候騎兵]')").nextAll("tr:has('.usedSkillDislay')").find(".usedSkillDislay").css("background-color", "red").css("text-decoration", "none");
					$("tr:contains('[斥候騎兵]')").nextAll("tr:has('.usedSkillDislay')").find("form[name='createUnitForm']").css("display", "none");
				}
			}
			if ($("h2").text().match(/兵器工房/)) {
				if ($(".usedSkillDislay").text().match(ramSkill)) {
					$(".usedSkillDislay").css("background-color", "red").css("text-decoration", "none");
					$("form[name='createUnitForm']").css("display", "none");
				}
			}
		});
	}
}

//--------------------------------------------
// 出兵予約メニュー拡張 2014/03/20 add
//--------------------------------------------
function disp_add_troop_reserve_time() {
	if( location.pathname != "/facility/castle_send_troop.php" ){
		return;
	}

	jQuery.noConflict();
	$ = jQuery;
	$("td[class=timeSelectArea]").append(
		"<div><br><div>日時を指定してください(YYYY-MM-DD HH:MI:SS形式。時分秒のみの指定も可)</div><div><input type=text size=24 id=reserve_time_box /><button type=button id=apply_reserved_time>反映</button></div></div>");
	var date = new Date();
	$("#reserve_time_box").attr("value",[date.getFullYear(), ('0'+parseInt(date.getMonth()+1)).slice(-2), ('0'+parseInt(date.getDate())).slice(-2)].join('-') + ' ' + date.toLocaleTimeString());
	$("#apply_reserved_time").bind("click",
		function() {
			jQuery.noConflict();
			$ = jQuery;
			var time_text = $("#reserve_time_box").val();
			if( time_text.indexOf(" ") > 0 ){
				// 日付+時間
				var match = time_text.match(/^(\d+)-(\d+)-(\d+) *(\d+):(\d)(\d):(\d)(\d).*$/);
				if( !match ){
					alert("日時の書式が正しくありません");
				}
				else{
					$("select[name=res_y]").val(match[1]);
					$("select[name=res_m]").val(parseInt(match[2]));
					$("select[name=res_d]").val(parseInt(match[3]));
					$("select[name=res_h]").val(parseInt(match[4]));
					$("select[name=res_i1]").val(parseInt(match[5]));
					$("select[name=res_i2]").val(parseInt(match[6]));
					$("select[name=res_s1]").val(parseInt(match[7]));
					$("select[name=res_s2]").val(parseInt(match[8]));
				}
			} else {
				// 時間
				var match = time_text.match(/^(\d+):(\d)(\d):(\d)(\d).*$/);
				if( !match ){
					alert("日時の書式が正しくありません");
				}
				else{
					$("select[name=res_h]").val(parseInt(match[1]));
					$("select[name=res_i1]").val(parseInt(match[2]));
					$("select[name=res_i2]").val(parseInt(match[3]));
					$("select[name=res_s1]").val(parseInt(match[4]));
					$("select[name=res_s2]").val(parseInt(match[5]));
				}
			}
		}
	);
}

//--------------------------------------------
// 領地一括破棄 2014/10/18 add
//--------------------------------------------
function disp_multiple_drop_territory() {
	if( location.pathname != "/facility/territory_status.php" ){
		return;
	}
	jQuery.noConflict();
	j$ = jQuery;
	var sels = j$("#rotate ul");
	for(var i = 0; i < sels.length; i++) {
		if( !sels.eq(i).hasClass("pager")) {
			sels.eq(i).append('<li class=""><a href="#direct_remove"><span>領地一括破棄</span></a></li>');
		}
	}
	j$("#rotate").append('<div id="direct_remove" class="ui-tabs-panel"></div>');
	j$("#direct_remove").css({"margin-bottom":"5px","font-size":"12pt"});
	j$("#direct_remove").append("<span style='float:left;'>1行には1つだけ座標を記述できます。</span>");
	j$("#direct_remove").append("領地一括破棄 <span id=notice_msg></span>");
	j$("#direct_remove").append("<textarea id=direct_territory_lists rows=11 cols=93>");
	j$("#direct_remove").append("<div id=control_area><input type=button id=auto_territory_remove value=領地破棄></div>");
	j$("#direct_remove").css({"text-align":"right"});
	j$("#auto_territory_remove").bind('click',function(){
		var a = j$("#direct_territory_lists").val().split("\n");
		j$("#auto_territory_remove").attr("disabled","disabled");
		multi_remove_territory(a, "")
	})
}

// 一括領地削除の内部メソッド
function multi_remove_territory(b, e) {
	if (b.length == 0) {
		j$("#notice_msg").html("<font color='blue'><b>一括破棄が完了しました。</b></font>");
		var msg = "";
		if (e.length > 0 ){
			msg = "以下の座標の破棄に失敗しました。確認して下さい。\n---\n" + e + "\n\n";
		}
		msg = msg + "破棄情報は、再度領地管理ページを開くまで「全て表示」のタブに反映されません。注意してください。";
		j$("#direct_territory_lists").val(msg);
		j$("#auto_territory_remove").removeAttr("disabled");
		return;
	}
	var c = b[0].trim();
	b.shift();
	var m = c.match(/^[ ]*[\(（]{0,1}[ ]*(-?\d+)[ ]*[，、,\t][ ]*(-?\d+)[ ]*[\)）]{0,1}/);
	if (m) {
		j$(document.body).append("<div id=AjaxTempDOM>");
		j$("#AjaxTempDOM").hide();
		j$("#AjaxTempDOM").load(c + " #gray02Wrapper", function () {
			var a = {};
			j$("#notice_msg").html("<font color='red'><b>領地(" + m[1] + "," + m[2] + ")を破棄中</b></font>");
			var url = "http://" + HOST + "/territory_proc.php?x=" + m[1] + "&y=" + m[2] + "&mode=remove";
			j$.post(url, {}, function (response) {
				var rmtime = response.match(/(現在領地を破棄中です)[^\d]*\n*(\d+-\d+-\d+ \d+:\d+:\d+)/ );
				if( rmtime ) {
					if( rmtime[1] == "現在領地を破棄中です" ) {
						addTerritoryList(rmtime[2], 0, m[1], m[2]);
					}
				} else {
					e = e + c + " : マップ外の座標か、保持していない領地が指定された\n";
				}
				setTimeout(function () {
					multi_remove_territory(b, e)
				}, 500)
			})
		})
	} else {
		if (c.length > 0) {
			j$("#notice_msg").html("<font color='red'><b>(座標 " + c + "が解釈できませんでした)</b></font>");
			e = e + c + " : [座標として解釈不能]\n";
		}
		setTimeout(function () {
			multi_remove_territory(b, e)
		}, 500)
	}
}

//------------------------------------
// 拠点化予約破棄をマップ詳細に追加
//------------------------------------
function disp_addReserveLink() {
	if( location.pathname != "/land.php" ) {
		return;
	}
	jQuery.noConflict();
	j$ = jQuery;

	j$("span.xy").text().match(/^\(([-]*\d+),([-]*\d+)\)/);
	var x = RegExp.$1;
	var y = RegExp.$2;

	var status = isReserve(x,y);
	if (status == -1 ) {
		j$("#tMenu_btnif a").attr("style", "margin-bottom:0px !important;");

		j$("#tMenu_btnif ul").eq(0).before('<div id="reserve_village"><br><a class="easy" style="margin-bottom: 0px !important;">拠点建築（村）を予約する</a></div>');
		j$("#reserve_village").bind("click",
			function() {
				if(confirm("この土地に村の建築を予約しますか？。\n予約は建築を保証するものではありません。")) {
					addReserveList(0, x, y);
					alert("座標(" + x + "," + y + ")に村の建築を予約しました。");
					location.reload();
					return;
				}
			}
		);

		j$("#tMenu_btnif ul").eq(0).before('<div id="reserve_fortress"><br><a class="easy" style="margin-bottom: 0px !important;">拠点建築（砦）を予約する</a></div>');
		j$("#reserve_fortress").bind("click",
			function() {
				if(confirm("この土地に砦の建築を予約しますか？。\n予約は建築を保証するものではありません。")) {
					addReserveList(1, x, y);
					alert("座標(" + x + "," + y + ")に砦の建築を予約しました。");
					location.reload();
				}
			}
		);
	} else {
		var target;
		if ( status == 0 ) {
			target = "（村）";
		} else {
			target = "（砦）";
		}

		j$("#tMenu_btnif ul").eq(0).before('<div id="reserve_cancel"><br><a class="easy" style="margin-bottom: 0px !important;">拠点建築' + target + 'の予約を取り消す</a></div>');
		j$("#reserve_cancel").bind("click",
			function() {
				if(confirm("この土地の拠点の予約を取り消しますか？")) {
					delReserveList(x, y);
					alert("座標(" + x + "," + y + ")の建築予約を取り消しました。");
					location.reload();
				}
			}
		);
	}
}

//-----------------------------
// 予約の実行
//-----------------------------
function exec_reserve() {
	var lists = cloadData("ReserveList", "[]", true, true);
	if (!lists || lists.length == 0) {
		return;
	}

	// すでに建設されている拠点がリストにいたら消す
	j$("div[class=sideBoxInner basename] ul li").each(function() {
		var text = "";
		if (j$(this).attr("class") == 'on') {
			text = j$("span", this).eq(0).attr("title");
		} else {
			text = j$("a", this).eq(0).attr("title");
		}
		var info =text.match(/ \(([-]*\d+),([-]*\d+)\)/);
		var x = RegExp.$1;
		var y = RegExp.$2;
		if (!isNaN(parseInt(x)) && !isNaN(parseInt(y))) {
			delReserveList(x, y);
		}
	});

	var time = cloadData("ReserveLastExecTime", "null", true, true);
	var now = new Date();
	if( time != "null") {
		var div = now.getTime() - parseInt(time);
		if( div < 1800000 ) {
			// 3分経過していなければなにもしない
			setInterval(exec_reserve() , 1000000);
			return;
		}
	}
	// 予約実行(建設)
	for( var i = 0; i < lists.length; i++ ){
		if( lists[i].kind != 2 ){
			exec_build_base(lists[i].kind, lists[i].x, lists[i].y);
		}
	}
	csaveData("ReserveLastExecTime", String(now.getTime()), true, true);
}

// 拠点建設
function exec_build_base(type, x, y) {
	var url = "http://" + location.hostname + "/facility/select_type.php?x=" + x + "&y=" + y + "&mode=build";
	if (type == 0) {  // 村
		url = url + "&type=220";
	} else {
		url = url + "&type=222";
	}

	var execMain = setTimeout(function(){
		GM_xmlhttpRequest({
			method: "GET",
			url: url,
			headers: {"Content-type":"application/x-www-form-urlencoded"},
			onload: function(res){
				var success = res.responseText.match(/(建設中です)[^\d]*\n(\d+-\d+-\d+ \d+:\d+:\d+)/ );
				if (success.length > 1) {
					delReserveList(x, y);
					addTerritoryList(success[2], parseInt(kind)+3, x, y);
				}
			}
		});
	}, 500);
}

//ひろひろひろ 20120424 SSID取得のためにクッキー取得関数
function getCookie(key) {
	var tmp1 = " " + document.cookie + ";";
	var tmp2;
	var xx1 = 0;
	var xx2 = 0;
	var xx3;
	var len = tmp1.length;
	while (xx1 < len) {
		xx2 = tmp1.indexOf(";", xx1);
		tmp2 = tmp1.substring(xx1 + 1, xx2);
		xx3 = tmp2.indexOf("=");
		if (tmp2.substring(0, xx3) == key) {
			return(unescape(tmp2.substring(xx3 + 1, xx2 - xx1 - 1)));
		}
		xx1 = xx2 + 1;
	}
	return("");
}
function hiro_buildfacility(f,x,y,vId){
	var villageId = getVillageID(vId);
	if(villageId == 'undefined') {
		alert("村IDがとれなかったため、プロフィールページにリダイレクトします。");
		location.href = location.hostname + "/user/#ptop";
		return;
	}

	var d = document;
	var bilderForm_ssid	   = d.createElement("input");bilderForm_ssid.type	  ="hidden";bilderForm_ssid.name	   ="ssid";	  bilderForm_ssid.value	  = getCookie("SSID");
	var bilderForm_id		 = d.createElement("input");bilderForm_id.type		="hidden";bilderForm_id.name		 ="id";		bilderForm_id.value		= f;
	var bilderForm_x		  = d.createElement("input");bilderForm_x.type		 ="hidden";bilderForm_x.name		  ="x";		 bilderForm_x.value		 = x;
	var bilderForm_y		  = d.createElement("input");bilderForm_y.type		 ="hidden";bilderForm_y.name		  ="y";		 bilderForm_y.value		 = y;
	var bilderForm_village_id = d.createElement("input");bilderForm_village_id.type="hidden";bilderForm_village_id.name ="village_id";bilderForm_village_id.value= getVillageID(vId);
	var bilderForm			= d.createElement("form");bilderForm.id="bilderForm";bilderForm.method="post";bilderForm.name="facilityCreateForm1";bilderForm.action="/facility/build.php";
	bilderForm.appendChild(bilderForm_ssid);
	bilderForm.appendChild(bilderForm_id);
	bilderForm.appendChild(bilderForm_x);
	bilderForm.appendChild(bilderForm_y);
	bilderForm.appendChild(bilderForm_village_id);
	var objBody = d.getElementsByTagName("body").item(0);
		objBody.appendChild(bilderForm);
	d.getElementById("bilderForm").submit();
}
function hiro_lvupfacility(x,y,vId){
	var villageId = getVillageID(vId);
	if(typeof(villageId) == 'undefined') {
		alert("村IDがとれなかったため、プロフィールページにリダイレクトします。");
		location.href = location.hostname + "/user";
		return;
	}

	var d = document;
	var bilderForm_ssid	   = d.createElement("input");bilderForm_ssid.type	  ="hidden";bilderForm_ssid.name	   ="ssid";	  bilderForm_ssid.value	  = getCookie("SSID");
	var bilderForm_x		  = d.createElement("input");bilderForm_x.type		 ="hidden";bilderForm_x.name		  ="x";		 bilderForm_x.value		 = x;
	var bilderForm_y		  = d.createElement("input");bilderForm_y.type		 ="hidden";bilderForm_y.name		  ="y";		 bilderForm_y.value		 = y;
	var bilderForm_village_id = d.createElement("input");bilderForm_village_id.type="hidden";bilderForm_village_id.name ="village_id";bilderForm_village_id.value= getVillageID(vId);
	var bilderForm			= d.createElement("form");bilderForm.id="bilderForm";bilderForm.method="post";bilderForm.name="facilityCreateForm1";bilderForm.action="/facility/build.php";
	bilderForm.appendChild(bilderForm_ssid);
	bilderForm.appendChild(bilderForm_x);
	bilderForm.appendChild(bilderForm_y);
	bilderForm.appendChild(bilderForm_village_id);
	var objBody = d.getElementsByTagName("body").item(0);
		objBody.appendChild(bilderForm);
	d.getElementById("bilderForm").submit();
}
function hiro_buildfacitity2(buildfacitity2_ssid,buildfacitity2_id,buildfacitity2_x,buildfacitity2_y,buildfacitity2_village_id){
	var d = document;
	var bilderForm_ssid	   = d.createElement("input");bilderForm_ssid.type	  ="hidden";bilderForm_ssid.name	   ="ssid";	  bilderForm_ssid.value	  = buildfacitity2_ssid;
	var bilderForm_id	   = d.createElement("input");bilderForm_id.type	  ="hidden";bilderForm_id.name	   ="id";	  bilderForm_id.value	  = buildfacitity2_id;
	var bilderForm_x		  = d.createElement("input");bilderForm_x.type		 ="hidden";bilderForm_x.name		  ="x";		 bilderForm_x.value		 = buildfacitity2_x;
	var bilderForm_y		  = d.createElement("input");bilderForm_y.type		 ="hidden";bilderForm_y.name		  ="y";		 bilderForm_y.value		 = buildfacitity2_y;
	var bilderForm_village_id = d.createElement("input");bilderForm_village_id.type="hidden";bilderForm_village_id.name ="village_id";bilderForm_village_id.value= buildfacitity2_village_id;
	var bilderForm			= d.createElement("form");bilderForm.id="bilderForm";bilderForm.method="post";bilderForm.name="facilityCreateForm1";bilderForm.action="/facility/build.php";
	bilderForm.appendChild(bilderForm_ssid);
	bilderForm.appendChild(bilderForm_id);
	bilderForm.appendChild(bilderForm_x);
	bilderForm.appendChild(bilderForm_y);
	bilderForm.appendChild(bilderForm_village_id);
	var objBody = d.getElementsByTagName("body").item(0);
		objBody.appendChild(bilderForm);
	d.getElementById("bilderForm").submit();
}

//---------------------------------------------
// 領地破棄系マッピングを外にだしてみる
//---------------------------------------------
function addTerritoryList(tim, kind, x, y){ //kind=0:領地破棄 1:村破棄 2:砦破棄 3:村作成 4:砦作成 5:領地LvUp
	if( !cloadData("OPT_REMOVELIST", 1) ){
		return;
	}
	var lists = cloadData("RemoveList", "[]", true, true);

	for(var i=0 ; i<lists.length ; i++) {
		if(lists[i].x == x && lists[i].y == y ) {
			return;
		}
	}
	lists.push({"x":x, "y":y, "time":tim, "kind":kind } );
	lists.sort( function(a,b){
		if(a.time > b.time) return 1;
		if(a.time < b.time) return -1;
		return 0;});
	csaveData( "RemoveList", lists, true, true );
}
function delTerritoryList(kind, x, y){ //kind=0:land 1:castle
	if( !cloadData("OPT_REMOVELIST", 1) ){
		return;
	}
	var lists = cloadData("RemoveList", "[]", true, true);

	for(var i=0 ; i<lists.length ; i++) {
		if(lists[i].x == x && lists[i].y == y ) {
			if( ( ( lists[i].kind == 1 || lists[i].kind == 2 ) && kind == 1 ) ||
				( ( lists[i].kind == 0 || lists[i].kind == 3 || lists[i].kind == 4 || lists[i].kind == 5 ) && kind == 0 ) ) {
				lists.splice(i,1);
				csaveData( "RemoveList", lists, true, true );
				break;
			}
		}
	}
}

//---------------------------------------------
// 拠点予約破棄リストの制御メソッド
//---------------------------------------------
function addReserveList(kind, x, y){ //kind=0:村予約 1:砦予約、2:破棄予約
	if( !cloadData("OPT_RESERVE_VILLAGE", 1) ){
		return;
	}
	var lists = cloadData("ReserveList", "[]", true, true);

	for(var i=0 ; i<lists.length ; i++) {
		if(lists[i].x == x && lists[i].y == y ) {
			lists.splice(i,1);
			break;
		}
	}
	lists.push({"x":x, "y":y, "kind":kind } );
	csaveData( "ReserveList", lists, true, true );
}

function isReserve(x, y){
	if( !cloadData("OPT_RESERVE_VILLAGE", 1) ){
		return -1;
	}
	var lists = cloadData("ReserveList", "[]", true, true);

	for(var i=0 ; i<lists.length ; i++) {
		if(lists[i].x == x && lists[i].y == y ) {
			return lists[i].kind;
		}
	}
	return -1;
}

function delReserveList(x, y){
	if( !cloadData("OPT_RESERVELIST", 1) ){
		return;
	}
	var lists = cloadData("ReserveList", "[]", true, true);

	for(var i=0 ; i<lists.length ; i++) {
		if(lists[i].x == x && lists[i].y == y ) {
			lists.splice(i,1);
			csaveData( "ReserveList", lists, true, true );
			break;
		}
	}
}

//------------------------------------------------
// 一括破棄画面から保護解除出品をできるようにする
//------------------------------------------------
function allCardDeleteCustom() {
	if( location.pathname != "/card/allcard_delete.php" ) {
		return;
	}

	jQuery.noConflict();
	j$ = jQuery;

	if( j$("input[class=sortSubmit]").length == 0 ) {
		return;
	}

	var ssid = j$("input[name=ssid]").eq(0).attr("value");

	j$("#rotate").css("width", "700px");
	j$("div.rotateInfo").css("width", "700px");
	j$("div.deletesortTitle").css("width", "686px");
	j$("div.deletesortSystem").css("width", "686px");
	j$("#allcard_delete").css("width", "690px");
	j$("tr.tradeTop").append('<th class="thbg_color_orange">ステータス</th>');
	j$("tr.tradeTop").append('<th class="thbg_color_orange" style="width: 80px;">出品</th>');
	j$("tr.tradeTop th").eq(3).css("width", "85px");
	j$("#allcard_delete tr").each(function() {
		if(j$(this).attr("class") == "tradeTop" ){
			return;
		}
		var s = j$('div[id*="cardWindow_"]', this);
		var p = s.eq(0).attr("id").match(/_(\d+)/);
		var id = RegExp.$1;

		var cardno = j$('span[class="cardno"]', s).eq(0).text();
		var cost = j$('span[class="cost"]', s).eq(0).text();
		var soltype = j$('span[class="soltype"] img', s).eq(0).attr("title");
		var att = j$('li[class="status_att"]', s).eq(0).text();
		var int = j$('li[class="status_int"]', s).eq(0).text();
		var wdef = j$('li[class="status_wdef"]', s).eq(0).text();
		var sdef = j$('li[class="status_sdef"]', s).eq(0).text();
		var bdef = j$('li[class="status_bdef"]', s).eq(0).text();
		var rdef = j$('li[class="status_rdef"]', s).eq(0).text();
		var spd = j$('li[class="status_speed"]', s).eq(0).text();
		var o = j$('div[class*="omote_"]', s).eq(0).attr("class").match(/_rarerity_(.*)_/);
		var ori;
		if(RegExp.$1 == "shoku" ){
			ori = "蜀";
		}else if (RegExp.$1 == "gi"){
			ori = "魏";
		}else if (RegExp.$1 == "go"){
			ori = "呉";
		}else if (RegExp.$1 == "ha"){
			ori = "覇";
		}else{
			ori = "他";
		}

		j$(this).append(
			'<td style="padding:0px 0px;"><table><tbody>' +
				'<tr>' +
					'<th style="font-size:9px; width:27px;">cost</th><td style="font-size:10px; width:50px; padding:0px 0px;">' + cost + '</td>' +
					'<th style="font-size:10px; width:27px;">所属</th><td style="font-size:10px; width:50px; padding:0px 0px;">' + ori + '</td>' +
				'</tr>' +
				'<tr>' +
					'<th style="font-size:10px; width:27px;">攻撃</th><td style="font-size:10px; width:50px; padding:0px 0px;">' + att + '</td>' +
					'<th style="font-size:10px; width:27px;">知力</th><td style="font-size:10px; width:50px; padding:0px 0px;">' + int + '</td>' +
				'</tr>' +
				'<tr>' +
					'<th style="font-size:10px; width:27px;">歩防</th><td style="font-size:10px; width:50px; padding:0px 0px;">' + wdef + '</td>' +
					'<th style="font-size:10px; width:27px;">槍防</th><td style="font-size:10px; width:50px; padding:0px 0px;">' + sdef + '</td>' +
				'</tr>' +
				'<tr>' +
					'<th style="font-size:10px; width:27px;">弓防</th><td style="font-size:10px; width:50px; padding:0px 0px;">' + bdef + '</td>' +
					'<th style="font-size:10px; width:27px;">騎防</th><td style="font-size:10px; width:50px; padding:0px 0px;">' + rdef + '</td>' +
				'</tr>' +
				'<tr>' +
					'<th style="font-size:10px; width:27px;">移速</th><td style="font-size:10px; width:50px; padding:0px 0px;">' + spd + '</td>' +
					'<th style="font-size:10px; width:27px;">兵科</th><td style="font-size:10px; width:50px; padding:0px 0px;">' + soltype + '</td>' +
				'</tr>' +
			'</td>'
		);
		j$(this).append(
			'<td>' +
			'<div id="lock' + id + '" style="display:none"><input id="lockbutton' + id + '" type="button" value="カードを保護"><div>&nbsp;</div></div>' +
			'<div id="unlock' + id + '" style="display:none"><input id="unlockbutton' + id + '" type="button" value="保護を解除"></div>' +
			'<div id="trade' + id + '" style="display:none"><input id="tp' + id + '" type="text" size="6" value="499"><input id="salebutton' + id + '" type="button" value="出品"></div>' +
			'<div id="research' + id + '" style="display:none"><input id="researchbutton' + id + '" type="button" value="即落価格調査"></div>' +
			'</td>'
		);
		if(j$('td[class="center"]', this).eq(0).html().match(/icon_lock/)) {
			j$("#unlock" + id, this).css("display", "inline");
		}else{
			j$("#lock" + id, this).css("display", "inline");
			j$("#trade" + id, this).css("display", "inline");
			j$("#research" + id, this).css("display", "inline");
		}

		// イベント定義(保護解除)
		j$("#unlockbutton" + id).bind("click",
			function() {
				var data = "deck_file=&target_card=" + id + "&mode=deprotect&p=1&btn_change_flg=&ssid=" + ssid;
				wrapHttpReq("http://" + HOST + "/card/deck.php", "POST", data,
					function(response) {
						// 破棄チェックボックスの追加
						j$("#unlock" + id).parent().parent().children('td[class="center"]').eq(0).html(
							'<input type="checkbox" value="1" name="card_id[' + id + ']"></input>'
						);
						j$("#lock" + id).css("display", "inline");
						j$("#unlock" + id).css("display", "none");
						j$("#trade" + id).css("display", "inline");
						j$("#research" + id).css("display", "inline");
					}
				);
			}
		);

		// イベント定義(保護)
		j$("#lockbutton" + id).bind("click",
			function() {
				var data = "deck_file=&target_card=" + id + "&mode=protect&p=1&btn_change_flg=&ssid=" + ssid;
				wrapHttpReq("http://" + HOST + "/card/deck.php", "POST", data,
					function(response) {
						// 保護アイコンの追加
						j$("#lock" + id).parent().parent().children('td[class="center"]').eq(0).html(
							'<img src="/20141114-01/extend_project/w945/img/card/common/icon_lock.gif"></img>'
						);
						j$("#lock" + id).css("display", "none");
						j$("#unlock" + id).css("display", "inline");
						j$("#trade" + id).css("display", "none");
						j$("#research" + id).css("display", "none");
					}
				);
			}
		);

		// イベント定義(出品)
		j$("#salebutton" + id).bind("click",
			function() {
				var tp = j$("#tp" + id).attr("value");
				var data = "exhibit_cid=" + id + "&exhibit_price=" + tp + "&ssid=" + ssid + "&exhibit_btn=出品する";
				wrapHttpReq("http://" + HOST + "/card/exhibit_confirm.php", "POST", data,
					function(response) {
						wrapHttpReq("http://" + HOST + "/card/exhibit_list.php", "GET", "",
							function(response) {
								var cardstr = "cardWindow_" + id;
								if(response.match(cardstr) != null) {
									j$("#trade" + id).parent().parent().children('td[class="center"]').eq(0).html(
										'<div><b><font color="blue">出品済</font></b></div>'
									);
									j$("#trade" + id).html(
										'<div><b><font color="blue">出品完了<br>' + tp + 'TP</font></b></div>'
									);
								} else {
									j$("#trade" + id).html(
										'<div><b><font color="red">出品失敗</font></b></div>'
									);
								}
							}
						);
					}
				);
			}
		);

		// イベント定義(即落価格調査)
		j$("#researchbutton" + id).bind("click",
			function() {
				j$("#research" + id).html(
					'<div><b><font color="blue">検索中..</font></b></div>'
				);
				var result = searchImmediateTradeCards("t=no&k=" + cardno, 1000000, 1, "tp");
				if (result == null) {
					j$("#research" + id).html(
						'<div><b><font color="red">出品なし</font></b></div>'
					);
				} else if (result.length == 0) {
					j$("#research" + id).html(
						'<div><b><font color="red">即落なし</font></b></div>'
					);
				} else {
					j$("#research" + id).html(
						'<div><b><font color="blue">' + result[0][1] + '</font></b></div>'
					);
				}
			}
		);
	});
}

//------------------------------------
// カード検索
// 指定条件の即時落札カードを探す
//------------------------------------
// searchCondtionsはカード検索条件の文字列を設定
// limitTpは指定したときそれ以下のものが検索対象。
// searchCounts枚数の即時落札カードを返す。
// returnType = "tp"の場合、tpの配列、"html"の場合、検索されたテーブル列のhtmlの配列が返る
function searchImmediateTradeCards(searchConditions, limitTp, searchCounts, returnType) {
	jQuery.noConflict();
	j$ = jQuery;

	var results = [];

	// 検索結果1ページ目を取得
	var targetUrl = "http://" + location.hostname + "/card/trade.php?";
	var firstPage = j$("<dim>").html(loadRequestPage(targetUrl + "s=price&o=a&" + searchConditions, ""));
	var trades = j$("table[class=tradeTables]", firstPage);
	if(trades.length == 0) {
		return null;
	}

	// 最大ページ番号を取得
	var maxPageNo = 1;
	j$("form[id=trade] div[class=ui-tabs-panel] ul[class=pager] li", firstPage).each(
		function(){
			var title;
			if(j$("a", this).length > 0) {
				title = j$("a", this).attr("title");
			} else {
				title = j$(this).text();
			}
			if(title != "" && parseInt(title) > 0) {
				maxPageNo = parseInt(title);
			}
		}
	);

	// 1ページ目の即時落札カードの検索
	var final = false;
	j$('tr', trades).each(function(index){
		if (results.length >= searchCounts || final == true || index == 0) {
			return;
		}
		var price = j$("td[class=right]", this).eq(3).text().replace(/,/, '');
		var limit = j$("td[class=limit]", this).eq(0).text();
		if (limit == "---") {
			if (parseInt(price) <= limitTp) {
				var bidInfo = j$("td[class=trade] a", this);
				var bid = 0;
				if (bidInfo.length > 0) {
					var bidMatch = j$(bidInfo).attr("href").match(/id=(\d+)&t=/);
					bid = RegExp.$1;
				}
				var cardIdInfo = j$("td[class=busho] div[id*=cardWindow_]", this).attr("id").match(/cardWindow_(\d+)/);
				var tpstr;
				if( parseInt(price) > 1000) {
					tpstr = parseInt(price/1000) + "," + price.substr(price.length - 3, 3);
				} else {
					tpstr = price;
				}
				if (returnType == "tp") {
					results.push([RegExp.$1, tpstr + " TP", price, bid]);
				} else {
					results.push([RegExp.$1, j$("<div>").append(j$(this).clone()).html(), price, bid]);
				}
			} else {
				final = true;
			}
		}
	});

	// 2ページ目以降の検索
	if (results.length < searchCounts && final == false) {
		for(var i = 2; i <= maxPageNo; i++) {
			var pageData = j$("<dim>").html(loadRequestPage(targetUrl + "s=price&o=a&p=" + i + "&" + searchConditions, ""));
			var trades = j$("table[class=tradeTables]", pageData);
			j$('tr', trades).each(function(index){
				if (results.length >= searchCounts || final == true || index == 0) {
					return;
				}
				var price = j$("td[class=right]", this).eq(3).text().replace(/,/, '');
				var limit = j$("td[class=limit]", this).eq(0).text();
				if (parseInt(price) <= limitTp) {
					var bidInfo = j$("td[class=trade] a", this);
					var bid = 0;
					if (bidInfo.length > 0) {
						var bidMatch = j$(bidInfo).attr("href").match(/id=(\d+)&t=/);
						bid = RegExp.$1;
					}
					var cardIdInfo = j$("td[class=busho] div[id*=cardWindow_]", this).attr("id").match(/cardWindow_(\d+)/);
					var tpstr;
					if( parseInt(price) > 1000) {
						tpstr = parseInt(price/1000) + "," + price.substr(price.length - 3, 3);
					} else {
						tpstr = price;
					}
					if (returnType == "tp") {
						results.push([RegExp.$1, tpstr + " TP", price, bid]);
					} else {
						results.push([RegExp.$1, j$("<div>").append(j$(this).clone()).html(), price, bid]);
					}
				} else {
					final = true;
				}
			});
			if (results.length > searchCounts || final == true) {
				break;
			}
		}
	}

	return results;
}

//------------------------------------
// カード落札
//------------------------------------
function buyCard(cardId, tradeBid) {
	var url = "http://" + location.hostname + "/card/trade_bid.php";
	var data = "exhibit_cid=" + cardId + "&exhibit_id=" + tradeBid + "&buy_btn=落札する";
	syncPost(url, data);
}

//------------------------------------
// 合成画面にスキルとスコアを出す
//------------------------------------
function showRecipeSkill() {
	jQuery.noConflict();
	j$ = jQuery;

	if (location.pathname != '/union/add_lv.php') {
		return;
	}

	j$("div[class=deckcostList] tr[class=use]").each(
		function() {
			var skills = ["", "", "", ""];
			j$("ul[class=front_skill] li", this).each(
				function(index) {
					skills[index] = j$(this).text();
				}
			);
			j$("th", this).attr("rowspan", 2);
			j$(this).after("<tr><td>" + skills[0] + "</td><td>" + skills[1] + "</td><td>" + skills[2] + "</td><td>" + skills[3] + "</td></tr>");
		}
	);
}

//------------------------------------
// 連続スキルレベルアップ
//------------------------------------
function autoSkillUp() {
	if (location.pathname != '/union/lvup.php') {
		return;
	}

	// スキルレベルアップ対象のスキルを取得し、画面に描画
	var skills = [];
	j$("#bacecard div[class=back] span[class*=skillName]").each(
		function() {
			if (j$(this).text().replace(/[\n ]/g,"") == "") {
				return;
			}
			skills[skills.length] = j$(this).text();
		}
	);
	var html = '<fieldset style="-moz-border-radius:5px; border-radius: 5px; -webkit-border-radius: 5px; margin-left: 10px; margin-top: 10px; margin-bottom:6px; border: 3px solid black;">' +
			   '<legend style=" background-color:black; color:white; -moz-border-radius:5px; border-radius: 5px; -webkit-border-radius: 5px; margin-left:10px; font-weight:bold; padding:4px 4px">連続スキルレベルアップ</legend>';
	html += '<div style="font-weight:bold; color:red; padding:2px;">ベースカードと同一カードNoのカードをレベルアップ素材として、連続でスキルレベルアップを実施します。<br>保護カードは素材対象外となります。</div><div style="height:4px;"></div>';
	for (var i = 1; i <= skills.length; i++) {
		if(skills[i-1].match(/LV10/)) {
			html += '<div style="padding:2px; font-weight:bold;">' +
						'<input type="radio" name="hoge" value="' + i + '" for="l' + i + '" disabled>' +
							'<label id="l' + i + '" style="margin-left:2px; position:relative; top:-2px; color:gray;">' + skills[i-1] +
						'</input>' +
					'</div>';
		} else {
			html += '<div style="padding:2px; font-weight:bold;"><input type="radio" name="skillUpTarget" value="' + i + '" id="l' + i + '"><label id="ll' + i + '" for="l' + i + '" style="margin-left:2px; position:relative; top:-2px;">' + skills[i-1] + '</input></div>';
		}
	}
	html += '<div id=lvupDiv style="text-align:center;"><label>停止レベル</label><input type=text size=2 id=limitLv value="10"><input type=button id=multiLvUpStart value="連続合成実行"></div><div id=lvupResult style="text-align:center;"></div></fieldset>';

	j$("#bacecard div[class=left]").append(html);

	j$("#multiLvUpStart").bind("click",
		function() {

			// 自動レベルアップステップ1（対象カード抽出）
			autoLevelUpStep1();
		}
	);
}

// 自動レベルアップステップ１（素材カードの抽出）
function autoLevelUpStep1() {
	var targetSkill = j$("#bacecard div[class=left] input[name=skillUpTarget]:checked").val();
	if (targetSkill == undefined) {
		alert("レベルアップ対象のスキルを選択してください。");
		return;
	}

	var limitLv = parseInt(j$("#limitLv").val());
	if (limitLv < 2 || limitLv > 10) {
		alert("停止レベルは2-10までの数値で指定してください。");
		return;
	}

	// ベースカードのカードNo
	var baseCardNo = j$("#gray02Wrapper form[name=union_data] input[name=base_cid]").attr("value");

	// ベースカードの武将ID
	var baseCardId = j$("#gray02Wrapper div[id=bacecard] span[class=cardno]").text();

	// デッキ表示方式
	var deckType = j$("select[class=sortTotal] option[selected=selected]").eq(0).val();

	// 素材リストの最大ページ番号を取得
	var maxPageNo = 1;
	j$("div[class=rotateInfo clearfix] ul[class=pager] li").each(
		function(){
			var title;
			if(j$("a", this).length > 0) {
				title = j$("a", this).attr("title");
			} else {
				title = j$(this).text();
			}
			if(title != "" && parseInt(title) > 0) {
				maxPageNo = parseInt(title);
			}
		}
	);

	var noList = [];
	var wait = new Wait(
		function() {
			if (noList.length == 0) {
				j$("#lvupDiv").html("<span style='background-color:red; color:white; font-weight:bold;'>使用可能な素材がありません。</span>");
			} else {
				j$("#lvupDiv").html("<span style='color:black; font-weight:bold;'>STEP1完了。素材枚数は" + noList.length + "でした。</span>");
				autoLevelUpStep2(baseCardNo, noList, targetSkill, limitLv);
			}
		}, maxPageNo
	);

	// 素材ページを検索
	for (var i = 1; i <= maxPageNo; i++) {
		setTimeout(
			wait.createCallBack(
				function(page, max, targetCardId, targetCardNo, deckType, obj) {
					j$("#lvupDiv").html("<span style='color:red; font-weight:bold;'>素材カード検索中(" + page + "/" + max + ")</span>");
					var pageData = j$("<dim>").html(loadRequestPage("http://" + location.hostname + "/union/lvup.php?p=" + page + "&cid=" + targetCardNo));

					// デッキ表示状態により分岐
					if (deckType == 101 || deckType == 102) {
						// 大カード表示
						var statuses = j$("#cardFileList div[class=cardColmn]", pageData);
						for( var j = 0; j < statuses.length; j++ ) {
							if (j$("div[class=control] a[class=protection]", statuses.eq(j)).length > 0) {
								// 保護カードは無視
								continue;
							}
							var cardId = j$("span[class=cardno]", statuses.eq(j)).text();
							if (cardId == baseCardId) {
								j$("div[class=control]", statuses.eq(j)).html().match(/union_lvup\((\d+\))/);
								obj.push(RegExp.$1);
							}
						}
					} else {
						// 小カード表示
						var statuses = j$("#cardFileList div[class=statusDetail clearfix]", pageData);
						for( var j = 0; j < statuses.length; j++ ) {
							if (j$("div[class=control new-mode] a[class=protection]", statuses.eq(j).parent()).length > 0) {
								// 保護カードは無視
								continue;
							}
							var target = j$("div[class=right] td", statuses.eq(j));
							// カードIDがベースと一致する物のみ対象
							var cardId = parseInt(target.eq(0).text());
							if (cardId == baseCardId) {
								// 処理用のカード番号
								j$("div[id*=cardWindow_]", statuses.eq(j).parent()).attr("id").match(/_(\d+)/);
								obj.push(RegExp.$1);
							}
						}
					}
				}
			),
		1000, i, maxPageNo, baseCardId, baseCardNo, deckType, noList);
	}
}

// 自動レベルアップステップ２（レベルアップスキルのスキルID取得）
function autoLevelUpStep2(baseCardNo, targetCardNoList, targetSkill, limitLv) {
	var skillValue = [];
	var wait = new Wait(
		function() {
			if (skillValue.length == 0) {
				j$("#lvupDiv").html("<span style='background-color:red; color:white; font-weight:bold;'>スキルIDの取得に失敗しました。</span>");
			} else {
				j$("#lvupDiv").html("<span style='color:black; font-weight:bold;'>STEP2完了。</span>");
				autoLevelUpStep3(baseCardNo, targetCardNoList, skillValue[0], targetSkill, limitLv);
			}
		}, 1
	);
	setTimeout(
		wait.createCallBack(
			function(baseCardNo, targetCardNoList) {
				j$("#lvupDiv").html("<span style='color:red; font-weight:bold;'>合成スキルID検索中</span>");
				var pageData = j$("<dim>").html(syncPost("http://" + location.hostname + "/union/union_lv.php", "base_cid=" + baseCardNo + "&added_cid=" + targetCardNoList[0]));
				skillValue.push(j$("table[class=choiceSkill union] input[id*=selected_skill_radio]", pageData).eq(targetSkill-1).attr("value"));
			}
		)
	, 1000, baseCardNo, targetCardNoList);
}

// 自動レベルアップステップ３（レベルアップ実行）
function autoLevelUpStep3(baseCardNo, targetCardNoList, skillValue, targetSkill, limitLv) {
	var ssid = j$("input[name=ssid]").eq(0).attr("value");
	var lvUpSkill = [];
	lvUpSkill.push(skillValue);

	// カードがなくなるまで
	var wait = new Wait(
		function() {
			skillLvUpFinal();
		}, targetCardNoList.length
	);
	for( var i = 0; i < targetCardNoList.length; i++) {
		setTimeout(
			wait.createCallBack(
				function(now, max, baseCardNo, targetCardNo, skillObj, targetSkill, limitLv) {
					// 指定したスキレベになったら止める
					if (parseInt(skillObj[0].substr(5,1)) > limitLv) {
						return;
					}
					j$("#lvupDiv").html("<span style='color:red; font-weight:bold;'>合成実行中(" + parseInt(now+1) + "/" + max + ")</span>");
					var pageData = j$("<dim>").html(
						syncPost(
							"http://" + location.hostname + "/union/union_lv.php",
							"ssid=" + ssid + "&selected_skill_radio=" + skillObj[0] + "&base_cid=" + baseCardNo + "&added_cid=" + targetCardNo + "&use_cp_flg=0"
						)
					);
					if (j$("#resultSuccess", pageData).length > 0) {
						var skills = j$("#resultSuccess p[class=lead] strong", pageData);
						j$("#lvupResult").html("<span style='color:red; font-weight:bold;'>成功：" + skills.eq(0).text() + "<br> => " + skills.eq(1).text() + "</span>");
						j$("#ll" + targetSkill).text(skills.eq(1).text());
						j$("#ll" + targetSkill).css("color", "red");
						var skillValue = skillObj[0].substr(0,5) + parseInt(parseInt(skillObj[0].substr(5,1)) + 1);
						skillObj.pop();
						skillObj.push(skillValue);
					} else {
						j$("#lvupResult").html("<span style='color:blue; font-weight:bold;'>失敗</span>");
					}
				}
			)
		, 1000, i, targetCardNoList.length, baseCardNo, targetCardNoList[i], lvUpSkill, targetSkill, limitLv-2);
	}
}

function skillLvUpFinal() {
	j$("#lvupDiv").html("<span style='color:black; font-weight:bold;'>自動レベルアップ完了。</span>");
	j$("#lvupResult").html("");
}

//------------------------------------
// 必要資源データ
//------------------------------------
function getCostTables() {
	var cost_wood = [
		[10,35,40,15],[25,88,100,38],[58,202,230,86],[173,604,690,259],[431,1510,1725,647],
		[1466,2847,3019,1294],[2493,4839,5132,2200],[3490,6775,7186,3080],[4537,8807,9341,4003],[5898,11450,12144,5204],
		[8119,14434,15787,6766],[11366,20207,22101,9472],[17050,30311,33152,14208],[25575,45467,49729,21312],[38362,68199,74593,31698]
	];
	var cost_stone= [
		[40,10,35,15],[100,25,88,38],[230,58,202,86],[690,173,604,259],[1725,431,1510,647],
		[3019,1466,2847,1294],[5132,2493,4839,2200],[7186,3490,6775,3080],[9341,4537,8807,4003],[12144,5898,11450,5204],
		[15787,8119,14434,6766],[22101,11366,20207,9472],[33152,17050,30311,14208],[49729,25575,45467,21312],[74593,38362,68199,31968]
	];
	var cost_iron=[
		[35,40,10,15],[88,100,25,38],[202,230,58,86],[604,690,173,259],[1510,1725,431,647],
		[2847,3019,1466,1294],[4839,5132,2493,2200],[6775,7186,3490,3080],[8807,9341,4537,4003],[11450,12144,5898,5204],
		[14434,15787,8119,6766],[20207,22101,11366,9472],[30311,33152,17050,14208],[45467,49729,25575,21312],[68199,74593,38362,31968]
	];
	var cost_rice=[
		[35,35,30,0],[88,88,75,0],[202,202,173,0],[604,604,518,0],[1510,1510,1294,0],
		[3019,3019,2588,0],[5132,5132,4399,0],[7186,7186,6159,0],[9341,9341,8007,0],[12144,12144,10409,0],
		[15787,15787,13532,0],[22101,22101,18944,0],[33152,33152,28416,0],[49729,49729,42625,0],[74593,74593,63937,0]
	];
	var cost_souko=[
		[83,141,83,63],[167,281,167,126],[300,506,300,226],[479,810,479,362],[671,1134,671,507],
		[1044,1253,1044,835],[1462,1754,1462,1169],[1973,2368,1973,1578],[2664,3196,2664,2131],[3596,4315,3596,2877],
		[4854,5825,4854,3883],[6311,7573,6311,5048],[8204,9845,8204,6563],[10255,12306,10255,8204],[12819,15382,12819,10255],
		[15382,18459,15382,12306],[18459,22151,18459,14767],[21228,21228,25473,16982],[24412,29294,24412,19529],[28074,33688,28074,22459]
	];
	var cost_syukusya=[
		[35,20,35,80],[53,30,53,120],[89,51,89,204],[147,84,147,337],[228,130,228,522],
		[336,192,336,767],[476,272,476,1089],[653,373,653,1492],[868,496,868,1984],[1129,645,1129,2580],
		[2032,1161,2032,4644],[3658,2090,3658,4644],[6951,3971,6950,15882],[13205,7544,13205,30177],[25090,14334,25090,57336]
	];
	var cost_kojo=[
		[780,1560,1560,3900],[1248,2496,2496,6240],[1997,3994,3994,9984],[4193,6290,6290,11182],[5871,8806,8806,15655],
		[10958,13698,13698,16437],[15342,19177,19177,23013],[19944,24930,24930,29916],[25928,32410,32410,38891],[33706,42132,42132,50559]
	];
	var cost_suisya=[
		[2940,980,980,4900],[4704,1568,1568,7840],[7526,2509,2509,12544],[10537,5268,5268,14049],[14751,7376,7376,19668],
		[20652,13768,13768,20652],[28913,19275,19275,28913],[37587,25058,25058,37587],[48863,32576,32576,48863],[63523,42348,42348,63523]
	];
	var cost_ichiba=[
		[100,100,50,50],[334,334,191,191],[1035,1035,592,592],[2795,2795,1600,1600],[6328,6328,4218,4218],
		[13288,13288,8859,8859],[25248,25248,16832,16832],[42921,42921,28614,28614],[64381,64381,42921,42921],[90134,90134,60089,60089]
	];
	var cost_kenkyu=[
		[275,110,110,55],[413,165,165,83],[619,248,248,124],[1486,836,836,557],[2228,1253,1253,836],
		[7521,6267,6267,5015],[13538,11282,11282,9025],[21436,17862,17862,14290],[44675,37228,37228,29784],[87725,73104,73104,58483]
	];
	var cost_kunren=[
		[1500,1600,2500,3300],[2100,2240,3500,3300],[2940,3136,4900,6468],[6629,7326,13955,6978],[13257,14653,27910,13955],
		[32097,37679,55821,13955],[64194,75358,111642,27910],[128388,150716,223283,55821],[256776,301432,446566,111642],[513551,602865,893133,223283]
	];
	var cost_kajiba=[
		[150,200,340,170],[400,300,680,340],[780,585,1326,663],[1482,1112,2519,1260],[2742,2056,4661,2330],
		[4935,3701,8390,4195],[8636,6477,14682,7341],[17640,14112,28223,10584],[31566,25253,50506,18940],[50506,40404,80809,30303]
	];
	var cost_bougu=[
		[150,200,340,170],[300,400,680,340],[585,780,1326,663],[1112,1482,2519,1260],[2056,2742,4661,2330],
		[3701,4935,8390,4195],[6477,8636,14682,7341],[14112,17640,28223,10584],[25253,31566,50506,18940],[40404,50506,80809,30303]
	];
	var cost_heiki=[
		[216,216,216,72],[432,432,432,144],[864,864,864,288],[1224,1224,1224,648],[1836,1836,1836,972],
		[2662,2662,2662,1409],[3860,3860,3860,2044],[7357,7357,7357,2452],[13242,13242,13242,4414],[23836,23836,23836,7945],
		[42905,42905,42905,14302],[77229,77229,77229,25743],[139013,139013,139013,46338],[278026,278026,278026,92675],[556051,556051,556051,185350]
	];
	var cost_doujaku=[
		[700,3500,2100,700],[1120,5600,3360,1120],[1792,8960,5376,1792],[3763,10035,7526,3763],[5263,14049,10537,5268],
		[9834,14752,14752,9834],[13768,20652,20652,13768],[17899,26848,26848,17899],[23268,34902,34902,23268],[30249,45373,45373,30249]
	];
	var cost_renpei=[
		[112,107,107,122],[224,214,214,244],[448,428,428,488],[759,725,725,826],[1214,1160,1160,1322],
		[2209,2110,2110,2406],[3331,3182,3182,3627],[4958,4736,4736,5400],[8091,7729,7729,8813],[11130,10632,10632,12122]
	];
	var cost_heisya=[
		[72,360,72,216],[144,720,144,432],[288,1440,288,864],[648,1728,648,1296],[972,2592,972,1944],
		[1409,3758,1409,2819],[2725,4088,2725,4088],[6744,9810,5518,2453],[12140,17658,9933,4415],[21852,31784,17879,7946],
		[39333,57212,32182,14303],[70800,96545,64364,25745],[127440,173781,115854,46342],[254879,324392,254879,92683],[509759,648784,509759,185367]
	];
	var cost_yumi=[
		[360,72,72,216],[720,144,144,432],[1440,288,288,864],[1728,648,648,1296],[2592,972,972,1944],
		[3758,1409,1409,2819],[5450,2044,2044,4087],[9810,6131,6131,2453],[17658,12140,9933,4415],[31784,21852,17879,7946],
		[57212,39333,32182,14303],[96545,70800,64364,25745],[173781,127440,115854,46342],[324392,254879,254879,92683],[648784,509759,509759,185367]
	];
	var cost_uma=[
		[72,72,360,216],[144,144,720,432],[288,288,1440,864],[648,648,1728,1296],[972,972,2592,1944],
		[1409,1409,3758,2891],[2044,2044,5450,4087],[5518,6744,9810,2453],[9933,12140,17658,4415],[17879,21852,31784,7946],
		[32182,39333,57212,14303],[64364,70800,96545,25745],[115854,127440,173781,46342],[254879,254879,324392,92683],[509759,509759,648784,185367]
	];
	var cost_shiro=[
		[0,0,0,0],[1404,546,390,780],[2570,1000,714,1428],[4161,2081,2081,2081],[7102,3552,3552,3552],
		[9056,9056,6037,6037],[14384,14384,9589,9589],[22773,22773,15183,15183],[33562,33562,22374,22374],[44402,57559,32890,29602],
		[65122,84418,48239,43415],[95317,123558,70605,63544],[113458,154716,154716,92830],[150418,150418,315878,135375],[219008,219008,492770,164258],
		[294820,294820,663345,221115],[488220,488220,827854,318406],[839130,839130,915414,457707],[1307581,1307581,1354280,700491],[1901938,1901938,1969864,1018896]
	];
	var cost_toride=[
		[104,400,136,160],[243,936,319,374],[438,1685,573,673],[1110,2467,1357,1233],[1887,4194,2307,2097],
		[3236,7191,3954,3596],[5177,11505,6327,5753],[10430,18776,13560,9387],[18839,33912,24492,16956],[33914,61043,44087,30523],
		[66939,106495,85196,45640],[119786,190570,152456,81672],[213820,340166,272133,145786],[423566,505021,456148,244365],[708513,844765,763014,408756]
	];
	var cost_mura=[
		[400,136,104,160],[936,319,243,374],[1685,573,438,673],[2467,1357,1110,1233],[4194,2307,1887,2097],
		[7191,3954,3236,3596],[11505,6327,5177,5753],[18776,13560,10430,9387],[33912,24492,18839,16956],[61043,44087,33914,30523],
		[106495,85196,66939,45640],[190570,152456,119786,81672],[340166,272133,213820,145786],[505021,456148,423566,244365],[844765,763014,708513,408756]
	];
	var cost_mihari = [
		[600,840,600,360],[960,1344,960,576],[1536,2150,1536,922],[2458,3441,2458,1475],[3932,5505,3932,2359],
		[6291,8808,6291,3775],[9437,13212,9437,5662],[14156,19818,14156,8493],[21233,29727,21233,12740],[31850,44590,31850,19110],
		[44590,62426,44590,26754],[62426,87396,62426,37456],[87397,122355,87397,52438],[122355,171297,122355,73413],[159062,222686,159062,95437],
		[206780,289492,206780,124068],[268814,376340,268814,161288],[349458,489242,349458,209675],[419350,587090,419350,251610],[503220,704508,503220,301932]
	];
	var cost_daisyukusya = [
		[200,114,200,438],[320,183,320,701],[512,293,512,1121],[768,439,768,1682],[1152,658,1152,2523],
		[1728,987,1728,3784],[2419,1382,2419,5298],[3387,1935,3387,7418],[4741,2709,4741,10385],[6637,3793,6637,14538],
		[8628,4930,8628,18900],[11217,6409,11217,24570],[14582,8332,14582,31941],[18956,11735,18956,40620],[25817,16429,25817,49286],
		[32271,22003,32271,60141],[42172,29337,42172,69675],[52715,38963,52715,84803],[66009,49506,66009,93512],[79211,62708,79211,108914]
	];
	var cost_enseikunren = [
		[2884,4486,5977,2723],[4614,7177,9484,4357],[7382,11483,15174,6972],[11811,18373,24279,11155],[18898,29397,38846,17848],
		[28347,44096,58269,26772],[42521,66143,87404,40158],[63781,99215,131105,60238],[89294,138901,183548,84333],[125011,194461,256967,118066],
		[175015,272246,359754,165292],[227520,353920,467680,214880],[295776,460096,607984,279344],[384509,598125,790379,363147],[512678,692116,897187,461410],
		[645974,830539,1045863,553692],[812082,959734,1218123,701344],[1018794,1151680,1417453,841613],[1275708,1382016,1647789,1009935],[1594635,1658420,1913561,1211922]
	];
	var cost_syuugyousyo = [
		[1600,1200,600,600],[2240,1680,840,840],[3136,2352,1176,1176],[4390,3293,1646,1646],[6146,4610,2305,2305],
		[8605,6454,3227,3227],[11186,8390,4195,4195],[14542,10907,5453,5453],[18905,14179,7089,7089],[24577,18433,9216,9216],
		[31950,23963,11981,11981],[38340,28755,14378,14378],[46008,34506,17253,17253],[55210,41407,20704,20704],[66252,49689,24844,24844],
		[72877,54658,27329,27329],[80164,60123,30062,30062],[88181,66136,33068,33068],[96999,72749,36375,36375],[106699,80024,40012,40012]
	];

	var costs = [];
	costs["伐採所"] = cost_wood;
	costs["石切り場"] = cost_stone;
	costs["製鉄所"] = cost_iron;
	costs["畑"] = cost_rice;
	costs["倉庫"] = cost_souko;
	costs["宿舎"] = cost_syukusya;
	costs["工場"] = cost_kojo;
	costs["水車"] = cost_suisya;
	costs["市場"] = cost_ichiba;
	costs["研究所"] = cost_kenkyu;
	costs["訓練所"] = cost_kunren;
	costs["鍛冶場"] = cost_kajiba;
	costs["防具工場"] = cost_bougu;
	costs["兵器工房"] = cost_heiki;
	costs["銅雀台"] = cost_doujaku;
	costs["練兵所"] = cost_renpei;
	costs["兵舎"] = cost_heisya;
	costs["弓兵舎"] = cost_yumi;
	costs["厩舎"] = cost_uma;
	costs["城"] = cost_shiro;
	costs["砦"] = cost_toride;
	costs["村"] = cost_mura;

	costs["見張り台"] = cost_mihari;
	costs["大宿舎"] = cost_daisyukusya;
	costs["遠征訓練所"] = cost_enseikunren;
	costs["修行所"] = cost_syuugyousyo;
	return costs;
}

//------------------------------------
// 共通系そとだす
//------------------------------------
function csaveData(key, value, local, ev)
{
	if( local ) key = location.hostname + key;
	if( ev ) {
		if (window.opera || typeof JSON != 'object') {
			value = toJSON(value);
		}
		else {
			value = JSON.stringify( value );
		}
	}
	GM_setValue(key, value );
}

function cloadData(key, value, local, ev)
{
	if( local ) key = location.hostname + key;
	var ret = GM_getValue(key, value);
	return ev ? eval('ret='+ret) : ret;
}

// その他拡張
//JSONとprototype.jsの衝突回避用
function toJSON(obj) {
	switch (typeof obj) {
	case 'string':
		return quote(obj);
	case 'number':
		return isFinite(obj) ? String(obj) : 'null';
	case 'boolean':
	case 'null':
		return String(obj);
	case 'object':
		if (!obj) {
			return 'null';
		}

		if (obj instanceof Date) {
			return isFinite(obj) ? obj.getUTCFullYear() + '-'
			+ complementZero(obj.getUTCMonth() + 1) + '-'
			+ complementZero(obj.getUTCDate()) + 'T'
			+ complementZero(obj.getUTCHours()) + ':'
			+ complementZero(obj.getUTCMinutes()) + ':'
			+ complementZero(obj.getUTCSeconds()) + 'Z' : 'null';
		}

		var partial = new Array();
		var prefix = '{';
		var suffix = '}';
		if (obj instanceof Array) {
			prefix = '[';
			suffix = ']';
			length = obj.length;
			for ( var i = 0; i < length; i++) {
				partial[i] = toJSON(obj[i]) || 'null';
			}
		} else {
			for ( var key in obj) {
				if (Object.hasOwnProperty.call(obj, key)) {
					partial.push(quote(key) + ':'
						+ (toJSON(obj[key]) || 'null'));
				}
			}
		}
		return prefix + partial.join(',') + suffix;
		break;
	default:
		return null;
	}

	function quote(str) {
	var escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;
	var meta = { // table of character substitutions
		'\b' : '\\b',
		'\t' : '\\t',
		'\n' : '\\n',
		'\f' : '\\f',
		'\r' : '\\r',
		'"' : '\\"',
		'\\' : '\\\\'
	};

	return escapable.test(str) ? '"'
		+ str.replace(escapable,
			function(a) {
				var c = meta[a];
				return typeof c === 'string' ? c : '\\u'
					+ ('0000' + a.charCodeAt(0).toString(16))
						.slice(-4);
			}) + '"' : '"' + str + '"';
	}

	function complementZero(number) {
	return number < 10 ? '0' + number : number;
	}
}

// 一括保護解除の解除ボタンを上にコピーする
function copy_protection_unlock(){
	if (location.pathname != "/card/protection.php") {
		return;
	}
	jQuery.noConflict();
	$ = jQuery;
	var base = $("#rotate div[class=sortTitle]");
	var target = $("#rotate div[class=center mb20 clear]");
	base.before(target.html());
}

//-------------------------------------------------
// HTTPリクエストのラッパー関数 2014/02/17 add
//-------------------------------------------------
// 指定ページのhtmlをまるごと返す(仕組み上同期通信になります)
function loadRequestPage(path, param) {
	var response = "";
	wrapHttpReq(path, "GET", param,
		function(responseBody) {
			response = responseBody;
		}, 1
	);
	return response;
}

// 同期型POSTリクエスト
function syncPost(path, param) {
	var response = "";
	wrapHttpReq(path, "POST", param,
		function(responseBody) {
			response = responseBody;
		}, 1
	);
	return response;
}

function wrapHttpReq(path, req, param, callback, sync) {
	var xh = new XMLHttpRequest();
	if( typeof sync == 'undefined' ){
		xh.open(req, path, true);
	} else {
		xh.open(req, path, false);
	}
	xh.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;charset=UTF-8");
	xh.onreadystatechange = function() {
		if( xh.readyState == 4 && xh.status == 200 ){
			callback(xh.responseText);
		}
	}
	xh.send(param);
}

// 複数の非同期通信完了を待つ(参考：http://d.hatena.ne.jp/unageanu/20070704/1183517731)
function Wait( finish, commandLength ) {
	this.count = 0;
	this.commandLength = commandLength;
	this.finish = finish;
}
Wait.prototype = {
	/**
	 * 処理完了を通知するコールバック関数を生成する。
	 * 引数でコールバック関数が渡された場合、その関数に処理完了を通知する機能を付加する。
	 * @param {Function} callback 委譲先コールバック関数。
	 */
	createCallBack: function( callback ) {
		var thiz = this;
		return function( arg1, arg2, arg3, arg4, arg5, arg6, arg7, arg8, arg9, arg10  ){
			try {
				if ( callback ) {
					callback( arg1, arg2, arg3, arg4, arg5, arg6, arg7, arg8, arg9, arg10 ); // これはひどい。
				}
			} finally {
				thiz.count += 1;
				if ( thiz.count == thiz.commandLength ) {
					// 指定回数の呼び出しが完了したらコールバック関数を実行する。
					thiz.finish();
				}
			}
		};
	}

}
